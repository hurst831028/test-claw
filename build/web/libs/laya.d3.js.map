{"version":3,"names":["DepthCasterData","createDepthCasterUniformBlock","DepthCasterUBOData","uniformpara","Map","set","Shader3D","propertyNameToID","UniformBufferParamsType","Vector4","Vector3","UnifromBufferData","DepthTextureMode","WeightedMode","KeyFrameValueType","DepthPass","__init__","DEPTHPASS","getDefineByName","DEFINE_SHADOW_BIAS","DEPTHTEXTURE","DEPTHNORMALSTEXTURE","DEPTHZBUFFERPARAMS","SHADOWUNIFORMBLOCK","UniformBufferObject","UBONAME_SHADOW","constructor","this","_defaultNormalDepthColor","Color","_zBufferParams","Config3D","_uniformBlock","_castDepthData","_castDepthUBO","getBuffer","create","BufferUsage","Dynamic","getbyteLength","update","camera","depthType","depthTextureFormat","_viewPort","viewport","_camera","Depth","depthTexture","_depthTexture","RenderTexture","createFromPool","width","height","RenderTargetFormat","None","DepthNormals","depthNormalTexture","_depthNormalsTexture","R8G8B8A8","MotionVectors","render","context","scene","shaderValues","_shaderValues","pipelineMode","addDefine","setVector","SHADOW_BIAS","offsetX","x","offsetY","y","_start","LayaGL","renderEngine","scissor","clearRenderTexture","RenderClearFlag","changeViewport","changeScissor","destTarget","Stat","depthCastDrawCall","_opaqueQueue","renderQueue","_end","_setupDepthModeShaderValue","configPipeLineMode","removeDefine","far","farPlane","near","nearPlane","setValue","setTexture","cleanUp","recoverToPool","KeyframeNode","_ownerPath","_propertys","_keyFrames","ownerPathCount","length","propertyCount","keyFramesCount","_setOwnerPathCount","value","_setOwnerPathByIndex","index","_joinOwnerPath","sep","join","_setPropertyCount","_setPropertyByIndex","_joinProperty","_setKeyframeCount","_setKeyframeByIndex","getOwnerPathByIndex","getPropertyByIndex","getKeyframeByIndex","AnimationEvent","Keyframe","cloneTo","destObject","time","clone","dest","defaultWeight","FloatKeyframe","super","inWeight","outWeight","weightedMode","destKeyFrame","inTangent","outTangent","f","QuaternionKeyframe","weightMode","Quaternion","destKeyFarme","Vector3Keyframe","AnimationClipParser03","READ_DATA","_DATA","offset","_reader","getUint32","size","READ_BLOCK","count","_BLOCK","getUint16","blockStarts","blockLengths","i","push","READ_STRINGS","prePos","pos","_strings","readUTFString","parse","clip","reader","_animationClip","n","blockName","fn","Error","call","READ_ANIMATIONS","j","node","startTimeTypes","startTimeTypeCount","getFloat32","name","clipDur","_duration","islooping","getByte","_frameRate","getInt16","nodeCount","nodes","_nodes","nodesMap","_nodesMap","nodesDic","_nodesDic","setNodeByIndex","_indexInList","type","getUint8","pathLength","nodePath","mapArray","propertyOwner","propertyLength","fullPath","keyframeCount","floatKeyframe","floatArrayKeyframe","z","quaArrayKeyframe","inTangentQua","outTangentQua","valueQua","w","eventCount","event","Math","min","eventName","params","paramCount","getInt32","addEvent","Vector2Keyframe","Vector2","Vector4Keyframe","KeyframeNodeOwner","indexInList","referenceCount","updateMark","property","defaultValue","crossFixedValue","isMaterial","saveCrossFixedValue","animatorDataSetCallBack","callBackOwner","callbackFun","apply","callParams","getCallbackNode","callbackFunData","funPropertys","split","AnimationClipParser04","version","_version","propertyChangePath","paramLen","callParms","Float","Position","Scale","RotationEuler","Rotation","quaternionKeyframe","vec2Keyfram","inTangentV2","outTangentV2","valueV2","vec4Keyfram","inTangentV4","outTangentV4","valueV4","isWeight","In","Both","Out","weidhtMode","weightModeV4","inWeightQua","outWeightQua","weightModeV2","inWeightV2","outWeightV2","weightMode_V4","inWeightV4","outWeightV4","HalfFloatUtils","convertToNumber","KeyframeNodeList","getNodeByIndex","TextureGenerator","lightAttenTexture","maxX","maxY","data","sqrRange","atten","floor","haloTexture","xFac","yFac","_generateTexture2D","texture","textureWidth","textureHeight","func","format","TextureFormat","R8G8B8","Alpha8","Uint8Array","setPixelsData","Utils3D","_createFloatTextureBuffer","floatTex","Texture2D","R32G32B32A32","filterMode","FilterMode","Point","wrapModeU","WrapMode","Clamp","wrapModeV","anisoLevel","_rotationTransformScaleSkinAnimation","tx","ty","tz","qx","qy","qz","qw","sx","sy","sz","outArray","outOffset","ai0","ai1","ai2","ai3","re","_tempArray16_0","se","_tempArray16_1","tse","_tempArray16_2","x2","y2","z2","xx","yx","yy","zx","zy","zz","wx","wy","wz","billboardTrans","v0","cameraDir","cameraUp","out","normalize","_tempV1","cross","_tempV0","scale","add","PointinTriangle","A","B","C","P","vsub","_tempVector3_0","v1","_tempVector3_1","v2","_tempVector3_2","dot00","dot","dot01","dot02","dot11","dot12","inverDeno","u","v","_computeBoneAndAnimationDatasByBindPoseMatrxix","bones","curData","inverGlobalBindPose","outBonesDatas","outAnimationDatas","boneIndexToMesh","parentOffset","matOffset","boneLength","keyframeWidth","parentIndex","mulMatrixByArray","mulMatrixByArrayAndMatrixFast","_computeAnimationDatasByArrayAndMatrixFast","bonesDatas","_computeBoneAndAnimationDatasByBindPoseMatrxixOld","arrayOffset","_computeAnimationDatasByArrayAndMatrixFastOld","_computeRootAnimationData","animationDatas","createAffineTransformationArray","transformVector3ArrayByQuat","sourceArray","sourceOffset","rotation","ix","iy","iz","iw","leftArray","leftOffset","rightArray","rightOffset","_tempArray16_3","mulMatrixByArrayFast","rightMatrix","rightMatrixE","elements","m11","m12","m13","m14","m21","m22","m23","m24","m31","m32","m33","m34","m41","m42","m43","m44","ai0LeftOffset","ai1LeftOffset","ai2LeftOffset","ai3LeftOffset","ai0OutOffset","ai1OutOffset","ai2OutOffset","ai3OutOffset","tX","tY","tZ","rX","rY","rZ","rW","sX","sY","sZ","xy","xz","yz","transformVector3ArrayToVector3ArrayCoordinate","source","transform","result","resultOffset","coordinateX","coordinateY","coordinateZ","transformElem","transformVector3ArrayToVector3ArrayNormal","transformLightingMapTexcoordArray","lightingMapScaleOffset","getURLVerion","url","indexOf","substr","_createAffineTransformationArray","trans","rot","outE","_mulMatrixArray","left","right","l","r","e","l11","l12","l13","l14","l21","l22","l23","l24","l31","l32","l33","l34","l41","l42","l43","l44","r11","r12","r13","r14","r21","r22","r23","r24","r31","r32","r33","r34","r41","r42","r43","r44","arcTanAngle","PI","atan","angleTo","from","location","angle","subtract","TEMPVector30","asin","transformQuat","quaternionWeight","weight","quaternionConjugate","scaleWeight","s","pow","abs","scaleBlend","sa","sb","saw","sbw","sng","matrix4x4MultiplyFFF","a","b","Float32Array","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","b10","b11","b12","b13","b14","b15","matrix4x4MultiplyMFM","_buildTexture2D","colorFunc","mipmaps","_drawBound","debugLine","boundBox","color","lineCount","maxLineCount","start","end","max","addLine","_getHierarchyPath","rootSprite","checkSprite","path","sprite","parent","_parent","getChildIndex","_getNodeByHierarchyPath","invPath","getChildAt","_getParentNodeByHierarchyPath","pathlength","uint8ArrayToArrayBuffer","rendertexture","pixelArray","colorFormat","R16G16B16A16","toString","getData","ori","pixels","bs","LayaEnv","isConch","canv","HTMLCanvas","lock","ctx2d","getContext","imgdata","createImageData","Uint8ClampedArray","putImageData","toDataURL","destroy","_compIdToNode","Object","window","getRTBase64","AnimationClip","Resource","_parse","Byte","load","complete","ILaya","loader","Loader","ANIMATIONCLIP","duration","_animationEvents","_weightModeHermite","nextweightMode","_hermiteInterpolate","frame","nextFrame","t","dur","t0","t1","Number","isFinite","t2","t3","c","d","_hermiteInterpolateVector3","p0","tan0","p1","tan1","_hermiteCurveSplineWeight","_hermiteInterpolateQuaternion","_hermiteInterpolateVector4","_hermiteInterpolateVector2","frameValue","frametime","frameOutWeight","frameOutTangent","nextframeValue","nextframetime","nextframeInweight","nextframeIntangent","Eps","y1","wt1","wt2","dx","dy","yp1","yp2","wt2s","fg","fpg","fppg","_curveInterpolate","_evaluateClipDatasRealTime","playCurTime","realTimeCurrentFrameIndexes","addtive","frontPlay","outDatas","avatarMask","nextFrameIndex","keyFrames","frameIndex","getTransformActive","isEnd","nextFarme","clipData","_evaluateFrameNodeVector3DatasRealTime","firstFrameValue","clipQuat","_evaluateFrameNodeQuaternionDatasRealTime","tempQuat","_tempQuaternion0","firstFrameValueQua","multiply","v2Data","_evaluateFrameNodeVector2DatasRealTime","v2FrameValue","v4Data","_evaluateFrameNodeVector4DatasRealTime","v4FrameValue","frameData","nextKeyFrame","startTime","firstFrameDatas","_binarySearchEventIndex","mid","midValue","splice","_disposeResource","Laya3DRender","StaticFlag","FrustumCorner","volumeIntersectType","AmbientMode","ReflectionProbeMode","RenderBitFlag","IrradianceMode","ShadowMode","ShadowCascadesMode","LightType","LightMode","FrustumFace","ShadowMapFormat","ShadowLightType","Sprite3D","Node","WORLDMATRIX","WORLDINVERTFRONT","sprite3DCommandUniformMap","renderOBJCreate","createGlobalUniformMap","addShaderUniform","ShaderDataType","Matrix4x4","instantiate","original","worldPositionStays","position","destSprite3D","addChild","worldMatrix","then","res","runWith","id","_id","layer","_layer","Event","LAYERCHANGE","isStatic","_isStatic","StaticBatch","Normal","staticMask","_transform","_scene","_isRenderNode","_uniqueIDCounter","_is3D","createTransform","_onActive","sprite3DCount","_onInActive","_onAdded","parent3D","_setParent","_onWorldTransform","_onRemoved","onStartListeningToType","startsWith","_setBit","NodeFlags","PROCESS_COLLISIONS","PROCESS_TRIGGERS","spriteMap","undefined","active","tag","loccalPosition","localPosition","fromArray","rotationEuler","localRotationEuler","localRotation","localScale","_cloneTo","srcRoot","dstRoot","_destroyed","destTrans","_createSprite3DInstance","scrSprite","_create","children","_children","child","_parseSprite3DInstance","dstSprite","srcChildren","dstChildren","dstSprite3D","destroyChild","ILaya3D","Scene3D","Laya3D","ClusterData","pointLightCount","spotLightCount","indices","Cluster","xSlices","ySlices","zSlices","maxLightsPerClusterAverage","_updateMark","_depthSliceParam","_xSlices","_ySlices","_zSlices","clusterTexWidth","clisterTexHeight","ceil","_clusterTexture","_clusterPixels","clusterDatas","Array","_clusterDatas","_placePointLightToClusters","lightIndex","lightBound","zMin","zEnd","zMax","yMin","yEnd","yMax","xMin","xEnd","xMax","lightCount","_placeSpotLightToClusters","_insertConePlane","origin","forward","radius","halfAngle","pNor","V1","_tempVector36","V2","_tempVector37","tanR","tan","capRimX","capRimY","capRimZ","_shrinkSphereLightZPerspective","lightviewPos","lvZ","minZ","maxZ","depthSliceParam","log2","_shrinkSpotLightZPerspective","viewLightPos","viewConeCap","pbX","pbY","pbZ","rb","paX","paY","paZ","aX","aY","aZ","dotA","eZ","sqrt","_shrinkSphereLightByBoundOrth","halfX","halfY","lvX","minX","lvY","minY","xStride","yStride","_shrinkSpotLightByBoundOrth","eX","eY","_shrinkXYByRadiusPerspective","xPlanes","yPlanes","plane","_shrinkSpotXYByConePerspective","viewForward","normal","_tempVector32","_updatePointLightPerspective","viewMat","pointLight","_tempLightBound","_tempVector30","transformV3ToV3","owner","range","_updateSpotLightPerspective","spotLight","viewPos","_tempVector31","_tempVector34","getForward","spotAngle","viewFor","_tempVector33","_updatePointLightOrth","_updateSpotLightOrth","camNear","lightClusterCount","viewMatrix","curCount","_directionLights","_length","pointLights","_pointLights","poiCount","poiElements","_elements","spotLights","_spotLights","spoCount","spoElements","orthographic","orthographicVerticalSize","aspectRatio","_updateClusterPlaneXY","_clusterXPlanes","_clusterYPlanes","widthFloat","lightOff","clusterPixels","clusterPixelsCount","freeSpace","clusterOff","pCount","sCount","setSubPixelsData","_tempVector35","Plane","distance","createPlaneBy3P","point0","point1","point2","x1","z1","invPyth","normalEX","normalEY","normalEZ","magnitude","PlaneIntersectionType_Back","PlaneIntersectionType_Front","PlaneIntersectionType_Intersecting","Ray","direction","at","ContainmentType","Disjoint","Contains","Intersects","CollisionUtils","distancePlaneToPoint","point","distanceBoxToPoint","box","boxMin","boxMineX","boxMineY","boxMineZ","boxMax","boxMaxeX","boxMaxeY","boxMaxeZ","pointeX","pointeY","pointeZ","distanceBoxToBox","box1","box2","delta","box1Mine","box1MineX","box1MineY","box1MineZ","box1Maxe","box1MaxeX","box1MaxeY","box1MaxeZ","box2Mine","box2MineX","box2MineY","box2MineZ","box2Maxe","box2MaxeX","box2MaxeY","box2MaxeZ","distanceSphereToPoint","sphere","distanceSquared","center","distanceSphereToSphere","sphere1","sphere2","intersectsRayAndTriangleRD","ray","vertex1","vertex2","vertex3","rayO","rayOeX","rayOeY","rayOeZ","rayD","rayDeX","rayDeY","rayDeZ","v1eX","v1eY","v1eZ","v2eX","v2eY","v2eZ","v3eX","v3eY","v3eZ","_tempV30eX","_tempV30","_tempV30eY","_tempV30eZ","_tempV31eX","_tempV31","_tempV31eY","_tempV31eZ","_tempV32eX","_tempV32","_tempV32eY","_tempV32eZ","determinant","MathUtils3D","isZero","inversedeterminant","_tempV33eX","_tempV33","_tempV33eY","_tempV33eZ","triangleU","_tempV34eX","_tempV34","_tempV34eY","_tempV34eZ","triangleV","raydistance","intersectsRayAndTriangleRP","ZERO","intersectsRayAndPoint","zeroTolerance","intersectsRayAndRay","ray1","ray2","ray1o","ray1oeX","ray1oeY","ray1oeZ","ray1d","ray1deX","ray1deY","ray1deZ","ray2o","ray2oeX","ray2oeY","ray2oeZ","ray2d","ray2deX","ray2deY","ray2deZ","tempV3","denominator","scalarLength","nearEqual","dets","point1e","point2e","intersectsPlaneAndTriangle","test1","intersectsPlaneAndPoint","test2","test3","intersectsRayAndPlaneRD","planeNor","intersectsRayAndPlaneRP","scaDis","intersectsRayAndBoxRD","rayoe","rayoeX","rayoeY","rayoeZ","rayde","raydeX","raydeY","raydeZ","boxMine","boxMaxe","tmax","MaxValue","inverse","temp","inverse1","t4","temp1","inverse2","t5","t6","temp2","intersectsRayAndBoxRP","intersectsRayAndSphereRD","sphereR","discriminant","intersectsRayAndSphereRP","intersectsSphereAndTriangle","sphereC","closestPointPointTriangle","intersectsPlaneAndPlane","plane1","plane2","intersectsPlaneAndPlaneRL","line","plane1nor","plane2nor","intersectsPlaneAndBox","planeD","planeNoreX","planeNoreY","planeNoreZ","intersectsPlaneAndSphere","intersectsBoxAndBox","intersectsBoxAndSphere","nearest","intersectsSphereAndSphere","radiisum","boxContainsPoint","boxContainsBox","boxContainsSphere","sphereCeX","sphereCeY","sphereCeZ","sphereContainsPoint","sphereContainsTriangle","sphereContainsBox","_tempV30e","radiusSquared","scalarLengthSquared","sphereContainsSphere","sphere1R","sphere2R","d1","d2","d3","d4","d5","d6","vc","vb","va","w3","denom","w2","_tempV35","_tempV36","closestPointPlanePoint","planeN","closestPointBoxPoint","closestPointSpherePoint","closestPointSphereSphere","sphere1C","BoundFrustum","getPlanesFromMatrix","m","np","fp","lp","rp","tp","bp","matrixE","nearNorE","farNorE","leftNorE","rightNorE","topNorE","bottomNorE","matrix","_matrix","initBoundingPlane","_near","_far","_left","_right","_top","_bottom","top","bottom","equalsBoundFrustum","other","equalsOtherMatrix","equalsObj","obj","bf","getPlane","get3PlaneInterPoint","p2","p3","p1Nor","p2Nor","p3Nor","getCorners","corners","nearBottomRight","nearTopRight","nearTopLeft","nearBottomLeft","FarBottomRight","FarTopRight","FarTopLeft","FarBottomLeft","containsPoint","planeResult","intersects","nearNormal","leftNormal","rightNormal","bottomNormal","topNormal","farNormal","containsBoundBox","p","containsBoundSphere","Viewport","minDepth","maxDepth","project","transformV3ToV4","unprojectFromMat","matrixEleme","unprojectFromWVP","projection","view","world","_tempMatrix4x4","invert","_tempViewport","Picker","calculateCursorRay","viewPort","projectionMatrix","nearSource","nerSourceE","farSource","farSourceE","nearPoint","farPoint","outDire","rayIntersectsTriangle","edge1","edge2","directionCrossEdge2","MIN_VALUE","NaN","inverseDeterminant","distanceVector","rayDistance","distanceCrossEdge1","rayPlaneIntersection","ddotn","RenderableSprite3D","SHADERDEFINE_RECEIVE_SHADOW","SAHDERDEFINE_LIGHTMAP","SHADERDEFINE_LIGHTMAP_DIRECTIONAL","LIGHTMAPSCALEOFFSET","LIGHTMAP","LIGHTMAP_DIRECTION","PICKCOLOR","REFLECTIONCUBE_PROBEPOSITION","REFLECTIONCUBE_PROBEBOXMAX","REFLECTIONCUBE_PROBEBOXMIN","VOLUMETRICGI_PROBECOUNTS","VOLUMETRICGI_PROBESTEPS","VOLUMETRICGI_PROBESTARTPOS","VOLUMETRICGI_PROBEPARAMS","VOLUMETRICGI_IRRADIANCE","VOLUMETRICGI_DISTANCE","AMBIENTCOLOR","AMBIENTSH","AMBIENTINTENSITY","REFLECTIONINTENSITY","IBLTEX","IBLROUGHNESSLEVEL","commandUniform","SHADERDEFINE_MORPHTARGET","SHADERDEFINE_MORPHTARGET_POSITION","SHADERDEFINE_MORPHTARGET_NORMAL","SHADERDEFINE_MORPHTARGET_TANGENT","MorphTex","MorphParams","MorphAttriOffset","MorphActiceTargets","MorphActiveWeights","MorphActiveCount","Buffer","Int","REFLECTIONTEXTURE","REFLECTIONCUBE_HDR_PARAMS","TextureCube","AMBIENTSHAR","AMBIENTSHAG","AMBIENTSHAB","AMBIENTSHBR","AMBIENTSHBG","AMBIENTSHBB","AMBIENTSHC","_onActiveInScene","_addToInitStaticBatchManager","_setBelongScene","_setUnBelongScene","MeshSprite3DShaderDeclaration","Bounds","merge","containPoint","getMax","getMin","setMin","setMax","_imp","setCenter","getCenter","setExtent","getExtent","createBounds","_getUpdateFlag","_setUpdateFlag","_getCenter","_getExtent","_getMin","extent","_getMax","_rotateExtents","extents","extentsX","extentsY","extentsZ","matE","_tranform","getBoundBox","_getBoundBox","calculateBoundsintersection","bounds","_UPDATE_MIN","_UPDATE_MAX","_UPDATE_CENTER","_UPDATE_EXTENT","Volume","Component","_aroundVolumeCacheNum","_bounds","_primitiveBounds","_importance","runInEditor","_type","boundsMax","_reCaculateBoundBox","boundsMin","probePosition","importance","_onEnable","on","TRANSFORM_CHANGED","_VolumeChange","_volumeManager","_onDisable","off","remove","_needUpdateAllRender","reManager","_regVolumeManager","ReflectionProbeManager","_reflectionProbes","SingletonList","_sceneReflectionProbe","ReflectionProbe","boxProjection","_isScene","sceneReflectionProbe","_updateRenderObject","baseRender","mainProbe","overlop","maxOverlap","renderBounds","renflectProbe","probReflection","volume","handleMotionlist","motionObjects","_surportReflectionProbe","_reflectionMode","reCaculateAllRenderObjects","baseRenders","Sprite3DRenderDeclaration","VolumetricGIManager","_GIVolumes","removeVolumetricGI","renderer","SHADERDEFINE_VOLUMETRICGI","lightProb","currentVolume","overlap","volumes","_surportVolumetricGI","renders","VolumeManager","_motionObjects","_volumeList","_reflectionProbeManager","ReflectionProbeVolumeType","_volumetricGIManager","VolumetricGIType","reflectionProbeManager","volumetricGIManager","addMotionObject","renderObj","removeMotionObject","mainVolume","clearMotionObjects","needreCaculateAllRenderObjects","SphericalHarmonicsL2","_coefficients","getCoefficient","setCoefficient","coefficient","setCoefficients","coefficient0","coefficient1","coefficient2","coefficient3","coefficient4","coefficient5","coefficient6","coefficient7","coefficient8","coes","destCoes","_default","SphericalHarmonicsL2Generater","surfaceArea","atan2","uv2Dir","face","out_dir","TextureCubeFace","PositiveX","NegativeX","PositiveY","NegativeY","PositiveZ","NegativeZ","sh_eval_9","M_PI","CalCubemapSH","cubemapPixels","pixelComponentSize","cubemapSize","isGamma","shr","_tempSHR","fill","shg","_tempSHG","shb","_tempSHB","dir","facePixels","x0","y0","da","pixelOffset","g","gammaToLinearSpace","SH_Count","sh_val","sh","k","CalGradientSH","skyColor","equatorColor","groundColor","console","skyPixels","_tempSkyPixels","equatorPixels","_tempEquatorPixels","groundPixels","_tempGroundPixels","fillPixelBuffer","float32","fillColor","toLinear","gradientPixles","GradientSimulateSize","timeEnd","getID","reflectionCount","_boxProjection","_ambientColor","_ambientMode","SolidColor","_reflectionHDRParams","_reflectionDecodeFormat","TextureDecodeFormat","_ambientSkyColor","_ambientEquatorColor","_ambientGroundColor","_ambientIntensity","_reflectionIntensity","_reflectionProbeID","ambientIntensity","reflectionIntensity","ambientColor","ambientMode","ambientSH","_ambientSH","SphericalHarmonics","_ambientSphericalHarmonics","_applySHCoefficients","TripleColor","_ambientTripleColorSphericalHarmonics","iblTex","_iblTex","_removeReference","_addReference","iblTexRGBD","_iblTexRGBD","applyReflectionShaderData","shaderData","SHADERDEFINE_SPECCUBE_BOX_PROJECTION","setShaderData","SHADERDEFINE_GI_LEGACYIBL","SHADERDEFINE_GI_IBL","setColor","setNumber","maxMipmapLevel","SHADERDEFINE_IBL_RGBD","setBuffer","_reflectionTexture","reflectionTexture","blackTexture","reflectionHDRParams","_shCoefficients","_onDestroy","customReflection","reflectionDecodingFormat","RGBM","ambientSphericalHarmonics","originalSH","intensity","optSH","shaderSHA","shaderSHB","setGradientAmbient","gradientSH","TEMPVECTOR3","defaultTextureHDRDecodeValues","BaseRender","shaderValueInit","getMeshDefine","mesh","_subMeshes","vertexElements","getSubMesh","_vertexBuffer","_vertexDeclaration","_vertexElements","_elementUsage","VertexMesh","MESH_COLOR0","SHADERDEFINE_COLOR","MESH_TEXTURECOORDINATE0","SHADERDEFINE_UV0","MESH_TEXTURECOORDINATE1","SHADERDEFINE_UV1","MESH_TANGENT0","SHADERDEFINE_TANGENT","changeVertexDefine","oldMesh","defineDatas","lastValue","_meshVerticeDefine","ratioIgnor","_ratioIgnor","renderbitFlag","_rendernode","boundsChange","shadowCullPass","castShadow","_enabled","renderNode","distanceForSort","_distanceForSort","geometryBounds","_baseGeometryBounds","renderId","lightmapIndex","_lightmapIndex","_applyLightMapParams","_getIrradientMode","irradientMode","_irradientMode","lightmapScaleOffset","_lightmapScaleOffset","_setShaderValue","material","_sharedMaterials","_materialsInstance","insMat","_getInstanceMaterial","renderElement","_renderElements","sharedMaterial","_isSupportRenderFeature","materials","slice","sharedMaterials","lastMat","_changeMaterialReference","element","materialsInstance","sharedMats","mat","_calculateBoundingBox","receiveShadow","_receiveShadow","reflectionMode","_volume","_addRenderNode","_motionInVolume","_removeRenderNode","voluemProbe","_probReflection","_probeReflectionUpdateMark","volumetricGI","_lightProb","_lightProbUpdateMark","applyVolumetricGI","_commonUniformMap","_supportOctree","_sceneUpdateMark","simple","_updateRenderType","_motionIndexList","_LOD","_lightmapDirtyFlag","_getcommonUniformMap","_createBaseRenderNode","createShaderData","sortingFudge","_customCull","_needRender","prototype","_worldParams","LightMap","VolumetricGI","createBaseRenderNode","_changeLayer","_changeStaticMask","staticmask","setRenderbitFlag","RenderBitFlag_Editor","_getBit","HIDE_BY_EDITOR","_onWorldMatNeedChange","_addRenderObject","_removeRenderObject","preReflection","prelightprob","_shader","_supportReflectionProbe","_addReflectionProbeUpdate","flag","_subUniformBufferData","_needUpdate","_batchRender","_updateOneRender","pass","shaderdataType","lightMaps","lightmaps","lightMap","lightmapColor","lightmapDirection","_applyLightProb","_applyReflection","_batchOneRender","batch","_removeOneRender","boundFrustum","_CullOut","_renderUpdate","_renderUpdateWithCamera","_sceneRenderManager","sceneRenderableManager","removeRenderObject","destroyed","_transLargeUbO","recover","_tempBoundBoxCorners","_defaultLightmapScaleOffset","RenderElement","_renderElementOBJ","_material","_materialShaderData","renderSubShader","_subShader","subShaderIndex","_subShaderIndex","_baseRender","_renderShaderData","_canBatch","renderType","RENDERTYPE_NORMAL","_createRenderElementOBJ","createRenderElement","getInvertFront","_isFrontFaceInvert","setTransform","setGeometry","geometry","_geometry","_geometryElementOBj","compileShader","passes","_passes","_clearShaderInstance","_pipelineMode","comDef","_compileDefine","sceneShaderData","_defineDatas","_configDefineValues","addDefineDatas","configShaderData","cameraShaderData","nodeCommonMap","shaderIns","withCompile","_addShaderInstance","_convertSubShader","customShader","replacementTag","subshaderIndex","subShader","getSubShaderAt","oriTag","getFlag","customSubShaders","_subShaders","customSubShader","_update","_getRenderQueue","addRenderElement","_renderUpdatePre","sceneMark","Camera","subUbo","updateSubData","_isRender","_prepareRender","_updateRenderParams","_contextOBJ","_invertFront","_render","_destroy","RENDERTYPE_STATICBATCH","RENDERTYPE_INSTANCEBATCH","RENDERTYPE_VERTEXBATCH","DefineDatas","GeometryElement","bufferState","mode","drawType","setDrawArrayParams","first","setDrawElemenParams","instanceCount","indexFormat","createRenderGeometry","_getType","state","clearRenderParams","_typeCounter","SkyBox","instance","MeshTopology","Triangles","DrawType","DrawElement","vertices","verDec","getVertexDeclaration","vertexBuffer","createVertexBuffer3D","vertexStride","Static","vertexDeclaration","indexBuffer","createIndexBuffer3D","IndexFormat","UInt8","setData","BufferState","applyState","VertexPositionTexture0","VertexDeclaration","VertexElement","VertexElementFormat","MESH_POSITION0","_position","textureCoordinate0","_textureCoordinate0","SkyDome","stacks","_stacks","slices","_slices","vertexFloatCount","numberVertices","numberIndices","Uint16Array","stackAngle","sliceAngle","vertexIndex","vertexCount","indexCount","stack","sin","cos","_radius","UInt16","buffer","SkyRenderer","SUNLIGHTDIRECTION","SUNLIGHTDIRCOLOR","_renderElement","_mesh","meshType","_renderData","_isAvailable","_tempMatrix1","_sunColor","setVector3","_sundir","_tempMatrix0","setTranslationVector","createOrthoOffCenter","yScale","fieldOfView","epsilon","isWebXR","_applyViewProject","applyContext","drawRenderElement","BaseCamera","SHADERDEFINE_DEPTH","SHADERDEFINE_DEPTHNORMALS","SHADERDEFINE_ORTHOGRAPHIC","SHADERDEFINE_FXAA","camerauniformMap","cameraUniformMap","CAMERAPOS","VIEWMATRIX","VIEWPROJECTMATRIX","PROJECTMATRIX","CAMERADIRECTION","CAMERAUP","VIEWPORT","PROJECTION_PARAMS","OPAQUETEXTURE","OPAQUETEXTUREPARAMS","CAMERAUNIFORMBLOCK","UBONAME_CAMERA","addShaderBlockUniform","propertyName","uniformtype","createCameraUniformBlock","CameraUBOData","uniformPara","uniformMap","forEach","key","clearColor","_clearColor","_linearClearColor","skyRenderer","_skyRenderer","_fieldOfView","_calculateProjectionMatrix","_caculateMaxLocalYRange","maxlocalYDistance","_yrange","_nearPlane","_farPlane","vaule","_orthographic","_orthographicVerticalSize","cullingMask","_cullingMask","renderingOrder","_renderingOrder","_sortCamerasByRenderingOrder","_forward","_up","_useUserProjectionMatrix","useOcclusionCulling","_renderEngine","_cameraUniformUBO","_cameraUniformData","_addCheckUBO","setUniformBuffer","halffield","dist","_onScreenSizeChanged","displayedInStage","cameraPool","_cameraPool","tempCamera","_prepareCameraToRender","getUp","shader","addLayer","removeLayer","addAllLayers","removeAllLayers","resetProjectionMatrix","_addCamera","_removeCamera","skyboxMaterial","getRes","stage","RESIZE","RENDERINGTYPE_SHADERDEFINE_FXAA","RENDERINGTYPE_DEFERREDLIGHTING","RENDERINGTYPE_FORWARDRENDERING","_invertYScaleMatrix","_invertYProjectionMatrix","_invertYProjectionViewMatrix","_tempMatrix4x40","Light","_intensity","shadowMode","_shadowMode","shadowDistance","_shadowDistance","shadowResolution","_shadowResolution","shadowDepthBias","_shadowDepthBias","shadowNormalBias","_shadowNormalBias","shadowStrength","_shadowStrength","shadowNearPlane","_shadowNearPlane","lightmapBakedType","_lightmapBakedType","premode","bakeOnly","_removeFromScene","_addToScene","lightWorldMatrix","quaterian","createAffineTransformation","ONE","_lightWoldMatrix","lightType","_lightType","_isAlternate","_intensityColor","realTime","colorData","light","maxLightCount","_lightCount","_addToLightQueue","_alternateLights","warn","_removeFromLightQueue","alternateLight","shift","ShadowUtils","init","_adjustNearPlane","_adjustFarPlane","supportShadow","getCapable","RenderCapable","RenderTextureFormat_Depth","getTemporaryShadowTexture","witdh","shadowFormat","depthFormat","DEPTH_16","bit16","bit24_8","DEPTHSTENCIL_24_8","bit32","DEPTH_32","shadowMap","compareMode","TextureCompareMode","LESS","Bilinear","getShadowBias","shadowProjectionMatrix","frustumSize","Directional","Spot","Deg2Rad","texelSize","depthBias","normalBias","SoftHigh","kernelRadius","getCameraFrustumPlanes","cameraViewProjectMatrix","frustumPlanes","Near","Far","Left","Right","Top","Bottom","getFarWithRadius","getCascadesSplitDistance","twoSplitRatio","fourSplitRatio","cameraNear","shadowFar","fov","cascadesMode","tFov","NoCascades","TwoCascades","FourCascades","applySliceTransform","shadowSliceData","atlasWidth","atlasHeight","cascadeIndex","outShadowMatrices","sliceE","oneOverAtlasWidth","oneOverAtlasHeight","resolution","getDirectionLightShadowCullPlanes","cameraFrustumPlanes","splitDistance","frustumCorners","_frustumCorners","backPlaneFaces","_backPlaneFaces","planeNeighbors","_frustumPlaneNeighbors","twoPlaneCorners","_frustumTwoPlaneCorners","edgePlanePoint2","_edgePlanePoint2","cullPlanes","splitNearDistance","splitNear","splitFar","sphereCenterZ","splitBoundSphere","backIndex","edgeIndex","backFace","neighborFaces","neighborFace","notBackFace","cullPlaneCount","getBoundSphereByFrustum","cameraPos","outBoundSphere","centerZ","k2","farSNear","farANear","getMaxTileResolutionInAtlas","tileCount","currentTileCount","getDirectionalLightMatrices","lightUp","lightSide","lightForward","shadowMatrices","boundSphere","halfShadowResolution","borderRadius","atlasBorderSize","borderDiam","sizeUnit","radiusUnit","upLen","sideLen","forwardLen","projectMatrix","viewProjectMatrix","createLookAt","_shadowMapScaleOffsetMatrix","getSpotLightShadowData","shadowSpotData","shadowParams","shadowSpotMatrices","shadowMapSize","spotWorldMatrix","cameraCullInfo","createPerspective","prepareShadowReceiverShaderValues","shadowMapWidth","shadowMapHeight","shadowSliceDatas","cascadeCount","splitBoundSpheres","matrixFloatCount","sphereFloatCount","unknown","RenderContext3D","_instance","GammaCorrect","invertY","cameraShaderValue","sceneID","tempVec4","cameraUpdateMark","replaceTag","createRenderContext3D","ScreenQuad","SCREENQUAD_POSITION_UV","TriangleStrip","DrawArray","_bufferState","_bufferStateInvertUV","_vertices","_vertexBufferInvertUV","_verticesInvertUV","Command","_screenShaderData","_screenShader","find","SCREENTEXTURE_ID","SCREENTEXTURE_NAME","SCREENTEXTUREOFFSETSCALE_ID","SCREENTEXTUREOFFSETSCALE_NAME","MAINTEXTURE_TEXELSIZE_ID","MAINTEXTURE_TEXELSIZE_NAME","_commandBuffer","run","setContext","_context","BlitScreenQuadCMD","offsetScale","screenType","_SCREENTYPE_QUAD","commandbuffer","cmd","_pool","pop","_source","_dest","_offsetScale","setshader","_shaderData","_sourceTexelSize","_transform3D","_internalRenderTexture","vpH","vpY","clientHeight","_defaultOffsetScale","blitDrawCall","_SCREENTYPE_TRIANGLE","SetRenderTargetCMD","_renderTexture","renderTexture","currentActive","SetShaderDataCMD","_nameID","_value","_dataType","nameID","shaderDataType","commandBuffer","setInt","Bool","setBool","setMatrix4x4","Texture2DArray","Texture3D","setVector2","ShaderDataType_define","defineData","BlinnPhongMaterial","Material","__initDefine__","SHADERDEFINE_DIFFUSEMAP","SHADERDEFINE_NORMALMAP","SHADERDEFINE_SPECULARMAP","SHADERDEFINE_ENABLEVERTEXCOLOR","SHADERDEFINE_ENABLETRANSMISSION","SHADERDEFINE_THICKNESSMAP","ALBEDOTEXTURE","NORMALTEXTURE","SPECULARTEXTURE","ALBEDOCOLOR","MATERIALSPECULAR","SHININESS","TILINGOFFSET","TRANSMISSIONRATE","IBACKDIFFUSE","IBACKSCALE","THINKNESSTEXTURE","TRANSMISSIONCOLOR","AlbedoIntensity","renderMode","RENDERMODE_OPAQUE","alphaTest","RENDERQUEUE_OPAQUE","depthWrite","cull","RenderState","CULL_BACK","blend","BLEND_DISABLE","depthTest","DEPTHTEST_LESS","RENDERMODE_CUTOUT","RENDERQUEUE_ALPHATEST","RENDERMODE_TRANSPARENT","RENDERQUEUE_TRANSPARENT","BLEND_ENABLE_ALL","blendSrc","BLENDPARAM_SRC_ALPHA","blendDst","BLENDPARAM_ONE_MINUS_SRC_ALPHA","enableVertexColor","hasDefine","tilingOffset","getVector4ByIndex","setVector4ByIndex","albedoColor","getColorByIndex","setColorByIndex","albedoIntensity","getFloatByIndex","setFloatByIndex","specularColor","shininess","albedoTexture","getTextureByIndex","setTextureByIndex","normalTexture","specularTexture","enableTransmission","transmissionRata","backDiffuse","backScale","thinknessTexture","transmissionColor","transmissionRate","setShaderName","destMaterial","MeshFilter","getComponent","MeshRenderer","_onMeshChange","_sharedMesh","sharedMesh","SubMeshRenderElement","_dynamicWorldPositionNormalNeedUpdate","_onWorldMatrixChanged","staticBatch","instanceSubMesh","staticBatchElementList","instanceBatchElementList","vertexBatchElementList","vertexBatchVertexDeclaration","MeshUtil","elementUsage","SHADERDEFINE_GPU_INSTANCE","_revertStaticBatchDefineUV1","morphTargetActiveCount","_morphWeightChange","_morphTargetValues","_projectionViewWorldMatrix","_createRenderElement","getMesh","filter","_getMeshDefine","_changeVertexDefine","morphTargetValues","_changeMorphTargetValue","setMorphChannelWeight","channelName","morphTargetData","channel","getMorphChannel","_applyMorphdata","morphData","channelCount","channelIndex","getMorphChannelbyIndex","lastFullWeight","targets","target","fullWeight","morphTargetWeight","_index","activeIndex","morphTargetActiveIndex","morphTargetActiveWeight","maxMorphTargetCount","_changeMorphData","maxCount","vertexDec","MESH_NORMAL0","attributeOffset","targetTexture","morphtargetChannels","targetCount","subMeshCount","defaultMaterial","worldMat","_b","_a","getFrontFaceValue","_revertBatchRenderUpdate","DrawMeshCMD","subMeshIndex","_subMeshIndex","_meshRender","_renderElemnts","sceneReflectionProb","submeshs","ClearRenderTextureCMD","_clearDepth","_backgroundColor","_linearbackgroundColor","_depth","clearDepth","backgroundColor","depth","linearBgColor","DrawRenderCMD","_elementRender","renderElements","renderelement","SetGlobalShaderDataCMD","globalShaderData","MeshInstanceGeometry","subMesh","DrawElementInstance","_subMesh","_indexStart","DrawMeshInstancedCMD","matrixs","instanceProperty","drawnums","maxInstanceCount","_matrixs","_instanceProperty","_drawnums","_updateWorldMatrixBuffer","_setInstanceBuffer","_instanceRenderElementArray","_instanceGeometryArray","_instanceWorldMatrixData","_instanceWorldMatrixBuffer","instanceWorldMatrixDeclaration","instanceBuffer","_instanceBufferState","instanceBufferState","vertexArray","_vertexBuffers","propertyMap","_propertyMap","_indexBuffer","worldMatrixData","worldBuffer","orphanStorage","setWorldMatrix","worldMatrixArray","setDrawNums","drawNums","updateVertexBufferData","CommandBuffer","shadowCaster","_shadow","_commands","_name","casterShadow","_apply","cmdDrawCall","_applyOne","getCommandsSize","setShaderDataTexture","setGlobalTexture","setShaderDataColor","setGlobalColor","setShaderDataVector","setGlobalVector","setShaderDataVector3","setGlobalVector3","setShaderDataVector2","setGlobalVector2","setShaderDataNumber","setGlobalNumber","setShaderDataInt","setGlobalInt","setShaderDataMatrix","setShaderDefine","define","setGlobalMatrix","blitScreenQuad","blitScreenQuadByMaterial","blitScreenTriangle","setRenderTarget","clearRenderTarget","drawMesh","submeshIndex","drawRender","drawMeshInstance","DrawElement_Instance","drawMeshInstancedCMD","addCustomCMD","command","clear","PhysicsSettings","flags","maxSubSteps","fixedTimeStep","enableCCD","ccdThreshold","ccdSphereRadius","LightQueue","getBrightestLight","maxIntIndex","maxIntensity","normalLightOrdering","brightestIndex","firstLight","AlternateLightQueue","Lightmap","ApplyLightmapEvent","Scene3DShaderDeclaration","BoundSphere","_center","toDefault","createFromSubPoints","points","upperEnd","_tempVector3","outCenter","createfromPoints","intersectsRayDistance","intersectsRayPoint","outPoint","ShadowSliceData","ShadowSpotData","createCameraCullInfo","FrustumCulling","_cameraCullInfo","_shadowCullInfo","createShadowCullInfo","cullingRenderBounds","cullInfo","cullingRenderBoundsState","nn","ShadowCasterPass","_frustumPlanes","SHADOW_LIGHT_DIRECTION","SHADOW_SPLIT_SPHERES","SHADOW_MATRICES","SHADOW_MAP_SIZE","SHADOW_MAP","SHADOW_PARAMS","SHADOW_SPOTMAP_SIZE","SHADOW_SPOTMAP","SHADOW_SPOTMATRICES","sceneUniformMap","_shadowBias","_shadowParams","_shadowMapSize","_shadowSpotMapSize","_shadowMatrices","_shadowSpotMatrices","_splitBoundSpheres","_maxCascades","_cascadeCount","_shadowMapWidth","_shadowMapHeight","_shadowSliceDatas","_shadowSpotData","_lightUp","_lightSide","_lightForward","_castDepthBufferData","_castDepthBufferOBJ","_castDepthCameraBufferData","_castDepthCameraBufferOBJ","_setupShadowCasterShaderValues","LightParam","shadowparams","shadowBias","cameraSV","projectionViewMatrix","_setupShadowReceiverShaderValues","_light","shadowCascadesMode","SHADERDEFINE_SHADOW_CASCADE","Hard","SHADERDEFINE_SHADOW_SOFT_SHADOW_LOW","SHADERDEFINE_SHADOW_SOFT_SHADOW_HIGH","SoftLow","_shadowDirectLightMap","_setupSpotShadowReceiverShaderValues","SHADERDEFINE_SHADOW_SPOT_SOFT_SHADOW_HIGH","SHADERDEFINE_SHADOW_SPOT_SOFT_SHADOW_LOW","_shadowSpotLightMap","DirectionLight","lightWorldE","lightWorld","createFromQuaternion","cascadesCount","shadowTileResolution","atlasResolution","_shadowCascadesMode","_cascadesSplitDistance","boundSpheres","_shadowTwoCascadeSplits","_shadowFourCascadeSplits","sliceData","SpotLight","PointLight","shadowCullInfo","cullSphere","_directLightShadowCull","_tempVector4","_applyCasterPassCommandBuffer","spotlight","_sportLightShadowCull","BlitFrameBufferCMD","shaderdata","_texture_size","vph","SceneRenderManager","_sceneManagerOBJ","createSceneRenderManager","list","addRenderObject","object","updateMotionObjects","UI3DManager","_UI3Dlist","_submitRT","rayCast","rayOri","clean","sort","_getCameraDistance","hit","_checkUIPos","destory","BVHSpatialManager","cellCount","bvhManager","updateBVHBoxList","BVHSpatialConfig","max_SpatialCount","limit_size","Min_BVH_Build_Nums","BVHSpatialBox","sciContainsBox","_tempV3","_tempV3_2","sciIntersectsBox","bvhmanager","config","MAX_VALUE","_cellList","_cellCount","_bvhmanager","_config","_isRepeat","cell","_addOneCell","_removeOneCell","delete","_clearList","_isFloatMax","_isBoundsContainedBySpatialBox","cellMin","cellMax","_addBounds","_boundchanged","_removeBounds","getList","getchild0","_children0","getchild1","_children1","fillCell","fillRemove","addCell","removeCell","splitBox","isContentBox","_creatChildNode","getNearlist","checkPos","traverseBoundsCell","conditionalFun","getItemByCameraCullInfo","frustum","getItemByFrustum","getItemBySCI","sci","recaculateBox","error","isRoot","BVHSpatial","_BVHManager","_BVHConfig","bvhConfig","_isBuild","_BVHSpatialBox","bvhSpatialBox","cellLegal","extend","addOne","spatial","removeOne","has","get","motionOne","rebuild","BVHRenderBox","frustumCulling","cullMask","BVHRenderSpatial","BVHSceneRenderManager","_bvhRenderSpatial","_allRenderList","bvhSpatial","otherList","CullPassBase","_cullList","FastSinglelist","cullList","cullDistanceVolume","bound","exten","dis","cullByCameraCullInfo","renderManager","cullByShadowCullInfo","renderList","cullingSpotShadow","BVHCullPass","PostProcessRenderContext","indirectTarget","destination","compositeShaderData","deferredReleaseTextures","createRTByContextReleaseTexture","mipmap","multiSamples","sRGB","rt","depthStencilFormat","_generateMipmap","generateDepthTexture","_gammaSpace","_inPool","PostProcessEffect","_active","_singleton","singleton","getCameraDepthTextureModeFlag","effectInit","postprocess","release","ToneMappingType","PBRRenderQuality","BlitScreenVS","ColorGradEffect","attributeMap","a_PositionTexcoord","u_OffsetScale","u_MainTex","u_MainTex_TexelSize","shaderType","ShaderFeatureType","PostProcess","SubShader","addSubShader","addShaderPass","BlitVS","renderState","DEPTHTEST_ALWAYS","CULL_NONE","SHADERDEFINE_ACES","SHADERDEFINE_CUSTOMLUT","SHADERVALUE_LUT","SHADERVALUE_LUTPARAMS","SHADERVALUE_CUSTOMLUT","SHADERVALUE_CUSTOMLUTPARAMS","toneMapping","_toneMapping","_needBuildLUT","enableSplitTone","_enableSplitTone","splitShadow","_splitShadow","splithighlights","_splithighlights","equal","splitBalance","_splitBalance","enableSMH","_enableSMH","shadows","_shadows","midtones","_midtones","highlights","_highlights","shadowLimitStart","_limits","shadowLimitEnd","highLightLimitStart","highLightLimitEnd","enableLiftGammaGain","_enableLiftGammaGain","lift","_lift","gamma","_gamma","gain","_gain","_StandardIlluminantY","_CIExyToLMS","X","Z","L","M","S","_ColorBalanceToLMSCoeffs","temperature","tint","w1","_balance","enableBalance","_enableBalance","_tint","_temperature","enableColorAdjust","_enableColorAdjust","postExposure","_postExposure","contrast","_contrast","colorFilter","_colorFilter","HueShift","_HueShift","saturation","_saturation","_lutBuilderMat","_lutSize","_u_SplitShadow","_HueSatCon","default_balance","default_splitShadow","default_splithighlights","default_shadow","default_midtones","default_highlight","default_limint","default_lift","default_gamma","default_gain","default_ColorFilter","default_HueSatCon","_blitlutParams","_lutShaderData","lutSize","_lutCommond","_lutTex","_buildLUT","lutHeight","lutWidth","lutParams","setVector4","ACES","whiteTexture","_LUTShader","_enableColorGrad","_ColorGradEffect","SHADERDEFINE_BLOOM_LOW","SHADERDEFINE_BLOOM","SHADERDEFINE_FINALPASS","SHADERVALUE_MAINTEX","SHADERVALUE_BLOOMTEX","SHADERVALUE_AUTOEXPOSURETEX","SHADERVALUE_BLOOM_DIRTTEX","SHADERVALUE_BLOOMTEX_TEXELSIZE","SHADERVALUE_BLOOM_DIRTTILEOFFSET","SHADERVALUE_BLOOM_SETTINGS","SHADERVALUE_BLOOM_COLOR","recaculateCameraFlag","_depthtextureFlag","effects","_compositeShader","_compositeShaderData","_effects","_enable","enable","commandContext","oriContext","clearEffect","addEffect","cameraDepthTextureMode","_init","cameraTarget","screenTexture","_getRenderTextureFormat","Indirect","clearDefine","offScreenTex","_offScreenRenderTexture","canvasWidth","_getCanvasWidth","canvasHeight","_getCanvasHeight","_screenOffsetScale","tempRenderTextures","effect","getEffect","classReg","removeEffect","_applyPostProcessCommandBuffers","PBRDefaultDFG","defaultDFG","_defaultDFG","DefaultDfgTexture","tex","hdrBuffer","Base64Tool","decode","hdrInfo","HDRTextureInfo","getHDRInfo","supportFloatTex","TextureFormat_R32G32B32A32","supportFloatLinearFiltering","Texture_FloatLinearFiltering","setHDRData","pixelCount","hdrPixelData","readScanLine","rgbdPixelData","maxRGB","PBRShaderLib","DEFINE_EMISSION","DEFINE_CLEARCOAT","DEFINE_CLEARCOAT_NORMAL","DEFINE_ANISOTROPY","DEFINE_IOR","DEFINE_IRIDESCENCE","DEFINE_SHEEN","DEFINE_TRANSMISSION","DEFINE_THICKNESS","addInclude","regIncludeBindUnifrom","u_IBLDFG","PBRRenderMode","PBRMetallicSmoothnessSource","ParticleSystemShapeType","TrailAlignment","EPhysicsCapable","PBRMaterial","SHADERDEFINE_ALBEDOTEXTURE","SHADERDEFINE_NORMALTEXTURE","SHADERDEFINE_PARALLAXTEXTURE","SHADERDEFINE_OCCLUSIONTEXTURE","SHADERDEFINE_EMISSIONTEXTURE","SHADERDEFINE_TRANSPARENTBLEND","SHADERDEFINE_LAYA_PBR_BRDF_HIGH","SHADERDEFINE_LAYA_PBR_BRDF_LOW","SHADERDEFINE_DETAILALBEDO","SHADERDEFINE_DETAILNORMAL","NORMALSCALE","SMOOTHNESS","OCCLUSIONTEXTURE","OCCLUSIONSTRENGTH","PARALLAXTEXTURE","PARALLAXSCALE","EMISSIONTEXTURE","EMISSIONCOLOR","EMISSIONIntensity","DETAILALBEDOTEXTURE","DETAILNORMALTEXTURE","DETAILTILLINGOFFSET","DETAILNORMALSCALE","CLEARCOAT","SHADERDEFINE_CLEARCOATTEXTURE","CLEARCOATTEXTURE","CLEARCOATROUGHNESS","SHADERDEFINE_CLEARCOATROUGHNESSTEXTURE","CLEARCOATROUGHNESSTEXTURE","CLEARCOATNORMALTEXTURE","ANISOTROPY","SHADERDEFINE_ANISOTROPYTEXTURE","ANISOTROPYTEXTURE","ANISOTROPYROTATION","getColor","getTexture","normalTextureScale","getNumber","parallaxTexture","parallaxTextureScale","occlusionTexture","occlusionTextureStrength","smoothness","enableEmission","emissionColor","emissionIntensity","emissionTexture","getVector","detailAlbedoTexture","detailNormalTexture","detailTilingOffset","detailNormalScale","Opaque","Cutout","Fade","Transparent","BLENDPARAM_ONE","anisotropyEnable","anisotropy","anisotropyTexture","anisotropyRotation","clearCoatEnable","clearCoat","clearCoatTexture","clearCoatRoughness","clearCoatRoughnessTexture","clearCoatNormalTexture","ALPHATESTVALUE","smoothnessTextureScale","renderQuality","High","PBRStandardMaterial","SHADERDEFINE_METALLICGLOSSTEXTURE","SHADERDEFINE_SMOOTHNESSSOURCE_ALBEDOTEXTURE_ALPHA","METALLICGLOSSTEXTURE","METALLIC","metallicGlossTexture","metallic","smoothnessSource","_smoothnessSource","SkyBoxMaterial","TINTCOLOR","EXPOSURE","ROTATION","TEXTURECUBE","tintColor","exposure","textureCube","SkyProceduralMaterial","SHADERDEFINE_SUN_HIGH_QUALITY","SHADERDEFINE_SUN_SIMPLE","SUNSIZE","SUNSIZECONVERGENCE","ATMOSPHERETHICKNESS","SKYTINT","GROUNDTINT","sunDisk","_sunDisk","SUN_HIGH_QUALITY","SUN_SIMPLE","SUN_NODE","sunSize","sunSizeConvergence","atmosphereThickness","skyTint","groundTint","UnlitMaterial","_albedoIntensity","RENDERMODE_ADDTIVE","MeshSprite3D","meshFilter","_meshFilter","meshRenderer","addComponent","lightmapScaleOffsetArray","meshPath","enableRender","receiveShadows","materialCount","GradientMode","Blend","Fixed","Gradient","rgbElements","_colorRGBKeysCount","__rgbElements","_rgbElements","alphaElements","_colorAlphaKeysCount","__alphaElements","_alphaElements","_mode","colorRGBKeysCount","colorAlphaKeysCount","maxColorRGBKeysCount","_maxColorRGBKeysCount","maxColorAlphaKeysCount","_maxColorAlphaKeysCount","maxColorRGBKeyCount","maxColorAlphaKeyCount","_keyRanges","addColorRGB","addColorAlpha","updateColorRGB","updateColorAlpha","evaluateColorRGB","lerpFactor","startSearchIndex","reverseSearch","curIndex","diff","evaluateColorAlpha","outColor","destGradientDataColor","destAlphaElements","destRGBElements","Burst","_time","minCount","_minCount","_maxCount","destBurst","GradientColor","createByConstant","constant","gradientColor","_constant","createByGradient","gradient","_gradient","createByRandomTwoConstant","minConstant","maxConstant","_constantMin","_constantMax","createByRandomTwoGradient","minGradient","maxGradient","_gradientMin","_gradientMax","constantMin","constantMax","gradientMin","gradientMax","destGradientColor","ColorOverLifetime","_color","destColorOverLifetime","destColor","FrameOverTime","rotationOverLifetime","createByOverTime","overTime","_overTime","createByRandomTwoOverTime","gradientFrameMin","gradientFrameMax","_overTimeMin","_overTimeMax","frameOverTimeData","frameOverTimeDataMin","frameOverTimeDataMax","destFrameOverTime","GradientAngularVelocity","gradientAngularVelocity","_separateAxes","createByConstantSeparate","separateConstant","_constantSeparate","createByGradientSeparate","gradientX","gradientY","gradientZ","_gradientX","_gradientY","_gradientZ","createByRandomTwoConstantSeparate","separateConstantMin","separateConstantMax","_constantMinSeparate","_constantMaxSeparate","createByRandomTwoGradientSeparate","gradientXMin","gradientXMax","gradientYMin","gradientYMax","gradientZMin","gradientZMax","gradientWMin","gradientWMax","_gradientXMin","_gradientXMax","_gradientYMin","_gradientYMax","_gradientZMin","_gradientZMax","_gradientWMin","_gradientWMax","separateAxes","constantSeparate","gradientW","_gradientW","constantMinSeparate","constantMaxSeparate","destGradientAngularVelocity","GradientDataInt","gradientCount","_currentLength","_formatData","log","destGradientDataInt","destElements","GradientDataNumber","getKeyByIndex","getValueByIndex","getAverageValue","total","subValue","destGradientDataNumber","GradientSize","gradientSize","getMaxSizeInGradient","meshMode","maxSize","destGradientSize","GradientVelocity","gradientVelocity","destGradientVelocity","RotationOverLifetime","angularVelocity","_angularVelocity","destRotationOverLifetime","destAngularVelocity","BoundBox","matElements","setCenterAndExtent","tranform","transformCoordinate","BaseShape","randomDirection","_getShapeBoundBox","_getSpeedBoundBox","generatePositionAndDirection","rand","randomSeeds","_calculateProceduralBounds","emitterPosScale","minMaxBounds","speedBounds","maxSpeedBound","maxSpeedMin","maxSpeedMax","minSpeedBound","minSpeedMin","minSpeedMax","destShape","ShapeUtils","_randomPointUnitArcCircle","arc","getFloat","random","_randomPointInsideUnitArcCircle","_randomPointUnitCircle","_randomPointInsideUnitCircle","_randomPointUnitSphere","_randomPointInsideUnitSphere","_randomPointInsideHalfUnitBox","BoxShape","shapeType","Box","seed","CircleShape","Circle","emitFromEdge","arcDEG","deg","positionPoint","_tempPositionPoint","ConeShape","Cone","emitType","angleDEG","coneRadius2","coneLength","sinA","positionX","positionY","directionPointE","positionPointE","dirCosA","dirSinA","_tempDirectionPoint","HemisphereShape","Hemisphere","emitFromShell","SphereShape","Sphere","SizeOverLifetime","_size","destSizeOverLifetime","destSize","StartFrame","destStartFrame","TextureSheetAnimation","_frame","startFrame","_startFrame","randomRow","rowIndex","cycles","enableUVChannels","tiles","destTextureSheetAnimation","destFrame","VelocityOverLifetime","velocity","_velocity","space","destVelocityOverLifetime","destVelocity","VertexShuriKenParticle","PARTICLE_DIRECTIONTIME","PARTICLE_POSITION0","PARTICLE_COLOR0","PARTICLE_TEXTURECOORDINATE0","PARTICLE_SHAPEPOSITIONSTARTLIFETIME","PARTICLE_CORNERTEXTURECOORDINATE0","PARTICLE_STARTCOLOR0","PARTICLE_ENDCOLOR0","PARTICLE_STARTSIZE","PARTICLE_STARTROTATION","PARTICLE_STARTSPEED","PARTICLE_RANDOM0","PARTICLE_RANDOM1","PARTICLE_SIMULATIONWORLDPOSTION","PARTICLE_SIMULATIONWORLDROTATION","PARTICLE_SIMULATIONUV","VertexShurikenParticleBillboard","vertexInstanceMeshDeclaration","_vertexInstanceMeshDeclaration","vertexInstanceParticleDeclaration","_vertexInstanceParticleDeclaration","billboardVertexArray","_billboardVertexArray","billboardIndexArray","_billboardIndexArray","Single","cornerTextureCoordinate","_cornerTextureCoordinate","positionStartLifeTime","_positionStartLifeTime","startColor","_startColor","startSize","_startSize","startRotation0","_startRotation0","startRotation1","_startRotation1","startRotation2","_startRotation2","startLifeTime","_startLifeTime","startSpeed","_startSpeed","random0","_randoms0","random1","_randoms1","simulationWorldPostion","_simulationWorldPostion","ageAddScale","randoms0","randoms1","VertexShurikenParticleMesh","Rand","getFloatFromInt","getByteFromInt","seeds","_temp","Uint32Array","getUint","getSignedFloat","Emission","emissionRate","_emissionRate","emissionRateOverDistance","_emissionRateOverDistance","_bursts","getBurstsCount","getBurstByIndex","addBurst","burst","burstsCount","removeBurst","removeBurstByIndex","clearBurst","destEmission","destBursts","ShuriKenParticle3DShaderDeclaration","SHADERDEFINE_RENDERMODE_BILLBOARD","SHADERDEFINE_RENDERMODE_STRETCHEDBILLBOARD","SHADERDEFINE_RENDERMODE_HORIZONTALBILLBOARD","SHADERDEFINE_RENDERMODE_VERTICALBILLBOARD","SHADERDEFINE_COLORKEYCOUNT_8","SHADERDEFINE_COLOROVERLIFETIME","SHADERDEFINE_RANDOMCOLOROVERLIFETIME","SHADERDEFINE_VELOCITYOVERLIFETIMECONSTANT","SHADERDEFINE_VELOCITYOVERLIFETIMECURVE","SHADERDEFINE_VELOCITYOVERLIFETIMERANDOMCONSTANT","SHADERDEFINE_VELOCITYOVERLIFETIMERANDOMCURVE","SHADERDEFINE_TEXTURESHEETANIMATIONCURVE","SHADERDEFINE_TEXTURESHEETANIMATIONRANDOMCURVE","SHADERDEFINE_ROTATIONOVERLIFETIME","SHADERDEFINE_ROTATIONOVERLIFETIMESEPERATE","SHADERDEFINE_ROTATIONOVERLIFETIMECONSTANT","SHADERDEFINE_ROTATIONOVERLIFETIMECURVE","SHADERDEFINE_ROTATIONOVERLIFETIMERANDOMCONSTANTS","SHADERDEFINE_ROTATIONOVERLIFETIMERANDOMCURVES","SHADERDEFINE_SIZEOVERLIFETIMECURVE","SHADERDEFINE_SIZEOVERLIFETIMECURVESEPERATE","SHADERDEFINE_SIZEOVERLIFETIMERANDOMCURVES","SHADERDEFINE_SIZEOVERLIFETIMERANDOMCURVESSEPERATE","SHADERDEFINE_RENDERMODE_MESH","SHADERDEFINE_SHAPE","WORLDPOSITION","WORLDROTATION","POSITIONSCALE","SIZESCALE","SCALINGMODE","GRAVITY","THREEDSTARTROTATION","STRETCHEDBILLBOARDLENGTHSCALE","STRETCHEDBILLBOARDSPEEDSCALE","SIMULATIONSPACE","CURRENTTIME","DRAG","VOLVELOCITYCONST","VOLVELOCITYGRADIENTX","VOLVELOCITYGRADIENTY","VOLVELOCITYGRADIENTZ","VOLVELOCITYCONSTMAX","VOLVELOCITYGRADIENTXMAX","VOLVELOCITYGRADIENTYMAX","VOLVELOCITYGRADIENTZMAX","VOLSPACETYPE","COLOROVERLIFEGRADIENTALPHAS","COLOROVERLIFEGRADIENTCOLORS","COLOROVERLIFEGRADIENTRANGES","MAXCOLOROVERLIFEGRADIENTALPHAS","MAXCOLOROVERLIFEGRADIENTCOLORS","MAXCOLOROVERLIFEGRADIENTRANGES","SOLSIZEGRADIENT","SOLSIZEGRADIENTX","SOLSIZEGRADIENTY","SOLSizeGradientZ","SOLSizeGradientMax","SOLSIZEGRADIENTXMAX","SOLSIZEGRADIENTYMAX","SOLSizeGradientZMAX","ROLANGULARVELOCITYCONST","ROLANGULARVELOCITYCONSTSEPRARATE","ROLANGULARVELOCITYGRADIENT","ROLANGULARVELOCITYGRADIENTX","ROLANGULARVELOCITYGRADIENTY","ROLANGULARVELOCITYGRADIENTZ","ROLANGULARVELOCITYCONSTMAX","ROLANGULARVELOCITYCONSTMAXSEPRARATE","ROLANGULARVELOCITYGRADIENTMAX","ROLANGULARVELOCITYGRADIENTXMAX","ROLANGULARVELOCITYGRADIENTYMAX","ROLANGULARVELOCITYGRADIENTZMAX","ROLANGULARVELOCITYGRADIENTWMAX","TEXTURESHEETANIMATIONCYCLES","TEXTURESHEETANIMATIONSUBUVLENGTH","TEXTURESHEETANIMATIONGRADIENTUVS","TEXTURESHEETANIMATIONGRADIENTMAXUVS","ShurikenParticleData","_getStartLifetimeFromGradient","startLifeTimeGradient","emissionTime","lastKey","age","MathUtil","lerp","_randomInvertRoationArray","rotatonE","randomizeRotationDirection","randDic","_randomInvertRoation","rotaton","particleSystem","particleRender","autoRandomSeed","_rand","_randomSeeds","startColorType","constantStartColor","startColorConstant","startColorConstantMin","startColorConstantMax","colorOverLifetime","colorRandom","minConstantColor","maxConstantColor","particleSize","startSizeType","threeDStartSize","startSizeConstantSeparate","startSizeConstant","startSizeConstantMinSeparate","startSizeConstantMaxSeparate","startSizeConstantMin","startSizeConstantMax","sizeOverLifetime","randomSize","startRotationType","threeDStartRotation","startRotationConstantSeparate","randomRotationE","startRotation","startRotationConstant","startRotationConstantMinSeparate","startRotationConstantMaxSeparate","lerpRoationE","startRotationConstantMin","startRotationConstantMax","startLifetimeType","startLifetimeConstant","startLifetimeConstantMin","startLifetimeConstantMax","startLifeTimeGradientMin","startLifeTimeGradientMax","textureSheetAnimation","startFrameCount","title","titleX","titleY","subU","subV","startRow","startCol","startUVInfo","ShurikenParticleSystem","maxParticles","_bufferMaxParticles","newMaxParticles","_initBufferDatas","_updateParticlesSimulationRestart","emission","_emission","aliveParticleCount","_firstNewElement","_firstRetiredElement","_emissionTime","shape","_shape","_ownerRender","isAlive","_isPlaying","isEmitting","_isEmitting","isPlaying","isPaused","_isPaused","_startLifetimeType","_maxStartLifetime","_startLifetimeConstant","_startLifeTimeGradient","_startLifetimeConstantMin","_startLifetimeConstantMax","_startLifeTimeGradientMin","_startLifeTimeGradientMax","velocityOverLifetime","_velocityOverLifetime","shaDat","velocityType","_colorOverLifetime","ranges","colorKey","alphaKey","minGradientColor","maxGradientColor","minalphaElements","minrgbElements","maxalphaElements","maxrgbElements","minRanges","maxRanges","_sizeOverLifetime","sizeSeparate","sizeType","_rotationOverLifetime","rotationSeparate","rotationType","_textureSheetAnimation","frameOverTime","textureAniType","_uvLengthE","_uvLength","meshTopology","_gravityOffset","_customBounds","_useCustomBounds","_owner","_floatCountPerVertex","_startLifeTimeIndex","_timeIndex","_simulationUV_Index","_simulateUpdate","_firstActiveElement","_firstFreeElement","_drawCounter","_playStartDelay","_frameRateTime","_totalDelayTime","_emissionDistance","_emissionLastPosition","_burstsIndex","_vertexStride","_indexStride","_updateMask","_currentTime","_startUpdateLoopCount","looping","prewarm","startDelayType","startDelay","startDelayMin","startDelayMax","startSpeedType","startSpeedConstant","startSpeedConstantMin","startSpeedConstantMax","dragType","dragConstant","dragSpeedConstantMin","dragSpeedConstantMax","gravityModifier","simulationSpace","simulationSpeed","scaleMode","playOnAwake","randomSeed","isPerformanceMode","_RANDOMOFFSET","_getVertexBuffer","_getIndexBuffer","_generateBounds","speedOrigan","maxSizeScale","zDirectionSpeed","fDirectionSpeed","zEmisionOffsetXYZ","fEmisionOffsetXYZ","hemiShpere","cone","sinAngle","tanAngle","rPLCT","circle","meshSize","halfKSqrtOf2","meshBounds","endSizeOffset","offsetSize","speedZOffset","speedFOffset","velocitySpeedOffset","curveX","curveY","curveZ","gravity","gravityOffset","speedZOffsetY","speedFOffsetY","customBounds","_simulationSupported","_updateEmission","elapsedTime","loopCount","timer","_delta","_maxElapsedTime","_updateParticles","_retireActiveParticles","_freeRetiredParticles","_advanceTime","_advanceDistance","delayTime","timeIndex","_burst","fromTime","toTime","totalEmitCount","bursts","emitCount","burstTime","emitTime","lastEmissionTime","emit","stop","minEmissionTime","offsetDistance","rateOverDistance","memorySize","_byteLength","_addMemory","indexOffset","perPartOffset","vbMemorySize","getVertexElementByUsage","_vertexCount","totalVertexCount","lastVBVertexCount","indexDatas","indexValueOffset","firstVertex","secondVertex","_tempPosition","_tempDirection","addParticle","nextFreeParticle","randomVelocityX","randomVelocityY","randomVelocityZ","randomColor","randomRotation","randomTextureAnimation","needRandomVelocity","needRandomColor","needRandomSize","needRandomRotation","needRandomTextureAnimation","meshVertices","meshVertexStride","meshPosOffset","meshCorOffset","meshUVOffset","meshVertexIndex","startIndex","startU","startV","meshVB","getFloat32Data","meshVertexDeclaration","_offset","colorElement","uvElement","vertexOffset","meshOffset","addNewParticlesToVertexBuffer","byteStride","play","pause","simulate","restart","ShurikenParticleInstanceSystem","_instanceParticleVertexBuffer","_instanceVertex","_initMeshVertex","vertex","meshVertexBuffer","meshColorOffset","perParticleDataCount","positionOffset","colorOffset","uvOffset","meshDeclaration","particleDeclaration","_meshIndexCount","_floatCountPerParticleData","meshVertexCount","vbSize","meshVertex","particleVbSize","billboardDeclaration","indexArray","meshVBSize","firstActive","activeStart","_meshFloatCountPreVertex","ShurikenParticleRenderer","_particleSystem","_renderMode","parSys","_finalGravity","_dragConstant","stretchedBillboardCameraSpeedScale","stretchedBillboardSpeedScale","stretchedBillboardLengthScale","particleRenderNode","enableParticle","transfrom","sv","getWorldLossyScale","parRender","ShuriKenParticle3D","particleRenderer","_parseModule","module","moduleData","bases","vector2s","vec2","vec2Data","vector3s","vec3","vec3Data","vector4s","vec4","vec4Data","gradientDataNumbers","gradientNumber","gradientNumberData","valueData","resources","Texture","bitmap","burstsData","brust","main","shapeData","velocityOverLifetimeData","velocityData","constantData","_initParticleVelocity","constantMinData","constantMaxData","colorOverLifetimeData","maxKeyCount","constColorData","_initParticleColor","minConstColorData","maxConstColorData","sizeOverLifetimeData","sizeData","_initParticleSize","constantMinSeparateData","constantMaxSeparateData","rotationOverLifetimeData","angularVelocityData","conSep","_initParticleRotation","minSep","maxSep","textureSheetAnimationData","_initParticleFrame","overTimeMin","overTimeMax","startFrameData","_parseOld","anglelToRad","materialData","_initStartLife","startLifetimeGradient","startLifetimeGradientMin","startLifetimeGradientMax","startSizeConstantSeparateArray","startSizeConstantSeparateElement","startSizeConstantMinSeparateArray","startSizeConstantMinSeparateElement","startSizeConstantMaxSeparateArray","startSizeConstantMaxSeparateElement","startRotationConstantSeparateArray","startRotationConstantSeparateElement","startRotationConstantMinSeparateArray","startRotationConstantMinSeparateElement","startRotationConstantMaxSeparateArray","startRotationConstantMaxSeparateElement","startColorConstantArray","startColorConstantElement","startColorConstantMinArray","startColorConstantMinElement","startColorConstantMaxArray","startColorConstantMaxElement","emissionData","sphereShape","sphereRadius","sphereEmitFromShell","sphereRandomDirection","hemiSphereShape","hemiSphereRadius","hemiSphereEmitFromShell","hemiSphereRandomDirection","coneShape","coneAngle","coneRadius","coneEmitType","coneRandomDirection","boxShape","boxX","boxY","boxZ","boxRandomDirection","circleShape","circleRadius","circleArc","circleEmitFromEdge","circleRandomDirection","tempShape","tilesData","gradientColorData","maxkeyCount","alphasData","alphas","alphaData","rgbsData","rgbs","rgbData","rgbValue","overTimeFramesData","overTimeFrame","framesData","frames","gradientData","startLifetimesData","startLifetimes","velocitysData","velocitys","gradientSizeData","sizesData","sizes","angularVelocitysData","angularVelocitys","ShurikenParticleMaterial","SHADERDEFINE_TINTCOLOR","SHADERDEFINE_ADDTIVEFOG","DIFFUSETEXTURE","RENDERMODE_ALPHABLENDED","tilingOffsetX","_MainTex_STX","tilingOffsetY","_MainTex_STY","tilingOffsetZ","_MainTex_STZ","tilingOffsetW","_MainTex_STW","_TintColor","_TintColorR","_TintColorG","_TintColorB","_TintColorA","_MainTex_ST","tilOff","colorR","colorG","colorB","colorA","PixelLineVertex","Transform3D","EventDispatcher","isDefaultMatrix","_getTransformFlag","TRANSFORM_LOCALMATRIX","localMatrix","_isDefaultMatrix","TRANSFORM_WORLDSCALE","isInvert","_faceInvert","_frontFaceValue","worldNeedUpdate","TRANSFORM_WORLDMATRIX","localPositionX","_localPosition","localPositionY","localPositionZ","_setTransformFlag","_onWorldPositionTransform","localRotationX","localRotationY","localRotationZ","localRotationW","TRANSFORM_LOCALQUATERNION","eulerE","_localRotationEuler","createFromYawPitchRoll","_angleToRandin","_localRotation","TRANSFORM_LOCALEULER","_onWorldRotationTransform","localScaleX","_localScale","localScaleY","localScaleZ","_onWorldScaleTransform","localRotationEulerX","localRotationEulerY","localRotationEulerZ","getYawPitchRoll","euler","_localMatrix","isIdentity","decomposeTransRotScale","TRANSFORM_WORLDPOSITION","worldMatE","parentInvMat","TRANSFORM_WORLDQUATERNION","_rotation","TRANSFORM_WORLDEULER","rotationEulerE","_rotationEuler","effectiveTrans","_worldMatrix","_scale","_transformFlag","_getScaleMatrix","invRotation","invRotationMat","_tempMatrix3x30","worldRotScaMat","_tempMatrix3x31","scaMat","_tempMatrix3x32","Matrix3x3","createFromMatrix4x4","createRotationQuaternion","parentChilds","_onWorldPositionRotationTransform","_onWorldPositionScaleTransform","translate","translation","isLocal","rotate","isRadian","worldMatElem","up","getRight","lookAt","isCamera","eye","rotationLookAt","worldPosition","objLookat","scaMatE","setWorldLossyScale","scaleMat","_tempMatrix3x33","localScaleMat","localScaleMatE","parInvScaleMat","createFromScaling","localToGlobal","globalToLocal","toLocalNormal","TransformNormal","toDir","rotationTo","Up","UnitX","tmpVec3","UnitY","createFromAxisAngle","SkinnedMeshSprite3DShaderDeclaration","SkinRenderElement","setSkinData","skinnedData","createSkinRenderElement","SkinnedMeshRenderer","localBounds","_localBounds","rootBone","_cacheRootBone","_bones","_inverseBindPosesBufferForNative","_skinnedMatrixCachesBufferForNative","_bonesTransformForNative","SHADERDEFINE_BONE","_computeSkinnedData","_cacheMesh","bindPoses","_inverseBindPoses","pathMarks","_skinnedMatrixCaches","subMeshBoneIndices","_boneIndicesList","subData","_skinnedData","boneIndices","_computeSubSkinnedData","matrixCaches","q","_skinnedDataLoopMarks","preData","batchIndex","srcIndex","batchBoneIndex","dstIndex","bone","_computeSkinnedDataForNative","Int32Array","_nativeObj","conch","computeSubSkinnedDataForNative","enableSkin","_onSkinMeshChange","subBoneIndices","subCount","skinRenderNode","DEFAULT","cloneHierachFun","rootNode","rootCheckNode","destNode","rootparent","nodeArray","checkNode","getCommomParent","pathcheck","destParent","destBone","ceckNode","lbb","SkinnedMeshSprite3D","SHADERDEFINE_SIMPLEBONE","BONES","skinnedMeshRenderer","enabled","rootBoneData","bonesData","_tempArray0","TrailMaterial","MAINTEXTURE","SHADERDEFINE_MAINTEXTURE","materialRenderMode","MaterialRenderMode","TrailTextureMode","Stretch","Tile","VertexTrail","vertexDeclaration1","_vertexDeclaration1","vertexDeclaration2","_vertexDeclaration2","TRAIL_POSITION0","TRAIL_OFFSETVECTOR","TRAIL_TIME0","TRAIL_TEXTURECOORDINATE0Y","TRAIL_TEXTURECOORDINATE0X","TRAIL_COLOR","TrailGeometry","_floatCountPerVertices1","_floatCountPerVertices2","_increaseSegementCount","_activeIndex","_endIndex","_needAddFirstVertex","_isTempEndVertex","_vertices1","_vertices2","_lastFixedVertexPosition","tmpColor","_disappearBoundsMode","_segementCount","_resizeData","segementCount","_subBirthTime","_subDistance","Float64Array","vertexBuffers","vertexbuffer1Size","vertexbuffer2Size","_vertexBuffer1","_vertexBuffer2","_resetData","oldVertices1","oldVertices2","oldSubDistance","oldSubBirthTime","_updateTrail","lastPosition","equals","_addTrailByFirstPosition","_addTrailByNextPosition","_curtime","delVector3","pointAtoBVector3","alignment","View","cameraMatrix","TransformZ","widthMultiplier","tempEndIndex","delLength","_updateVerticesByPositionData","minVertexDistance","_updateVerticesByPosition","_totalLength","curtime","down","floatCount","delDistance","_updateVertexBufferUV","sprite3dPosition","curLength","colorGradient","startAlphaIndex","startColorIndex","totalLength","stride","uvX","textureMode","posOffset","side","_updateDisappear","nextIndex","fixedPos","ALIGNMENT_VIEW","ALIGNMENT_TRANSFORM_Z","TrailFilter","CURTIME","LIFETIME","WIDTHCURVE","WIDTHCURVEKEYLENGTH","spriteParms","_minVertexDistance","_widthMultiplier","widthCurve","_widthCurve","widthCurveFloatArray","_colorGradient","_textureMode","_lastPosition","_initDefaultData","_trialGeometry","curPos","widthKeyFrames","widthKeyFrame1","widthKeyFrame2","WHITE","TrailRenderer","_trailFilter","onUpdate","widthCurveData","TrailSprite3D","trailFilter","_geometryFilter","trailRenderer","trailkeyframe","colorGradientData","colorKeys","alphaKeys","srcSprite","SubMeshInstanceBatch","instanceWorldMatrixData","instanceSimpleAnimatorData","instanceWorldMatrixBuffer","instanceSimpleAnimatorBuffer","instanceSimpleAnimatorDeclaration","_indexCount","VertexPositionTerrain","TERRAIN_POSITION0","TERRAIN_NORMAL0","TERRAIN_TEXTURECOORDINATE0","TERRAIN_TEXTURECOORDINATE1","_normal","textureCoord0","_textureCoord0","textureCoord1","_textureCoord1","InstanceRenderElement","elemet","_isInPool","_InvertFront","_instanceBatchElementList","_isUpdataData","_invertFrontFace","InvertFront","createInstanceRenderElement","oriRendertype","updateInstanceData","_instanceBufferStateType","Mesh","MESH_INSTANCEBUFFER_TYPE_SIMPLEANIMATOR","getUpdateData","addUpdateBuffer","_instanceWorldVertexBuffer","insBatches","drawCount","simpleAnimatorData","_computeAnimatorParamsData","simpleAnimatorParams","_simpleAnimatorParams","_instanceSimpleAniVertexBuffer","MESH_INSTANCEBUFFER_TYPE_NORMAL","_instanceLightMapVertexBuffer","lightMapData","SubMesh","UInt32","Element_Index_Uint32","_subIndexBufferStart","_subIndexBufferCount","_setIndexRange","indexStart","canRead","_indices","_uploadVerticesData","byteCount","skinnedDatas","_indexFormat","getIndices","_isReadable","setIndices","skinnedMatrixCache","MESH","inverseAbsoluteBindPoses","isReadable","_minVerticesUpdate","_maxVerticesUpdate","_needUpdateBounds","destroyedImmediately","Config","destroyResourceImmediatelyDefault","_getPositionElement","vertexElement","_elementFormat","_getVerticeElementData","uint8Vertices","getUint8Data","floatVertices","uint8VerStr","floatVerStr","uint8EleOffset","floatEleOffset","MESH_BLENDWEIGHT0","MESH_BLENDINDICES0","_setVerticeElementData","float8VerStr","cor","MAX_SAFE_INTEGER","instanceLightMapScaleOffsetData","_setCPUMemory","_setGPUMemory","_btTriangleMesh","_boneNames","__convexMesh","_setSubMeshes","subMeshes","_indexInMesh","_setBuffer","instanceBufferStateType","instanceBuffer3D","instanceLightMapVertexBuffer","instanceLightMapScaleOffsetDeclaration","getPositions","positions","setPositions","getColors","colors","setColors","getUVs","uvs","setUVs","getNormals","normals","setNormals","getTangents","tangents","setTangents","getBoneWeights","boneWeights","setBoneWeights","getBoneIndices","setBoneIndices","markAsUnreadbale","getVertices","setVertices","calculateBounds","positionElement","verticesData","ofset","pX","pY","pZ","getCorveMesh","_convexMesh","_PhysicsCreateUtil","getPhysicsCapable","Physics_CreateCorveMesh","createCorveMesh","destMesh","destVB","bufferUsage","ib","destIB","cpuMemory","gpuMemory","boneNames","destBoneNames","inverseBindPoses","destInverseBindPoses","_inverseBindPosesBuffer","byteLength","ArrayBuffer","cacheLength","skinnedCache","subIndexBufferStart","subIndexBufferCount","boneIndicesList","destSubmesh","PrimitiveMesh","_createMesh","createBox","long","halfLong","halfHeight","halfWidth","createCapsule","vertexFloatStride","hcHeight","posX","posY","posZ","ic","verticeCount","createCone","rotateRadius","curAngle","downV3","upPoint","downPoint","v3","q4","rotateAxis","rv","acos","ri","bv","bi","createCylinder","tv","ti","createPlane","stacksLong","slicesWidth","indiceIndex","createQuad","createSphere","BlitFS","BlitScreenShaderInit","blitPass","statefirst","blitState","transparentShader","transparentSubShader","blitPassTrans","srcBlend","dstBlend","lutBuilderInit","u_LutParams","PBRDepthVS","PBRDepthFS","UnlitShaderInit","UnlitBlock","u_AlbedoColor","u_TilingOffset","u_AlbedoTexture","u_AlphaTestValue","D3","DefaultAttributeMap","DepthVS","DepthFS","BlinnPhongShaderInit","u_DiffuseColor","u_DiffuseTexture","u_AlbedoIntensity","u_MaterialSpecular","u_SpecularTexture","u_Shininess","u_NormalTexture","TrailShaderInit","a_Position","a_OffsetVector","a_Texcoord0X","a_Texcoord0Y","a_BirthTime","a_Color","u_MainTexture","u_MainColor","Effect","PBRStandardShaderInit","u_NormalScale","u_Metallic","u_Smoothness","u_OcclusionStrength","u_EmissionColor","u_EmissionIntensity","u_OcclusionTexture","u_EmissionTexture","u_MetallicGlossTexture","u_AnisotropyStrength","u_AnisotropyTexture","u_AnisotropyRotation","u_ClearCoatFactor","u_ClearCoatTexture","u_ClearCoatRoughness","u_ClearCoatRoughnessTexture","u_ClearCoatNormalTexture","u_DetailAlbedoTexture","u_DetailNormalTexture","u_DetailNormalScale","u_DetailTillingOffset","SkyBoxShaderInit","u_TintColor","u_Exposure","u_Rotation","u_CubeTexture","Sky","DEPTHTEST_LEQUAL","CullMode","Back","stencilWrite","ParticleShuriKenShaderInit","a_CornerTextureCoordinate","a_MeshPosition","a_MeshColor","a_MeshTextureCoordinate","a_ShapePositionStartLifeTime","a_DirectionTime","a_StartColor","a_StartSize","a_StartRotation0","a_StartSpeed","a_Random0","a_Random1","a_SimulationWorldPostion","a_SimulationWorldRotation","a_SimulationUV","u_Tintcolor","u_texture","SkyProceduralShaderInit","u_SunSize","u_SunSizeConvergence","u_AtmosphereThickness","u_SkyTint","u_GroundTint","SkyPanoramicShaderInit","u_Texture","grayTexture","ACESShaderLib","ShaderInit3D","SHADERDEFINE_LEGACYSINGALLIGHTING","SHADERDEFINE_ENUNIFORMBLOCK","SHADERDEFINE_FLOATTEXTURE","SHADERDEFINE_FLOATTEXTURE_FIL_LINEAR","SimpleSkinnedMeshRenderer","simpleAnimatorTexture","_simpleAnimatorTexture","_simpleAnimatorTextureSize","SIMPLE_SIMPLEANIMATORTEXTURE","SIMPLE_SIMPLEANIMATORTEXTURESIZE","simpleAnimatorOffset","_simpleAnimatorOffset","round","_bonesNums","setCustomData","value1","value2","oriMat","getMatrix4x4","SIMPLE_SIMPLEANIMATORPARAMS","SimpleSkinnedMeshSprite3D","simpleSkinnedMeshRenderer","bonesNums","animatorTexture","animatortexture","TEXTURE2D","SkyPanoramicMaterial","TEXTURE","TEXTURE_HDR_PARAMS","panoramicTexture","_textureHDRParams","BloomVS","BloomEffect","u_AutoExposureTex","u_Threshold","u_Params","u_BloomTex","u_SampleScale","shaderPass","CompositeInit","u_Bloom_DirtTex","u_BloomTex_TexelSize","u_Bloom_DirtTileOffset","u_Bloom_Settings","u_Bloom_Color","SHADERVALUE_SAMPLESCALE","SHADERVALUE_THRESHOLD","SHADERVALUE_PARAMS","clamp","_clamp","fastMode","_fastMode","dirtTexture","_dirtTexture","threshold","_threshold","softKnee","_softKnee","diffusion","_diffusion","anamorphicRatio","_anamorphicRatio","dirtIntensity","_dirtIntensity","_linearColor","_bloomTextureTexelSize","_shaderThreshold","_shaderParams","_pyramid","_shaderSetting","_dirtTileOffset","MAXPYRAMIDSIZE","logs","ratio","rw","rh","tw","th","logsInt","iterations","sampleScale","lthresh","knee","lclamp","qualityOffset","lastDownTexture","downIndex","upIndex","SUBSHADER_PREFILTER13","SUBSHADER_DOWNSAMPLE13","mipDownTexture","mipUpTexture","lastUpTexture","SUBSHADER_UPSAMPLETENT","linearColor","shaderSettings","usedirtTexture","dirtRatio","screenRatio","dirtTileOffset","SUBSHADER_PREFILTER4","SUBSHADER_DOWNSAMPLE4","SUBSHADER_UPSAMPLEBOX","AOQUALITY","ScalableAO","BlurDelty","AOColor","aoTexture","AOParams","SourceTex","SHADERDEFINE_AOHigh","SHADERDEFINE_AOMEDIUM","SHADERDEFINE_LOWEST","u_Delty","u_PlugTime","u_AOParams","u_BlurVector","u_AOColor","u_compositionAoTexture","_aoParams","_aoQuality","MEDIUM","_aoBlurHorizontalShader","_aoComposition","aoQuality","aoColor","LOWEST","DepthAndDepthNormals","depthTextureMode","textureFormat","finalTex","blurTex","deltyVector","deltyHorizontal","FullScreenVert","GaussianDoF","SOURCESIZE","ZBUFFERPARAMS","COCPARAMS","NORMALDEPTHTEXTURE","FULLCOCTEXTURE","DOWNSAMPLESCALE","BLURCOCTEXTURE","SHADERDEFINE_DEPTHNORMALTEXTURE","u_ZBufferParams","u_CoCParams","u_FullCoCTex","u_SourceSize","u_DownSampleScale","u_BlurCoCTex","cocSubShader","prefilterSubShader","blurHSubShader","blurVSubShader","compositeSubShader","_sourceSize","_dowmSampleScale","farStart","cocParams","getVector3","farEnd","maxRadius","_setupShaderValue","dataTexFormat","fullCoC","prefilterTex","blurHTex","blurVTex","LensFlareElementGeomtry","quadSize","lensQuadVertices","lensQuadIndex","instanceVertexDeclaration","_createBuffer","_instanceVertexBuffer","lensFlareElementMax","PositionUV","PositionRotationScale","LensFlareCMD","_instanceCount","_lensFlareGeometry","_initMaterial","_materials","setFloat","lensFlareElement","_lensFlareElementData","applyElementData","angularOffset","autoRotate","LensFlareEffect","SHADERDEFINE_AUTOROTATE","testFloat","startPosition","Utils","toAngle","FogMode","CameraClearFlags","CameraEventFlags","AreaShape","LensFlareShaderInit","attribute","a_DistanceRotationScale","u_Tint","u_TintIntensity","u_FlareTexture","u_FlareCenter","u_aspectRatio","u_rotate","u_Postionoffset","u_Angularoffset","subshader","LensFlareElement","_texture","_positionOffset","_autoRotate","_startPosition","_angularOffset","_aspectRatio","_modulateByLightColor","_translationScale","LensFlareData","lensFlareData","_flareCMDS","ele","_lensFlareData","bindLight","effectIntensity","_effectIntensity","effectScale","_effectScale","_tempV4","_updateEffectData","_rotate","cmdEle","caculateDirCenter","_direction","caculatePointCenter","caculateSpotCenter","PhysicsCreateUtil","_enablePhysics","enablePhysics","_changeWebGLSize","WebGL","onStageResize","clientWidth","_multiLighting","enableMultiLight","enableUniformBufferObject","UnifromBufferObject","lcc","maxAreaLightCountWithZ","_maxAreaLightCountPerClusterAverage","configRenderContextInstance","__initPhysics__","initialize","Promise","resolve","Laya","addInitCallback","Sprite","__updateMark","regManager","cla","componentManagerMap","SHADERDEFINE_FOG","SHADERDEFINE_FOG_LINEAR","SHADERDEFINE_FOG_EXP","SHADERDEFINE_FOG_EXP2","SHADERDEFINE_DIRECTIONLIGHT","SHADERDEFINE_POINTLIGHT","SHADERDEFINE_SPOTLIGHT","SHADERDEFINE_SHADOW","SHADERDEFINE_SHADOW_SPOT","FOGCOLOR","FOGPARAMS","DIRECTIONLIGHTCOUNT","LIGHTBUFFER","CLUSTERBUFFER","TIME","GIRotate","SCENEUNIFORMBLOCK","UBONAME_SCENE","legacyLightingValueInit","LIGHTDIRECTION","LIGHTDIRCOLOR","LIGHTMODE","POINTLIGHTPOS","POINTLIGHTRANGE","POINTLIGHTATTENUATION","POINTLIGHTCOLOR","POINTLIGHTMODE","SPOTLIGHTPOS","SPOTLIGHTDIRECTION","SPOTLIGHTSPOTANGLE","SPOTLIGHTRANGE","SPOTLIGHTCOLOR","SPOTLIGHTMODE","createSceneUniformBlock","SceneUBOData","clusterSlices","_lightTexture","_lightPixles","configShaderValue","_shadowCasterPass","ret","Scene","_scene3D","scene2D","_scene2D","manager","cullPass","_cullPass","enableFog","_enableFog","fogMode","_fogMode","Linear","EXP","EXP2","fogColor","fogStart","_fogParams","fogParams","fogEnd","fogDensity","_sceneReflectionProb","physicsSimulation","_physicsManager","_timer","_lightmaps","maps","map","shadowMapFrequency","_ShadowMapupdateFrequency","_reflectionsSource","_reflectionsResolution","_reflectionsIblSamples","_physicsStepTime","_collsionTestList","_key","SubmitKey","createBaseRenderQueue","_transparentQueue","_UI3DManager","currentCreationLayer","enableLight","componentElementMap","_componentElementDatasMap","_componentDriver","ComponentDriver","conchConfig","conchWebGL","conchSubmitScene3D","renderSubmit","bind","createPhysicsManger","physicsSettings","_sceneUniformObj","_sceneUniformData","useBVHCull","BVH_Min_Build_nums","BVH_limit_size","BVH_max_SpatialCount","createCullPass","debugFrustumCulling","val","componentElementDatasMap","Init","physicsManager","enablePhysicsUpdate","callStart","callUpdate","callLateUpdate","callDestroy","_renderByEditor","_binarySearchIndexInCameraPool","_getGroup","_group","_setGroup","_scene3Ds","scenes","_prepareSceneToRender","enableMulLight","ligTex","ligPix","pixelWidth","floatWidth","dirCount","dirElements","sunLightIndex","_mainDirectionLight","dirLight","intCor","mainPointLightIndex","_mainPointLight","poiLight","mainSpotLightIndex","_mainSpotLight","spoLight","cullInfoCamera","_cullInfoCamera","_setCullCamera","recaculateCullCamera","order","_preCulling","_clearRenderQueue","_clear","vpX","renderTex","_getRenderTexture","vpW","_needInternalRenderTexture","renderTarget","_context3DViewPortCatch","_contextScissorPortCatch","clearFlag","clearConst","stencilFlag","Stencil","DepthOnly","Nothing","ColorOnly","gammaCorrection","_renderScene","renderFlag","SCENERENDERFLAG_RENDERQPAQUE","opaqueDrawCall","SCENERENDERFLAG_SKYBOX","SCENERENDERFLAG_RENDERTRANSPARENT","transDrawCall","lightMapsData","lightMapCount","getTexture2D","skyData","sky","fogRange","fogColorData","fogCol","ambientModeData","ambientColorData","ambCol","ambientSkyColor","tempV3sky","ambientEquatorColor","tempV3Equaltor","ambientGroundColor","tempV3Ground","ambientSphericalHarmonicsData","reflectionData","reflection","reflectionDecodingFormatData","ambientSphericalHarmonicsIntensityData","ambientSphericalHarmonicsIntensity","reflectionIntensityData","getComponentElementManager","ctx","addRenderObject3D","_curBindedBufferState","unBind","enableBuiltInRenderTexture","_blitTransRT","_blitOffset","blitMainCanvans","normalizedViewport","_cacheDepth","Context","set2DRenderConfig","clearPool","normalizeViewPort","mainCavansViewPort","fxaa","getRenderType","releaseRender","reUse","setGlobalShaderValue","shaderOffset","setlightmaps","getlightmaps","lightmapColors","REFLECTIONMODE_SKYBOX","REFLECTIONMODE_CUSTOM","drawRenderTextureByScene","replaceFlag","recoverTexture","needInternalRT","msaa","_needRenderGamma","callPreRender","needShadowCasterPass","_renderShadowMap","_preRenderMainPass","_renderMainPass","_aftRenderMainPass","callPostRender","getTexturePixel","coverFilter","pixelData","rtFormat","R32G32B32","R16G16B16","R5G6B5","blit","drawTextureCubePixelByScene","renderCubeSize","bytelength","quaterionArray","drawTextureCubeByScene","depthPass","vp","_calculationViewport","_normalizedViewport","_viewport","needUpdateCanvasSize","customResolution","pixelRatio","_resoluWidth","_resoluHeight","MSAA","_msaa","enablemsaa","_fxaa","_updateViewMatrix","scaleX","scaleY","scaleZ","viewMatE","_viewMatrix","_projectionMatrix","_projectionViewMatrix","_boundFrustum","_isCameraTarget","postProcess","_postProcess","enableHDR","_enableHDR","RenderTextureFormat_R16G16B16A16","_needBuiltInRenderTexture","_depthTextureMode","opaquePass","_opaquePass","_opaqueTexture","_depthTextureFormat","enableBlitDepth","_canBlitDepth","_cacheDepthTexture","canblitDepth","_viewportParams","_projectionParams","_internalCommandBuffer","_cameraEventCommandBuffer","_shadowCasterCommanBuffer","_clusterPlaneCacheFlag","_rayViewport","_onTransformChanged","lx","ly","rx","ry","ceilLeftX","ceilLeftY","floorRightX","floorRightY","pixelLeftX","pixelLeftY","pixelRightX","pixelRightY","_isLayerVisible","clearFlagData","_updateCameraRenderData","proMat","projectView","clusterCount","xSlixe","ySlice","xCount","yCount","yLengthPerCluster","xLengthPerCluster","normX","normY","_applyCommandBuffer","enableCameraCMD","commandBufferArray","textureContext","bindoutScreenTarget","_addCasterShadowCommandBuffer","_removeCasterShadowCommandBuffer","shadowCasterPass","mainDirectLight","enableShadow","spotMainLight","spotneedShadowCasterPass","bindCanvasRender","grabTexture","copySubFrameBuffertoTex","setDataByUniformBufferData","_renderDepthMode","BeforeForwardOpaque","recoverRenderContext3D","enableOpaque","BeforeSkyBox","BeforeTransparent","_createOpaqueTexture","enableTransparent","BeforeImageEffect","enablePostprocess","AfterEveryThing","cacheViewPor","cacheScissor","cameraDepthMode","depthStencilTexture","needShadowPass","currentTarget","renderContext","opaqueTexParams","activeInHierarchy","texFormat","viewportPointToRay","_width","_height","normalizedViewportPointToRay","finalPoint","_tempVector20","worldToViewportPoint","_wr","_hr","clientScaleX","clientScaleY","worldToNormalizedViewportPoint","convertScreenCoordToOrthographicCoord","ratioX","ratioY","addCommandBuffer","removeCommandBuffer","removeCommandBuffers","DirectionLightCom","shadowTwoCascadeSplits","shadowFourCascadeSplits","LightSprite","spriteLight","PointLightCom","_range","pointlight","SpotLightCom","_spotAngle","EffectMaterial","ExtendTerrainMaterial","SHADERDEFINE_DETAIL_NUM1","SHADERDEFINE_DETAIL_NUM2","SHADERDEFINE_DETAIL_NUM3","SHADERDEFINE_DETAIL_NUM4","SHADERDEFINE_DETAIL_NUM5","SPLATALPHATEXTURE","DIFFUSETEXTURE1","DIFFUSETEXTURE2","DIFFUSETEXTURE3","DIFFUSETEXTURE4","DIFFUSETEXTURE5","DIFFUSESCALEOFFSET1","DIFFUSESCALEOFFSET2","DIFFUSESCALEOFFSET3","DIFFUSESCALEOFFSET4","DIFFUSESCALEOFFSET5","splatAlphaTexture","diffuseTexture1","_setDetailNum","diffuseTexture2","diffuseTexture3","diffuseTexture4","diffuseTexture5","diffuseScaleOffset1","scaleOffset1","diffuseScaleOffset2","scaleOffset2","diffuseScaleOffset3","scaleOffset3","diffuseScaleOffset4","scaleOffset4","diffuseScaleOffset5","scaleOffset5","WaterPrimaryMaterial","HORIZONCOLOR","WAVESCALE","WAVESPEED","horizonColor","mainTexture","waveScale","waveSpeed","volumetricCount","_probeCounts","_probeStep","_params","_volumetricProbeID","irradiance","_irradiance","_distance","viewBias","irradianceTexel","distanceTexel","probeCounts","probeStep","AreaLightCom","Area","_spread","_maxBounces","_areaShape","rectangle","_power","power","spread","maxBounces","tempVec","LODInfo","mincullRate","_mincullRate","_renders","_cachSprite3D","group","_updateRecaculateFlag","_lodIndex","addNode","ren","components","comp","numChildren","removeNode","RenderBitFlag_CullFlag","removeAllRender","LODGroup","_needcaculateBounds","_lods","_visialIndex","_lodPosition","lods","_lodCount","nowRate","_nowRate","recalculateBounds","_setLODinvisible","_applyVisibleRate","rate","_setLODvisible","lod","onDestroy","renderarray","lodGroup","lodArray","cloneLOD","firstBounds","onPreRender","checkCamera","maxYDistance","cameraFrustum","rateYDistance","PixelLineData","endPosition","endColor","PixelLineFilter","Lines","_floatCountPerVertices","_minUpdate","_maxUpdate","_floatBound","_calculateBound","_maxLineCount","_lineCount","pointCount","_tempVector0","_tempVector1","_resizeLineData","lastVertices","_updateLineVertices","floatBound","_reCalculateBound","_removeLineData","rightPartVertices","startX","startY","startZ","endX","endY","endZ","_updateLineData","_updateLineDatas","_getLineData","PixelLineMaterial","COLOR","PixelLineRenderer","_isRenderActive","_isInRenders","_needUpdatelines","_lines","_pixelLineFilter","pixelLinesDatas","addLines","_changeRenderObjects","lineFilter","renderObjects","_pixelLinesDataChange","keyN","parseInt","setLine","lines","addCount","removeLine","pixeldata","getLine","pixelLineDatas","linedata","AnimatorPlayState","currentState","_currentState","curTransition","normalizedTime","_normalizedTime","animatorState","_resetPlayState","clipDuration","_finish","_playEventIndex","_startPlayTime","_elapsedTime","_lastIsFront","playTime","_normalizedPlayTime","AnimatorControllerLayer","defaultState","_defaultState","_avatarMask","defaultStateName","getAnimatorState","_states","_defaultStateNameCatch","states","removed","removeState","newAdded","addState","_referenceCount","_playType","_crossDuration","_crossMark","_crossNodesOwnersCount","_crossNodesOwners","_crossNodesOwnersIndicesMap","_srcCrossClipNodeIndices","_destCrossClipNodeIndices","_playStateInfo","_crossPlayStateInfo","blendingMode","BLENDINGMODE_OVERRIDE","playOnWake","_removeClip","clipStateInfos","_clip","clipStateInfo","_animator","frameNodes","nodeOwners","_nodeOwners","_removeKeyframeNodeOwner","_getReferenceCount","_clearReference","getCurrentPlayState","stateName","_getOwnersByClip","BLENDINGMODE_ADDTIVE","AnimatorResource","getAnimatorResource","propertyKey","ClassUtils","getClass","AnimatorState","realtimeDatas","_realtimeDatas","clipNodes","_currentFrameIndices","Int16Array","_resetFrameIndices","_isLooping","transitions","_transitions","soloTransitions","_soloTransitions","_scripts","speed","clipStart","clipEnd","cycleOffset","_eventStart","animator","layerIndex","EVENT_OnStateEnter","setPlayScriptInfo","onStateEnter","_eventExit","EVENT_OnStateExit","onStateExit","_eventStateUpdate","EVENT_OnStateUpdate","onStateUpdate","_eventLoop","EVENT_OnStateLoop","onStateLoop","_eventtransition","normalizeTime","paramsMap","soloNums","check","transNums","addScript","script","getScript","getScripts","coms","AvatarMask","_avatarPathMap","setTransformActive","getAllTranfromPath","Animator","controller","_controller","updateTo","_speed","updateMode","_updateMode","lowUpdateDelty","_lowUpdateDelty","controllerLayerCount","_controllerLayers","animatorParams","values","_animatorParams","sleep","_finishSleep","_keyframeNodeOwners","AnimatorUpdateMode","_linkAvatarSpritesData","_linkAvatarSprites","_renderableSprites","cullingMode","CULLINGMODE_CULLCOMPLETELY","_keyframeNodeOwnerMap","_addKeyframeNodeOwner","clipOwners","nodeIndex","keyframeNodeOwner","propertys","frameNodesCount","ownPat","getChildByName","oriProperty","_updatePlayer","playState","lastElapsedTime","elapsedPlaybackTime","_lastElapsedTime","loopNum","_applyTransition","layerindex","transition","crossFade","destState","transduration","transstartoffset","_updateStateFinish","_updateEventScript","stateInfo","playStateInfo","HAS_SCRIPT","events","parentPlayTime","_parentPlayTime","_eventScript","currPlayTime","scripts","len","_isScript","fun","_updateClipDatas","animatorMask","curPlayTime","currentFrameIndices","_applyFloat","nodeOwner","additive","isFirstLayer","defValue","_applyVec2","oriValue","_applyVec3","_applyVec4","_applyColor","_applyPositionAndRotationEuler","oriX","oriY","oriZ","defX","defY","defZ","_applyRotation","clipRot","_tempQuaternion1","defaultRot","_applyScale","clipSca","defaultSca","_applyCrossData","srcValue","desValue","crossWeight","pro","lastpro","proPat","crossValue","localPos","srcX","srcY","srcZ","localRot","localSca","localEuler","v44","getVector2","v4","getVector4","_setClipDatasToNode","controllerLayer","_setCrossClipDatasToNode","srcState","ownerCount","destRealtimeDatas","destDataIndices","destNodeOwners","srcRealtimeDatas","srcDataIndices","srcNodeOwners","destIndex","_setFixedCrossClipDatasToNode","_revertDefaultKeyframeNodes","locPos","def","locRot","defQua","locSca","locEul","tempColor","_tempColor","onAfterDeserialize","arr","controllerLayers","addControllerLayer","defaultClip","getDefaultState","_applyUpdateMode","LowFrame","UnScaleTime","_handleSpriteOwnersBySprite","isLink","ownersNodes","layersData","layers","layerData","animatorLayer","blendingModeData","clipPath","motion","getControllerLayer","layerMaskData","avaMask","bips","cullingModeData","enableAnimatorUpdate","crossPlayStateInfo","finish","crossState","_crossPlayState","crossClip","crossDuratuion","startPlayTime","crossClipDuration","crossScale","crossSpeed","needUpdateFinishcurrentState","controllLayer","animatorStates","cloneLayer","controllderLayer","layerInex","NEGATIVE_INFINITY","curPlayState","calclipduration","transitionDuration","destAnimatorState","playType","crossNodeOwners","crossNodeOwnerIndicesMap","srcAnimatorState","destCrossClipNodeIndices","destClip","destNodes","destNodesMap","crossCount","scrCrossClipNodeIndices","srcClip","srcNodes","srcNodesMap","crossMark","srcNode","srcNodeOwner","srcFullPath","destNodeOwner","destFullPath","setParamsTrigger","AnimatorStateCondition","conditionNameToID","setParamsNumber","setParamsBool","getParamsvalue","getCurrentAnimatorPlayState","CULLINGMODE_ALWAYSANIMATE","AnimatorTransition","_conditions","_exitByTime","_exitTime","_transduration","_transstartoffset","_mute","mute","_destState","conditions","removeCondition","addCondition","exitByTime","exitTime","condition","con","checkState","AniStateConditionType","Trigger","AnimatorController","AnimatorControllerParse","clipsID","getLayers","lArr","acl","unshift","err","getState","currLayer","parms","AniParmType","Boolean","isNaN","createState","idCatch","defID","childStates","groupRet","isArray","uuid","substring","setExitTransition","exitRet","pExitRet","ats","sts","linArr","ato","addConditions","solo","setTransitions","pState","exitTransition","o","idk","parm","AnimatorStateBoolCondition","compareFlag","checkValue","AnimatorStateNumberCondition","numberValue","AnimatorStateTriggerCondition","BatchMark","batched","InstanceBatchManager","_instanceBatchOpaqueMarks","updateCountMark","_getData","cls","getInstanceBatchOpaquaMark","invertFrontFace","matID_geometry","giID","BatchRender","_lodInstanceRenderElement","_RenderBitFlag","RenderBitFlag_Batch","_batchList","checkLOD","_checkLOD","lodCullRateArray","_lodRateArray","_changeLOD","_cacheLod","concat","_lodsize","addList","reBatch","renderNums","_restorRenderNode","StaticInstanceBatchRender","_insBatchMarksNums","_insElementMarksArray","_instanceBatchminNums","_updateChangeElement","_batchManager","RenderBitFlag_InstanceBatch","_isRenderNodeAllCanInstanceBatch","_enableInstancing","_sumInstanceBatch","insBatchMarks","_batchOneElement","instanceelement","_createInstanceElement","indexof","_batchElement","_removeOneElement","_updateOneElement","batchMark","instanceRenderElement","renderNodes","StatiVertexMergeBatchRender","_addList","StaticBatchVolume","_getStaticInstanceBatchRender","_getStatiVertexMergeBatchRender","_enableStaticInstanceBatch","_instanceBatchRender","_enableStaticVertexMergeBatch","_vertexMergeBatchRender","_enableCustomBatch","_customBatchs","enableStaticInstanceBatchRender","enableMergeBatchRender","enableCustomBatchRender","customBatchRenders","_destroyComponent","addComponentInstance","_cacheRender","__addRenderNodeToBatch","__removeRenderNodeFromBatch","onStart","UI3DGeometry","_bound","_vertex","_positionArray","_resizeViewVertexData","viewMode","worldPos","halfwidth","halfhight","tempV0","_changeVertex","_resizeVertexData","_resizeWorldVertexData","applyMat","UI3D","_uisprite","_shellSprite","removeChildren","_resizeRT","prefab","_prefab","_ui3DMat","resolutionRate","_resolutionRate","billboard","_view","_sizeChange","enableHit","_hit","_bindPropertyName","_uiPlane","DISPLAYED_INSTAGE","ACTIVE_INHIERARCHY","_addRenderElement","_setMaterialTexture","_rendertexure2D","RenderTexture2D","_invertY","_parseHit","_tempRay","_ray","TempMatrix","normalizeHitWidth","normalizeHitHeight","cx","cy","InputManager","inst","getSpriteUnderPoint","getUITexture","drawToTexture","_transByRotate","temp0","DEBUG","internalResources","registerLoader","task","AssetDb","getSubAssetURL","fetch","progress","createCallback","options","CubemapLoader","getBaseName","ext","ktxInfo","KTXTextureInfo","getKTXTextureInfo","dimension","TextureDimension","Cube","mipmapCount","setKTXData","obsoluteInst","move","byte","readUint8","mipCount","readUint16","wrapModev","mipSize","uint8Arrays","mipPixelLength","_getFormatByteCount","updateSubPixelsData","ltcBasePath","URL","getPath","urls","front","back","all","images","constructParams","srgb","setImageData","_format","obsolute","_idResourcesMap","LoadModelV04","readData","_readData","_readString","READ_MESH","arrayBuffer","__getBuffer","vertexBufferCount","vbStart","vbLength","vbArrayBuffer","vbDatas","bufferAttribute","ibStart","ibLength","ibDatas","boneCount","bindPoseDataStart","bindPoseDataLength","bindPoseDatas","bindPoseFloatCount","bindPoseBuffer","inverseGlobalBindPose","READ_SUBMESH","ibCount","boneDicofs","boneDicCount","boneIndexCount","MorphTarget","MorphTargetChannel","getTargetByIndex","addTarget","MorphTargetData","channels","addMorphChannel","initData","targetNum","maxTexSize","getParams","RenderParams","MAX_Texture_Size","morphStride","elementCount","vertexElementCount","texHeight","texelStride","targetStride","targetIndex","dataOffset","elementIndex","elementOffset","targetDataOffset","newChannel","newTarget","LoadModelV05","vertexData","floatData","uint8Data","vertexFlag","subVertexFlags","subVertexCount","subOffset","verOffset","READ_MORPH","morphVertexDecStr","targetName","readFloat32","bufferStart","readUint32","bufferLength","READ_UVSIZE","MeshReader","read","HierarchyParserV2","nodeData","outBatchSprites","props","childData","instanceID","_createComponentInstance","interactMap","componentsData","_createNodeByJson02","component","_createInteractInstance","interatMap","_parseInteractive","json","outBatchSprits","_createNodeByJson","clas","collectResourceLinks","basePath","test","innerUrls","addInnerUrl","propertyParams","url2","lightmapColorData","lightmapDirectionData","reflectionTextureData","MATERIAL","skyboxMatData","parMeshPath","dataPath","TERRAINRES","clipPaths","shapes","HierarchyLoader","ShaderCompile","promises","loadAvatarMask","loadStates","_$uuid","getResURLByUUID","regClass","NativeBaseRenderNode","_geometryBounds","conchRenderNode","RenderElementBatch","_instanceBatchManager","_recoverList","recoverData","elementArray","enableStaticBatch","enableDynamicBatch","insManager","insBatchIndex","insOriElement","instanceelements","NativeBaseRenderQueue","sortPass","isTransparent","_isTransparent","conchRenderQueue","_batch","_batchQueue","render_element","UploadMemoryManager","syncRenderMemory","NativeBounds","float64Array","_boundBox","_extent","nativeMemory","NativeMemory","MemoryBlock_size","float32Array","conchBounds","_buffer","ownMax","ownMin","calMax","calMin","TEMP_VECTOR3_MAX0","tempV1","TEMP_VECTOR3_MAX1","thisExtends","boundExtends","destBounds","NativeCameraCullInfo","conchCameraCullInfo","setPosition","_useOcclusionCulling","_staticMask","serialize","setPlane","setBoundFrustum","NativeCullPassBase","_tempRenderList","conchCullPass","customRenderList","_customCullList","IndexBuffer3D","IndexBuffer","indexType","_indexType","indexTypeByteCount","_indexTypeByteCount","_canRead","BufferTargetType","ELEMENT_ARRAY_BUFFER","_setIndexData","bufferOffset","dataStartIndex","dataCount","maxLength","NativeIndexBuffer3D","_conchIndexBuffer3D","conchIndexBuffer3D","setGLBuffer","_glBuffer","RenderElementType","UniformParamsMapType","NativeRenderElementOBJ","materialShaderData","renderShaderData","_shaderInstances","conchRenderElement","Base","NativeInstanceRenderElementOBJ","_vertexBuffer3D","_updateNums","_conchVertexBuffer3D","_updateData","Instance","NativeRenderContext3DOBJ","_scissor","conchRenderContext3D","renderelemt","_destTarget","_renderTarget","_confifShaderData","_globalShaderData","_sceneShaderData","_cameraShaderData","NativeRenderGeometryElementOBJ","conchRenderGeometryElement","drawParams","_nativeVertexArrayObject","NativeSceneRenderManager","_customUpdateList","conchSceneCullManger","NativeShadowCullInfo","conchShadowCullInfo","_cullPlanes","clearCullPlanes","addCullPlane","_cullSphere","setCullSphere","setDirection","_cullPlaneCount","NativeSkinRenderElementOBJ","Skin","NativeTransform3D","getLocalPosition","setLocalPosition","getLocalRotation","setLocalRotation","getLocalScale","setLocalScale","getLocalRotationEuler","setLocalRotationEuler","getLocalMatrix","setLocalMatrix","getPosition","getRotation","setRotation","getRotationEuler","setRotationEuler","getWorldMatrix","int32Array","eventDispatcher","conchTransform","setParent","hasListener","caller","listener","args","arguments","once","offAll","offAllCaller","VertexBuffer3D","VertexBuffer","ARRAY_BUFFER","_float32Reader","setDataLength","NativeVertexBuffer3D","setVertexDeclaration","serilizeVertexDeclaration","array","loc","_instanceBuffer","conchVertexBuffer3D","BaseRenderNode","BaseRenderQueue","_sortPass","_sort","CameraCullInfo","RenderElementOBJ","forceInvertFace","switchShader","switchUpdateMark","_uploadMark","uploadScene","_uploadScene","uploadUniforms","_sceneUniformParamsMap","uploadSprite3D","_uploadRender","_spriteUniformParamsMap","uploadCamera","_uploadCameraShaderValue","_cameraUniformParamsMap","uploadMaterial","_uploadMaterial","_materialUniformParamsMap","uploadRenderStateBlendDepth","uploadRenderStateFrontFace","drawGeometry","renderDrawContext","drawGeometryElement","InstanceRenderElementOBJ","updateNums","_updateDataNum","QuickSort","_quickSort","_partitionRenderObject","leftIndex","pivot","_compare","RenderContext3DOBJ","ShaderData","RenderGeometryElementOBJ","_glindexFormat","getIndexType","_glmode","getMeshTopology","SceneRenderManagerOBJ","_motionRenders","ShadowCullInfo","SkinRenderElementOBJ","subSkinnedDatas","uploadCustomUniform","drawElements","BoundsImpl","_updateFlag","outCen","outExt","WebGLRenderEngine3DFactory","queue","createSortPass","drayType","HitResult","succeeded","collider","hitFraction","LensFlareSettingsLoader","ECharacterCapable","EColliderCapable","EJointCapable","D6MotionType","D6Axis","D6Drive","Texture2DArrayLoader","default","defaultTexture","premultiplyAlpha","textures","TEXTURE2DARRAY","RandX","_state0U","_state0L","_state1U","_state1L","randomint","s1U","s1L","s0U","s0L","sumL","resU","resL","t1U","t1L","t2U","xU","xL","_CONVERTION_BUFFER","setUint32","getFloat64","DataView","defaultRand","Date","now","Physics3DUtils","COLLISIONFILTERGROUP_DEFAULTFILTER","COLLISIONFILTERGROUP_STATICFILTER","COLLISIONFILTERGROUP_KINEMATICFILTER","COLLISIONFILTERGROUP_DEBRISFILTER","COLLISIONFILTERGROUP_SENSORTRIGGER","COLLISIONFILTERGROUP_CHARACTERFILTER","COLLISIONFILTERGROUP_CUSTOMFILTER1","COLLISIONFILTERGROUP_CUSTOMFILTER2","COLLISIONFILTERGROUP_CUSTOMFILTER3","COLLISIONFILTERGROUP_CUSTOMFILTER4","COLLISIONFILTERGROUP_CUSTOMFILTER5","COLLISIONFILTERGROUP_CUSTOMFILTER6","COLLISIONFILTERGROUP_CUSTOMFILTER7","COLLISIONFILTERGROUP_CUSTOMFILTER8","COLLISIONFILTERGROUP_CUSTOMFILTER9","COLLISIONFILTERGROUP_CUSTOMFILTER10","COLLISIONFILTERGROUP_ALLFILTER","PHYSXDEFAULTMASKVALUE","Size","fullScreen","WebXRRenderTexture","STENCIL_8","frameLoop","frameBuffer","_frameBuffer","gl","WebXRExperienceHelper","glInstance","bindFramebuffer","FRAMEBUFFER","_currentActive","WebXRSessionManager","currentTimestamp","defaultHeightCompensation","_sessionEnded","referenceSpace","_referenceSpace","newReferenceSpace","sessionMode","_sessionMode","exitXR","endXRRenderLoop","EVENT_MANAGER_END","initializeXRGL","xrSession","makeXRCompatible","initializeAsync","_xrNavigator","navigator","xr","reject","isSessionSupportedAsync","isSessionSupported","supportsSession","initializeSessionAsync","xrSessionMode","xrSessionInit","requestSession","session","addEventListener","resetReferenceSpace","baseReferenceSpace","runXRRenderLoop","requestAnimationFrame","timestamp","xrFrame","_updateByXrFrame","EVENT_FRAME_LOOP","_loop","currentFrame","setReferenceSpaceTypeAsync","referenceSpaceType","requestReferenceSpace","rejectionReason","heightCompensation","XRRigidTransform","getOffsetReferenceSpace","updateRenderStateAsync","baseLayer","_baseLayer","updateRenderState","currentFrameRate","frameRate","supportedFrameRates","updateTargetFrameRate","WebXRCameraManager","newPosition","rotationQuaternion","_referenceQuaternion","rigCameras","_rigCameras","_referencedPosition","_firstFrame","_XRRenderTexture","_webXRSessionManager","_updateFromXRSession","_updateReferenceSpace","pose","getViewerPose","orientation","views","_updateNumberOfRigCameras","currentRig","getViewport","framebufferWidth","framebufferHeight","framebuffer","cameraViewPort","cloneByArray","viewCount","xrcamera","WebXRCamera","removeChild","AxiGamepad","handness","axisData","axisLength","padGameAxi","axes","outPutStickValue","eventnam","EVENT_OUTPUT","eventname","ButtonGamepad","lastTouch","lastPress","lastPressValue","touch","press","pressValue","padButton","touched","pressed","touchEnter","touchStay","touchOut","pressEnter","pressStay","pressOut","outpressed","EVENT_TOUCH_ENTER","EVENT_TOUCH_STAY","EVENT_TOUCH_OUT","EVENT_PRESS_ENTER","EVENT_PRESS_STAY","EVENT_PRESS_OUT","EVENT_PRESS_VALUE","WebXRInput","preButtonEventList","preAxisEventList","_updateByXRPose","rayPose","getPose","_inputSource","targetRaySpace","_lastXRPose","tempQua","UnitZ","gripSpace","meshPose","EVENT_FRAMEUPDATA_WEBXRINPUT","_handleProcessGamepad","gamepad","gamepadAxis","gamepadButton","buttons","addButtonEvent","addAxisEvent","offAxisEvent","offButtonEvent","HANDNESS_LEFT","HANDNESS_RIGHT","WebXRInputManager","webxrManager","webXRCamera","controllers","controllerHandMesh","controllerLineRender","lineColor","RED","rayLength","webXRSessionManager","webXRCameraManager","_updateFromXRFrame","_updataMeshRender","xrInput","meshNode","tempVec1","refSpace","inputSource","inputSources","handedness","getController","bindMeshNode","meshSprite","bindRayNode","lineSprite","supportXR","xr_Manager","supported","enterXRAsync","cameraInfo","depthFar","depthNear","XRWebGLLayer","setWebXRCamera","setWebXRInput","sessionManager","cameraManager","canvasOptions","antialias","stencil","alpha","multiview","framebufferScaleFactor","_clientWidth","_clientHeight","_restoreView","RenderStateContext","setDepthMask","COLOR_BUFFER_BIT","DEPTH_BUFFER_BIT","Script3D","Script","HLODRender","curHLODRS","_curHLODRS","_changeMesh","HLODMesh","_createRenderelementByHLODElement","lodMesh","meshDefines","batchMesh","_curSubBatchMeshBounds","batchSubMeshInfo","lightmap","hodMesh","drawSubMeshs","lodbatchMesh","onEnable","onDisable","HLOD","lodResource","_resourceList","_applyLODResource","resource","_curLODSource","hlodRender","_curRender","_releaseGroupRender","applyResource","loaded","StaticBatchSubInfo","needRender","StaticBatchSubMesh","subInfos","addSubMesh","info","centerA","distanceA","centerB","indexByteCount","tempMatrix","TriangleIndices","InvertTriangleIndices","StaticBatchMesh","staticMesh","vertexFloatArray","mergeIndexFormat","mergeIndexByteCount","vertexDataOffset","vertexCountOffset","sp","invertFront","normalMat","transpose","meshIndexCount","meshVertexData","meshIndexData","triangleIndices","staticSubMesh","_staticSubMeshes","submesh","StaticBatchMeshRenderElement","StaticBatchMeshRender","mergeInfo","_staticMesh","_mergeInfo","meshDef","StaticMeshMergeInfo","match","addElement","TransLargeUBOUtils","UBO","defautSubData","currentlength","bindUBO","defaultSubData","_reset","configStartLength","subDataParamMap","maxlength","subDataMap","pool","reset","subdata","SubUniformBufferData","subModuleData","addStep","setDataByByUniformBufferDataOffset","updateBindRange","bytelenth","_bindBufferRange","_vec2","_hitResult","getSprite3DUnderPoint","pageX","_stage","pageY","normalWidth","Render","_mainCanvas","normalHeight","sim","uiManager","cameras","GradientDataVector2","destGradientDataVector2","MaterialInstanceProperty","_isNeedUpdate","createInstanceVertexBuffer3D","_instanceData","instanceData","dataValue","datalength","updateType","writeTo","InstanceLocation","MaterialInstancePropertyBlock","_checkPropertyLegal","vertexElementFormat","attributeLocation","prob","_creatProperty","attributeName","arrays","vertexformat","setVectorArray","setVector3Array","setVector2Array","setNumberArray","getPropertyArray","INSTANCETYPE_ATTRIBUTE","INSTANCETYPE_UNIFORMBUFFER","playstate","_lastUpdateFrame","_updateFrame","_isTrigger","contacts","_setUpdateFrame","farme","_idCounter","_colliderA","_colliderB","positionOnA","positionOnB","_batchSubMeshInfos","_drawSubMeshs","drawPramas","_lightmap","callFun","hlod","Handler","conchQuickSort","vs","ps","_shaderPass","pConchAttributeMap","conchAttributeMap","setAttributeValue","stateMap","setStateValue","conchShaderInstance","shaderUniform","shaderDatas","uploadUnTexture","uploadCustomUniforms","isTarget","pixelLineRenderer","meshVertexDecSet","Set","combine","haveMatch","staticRenders","text","_text","fontSize","_fontSize"],"sources":["../../src/layaAir/laya/d3/depthMap/DepthCasterData.ts","../../src/layaAir/laya/d3/depthMap/DepthPass.ts","../../src/layaAir/laya/d3/core/Keyframe.ts","../../src/layaAir/laya/d3/component/Animator/KeyframeNodeOwner.ts","../../src/layaAir/laya/d3/animation/KeyframeNode.ts","../../src/layaAir/laya/d3/animation/AnimationEvent.ts","../../src/layaAir/laya/d3/core/FloatKeyframe.ts","../../src/layaAir/laya/d3/core/QuaternionKeyframe.ts","../../src/layaAir/laya/d3/core/Vector3Keyframe.ts","../../src/layaAir/laya/d3/animation/AnimationClipParser03.ts","../../src/layaAir/laya/d3/core/Vector2Keyframe.ts","../../src/layaAir/laya/d3/core/Vector4Keyframe.ts","../../src/layaAir/laya/d3/animation/AnimationClipParser04.ts","../../src/layaAir/laya/d3/animation/KeyframeNodeList.ts","../../src/layaAir/laya/d3/resource/TextureGenerator.ts","../../src/layaAir/laya/d3/utils/Utils3D.ts","../../src/layaAir/laya/d3/animation/AnimationClip.ts","../../src/layaAir/laya/d3/RenderObjs/Laya3DRender.ts","../../src/layaAir/laya/d3/core/Sprite3D.ts","../../src/layaAir/laya/d3/math/BoundFrustum.ts","../../src/layaAir/laya/d3/component/Volume/Volume.ts","../../src/layaAir/laya/d3/core/scene/AmbientMode.ts","../../src/layaAir/laya/d3/component/Volume/reflectionProbe/ReflectionProbe.ts","../../src/layaAir/laya/d3/core/render/BaseRender.ts","../../src/layaAir/laya/d3/core/light/ShadowMode.ts","../../src/layaAir/laya/d3/core/light/ShadowCascadesMode.ts","../../src/layaAir/laya/d3/core/light/Light.ts","../../src/layaAir/laya/d3/core/light/ShadowUtils.ts","../../src/layaAir/laya/d3/shadowMap/ShadowLightType.ts","../../src/layaAir/ILaya3D.ts","../../src/layaAir/laya/d3/graphics/renderPath/Cluster.ts","../../src/layaAir/laya/d3/math/Plane.ts","../../src/layaAir/laya/d3/math/Ray.ts","../../src/layaAir/laya/d3/math/ContainmentType.ts","../../src/layaAir/laya/d3/math/CollisionUtils.ts","../../src/layaAir/laya/d3/math/Viewport.ts","../../src/layaAir/laya/d3/utils/Picker.ts","../../src/layaAir/laya/d3/core/RenderableSprite3D.ts","../../src/layaAir/laya/d3/core/MeshSprite3DShaderDeclaration.ts","../../src/layaAir/laya/d3/math/Bounds.ts","../../src/layaAir/laya/d3/component/Volume/reflectionProbe/ReflectionProbeManager.ts","../../src/layaAir/laya/d3/core/render/Sprite3DRenderDeclaration.ts","../../src/layaAir/laya/d3/component/Volume/VolumetricGI/VolumetricGIManager.ts","../../src/layaAir/laya/d3/component/Volume/VolumeManager.ts","../../src/layaAir/laya/d3/graphics/SphericalHarmonicsL2.ts","../../src/layaAir/laya/d3/core/render/RenderElement.ts","../../src/layaAir/laya/d3/core/GeometryElement.ts","../../src/layaAir/laya/d3/resource/models/SkyBox.ts","../../src/layaAir/laya/d3/graphics/Vertex/VertexPositionTexture0.ts","../../src/layaAir/laya/d3/resource/models/SkyDome.ts","../../src/layaAir/laya/d3/resource/models/SkyRenderer.ts","../../src/layaAir/laya/d3/core/BaseCamera.ts","../../src/layaAir/laya/d3/core/render/RenderContext3D.ts","../../src/layaAir/laya/d3/core/render/ScreenQuad.ts","../../src/layaAir/laya/d3/core/render/command/Command.ts","../../src/layaAir/laya/d3/core/render/command/BlitScreenQuadCMD.ts","../../src/layaAir/laya/d3/core/render/command/SetRenderTargetCMD.ts","../../src/layaAir/laya/d3/core/render/command/SetShaderDataCMD.ts","../../src/layaAir/laya/d3/core/material/BlinnPhongMaterial.ts","../../src/layaAir/laya/d3/core/MeshFilter.ts","../../src/layaAir/laya/d3/core/render/SubMeshRenderElement.ts","../../src/layaAir/laya/d3/resource/models/MeshUtil.ts","../../src/layaAir/laya/d3/core/MeshRenderer.ts","../../src/layaAir/laya/d3/core/render/command/DrawMeshCMD.ts","../../src/layaAir/laya/d3/core/render/command/ClearRenderTextureCMD.ts","../../src/layaAir/laya/d3/core/render/command/DrawRenderCMD.ts","../../src/layaAir/laya/d3/core/render/command/SetGlobalShaderDataCMD.ts","../../src/layaAir/laya/d3/graphics/MeshInstanceGeometry.ts","../../src/layaAir/laya/d3/core/render/command/DrawMeshInstancedCMD.ts","../../src/layaAir/laya/d3/core/render/command/CommandBuffer.ts","../../src/layaAir/laya/d3/physics/PhysicsSettings.ts","../../src/layaAir/laya/d3/core/light/LightQueue.ts","../../src/layaAir/laya/d3/core/scene/Lightmap.ts","../../src/layaAir/laya/d3/core/scene/Scene3DShaderDeclaration.ts","../../src/layaAir/laya/d3/math/BoundSphere.ts","../../src/layaAir/laya/d3/shadowMap/ShadowSliceData.ts","../../src/layaAir/laya/d3/graphics/FrustumCulling.ts","../../src/layaAir/laya/d3/shadowMap/ShadowCasterPass.ts","../../src/layaAir/laya/d3/core/render/command/BlitFrameBufferCMD.ts","../../src/layaAir/laya/d3/core/scene/SceneRenderManager.ts","../../src/layaAir/laya/d3/core/UI3D/UI3DManager.ts","../../src/layaAir/laya/d3/core/scene/bvh/SpatialManager.ts","../../src/layaAir/laya/d3/core/scene/bvh/BVHSpatialBox.ts","../../src/layaAir/laya/d3/core/scene/bvh/BVHSpatial.ts","../../src/layaAir/laya/d3/core/scene/BVHSceneRenderManager/BVHRenderSpatialBox.ts","../../src/layaAir/laya/d3/core/scene/BVHSceneRenderManager/BVHRenderSpatial.ts","../../src/layaAir/laya/d3/core/scene/BVHSceneRenderManager/BVHSceneRenderManager.ts","../../src/layaAir/laya/d3/RenderObjs/RenderObj/CullPass.ts","../../src/layaAir/laya/d3/core/scene/BVHSceneRenderManager/BVHCullPass.ts","../../src/layaAir/laya/d3/core/render/PostProcessRenderContext.ts","../../src/layaAir/laya/d3/core/render/PostProcessEffect.ts","../../bin/tsc/layaAir/laya/d3/shader/postprocess/BlitScreen.vs","../../src/layaAir/laya/d3/core/render/PostEffect/ColorGradEffect.ts","../../src/layaAir/laya/d3/core/material/PBRRenderQuality.ts","../../bin/tsc/layaAir/laya/d3/shader/postprocess/BlitLUTScreen.fs","../../src/layaAir/laya/d3/component/PostProcess.ts","../../src/layaAir/laya/d3/shader/pbr/PBRDefaultDFG.ts","../../src/layaAir/laya/d3/shader/pbr/PBRShaderLib.ts","../../bin/tsc/layaAir/laya/d3/shader/pbr/BRDF.glsl","../../bin/tsc/layaAir/laya/d3/shader/pbr/pbrGI.glsl","../../bin/tsc/layaAir/laya/d3/shader/pbr/pbrCommon.glsl","../../bin/tsc/layaAir/laya/d3/shader/pbr/pbrVertex.glsl","../../bin/tsc/layaAir/laya/d3/shader/pbr/pbrFrag.glsl","../../bin/tsc/layaAir/laya/d3/shader/pbr/pbrMetallicFrag.glsl","../../src/layaAir/laya/d3/core/material/PBRMaterial.ts","../../src/layaAir/laya/d3/core/material/PBRStandardMaterial.ts","../../src/layaAir/laya/d3/core/particleShuriKen/module/shape/BaseShape.ts","../../src/layaAir/laya/d3/core/trail/TrailAlignment.ts","../../src/layaAir/laya/Physics3D/physicsEnum/EPhycisCapable.ts","../../src/layaAir/laya/d3/core/material/SkyBoxMaterial.ts","../../src/layaAir/laya/d3/core/material/SkyProceduralMaterial.ts","../../src/layaAir/laya/d3/core/material/UnlitMaterial.ts","../../src/layaAir/laya/d3/core/MeshSprite3D.ts","../../src/layaAir/laya/d3/core/GradientMode.ts","../../src/layaAir/laya/d3/core/Gradient.ts","../../src/layaAir/laya/d3/core/particleShuriKen/module/Burst.ts","../../src/layaAir/laya/d3/core/particleShuriKen/module/GradientColor.ts","../../src/layaAir/laya/d3/core/particleShuriKen/module/ColorOverLifetime.ts","../../src/layaAir/laya/d3/core/particleShuriKen/module/FrameOverTime.ts","../../src/layaAir/laya/d3/core/particleShuriKen/module/GradientAngularVelocity.ts","../../src/layaAir/laya/d3/core/particleShuriKen/module/GradientDataInt.ts","../../src/layaAir/laya/d3/core/particleShuriKen/module/GradientDataNumber.ts","../../src/layaAir/laya/d3/core/particleShuriKen/module/GradientSize.ts","../../src/layaAir/laya/d3/core/particleShuriKen/module/GradientVelocity.ts","../../src/layaAir/laya/d3/core/particleShuriKen/module/RotationOverLifetime.ts","../../src/layaAir/laya/d3/math/BoundBox.ts","../../src/layaAir/laya/d3/core/particleShuriKen/module/shape/ShapeUtils.ts","../../src/layaAir/laya/d3/core/particleShuriKen/module/shape/BoxShape.ts","../../src/layaAir/laya/d3/core/particleShuriKen/module/shape/CircleShape.ts","../../src/layaAir/laya/d3/core/particleShuriKen/module/shape/ConeShape.ts","../../src/layaAir/laya/d3/core/particleShuriKen/module/shape/HemisphereShape.ts","../../src/layaAir/laya/d3/core/particleShuriKen/module/shape/SphereShape.ts","../../src/layaAir/laya/d3/core/particleShuriKen/module/SizeOverLifetime.ts","../../src/layaAir/laya/d3/core/particleShuriKen/module/StartFrame.ts","../../src/layaAir/laya/d3/core/particleShuriKen/module/TextureSheetAnimation.ts","../../src/layaAir/laya/d3/core/particleShuriKen/module/VelocityOverLifetime.ts","../../src/layaAir/laya/d3/graphics/Vertex/VertexShuriKenParticle.ts","../../src/layaAir/laya/d3/graphics/Vertex/VertexShurikenParticleBillboard.ts","../../src/layaAir/laya/d3/graphics/Vertex/VertexShurikenParticleMesh.ts","../../src/layaAir/laya/d3/math/Rand.ts","../../src/layaAir/laya/d3/core/particleShuriKen/module/Emission.ts","../../src/layaAir/laya/d3/core/particleShuriKen/ShuriKenParticle3DShaderDeclaration.ts","../../src/layaAir/laya/d3/core/particleShuriKen/ShurikenParticleData.ts","../../src/layaAir/laya/d3/core/particleShuriKen/ShurikenParticleSystem.ts","../../src/layaAir/laya/d3/core/particleShuriKen/ShurikenParticleInstanceSystem.ts","../../src/layaAir/laya/d3/core/particleShuriKen/ShurikenParticleRenderer.ts","../../src/layaAir/laya/d3/core/particleShuriKen/ShuriKenParticle3D.ts","../../src/layaAir/laya/d3/core/particleShuriKen/ShurikenParticleMaterial.ts","../../src/layaAir/laya/d3/core/pixelLine/PixelLineVertex.ts","../../src/layaAir/laya/d3/core/Transform3D.ts","../../src/layaAir/laya/d3/core/SkinnedMeshSprite3DShaderDeclaration.ts","../../src/layaAir/laya/d3/core/render/SkinRenderElement.ts","../../src/layaAir/laya/d3/core/SkinnedMeshRenderer.ts","../../src/layaAir/laya/d3/core/SkinnedMeshSprite3D.ts","../../src/layaAir/laya/d3/core/trail/TrailMaterial.ts","../../src/layaAir/laya/d3/core/TrailTextureMode.ts","../../src/layaAir/laya/d3/core/trail/VertexTrail.ts","../../src/layaAir/laya/d3/core/trail/TrailGeometry.ts","../../src/layaAir/laya/d3/core/trail/TrailFilter.ts","../../src/layaAir/laya/d3/core/trail/TrailRenderer.ts","../../src/layaAir/laya/d3/core/trail/TrailSprite3D.ts","../../src/layaAir/laya/d3/graphics/SubMeshInstanceBatch.ts","../../src/layaAir/laya/d3/graphics/Vertex/VertexPositionTerrain.ts","../../src/layaAir/laya/d3/core/render/InstanceRenderElement.ts","../../src/layaAir/laya/d3/resource/models/SubMesh.ts","../../src/layaAir/laya/d3/resource/models/Mesh.ts","../../src/layaAir/laya/d3/resource/models/PrimitiveMesh.ts","../../bin/tsc/layaAir/laya/d3/shader/utils/Utils.glsl","../../bin/tsc/layaAir/laya/d3/shader/postprocess/BlitScreen.fs","../../src/layaAir/laya/d3/shader/postprocess/BlitScreenShaderInit.ts","../../bin/tsc/layaAir/laya/d3/shader/postprocess/FastApproximateAntiAliasing.glsl","../../bin/tsc/layaAir/laya/d3/shader/postprocess/ColorGrading.glsl","../../bin/tsc/layaAir/laya/d3/shader/postprocess/Tonemapping.glsl","../../bin/tsc/layaAir/laya/d3/shader/postprocess/LUT.glsl","../../bin/tsc/layaAir/laya/d3/shader/postprocess/LUTBuilder.fs","../../bin/tsc/layaAir/laya/d3/shader/unlit/Unlit.vs","../../bin/tsc/layaAir/laya/d3/shader/depth/Depth.vs","../../bin/tsc/layaAir/laya/d3/shader/depth/Depth.fs","../../src/layaAir/laya/d3/shader/unlit/UnlitShaderInit.ts","../../bin/tsc/layaAir/laya/d3/shader/unlit/Unlit.fs","../../src/layaAir/laya/d3/shader/blinnphong/BlinnPhongShaderInit.ts","../../bin/tsc/layaAir/laya/d3/shader/blinnphong/BlinnPhongCommon.glsl","../../bin/tsc/layaAir/laya/d3/shader/blinnphong/BlinnPhongVertex.glsl","../../bin/tsc/layaAir/laya/d3/shader/blinnphong/BlinnPhongFrag.glsl","../../bin/tsc/layaAir/laya/d3/shader/blinnphong/BlinnPhong.vs","../../bin/tsc/layaAir/laya/d3/shader/blinnphong/BlinnPhong.fs","../../bin/tsc/layaAir/laya/d3/shader/blinnphong/BlinnPhongDepthNormal.vs","../../bin/tsc/layaAir/laya/d3/shader/blinnphong/BlinnPhongDepthNormal.fs","../../src/layaAir/laya/d3/shader/Trail/TrailShaderInit.ts","../../bin/tsc/layaAir/laya/d3/shader/Trail/Trail.vs","../../bin/tsc/layaAir/laya/d3/shader/Trail/Trail.fs","../../src/layaAir/laya/d3/shader/pbr/PBRStandardShaderInit.ts","../../bin/tsc/layaAir/laya/d3/shader/pbr/pbrStandard.vs","../../bin/tsc/layaAir/laya/d3/shader/pbr/pbrStandard.fs","../../bin/tsc/layaAir/laya/d3/shader/pbr/PBRStandardDepthNormal.vs","../../bin/tsc/layaAir/laya/d3/shader/pbr/PBRStandardDepthNormal.fs","../../src/layaAir/laya/d3/shader/sky/SkyBoxShaderInit.ts","../../bin/tsc/layaAir/laya/d3/shader/sky/SkyBox.vs","../../bin/tsc/layaAir/laya/d3/shader/sky/SkyBox.fs","../../src/layaAir/laya/d3/shader/ShurikenParticle/ParticleShuriKenShaderInit.ts","../../bin/tsc/layaAir/laya/d3/shader/ShurikenParticle/MathGradient.glsl","../../bin/tsc/layaAir/laya/d3/shader/ShurikenParticle/particleShuriKenSpriteVS.glsl","../../bin/tsc/layaAir/laya/d3/shader/ShurikenParticle/particleShuriKen.vs","../../bin/tsc/layaAir/laya/d3/shader/ShurikenParticle/particleShuriKen.fs","../../src/layaAir/laya/d3/shader/sky/SkyProceduralShaderInit.ts","../../bin/tsc/layaAir/laya/d3/shader/sky/SkyProceduralShader.vs","../../bin/tsc/layaAir/laya/d3/shader/sky/SkyProceduralShader.fs","../../src/layaAir/laya/d3/shader/sky/SkyPanoramicShaderInit.ts","../../bin/tsc/layaAir/laya/d3/shader/sky/SkyPanoramic.vs","../../bin/tsc/layaAir/laya/d3/shader/sky/SkyPanoramic.fs","../../src/layaAir/laya/d3/shader/postprocess/ACES/ACESShaderLib.ts","../../bin/tsc/layaAir/laya/d3/shader/postprocess/ACES/lib/UtillitiesColor.glsl","../../bin/tsc/layaAir/laya/d3/shader/postprocess/ACES/lib/TransformCommon.glsl","../../bin/tsc/layaAir/laya/d3/shader/postprocess/ACES/lib/Tonescales.glsl","../../bin/tsc/layaAir/laya/d3/shader/postprocess/ACES/lib/RRTCommon.glsl","../../bin/tsc/layaAir/laya/d3/shader/postprocess/ACES/lib/ODTCommon.glsl","../../bin/tsc/layaAir/laya/d3/shader/postprocess/ACES/rrt/RRT.glsl","../../bin/tsc/layaAir/laya/d3/shader/postprocess/ACES/odt/ODT_sRGB_100nits.glsl","../../bin/tsc/layaAir/laya/d3/shader/postprocess/ACES/ACES.glsl","../../src/layaAir/laya/d3/shader/ShaderInit3D.ts","../../bin/tsc/layaAir/laya/d3/shader/utils/Color.glsl","../../bin/tsc/layaAir/laya/d3/shader/utils/Math.glsl","../../bin/tsc/layaAir/laya/d3/shader/utils/BakedBoneMatrixSampler.glsl","../../bin/tsc/layaAir/laya/d3/shader/common/MorphTarget.glsl","../../bin/tsc/layaAir/laya/d3/shader/common/VertexCommon.glsl","../../bin/tsc/layaAir/laya/d3/shader/common/ShadingCommon.glsl","../../bin/tsc/layaAir/laya/d3/shader/common/ShadingVertex.glsl","../../bin/tsc/layaAir/laya/d3/shader/common/ShadingFrag.glsl","../../bin/tsc/layaAir/laya/d3/shader/common/OutputTransform.glsl","../../bin/tsc/layaAir/laya/d3/shader/common/SceneCommon.glsl","../../bin/tsc/layaAir/laya/d3/shader/common/CameraCommon.glsl","../../bin/tsc/layaAir/laya/d3/shader/common/Sprite3DCommon.glsl","../../bin/tsc/layaAir/laya/d3/shader/common/Sprite3DVertex.glsl","../../bin/tsc/layaAir/laya/d3/shader/common/Sprite3DFrag.glsl","../../bin/tsc/layaAir/laya/d3/shader/depth/DepthVertex.glsl","../../bin/tsc/layaAir/laya/d3/shader/depth/DepthFrag.glsl","../../bin/tsc/layaAir/laya/d3/shader/depth/DepthNormalUtil.glsl","../../bin/tsc/layaAir/laya/d3/shader/depth/DepthNormalFrag.glsl","../../bin/tsc/layaAir/laya/d3/shader/utils/SceneFog.glsl","../../bin/tsc/layaAir/laya/d3/shader/utils/SceneFogInput.glsl","../../bin/tsc/layaAir/laya/d3/shader/lighting/ShadowSampleTent.glsl","../../bin/tsc/layaAir/laya/d3/shader/lighting/ShadowSampler.glsl","../../bin/tsc/layaAir/laya/d3/shader/lighting/Lighting.glsl","../../bin/tsc/layaAir/laya/d3/shader/lighting/globalIllumination.glsl","../../bin/tsc/layaAir/laya/d3/shader/lighting/volumetricGI/Oct.glsl","../../bin/tsc/layaAir/laya/d3/shader/lighting/volumetricGI/GridHelpers.glsl","../../bin/tsc/layaAir/laya/d3/shader/lighting/volumetricGI/VolumetricGI.glsl","../../bin/tsc/layaAir/laya/d3/shader/lightingmode/BlinnPhongLighting.glsl","../../bin/tsc/layaAir/laya/d3/shader/lightingmode/PBRLighting.glsl","../../src/layaAir/laya/d3/core/SimpleSkinnedMeshRenderer.ts","../../src/layaAir/laya/d3/core/SimpleSkinnedMeshSprite3D.ts","../../src/layaAir/laya/d3/core/material/SkyPanoramicMaterial.ts","../../bin/tsc/layaAir/laya/d3/shader/files/postProcess/Bloom/Bloom.vs","../../src/layaAir/laya/d3/core/render/PostEffect/BloomEffect.ts","../../bin/tsc/layaAir/laya/d3/shader/files/postProcess/StdLib.glsl","../../bin/tsc/layaAir/laya/d3/shader/files/postProcess/Colors.glsl","../../bin/tsc/layaAir/laya/d3/shader/files/postProcess/Sampling.glsl","../../bin/tsc/layaAir/laya/d3/shader/files/postProcess/Bloom/BloomPrefilter13.fs","../../bin/tsc/layaAir/laya/d3/shader/files/postProcess/Bloom/BloomPrefilter4.fs","../../bin/tsc/layaAir/laya/d3/shader/files/postProcess/Bloom/BloomDownsample13.fs","../../bin/tsc/layaAir/laya/d3/shader/files/postProcess/Bloom/BloomDownsample4.fs","../../bin/tsc/layaAir/laya/d3/shader/files/postProcess/Bloom/BloomUpsampleTent.fs","../../bin/tsc/layaAir/laya/d3/shader/files/postProcess/Bloom/BloomUpsampleBox.fs","../../bin/tsc/layaAir/laya/d3/shader/files/postProcess/Bloom/Composite.vs","../../bin/tsc/layaAir/laya/d3/shader/files/postProcess/Bloom/Composite.fs","../../bin/tsc/layaAir/laya/d3/shader/files/postProcess/ScalableAO/FragAO.fs","../../src/layaAir/laya/d3/core/render/PostEffect/ScalableAO.ts","../../bin/tsc/layaAir/laya/d3/shader/files/postProcess/ScalableAO/AmbientOcclusion.glsl","../../bin/tsc/layaAir/laya/d3/shader/files/postProcess/ScalableAO/AoBlurHorizontal.fs","../../bin/tsc/layaAir/laya/d3/shader/files/postProcess/ScalableAO/AOComposition.fs","../../bin/tsc/layaAir/laya/d3/shader/files/postProcess/GaussianDoF/FullScreenVert.vs","../../src/layaAir/laya/d3/core/render/PostEffect/GaussianDoF.ts","../../bin/tsc/layaAir/laya/d3/shader/files/postProcess/GaussianDoF/CoC.fs","../../bin/tsc/layaAir/laya/d3/shader/files/postProcess/GaussianDoF/Prefilter.fs","../../bin/tsc/layaAir/laya/d3/shader/files/postProcess/GaussianDoF/BlurH.fs","../../bin/tsc/layaAir/laya/d3/shader/files/postProcess/GaussianDoF/BlurV.fs","../../bin/tsc/layaAir/laya/d3/shader/files/postProcess/GaussianDoF/Composite.fs","../../src/layaAir/laya/d3/core/render/PostEffect/LensFlares/LensFlareGeometry.ts","../../src/layaAir/laya/d3/core/render/PostEffect/LensFlares/LensFlareCMD.ts","../../bin/tsc/layaAir/laya/d3/shader/files/postProcess/LensFlare/LensFlare.vs","../../src/layaAir/laya/d3/core/scene/Scene3D.ts","../../src/layaAir/laya/d3/core/Camera.ts","../../src/layaAir/laya/d3/core/light/AreaLightCom.ts","../../src/layaAir/laya/d3/core/render/PostEffect/LensFlares/LensFlareShaderInit.ts","../../bin/tsc/layaAir/laya/d3/shader/files/postProcess/LensFlare/LensFlare.fs","../../src/layaAir/laya/d3/core/render/PostEffect/LensFlares/LensFlareEffect.ts","../../src/layaAir/Laya3D.ts","../../src/layaAir/laya/d3/core/light/DirectionLightCom.ts","../../src/layaAir/laya/d3/core/light/LightSprite.ts","../../src/layaAir/laya/d3/core/light/DirectionLight.ts","../../src/layaAir/laya/d3/core/light/PointLightCom.ts","../../src/layaAir/laya/d3/core/light/PointLight.ts","../../src/layaAir/laya/d3/core/light/SpotLightCom.ts","../../src/layaAir/laya/d3/core/light/SpotLight.ts","../../src/layaAir/laya/d3/core/material/EffectMaterial.ts","../../src/layaAir/laya/d3/core/material/ExtendTerrainMaterial.ts","../../src/layaAir/laya/d3/core/material/WaterPrimaryMaterial.ts","../../src/layaAir/laya/d3/component/Volume/VolumetricGI/VolumetricGI.ts","../../src/layaAir/laya/d3/component/LODGroup.ts","../../src/layaAir/laya/d3/core/pixelLine/PixelLineData.ts","../../src/layaAir/laya/d3/core/pixelLine/PixelLineFilter.ts","../../src/layaAir/laya/d3/core/pixelLine/PixelLineMaterial.ts","../../src/layaAir/laya/d3/core/pixelLine/PixelLineRenderer.ts","../../src/layaAir/laya/d3/component/Animator/AnimatorPlayState.ts","../../src/layaAir/laya/d3/component/Animator/AnimatorControllerLayer.ts","../../src/layaAir/laya/d3/component/Animator/AnimatorResource.ts","../../src/layaAir/laya/d3/component/Animator/AnimatorState.ts","../../src/layaAir/laya/d3/component/Animator/AvatarMask.ts","../../src/layaAir/laya/d3/component/Animator/Animator.ts","../../src/layaAir/laya/d3/component/Animator/AnimatorTransition.ts","../../src/layaAir/laya/d3/component/Animator/AnimatorController.ts","../../src/layaAir/laya/d3/core/render/BatchMark.ts","../../src/layaAir/laya/d3/graphics/Batch/InstanceBatchManager.ts","../../src/layaAir/laya/d3/component/Volume/BatchVolume/BatchRender.ts","../../src/layaAir/laya/d3/component/Volume/BatchVolume/StaticInstanceBatchRender.ts","../../src/layaAir/laya/d3/component/Volume/BatchVolume/StatiVertexMergeBatchRender.ts","../../src/layaAir/laya/d3/component/Volume/BatchVolume/StaticBatchVolume.ts","../../src/layaAir/laya/d3/core/UI3D/UI3DGeometry.ts","../../src/layaAir/laya/d3/core/UI3D/UI3D.ts","../../src/layaAir/laya/d3/loaders/CubemapLoader.ts","../../src/layaAir/laya/d3/loaders/AnimationClipLoader.ts","../../src/layaAir/laya/d3/loaders/LoadModelV04.ts","../../src/layaAir/laya/d3/resource/models/MorphTarget.ts","../../src/layaAir/laya/d3/resource/models/MorphTargetData.ts","../../src/layaAir/laya/d3/loaders/LoadModelV05.ts","../../src/layaAir/laya/d3/loaders/MeshReader.ts","../../src/layaAir/laya/d3/loaders/MeshLoader.ts","../../src/layaAir/laya/d3/loaders/HierarchyParserV2.ts","../../src/layaAir/laya/d3/loaders/AvatarMaskLoader.ts","../../src/layaAir/laya/d3/loaders/GLSLLoader.ts","../../src/layaAir/laya/d3/loaders/AnimationControllerLoader.ts","../../src/layaAir/laya/d3/ModuleDef.ts","../../src/layaAir/laya/d3/RenderObjs/NativeOBJ/NativeBaseRenderNode.ts","../../src/layaAir/laya/d3/graphics/Batch/RenderElementBatch.ts","../../src/layaAir/laya/d3/RenderObjs/NativeOBJ/NativeBaseRenderQueue.ts","../../src/layaAir/laya/d3/RenderObjs/NativeOBJ/NativeBounds.ts","../../src/layaAir/laya/d3/RenderObjs/NativeOBJ/NativeCameraCullInfo.ts","../../src/layaAir/laya/d3/RenderObjs/NativeOBJ/NativeCullPass.ts","../../src/layaAir/laya/d3/graphics/IndexBuffer3D.ts","../../src/layaAir/laya/d3/RenderObjs/NativeOBJ/NativeIndexBuffer3D.ts","../../src/layaAir/laya/d3/RenderObjs/NativeOBJ/NativeRenderElementOBJ.ts","../../src/layaAir/laya/d3/RenderObjs/NativeOBJ/NativeShaderInstance.ts","../../src/layaAir/laya/d3/RenderObjs/NativeOBJ/NativeInstanceRenderElementOBJ.ts","../../src/layaAir/laya/d3/RenderObjs/NativeOBJ/NativeRenderContext3DOBJ.ts","../../src/layaAir/laya/d3/RenderObjs/NativeOBJ/NativeRenderGeometryElementOBJ.ts","../../src/layaAir/laya/d3/RenderObjs/NativeOBJ/NativeSceneRenderManager.ts","../../src/layaAir/laya/d3/RenderObjs/NativeOBJ/NativeShadowCullInfo.ts","../../src/layaAir/laya/d3/RenderObjs/NativeOBJ/NativeSkinRenderElementOBJ.ts","../../src/layaAir/laya/d3/RenderObjs/NativeOBJ/NativeTransform3D.ts","../../src/layaAir/laya/d3/graphics/VertexBuffer3D.ts","../../src/layaAir/laya/d3/RenderObjs/NativeOBJ/NativeVertexBuffer3D.ts","../../src/layaAir/laya/d3/RenderObjs/RenderObj/BaseRenderNode.ts","../../src/layaAir/laya/d3/RenderObjs/RenderObj/BaseRenderQueue.ts","../../src/layaAir/laya/d3/RenderObjs/RenderObj/CameraCullInfo.ts","../../src/layaAir/laya/d3/RenderObjs/RenderObj/RenderElementOBJ.ts","../../src/layaAir/laya/d3/RenderObjs/RenderObj/InstanceRenderElementOBJ.ts","../../src/layaAir/laya/d3/RenderObjs/RenderObj/QuickSort.ts","../../src/layaAir/laya/d3/RenderObjs/RenderObj/RenderContext3DOBJ.ts","../../src/layaAir/laya/d3/RenderObjs/RenderObj/RenderGeometryElementOBJ.ts","../../src/layaAir/laya/d3/RenderObjs/RenderObj/SceneRenderManagerOBJ.ts","../../src/layaAir/laya/d3/RenderObjs/RenderObj/ShadowCullInfo.ts","../../src/layaAir/laya/d3/RenderObjs/RenderObj/SkinRenderElementOBJ.ts","../../src/layaAir/laya/d3/math/BoundsImpl.ts","../../src/layaAir/laya/d3/RenderObjs/RenderObj/WebGLRenderEngine3DFactory.ts","../../src/layaAir/laya/d3/physics/HitResult.ts","../../src/layaAir/laya/d3/loaders/LensFlareSettingsLoader.ts","../../src/layaAir/laya/d3/loaders/Texture3DLoader.ts","../../src/layaAir/laya/Physics3D/physicsEnum/ECharacterCapable.ts","../../src/layaAir/laya/Physics3D/physicsEnum/EColliderCapable.ts","../../src/layaAir/laya/Physics3D/physicsEnum/EJointCapable.ts","../../src/layaAir/laya/Physics3D/interface/Joint/ID6Joint.ts","../../src/layaAir/laya/d3/math/RandX.ts","../../src/layaAir/laya/d3/utils/Physics3DUtils.ts","../../src/layaAir/laya/d3/utils/Size.ts","../../src/layaAir/laya/d3/WebXR/core/WebXRRenderTexture.ts","../../src/layaAir/laya/d3/WebXR/core/WebXRSessionManager.ts","../../src/layaAir/laya/d3/WebXR/core/WebXRCameraManager.ts","../../src/layaAir/laya/d3/WebXR/core/WebXRGamepad.ts","../../src/layaAir/laya/d3/WebXR/core/WebXRInput.ts","../../src/layaAir/laya/d3/WebXR/core/WebXRInputManager.ts","../../src/layaAir/laya/d3/WebXR/core/WebXRExperienceHelper.ts","../../src/layaAir/laya/d3/WebXR/core/WebXRCamera.ts","../../src/layaAir/laya/d3/component/Script3D.ts","../../src/layaAir/laya/d3/component/HLOD/HLODRender.ts","../../src/layaAir/laya/d3/component/HLOD/HLOD.ts","../../src/layaAir/laya/d3/component/staticmesh/StaticBatchSubMesh.ts","../../src/layaAir/laya/d3/component/staticmesh/StaticBatchMesh.ts","../../src/layaAir/laya/d3/component/staticmesh/StaticBatchMeshRenderElement.ts","../../src/layaAir/laya/d3/component/staticmesh/StaticBatchMeshRender.ts","../../src/layaAir/laya/d3/component/staticmesh/StaticMeshMergeInfo.ts","../../src/layaAir/laya/d3/core/TransLargeUBOUtils.ts","../../src/layaAir/laya/d3/core/scene/Input3D.ts","../../src/layaAir/laya/d3/core/particleShuriKen/module/GradientDataVector2.ts","../../src/layaAir/laya/d3/core/render/command/MaterialInstanceProperty.ts","../../src/layaAir/laya/d3/core/render/command/MaterialInstancePropertyBlock.ts","../../src/layaAir/laya/d3/animation/AnimatorStateScript.ts","../../src/layaAir/laya/d3/physics/Collision.ts","../../src/layaAir/laya/d3/physics/ContactPoint.ts","../../src/layaAir/laya/d3/component/HLOD/HLODBatchMesh.ts","../../src/layaAir/laya/d3/component/HLOD/HLODUtil.ts","../../src/layaAir/laya/d3/RenderObjs/NativeOBJ/NativeGLRenderEngine3DOBJFactory.ts","../../src/layaAir/laya/d3/core/pixelLine/PixelLineSprite3D.ts","../../src/layaAir/laya/d3/component/staticmesh/StaticMeshBatchManager.ts","../../src/layaAir/laya/d3/text/TextMesh.ts"],"sourcesContent":["import { Shader3D } from \"../../RenderEngine/RenderShader/Shader3D\";\r\nimport { UniformBufferParamsType, UnifromBufferData } from \"../../RenderEngine/UniformBufferData\";\r\n\r\nexport class DepthCasterData{\r\n    static DepthCasterUBOData: UnifromBufferData;\r\n    /**\r\n     * create DepthCaster UniformBuffer\r\n     * @internal\r\n     * @returns \r\n     */\r\n    static createDepthCasterUniformBlock(): UnifromBufferData {\r\n\r\n        if (!DepthCasterData.DepthCasterUBOData) {\r\n            let uniformpara = new Map<number, UniformBufferParamsType>();\r\n            uniformpara.set(Shader3D.propertyNameToID(\"u_ShadowBias\"), UniformBufferParamsType.Vector4);\r\n            uniformpara.set(Shader3D.propertyNameToID(\"u_ShadowLightDirection\"), UniformBufferParamsType.Vector3);\r\n            DepthCasterData.DepthCasterUBOData = new UnifromBufferData(uniformpara);\r\n        }\r\n\r\n        return DepthCasterData.DepthCasterUBOData;\r\n    }\r\n}","import { Config3D } from \"../../../Config3D\";\r\nimport { Camera } from \"../core/Camera\";\r\nimport { RenderContext3D } from \"../core/render/RenderContext3D\";\r\nimport { RenderTargetFormat } from \"../../RenderEngine/RenderEnum/RenderTargetFormat\";\r\nimport { Shader3D } from \"../../RenderEngine/RenderShader/Shader3D\";\r\nimport { ShaderData } from \"../../RenderEngine/RenderShader/ShaderData\";\r\nimport { ShaderDefine } from \"../../RenderEngine/RenderShader/ShaderDefine\";\r\nimport { UnifromBufferData } from \"../../RenderEngine/UniformBufferData\";\r\nimport { UniformBufferObject } from \"../../RenderEngine/UniformBufferObject\";\r\nimport { Viewport } from \"../math/Viewport\";\r\nimport { RenderClearFlag } from \"../../RenderEngine/RenderEnum/RenderClearFlag\";\r\nimport { BufferUsage } from \"../../RenderEngine/RenderEnum/BufferTargetType\";\r\nimport { Stat } from \"../../utils/Stat\";\r\nimport { DepthCasterData } from \"./DepthCasterData\";\r\nimport { Color } from \"../../maths/Color\";\r\nimport { Vector4 } from \"../../maths/Vector4\";\r\nimport { RenderTexture } from \"../../resource/RenderTexture\";\r\nimport { LayaGL } from \"../../layagl/LayaGL\";\r\n\r\n\r\n/**\r\n * \r\n */\r\nexport enum DepthTextureMode {\r\n    /** */\r\n    None = 0,\r\n    /** */\r\n    Depth = 1,\r\n    /**+ */\r\n    DepthNormals = 2,\r\n    /**  TODO*/\r\n    DepthAndDepthNormals = 3,\r\n    MotionVectors = 4,\r\n}\r\n/**\r\n * <code>ShadowCasterPass</code> \r\n */\r\nexport class DepthPass {\r\n    private static SHADOW_BIAS: Vector4 = new Vector4();\r\n    /** @internal */\r\n    static DEPTHPASS: ShaderDefine;\r\n    /** @internal */\r\n    static DEFINE_SHADOW_BIAS: number;\r\n    /**@internal */\r\n    static DEPTHTEXTURE: number;\r\n    /**@internal */\r\n    static DEPTHNORMALSTEXTURE: number;\r\n    /**@internal */\r\n    static DEPTHZBUFFERPARAMS: number;\r\n    /**@internal */\r\n    static SHADOWUNIFORMBLOCK: number;\r\n\r\n\r\n    static __init__() {\r\n        DepthPass.DEPTHPASS = Shader3D.getDefineByName(\"DEPTHPASS\");\r\n        DepthPass.DEFINE_SHADOW_BIAS = Shader3D.propertyNameToID(\"u_ShadowBias\");\r\n        DepthPass.DEPTHTEXTURE = Shader3D.propertyNameToID(\"u_CameraDepthTexture\");\r\n        DepthPass.DEPTHNORMALSTEXTURE = Shader3D.propertyNameToID(\"u_CameraDepthNormalsTexture\");\r\n        DepthPass.DEPTHZBUFFERPARAMS = Shader3D.propertyNameToID(\"u_ZBufferParams\");\r\n        DepthPass.SHADOWUNIFORMBLOCK = Shader3D.propertyNameToID(UniformBufferObject.UBONAME_SHADOW);\r\n    }\r\n\r\n    /**@internal */\r\n    private _depthTexture: RenderTexture;\r\n    /**@internal */\r\n    private _depthNormalsTexture: RenderTexture;\r\n    /**@internal */\r\n    private _viewPort: Viewport;\r\n    /**@internal */\r\n    private _camera: Camera;\r\n    /** @internal */\r\n    private _castDepthData: UnifromBufferData;\r\n    /** @internal */\r\n    private _castDepthUBO: UniformBufferObject;\r\n    /**@internal */\r\n    //private _castDepthBuffer:\r\n    private _defaultNormalDepthColor = new Color(0.5, 0.5, 1.0, 0.0);\r\n    // Values used to linearize the Z buffer (http://www.humus.name/temp/Linearize%20depth.txt)\r\n    // x = 1-far/near\r\n    // y = far/near\r\n    // z = x/far\r\n    // w = y/far\r\n    // or in case of a reversed depth buffer (UNITY_REVERSED_Z is 1)\r\n    // x = -1+far/near\r\n    // y = 1\r\n    // z = x/far\r\n    // w = 1/far\r\n    /**@internal */\r\n    private _zBufferParams: Vector4 = new Vector4();\r\n\r\n    constructor() {\r\n        if (Config3D._uniformBlock) {\r\n            this._castDepthData = DepthCasterData.createDepthCasterUniformBlock();\r\n            this._castDepthUBO = UniformBufferObject.getBuffer(UniformBufferObject.UBONAME_SHADOW, 0);\r\n            if (!this._castDepthUBO) {\r\n                this._castDepthUBO = UniformBufferObject.create(UniformBufferObject.UBONAME_SHADOW, BufferUsage.Dynamic, this._castDepthData.getbyteLength(), true);\r\n            }\r\n\r\n        }\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @param camera \r\n     * @param depthType \r\n     */\r\n    update(camera: Camera, depthType: DepthTextureMode, depthTextureFormat: RenderTargetFormat): void {\r\n        this._viewPort = camera.viewport;\r\n        this._camera = camera;\r\n        switch (depthType) {\r\n            case DepthTextureMode.Depth:\r\n                camera.depthTexture = this._depthTexture = RenderTexture.createFromPool(this._viewPort.width, this._viewPort.height, depthTextureFormat, RenderTargetFormat.None, false, 1);\r\n                break;\r\n            case DepthTextureMode.DepthNormals:\r\n                camera.depthNormalTexture = this._depthNormalsTexture = RenderTexture.createFromPool(this._viewPort.width, this._viewPort.height, RenderTargetFormat.R8G8B8A8, depthTextureFormat, false, 1);\r\n                break;\r\n            case DepthTextureMode.MotionVectors:\r\n                //TODO\r\n                break;\r\n            default:\r\n                throw (\"there is UnDefined type of DepthTextureMode\")\r\n        }\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @param context \r\n     * @param depthType \r\n     */\r\n    render(context: RenderContext3D, depthType: DepthTextureMode): void {\r\n        var scene = context.scene;\r\n        var shaderValues: ShaderData = scene._shaderValues;\r\n        //this._castDepthUBO && shaderValues.setValueData(Shader3D.propertyNameToID(UniformBufferObject.UBONAME_SHADOW), this._castDepthUBO);\r\n        switch (depthType) {\r\n            case DepthTextureMode.Depth:\r\n                context.pipelineMode = \"ShadowCaster\";\r\n                shaderValues.addDefine(DepthPass.DEPTHPASS);\r\n                shaderValues.setVector(DepthPass.DEFINE_SHADOW_BIAS, DepthPass.SHADOW_BIAS);\r\n                var offsetX: number = this._viewPort.x;\r\n                var offsetY: number = this._viewPort.y;\r\n                this._depthTexture._start();\r\n                LayaGL.renderEngine.viewport(offsetX, offsetY, this._viewPort.width, this._viewPort.height);\r\n                LayaGL.renderEngine.scissor(offsetX, offsetY, this._viewPort.width, this._viewPort.height);\r\n                LayaGL.renderEngine.clearRenderTexture(RenderClearFlag.Depth, null, 1);\r\n                context.changeViewport(offsetX, offsetY, this._viewPort.width, this._viewPort.height);\r\n                context.changeScissor(offsetX, offsetY, this._viewPort.width, this._viewPort.height);\r\n                context.destTarget = this._depthTexture;\r\n                Stat.depthCastDrawCall += scene._opaqueQueue.renderQueue(context);\r\n                this._depthTexture._end();\r\n                this._setupDepthModeShaderValue(depthType, this._camera);\r\n                context.pipelineMode = context.configPipeLineMode;\r\n                shaderValues.removeDefine(DepthPass.DEPTHPASS);\r\n                break;\r\n            case DepthTextureMode.DepthNormals:\r\n                context.pipelineMode = \"DepthNormal\";\r\n                this._depthNormalsTexture._start();\r\n                //shader\r\n                var offsetX: number = this._viewPort.x;\r\n                var offsetY: number = this._viewPort.y;\r\n                LayaGL.renderEngine.viewport(offsetX, offsetY, this._viewPort.width, this._viewPort.height);\r\n                LayaGL.renderEngine.scissor(offsetX, offsetY, this._viewPort.width, this._viewPort.height);\r\n                LayaGL.renderEngine.clearRenderTexture(RenderClearFlag.Color | RenderClearFlag.Depth, this._defaultNormalDepthColor, 1)\r\n                context.destTarget = this._depthNormalsTexture;\r\n                context.changeViewport(offsetX, offsetY, this._viewPort.width, this._viewPort.height);\r\n                context.changeScissor(offsetX, offsetY, this._viewPort.width, this._viewPort.height);\r\n                Stat.depthCastDrawCall += scene._opaqueQueue.renderQueue(context);\r\n                this._depthNormalsTexture._end();\r\n                this._setupDepthModeShaderValue(depthType, this._camera);\r\n                context.pipelineMode = context.configPipeLineMode;\r\n                break;\r\n            case DepthTextureMode.MotionVectors:\r\n                break;\r\n            default:\r\n                throw (\"there is UnDefined type of DepthTextureMode\")\r\n        }\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @internal\r\n     */\r\n    _setupDepthModeShaderValue(depthType: DepthTextureMode, camera: Camera) {\r\n        switch (depthType) {\r\n            case DepthTextureMode.Depth:\r\n                var far = camera.farPlane;\r\n                var near = camera.nearPlane;\r\n                this._zBufferParams.setValue(1.0 - far / near, far / near, (near - far) / (near * far), 1 / near);\r\n                camera._shaderValues.setVector(DepthPass.DEFINE_SHADOW_BIAS, DepthPass.SHADOW_BIAS);\r\n                camera._shaderValues.setTexture(DepthPass.DEPTHTEXTURE, this._depthTexture);\r\n                camera._shaderValues.setVector(DepthPass.DEPTHZBUFFERPARAMS, this._zBufferParams);\r\n                break;\r\n            case DepthTextureMode.DepthNormals:\r\n                camera._shaderValues.setTexture(DepthPass.DEPTHNORMALSTEXTURE, this._depthNormalsTexture);\r\n                break;\r\n            case DepthTextureMode.MotionVectors:\r\n                break;\r\n            default:\r\n                throw (\"there is UnDefined type of DepthTextureMode\")\r\n        }\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @internal\r\n     */\r\n    cleanUp(): void {\r\n        (this._depthTexture instanceof RenderTexture)&& this._depthTexture && RenderTexture.recoverToPool(this._depthTexture);\r\n        this._depthNormalsTexture && RenderTexture.recoverToPool(this._depthNormalsTexture);\r\n        this._depthTexture = null;\r\n        this._depthNormalsTexture = null;\r\n    }\r\n}\r\n\r\n","import { IClone } from \"../../utils/IClone\";\r\n/**\r\n * \r\n */\r\n export enum WeightedMode {\r\n\t\r\n\t\r\n\tNone = 0,\r\n\tIn = 1,\r\n\tOut = 2,\r\n\tBoth = 3,\r\n}\r\n/**\r\n * <code>KeyFrame</code> \r\n */\r\nexport class Keyframe implements IClone {\r\n\tstatic defaultWeight:number = 0.33333;\r\n\t/***/\r\n\ttime: number;\r\n\r\n\t/**\r\n\t *  <code>KeyFrame</code> \r\n\t */\r\n\tconstructor() {\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t * @param\tdestObject \r\n\t */\r\n\tcloneTo(destObject: any): void {\r\n\t\tvar destKeyFrame: Keyframe = (<Keyframe>destObject);\r\n\t\tdestKeyFrame.time = this.time;\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t * @return\t \r\n\t */\r\n\tclone(): any {\r\n\t\tvar dest: Keyframe = new Keyframe();\r\n\t\t\r\n\t\tthis.cloneTo(dest);\r\n\t\treturn dest;\r\n\t}\r\n\r\n}\r\n\r\n\r\n","import { Quaternion } from \"../../../maths/Quaternion\";\r\nimport { Vector3 } from \"../../../maths/Vector3\";\r\n\r\nexport enum KeyFrameValueType {\r\n\tNone = -1,\r\n\tFloat = 0,\r\n\tPosition = 1,\r\n\tRotation = 2,\r\n\tScale = 3,\r\n\tRotationEuler = 4,\r\n\tVector2 = 5,\r\n\tVector3 = 6,\r\n\tVector4 = 7,\r\n\tColor = 8\r\n}\r\n/**\r\n * @internal\r\n * <code>KeyframeNodeOwner</code> \r\n */\r\nexport class KeyframeNodeOwner {\r\n\t/**@internal */\r\n\tindexInList: number = -1;\r\n\t/**@internal */\r\n\treferenceCount: number = 0;\r\n\t/**@internal */\r\n\tupdateMark: number = -1;\r\n\r\n\t/**@internal 0 float,1 position,2 rotation,3 Scale,4 rotationEuler*/\r\n\ttype: KeyFrameValueType = -1;\r\n\t/**@internal */\r\n\tfullPath: string | null = null;\r\n\tnodePath: string | null = null;\r\n\t/**@internal */\r\n\tpropertyOwner: any = null;\r\n\t/**@internal */\r\n\tproperty: string[] | null = null;\r\n\t/**@internal */\r\n\tdefaultValue: any = null;\r\n\t/**@internal */\r\n\tvalue: any = null;\r\n\t/**@internal */\r\n\tcrossFixedValue: any = null;\r\n\t/**@internal */\r\n\tisMaterial: boolean = false;\r\n\t\r\n\t/**@internal */\r\n\tcallbackFunData:string;\r\n\t/**@internal */\r\n\tcallBackOwner:any;\r\n\t/**@internal */\r\n\tcallbackFun:string;\r\n\t/**@internal */\r\n\tcallParams:any[];\r\n\r\n\t/**\r\n\t *  <code>KeyframeNodeOwner</code> \r\n\t */\r\n\tconstructor() {\r\n\t}\r\n\r\n\t/**\r\n\t * @internal\r\n\t */\r\n\tsaveCrossFixedValue(): void {\r\n\t\tvar pro: any = this.propertyOwner;\r\n\t\tif (pro) {\r\n\t\t\tswitch (this.type) {\r\n\t\t\t\tcase 0:\r\n\t\t\t\t\tthis.crossFixedValue = this.value;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 1:\r\n\t\t\t\tcase 3:\r\n\t\t\t\tcase 4:\r\n\t\t\t\t\t(<Vector3>this.value).cloneTo(this.crossFixedValue);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 2:\r\n\t\t\t\t\t(<Quaternion>this.value).cloneTo(this.crossFixedValue);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tdefault:\r\n\t\t\t\t\tthrow \"Animator:unknown type.\";\r\n\t\t\t}\r\n\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @internal\r\n\t */\r\n\tanimatorDataSetCallBack(){\r\n\t\tlet fn:Function = this.callBackOwner[this.callbackFun];\r\n\t\tfn.apply(this.callBackOwner,this.callParams);\r\n\t}\r\n\t\r\n\t/**\r\n\t * @internal\r\n\t */\r\n\tgetCallbackNode(){\r\n\t\tif(this.propertyOwner&&this.callbackFunData){\r\n\t\t\tlet funPropertys = this.callbackFunData.split(\".\");\r\n\t\t\tthis.callBackOwner = this.propertyOwner;\r\n\t\t\tfor(let i = 0,n = funPropertys.length-1;i<n;i++){\r\n\t\t\t\tthis.callBackOwner = this.callBackOwner[funPropertys[i]];\r\n\t\t\t}\r\n\t\t\tthis.callbackFun = funPropertys[funPropertys.length-1];\r\n\t\t}\r\n\t}\r\n}\r\n\r\n\r\n","import { KeyFrameValueType } from \"../component/Animator/KeyframeNodeOwner\";\r\nimport { Keyframe } from \"../core/Keyframe\"\r\n\r\n/**\r\n *<code>KeyframeNode</code> \r\n */\r\nexport class KeyframeNode {\r\n\tprivate _ownerPath: string[] = [];\r\n\tprivate _propertys: string[] = [];\r\n\r\n\t/**@internal */\r\n\t_keyFrames: Keyframe[] = [];\r\n\t/**@internal */\r\n\t_indexInList: number;\r\n\r\n\t/**@internal */\r\n\ttype: KeyFrameValueType;\r\n\t/**@internal */\r\n\tfullPath: string;\r\n\t/**@internal */\r\n\tnodePath: string;\r\n\t/**@internal */\r\n\tpropertyOwner: string;\r\n\t/**@internal call bake fun*/\r\n\tcallbackFunData: string;\r\n\t/**@internal apply params*/\r\n\tcallParams: any[];\r\n\t/**\r\n\t * @internal\r\n\t * ide\r\n\t */\r\n\tpropertyChangePath: string;\r\n\r\n\t/**\r\n\t * \r\n\t */\r\n\tget ownerPathCount(): number {\r\n\t\treturn this._ownerPath.length;\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t */\r\n\tget propertyCount(): number {\r\n\t\treturn this._propertys.length;\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t */\r\n\tget keyFramesCount(): number {\r\n\t\treturn this._keyFrames.length;\r\n\t}\r\n\r\n\t/**\r\n\t * @internal\r\n\t */\r\n\t_setOwnerPathCount(value: number): void {\r\n\t\tthis._ownerPath.length = value;\r\n\t}\r\n\r\n\t/**\r\n\t * @internal\r\n\t */\r\n\t_setOwnerPathByIndex(index: number, value: string): void {\r\n\t\tthis._ownerPath[index] = value;\r\n\t}\r\n\r\n\t/**\r\n\t * @internal\r\n\t */\r\n\t_joinOwnerPath(sep: string): string {\r\n\t\treturn this._ownerPath.join(sep);\r\n\t}\r\n\r\n\t/**\r\n\t * @internal\r\n\t */\r\n\t_setPropertyCount(value: number): void {\r\n\t\tthis._propertys.length = value;\r\n\t}\r\n\r\n\t/**\r\n\t * @internal\r\n\t */\r\n\t_setPropertyByIndex(index: number, value: string): void {\r\n\t\tthis._propertys[index] = value;\r\n\t}\r\n\r\n\t/**\r\n\t * @internal\r\n\t */\r\n\t_joinProperty(sep: string): string {\r\n\t\treturn this._propertys.join(sep);\r\n\t}\r\n\r\n\t/**\r\n\t * @internal\r\n\t */\r\n\t_setKeyframeCount(value: number): void {\r\n\t\tthis._keyFrames.length = value;\r\n\t}\r\n\r\n\t/**\r\n\t * @internal\r\n\t */\r\n\t_setKeyframeByIndex(index: number, value: Keyframe): void {\r\n\t\tthis._keyFrames[index] = value;\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t * @param index \r\n\t */\r\n\tgetOwnerPathByIndex(index: number): string {\r\n\t\treturn this._ownerPath[index];\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t * @param index \r\n\t */\r\n\tgetPropertyByIndex(index: number): string {\r\n\t\treturn this._propertys[index];\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t * @param index \r\n\t */\r\n\tgetKeyframeByIndex(index: number): Keyframe {\r\n\t\treturn this._keyFrames[index];\r\n\t}\r\n}","/**\r\n * <code>AnimationEvent</code> \r\n */\r\nexport class AnimationEvent {\r\n\t/** */\r\n\ttime: number;\r\n\t/** */\r\n\teventName: string;\r\n\t/** */\r\n\tparams: any[];\r\n\r\n\t/**\r\n\t *  <code>AnimationEvent</code> \r\n\t */\r\n\tconstructor() {\r\n\t}\r\n\r\n}\r\n\r\n\r\n","import { Keyframe, WeightedMode } from \"./Keyframe\";\r\n/**\r\n\t * <code>FloatKeyFrame</code> \r\n\t */\r\nexport class FloatKeyframe extends Keyframe {\r\n\t/** */\r\n\tinTangent: number;\r\n\t/** */\r\n\toutTangent: number;\r\n\t/** */\r\n\tvalue: number;\r\n\t/** */\r\n\tinWeight: number = Keyframe.defaultWeight;\r\n\t/** */\r\n\toutWeight: number = Keyframe.defaultWeight;\r\n\t/** */\r\n\tweightedMode: number = WeightedMode.None;\r\n\r\n\t/**\r\n\t *  <code>FloatKeyFrame</code> \r\n\t */\r\n\tconstructor() {\r\n\t\tsuper();\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t * @inheritDoc\r\n\t * @override\r\n\t */\r\n\tcloneTo(destObject: any): void {\r\n\t\tsuper.cloneTo(destObject);\r\n\t\tvar destKeyFrame: FloatKeyframe = (<FloatKeyframe>destObject);\r\n\t\tdestKeyFrame.inTangent = this.inTangent;\r\n\t\tdestKeyFrame.outTangent = this.outTangent;\r\n\t\tdestKeyFrame.value = this.value;\r\n\t\tdestKeyFrame.inTangent = this.inTangent;\r\n\t\tdestKeyFrame.outTangent = this.outTangent;\r\n\t\tdestKeyFrame.value = this.value;\r\n\t\tdestKeyFrame.inWeight = this.inWeight;\r\n\t\tdestKeyFrame.outWeight = this.outWeight;\r\n\t\tdestKeyFrame.weightedMode = this.weightedMode;\r\n\t}\r\n\r\n\tclone(): FloatKeyframe {\r\n\t\tlet f = new FloatKeyframe();\r\n\t\tthis.cloneTo(f);\r\n\t\treturn f;\r\n\t}\r\n\r\n}\r\n\r\n\r\n","import { Quaternion } from \"../../maths/Quaternion\";\r\nimport { Vector4 } from \"../../maths/Vector4\";\r\nimport { Keyframe } from \"./Keyframe\";\r\n\r\n/**\r\n * <code>QuaternionKeyframe</code> \r\n */\r\nexport class QuaternionKeyframe extends Keyframe {\r\n\t/** */\r\n\tinTangent: Vector4 = new Vector4();\r\n\t/** */\r\n\toutTangent: Vector4 = new Vector4();\r\n\t/** */\r\n\tvalue: Quaternion = new Quaternion();\r\n\t/** */\r\n\tinWeight: Vector4;\r\n\t/** */\r\n\toutWeight: Vector4;\r\n\t/***/\r\n\tweightedMode: Vector4;\r\n\r\n\t/**\r\n\t *  <code>QuaternionKeyframe</code> \r\n\t */\r\n\tconstructor(weightMode: boolean = false) {\r\n\t\tsuper();\r\n\t\tif (weightMode) {\r\n\t\t\tthis.inWeight = new Vector4();\r\n\t\t\tthis.outWeight = new Vector4();\r\n\t\t\tthis.weightedMode = new Vector4();\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t * @param\tdestObject \r\n\t * @override\r\n\t */\r\n\tcloneTo(dest: any): void {\r\n\t\tsuper.cloneTo(dest);\r\n\t\tvar destKeyFarme: QuaternionKeyframe = (<QuaternionKeyframe>dest);\r\n\t\tthis.inTangent.cloneTo(destKeyFarme.inTangent);\r\n\t\tthis.outTangent.cloneTo(destKeyFarme.outTangent);\r\n\t\tthis.value.cloneTo(destKeyFarme.value);\r\n\t\tif (this.weightedMode) {\r\n\t\t\tthis.inWeight.cloneTo(destKeyFarme.inWeight);\r\n\t\t\tthis.outWeight.cloneTo(destKeyFarme.outWeight);\r\n\t\t\tthis.weightedMode.cloneTo(destKeyFarme.weightedMode);\r\n\t\t}\r\n\t}\r\n}\r\n\r\n","import { Vector3 } from \"../../maths/Vector3\";\r\nimport { Keyframe, WeightedMode } from \"./Keyframe\";\r\n\r\n/**\r\n * <code>Vector3Keyframe</code> \r\n */\r\nexport class Vector3Keyframe extends Keyframe {\r\n\t/** */\r\n\tinTangent: Vector3 = new Vector3();\r\n\t/** */\r\n\toutTangent: Vector3 = new Vector3();\r\n\t/** */\r\n\tvalue: Vector3 = new Vector3();\r\n\t/** */\r\n\tinWeight: Vector3;\r\n\t/** */\r\n\toutWeight: Vector3;\r\n\t/** */\r\n\tweightedMode: Vector3;\r\n\r\n\r\n\t/**\r\n\t *  <code>Vector3Keyframe</code> \r\n\t */\r\n\tconstructor(weightMode:boolean = false) {\r\n\t\tsuper();\r\n\t\tif(weightMode){\r\n\t\t\tthis.inWeight = new Vector3(Keyframe.defaultWeight, Keyframe.defaultWeight, Keyframe.defaultWeight);\r\n\t\t\tthis.outWeight = new Vector3(Keyframe.defaultWeight, Keyframe.defaultWeight, Keyframe.defaultWeight);\r\n\t\t\tthis.weightedMode = new Vector3(WeightedMode.None, WeightedMode.None, WeightedMode.None);\r\n\t\t}\r\n\t\t\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t * @param\tdestObject \r\n\t * @override\r\n\t */\r\n\tcloneTo(dest: any): void {\r\n\t\tsuper.cloneTo(dest);\r\n\t\tvar destKeyFarme: Vector3Keyframe = (<Vector3Keyframe>dest);\r\n\t\tthis.inTangent.cloneTo(destKeyFarme.inTangent);\r\n\t\tthis.outTangent.cloneTo(destKeyFarme.outTangent);\r\n\t\tthis.value.cloneTo(destKeyFarme.value);\r\n\t\tif(this.weightedMode){\r\n\t\t\tthis.inWeight.cloneTo(destKeyFarme.inWeight);\r\n\t\t\tthis.outWeight.cloneTo(destKeyFarme.outWeight);\r\n\t\t\tthis.weightedMode.cloneTo(destKeyFarme.weightedMode);\r\n\t\t}\r\n\t\t\r\n\t}\r\n}","import { KeyframeNode } from \"./KeyframeNode\";\r\nimport { KeyframeNodeList } from \"./KeyframeNodeList\";\r\nimport { AnimationEvent } from \"./AnimationEvent\";\r\nimport { FloatKeyframe } from \"../core/FloatKeyframe\"\r\nimport { QuaternionKeyframe } from \"../core/QuaternionKeyframe\"\r\nimport { Vector3Keyframe } from \"../core/Vector3Keyframe\"\r\nimport { Byte } from \"../../utils/Byte\"\r\nimport { AnimationClip } from \"./AnimationClip\";\r\nimport { Quaternion } from \"../../maths/Quaternion\";\r\nimport { Vector3 } from \"../../maths/Vector3\";\r\nimport { Vector4 } from \"../../maths/Vector4\";\r\n\r\n/**\r\n * @internal\r\n */\r\nexport class AnimationClipParser03 {\r\n\tprivate static _animationClip: AnimationClip;\r\n\tprivate static _reader: Byte;\r\n\tprivate static _strings: any[] = [];\r\n\tprivate static _BLOCK: any = { count: 0 };\r\n\tprivate static _DATA: any = { offset: 0, size: 0 };\r\n\r\n\tprivate static READ_DATA(): void {\r\n\t\tAnimationClipParser03._DATA.offset = AnimationClipParser03._reader.getUint32();\r\n\t\tAnimationClipParser03._DATA.size = AnimationClipParser03._reader.getUint32();\r\n\t}\r\n\r\n\tprivate static READ_BLOCK(): void {\r\n\t\tvar count: number = AnimationClipParser03._BLOCK.count = AnimationClipParser03._reader.getUint16();\r\n\t\tvar blockStarts: any[] = AnimationClipParser03._BLOCK.blockStarts = [];\r\n\t\tvar blockLengths: any[] = AnimationClipParser03._BLOCK.blockLengths = [];\r\n\t\tfor (var i: number = 0; i < count; i++) {\r\n\t\t\tblockStarts.push(AnimationClipParser03._reader.getUint32());\r\n\t\t\tblockLengths.push(AnimationClipParser03._reader.getUint32());\r\n\t\t}\r\n\t}\r\n\r\n\tprivate static READ_STRINGS(): void {\r\n\t\tvar offset: number = AnimationClipParser03._reader.getUint32();\r\n\t\tvar count: number = AnimationClipParser03._reader.getUint16();\r\n\t\tvar prePos: number = AnimationClipParser03._reader.pos;\r\n\t\tAnimationClipParser03._reader.pos = offset + AnimationClipParser03._DATA.offset;\r\n\r\n\t\tfor (var i: number = 0; i < count; i++)\r\n\t\t\tAnimationClipParser03._strings[i] = AnimationClipParser03._reader.readUTFString();\r\n\t\tAnimationClipParser03._reader.pos = prePos;\r\n\t}\r\n\r\n\t/**\r\n\t * @internal\r\n\t */\r\n\tstatic parse(clip: AnimationClip, reader: Byte): void {\r\n\t\tAnimationClipParser03._animationClip = clip;\r\n\t\tAnimationClipParser03._reader = reader;\r\n\t\r\n\t\tAnimationClipParser03.READ_DATA();\r\n\t\tAnimationClipParser03.READ_BLOCK();\r\n\t\tAnimationClipParser03.READ_STRINGS();\r\n\t\tfor (var i: number = 0, n: number = AnimationClipParser03._BLOCK.count; i < n; i++) {\r\n\t\t\tvar index: number = reader.getUint16();\r\n\t\t\tvar blockName: string = AnimationClipParser03._strings[index];\r\n\t\t\tvar fn:()=>void = (AnimationClipParser03 as any)[\"READ_\" + blockName];\r\n\t\t\tif (fn == null)\r\n\t\t\t\tthrow new Error(\"model file err,no this function:\" + index + \" \" + blockName);\r\n\t\t\telse\r\n\t\t\t\tfn.call(null);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @internal\r\n\t */\r\n\tstatic READ_ANIMATIONS(): void {\r\n\t\tvar i: number, j: number;\r\n\t\tvar node: KeyframeNode;\r\n\t\tvar reader: Byte = AnimationClipParser03._reader;\r\n\r\n\t\tvar startTimeTypes: number[] = [];\r\n\t\tvar startTimeTypeCount: number = reader.getUint16();\r\n\t\tstartTimeTypes.length = startTimeTypeCount;\r\n\t\tfor (i = 0; i < startTimeTypeCount; i++)\r\n\t\t\tstartTimeTypes[i] = reader.getFloat32();\r\n\r\n\t\tvar clip: AnimationClip = AnimationClipParser03._animationClip;\r\n\t\tclip.name = AnimationClipParser03._strings[reader.getUint16()];\r\n\t\tvar clipDur: number = clip._duration = reader.getFloat32();\r\n\t\tclip.islooping = !!reader.getByte();\r\n\t\tclip._frameRate = reader.getInt16();\r\n\t\tvar nodeCount: number = reader.getInt16();\r\n\t\tvar nodes = clip._nodes;\r\n\t\t(nodes as KeyframeNodeList).count = nodeCount;\r\n\t\tvar nodesMap: any = clip._nodesMap = {};\r\n\t\tvar nodesDic: any = clip._nodesDic = {};\r\n\r\n\t\tfor (i = 0; i < nodeCount; i++) {\r\n\t\t\tnode = new KeyframeNode();\r\n\t\t\t(nodes as KeyframeNodeList).setNodeByIndex(i, node);\r\n\t\t\tnode._indexInList = i;\r\n\t\t\tvar type: number = node.type = reader.getUint8();\r\n\r\n\t\t\tvar pathLength: number = reader.getUint16();\r\n\t\t\tnode._setOwnerPathCount(pathLength);\r\n\t\t\tfor (j = 0; j < pathLength; j++)\r\n\t\t\t\tnode._setOwnerPathByIndex(j, AnimationClipParser03._strings[reader.getUint16()]);//TODO:componentType\r\n\r\n\t\t\tvar nodePath: string = node._joinOwnerPath(\"/\");\r\n\t\t\tvar mapArray: KeyframeNode[] = nodesMap[nodePath];\r\n\t\t\t(mapArray) || (nodesMap[nodePath] = mapArray = []);\r\n\t\t\tmapArray.push(node);\r\n\r\n\t\t\tnode.propertyOwner = AnimationClipParser03._strings[reader.getUint16()];\r\n\r\n\t\t\tvar propertyLength: number = reader.getUint16();\r\n\t\t\tnode._setPropertyCount(propertyLength);\r\n\t\t\tfor (j = 0; j < propertyLength; j++)\r\n\t\t\t\tnode._setPropertyByIndex(j, AnimationClipParser03._strings[reader.getUint16()]);\r\n\r\n\t\t\tvar fullPath: string = nodePath + \".\" + node.propertyOwner + \".\" + node._joinProperty(\".\");\r\n\t\t\tnodesDic[fullPath] = node;\r\n\t\t\tnode.fullPath = fullPath;\r\n\r\n\t\t\tvar keyframeCount: number = reader.getUint16();\r\n\t\t\tnode._setKeyframeCount(keyframeCount);\r\n\r\n\t\t\tfor (j = 0; j < keyframeCount; j++) {\r\n\t\t\t\tswitch (type) {\r\n\t\t\t\t\tcase 0:\r\n\t\t\t\t\t\tvar floatKeyframe: FloatKeyframe = new FloatKeyframe();\r\n\t\t\t\t\t\tnode._setKeyframeByIndex(j, floatKeyframe);\r\n\t\t\t\t\t\tfloatKeyframe.time = startTimeTypes[reader.getUint16()];\r\n\t\t\t\t\t\tfloatKeyframe.inTangent = reader.getFloat32();\r\n\t\t\t\t\t\tfloatKeyframe.outTangent = reader.getFloat32();\r\n\t\t\t\t\t\tfloatKeyframe.value = reader.getFloat32();\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase 1:\r\n\t\t\t\t\tcase 3:\r\n\t\t\t\t\tcase 4:\r\n\t\t\t\t\t\tvar floatArrayKeyframe: Vector3Keyframe = new Vector3Keyframe();\r\n\t\t\t\t\t\tnode._setKeyframeByIndex(j, floatArrayKeyframe);\r\n\r\n\t\t\t\t\t\tfloatArrayKeyframe.time = startTimeTypes[reader.getUint16()];\r\n\r\n\r\n\t\t\t\t\t\t\tvar inTangent: Vector3 = floatArrayKeyframe.inTangent;\r\n\t\t\t\t\t\t\tvar outTangent: Vector3 = floatArrayKeyframe.outTangent;\r\n\t\t\t\t\t\t\tvar value: Vector3 = floatArrayKeyframe.value;\r\n\t\t\t\t\t\t\tinTangent.x = reader.getFloat32();\r\n\t\t\t\t\t\t\tinTangent.y = reader.getFloat32();\r\n\t\t\t\t\t\t\tinTangent.z = reader.getFloat32();\r\n\t\t\t\t\t\t\toutTangent.x = reader.getFloat32();\r\n\t\t\t\t\t\t\toutTangent.y = reader.getFloat32();\r\n\t\t\t\t\t\t\toutTangent.z = reader.getFloat32();\r\n\t\t\t\t\t\t\tvalue.x = reader.getFloat32();\r\n\t\t\t\t\t\t\tvalue.y = reader.getFloat32();\r\n\t\t\t\t\t\t\tvalue.z = reader.getFloat32();\r\n\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase 2:\r\n\t\t\t\t\t\tvar quaArrayKeyframe: QuaternionKeyframe = new QuaternionKeyframe();\r\n\t\t\t\t\t\tnode._setKeyframeByIndex(j, quaArrayKeyframe);\r\n\t\t\t\t\t\tquaArrayKeyframe.time = startTimeTypes[reader.getUint16()];\r\n\r\n\t\t\t\t\t\t\tvar inTangentQua: Vector4 = quaArrayKeyframe.inTangent;\r\n\t\t\t\t\t\t\tvar outTangentQua: Vector4 = quaArrayKeyframe.outTangent;\r\n\t\t\t\t\t\t\tvar valueQua: Quaternion = quaArrayKeyframe.value;\r\n\t\t\t\t\t\t\tinTangentQua.x = reader.getFloat32();\r\n\t\t\t\t\t\t\tinTangentQua.y = reader.getFloat32();\r\n\t\t\t\t\t\t\tinTangentQua.z = reader.getFloat32();\r\n\t\t\t\t\t\t\tinTangentQua.w = reader.getFloat32();\r\n\t\t\t\t\t\t\toutTangentQua.x = reader.getFloat32();\r\n\t\t\t\t\t\t\toutTangentQua.y = reader.getFloat32();\r\n\t\t\t\t\t\t\toutTangentQua.z = reader.getFloat32();\r\n\t\t\t\t\t\t\toutTangentQua.w = reader.getFloat32();\r\n\t\t\t\t\t\t\tvalueQua.x = reader.getFloat32();\r\n\t\t\t\t\t\t\tvalueQua.y = reader.getFloat32();\r\n\t\t\t\t\t\t\tvalueQua.z = reader.getFloat32();\r\n\t\t\t\t\t\t\tvalueQua.w = reader.getFloat32();\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tdefault:\r\n\t\t\t\t\t\tthrow \"AnimationClipParser03:unknown type.\";\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\tvar eventCount: number = reader.getUint16();\r\n\t\tfor (i = 0; i < eventCount; i++) {\r\n\t\t\tvar event: AnimationEvent = new AnimationEvent();\r\n\t\t\tevent.time = Math.min(clipDur, reader.getFloat32());//TODO:\r\n\t\t\tevent.eventName = AnimationClipParser03._strings[reader.getUint16()];\r\n\t\t\tvar params: Array<number|boolean|string> = [];\r\n\t\t\tvar paramCount: number = reader.getUint16();\r\n\t\t\t(paramCount > 0) && (event.params = params = []);\r\n\r\n\t\t\tfor (j = 0; j < paramCount; j++) {\r\n\t\t\t\tvar eventType: number = reader.getByte();\r\n\t\t\t\tswitch (eventType) {\r\n\t\t\t\t\tcase 0:\r\n\t\t\t\t\t\tparams.push(!!reader.getByte());\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase 1:\r\n\t\t\t\t\t\tparams.push(reader.getInt32());\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase 2:\r\n\t\t\t\t\t\tparams.push(reader.getFloat32());\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase 3:\r\n\t\t\t\t\t\tparams.push(AnimationClipParser03._strings[reader.getUint16()]);\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tdefault:\r\n\t\t\t\t\t\tthrow new Error(\"unknown type.\");\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tclip.addEvent(event);\r\n\t\t}\r\n\t}\r\n}\r\n\r\n","import { Vector2 } from \"../../maths/Vector2\";\r\nimport { Keyframe, WeightedMode } from \"./Keyframe\";\r\n\r\n\r\n/**\r\n * <code>Vector2Keyframe</code> \r\n */\r\nexport class Vector2Keyframe extends Keyframe {\r\n\t/** */\r\n\tinTangent: Vector2 = new Vector2();\r\n\t/** */\r\n\toutTangent: Vector2 = new Vector2();\r\n\t/** */\r\n\tvalue: Vector2 = new Vector2();\r\n\t/** */\r\n\tinWeight: Vector2;\r\n\t/** */\r\n\toutWeight: Vector2;\r\n\t/** */\r\n\tweightedMode: Vector2;\r\n\r\n\r\n\t/**\r\n\t *  <code>Vector2Keyframe</code> \r\n\t */\r\n\tconstructor(weightMode:boolean = false) {\r\n\t\tsuper();\r\n\t\tif(weightMode){\r\n\t\t\tthis.inWeight = new Vector2(Keyframe.defaultWeight, Keyframe.defaultWeight);\r\n\t\t\tthis.outWeight = new Vector2(Keyframe.defaultWeight, Keyframe.defaultWeight);\r\n\t\t\tthis.weightedMode = new Vector2(WeightedMode.None, WeightedMode.None);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t * @param\tdestObject \r\n\t * @override\r\n\t */\r\n\tcloneTo(dest: any): void {\r\n\t\tsuper.cloneTo(dest);\r\n\t\tvar destKeyFarme: Vector2Keyframe = (<Vector2Keyframe>dest);\r\n\t\tthis.inTangent.cloneTo(destKeyFarme.inTangent);\r\n\t\tthis.outTangent.cloneTo(destKeyFarme.outTangent);\r\n\t\tthis.value.cloneTo(destKeyFarme.value);\r\n\t\tif(this.weightedMode){\r\n\t\t\tthis.inWeight.cloneTo(destKeyFarme.inWeight);\r\n\t\t\tthis.outWeight.cloneTo(destKeyFarme.outWeight);\r\n\t\t\tthis.weightedMode.cloneTo(destKeyFarme.weightedMode);\r\n\t\t}\r\n\t\t\r\n\t}\r\n}\r\n","import { Vector4 } from \"../../maths/Vector4\";\r\nimport { Keyframe, WeightedMode } from \"./Keyframe\";\r\n\r\n\r\n/**\r\n * <code>Vector4Keyframe</code> \r\n */\r\nexport class Vector4Keyframe extends Keyframe {\r\n\t/** */\r\n\tinTangent: Vector4 = new Vector4();\r\n\t/** */\r\n\toutTangent: Vector4 = new Vector4();\r\n\t/** */\r\n\tvalue: Vector4 = new Vector4();\r\n\t/** */\r\n\tinWeight: Vector4;\r\n\t/** */\r\n\toutWeight: Vector4;\r\n\t/** */\r\n\tweightedMode: Vector4;\r\n\r\n\r\n\t/**\r\n\t *  <code>Vector4Keyframe</code> \r\n\t */\r\n\tconstructor(weightMode: boolean = false) {\r\n\t\tsuper();\r\n\t\tif (weightMode) {\r\n\t\t\tthis.inWeight = new Vector4(Keyframe.defaultWeight, Keyframe.defaultWeight, Keyframe.defaultWeight, Keyframe.defaultWeight);\r\n\t\t\tthis.outWeight = new Vector4(Keyframe.defaultWeight, Keyframe.defaultWeight, Keyframe.defaultWeight, Keyframe.defaultWeight);\r\n\t\t\tthis.weightedMode = new Vector4(WeightedMode.None, WeightedMode.None, WeightedMode.None, WeightedMode.None);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t * @param\tdestObject \r\n\t * @override\r\n\t */\r\n\tcloneTo(dest: any): void {\r\n\t\tsuper.cloneTo(dest);\r\n\t\tvar destKeyFarme: Vector4Keyframe = (<Vector4Keyframe>dest);\r\n\t\tthis.inTangent.cloneTo(destKeyFarme.inTangent);\r\n\t\tthis.outTangent.cloneTo(destKeyFarme.outTangent);\r\n\t\tthis.value.cloneTo(destKeyFarme.value);\r\n\t\tif (this.weightedMode) {\r\n\t\t\tthis.inWeight.cloneTo(destKeyFarme.inWeight);\r\n\t\t\tthis.outWeight.cloneTo(destKeyFarme.outWeight);\r\n\t\t\tthis.weightedMode.cloneTo(destKeyFarme.weightedMode);\r\n\t\t}\r\n\t}\r\n}","import { KeyframeNode } from \"./KeyframeNode\";\r\nimport { KeyframeNodeList } from \"./KeyframeNodeList\";\r\nimport { AnimationEvent } from \"./AnimationEvent\";\r\nimport { FloatKeyframe } from \"../core/FloatKeyframe\"\r\nimport { QuaternionKeyframe } from \"../core/QuaternionKeyframe\"\r\nimport { Vector3Keyframe } from \"../core/Vector3Keyframe\"\r\nimport { AnimationClip } from \"./AnimationClip\";\r\nimport { Byte } from \"../../utils/Byte\";\r\nimport { HalfFloatUtils } from \"../../utils/HalfFloatUtils\";\r\nimport { Vector2Keyframe } from \"../core/Vector2Keyframe\";\r\nimport { Vector4Keyframe } from \"../core/Vector4Keyframe\";\r\nimport { KeyFrameValueType } from \"../component/Animator/KeyframeNodeOwner\";\r\nimport { Quaternion } from \"../../maths/Quaternion\";\r\nimport { Vector2 } from \"../../maths/Vector2\";\r\nimport { Vector3 } from \"../../maths/Vector3\";\r\nimport { Vector4 } from \"../../maths/Vector4\";\r\nimport { WeightedMode } from \"../core/Keyframe\";\r\n\r\n/**\r\n * @internal\r\n */\r\nexport class AnimationClipParser04 {\r\n\tprivate static _animationClip: AnimationClip | null;\r\n\tprivate static _reader: Byte | null;\r\n\tprivate static _strings: any[] = [];\r\n\tprivate static _BLOCK: any = { count: 0 };\r\n\tprivate static _DATA: any = { offset: 0, size: 0 };\r\n\tprivate static _version: string | null;\r\n\r\n\tprivate static READ_DATA(): void {\r\n\t\tAnimationClipParser04._DATA.offset = AnimationClipParser04._reader!.getUint32();\r\n\t\tAnimationClipParser04._DATA.size = AnimationClipParser04._reader!.getUint32();\r\n\t}\r\n\r\n\tprivate static READ_BLOCK(): void {\r\n\t\tvar count: number = AnimationClipParser04._BLOCK.count = AnimationClipParser04._reader!.getUint16();\r\n\t\tvar blockStarts: any[] = AnimationClipParser04._BLOCK.blockStarts = [];\r\n\t\tvar blockLengths: any[] = AnimationClipParser04._BLOCK.blockLengths = [];\r\n\t\tfor (var i: number = 0; i < count; i++) {\r\n\t\t\tblockStarts.push(AnimationClipParser04._reader!.getUint32());\r\n\t\t\tblockLengths.push(AnimationClipParser04._reader!.getUint32());\r\n\t\t}\r\n\t}\r\n\r\n\tprivate static READ_STRINGS(): void {\r\n\t\tvar offset: number = AnimationClipParser04._reader!.getUint32();\r\n\t\tvar count: number = AnimationClipParser04._reader!.getUint16();\r\n\t\tvar prePos: number = AnimationClipParser04._reader!.pos;\r\n\t\tAnimationClipParser04._reader!.pos = offset + AnimationClipParser04._DATA.offset;\r\n\r\n\t\tfor (var i: number = 0; i < count; i++)\r\n\t\t\tAnimationClipParser04._strings[i] = AnimationClipParser04._reader!.readUTFString();\r\n\t\tAnimationClipParser04._reader!.pos = prePos;\r\n\t}\r\n\r\n\t/**\r\n\t * @internal\r\n\t */\r\n\tstatic parse(clip: AnimationClip, reader: Byte, version: string): void {\r\n\t\tAnimationClipParser04._animationClip = clip;\r\n\t\tAnimationClipParser04._reader = reader;\r\n\t\tAnimationClipParser04._version = version;\r\n\t\tAnimationClipParser04.READ_DATA();\r\n\t\tAnimationClipParser04.READ_BLOCK();\r\n\t\tAnimationClipParser04.READ_STRINGS();\r\n\t\tfor (var i: number = 0, n: number = AnimationClipParser04._BLOCK.count; i < n; i++) {\r\n\t\t\tvar index: number = reader.getUint16();\r\n\t\t\tvar blockName: string = AnimationClipParser04._strings[index];\r\n\t\t\tvar fn: () => void = (AnimationClipParser04 as any)[\"READ_\" + blockName];\r\n\t\t\tif (fn == null)\r\n\t\t\t\tthrow new Error(\"model file err,no this function:\" + index + \" \" + blockName);\r\n\t\t\telse\r\n\t\t\t\tfn.call(null);\r\n\t\t}\r\n\t\tAnimationClipParser04._version = null;\r\n\t\tAnimationClipParser04._reader = null;\r\n\t\tAnimationClipParser04._animationClip = null;\r\n\t}\r\n\r\n\t/**\r\n\t * @internal\r\n\t */\r\n\tstatic READ_ANIMATIONS(): void {\r\n\t\tvar i: number, j: number;\r\n\t\tvar node: KeyframeNode;\r\n\t\tvar reader: Byte = AnimationClipParser04._reader!;\r\n\r\n\t\tvar startTimeTypes: number[] = [];\r\n\t\tvar startTimeTypeCount: number = reader.getUint16();\r\n\t\tstartTimeTypes.length = startTimeTypeCount;\r\n\t\tfor (i = 0; i < startTimeTypeCount; i++)\r\n\t\t\tstartTimeTypes[i] = reader.getFloat32();\r\n\r\n\t\tvar clip: AnimationClip = AnimationClipParser04._animationClip!;\r\n\t\tclip.name = AnimationClipParser04._strings[reader.getUint16()];\r\n\t\tvar clipDur: number = clip._duration = reader.getFloat32();\r\n\t\tclip.islooping = !!reader.getByte();\r\n\t\tclip._frameRate = reader.getInt16();\r\n\t\tvar nodeCount: number = reader.getInt16();\r\n\t\tvar nodes: KeyframeNodeList = clip._nodes!;\r\n\t\tnodes.count = nodeCount;\r\n\t\tvar nodesMap: any = clip._nodesMap = {};\r\n\t\tvar nodesDic: any = clip._nodesDic = {};\r\n\r\n\t\tfor (i = 0; i < nodeCount; i++) {\r\n\t\t\tnode = new KeyframeNode();\r\n\t\t\tif (\"LAYAANIMATION:WEIGHT_05\" == AnimationClipParser04._version) {\r\n\t\t\t\tif (1 == reader.getByte()) {\r\n\t\t\t\t\t//propertyChangePath,IDE\r\n\t\t\t\t\tnode.propertyChangePath = AnimationClipParser04._strings[reader.getUint16()];\r\n\t\t\t\t}\r\n\t\t\t\tif (1 == reader.getByte()) {\r\n\t\t\t\t\tnode.callbackFunData = AnimationClipParser04._strings[reader.getUint16()];\r\n\t\t\t\t}\r\n\r\n\t\t\t\tlet paramLen = reader.getUint8();\r\n\t\t\t\tlet callParms: any[] = null;\r\n\t\t\t\tfor (j = 0; j < paramLen; j++) {\r\n\t\t\t\t\tif (null == callParms) {\r\n\t\t\t\t\t\tcallParms = [];\r\n\t\t\t\t\t}\r\n\t\t\t\t\tcallParms.push(AnimationClipParser04._strings[reader.getUint16()]);\r\n\t\t\t\t}\r\n\t\t\t\tnode.callParams = callParms;\r\n\t\t\t}\r\n\t\t\tnodes.setNodeByIndex(i, node);\r\n\t\t\tnode._indexInList = i;\r\n\t\t\tvar type: number = node.type = reader.getUint8();\r\n\r\n\t\t\tvar pathLength: number = reader.getUint16();\r\n\t\t\tnode._setOwnerPathCount(pathLength);\r\n\t\t\tfor (j = 0; j < pathLength; j++)\r\n\t\t\t\tnode._setOwnerPathByIndex(j, AnimationClipParser04._strings[reader.getUint16()]);//TODO:componentType\r\n\r\n\t\t\tvar nodePath: string = node._joinOwnerPath(\"/\");\r\n\t\t\tvar mapArray: KeyframeNode[] = nodesMap[nodePath];\r\n\t\t\t(mapArray) || (nodesMap[nodePath] = mapArray = []);\r\n\t\t\tmapArray.push(node);\r\n\r\n\t\t\tnode.propertyOwner = AnimationClipParser04._strings[reader.getUint16()];\r\n\r\n\t\t\tvar propertyLength: number = reader.getUint16();\r\n\t\t\tnode._setPropertyCount(propertyLength);\r\n\t\t\tfor (j = 0; j < propertyLength; j++)\r\n\t\t\t\tnode._setPropertyByIndex(j, AnimationClipParser04._strings[reader.getUint16()]);\r\n\r\n\t\t\tvar fullPath: string = nodePath + \".\" + node.propertyOwner + \".\" + node._joinProperty(\".\");\r\n\t\t\tnodesDic[fullPath] = node;\r\n\t\t\tnode.fullPath = fullPath;\r\n\t\t\tnode.nodePath = nodePath;\r\n\r\n\t\t\tvar keyframeCount: number = reader.getUint16();\r\n\t\t\tnode._setKeyframeCount(keyframeCount);\r\n\t\t\tswitch (AnimationClipParser04._version) {\r\n\t\t\t\tcase \"LAYAANIMATION:04\":\r\n\t\t\t\t\tfor (j = 0; j < keyframeCount; j++) {\r\n\t\t\t\t\t\tswitch (type) {\r\n\t\t\t\t\t\t\tcase KeyFrameValueType.Float:\r\n\t\t\t\t\t\t\t\tvar floatKeyframe: FloatKeyframe = new FloatKeyframe();\r\n\t\t\t\t\t\t\t\tnode._setKeyframeByIndex(j, floatKeyframe);\r\n\t\t\t\t\t\t\t\tfloatKeyframe.time = startTimeTypes[reader.getUint16()];\r\n\t\t\t\t\t\t\t\tfloatKeyframe.inTangent = reader.getFloat32();\r\n\t\t\t\t\t\t\t\tfloatKeyframe.outTangent = reader.getFloat32();\r\n\t\t\t\t\t\t\t\tfloatKeyframe.value = reader.getFloat32();\r\n\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\tcase KeyFrameValueType.Position:\r\n\t\t\t\t\t\t\tcase KeyFrameValueType.Scale:\r\n\t\t\t\t\t\t\tcase KeyFrameValueType.RotationEuler:\r\n\t\t\t\t\t\t\tcase KeyFrameValueType.Vector3:\r\n\t\t\t\t\t\t\t\tvar floatArrayKeyframe: Vector3Keyframe = new Vector3Keyframe();\r\n\t\t\t\t\t\t\t\tnode._setKeyframeByIndex(j, floatArrayKeyframe);\r\n\t\t\t\t\t\t\t\tfloatArrayKeyframe.time = startTimeTypes[reader.getUint16()];\r\n\t\t\t\t\t\t\t\tvar inTangent: Vector3 = floatArrayKeyframe.inTangent;\r\n\t\t\t\t\t\t\t\tvar outTangent: Vector3 = floatArrayKeyframe.outTangent;\r\n\t\t\t\t\t\t\t\tvar value: Vector3 = floatArrayKeyframe.value;\r\n\t\t\t\t\t\t\t\tinTangent.x = reader.getFloat32();\r\n\t\t\t\t\t\t\t\tinTangent.y = reader.getFloat32();\r\n\t\t\t\t\t\t\t\tinTangent.z = reader.getFloat32();\r\n\t\t\t\t\t\t\t\toutTangent.x = reader.getFloat32();\r\n\t\t\t\t\t\t\t\toutTangent.y = reader.getFloat32();\r\n\t\t\t\t\t\t\t\toutTangent.z = reader.getFloat32();\r\n\t\t\t\t\t\t\t\tvalue.x = reader.getFloat32();\r\n\t\t\t\t\t\t\t\tvalue.y = reader.getFloat32();\r\n\t\t\t\t\t\t\t\tvalue.z = reader.getFloat32();\r\n\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\tcase KeyFrameValueType.Rotation:\r\n\t\t\t\t\t\t\t\tvar quaternionKeyframe: QuaternionKeyframe = new QuaternionKeyframe();\r\n\t\t\t\t\t\t\t\tnode._setKeyframeByIndex(j, quaternionKeyframe);\r\n\t\t\t\t\t\t\t\tquaternionKeyframe.time = startTimeTypes[reader.getUint16()];\r\n\t\t\t\t\t\t\t\tvar inTangentQua: Vector4 = quaternionKeyframe.inTangent;\r\n\t\t\t\t\t\t\t\tvar outTangentQua: Vector4 = quaternionKeyframe.outTangent;\r\n\t\t\t\t\t\t\t\tvar valueQua: Quaternion = quaternionKeyframe.value;\r\n\t\t\t\t\t\t\t\tinTangentQua.x = reader.getFloat32();\r\n\t\t\t\t\t\t\t\tinTangentQua.y = reader.getFloat32();\r\n\t\t\t\t\t\t\t\tinTangentQua.z = reader.getFloat32();\r\n\t\t\t\t\t\t\t\tinTangentQua.w = reader.getFloat32();\r\n\t\t\t\t\t\t\t\toutTangentQua.x = reader.getFloat32();\r\n\t\t\t\t\t\t\t\toutTangentQua.y = reader.getFloat32();\r\n\t\t\t\t\t\t\t\toutTangentQua.z = reader.getFloat32();\r\n\t\t\t\t\t\t\t\toutTangentQua.w = reader.getFloat32();\r\n\t\t\t\t\t\t\t\tvalueQua.x = reader.getFloat32();\r\n\t\t\t\t\t\t\t\tvalueQua.y = reader.getFloat32();\r\n\t\t\t\t\t\t\t\tvalueQua.z = reader.getFloat32();\r\n\t\t\t\t\t\t\t\tvalueQua.w = reader.getFloat32();\r\n\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\tcase KeyFrameValueType.Vector2:\r\n\t\t\t\t\t\t\t\tvar vec2Keyfram = new Vector2Keyframe();\r\n\t\t\t\t\t\t\t\tnode._setKeyframeByIndex(j, vec2Keyfram);\r\n\t\t\t\t\t\t\t\tvec2Keyfram.time = startTimeTypes[reader.getUint16()];\r\n\t\t\t\t\t\t\t\tvar inTangentV2: Vector2 = vec2Keyfram.inTangent;\r\n\t\t\t\t\t\t\t\tvar outTangentV2: Vector2 = vec2Keyfram.outTangent;\r\n\t\t\t\t\t\t\t\tvar valueV2: Vector2 = vec2Keyfram.value;\r\n\t\t\t\t\t\t\t\tinTangentV2.x = reader.getFloat32();\r\n\t\t\t\t\t\t\t\tinTangentV2.y = reader.getFloat32();\r\n\t\t\t\t\t\t\t\toutTangentV2.x = reader.getFloat32();\r\n\t\t\t\t\t\t\t\toutTangentV2.y = reader.getFloat32();\r\n\t\t\t\t\t\t\t\tvalueV2.x = reader.getFloat32();\r\n\t\t\t\t\t\t\t\tvalueV2.y = reader.getFloat32();\r\n\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\tcase KeyFrameValueType.Vector4:\r\n\t\t\t\t\t\t\tcase KeyFrameValueType.Color:\r\n\t\t\t\t\t\t\t\tvar vec4Keyfram = new Vector4Keyframe();\r\n\t\t\t\t\t\t\t\tnode._setKeyframeByIndex(j, vec4Keyfram);\r\n\t\t\t\t\t\t\t\tvec4Keyfram.time = startTimeTypes[reader.getUint16()];\r\n\t\t\t\t\t\t\t\tvar inTangentV4: Vector4 = vec4Keyfram.inTangent;\r\n\t\t\t\t\t\t\t\tvar outTangentV4: Vector4 = vec4Keyfram.outTangent;\r\n\t\t\t\t\t\t\t\tvar valueV4: Vector4 = vec4Keyfram.value;\r\n\t\t\t\t\t\t\t\tinTangentV4.x = reader.getFloat32();\r\n\t\t\t\t\t\t\t\tinTangentV4.y = reader.getFloat32();\r\n\t\t\t\t\t\t\t\tinTangentV4.z = reader.getFloat32();\r\n\t\t\t\t\t\t\t\tinTangentV4.w = reader.getFloat32();\r\n\t\t\t\t\t\t\t\toutTangentV4.x = reader.getFloat32();\r\n\t\t\t\t\t\t\t\toutTangentV4.y = reader.getFloat32();\r\n\t\t\t\t\t\t\t\toutTangentV4.z = reader.getFloat32();\r\n\t\t\t\t\t\t\t\toutTangentV4.w = reader.getFloat32();\r\n\t\t\t\t\t\t\t\tvalueV4.x = reader.getFloat32();\r\n\t\t\t\t\t\t\t\tvalueV4.y = reader.getFloat32();\r\n\t\t\t\t\t\t\t\tvalueV4.z = reader.getFloat32();\r\n\t\t\t\t\t\t\t\tvalueV4.w = reader.getFloat32();\r\n\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\tdefault:\r\n\t\t\t\t\t\t\t\tthrow \"AnimationClipParser04:unknown type.\";\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase \"LAYAANIMATION:WEIGHT_04\":\r\n\t\t\t\tcase \"LAYAANIMATION:WEIGHT_05\":\r\n\t\t\t\t\tfor (j = 0; j < keyframeCount; j++) {\r\n\t\t\t\t\t\tlet isWeight = 1;\r\n\t\t\t\t\t\tswitch (type) {\r\n\t\t\t\t\t\t\tcase KeyFrameValueType.Float:\r\n\t\t\t\t\t\t\t\tvar floatKeyframe: FloatKeyframe = new FloatKeyframe();\r\n\t\t\t\t\t\t\t\tnode._setKeyframeByIndex(j, floatKeyframe);\r\n\t\t\t\t\t\t\t\tfloatKeyframe.time = startTimeTypes[reader.getUint16()];\r\n\t\t\t\t\t\t\t\tfloatKeyframe.inTangent = reader.getFloat32();\r\n\t\t\t\t\t\t\t\tfloatKeyframe.outTangent = reader.getFloat32();\r\n\t\t\t\t\t\t\t\tfloatKeyframe.value = reader.getFloat32();\r\n\t\t\t\t\t\t\t\tfloatKeyframe.weightedMode = reader.getUint8();\r\n\t\t\t\t\t\t\t\tif (\"LAYAANIMATION:WEIGHT_05\" == AnimationClipParser04._version) {\r\n\t\t\t\t\t\t\t\t\tif (WeightedMode.In == floatKeyframe.weightedMode || WeightedMode.Both == floatKeyframe.weightedMode) {\r\n\t\t\t\t\t\t\t\t\t\tfloatKeyframe.inWeight = reader.getFloat32();\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\tif (WeightedMode.Out == floatKeyframe.weightedMode || WeightedMode.Both == floatKeyframe.weightedMode) {\r\n\t\t\t\t\t\t\t\t\t\tfloatKeyframe.outWeight = reader.getFloat32();\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\tfloatKeyframe.inWeight = reader.getFloat32();\r\n\t\t\t\t\t\t\t\t\tfloatKeyframe.outWeight = reader.getFloat32();\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\tcase KeyFrameValueType.Position:\r\n\t\t\t\t\t\t\tcase KeyFrameValueType.Scale:\r\n\t\t\t\t\t\t\tcase KeyFrameValueType.RotationEuler:\r\n\t\t\t\t\t\t\tcase KeyFrameValueType.Vector3:\r\n\t\t\t\t\t\t\t\tvar floatArrayKeyframe: Vector3Keyframe = new Vector3Keyframe(true);\r\n\t\t\t\t\t\t\t\tnode._setKeyframeByIndex(j, floatArrayKeyframe);\r\n\t\t\t\t\t\t\t\tfloatArrayKeyframe.time = startTimeTypes[reader.getUint16()];\r\n\t\t\t\t\t\t\t\tvar inTangent: Vector3 = floatArrayKeyframe.inTangent;\r\n\t\t\t\t\t\t\t\tvar outTangent: Vector3 = floatArrayKeyframe.outTangent;\r\n\t\t\t\t\t\t\t\tvar value: Vector3 = floatArrayKeyframe.value;\r\n\t\t\t\t\t\t\t\tlet weidhtMode = floatArrayKeyframe.weightedMode;\r\n\t\t\t\t\t\t\t\tlet inWeight = floatArrayKeyframe.inWeight;\r\n\t\t\t\t\t\t\t\tlet outWeight = floatArrayKeyframe.outWeight;\r\n\t\t\t\t\t\t\t\tinTangent.x = reader.getFloat32();\r\n\t\t\t\t\t\t\t\tinTangent.y = reader.getFloat32();\r\n\t\t\t\t\t\t\t\tinTangent.z = reader.getFloat32();\r\n\t\t\t\t\t\t\t\toutTangent.x = reader.getFloat32();\r\n\t\t\t\t\t\t\t\toutTangent.y = reader.getFloat32();\r\n\t\t\t\t\t\t\t\toutTangent.z = reader.getFloat32();\r\n\t\t\t\t\t\t\t\tvalue.x = reader.getFloat32();\r\n\t\t\t\t\t\t\t\tvalue.y = reader.getFloat32();\r\n\t\t\t\t\t\t\t\tvalue.z = reader.getFloat32();\r\n\r\n\t\t\t\t\t\t\t\tif (\"LAYAANIMATION:WEIGHT_05\" == AnimationClipParser04._version) {\r\n\t\t\t\t\t\t\t\t\tisWeight = reader.getByte();\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\tif (1 == isWeight) {\r\n\t\t\t\t\t\t\t\t\tweidhtMode.x = reader.getUint8();\r\n\t\t\t\t\t\t\t\t\tweidhtMode.y = reader.getUint8();\r\n\t\t\t\t\t\t\t\t\tweidhtMode.z = reader.getUint8();\r\n\t\t\t\t\t\t\t\t\tinWeight.x = reader.getFloat32();\r\n\t\t\t\t\t\t\t\t\tinWeight.y = reader.getFloat32();\r\n\t\t\t\t\t\t\t\t\tinWeight.z = reader.getFloat32();\r\n\t\t\t\t\t\t\t\t\toutWeight.x = reader.getFloat32();\r\n\t\t\t\t\t\t\t\t\toutWeight.y = reader.getFloat32();\r\n\t\t\t\t\t\t\t\t\toutWeight.z = reader.getFloat32();\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\tcase KeyFrameValueType.Rotation:\r\n\t\t\t\t\t\t\t\tvar quaternionKeyframe: QuaternionKeyframe = new QuaternionKeyframe(true);\r\n\t\t\t\t\t\t\t\tnode._setKeyframeByIndex(j, quaternionKeyframe);\r\n\t\t\t\t\t\t\t\tquaternionKeyframe.time = startTimeTypes[reader.getUint16()];\r\n\t\t\t\t\t\t\t\tvar inTangentQua: Vector4 = quaternionKeyframe.inTangent;\r\n\t\t\t\t\t\t\t\tvar outTangentQua: Vector4 = quaternionKeyframe.outTangent;\r\n\t\t\t\t\t\t\t\tvar valueQua: Quaternion = quaternionKeyframe.value;\r\n\t\t\t\t\t\t\t\tlet weightModeV4 = quaternionKeyframe.weightedMode;\r\n\t\t\t\t\t\t\t\tlet inWeightQua = quaternionKeyframe.inWeight;\r\n\t\t\t\t\t\t\t\tlet outWeightQua = quaternionKeyframe.outWeight;\r\n\t\t\t\t\t\t\t\tinTangentQua.x = reader.getFloat32();\r\n\t\t\t\t\t\t\t\tinTangentQua.y = reader.getFloat32();\r\n\t\t\t\t\t\t\t\tinTangentQua.z = reader.getFloat32();\r\n\t\t\t\t\t\t\t\tinTangentQua.w = reader.getFloat32();\r\n\t\t\t\t\t\t\t\toutTangentQua.x = reader.getFloat32();\r\n\t\t\t\t\t\t\t\toutTangentQua.y = reader.getFloat32();\r\n\t\t\t\t\t\t\t\toutTangentQua.z = reader.getFloat32();\r\n\t\t\t\t\t\t\t\toutTangentQua.w = reader.getFloat32();\r\n\t\t\t\t\t\t\t\tvalueQua.x = reader.getFloat32();\r\n\t\t\t\t\t\t\t\tvalueQua.y = reader.getFloat32();\r\n\t\t\t\t\t\t\t\tvalueQua.z = reader.getFloat32();\r\n\t\t\t\t\t\t\t\tvalueQua.w = reader.getFloat32();\r\n\r\n\t\t\t\t\t\t\t\tif (\"LAYAANIMATION:WEIGHT_05\" == AnimationClipParser04._version) {\r\n\t\t\t\t\t\t\t\t\tisWeight = reader.getByte();\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\tif (1 == isWeight) {\r\n\t\t\t\t\t\t\t\t\tweightModeV4.x = reader.getUint8();\r\n\t\t\t\t\t\t\t\t\tweightModeV4.y = reader.getUint8();\r\n\t\t\t\t\t\t\t\t\tweightModeV4.z = reader.getUint8();\r\n\t\t\t\t\t\t\t\t\tweightModeV4.w = reader.getUint8();\r\n\t\t\t\t\t\t\t\t\tinWeightQua.x = reader.getFloat32();\r\n\t\t\t\t\t\t\t\t\tinWeightQua.y = reader.getFloat32();\r\n\t\t\t\t\t\t\t\t\tinWeightQua.z = reader.getFloat32();\r\n\t\t\t\t\t\t\t\t\tinWeightQua.w = reader.getFloat32();\r\n\t\t\t\t\t\t\t\t\toutWeightQua.x = reader.getFloat32();\r\n\t\t\t\t\t\t\t\t\toutWeightQua.y = reader.getFloat32();\r\n\t\t\t\t\t\t\t\t\toutWeightQua.z = reader.getFloat32();\r\n\t\t\t\t\t\t\t\t\toutWeightQua.w = reader.getFloat32();\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\tcase KeyFrameValueType.Vector2:\r\n\t\t\t\t\t\t\t\tvar vec2Keyfram = new Vector2Keyframe(true);\r\n\t\t\t\t\t\t\t\tnode._setKeyframeByIndex(j, vec2Keyfram);\r\n\t\t\t\t\t\t\t\tvec2Keyfram.time = startTimeTypes[reader.getUint16()];\r\n\t\t\t\t\t\t\t\tvar inTangentV2: Vector2 = vec2Keyfram.inTangent;\r\n\t\t\t\t\t\t\t\tvar outTangentV2: Vector2 = vec2Keyfram.outTangent;\r\n\t\t\t\t\t\t\t\tvar valueV2: Vector2 = vec2Keyfram.value;\r\n\t\t\t\t\t\t\t\tlet weightModeV2 = vec2Keyfram.weightedMode;\r\n\t\t\t\t\t\t\t\tlet inWeightV2 = vec2Keyfram.inWeight;\r\n\t\t\t\t\t\t\t\tlet outWeightV2 = vec2Keyfram.outWeight;\r\n\t\t\t\t\t\t\t\tinTangentV2.x = reader.getFloat32();\r\n\t\t\t\t\t\t\t\tinTangentV2.y = reader.getFloat32();\r\n\t\t\t\t\t\t\t\toutTangentV2.x = reader.getFloat32();\r\n\t\t\t\t\t\t\t\toutTangentV2.y = reader.getFloat32();\r\n\t\t\t\t\t\t\t\tvalueV2.x = reader.getFloat32();\r\n\t\t\t\t\t\t\t\tvalueV2.y = reader.getFloat32();\r\n\t\t\t\t\t\t\t\tif (\"LAYAANIMATION:WEIGHT_05\" == AnimationClipParser04._version) {\r\n\t\t\t\t\t\t\t\t\tisWeight = reader.getByte();\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\tif (1 == isWeight) {\r\n\t\t\t\t\t\t\t\t\tweightModeV2.x = reader.getUint8();\r\n\t\t\t\t\t\t\t\t\tweightModeV2.y = reader.getUint8();\r\n\t\t\t\t\t\t\t\t\tinWeightV2.x = reader.getFloat32();\r\n\t\t\t\t\t\t\t\t\tinWeightV2.y = reader.getFloat32();\r\n\t\t\t\t\t\t\t\t\toutWeightV2.x = reader.getFloat32();\r\n\t\t\t\t\t\t\t\t\toutWeightV2.y = reader.getFloat32();\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\tcase KeyFrameValueType.Vector4:\r\n\t\t\t\t\t\t\tcase KeyFrameValueType.Color:\r\n\t\t\t\t\t\t\t\tvar vec4Keyfram = new Vector4Keyframe(true);\r\n\t\t\t\t\t\t\t\tnode._setKeyframeByIndex(j, vec4Keyfram);\r\n\t\t\t\t\t\t\t\tvec4Keyfram.time = startTimeTypes[reader.getUint16()];\r\n\t\t\t\t\t\t\t\tvar inTangentV4: Vector4 = vec4Keyfram.inTangent;\r\n\t\t\t\t\t\t\t\tvar outTangentV4: Vector4 = vec4Keyfram.outTangent;\r\n\t\t\t\t\t\t\t\tvar valueV4: Vector4 = vec4Keyfram.value;\r\n\t\t\t\t\t\t\t\tvar weightMode_V4 = vec4Keyfram.weightedMode;\r\n\t\t\t\t\t\t\t\tvar inWeightV4 = vec4Keyfram.inWeight;\r\n\t\t\t\t\t\t\t\tvar outWeightV4 = vec4Keyfram.outWeight;\r\n\t\t\t\t\t\t\t\tinTangentV4.x = reader.getFloat32();\r\n\t\t\t\t\t\t\t\tinTangentV4.y = reader.getFloat32();\r\n\t\t\t\t\t\t\t\tinTangentV4.z = reader.getFloat32();\r\n\t\t\t\t\t\t\t\tinTangentV4.w = reader.getFloat32();\r\n\t\t\t\t\t\t\t\toutTangentV4.x = reader.getFloat32();\r\n\t\t\t\t\t\t\t\toutTangentV4.y = reader.getFloat32();\r\n\t\t\t\t\t\t\t\toutTangentV4.z = reader.getFloat32();\r\n\t\t\t\t\t\t\t\toutTangentV4.w = reader.getFloat32();\r\n\t\t\t\t\t\t\t\tvalueV4.x = reader.getFloat32();\r\n\t\t\t\t\t\t\t\tvalueV4.y = reader.getFloat32();\r\n\t\t\t\t\t\t\t\tvalueV4.z = reader.getFloat32();\r\n\t\t\t\t\t\t\t\tvalueV4.w = reader.getFloat32();\r\n\t\t\t\t\t\t\t\tif (\"LAYAANIMATION:WEIGHT_05\" == AnimationClipParser04._version) {\r\n\t\t\t\t\t\t\t\t\tisWeight = reader.getByte();\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\tif (1 == isWeight) {\r\n\t\t\t\t\t\t\t\t\tweightMode_V4.x = reader.getUint8();\r\n\t\t\t\t\t\t\t\t\tweightMode_V4.y = reader.getUint8();\r\n\t\t\t\t\t\t\t\t\tweightMode_V4.z = reader.getUint8();\r\n\t\t\t\t\t\t\t\t\tweightMode_V4.w = reader.getUint8();\r\n\t\t\t\t\t\t\t\t\tinWeightV4.x = reader.getFloat32();\r\n\t\t\t\t\t\t\t\t\tinWeightV4.y = reader.getFloat32();\r\n\t\t\t\t\t\t\t\t\tinWeightV4.z = reader.getFloat32();\r\n\t\t\t\t\t\t\t\t\tinWeightV4.w = reader.getFloat32();\r\n\t\t\t\t\t\t\t\t\toutWeightV4.x = reader.getFloat32();\r\n\t\t\t\t\t\t\t\t\toutWeightV4.y = reader.getFloat32();\r\n\t\t\t\t\t\t\t\t\toutWeightV4.z = reader.getFloat32();\r\n\t\t\t\t\t\t\t\t\toutWeightV4.w = reader.getFloat32();\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\tdefault:\r\n\t\t\t\t\t\t\t\tthrow \"AnimationClipParser04:unknown type.\";\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase \"LAYAANIMATION:COMPRESSION_04\":\r\n\t\t\t\t\tfor (j = 0; j < keyframeCount; j++) {\r\n\t\t\t\t\t\tswitch (type) {\r\n\t\t\t\t\t\t\tcase KeyFrameValueType.Float:\r\n\t\t\t\t\t\t\t\tfloatKeyframe = new FloatKeyframe();\r\n\t\t\t\t\t\t\t\tnode._setKeyframeByIndex(j, floatKeyframe);\r\n\t\t\t\t\t\t\t\tfloatKeyframe.time = startTimeTypes[reader.getUint16()];\r\n\t\t\t\t\t\t\t\tfloatKeyframe.inTangent = HalfFloatUtils.convertToNumber(reader.getUint16());\r\n\t\t\t\t\t\t\t\tfloatKeyframe.outTangent = HalfFloatUtils.convertToNumber(reader.getUint16());\r\n\t\t\t\t\t\t\t\tfloatKeyframe.value = HalfFloatUtils.convertToNumber(reader.getUint16());\r\n\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\tcase KeyFrameValueType.Position:\r\n\t\t\t\t\t\t\tcase KeyFrameValueType.Scale:\r\n\t\t\t\t\t\t\tcase KeyFrameValueType.RotationEuler:\r\n\t\t\t\t\t\t\tcase KeyFrameValueType.Vector3:\r\n\t\t\t\t\t\t\t\tfloatArrayKeyframe = new Vector3Keyframe();\r\n\t\t\t\t\t\t\t\tnode._setKeyframeByIndex(j, floatArrayKeyframe);\r\n\t\t\t\t\t\t\t\tfloatArrayKeyframe.time = startTimeTypes[reader.getUint16()];\r\n\r\n\t\t\t\t\t\t\t\tinTangent = floatArrayKeyframe.inTangent;\r\n\t\t\t\t\t\t\t\toutTangent = floatArrayKeyframe.outTangent;\r\n\t\t\t\t\t\t\t\tvalue = floatArrayKeyframe.value;\r\n\t\t\t\t\t\t\t\tinTangent.x = HalfFloatUtils.convertToNumber(reader.getUint16());\r\n\t\t\t\t\t\t\t\tinTangent.y = HalfFloatUtils.convertToNumber(reader.getUint16());\r\n\t\t\t\t\t\t\t\tinTangent.z = HalfFloatUtils.convertToNumber(reader.getUint16());\r\n\t\t\t\t\t\t\t\toutTangent.x = HalfFloatUtils.convertToNumber(reader.getUint16());\r\n\t\t\t\t\t\t\t\toutTangent.y = HalfFloatUtils.convertToNumber(reader.getUint16());\r\n\t\t\t\t\t\t\t\toutTangent.z = HalfFloatUtils.convertToNumber(reader.getUint16());\r\n\t\t\t\t\t\t\t\tvalue.x = HalfFloatUtils.convertToNumber(reader.getUint16());\r\n\t\t\t\t\t\t\t\tvalue.y = HalfFloatUtils.convertToNumber(reader.getUint16());\r\n\t\t\t\t\t\t\t\tvalue.z = HalfFloatUtils.convertToNumber(reader.getUint16());\r\n\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\tcase KeyFrameValueType.Rotation:\r\n\t\t\t\t\t\t\t\tquaternionKeyframe = new QuaternionKeyframe();\r\n\t\t\t\t\t\t\t\tnode._setKeyframeByIndex(j, quaternionKeyframe);\r\n\t\t\t\t\t\t\t\tquaternionKeyframe.time = startTimeTypes[reader.getUint16()];\r\n\r\n\t\t\t\t\t\t\t\tinTangentQua = quaternionKeyframe.inTangent;\r\n\t\t\t\t\t\t\t\toutTangentQua = quaternionKeyframe.outTangent;\r\n\t\t\t\t\t\t\t\tvalueQua = quaternionKeyframe.value;\r\n\t\t\t\t\t\t\t\tinTangentQua.x = HalfFloatUtils.convertToNumber(reader.getUint16());\r\n\t\t\t\t\t\t\t\tinTangentQua.y = HalfFloatUtils.convertToNumber(reader.getUint16());\r\n\t\t\t\t\t\t\t\tinTangentQua.z = HalfFloatUtils.convertToNumber(reader.getUint16());\r\n\t\t\t\t\t\t\t\tinTangentQua.w = HalfFloatUtils.convertToNumber(reader.getUint16());\r\n\t\t\t\t\t\t\t\toutTangentQua.x = HalfFloatUtils.convertToNumber(reader.getUint16());\r\n\t\t\t\t\t\t\t\toutTangentQua.y = HalfFloatUtils.convertToNumber(reader.getUint16());\r\n\t\t\t\t\t\t\t\toutTangentQua.z = HalfFloatUtils.convertToNumber(reader.getUint16());\r\n\t\t\t\t\t\t\t\toutTangentQua.w = HalfFloatUtils.convertToNumber(reader.getUint16());\r\n\t\t\t\t\t\t\t\tvalueQua.x = HalfFloatUtils.convertToNumber(reader.getUint16());\r\n\t\t\t\t\t\t\t\tvalueQua.y = HalfFloatUtils.convertToNumber(reader.getUint16());\r\n\t\t\t\t\t\t\t\tvalueQua.z = HalfFloatUtils.convertToNumber(reader.getUint16());\r\n\t\t\t\t\t\t\t\tvalueQua.w = HalfFloatUtils.convertToNumber(reader.getUint16());\r\n\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\tcase KeyFrameValueType.Vector2:\r\n\t\t\t\t\t\t\t\tvar vec2Keyfram = new Vector2Keyframe();\r\n\t\t\t\t\t\t\t\tnode._setKeyframeByIndex(j, vec2Keyfram);\r\n\t\t\t\t\t\t\t\tvec2Keyfram.time = startTimeTypes[reader.getUint16()];\r\n\t\t\t\t\t\t\t\tvar inTangentV2: Vector2 = vec2Keyfram.inTangent;\r\n\t\t\t\t\t\t\t\tvar outTangentV2: Vector2 = vec2Keyfram.outTangent;\r\n\t\t\t\t\t\t\t\tvar valueV2: Vector2 = vec2Keyfram.value;\r\n\t\t\t\t\t\t\t\tinTangentV2.x = HalfFloatUtils.convertToNumber(reader.getUint16());\r\n\t\t\t\t\t\t\t\tinTangentV2.y = HalfFloatUtils.convertToNumber(reader.getUint16());\r\n\t\t\t\t\t\t\t\toutTangentV2.x = HalfFloatUtils.convertToNumber(reader.getUint16());\r\n\t\t\t\t\t\t\t\toutTangentV2.y = HalfFloatUtils.convertToNumber(reader.getUint16());\r\n\t\t\t\t\t\t\t\tvalueV2.x = HalfFloatUtils.convertToNumber(reader.getUint16());\r\n\t\t\t\t\t\t\t\tvalueV2.y = HalfFloatUtils.convertToNumber(reader.getUint16());\r\n\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\tcase KeyFrameValueType.Vector4:\r\n\t\t\t\t\t\t\tcase KeyFrameValueType.Color:\r\n\t\t\t\t\t\t\t\tvar vec4Keyfram = new Vector4Keyframe();\r\n\t\t\t\t\t\t\t\tnode._setKeyframeByIndex(j, vec4Keyfram);\r\n\t\t\t\t\t\t\t\tvec4Keyfram.time = startTimeTypes[reader.getUint16()];\r\n\t\t\t\t\t\t\t\tvar inTangentV4: Vector4 = vec4Keyfram.inTangent;\r\n\t\t\t\t\t\t\t\tvar outTangentV4: Vector4 = vec4Keyfram.outTangent;\r\n\t\t\t\t\t\t\t\tvar valueV4: Vector4 = vec4Keyfram.value;\r\n\t\t\t\t\t\t\t\tinTangentV4.x = HalfFloatUtils.convertToNumber(reader.getUint16());\r\n\t\t\t\t\t\t\t\tinTangentV4.y = HalfFloatUtils.convertToNumber(reader.getUint16());\r\n\t\t\t\t\t\t\t\tinTangentV4.z = HalfFloatUtils.convertToNumber(reader.getUint16());\r\n\t\t\t\t\t\t\t\tinTangentV4.w = HalfFloatUtils.convertToNumber(reader.getUint16());\r\n\t\t\t\t\t\t\t\toutTangentV4.x = HalfFloatUtils.convertToNumber(reader.getUint16());\r\n\t\t\t\t\t\t\t\toutTangentV4.y = HalfFloatUtils.convertToNumber(reader.getUint16());\r\n\t\t\t\t\t\t\t\toutTangentV4.z = HalfFloatUtils.convertToNumber(reader.getUint16());\r\n\t\t\t\t\t\t\t\toutTangentV4.w = HalfFloatUtils.convertToNumber(reader.getUint16());\r\n\t\t\t\t\t\t\t\tvalueV4.x = HalfFloatUtils.convertToNumber(reader.getUint16());\r\n\t\t\t\t\t\t\t\tvalueV4.y = HalfFloatUtils.convertToNumber(reader.getUint16());\r\n\t\t\t\t\t\t\t\tvalueV4.z = HalfFloatUtils.convertToNumber(reader.getUint16());\r\n\t\t\t\t\t\t\t\tvalueV4.w = HalfFloatUtils.convertToNumber(reader.getUint16());\r\n\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\tdefault:\r\n\t\t\t\t\t\t\t\tthrow \"AnimationClipParser04:unknown type.\";\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\tbreak;\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\tvar eventCount: number = reader.getUint16();\r\n\t\tfor (i = 0; i < eventCount; i++) {\r\n\t\t\tvar event: AnimationEvent = new AnimationEvent();\r\n\t\t\tevent.time = Math.min(clipDur, reader.getFloat32());//TODO:\r\n\t\t\tevent.eventName = AnimationClipParser04._strings[reader.getUint16()];\r\n\t\t\tvar params: Array<number | string | boolean> = [];\r\n\t\t\tvar paramCount: number = reader.getUint16();\r\n\t\t\t(paramCount > 0) && (event.params = params = []);\r\n\r\n\t\t\tfor (j = 0; j < paramCount; j++) {\r\n\t\t\t\tvar eventType: number = reader.getByte();\r\n\t\t\t\tswitch (eventType) {\r\n\t\t\t\t\tcase 0:\r\n\t\t\t\t\t\tparams.push(!!reader.getByte());\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase 1:\r\n\t\t\t\t\t\tparams.push(reader.getInt32());\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase 2:\r\n\t\t\t\t\t\tparams.push(reader.getFloat32());\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase 3:\r\n\t\t\t\t\t\tparams.push(AnimationClipParser04._strings[reader.getUint16()]);\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tdefault:\r\n\t\t\t\t\t\tthrow new Error(\"unknown type.\");\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tclip.addEvent(event);\r\n\t\t}\r\n\t}\r\n}\r\n\r\n","import { KeyframeNode } from \"./KeyframeNode\";\r\n\r\n/**\r\n * <code>KeyframeNodeList</code> KeyframeNode\r\n */\r\nexport class KeyframeNodeList {\r\n\t/** @internal */\r\n\tprivate _nodes: KeyframeNode[] = [];\r\n\r\n\t/**\r\n\t *\t\r\n\t */\r\n\tget count(): number {\r\n\t\treturn this._nodes.length;\r\n\t}\r\n\r\n\tset count(value: number) {\r\n\t\tthis._nodes.length = value;\r\n\t}\r\n\r\n\t/**\r\n\t *  <code>KeyframeNodeList</code> \r\n\t */\r\n\tconstructor() {\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t * @param\tindex \r\n\t * @return \r\n\t */\r\n\tgetNodeByIndex(index: number): KeyframeNode {\r\n\t\treturn this._nodes[index];\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t * @param\tindex \r\n\t * @param \r\n\t */\r\n\tsetNodeByIndex(index: number, node: KeyframeNode): void {\r\n\t\tthis._nodes[index] = node;\r\n\t}\r\n\r\n}\r\n","import { TextureFormat } from \"../../RenderEngine/RenderEnum/TextureFormat\";\r\nimport { Texture2D } from \"../../resource/Texture2D\"\r\n\r\n\r\n/**\r\n * \r\n * @internal\r\n * @author\r\n */\r\nexport class TextureGenerator {\r\n\r\n\tconstructor() {\r\n\r\n\t}\r\n\r\n\tstatic lightAttenTexture(x: number, y: number, maxX: number, maxY: number, index: number, data: Uint8Array): void {\r\n\r\n\t\tvar sqrRange: number = x / maxX;\r\n\t\tvar atten: number = 1.0 / (1.0 + 25.0 * sqrRange);\r\n\t\tif (sqrRange >= 0.64) {\r\n\t\t\tif (sqrRange > 1.0) {\r\n\t\t\t\tatten = 0;\r\n\t\t\t} else {\r\n\t\t\t\tatten *= 1 - (sqrRange - 0.64) / (1 - 0.64);\r\n\t\t\t}\r\n\t\t}\r\n\t\tdata[index] = Math.floor(atten * 255.0 + 0.5);\r\n\t}\r\n\r\n\tstatic haloTexture(x: number, y: number, maxX: number, maxY: number, index: number, data: Uint8Array): void {\r\n\r\n\t\tmaxX >>= 1;\r\n\t\tmaxY >>= 1;\r\n\t\tvar xFac: number = (x - maxX) / maxX;\r\n\t\tvar yFac: number = (y - maxY) / maxY;\r\n\t\tvar sqrRange: number = xFac * xFac + yFac * yFac;\r\n\t\tif (sqrRange > 1.0) {\r\n\t\t\tsqrRange = 1.0;\r\n\t\t}\r\n\t\tdata[index] = Math.floor((1.0 - sqrRange) * 255.0 + 0.5);\r\n\t}\r\n\r\n\tstatic _generateTexture2D(texture: Texture2D, textureWidth: number, textureHeight: number, func: Function): void {\r\n\t\tvar index: number = 0;\r\n\t\tvar size: number = 0;\r\n\t\tswitch (texture.format) {\r\n\t\t\tcase TextureFormat.R8G8B8:\r\n\t\t\t\tsize = 3;\r\n\t\t\t\tbreak;\r\n\t\t\tcase TextureFormat.R8G8B8A8:\r\n\t\t\t\tsize = 4;\r\n\t\t\t\tbreak;\r\n\t\t\tcase TextureFormat.Alpha8:\r\n\t\t\t\tsize = 1;\r\n\t\t\t\tbreak;\r\n\t\t\tdefault:\r\n\t\t\t\tthrow \"GeneratedTexture._generateTexture: unkonw texture format.\";\r\n\t\t}\r\n\r\n\t\tvar data: Uint8Array = new Uint8Array(textureWidth * textureHeight * size);\r\n\t\tfor (var y: number = 0; y < textureHeight; y++) {\r\n\t\t\tfor (var x: number = 0; x < textureWidth; x++) {\r\n\t\t\t\tfunc(x, y, textureWidth, textureHeight, index, data);\r\n\t\t\t\tindex += size;\r\n\t\t\t}\r\n\t\t}\r\n\t\ttexture.setPixelsData(data, false, false);\r\n\t}\r\n\r\n}\r\n\r\n\r\n","import { Node } from \"../../display/Node\";\r\nimport { Texture2D } from \"../../resource/Texture2D\";\r\nimport { PixelLineSprite3D } from \"../core/pixelLine/PixelLineSprite3D\";\r\nimport { BoundBox } from \"../math/BoundBox\";\r\nimport { TextureGenerator } from \"../resource/TextureGenerator\";\r\nimport { ILaya3D } from \"../../../ILaya3D\";\r\nimport { HTMLCanvas } from \"../../resource/HTMLCanvas\";\r\nimport { TextureFormat } from \"../../RenderEngine/RenderEnum/TextureFormat\";\r\nimport { FilterMode } from \"../../RenderEngine/RenderEnum/FilterMode\";\r\nimport { WrapMode } from \"../../RenderEngine/RenderEnum/WrapMode\";\r\nimport { RenderTargetFormat } from \"../../RenderEngine/RenderEnum/RenderTargetFormat\";\r\nimport { LayaEnv } from \"../../../LayaEnv\";\r\nimport { Bounds } from \"../math/Bounds\";\r\nimport { Color } from \"../../maths/Color\";\r\nimport { Matrix4x4 } from \"../../maths/Matrix4x4\";\r\nimport { Quaternion } from \"../../maths/Quaternion\";\r\nimport { Vector3 } from \"../../maths/Vector3\";\r\nimport { Vector4 } from \"../../maths/Vector4\";\r\nimport { RenderTexture } from \"../../resource/RenderTexture\";\r\n\r\n/**\r\n * <code>Utils3D</code> 3D\r\n */\r\nexport class Utils3D {\r\n    private static _tempVector3_0: Vector3 = new Vector3();\r\n    private static _tempVector3_1: Vector3 = new Vector3();\r\n    private static _tempVector3_2: Vector3 = new Vector3();\r\n\r\n    private static _tempArray16_0: Float32Array = new Float32Array(16);\r\n    private static _tempArray16_1: Float32Array = new Float32Array(16);\r\n    private static _tempArray16_2: Float32Array = new Float32Array(16);\r\n    private static _tempArray16_3: Float32Array = new Float32Array(16);\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    static _createFloatTextureBuffer(width: number, height: number): Texture2D {\r\n        var floatTex: Texture2D = new Texture2D(width, height, TextureFormat.R32G32B32A32, false, false);\r\n        floatTex.setPixelsData(null, false, false);\r\n        floatTex.filterMode = FilterMode.Point;\r\n        floatTex.wrapModeU = WrapMode.Clamp;\r\n        floatTex.wrapModeV = WrapMode.Clamp;\r\n        floatTex.anisoLevel = 0;\r\n        return floatTex;\r\n    }\r\n\r\n    /**\r\n     *,\r\n     * @param tx left\r\n     * @param ty left\r\n     * @param tz right\r\n     * @param qx right\r\n     * @param qy \r\n     * @param qz \r\n     * @param qw \r\n     * @param sx \r\n     * @param sy \r\n     * @param sz \r\n     * @param outArray \r\n     * @param outOffset \r\n     */\r\n    private static _rotationTransformScaleSkinAnimation(tx: number, ty: number, tz: number, qx: number, qy: number, qz: number, qw: number, sx: number, sy: number, sz: number, outArray: Float32Array, outOffset: number): void {\r\n\r\n        var re: Float32Array = Utils3D._tempArray16_0;\r\n        var se: Float32Array = Utils3D._tempArray16_1;\r\n        var tse: Float32Array = Utils3D._tempArray16_2;\r\n\r\n        //\r\n\r\n        //\r\n        var x2: number = qx + qx;\r\n        var y2: number = qy + qy;\r\n        var z2: number = qz + qz;\r\n\r\n        var xx: number = qx * x2;\r\n        var yx: number = qy * x2;\r\n        var yy: number = qy * y2;\r\n        var zx: number = qz * x2;\r\n        var zy: number = qz * y2;\r\n        var zz: number = qz * z2;\r\n        var wx: number = qw * x2;\r\n        var wy: number = qw * y2;\r\n        var wz: number = qw * z2;\r\n\r\n        //re[3] = re[7] = re[11] = re[12] = re[13] = re[14] = 0;\r\n        re[15] = 1;\r\n        re[0] = 1 - yy - zz;\r\n        re[1] = yx + wz;\r\n        re[2] = zx - wy;\r\n\r\n        re[4] = yx - wz;\r\n        re[5] = 1 - xx - zz;\r\n        re[6] = zy + wx;\r\n\r\n        re[8] = zx + wy;\r\n        re[9] = zy - wx;\r\n        re[10] = 1 - xx - yy;\r\n\r\n        //\r\n        //se[4] = se[8] = se[12] = se[1] = se[9] = se[13] = se[2] = se[6] = se[14] = se[3] = se[7] = se[11] = 0;\r\n        se[15] = 1;\r\n        se[0] = sx;\r\n        se[5] = sy;\r\n        se[10] = sz;\r\n\r\n        var i: number, ai0: number, ai1: number, ai2: number, ai3: number;\r\n        //mul(rMat, tMat, tsMat)......................................\r\n        for (i = 0; i < 4; i++) {\r\n            ai0 = re[i];\r\n            ai1 = re[i + 4];\r\n            ai2 = re[i + 8];\r\n            ai3 = re[i + 12];\r\n            tse[i] = ai0;\r\n            tse[i + 4] = ai1;\r\n            tse[i + 8] = ai2;\r\n            tse[i + 12] = ai0 * tx + ai1 * ty + ai2 * tz + ai3;\r\n        }\r\n\r\n        //mul(tsMat, sMat, out)..............................................\r\n        for (i = 0; i < 4; i++) {\r\n            ai0 = tse[i];\r\n            ai1 = tse[i + 4];\r\n            ai2 = tse[i + 8];\r\n            ai3 = tse[i + 12];\r\n            outArray[i + outOffset] = ai0 * se[0] + ai1 * se[1] + ai2 * se[2] + ai3 * se[3];\r\n            outArray[i + outOffset + 4] = ai0 * se[4] + ai1 * se[5] + ai2 * se[6] + ai3 * se[7];\r\n            outArray[i + outOffset + 8] = ai0 * se[8] + ai1 * se[9] + ai2 * se[10] + ai3 * se[11];\r\n            outArray[i + outOffset + 12] = ai0 * se[12] + ai1 * se[13] + ai2 * se[14] + ai3 * se[15];\r\n        }\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    static _compIdToNode: any = new Object();\r\n    static _tempV0: Vector3 = new Vector3();\r\n    static _tempV1: Vector3 = new Vector3();\r\n\r\n    /**\r\n     * billboard\r\n     */\r\n    static billboardTrans(v0: Vector3, cameraDir: Vector3, cameraUp: Vector3, out: Vector3) {\r\n        //vec3 positionOS = vertex.positionOS.x * normalize(cross(u_CameraDirection, u_CameraUp));\r\n        //positionOS += vertex.positionOS.y * normalize(u_CameraUp);\r\n        Vector3.normalize(cameraUp, Utils3D._tempV1);\r\n        Vector3.cross(cameraDir, cameraUp, Utils3D._tempV0);\r\n        Vector3.normalize(Utils3D._tempV0, Utils3D._tempV0);\r\n        Vector3.scale(Utils3D._tempV0, v0.x, out);\r\n        Vector3.scale(cameraUp, v0.y, Utils3D._tempV1);\r\n        Vector3.add(out, Utils3D._tempV1, out);\r\n    }\r\n\r\n    /**\r\n     * PABC\r\n     * https://mathworld.wolfram.com/BarycentricCoordinates.html\r\n     * @param A \r\n     * @param B \r\n     * @param C \r\n     * @param P \r\n     * @returns \r\n     */\r\n    static PointinTriangle(A: Vector3, B: Vector3, C: Vector3, P: Vector3): boolean {\r\n        let v0 = C.vsub(A, Utils3D._tempVector3_0);\r\n        let v1 = B.vsub(A, Utils3D._tempVector3_1);\r\n        let v2 = P.vsub(A, Utils3D._tempVector3_2);\r\n\r\n        let dot00 = v0.dot(v0);\r\n        let dot01 = v0.dot(v1);\r\n        let dot02 = v0.dot(v2);\r\n        let dot11 = v1.dot(v1);\r\n        let dot12 = v1.dot(v2);\r\n\r\n        let inverDeno = 1 / (dot00 * dot11 - dot01 * dot01);\r\n\r\n        let u = (dot11 * dot02 - dot01 * dot12) * inverDeno;\r\n        if (u < 0 || u > 1) // if u out of range, return directly\r\n        {\r\n            return false;\r\n        }\r\n\r\n\r\n        let v = (dot00 * dot12 - dot01 * dot02) * inverDeno;\r\n        if (v < 0 || v > 1) // if v out of range, return directly\r\n        {\r\n            return false;\r\n        }\r\n        return u + v <= 1;\r\n    }\r\n\r\n\r\n    /** @internal */\r\n    static _computeBoneAndAnimationDatasByBindPoseMatrxix(bones: any, curData: Float32Array, inverGlobalBindPose: Matrix4x4[], outBonesDatas: Float32Array, outAnimationDatas: Float32Array, boneIndexToMesh: number[]): void {\r\n\r\n        var offset: number = 0;\r\n        var matOffset: number = 0;\r\n\r\n        var i: number;\r\n        var parentOffset: number;\r\n        var boneLength: number = bones.length;\r\n        for (i = 0; i < boneLength; offset += bones[i].keyframeWidth, matOffset += 16, i++) {\r\n            //...........................................\r\n            Utils3D._rotationTransformScaleSkinAnimation(curData[offset + 0], curData[offset + 1], curData[offset + 2], curData[offset + 3], curData[offset + 4], curData[offset + 5], curData[offset + 6], curData[offset + 7], curData[offset + 8], curData[offset + 9], outBonesDatas, matOffset);\r\n\r\n            if (i != 0) {\r\n                parentOffset = bones[i].parentIndex * 16;\r\n                Utils3D.mulMatrixByArray(outBonesDatas, parentOffset, outBonesDatas, matOffset, outBonesDatas, matOffset);\r\n            }\r\n        }\r\n\r\n        var n: number = inverGlobalBindPose.length;\r\n        for (i = 0; i < n; i++)//................................................\r\n        {\r\n            Utils3D.mulMatrixByArrayAndMatrixFast(outBonesDatas, boneIndexToMesh[i] * 16, inverGlobalBindPose[i], outAnimationDatas, i * 16);//TODO:-1\r\n        }\r\n    }\r\n\r\n    /** @internal */\r\n    static _computeAnimationDatasByArrayAndMatrixFast(inverGlobalBindPose: Matrix4x4[], bonesDatas: Float32Array, outAnimationDatas: Float32Array, boneIndexToMesh: number[]): void {\r\n        for (var i: number = 0, n: number = inverGlobalBindPose.length; i < n; i++)//\r\n            Utils3D.mulMatrixByArrayAndMatrixFast(bonesDatas, boneIndexToMesh[i] * 16, inverGlobalBindPose[i], outAnimationDatas, i * 16);//TODO:-1\r\n    }\r\n\r\n    /** @internal */\r\n    static _computeBoneAndAnimationDatasByBindPoseMatrxixOld(bones: any, curData: Float32Array, inverGlobalBindPose: Matrix4x4[], outBonesDatas: Float32Array, outAnimationDatas: Float32Array): void {\r\n\r\n        var offset: number = 0;\r\n        var matOffset: number = 0;\r\n\r\n        var i: number;\r\n        var parentOffset: number;\r\n        var boneLength: number = bones.length;\r\n        for (i = 0; i < boneLength; offset += bones[i].keyframeWidth, matOffset += 16, i++) {\r\n            //...........................................\r\n            Utils3D._rotationTransformScaleSkinAnimation(curData[offset + 7], curData[offset + 8], curData[offset + 9], curData[offset + 3], curData[offset + 4], curData[offset + 5], curData[offset + 6], curData[offset + 0], curData[offset + 1], curData[offset + 2], outBonesDatas, matOffset);\r\n\r\n            if (i != 0) {\r\n                parentOffset = bones[i].parentIndex * 16;\r\n                Utils3D.mulMatrixByArray(outBonesDatas, parentOffset, outBonesDatas, matOffset, outBonesDatas, matOffset);\r\n            }\r\n        }\r\n\r\n        var n: number = inverGlobalBindPose.length;\r\n        for (i = 0; i < n; i++)//................................................\r\n        {\r\n            var arrayOffset: number = i * 16;\r\n            Utils3D.mulMatrixByArrayAndMatrixFast(outBonesDatas, arrayOffset, inverGlobalBindPose[i], outAnimationDatas, arrayOffset);\r\n        }\r\n    }\r\n\r\n    /** @internal */\r\n    static _computeAnimationDatasByArrayAndMatrixFastOld(inverGlobalBindPose: Matrix4x4[], bonesDatas: Float32Array, outAnimationDatas: Float32Array): void {\r\n        var n: number = inverGlobalBindPose.length;\r\n        for (var i: number = 0; i < n; i++)//................................................\r\n        {\r\n            var arrayOffset: number = i * 16;\r\n            Utils3D.mulMatrixByArrayAndMatrixFast(bonesDatas, arrayOffset, inverGlobalBindPose[i], outAnimationDatas, arrayOffset);\r\n        }\r\n    }\r\n\r\n    /** @internal */\r\n    static _computeRootAnimationData(bones: any, curData: Float32Array, animationDatas: Float32Array): void {\r\n\r\n        for (var i: number = 0, offset: number = 0, matOffset: number = 0, boneLength: number = bones.length; i < boneLength; offset += bones[i].keyframeWidth, matOffset += 16, i++)\r\n            Utils3D.createAffineTransformationArray(curData[offset + 0], curData[offset + 1], curData[offset + 2], curData[offset + 3], curData[offset + 4], curData[offset + 5], curData[offset + 6], curData[offset + 7], curData[offset + 8], curData[offset + 9], animationDatas, matOffset);\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @param\tsource \r\n     * @param\trotation \r\n     * @param\tout \r\n     */\r\n    static transformVector3ArrayByQuat(sourceArray: Float32Array, sourceOffset: number, rotation: Quaternion, outArray: Float32Array, outOffset: number): void {\r\n        var x: number = sourceArray[sourceOffset], y: number = sourceArray[sourceOffset + 1], z: number = sourceArray[sourceOffset + 2], qx: number = rotation.x, qy: number = rotation.y, qz: number = rotation.z, qw: number = rotation.w, ix: number = qw * x + qy * z - qz * y, iy: number = qw * y + qz * x - qx * z, iz: number = qw * z + qx * y - qy * x, iw: number = -qx * x - qy * y - qz * z;\r\n        outArray[outOffset] = ix * qw + iw * -qx + iy * -qz - iz * -qy;\r\n        outArray[outOffset + 1] = iy * qw + iw * -qy + iz * -qx - ix * -qz;\r\n        outArray[outOffset + 2] = iz * qw + iw * -qz + ix * -qy - iy * -qx;\r\n    }\r\n\r\n    /**\r\n     *\r\n     * @param leftArray left\r\n     * @param leftOffset left\r\n     * @param rightArray right\r\n     * @param rightOffset right\r\n     * @param outArray \r\n     * @param outOffset \r\n     */\r\n    static mulMatrixByArray(leftArray: Float32Array, leftOffset: number, rightArray: Float32Array, rightOffset: number, outArray: Float32Array, outOffset: number): void {\r\n\r\n        var i: number, ai0: number, ai1: number, ai2: number, ai3: number;\r\n\r\n        if (outArray === rightArray) {\r\n            rightArray = Utils3D._tempArray16_3;\r\n            for (i = 0; i < 16; ++i) {\r\n                rightArray[i] = outArray[outOffset + i];\r\n            }\r\n            rightOffset = 0;\r\n        }\r\n\r\n        for (i = 0; i < 4; i++) {\r\n            ai0 = leftArray[leftOffset + i];\r\n            ai1 = leftArray[leftOffset + i + 4];\r\n            ai2 = leftArray[leftOffset + i + 8];\r\n            ai3 = leftArray[leftOffset + i + 12];\r\n            outArray[outOffset + i] = ai0 * rightArray[rightOffset + 0] + ai1 * rightArray[rightOffset + 1] + ai2 * rightArray[rightOffset + 2] + ai3 * rightArray[rightOffset + 3];\r\n            outArray[outOffset + i + 4] = ai0 * rightArray[rightOffset + 4] + ai1 * rightArray[rightOffset + 5] + ai2 * rightArray[rightOffset + 6] + ai3 * rightArray[rightOffset + 7];\r\n            outArray[outOffset + i + 8] = ai0 * rightArray[rightOffset + 8] + ai1 * rightArray[rightOffset + 9] + ai2 * rightArray[rightOffset + 10] + ai3 * rightArray[rightOffset + 11];\r\n            outArray[outOffset + i + 12] = ai0 * rightArray[rightOffset + 12] + ai1 * rightArray[rightOffset + 13] + ai2 * rightArray[rightOffset + 14] + ai3 * rightArray[rightOffset + 15];\r\n        }\r\n    }\r\n\r\n    /**\r\n     *,rightArrayoutArray\r\n     * @param leftArray left\r\n     * @param leftOffset left\r\n     * @param rightArray right\r\n     * @param rightOffset right\r\n     * @param outArray \r\n     * @param outOffset \r\n     */\r\n    static mulMatrixByArrayFast(leftArray: Float32Array, leftOffset: number, rightArray: Float32Array, rightOffset: number, outArray: Float32Array, outOffset: number): void {\r\n\r\n        var i: number, ai0: number, ai1: number, ai2: number, ai3: number;\r\n        for (i = 0; i < 4; i++) {\r\n            ai0 = leftArray[leftOffset + i];\r\n            ai1 = leftArray[leftOffset + i + 4];\r\n            ai2 = leftArray[leftOffset + i + 8];\r\n            ai3 = leftArray[leftOffset + i + 12];\r\n            outArray[outOffset + i] = ai0 * rightArray[rightOffset + 0] + ai1 * rightArray[rightOffset + 1] + ai2 * rightArray[rightOffset + 2] + ai3 * rightArray[rightOffset + 3];\r\n            outArray[outOffset + i + 4] = ai0 * rightArray[rightOffset + 4] + ai1 * rightArray[rightOffset + 5] + ai2 * rightArray[rightOffset + 6] + ai3 * rightArray[rightOffset + 7];\r\n            outArray[outOffset + i + 8] = ai0 * rightArray[rightOffset + 8] + ai1 * rightArray[rightOffset + 9] + ai2 * rightArray[rightOffset + 10] + ai3 * rightArray[rightOffset + 11];\r\n            outArray[outOffset + i + 12] = ai0 * rightArray[rightOffset + 12] + ai1 * rightArray[rightOffset + 13] + ai2 * rightArray[rightOffset + 14] + ai3 * rightArray[rightOffset + 15];\r\n        }\r\n    }\r\n\r\n    /**\r\n     *,rightArrayoutArray\r\n     * @param leftArray left\r\n     * @param leftOffset left\r\n     * @param rightMatrix right\r\n     * @param outArray \r\n     * @param outOffset \r\n     */\r\n    static mulMatrixByArrayAndMatrixFast(leftArray: Float32Array, leftOffset: number, rightMatrix: Matrix4x4, outArray: Float32Array, outOffset: number): void {\r\n\r\n        var i: number, ai0: number, ai1: number, ai2: number, ai3: number;\r\n        var rightMatrixE: Float32Array = rightMatrix.elements;\r\n        var m11: number = rightMatrixE[0], m12: number = rightMatrixE[1], m13: number = rightMatrixE[2], m14: number = rightMatrixE[3];\r\n        var m21: number = rightMatrixE[4], m22: number = rightMatrixE[5], m23: number = rightMatrixE[6], m24: number = rightMatrixE[7];\r\n        var m31: number = rightMatrixE[8], m32: number = rightMatrixE[9], m33: number = rightMatrixE[10], m34: number = rightMatrixE[11];\r\n        var m41: number = rightMatrixE[12], m42: number = rightMatrixE[13], m43: number = rightMatrixE[14], m44: number = rightMatrixE[15];\r\n        var ai0LeftOffset: number = leftOffset;\r\n        var ai1LeftOffset: number = leftOffset + 4;\r\n        var ai2LeftOffset: number = leftOffset + 8;\r\n        var ai3LeftOffset: number = leftOffset + 12;\r\n        var ai0OutOffset: number = outOffset;\r\n        var ai1OutOffset: number = outOffset + 4;\r\n        var ai2OutOffset: number = outOffset + 8;\r\n        var ai3OutOffset: number = outOffset + 12;\r\n\r\n        for (i = 0; i < 4; i++) {\r\n            ai0 = leftArray[ai0LeftOffset + i];\r\n            ai1 = leftArray[ai1LeftOffset + i];\r\n            ai2 = leftArray[ai2LeftOffset + i];\r\n            ai3 = leftArray[ai3LeftOffset + i];\r\n            outArray[ai0OutOffset + i] = ai0 * m11 + ai1 * m12 + ai2 * m13 + ai3 * m14;\r\n            outArray[ai1OutOffset + i] = ai0 * m21 + ai1 * m22 + ai2 * m23 + ai3 * m24;\r\n            outArray[ai2OutOffset + i] = ai0 * m31 + ai1 * m32 + ai2 * m33 + ai3 * m34;\r\n            outArray[ai3OutOffset + i] = ai0 * m41 + ai1 * m42 + ai2 * m43 + ai3 * m44;\r\n        }\r\n    }\r\n\r\n    /**\r\n     *\r\n     * @param tX left\r\n     * @param tY left\r\n     * @param tZ right\r\n     * @param qX right\r\n     * @param qY \r\n     * @param qZ \r\n     * @param qW \r\n     * @param sX \r\n     * @param sY \r\n     * @param sZ \r\n     * @param outArray \r\n     * @param outOffset \r\n     */\r\n    static createAffineTransformationArray(tX: number, tY: number, tZ: number, rX: number, rY: number, rZ: number, rW: number, sX: number, sY: number, sZ: number, outArray: Float32Array, outOffset: number): void {\r\n\r\n        var x2: number = rX + rX, y2: number = rY + rY, z2: number = rZ + rZ;\r\n        var xx: number = rX * x2, xy: number = rX * y2, xz: number = rX * z2, yy: number = rY * y2, yz: number = rY * z2, zz: number = rZ * z2;\r\n        var wx: number = rW * x2, wy: number = rW * y2, wz: number = rW * z2;\r\n\r\n        outArray[outOffset + 0] = (1 - (yy + zz)) * sX;\r\n        outArray[outOffset + 1] = (xy + wz) * sX;\r\n        outArray[outOffset + 2] = (xz - wy) * sX;\r\n        outArray[outOffset + 3] = 0;\r\n        outArray[outOffset + 4] = (xy - wz) * sY;\r\n        outArray[outOffset + 5] = (1 - (xx + zz)) * sY;\r\n        outArray[outOffset + 6] = (yz + wx) * sY;\r\n        outArray[outOffset + 7] = 0;\r\n        outArray[outOffset + 8] = (xz + wy) * sZ;\r\n        outArray[outOffset + 9] = (yz - wx) * sZ;\r\n        outArray[outOffset + 10] = (1 - (xx + yy)) * sZ;\r\n        outArray[outOffset + 11] = 0;\r\n        outArray[outOffset + 12] = tX;\r\n        outArray[outOffset + 13] = tY;\r\n        outArray[outOffset + 14] = tZ;\r\n        outArray[outOffset + 15] = 1;\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @param\tsource \r\n     * @param\tsourceOffset \r\n     * @param\ttransform  \r\n     * @param\tresult \r\n     * @param\tresultOffset \r\n     */\r\n    static transformVector3ArrayToVector3ArrayCoordinate(source: Float32Array, sourceOffset: number, transform: Matrix4x4, result: Float32Array, resultOffset: number): void {\r\n        var coordinateX: number = source[sourceOffset + 0];\r\n        var coordinateY: number = source[sourceOffset + 1];\r\n        var coordinateZ: number = source[sourceOffset + 2];\r\n\r\n        var transformElem: Float32Array = transform.elements;\r\n        var w: number = ((coordinateX * transformElem[3]) + (coordinateY * transformElem[7]) + (coordinateZ * transformElem[11]) + transformElem[15]);\r\n        result[resultOffset] = (coordinateX * transformElem[0]) + (coordinateY * transformElem[4]) + (coordinateZ * transformElem[8]) + transformElem[12] / w;\r\n        result[resultOffset + 1] = (coordinateX * transformElem[1]) + (coordinateY * transformElem[5]) + (coordinateZ * transformElem[9]) + transformElem[13] / w;\r\n        result[resultOffset + 2] = (coordinateX * transformElem[2]) + (coordinateY * transformElem[6]) + (coordinateZ * transformElem[10]) + transformElem[14] / w;\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @param source \r\n     * @param sourceOffset \r\n     * @param transform \r\n     * @param result \r\n     * @param resultOffset \r\n     */\r\n    static transformVector3ArrayToVector3ArrayNormal(source: Float32Array, sourceOffset: number, transform: Matrix4x4, result: Float32Array, resultOffset: number): void {\r\n        var coordinateX: number = source[sourceOffset + 0];\r\n        var coordinateY: number = source[sourceOffset + 1];\r\n        var coordinateZ: number = source[sourceOffset + 2];\r\n\r\n        var transformElem: Float32Array = transform.elements;\r\n        result[resultOffset] = coordinateX * transformElem[0] + coordinateY * transformElem[4] + coordinateZ * transformElem[8];\r\n        result[resultOffset + 1] = coordinateX * transformElem[1] + coordinateY * transformElem[5] + coordinateZ * transformElem[9];\r\n        result[resultOffset + 2] = coordinateX * transformElem[2] + coordinateY * transformElem[6] + coordinateZ * transformElem[10];\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    static transformLightingMapTexcoordArray(source: Float32Array, sourceOffset: number, lightingMapScaleOffset: Vector4, result: Float32Array, resultOffset: number): void {\r\n        result[resultOffset + 0] = source[sourceOffset + 0] * lightingMapScaleOffset.x + lightingMapScaleOffset.z;\r\n        result[resultOffset + 1] = 1.0 - ((1.0 - source[sourceOffset + 1]) * lightingMapScaleOffset.y + lightingMapScaleOffset.w);\r\n    }\r\n\r\n    /**\r\n     * URL\r\n     * @param\turl\r\n     * @return\r\n     */\r\n    static getURLVerion(url: string): string {\r\n        var index: number = url.indexOf(\"?\");\r\n        return index >= 0 ? url.substr(index) : null;\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    static _createAffineTransformationArray(trans: Vector3, rot: Quaternion, scale: Vector3, outE: Float32Array): void {\r\n\r\n        var x: number = rot.x, y: number = rot.y, z: number = rot.z, w: number = rot.w, x2: number = x + x, y2: number = y + y, z2: number = z + z;\r\n        var xx: number = x * x2, xy: number = x * y2, xz: number = x * z2, yy: number = y * y2, yz: number = y * z2, zz: number = z * z2;\r\n        var wx: number = w * x2, wy: number = w * y2, wz: number = w * z2, sx: number = scale.x, sy: number = scale.y, sz: number = scale.z;\r\n\r\n        outE[0] = (1 - (yy + zz)) * sx;\r\n        outE[1] = (xy + wz) * sx;\r\n        outE[2] = (xz - wy) * sx;\r\n        outE[3] = 0;\r\n        outE[4] = (xy - wz) * sy;\r\n        outE[5] = (1 - (xx + zz)) * sy;\r\n        outE[6] = (yz + wx) * sy;\r\n        outE[7] = 0;\r\n        outE[8] = (xz + wy) * sz;\r\n        outE[9] = (yz - wx) * sz;\r\n        outE[10] = (1 - (xx + yy)) * sz;\r\n        outE[11] = 0;\r\n        outE[12] = trans.x;\r\n        outE[13] = trans.y;\r\n        outE[14] = trans.z;\r\n        outE[15] = 1;\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    static _mulMatrixArray(left: Float32Array, right: Float32Array, rightOffset: number, outArray: Float32Array, outOffset: number): void {\r\n        var l: Float32Array = right;\r\n        var r: Float32Array = left;\r\n        var e: Float32Array = outArray;\r\n\r\n        var l11: number = l[rightOffset], l12: number = l[rightOffset + 1], l13: number = l[rightOffset + 2], l14: number = l[rightOffset + 3];\r\n        var l21: number = l[rightOffset + 4], l22: number = l[rightOffset + 5], l23: number = l[rightOffset + 6], l24: number = l[rightOffset + 7];\r\n        var l31: number = l[rightOffset + 8], l32: number = l[rightOffset + 9], l33: number = l[rightOffset + 10], l34: number = l[rightOffset + 11];\r\n        var l41: number = l[rightOffset + 12], l42: number = l[rightOffset + 13], l43: number = l[rightOffset + 14], l44: number = l[rightOffset + 15];\r\n\r\n        var r11: number = r[0], r12: number = r[1], r13: number = r[2], r14: number = r[3];\r\n        var r21: number = r[4], r22: number = r[5], r23: number = r[6], r24: number = r[7];\r\n        var r31: number = r[8], r32: number = r[9], r33: number = r[10], r34: number = r[11];\r\n        var r41: number = r[12], r42: number = r[13], r43: number = r[14], r44: number = r[15];\r\n\r\n        e[outOffset] = (l11 * r11) + (l12 * r21) + (l13 * r31) + (l14 * r41);\r\n        e[outOffset + 1] = (l11 * r12) + (l12 * r22) + (l13 * r32) + (l14 * r42);\r\n        e[outOffset + 2] = (l11 * r13) + (l12 * r23) + (l13 * r33) + (l14 * r43);\r\n        e[outOffset + 3] = (l11 * r14) + (l12 * r24) + (l13 * r34) + (l14 * r44);\r\n        e[outOffset + 4] = (l21 * r11) + (l22 * r21) + (l23 * r31) + (l24 * r41);\r\n        e[outOffset + 5] = (l21 * r12) + (l22 * r22) + (l23 * r32) + (l24 * r42);\r\n        e[outOffset + 6] = (l21 * r13) + (l22 * r23) + (l23 * r33) + (l24 * r43);\r\n        e[outOffset + 7] = (l21 * r14) + (l22 * r24) + (l23 * r34) + (l24 * r44);\r\n        e[outOffset + 8] = (l31 * r11) + (l32 * r21) + (l33 * r31) + (l34 * r41);\r\n        e[outOffset + 9] = (l31 * r12) + (l32 * r22) + (l33 * r32) + (l34 * r42);\r\n        e[outOffset + 10] = (l31 * r13) + (l32 * r23) + (l33 * r33) + (l34 * r43);\r\n        e[outOffset + 11] = (l31 * r14) + (l32 * r24) + (l33 * r34) + (l34 * r44);\r\n        e[outOffset + 12] = (l41 * r11) + (l42 * r21) + (l43 * r31) + (l44 * r41);\r\n        e[outOffset + 13] = (l41 * r12) + (l42 * r22) + (l43 * r32) + (l44 * r42);\r\n        e[outOffset + 14] = (l41 * r13) + (l42 * r23) + (l43 * r33) + (l44 * r43);\r\n        e[outOffset + 15] = (l41 * r14) + (l42 * r24) + (l43 * r34) + (l44 * r44);\r\n    }\r\n\r\n    /**@internal */\r\n    private static arcTanAngle(x: number, y: number): number {\r\n\r\n        if (x == 0) {\r\n            if (y == 1)\r\n                return Math.PI / 2;\r\n            return -Math.PI / 2;\r\n        }\r\n        if (x > 0)\r\n            return Math.atan(y / x);\r\n        if (x < 0) {\r\n            if (y > 0)\r\n                return Math.atan(y / x) + Math.PI;\r\n            return Math.atan(y / x) - Math.PI;\r\n        }\r\n        return 0;\r\n    }\r\n\r\n    /**@internal */\r\n    static angleTo(from: Vector3, location: Vector3, angle: Vector3): void {\r\n\r\n        Vector3.subtract(location, from, TEMPVector30);\r\n        Vector3.normalize(TEMPVector30, TEMPVector30);\r\n\r\n        angle.x = Math.asin(TEMPVector30.y);\r\n        angle.y = Utils3D.arcTanAngle(-TEMPVector30.z, -TEMPVector30.x);\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @param source \r\n     * @param rotation Array\r\n     * @param out \r\n     */\r\n    static transformQuat(source: Vector3, rotation: Float32Array, out: Vector3): void {\r\n        var re: Float32Array = rotation;\r\n\r\n        var x: number = source.x, y: number = source.y, z: number = source.z, qx: number = re[0], qy: number = re[1], qz: number = re[2], qw: number = re[3],\r\n\r\n            ix: number = qw * x + qy * z - qz * y, iy: number = qw * y + qz * x - qx * z, iz: number = qw * z + qx * y - qy * x, iw: number = -qx * x - qy * y - qz * z;\r\n\r\n        out.x = ix * qw + iw * -qx + iy * -qz - iz * -qy;\r\n        out.y = iy * qw + iw * -qy + iz * -qx - ix * -qz;\r\n        out.z = iz * qw + iw * -qz + ix * -qy - iy * -qx;\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @param f \r\n     * @param weight \r\n     * @param e \r\n     */\r\n    static quaternionWeight(f: Quaternion, weight: number, e: Quaternion): void {\r\n        e.x = f.x * weight;\r\n        e.y = f.y * weight;\r\n        e.z = f.z * weight;\r\n        e.w = f.w;\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    static quaternionConjugate(value: Quaternion, result: Quaternion): void {\r\n        result.x = -value.x;\r\n        result.y = -value.y;\r\n        result.z = -value.z;\r\n        result.w = value.w;\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    static scaleWeight(s: Vector3, w: number, out: Vector3): void {\r\n        var sX: number = s.x, sY: number = s.y, sZ: number = s.z;\r\n        out.x = sX > 0 ? Math.pow(Math.abs(sX), w) : -Math.pow(Math.abs(sX), w);\r\n        out.y = sY > 0 ? Math.pow(Math.abs(sY), w) : -Math.pow(Math.abs(sY), w);\r\n        out.z = sZ > 0 ? Math.pow(Math.abs(sZ), w) : -Math.pow(Math.abs(sZ), w);\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    static scaleBlend(sa: Vector3, sb: Vector3, w: number, out: Vector3): void {\r\n        var saw: Vector3 = Utils3D._tempVector3_0;\r\n        var sbw: Vector3 = Utils3D._tempVector3_1;\r\n        Utils3D.scaleWeight(sa, 1.0 - w, saw);\r\n        Utils3D.scaleWeight(sb, w, sbw);\r\n        var sng: Vector3 = w > 0.5 ? sb : sa;\r\n        out.x = sng.x > 0 ? Math.abs(saw.x * sbw.x) : -Math.abs(saw.x * sbw.x);\r\n        out.y = sng.y > 0 ? Math.abs(saw.y * sbw.y) : -Math.abs(saw.y * sbw.y);\r\n        out.z = sng.z > 0 ? Math.abs(saw.z * sbw.z) : -Math.abs(saw.z * sbw.z);\r\n    }\r\n\r\n\r\n    /**@internal */\r\n    static matrix4x4MultiplyFFF(a: Float32Array, b: Float32Array, e: Float32Array): void {\r\n\r\n        var i: number, ai0: number, ai1: number, ai2: number, ai3: number;\r\n        if (e === b) {\r\n            b = new Float32Array(16);\r\n            for (i = 0; i < 16; ++i) {\r\n                b[i] = e[i];\r\n            }\r\n        }\r\n\r\n        var b0: number = b[0], b1: number = b[1], b2: number = b[2], b3: number = b[3];\r\n        var b4: number = b[4], b5: number = b[5], b6: number = b[6], b7: number = b[7];\r\n        var b8: number = b[8], b9: number = b[9], b10: number = b[10], b11: number = b[11];\r\n        var b12: number = b[12], b13: number = b[13], b14: number = b[14], b15: number = b[15];\r\n\r\n        for (i = 0; i < 4; i++) {\r\n            ai0 = a[i];\r\n            ai1 = a[i + 4];\r\n            ai2 = a[i + 8];\r\n            ai3 = a[i + 12];\r\n            e[i] = ai0 * b0 + ai1 * b1 + ai2 * b2 + ai3 * b3;\r\n            e[i + 4] = ai0 * b4 + ai1 * b5 + ai2 * b6 + ai3 * b7;\r\n            e[i + 8] = ai0 * b8 + ai1 * b9 + ai2 * b10 + ai3 * b11;\r\n            e[i + 12] = ai0 * b12 + ai1 * b13 + ai2 * b14 + ai3 * b15;\r\n        }\r\n    }\r\n\r\n    /**@internal */\r\n    static matrix4x4MultiplyMFM(left: Matrix4x4, right: Float32Array, out: Matrix4x4): void {\r\n        Utils3D.matrix4x4MultiplyFFF(left.elements, right, out.elements);\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    static _buildTexture2D(width: number, height: number, format: number, colorFunc: Function, mipmaps: boolean = false): Texture2D {\r\n        var texture: Texture2D = new Texture2D(width, height, format, mipmaps, true);\r\n        texture.anisoLevel = 1;\r\n        texture.filterMode = FilterMode.Point;\r\n        TextureGenerator._generateTexture2D(texture, width, height, colorFunc);\r\n        return texture;\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    static _drawBound(debugLine: PixelLineSprite3D, boundBox: BoundBox | Bounds, color: Color): void {\r\n        if (debugLine.lineCount + 12 > debugLine.maxLineCount)\r\n            debugLine.maxLineCount += 12;\r\n\r\n        var start: Vector3 = Utils3D._tempVector3_0;\r\n        var end: Vector3 = Utils3D._tempVector3_1;\r\n        var min: Vector3 = boundBox.min;\r\n        var max: Vector3 = boundBox.max;\r\n\r\n        start.setValue(min.x, min.y, min.z);\r\n        end.setValue(max.x, min.y, min.z);\r\n        debugLine.addLine(start, end, color, color);\r\n\r\n        start.setValue(min.x, min.y, min.z);\r\n        end.setValue(min.x, min.y, max.z);\r\n        debugLine.addLine(start, end, color, color);\r\n\r\n        start.setValue(max.x, min.y, min.z);\r\n        end.setValue(max.x, min.y, max.z);\r\n        debugLine.addLine(start, end, color, color);\r\n\r\n        start.setValue(min.x, min.y, max.z);\r\n        end.setValue(max.x, min.y, max.z);\r\n        debugLine.addLine(start, end, color, color);\r\n\r\n        start.setValue(min.x, min.y, min.z);\r\n        end.setValue(min.x, max.y, min.z);\r\n        debugLine.addLine(start, end, color, color);\r\n\r\n        start.setValue(min.x, min.y, max.z);\r\n        end.setValue(min.x, max.y, max.z);\r\n        debugLine.addLine(start, end, color, color);\r\n\r\n        start.setValue(max.x, min.y, min.z);\r\n        end.setValue(max.x, max.y, min.z);\r\n        debugLine.addLine(start, end, color, color);\r\n\r\n        start.setValue(max.x, min.y, max.z);\r\n        end.setValue(max.x, max.y, max.z);\r\n        debugLine.addLine(start, end, color, color);\r\n\r\n        start.setValue(min.x, max.y, min.z);\r\n        end.setValue(max.x, max.y, min.z);\r\n        debugLine.addLine(start, end, color, color);\r\n\r\n        start.setValue(min.x, max.y, min.z);\r\n        end.setValue(min.x, max.y, max.z);\r\n        debugLine.addLine(start, end, color, color);\r\n\r\n        start.setValue(max.x, max.y, min.z);\r\n        end.setValue(max.x, max.y, max.z);\r\n        debugLine.addLine(start, end, color, color);\r\n\r\n        start.setValue(min.x, max.y, max.z);\r\n        end.setValue(max.x, max.y, max.z);\r\n        debugLine.addLine(start, end, color, color);\r\n    }\r\n\r\n    ///**@internal */\r\n    //private static var _tempHierarchyID:int = 0;\r\n    //\r\n    ///**\r\n    //* @internal\r\n    //*/\r\n    //public static function _getSpritesHierarchyID(sprite:Sprite3D, checkSprites:Array, outIDs:Array):void {\r\n    //var index:int = checkSprites.indexOf(sprite);\r\n    //if (index !== -1)\r\n    //outIDs[index] = _tempHierarchyID;\r\n    //_tempHierarchyID++;\r\n    //var children:Array = sprite._children;\r\n    //for (var i:int = 0, n:int = children.length; i < n; i++)\r\n    //_getSpritesHierarchyID(children[i], checkSprites, outIDs);\r\n    //}\r\n\r\n    /**\r\n     * @internal\r\n     * @param rootSprite parent Sprite\r\n     * @param checkSprite check Sprite\r\n     * @param path pathArray\r\n     * @returns \r\n     */\r\n    static _getHierarchyPath(rootSprite: Node, checkSprite: Node, path: number[]): any[] {\r\n        path.length = 0;\r\n        var sprite: Node = checkSprite;\r\n        while (sprite !== rootSprite) {\r\n            var parent: Node = sprite._parent;\r\n            if (parent)\r\n                path.push(parent.getChildIndex(sprite));\r\n            else\r\n                return null;\r\n            sprite = parent;\r\n        }\r\n        return path;\r\n    }\r\n\r\n    /**\r\n     * @interanl\r\n     * @param rootSprite parentNode\r\n     * @param invPath PathArray\r\n     * @returns \r\n     */\r\n    static _getNodeByHierarchyPath(rootSprite: Node, invPath: number[]): Node {\r\n        var sprite: Node = rootSprite;\r\n        for (var i: number = invPath.length - 1; i >= 0; i--) {\r\n            sprite = sprite.getChildAt(invPath[i]);\r\n        }\r\n        return sprite;\r\n    }\r\n\r\n    static _getParentNodeByHierarchyPath(rootSprite: Node, path: number[]): Node {\r\n        let pathlength = path.length;\r\n        let node: Node = rootSprite;\r\n        for (let i = 0; i < pathlength; i++) {\r\n            if (node)\r\n                node = node.parent;\r\n            else\r\n                return null;\r\n        }\r\n        return node;\r\n    }\r\n\r\n\r\n    /**\r\n     * RenderTextureBase64\r\n     * @param rendertexture Buffer\r\n     * @returns \r\n     */\r\n    static uint8ArrayToArrayBuffer(rendertexture: RenderTexture) {\r\n        let pixelArray: Uint8Array | Float32Array;\r\n        let width = rendertexture.width;\r\n        let height = rendertexture.height;\r\n        switch (rendertexture.colorFormat) {\r\n            case RenderTargetFormat.R8G8B8:\r\n                pixelArray = new Uint8Array(width * height * 4);\r\n                break;\r\n            case RenderTargetFormat.R8G8B8A8:\r\n                pixelArray = new Uint8Array(width * height * 4);\r\n                break;\r\n            case RenderTargetFormat.R16G16B16A16:\r\n                pixelArray = new Float32Array(width * height * 4);\r\n                break;\r\n            default:\r\n                throw \"this function is not surpprt \" + rendertexture.format.toString() + \"format Material\";\r\n        }\r\n        rendertexture.getData(0, 0, rendertexture.width, rendertexture.height, pixelArray);\r\n        //tranceTo\r\n        //throw \" rt get Data\";\r\n        switch (rendertexture.colorFormat) {\r\n            case RenderTargetFormat.R16G16B16A16:\r\n                let ori = pixelArray;\r\n                let trans = new Uint8Array(width * height * 4);\r\n                for (let i = 0, n = ori.length; i < n; i++) {\r\n                    trans[i] = Math.min(Math.floor(ori[i] * 255), 255);\r\n                }\r\n                pixelArray = trans;\r\n                break;\r\n        }\r\n\r\n        let pixels = pixelArray;\r\n        var bs: String;\r\n        if (LayaEnv.isConch) {\r\n            //TODO:\r\n            //var base64img=__JS__(\"conchToBase64('image/png',1,pixels,canvasWidth,canvasHeight)\");\r\n            //var l = base64img.split(\",\");\r\n            //if (isBase64)\r\n            //\treturn base64img;\r\n            //return base.utils.DBUtils.decodeArrayBuffer(l[1]);\r\n        }\r\n        else {\r\n            var canv: HTMLCanvas = new HTMLCanvas(true);\r\n            canv.lock = true;\r\n            canv.size(width, height);\r\n            var ctx2d = canv.getContext('2d');\r\n            //@ts-ignore\r\n            var imgdata: ImageData = ctx2d.createImageData(width, height);\r\n            //@ts-ignore\r\n            imgdata.data.set(new Uint8ClampedArray(pixels));\r\n            //@ts-ignore\r\n            ctx2d.putImageData(imgdata, 0, 0);;\r\n            bs = canv.source.toDataURL();\r\n            canv.destroy();\r\n        }\r\n        return bs;\r\n    }\r\n}\r\n\r\n(window as any).getRTBase64 = Utils3D.uint8ArrayToArrayBuffer;\r\nconst TEMPVector30 = new Vector3();","import { AnimationClipParser03 } from \"./AnimationClipParser03\";\r\nimport { AnimationClipParser04 } from \"./AnimationClipParser04\";\r\nimport { KeyframeNodeList } from \"./KeyframeNodeList\";\r\nimport { AnimationEvent } from \"./AnimationEvent\";\r\nimport { FloatKeyframe } from \"../core/FloatKeyframe\"\r\nimport { QuaternionKeyframe } from \"../core/QuaternionKeyframe\"\r\nimport { Vector3Keyframe } from \"../core/Vector3Keyframe\"\r\nimport { Utils3D } from \"../utils/Utils3D\"\r\nimport { Resource } from \"../../resource/Resource\"\r\nimport { Byte } from \"../../utils/Byte\"\r\nimport { Handler } from \"../../utils/Handler\"\r\nimport { ILaya } from \"../../../ILaya\";\r\nimport { WeightedMode } from \"../core/Keyframe\";\r\nimport { Loader } from \"../../net/Loader\";\r\nimport { Vector2Keyframe } from \"../core/Vector2Keyframe\";\r\nimport { Vector4Keyframe } from \"../core/Vector4Keyframe\";\r\nimport { AvatarMask } from \"../component/Animator/AvatarMask\";\r\nimport { KeyFrameValueType } from \"../component/Animator/KeyframeNodeOwner\";\r\nimport { Quaternion } from \"../../maths/Quaternion\";\r\nimport { Vector2 } from \"../../maths/Vector2\";\r\nimport { Vector3 } from \"../../maths/Vector3\";\r\nimport { Vector4 } from \"../../maths/Vector4\";\r\n\r\n/**\r\n * <code>AnimationClip</code> \r\n */\r\nexport class AnimationClip extends Resource {\r\n\r\n\t/**@internal\t*/\r\n\tstatic _tempQuaternion0: Quaternion = new Quaternion();\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tstatic _parse(data: any): AnimationClip {\r\n\t\tvar clip = new AnimationClip();\r\n\t\tvar reader = new Byte(data);\r\n\t\tvar version = reader.readUTFString();\r\n\t\tswitch (version) {\r\n\t\t\tcase \"LAYAANIMATION:03\":\r\n\t\t\t\tAnimationClipParser03.parse(clip, reader);\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"LAYAANIMATION:04\":\r\n\t\t\tcase \"LAYAANIMATION:COMPRESSION_04\":\r\n\t\t\tcase \"LAYAANIMATION:WEIGHT_04\":\r\n\t\t\tcase \"LAYAANIMATION:WEIGHT_05\":\r\n\t\t\t\tAnimationClipParser04.parse(clip, reader, version);\r\n\t\t\t\tbreak;\r\n\t\t\tdefault:\r\n\t\t\t\tthrow \"unknown animationClip version.\";\r\n\t\t}\r\n\t\treturn clip;\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t * @param url \r\n\t * @param complete  load\r\n\t */\r\n\tstatic load(url: string, complete: Handler): void {\r\n\t\tILaya.loader.load(url, complete, null, Loader.ANIMATIONCLIP);\r\n\t}\r\n\r\n\t/**@internal */\r\n\t_duration: number = 0;\r\n\t/**@internal */\r\n\t_frameRate: number = 0;\r\n\t/**@internal */\r\n\t_nodes: KeyframeNodeList | null = new KeyframeNodeList();\r\n\t/**@internal */\r\n\t_nodesDic: any;\r\n\t/**@internal */\r\n\t_nodesMap: any;//TODO:\r\n\t/** @internal */\r\n\t_animationEvents: AnimationEvent[];\r\n\r\n\t/***/\r\n\tislooping: boolean = false;\r\n\r\n\t/**\r\n\t * \r\n\t * @returns \r\n\t */\r\n\tduration(): number {\r\n\t\treturn this._duration;\r\n\t}\r\n\r\n\t/**\r\n\t *  <code>AnimationClip</code> \r\n\t */\r\n\tconstructor() {\r\n\t\tsuper();\r\n\t\tthis._animationEvents = [];\r\n\t}\r\n\r\n\t/**\r\n\t * Weight\r\n\t * @param weightMode \r\n\t * @param nextweightMode \r\n\t * @returns true \r\n\t */\r\n\tprivate _weightModeHermite(weightMode: number, nextweightMode: number): boolean {\r\n\t\treturn (((weightMode & WeightedMode.Out) == 0) && ((nextweightMode & WeightedMode.In) == 0));\r\n\t}\r\n\r\n\r\n\r\n\t/**\r\n\t * @internal\r\n\t */\r\n\tprivate _hermiteInterpolate(frame: FloatKeyframe, nextFrame: FloatKeyframe, t: number, dur: number): number {\r\n\t\tvar t0 = frame.outTangent, t1 = nextFrame.inTangent;\r\n\t\tif (Number.isFinite(t0) && Number.isFinite(t1)) {\r\n\t\t\tvar t2 = t * t;\r\n\t\t\tvar t3 = t2 * t;\r\n\t\t\tvar a = 2.0 * t3 - 3.0 * t2 + 1.0;\r\n\t\t\tvar b = t3 - 2.0 * t2 + t;\r\n\t\t\tvar c = t3 - t2;\r\n\t\t\tvar d = -2.0 * t3 + 3.0 * t2;\r\n\t\t\treturn a * frame.value + b * t0 * dur + c * t1 * dur + d * nextFrame.value;\r\n\t\t} else\r\n\t\t\treturn frame.value;\r\n\t}\r\n\r\n\t/**\r\n\t * @internal\r\n\t */\r\n\tprivate _hermiteInterpolateVector3(frame: Vector3Keyframe, nextFrame: Vector3Keyframe, t: number, dur: number, out: Vector3): void {\r\n\t\tvar p0 = frame.value;\r\n\t\tvar tan0 = frame.outTangent;\r\n\t\tvar p1 = nextFrame.value;\r\n\t\tvar tan1 = nextFrame.inTangent;\r\n\r\n\t\tvar t2 = t * t;\r\n\t\tvar t3 = t2 * t;\r\n\t\tvar a = 2.0 * t3 - 3.0 * t2 + 1.0;\r\n\t\tvar b = t3 - 2.0 * t2 + t;\r\n\t\tvar c = t3 - t2;\r\n\t\tvar d = -2.0 * t3 + 3.0 * t2;\r\n\r\n\t\tvar t0 = tan0.x, t1 = tan1.x;\r\n\t\tif ((!frame.weightedMode) || this._weightModeHermite(frame.weightedMode.x, nextFrame.weightedMode.x)) {\r\n\t\t\tif (Number.isFinite(t0) && Number.isFinite(t1))\r\n\t\t\t\tout.x = a * p0.x + b * t0 * dur + c * t1 * dur + d * p1.x;\r\n\t\t\telse\r\n\t\t\t\tout.x = p0.x;\r\n\t\t} else {\r\n\t\t\tout.x = this._hermiteCurveSplineWeight(frame.value.x, frame.time, frame.outWeight.x, frame.outTangent.x,\r\n\t\t\t\tnextFrame.value.x, nextFrame.time, nextFrame.inWeight.x, nextFrame.inTangent.x, t);\r\n\t\t}\r\n\r\n\t\tt0 = tan0.y, t1 = tan1.y;\r\n\t\tif ((!frame.weightedMode) || this._weightModeHermite(frame.weightedMode.y, nextFrame.weightedMode.y)) {\r\n\t\t\tif (Number.isFinite(t0) && Number.isFinite(t1))\r\n\t\t\t\tout.y = a * p0.y + b * t0 * dur + c * t1 * dur + d * p1.y;\r\n\t\t\telse\r\n\t\t\t\tout.y = p0.y;\r\n\t\t} else {\r\n\t\t\tout.y = this._hermiteCurveSplineWeight(frame.value.y, frame.time, frame.outWeight.y, frame.outTangent.y,\r\n\t\t\t\tnextFrame.value.y, nextFrame.time, nextFrame.inWeight.y, nextFrame.inTangent.y, t);\r\n\t\t}\r\n\r\n\t\tt0 = tan0.z, t1 = tan1.z;\r\n\t\tif ((!frame.weightedMode) || this._weightModeHermite(frame.weightedMode.z, nextFrame.weightedMode.z)) {\r\n\t\t\tif (Number.isFinite(t0) && Number.isFinite(t1))\r\n\t\t\t\tout.z = a * p0.z + b * t0 * dur + c * t1 * dur + d * p1.z;\r\n\t\t\telse\r\n\t\t\t\tout.z = p0.z;\r\n\t\t} else {\r\n\t\t\tout.z = this._hermiteCurveSplineWeight(frame.value.z, frame.time, frame.outWeight.z, frame.outTangent.z,\r\n\t\t\t\tnextFrame.value.z, nextFrame.time, nextFrame.inWeight.z, nextFrame.inTangent.z, t);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @internal\r\n\t */\r\n\tprivate _hermiteInterpolateQuaternion(frame: QuaternionKeyframe, nextFrame: QuaternionKeyframe, t: number, dur: number, out: Quaternion): void {\r\n\t\tvar p0 = frame.value;\r\n\t\tvar tan0 = frame.outTangent;\r\n\t\tvar p1 = nextFrame.value;\r\n\t\tvar tan1 = nextFrame.inTangent;\r\n\r\n\t\tvar t2 = t * t;\r\n\t\tvar t3 = t2 * t;\r\n\t\tvar a = 2.0 * t3 - 3.0 * t2 + 1.0;\r\n\t\tvar b = t3 - 2.0 * t2 + t;\r\n\t\tvar c = t3 - t2;\r\n\t\tvar d = -2.0 * t3 + 3.0 * t2;\r\n\r\n\t\tvar t0 = tan0.x, t1 = tan1.x;\r\n\t\tif ((!frame.weightedMode) || this._weightModeHermite(frame.weightedMode.x, nextFrame.weightedMode.x)) {\r\n\t\t\tif (Number.isFinite(t0) && Number.isFinite(t1))\r\n\t\t\t\tout.x = a * p0.x + b * t0 * dur + c * t1 * dur + d * p1.x;\r\n\t\t\telse\r\n\t\t\t\tout.x = p0.x;\r\n\t\t} else {\r\n\t\t\tout.x = this._hermiteCurveSplineWeight(frame.value.x, frame.time, frame.outWeight.x, frame.outTangent.x,\r\n\t\t\t\tnextFrame.value.x, nextFrame.time, nextFrame.inWeight.x, nextFrame.inTangent.x, t);\r\n\t\t}\r\n\r\n\r\n\t\tt0 = tan0.y, t1 = tan1.y;\r\n\t\tif ((!frame.weightedMode) || this._weightModeHermite(frame.weightedMode.y, nextFrame.weightedMode.y)) {\r\n\t\t\tif (Number.isFinite(t0) && Number.isFinite(t1))\r\n\t\t\t\tout.y = a * p0.y + b * t0 * dur + c * t1 * dur + d * p1.y;\r\n\t\t\telse\r\n\t\t\t\tout.y = p0.y;\r\n\t\t} else {\r\n\t\t\tout.y = this._hermiteCurveSplineWeight(frame.value.y, frame.time, frame.outWeight.y, frame.outTangent.y,\r\n\t\t\t\tnextFrame.value.y, nextFrame.time, nextFrame.inWeight.y, nextFrame.inTangent.y, t);\r\n\t\t}\r\n\r\n\t\tt0 = tan0.z, t1 = tan1.z;\r\n\t\tif ((!frame.weightedMode) || this._weightModeHermite(frame.weightedMode.z, nextFrame.weightedMode.z)) {\r\n\t\t\tif (Number.isFinite(t0) && Number.isFinite(t1))\r\n\t\t\t\tout.z = a * p0.z + b * t0 * dur + c * t1 * dur + d * p1.z;\r\n\t\t\telse\r\n\t\t\t\tout.z = p0.z;\r\n\t\t} else {\r\n\t\t\tout.z = this._hermiteCurveSplineWeight(frame.value.z, frame.time, frame.outWeight.z, frame.outTangent.z,\r\n\t\t\t\tnextFrame.value.z, nextFrame.time, nextFrame.inWeight.z, nextFrame.inTangent.z, t);\r\n\t\t}\r\n\r\n\t\tt0 = tan0.w, t1 = tan1.w;\r\n\t\tif ((!frame.weightedMode) || this._weightModeHermite(frame.weightedMode.w, nextFrame.weightedMode.w)) {\r\n\t\t\tif (Number.isFinite(t0) && Number.isFinite(t1))\r\n\t\t\t\tout.w = a * p0.w + b * t0 * dur + c * t1 * dur + d * p1.w;\r\n\t\t\telse\r\n\t\t\t\tout.w = p0.w;\r\n\t\t} else {\r\n\t\t\tout.w = this._hermiteCurveSplineWeight(frame.value.w, frame.time, frame.outWeight.w, frame.outTangent.w,\r\n\t\t\t\tnextFrame.value.w, nextFrame.time, nextFrame.inWeight.w, nextFrame.inTangent.w, t);\r\n\t\t}\r\n\t}\r\n\r\n\tprivate _hermiteInterpolateVector4(frame: Vector4Keyframe, nextFrame: Vector4Keyframe, t: number, dur: number, out: Vector4) {\r\n\t\tvar p0 = frame.value;\r\n\t\tvar tan0 = frame.outTangent;\r\n\t\tvar p1 = nextFrame.value;\r\n\t\tvar tan1 = nextFrame.inTangent;\r\n\r\n\t\tvar t2 = t * t;\r\n\t\tvar t3 = t2 * t;\r\n\t\tvar a = 2.0 * t3 - 3.0 * t2 + 1.0;\r\n\t\tvar b = t3 - 2.0 * t2 + t;\r\n\t\tvar c = t3 - t2;\r\n\t\tvar d = -2.0 * t3 + 3.0 * t2;\r\n\r\n\t\tvar t0 = tan0.x, t1 = tan1.x;\r\n\t\tif ((!frame.weightedMode) || this._weightModeHermite(frame.weightedMode.x, nextFrame.weightedMode.x)) {\r\n\t\t\tif (Number.isFinite(t0) && Number.isFinite(t1))\r\n\t\t\t\tout.x = a * p0.x + b * t0 * dur + c * t1 * dur + d * p1.x;\r\n\t\t\telse\r\n\t\t\t\tout.x = p0.x;\r\n\t\t} else {\r\n\t\t\tout.x = this._hermiteCurveSplineWeight(frame.value.x, frame.time, frame.outWeight.x, frame.outTangent.x,\r\n\t\t\t\tnextFrame.value.x, nextFrame.time, nextFrame.inWeight.x, nextFrame.inTangent.x, t);\r\n\t\t}\r\n\t\tt0 = tan0.y, t1 = tan1.y;\r\n\t\tif ((!frame.weightedMode) || this._weightModeHermite(frame.weightedMode.y, nextFrame.weightedMode.y)) {\r\n\t\t\tif (Number.isFinite(t0) && Number.isFinite(t1))\r\n\t\t\t\tout.y = a * p0.y + b * t0 * dur + c * t1 * dur + d * p1.y;\r\n\t\t\telse\r\n\t\t\t\tout.y = p0.y;\r\n\t\t} else {\r\n\t\t\tout.y = this._hermiteCurveSplineWeight(frame.value.y, frame.time, frame.outWeight.y, frame.outTangent.y,\r\n\t\t\t\tnextFrame.value.y, nextFrame.time, nextFrame.inWeight.y, nextFrame.inTangent.y, t);\r\n\t\t}\r\n\r\n\t\tt0 = tan0.z, t1 = tan1.z;\r\n\t\tif ((!frame.weightedMode) || this._weightModeHermite(frame.weightedMode.z, nextFrame.weightedMode.z)) {\r\n\t\t\tif (Number.isFinite(t0) && Number.isFinite(t1))\r\n\t\t\t\tout.z = a * p0.z + b * t0 * dur + c * t1 * dur + d * p1.z;\r\n\t\t\telse\r\n\t\t\t\tout.z = p0.z;\r\n\t\t} else {\r\n\t\t\tout.z = this._hermiteCurveSplineWeight(frame.value.z, frame.time, frame.outWeight.z, frame.outTangent.z,\r\n\t\t\t\tnextFrame.value.z, nextFrame.time, nextFrame.inWeight.z, nextFrame.inTangent.z, t);\r\n\t\t}\r\n\r\n\t\tt0 = tan0.w, t1 = tan1.w;\r\n\t\tif ((!frame.weightedMode) || this._weightModeHermite(frame.weightedMode.w, nextFrame.weightedMode.w)) {\r\n\t\t\tif (Number.isFinite(t0) && Number.isFinite(t1))\r\n\t\t\t\tout.w = a * p0.w + b * t0 * dur + c * t1 * dur + d * p1.w;\r\n\t\t\telse\r\n\t\t\t\tout.w = p0.w;\r\n\t\t} else {\r\n\t\t\tout.w = this._hermiteCurveSplineWeight(frame.value.w, frame.time, frame.outWeight.w, frame.outTangent.w,\r\n\t\t\t\tnextFrame.value.w, nextFrame.time, nextFrame.inWeight.w, nextFrame.inTangent.w, t);\r\n\t\t}\r\n\t}\r\n\r\n\tprivate _hermiteInterpolateVector2(frame: Vector2Keyframe, nextFrame: Vector2Keyframe, t: number, dur: number, out: Vector2) {\r\n\t\tvar p0 = frame.value;\r\n\t\tvar tan0 = frame.outTangent;\r\n\t\tvar p1 = nextFrame.value;\r\n\t\tvar tan1 = nextFrame.inTangent;\r\n\r\n\t\tvar t2 = t * t;\r\n\t\tvar t3 = t2 * t;\r\n\t\tvar a = 2.0 * t3 - 3.0 * t2 + 1.0;\r\n\t\tvar b = t3 - 2.0 * t2 + t;\r\n\t\tvar c = t3 - t2;\r\n\t\tvar d = -2.0 * t3 + 3.0 * t2;\r\n\r\n\t\tvar t0 = tan0.x, t1 = tan1.x;\r\n\t\tif ((!frame.weightedMode) || this._weightModeHermite(frame.weightedMode.x, nextFrame.weightedMode.x)) {\r\n\t\t\tif (Number.isFinite(t0) && Number.isFinite(t1))\r\n\t\t\t\tout.x = a * p0.x + b * t0 * dur + c * t1 * dur + d * p1.x;\r\n\t\t\telse\r\n\t\t\t\tout.x = p0.x;\r\n\t\t} else {\r\n\t\t\tout.x = this._hermiteCurveSplineWeight(frame.value.x, frame.time, frame.outWeight.x, frame.outTangent.x,\r\n\t\t\t\tnextFrame.value.x, nextFrame.time, nextFrame.inWeight.x, nextFrame.inTangent.x, t);\r\n\t\t}\r\n\r\n\t\tt0 = tan0.y, t1 = tan1.y;\r\n\t\tif ((!frame.weightedMode) || this._weightModeHermite(frame.weightedMode.y, nextFrame.weightedMode.y)) {\r\n\t\t\tif (Number.isFinite(t0) && Number.isFinite(t1))\r\n\t\t\t\tout.y = a * p0.y + b * t0 * dur + c * t1 * dur + d * p1.y;\r\n\t\t\telse\r\n\t\t\t\tout.y = p0.y;\r\n\t\t} else {\r\n\t\t\tout.y = this._hermiteCurveSplineWeight(frame.value.y, frame.time, frame.outWeight.y, frame.outTangent.y,\r\n\t\t\t\tnextFrame.value.y, nextFrame.time, nextFrame.inWeight.y, nextFrame.inTangent.y, t);\r\n\t\t}\r\n\t}\r\n\r\n\tprivate _hermiteCurveSplineWeight(frameValue: number, frametime: number, frameOutWeight: number, frameOutTangent: number, nextframeValue: number, nextframetime: number, nextframeInweight: number, nextframeIntangent: number, time: number) {\r\n\t\tlet Eps = 2.22e-16;\r\n\r\n\t\tlet x = time;\r\n\t\tlet x1 = frametime;\r\n\t\tlet y1 = frameValue;\r\n\t\tlet wt1 = frameOutWeight;\r\n\t\tlet x2 = nextframetime;\r\n\t\tlet y2 = nextframeValue;\r\n\t\tlet wt2 = nextframeInweight;\r\n\r\n\t\tlet dx = x2 - x1;\r\n\t\tlet dy = y2 - y1;\r\n\t\tdy = Math.max(Math.abs(dy), Eps) * (dy < 0 ? -1 : 1);\r\n\r\n\t\tlet yp1 = frameOutTangent;\r\n\t\tlet yp2 = nextframeIntangent;\r\n\r\n\t\tif (!Number.isFinite(yp1) || !Number.isFinite(yp2)) {\r\n\t\t\treturn frameValue;\r\n\t\t}\r\n\r\n\t\typ1 = yp1 * dx / dy;\r\n\t\typ2 = yp2 * dx / dy;\r\n\r\n\t\tlet wt2s = 1 - wt2;\r\n\r\n\t\tlet t = 0.5;\r\n\t\tlet t2 = 0;\r\n\r\n\t\tif (Math.abs(wt1 - 0.33333334) < 0.0001 && Math.abs(wt2 - 0.33333334) < 0.0001) {\r\n\t\t\tt = x;\r\n\t\t\tt2 = 1 - t;\r\n\t\t}\r\n\t\telse {\r\n\t\t\twhile (true) {\r\n\t\t\t\tt2 = (1 - t);\r\n\t\t\t\tlet fg = 3 * t2 * t2 * t * wt1 + 3 * t2 * t * t * wt2s + t * t * t - x;\r\n\t\t\t\tif (Math.abs(fg) <= 2.5 * Eps)\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t// third order householder method\r\n\t\t\t\tlet fpg = 3 * t2 * t2 * wt1 + 6 * t2 * t * (wt2s - wt1) + 3 * t * t * (1 - wt2s);\r\n\t\t\t\tlet fppg = 6 * t2 * (wt2s - 2 * wt1) + 6 * t * (1 - 2 * wt2s + wt1);\r\n\t\t\t\tlet fpppg = 18 * wt1 - 18 * wt2s + 6;\r\n\r\n\t\t\t\tt -= (6 * fg * fpg * fpg - 3 * fg * fg * fppg) / (6 * fpg * fpg * fpg - 6 * fg * fpg * fppg + fg * fg * fpppg);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tlet y = 3 * t2 * t2 * t * wt1 * yp1 + 3 * t2 * t * t * (1 - wt2 * yp2) + t * t * t;\r\n\r\n\t\treturn y * dy + y1;\r\n\t}\r\n\r\n\tprivate _curveInterpolate(frame: FloatKeyframe, nextFrame: FloatKeyframe, t: number, dur: number): number {\r\n\t\tif ((!frame.weightedMode) || this._weightModeHermite(frame.weightedMode, nextFrame.weightedMode)) {\r\n\t\t\treturn this._hermiteInterpolate(frame, nextFrame, t, dur);\r\n\t\t} else {\r\n\t\t\t//weight\r\n\t\t\treturn this._hermiteCurveSplineWeight(frame.value, frame.time, frame.outWeight, frame.outTangent,\r\n\t\t\t\tnextFrame.value, nextFrame.time, nextFrame.inWeight, nextFrame.inTangent, t);\r\n\t\t}\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * @internal\r\n\t * @param nodes \r\n\t * @param playCurTime \r\n\t * @param realTimeCurrentFrameIndexes \r\n\t * @param addtive addtive\r\n\t * @param frontPlay \r\n\t * @param outDatas \r\n\t */\r\n\t_evaluateClipDatasRealTime(nodes: KeyframeNodeList, playCurTime: number, realTimeCurrentFrameIndexes: Int16Array, addtive: boolean, frontPlay: boolean, outDatas: Array<number | Vector3 | Quaternion | Vector4 | Vector2>, avatarMask: AvatarMask): void {\r\n\t\tfor (var i = 0, n = nodes.count; i < n; i++) {\r\n\t\t\tvar node = nodes.getNodeByIndex(i);\r\n\t\t\tvar type = node.type;\r\n\t\t\tvar nextFrameIndex;\r\n\t\t\tvar keyFrames = node._keyFrames;\r\n\t\t\tvar keyFramesCount = keyFrames.length;\r\n\t\t\tvar frameIndex = realTimeCurrentFrameIndexes[i];\r\n\t\t\tif (avatarMask && (!avatarMask.getTransformActive(node.nodePath))) {\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\t\t\tif (frontPlay) {\r\n\t\t\t\tif ((frameIndex !== -1) && (playCurTime < keyFrames[frameIndex].time)) {//\r\n\t\t\t\t\tframeIndex = -1;\r\n\t\t\t\t\trealTimeCurrentFrameIndexes[i] = frameIndex;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tnextFrameIndex = frameIndex + 1;\r\n\t\t\t\twhile (nextFrameIndex < keyFramesCount) {\r\n\t\t\t\t\tif (keyFrames[nextFrameIndex].time > playCurTime)\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tframeIndex++;\r\n\t\t\t\t\tnextFrameIndex++;\r\n\t\t\t\t\trealTimeCurrentFrameIndexes[i] = frameIndex;\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tnextFrameIndex = frameIndex + 1;\r\n\t\t\t\tif ((nextFrameIndex !== keyFramesCount) && (playCurTime > keyFrames[nextFrameIndex].time)) {//\r\n\t\t\t\t\tframeIndex = keyFramesCount - 1;\r\n\t\t\t\t\trealTimeCurrentFrameIndexes[i] = frameIndex;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tnextFrameIndex = frameIndex + 1;\r\n\t\t\t\twhile (frameIndex > -1) {\r\n\t\t\t\t\tif (keyFrames[frameIndex].time < playCurTime)\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tframeIndex--;\r\n\t\t\t\t\tnextFrameIndex--;\r\n\t\t\t\t\trealTimeCurrentFrameIndexes[i] = frameIndex;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tvar isEnd = nextFrameIndex === keyFramesCount;\r\n\t\t\tswitch (type) {\r\n\t\t\t\tcase KeyFrameValueType.Float:\r\n\t\t\t\t\tif (frameIndex !== -1) {\r\n\t\t\t\t\t\tvar frame = (<FloatKeyframe>keyFrames[frameIndex]);\r\n\t\t\t\t\t\tif (isEnd) {//nextFarme\r\n\t\t\t\t\t\t\toutDatas[i] = frame.value;\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tvar nextFarme = (<FloatKeyframe>keyFrames[nextFrameIndex]);\r\n\t\t\t\t\t\t\tvar d = nextFarme.time - frame.time;\r\n\t\t\t\t\t\t\tvar t;\r\n\t\t\t\t\t\t\tif (d !== 0)\r\n\t\t\t\t\t\t\t\tt = (playCurTime - frame.time) / d;\r\n\t\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\t\tt = 0;\r\n\t\t\t\t\t\t\toutDatas[i] = this._curveInterpolate(frame, nextFarme, t, d);\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\toutDatas[i] = (<FloatKeyframe>keyFrames[0]).value;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif (addtive)\r\n\t\t\t\t\t\toutDatas[i] = <number>outDatas[i] - (<FloatKeyframe>keyFrames[0]).value;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase KeyFrameValueType.Position:\r\n\t\t\t\tcase KeyFrameValueType.RotationEuler:\r\n\t\t\t\tcase KeyFrameValueType.Vector3:\r\n\t\t\t\t\tvar clipData = <Vector3>outDatas[i];\r\n\t\t\t\t\tthis._evaluateFrameNodeVector3DatasRealTime(keyFrames as Vector3Keyframe[], frameIndex, isEnd, playCurTime, clipData);\r\n\t\t\t\t\tif (addtive) {\r\n\t\t\t\t\t\tvar firstFrameValue = ((<Vector3Keyframe>keyFrames[0])).value;\r\n\t\t\t\t\t\tclipData.x -= firstFrameValue.x;\r\n\t\t\t\t\t\tclipData.y -= firstFrameValue.y;\r\n\t\t\t\t\t\tclipData.z -= firstFrameValue.z;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase KeyFrameValueType.Rotation:\r\n\t\t\t\t\tvar clipQuat = <Quaternion>outDatas[i];\r\n\t\t\t\t\tthis._evaluateFrameNodeQuaternionDatasRealTime(keyFrames as QuaternionKeyframe[], frameIndex, isEnd, playCurTime, clipQuat);\r\n\t\t\t\t\tif (addtive) {\r\n\t\t\t\t\t\tvar tempQuat = AnimationClip._tempQuaternion0;\r\n\t\t\t\t\t\tvar firstFrameValueQua = ((<QuaternionKeyframe>keyFrames[0])).value;\r\n\t\t\t\t\t\tUtils3D.quaternionConjugate(firstFrameValueQua, tempQuat);\r\n\t\t\t\t\t\tQuaternion.multiply(tempQuat, clipQuat, clipQuat);\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase KeyFrameValueType.Scale:\r\n\t\t\t\t\tclipData = <Vector3>outDatas[i];\r\n\t\t\t\t\tthis._evaluateFrameNodeVector3DatasRealTime(keyFrames as Vector3Keyframe[], frameIndex, isEnd, playCurTime, clipData);\r\n\t\t\t\t\tif (addtive) {\r\n\t\t\t\t\t\tfirstFrameValue = ((<Vector3Keyframe>keyFrames[0])).value;\r\n\t\t\t\t\t\tclipData.x /= firstFrameValue.x;\r\n\t\t\t\t\t\tclipData.y /= firstFrameValue.y;\r\n\t\t\t\t\t\tclipData.z /= firstFrameValue.z;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase KeyFrameValueType.Vector2:\r\n\t\t\t\t\tvar v2Data = <Vector2>outDatas[i];\r\n\t\t\t\t\tthis._evaluateFrameNodeVector2DatasRealTime(keyFrames as Vector2Keyframe[], frameIndex, isEnd, playCurTime, v2Data);\r\n\t\t\t\t\tif (addtive) {\r\n\t\t\t\t\t\tvar v2FrameValue = ((<Vector2Keyframe>keyFrames[0])).value;\r\n\t\t\t\t\t\tv2Data.x -= v2FrameValue.x;\r\n\t\t\t\t\t\tv2Data.y -= v2FrameValue.y;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase KeyFrameValueType.Vector4:\r\n\t\t\t\tcase KeyFrameValueType.Color:\r\n\t\t\t\t\tvar v4Data = <Vector4>outDatas[i];\r\n\t\t\t\t\tthis._evaluateFrameNodeVector4DatasRealTime(keyFrames as Vector4Keyframe[], frameIndex, isEnd, playCurTime, v4Data);\r\n\t\t\t\t\tif (addtive) {\r\n\t\t\t\t\t\tvar v4FrameValue = ((<Vector4Keyframe>keyFrames[0])).value;\r\n\t\t\t\t\t\tv4Data.x -= v4FrameValue.x;\r\n\t\t\t\t\t\tv4Data.y -= v4FrameValue.y;\r\n\t\t\t\t\t\tv4Data.z -= v4FrameValue.z;\r\n\t\t\t\t\t\tv4Data.w -= v4FrameValue.w;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tdefault:\r\n\t\t\t\t\tthrow \"AnimationClip:unknown node type.\";\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tprivate _evaluateFrameNodeVector3DatasRealTime(keyFrames: Vector3Keyframe[], frameIndex: number, isEnd: boolean, playCurTime: number, outDatas: Vector3): void {\r\n\t\tif (frameIndex !== -1) {\r\n\t\t\tvar frame = keyFrames[frameIndex];\r\n\t\t\tif (isEnd) {\r\n\t\t\t\tvar frameData = frame.value;\r\n\t\t\t\toutDatas.x = frameData.x;//null\r\n\t\t\t\toutDatas.y = frameData.y;\r\n\t\t\t\toutDatas.z = frameData.z;\r\n\t\t\t} else {\r\n\t\t\t\tvar nextKeyFrame = keyFrames[frameIndex + 1];\r\n\t\t\t\tvar t;\r\n\t\t\t\tvar startTime = frame.time;\r\n\t\t\t\tvar d = nextKeyFrame.time - startTime;\r\n\t\t\t\tif (d !== 0)\r\n\t\t\t\t\tt = (playCurTime - startTime) / d;\r\n\t\t\t\telse\r\n\t\t\t\t\tt = 0;\r\n\r\n\t\t\t\tthis._hermiteInterpolateVector3(frame, nextKeyFrame, t, d, outDatas);\r\n\t\t\t}\r\n\r\n\t\t} else {\r\n\t\t\tvar firstFrameDatas = keyFrames[0].value;\r\n\t\t\toutDatas.x = firstFrameDatas.x;\r\n\t\t\toutDatas.y = firstFrameDatas.y;\r\n\t\t\toutDatas.z = firstFrameDatas.z;\r\n\t\t}\r\n\t}\r\n\r\n\tprivate _evaluateFrameNodeVector2DatasRealTime(keyFrames: Vector2Keyframe[], frameIndex: number, isEnd: boolean, playCurTime: number, outDatas: Vector2): void {\r\n\t\tif (frameIndex !== -1) {\r\n\t\t\tvar frame = keyFrames[frameIndex];\r\n\t\t\tif (isEnd) {\r\n\t\t\t\tvar frameData = frame.value;\r\n\t\t\t\toutDatas.x = frameData.x;//null\r\n\t\t\t\toutDatas.y = frameData.y;\r\n\t\t\t} else {\r\n\t\t\t\tvar nextKeyFrame = keyFrames[frameIndex + 1];\r\n\t\t\t\tvar t;\r\n\t\t\t\tvar startTime = frame.time;\r\n\t\t\t\tvar d = nextKeyFrame.time - startTime;\r\n\t\t\t\tif (d !== 0)\r\n\t\t\t\t\tt = (playCurTime - startTime) / d;\r\n\t\t\t\telse\r\n\t\t\t\t\tt = 0;\r\n\r\n\t\t\t\tthis._hermiteInterpolateVector2(frame, nextKeyFrame, t, d, outDatas);\r\n\t\t\t}\r\n\r\n\t\t} else {\r\n\t\t\tvar firstFrameDatas = keyFrames[0].value;\r\n\t\t\toutDatas.x = firstFrameDatas.x;\r\n\t\t\toutDatas.y = firstFrameDatas.y;\r\n\t\t}\r\n\t}\r\n\r\n\tprivate _evaluateFrameNodeVector4DatasRealTime(keyFrames: Vector4Keyframe[], frameIndex: number, isEnd: boolean, playCurTime: number, outDatas: Vector4): void {\r\n\t\tif (frameIndex !== -1) {\r\n\t\t\tvar frame = keyFrames[frameIndex];\r\n\t\t\tif (isEnd) {\r\n\t\t\t\tvar frameData = frame.value;\r\n\t\t\t\toutDatas.x = frameData.x;//null\r\n\t\t\t\toutDatas.y = frameData.y;\r\n\t\t\t\toutDatas.z = frameData.z;\r\n\t\t\t} else {\r\n\t\t\t\tvar nextKeyFrame = keyFrames[frameIndex + 1];\r\n\t\t\t\tvar t;\r\n\t\t\t\tvar startTime = frame.time;\r\n\t\t\t\tvar d = nextKeyFrame.time - startTime;\r\n\t\t\t\tif (d !== 0)\r\n\t\t\t\t\tt = (playCurTime - startTime) / d;\r\n\t\t\t\telse\r\n\t\t\t\t\tt = 0;\r\n\r\n\t\t\t\tthis._hermiteInterpolateVector4(frame, nextKeyFrame, t, d, outDatas);\r\n\t\t\t}\r\n\r\n\t\t} else {\r\n\t\t\tvar firstFrameDatas = keyFrames[0].value;\r\n\t\t\toutDatas.x = firstFrameDatas.x;\r\n\t\t\toutDatas.y = firstFrameDatas.y;\r\n\t\t\toutDatas.z = firstFrameDatas.z;\r\n\t\t}\r\n\t}\r\n\r\n\r\n\tprivate _evaluateFrameNodeQuaternionDatasRealTime(keyFrames: QuaternionKeyframe[], frameIndex: number, isEnd: boolean, playCurTime: number, outDatas: Quaternion): void {\r\n\t\tif (frameIndex !== -1) {\r\n\t\t\tvar frame = keyFrames[frameIndex];\r\n\t\t\tif (isEnd) {\r\n\t\t\t\tvar frameData = frame.value;\r\n\t\t\t\toutDatas.x = frameData.x;//null\r\n\t\t\t\toutDatas.y = frameData.y;\r\n\t\t\t\toutDatas.z = frameData.z;\r\n\t\t\t\toutDatas.w = frameData.w;\r\n\t\t\t} else {\r\n\t\t\t\tvar nextKeyFrame = keyFrames[frameIndex + 1];\r\n\t\t\t\tvar t;\r\n\t\t\t\tvar startTime = frame.time;\r\n\t\t\t\tvar d = nextKeyFrame.time - startTime;\r\n\t\t\t\tif (d !== 0)\r\n\t\t\t\t\tt = (playCurTime - startTime) / d;\r\n\t\t\t\telse\r\n\t\t\t\t\tt = 0;\r\n\r\n\t\t\t\tthis._hermiteInterpolateQuaternion(frame, nextKeyFrame, t, d, outDatas);\r\n\t\t\t}\r\n\r\n\t\t} else {\r\n\t\t\tvar firstFrameDatas = keyFrames[0].value;\r\n\t\t\toutDatas.x = firstFrameDatas.x;\r\n\t\t\toutDatas.y = firstFrameDatas.y;\r\n\t\t\toutDatas.z = firstFrameDatas.z;\r\n\t\t\toutDatas.w = firstFrameDatas.w;\r\n\t\t}\r\n\t}\r\n\r\n\tprivate _binarySearchEventIndex(time: number): number {\r\n\t\tvar start = 0;\r\n\t\tvar end = this._animationEvents.length - 1;\r\n\t\tvar mid;\r\n\t\twhile (start <= end) {\r\n\t\t\tmid = Math.floor((start + end) / 2);\r\n\t\t\tvar midValue = this._animationEvents[mid].time;\r\n\t\t\tif (midValue == time)\r\n\t\t\t\treturn mid;\r\n\t\t\telse if (midValue > time)\r\n\t\t\t\tend = mid - 1;\r\n\t\t\telse\r\n\t\t\t\tstart = mid + 1;\r\n\t\t}\r\n\t\treturn start;\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t * @param event \r\n\t */\r\n\taddEvent(event: AnimationEvent): void {\r\n\t\tvar index = this._binarySearchEventIndex(event.time);\r\n\t\tthis._animationEvents.splice(index, 0, event);\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t * @override\r\n\t */\r\n\tprotected _disposeResource(): void {\r\n\t\tthis._nodes = null;\r\n\t\tthis._nodesMap = null;\r\n\t}\r\n}\r\n\r\n\r\n\r\n","import { IRenderEngine3DOBJFactory } from \"./IRenderEngine3DOBJFactory\";\r\n\r\nexport class Laya3DRender {\r\n    static renderOBJCreate: IRenderEngine3DOBJFactory;\r\n}","import { Node } from \"../../display/Node\";\r\nimport { Handler } from \"../../utils/Handler\";\r\nimport { Transform3D } from \"./Transform3D\";\r\nimport { Shader3D } from \"../../RenderEngine/RenderShader/Shader3D\";\r\nimport { Stat } from \"../../utils/Stat\";\r\nimport { Prefab } from \"../../resource/HierarchyResource\";\r\nimport { ILaya } from \"../../../ILaya\";\r\nimport { CommandUniformMap } from \"../../RenderEngine/CommandUniformMap\";\r\nimport { NodeFlags } from \"../../Const\";\r\nimport { Event } from \"../../events/Event\";\r\nimport { Matrix4x4 } from \"../../maths/Matrix4x4\";\r\nimport { Quaternion } from \"../../maths/Quaternion\";\r\nimport { Vector3 } from \"../../maths/Vector3\";\r\nimport { Scene3D } from \"./scene/Scene3D\";\r\nimport { ShaderDataType } from \"../../RenderEngine/RenderShader/ShaderData\";\r\nimport { LayaGL } from \"../../layagl/LayaGL\";\r\nimport { Laya3DRender } from \"../RenderObjs/Laya3DRender\";\r\n\r\n/**\r\n * @internal\r\n */\r\nexport enum StaticFlag {\r\n    Normal = 1 << 0,\r\n    StaticBatch = 1 << 1,\r\n}\r\n\r\n/**\r\n * <code>Sprite3D</code> 3D\r\n */\r\nexport class Sprite3D extends Node {\r\n    /**@internal */\r\n    static WORLDMATRIX: number;\r\n    static WORLDINVERTFRONT: number;//-11\r\n    /**@internal */\r\n    static sprite3DCommandUniformMap: CommandUniformMap;\r\n    /**@internal */\r\n    protected static _uniqueIDCounter: number = 0;\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    static __init__(): void {\r\n        Sprite3D.WORLDMATRIX = Shader3D.propertyNameToID(\"u_WorldMat\");\r\n        Sprite3D.WORLDINVERTFRONT = Shader3D.propertyNameToID(\"u_WroldInvertFront\");\r\n        Sprite3D.sprite3DCommandUniformMap = LayaGL.renderOBJCreate.createGlobalUniformMap(\"Sprite3D\");\r\n        Sprite3D.sprite3DCommandUniformMap.addShaderUniform(Sprite3D.WORLDMATRIX, \"u_WorldMat\",ShaderDataType.Matrix4x4);\r\n        Sprite3D.sprite3DCommandUniformMap.addShaderUniform(Sprite3D.WORLDINVERTFRONT, \"u_WroldInvertFront\",ShaderDataType.Vector4);\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @param\toriginal  \r\n     * @param   parent    \r\n     * @param   worldPositionStays \r\n     * @param\tposition  ,worldPositionStaysfalse\r\n     * @param\trotation  ,worldPositionStaysfalse\r\n     * @return  \r\n     */\r\n    static instantiate(original: Sprite3D, parent: Node = null, worldPositionStays: boolean = true, position: Vector3 = null, rotation: Quaternion = null): Sprite3D {\r\n        var destSprite3D: Sprite3D = (<Sprite3D>original.clone());\r\n        (parent) && (parent.addChild(destSprite3D));\r\n        var transform: Transform3D = destSprite3D.transform;\r\n        if (worldPositionStays) {\r\n            var worldMatrix: Matrix4x4 = transform.worldMatrix;\r\n            original.transform.worldMatrix.cloneTo(worldMatrix);\r\n            transform.worldMatrix = worldMatrix;\r\n        } else {\r\n            (position) && (transform.position = position);\r\n            (rotation) && (transform.rotation = rotation);\r\n        }\r\n        return destSprite3D;\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @param url \r\n     * @param complete \r\n     */\r\n    static load(url: string, complete: Handler): void {\r\n        ILaya.loader.load(url).then((res: Prefab) => {\r\n            complete && complete.runWith([res?.create()]);\r\n        });\r\n    }\r\n\r\n    /** @internal */\r\n    private _id: number;\r\n\r\n    /** @internal */\r\n    _isStatic: number;\r\n    /** @internal */\r\n    _layer: number;\r\n    /**@internal */\r\n    _transform: Transform3D;\r\n    /**@internal 0*/\r\n    _isRenderNode: number = 0;\r\n\r\n    /**\r\n     * ID\r\n     */\r\n    get id(): number {\r\n        return this._id;\r\n    }\r\n\r\n    /**\r\n     * \r\n     */\r\n    get layer(): number {\r\n        return this._layer;\r\n    }\r\n\r\n    set layer(value: number) {\r\n        if (this._layer !== value) {\r\n            if (value >= 0 && value <= 30) {\r\n                this._layer = value;\r\n                this.event(Event.LAYERCHANGE, value);\r\n            } else {\r\n                throw new Error(\"Layer value must be 0-30.\");\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * \r\n     */\r\n    get isStatic(): boolean {\r\n        return !!(this._isStatic >> 1 | 0x0);\r\n    }\r\n\r\n    /**@internal IDE only*/\r\n    set isStatic(value: boolean) {\r\n        this._isStatic = value ? StaticFlag.StaticBatch : StaticFlag.Normal;\r\n        this.event(Event.staticMask, this._isStatic);\r\n    }\r\n\r\n    /**\r\n     * \r\n     */\r\n    get transform(): Transform3D {\r\n        return this._transform;\r\n    }\r\n\r\n    get scene(): Scene3D {\r\n        return <Scene3D>this._scene;\r\n    }\r\n\r\n    /**\r\n     *  <code>Sprite3D</code> \r\n     * @param name \r\n     * @param isStatic \r\n     */\r\n    constructor(name: string = null, isStatic: boolean = false) {\r\n        super();\r\n        this._id = ++Sprite3D._uniqueIDCounter;\r\n        this._is3D = true;\r\n        this._transform = Laya3DRender.renderOBJCreate.createTransform(this);\r\n        this._isStatic = isStatic ? StaticFlag.StaticBatch : StaticFlag.Normal;\r\n        this.layer = 0;\r\n        this.name = name ? name : \"New Sprite3D\";\r\n    }\r\n\r\n    /**\r\n    * @private\r\n    */\r\n    protected _onActive(): void {\r\n        super._onActive();\r\n        Stat.sprite3DCount++;\r\n    }\r\n\r\n    /**\r\n     * @private\r\n     */\r\n    protected _onInActive(): void {\r\n        super._onInActive();\r\n        Stat.sprite3DCount--;\r\n    }\r\n\r\n\r\n    /**\r\n     * @inheritDoc\r\n     * @override\r\n     */\r\n    protected _onAdded(): void {\r\n        if (this._parent instanceof Sprite3D) {\r\n            var parent3D: Sprite3D = (<Sprite3D>this._parent);\r\n            this.transform._setParent(parent3D.transform);\r\n        }\r\n        else\r\n            this.transform._onWorldTransform();\r\n        super._onAdded();\r\n    }\r\n\r\n    /**\r\n     * @inheritDoc\r\n     * @override\r\n     */\r\n    protected _onRemoved(): void {\r\n        super._onRemoved();\r\n        if (this._parent instanceof Sprite3D)\r\n            this.transform._setParent(null);\r\n    }\r\n\r\n    protected onStartListeningToType(type: string) {\r\n        super.onStartListeningToType(type);\r\n        if (type.startsWith(\"collision\"))\r\n            this._setBit(NodeFlags.PROCESS_COLLISIONS, true);\r\n        else if (type.startsWith(\"trigger\"))\r\n            this._setBit(NodeFlags.PROCESS_TRIGGERS, true);\r\n    }\r\n\r\n    /**\r\n     * @inheritDoc\r\n     * @override\r\n     * @internal\r\n     */\r\n    _parse(data: any, spriteMap: any): void {\r\n        (data.isStatic !== undefined) && (this.isStatic = data.isStatic);\r\n        (data.active !== undefined) && (this.active = data.active);\r\n        (data.name != undefined) && (this.name = data.name);\r\n        (data.tag != undefined) && (this.tag = data.tag);\r\n\r\n        if (data.position !== undefined) {\r\n            var loccalPosition: Vector3 = this.transform.localPosition;\r\n            loccalPosition.fromArray(data.position);\r\n            this.transform.localPosition = loccalPosition;\r\n        }\r\n\r\n        if (data.rotationEuler !== undefined) {\r\n            var localRotationEuler: Vector3 = this.transform.localRotationEuler;\r\n            localRotationEuler.fromArray(data.rotationEuler);\r\n            this.transform.localRotationEuler = localRotationEuler;\r\n        }\r\n        if (data.rotation !== undefined) {\r\n            var localRotation: Quaternion = this.transform.localRotation;\r\n            localRotation.fromArray(data.rotation);\r\n            this.transform.localRotation = localRotation;\r\n        }\r\n\r\n        if (data.scale !== undefined) {\r\n            var localScale: Vector3 = this.transform.localScale;\r\n            localScale.fromArray(data.scale);\r\n            this.transform.localScale = localScale;\r\n        }\r\n\r\n        (data.layer != undefined) && (this.layer = data.layer);\r\n    }\r\n\r\n    /**\r\n     * @override\r\n     * @internal\r\n     * \r\n     * @param\tdestObject \r\n     */\r\n    _cloneTo(destObject: any, srcRoot: Node, dstRoot: Node): void {\r\n        if (this._destroyed)\r\n            throw new Error(\"Sprite3D: Can't be cloned if the Sprite3D has destroyed.\");\r\n\r\n        var destSprite3D: Sprite3D = <Sprite3D>destObject;\r\n        var trans: Transform3D = this._transform;\r\n        var destTrans: Transform3D = destSprite3D._transform;\r\n\r\n        destSprite3D.name = this.name/* + \"(clone)\"*/;//TODO:\r\n        destSprite3D.tag = this.tag;\r\n        destSprite3D._destroyed = this._destroyed;\r\n        destSprite3D.active = this.active;\r\n        destTrans.localPosition = trans.localPosition;\r\n        destTrans.localRotation = trans.localRotation;\r\n        destTrans.localScale = trans.localScale;\r\n\r\n        destSprite3D._isStatic = this._isStatic;\r\n        destSprite3D.layer = this.layer;\r\n        super._cloneTo(destSprite3D, srcRoot, dstRoot);\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    private static _createSprite3DInstance(scrSprite: Sprite3D): Node {\r\n        var node: Node = scrSprite._create();\r\n        var children: any[] = scrSprite._children;\r\n        for (var i: number = 0, n: number = children.length; i < n; i++) {\r\n            var child: any = Sprite3D._createSprite3DInstance(children[i])\r\n            node.addChild(child);\r\n        }\r\n        return node;\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    private static _parseSprite3DInstance(srcRoot: Node, dstRoot: Node, scrSprite: Node, dstSprite: Node): void {\r\n        var srcChildren: any[] = scrSprite._children;\r\n        var dstChildren: any[] = dstSprite._children;\r\n        for (var i: number = 0, n: number = srcChildren.length; i < n; i++)\r\n            Sprite3D._parseSprite3DInstance(srcRoot, dstRoot, srcChildren[i], dstChildren[i])\r\n        scrSprite._cloneTo(dstSprite, srcRoot, dstRoot);\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @return\t \r\n     */\r\n    clone(): Node {\r\n        var dstSprite3D: Node = Sprite3D._createSprite3DInstance(this);\r\n        Sprite3D._parseSprite3DInstance(this, dstSprite3D, this, dstSprite3D);\r\n        return dstSprite3D;\r\n    }\r\n\r\n    /**\r\n     * @inheritDoc\r\n     * @override\r\n     */\r\n    destroy(destroyChild: boolean = true): void {\r\n        if (this._destroyed)\r\n            return;\r\n\r\n        super.destroy(destroyChild);\r\n        this._transform = null;\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    protected _create(): Node {\r\n        return new Sprite3D();\r\n    }\r\n}\r\n\r\n","import { Plane } from \"./Plane\";\r\nimport { CollisionUtils } from \"./CollisionUtils\";\r\nimport { ContainmentType } from \"./ContainmentType\";\r\nimport { BoundBox } from \"./BoundBox\";\r\nimport { BoundSphere } from \"./BoundSphere\";\r\nimport { IClone } from \"../../utils/IClone\";\r\nimport { Bounds } from \"./Bounds\";\r\nimport { Matrix4x4 } from \"../../maths/Matrix4x4\";\r\nimport { Vector3 } from \"../../maths/Vector3\";\r\n\r\n/**\r\n * \r\n */\r\nexport enum FrustumCorner {\r\n\tFarBottomLeft = 0,\r\n\tFarTopLeft = 1,\r\n\tFarTopRight = 2,\r\n\tFarBottomRight = 3,\r\n\tnearBottomLeft = 4,\r\n\tnearTopLeft = 5,\r\n\tnearTopRight = 6,\r\n\tnearBottomRight = 7,\r\n\tunknown = 8\r\n}\r\n\r\n\r\n/**\r\n * <code>BoundFrustum</code> \r\n */\r\nexport class BoundFrustum implements IClone {\r\n\t/** @internal */\r\n\tprivate static _tempV30: Vector3 = new Vector3();\r\n\t/** @internal */\r\n\tprivate static _tempV31: Vector3 = new Vector3();\r\n\t/** @internal */\r\n\tprivate static _tempV32: Vector3 = new Vector3();\r\n\t/** @internal */\r\n\tprivate static _tempV33: Vector3 = new Vector3();\r\n\t/** @internal */\r\n\tprivate static _tempV34: Vector3 = new Vector3();\r\n\t/** @internal */\r\n\tprivate static _tempV35: Vector3 = new Vector3();\r\n\t/** @internal */\r\n\tprivate static _tempV36: Vector3 = new Vector3();\r\n\r\n\t/**\r\n\t * 6\r\n\t * @param  m \r\n\t * @param  np \r\n\t * @param  fp \r\n\t * @param  lp \r\n\t * @param  rp \r\n\t * @param  tp \r\n\t * @param  bp \r\n\t */\r\n\tstatic getPlanesFromMatrix(m: Matrix4x4, np: Plane, fp: Plane, lp: Plane, rp: Plane, tp: Plane, bp: Plane): void {\r\n\t\tvar matrixE: Float32Array = m.elements;\r\n\t\tvar m11: number = matrixE[0];\r\n\t\tvar m12: number = matrixE[1];\r\n\t\tvar m13: number = matrixE[2];\r\n\t\tvar m14: number = matrixE[3];\r\n\t\tvar m21: number = matrixE[4];\r\n\t\tvar m22: number = matrixE[5];\r\n\t\tvar m23: number = matrixE[6];\r\n\t\tvar m24: number = matrixE[7];\r\n\t\tvar m31: number = matrixE[8];\r\n\t\tvar m32: number = matrixE[9];\r\n\t\tvar m33: number = matrixE[10];\r\n\t\tvar m34: number = matrixE[11];\r\n\t\tvar m41: number = matrixE[12];\r\n\t\tvar m42: number = matrixE[13];\r\n\t\tvar m43: number = matrixE[14];\r\n\t\tvar m44: number = matrixE[15];\r\n\r\n\t\t//near\r\n\t\tvar nearNorE: Vector3 = np.normal;\r\n\t\tnearNorE.x = m13;\r\n\t\tnearNorE.y = m23;\r\n\t\tnearNorE.z = m33;\r\n\t\tnp.distance = m43;\r\n\t\tnp.normal = nearNorE;\r\n\t\tnp.normalize();\r\n\r\n\t\t//far\r\n\t\tvar farNorE: Vector3 = fp.normal;\r\n\t\tfarNorE.x = m14 - m13;\r\n\t\tfarNorE.y = m24 - m23;\r\n\t\tfarNorE.z = m34 - m33;\r\n\t\tfp.distance = m44 - m43;\r\n\t\tfp.normal = farNorE;\r\n\t\tfp.normalize();\r\n\r\n\t\t//left\r\n\t\tvar leftNorE: Vector3 = lp.normal;\r\n\t\tleftNorE.x = m14 + m11;\r\n\t\tleftNorE.y = m24 + m21;\r\n\t\tleftNorE.z = m34 + m31;\r\n\t\tlp.distance = m44 + m41;\r\n\t\tlp.normal = leftNorE;\r\n\t\tlp.normalize();\r\n\r\n\t\t//right\r\n\t\tvar rightNorE: Vector3 = rp.normal;\r\n\t\trightNorE.x = m14 - m11;\r\n\t\trightNorE.y = m24 - m21;\r\n\t\trightNorE.z = m34 - m31;\r\n\t\trp.distance = m44 - m41;\r\n\t\trp.normal = rightNorE;\r\n\t\trp.normalize();\r\n\r\n\t\t//top\r\n\t\tvar topNorE: Vector3 = tp.normal;\r\n\t\ttopNorE.x = m14 - m12;\r\n\t\ttopNorE.y = m24 - m22;\r\n\t\ttopNorE.z = m34 - m32;\r\n\t\ttp.distance = m44 - m42;\r\n\t\ttp.normal = topNorE;\r\n\t\ttp.normalize();\r\n\r\n\t\t//bottom\r\n\t\tvar bottomNorE: Vector3 = bp.normal;\r\n\t\tbottomNorE.x = m14 + m12;\r\n\t\tbottomNorE.y = m24 + m22;\r\n\t\tbottomNorE.z = m34 + m32;\r\n\t\tbp.distance = m44 + m42;\r\n\t\tbp.normal = bottomNorE;\r\n\t\tbp.normalize();\r\n\t}\r\n\r\n\t/** @internal */\r\n\tprotected _matrix: Matrix4x4;\r\n\t/** @internal */\r\n\tprotected _near: Plane;\r\n\t/** @internal */\r\n\tprotected _far: Plane;\r\n\t/** @internal */\r\n\tprotected _left: Plane;\r\n\t/** @internal */\r\n\tprotected _right: Plane;\r\n\t/** @internal */\r\n\tprotected _top: Plane;\r\n\t/** @internal */\r\n\tprotected _bottom: Plane;\r\n\r\n\t/**\r\n\t *  <code>BoundFrustum</code> \r\n\t * @param\tmatrix 4x4\r\n\t */\r\n\tconstructor(matrix: Matrix4x4) {\r\n\t\tthis._matrix = matrix;\r\n\t\tthis.initBoundingPlane();\r\n\t}\r\n\r\n\tprotected initBoundingPlane() {\r\n\t\tthis._near = new Plane();\r\n\t\tthis._far = new Plane();\r\n\t\tthis._left = new Plane();\r\n\t\tthis._right = new Plane();\r\n\t\tthis._top = new Plane();\r\n\t\tthis._bottom = new Plane();\r\n\t\tBoundFrustum.getPlanesFromMatrix(this._matrix, this._near, this._far, this._left, this._right, this._top, this._bottom);\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t */\r\n\tget matrix(): Matrix4x4 {\r\n\t\treturn this._matrix;\r\n\t}\r\n\r\n\tset matrix(matrix: Matrix4x4) {\r\n\t\tmatrix.cloneTo(this._matrix)\r\n\t\tBoundFrustum.getPlanesFromMatrix(this._matrix, this._near, this._far, this._left, this._right, this._top, this._bottom);\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t */\r\n\tget near(): Plane {\r\n\t\treturn this._near;\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t */\r\n\tget far(): Plane {\r\n\t\treturn this._far;\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t */\r\n\tget left(): Plane {\r\n\t\treturn this._left;\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t */\r\n\tget right(): Plane {\r\n\t\treturn this._right;\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t */\r\n\tget top(): Plane {\r\n\t\treturn this._top;\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t */\r\n\tget bottom(): Plane {\r\n\t\treturn this._bottom;\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t * @param\tother \r\n\t */\r\n\tequalsBoundFrustum(other: BoundFrustum): boolean {\r\n\t\treturn this._matrix.equalsOtherMatrix(other.matrix)\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t * @param\tobj \r\n\t */\r\n\tequalsObj(obj: any): boolean {\r\n\t\tif (obj instanceof BoundFrustum) {\r\n\t\t\tvar bf: BoundFrustum = (<BoundFrustum>obj);\r\n\t\t\treturn this.equalsBoundFrustum(bf);\r\n\t\t}\r\n\t\treturn false;\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t * 0:\r\n\t * 1:\r\n\t * 2:\r\n\t * 3:\r\n\t * 4:\r\n\t * 5:\r\n\t * @param\tindex \r\n\t */\r\n\tgetPlane(index: number): Plane {\r\n\t\tswitch (index) {\r\n\t\t\tcase 0:\r\n\t\t\t\treturn this._near;\r\n\t\t\tcase 1:\r\n\t\t\t\treturn this._far;\r\n\t\t\tcase 2:\r\n\t\t\t\treturn this._left;\r\n\t\t\tcase 3:\r\n\t\t\t\treturn this._right;\r\n\t\t\tcase 4:\r\n\t\t\t\treturn this._top;\r\n\t\t\tcase 5:\r\n\t\t\t\treturn this._bottom;\r\n\t\t\tdefault:\r\n\t\t\t\treturn null;\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t * @param  p1  1\r\n\t * @param  p2  2\r\n\t * @param  p3  3\r\n\t */\r\n\tstatic get3PlaneInterPoint(p1: Plane, p2: Plane, p3: Plane, out: Vector3): void {\r\n\t\tvar p1Nor: Vector3 = p1.normal;\r\n\t\tvar p2Nor: Vector3 = p2.normal;\r\n\t\tvar p3Nor: Vector3 = p3.normal;\r\n\r\n\t\tVector3.cross(p2Nor, p3Nor, BoundFrustum._tempV30);\r\n\t\tVector3.cross(p3Nor, p1Nor, BoundFrustum._tempV31);\r\n\t\tVector3.cross(p1Nor, p2Nor, BoundFrustum._tempV32);\r\n\r\n\t\tvar a: number = Vector3.dot(p1Nor, BoundFrustum._tempV30);\r\n\t\tvar b: number = Vector3.dot(p2Nor, BoundFrustum._tempV31);\r\n\t\tvar c: number = Vector3.dot(p3Nor, BoundFrustum._tempV32);\r\n\r\n\t\tVector3.scale(BoundFrustum._tempV30, -p1.distance / a, BoundFrustum._tempV33);\r\n\t\tVector3.scale(BoundFrustum._tempV31, -p2.distance / b, BoundFrustum._tempV34);\r\n\t\tVector3.scale(BoundFrustum._tempV32, -p3.distance / c, BoundFrustum._tempV35);\r\n\r\n\t\tVector3.add(BoundFrustum._tempV33, BoundFrustum._tempV34, BoundFrustum._tempV36);\r\n\t\tVector3.add(BoundFrustum._tempV35, BoundFrustum._tempV36, out);\r\n\t}\r\n\r\n\t/**\r\n\t * 8\r\n\t * @param  corners  \r\n\t */\r\n\tgetCorners(corners: Vector3[]): void {\r\n\t\tBoundFrustum.get3PlaneInterPoint(this._near, this._bottom, this._right, corners[FrustumCorner.nearBottomRight]);\r\n\t\tBoundFrustum.get3PlaneInterPoint(this._near, this._top, this._right, corners[FrustumCorner.nearTopRight]);\r\n\t\tBoundFrustum.get3PlaneInterPoint(this._near, this._top, this._left, corners[FrustumCorner.nearTopLeft]);\r\n\t\tBoundFrustum.get3PlaneInterPoint(this._near, this._bottom, this._left, corners[FrustumCorner.nearBottomLeft]);\r\n\t\tBoundFrustum.get3PlaneInterPoint(this._far, this._bottom, this._right, corners[FrustumCorner.FarBottomRight]);\r\n\t\tBoundFrustum.get3PlaneInterPoint(this._far, this._top, this._right, corners[FrustumCorner.FarTopRight]);\r\n\t\tBoundFrustum.get3PlaneInterPoint(this._far, this._top, this._left, corners[FrustumCorner.FarTopLeft]);\r\n\t\tBoundFrustum.get3PlaneInterPoint(this._far, this._bottom, this._left, corners[FrustumCorner.FarBottomLeft]);\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t * @param  point  \r\n\t * @returns :1,:2,:0\r\n\t */\r\n\tcontainsPoint(point: Vector3): number {\r\n\t\tvar result: number = Plane.PlaneIntersectionType_Front;\r\n\t\tvar planeResult: number = Plane.PlaneIntersectionType_Front;\r\n\r\n\t\tfor (var i: number = 0; i < 6; i++) {\r\n\r\n\t\t\tswitch (i) {\r\n\t\t\t\tcase 0:\r\n\t\t\t\t\tplaneResult = CollisionUtils.intersectsPlaneAndPoint(this._near, point);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 1:\r\n\t\t\t\t\tplaneResult = CollisionUtils.intersectsPlaneAndPoint(this._far, point);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 2:\r\n\t\t\t\t\tplaneResult = CollisionUtils.intersectsPlaneAndPoint(this._left, point);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 3:\r\n\t\t\t\t\tplaneResult = CollisionUtils.intersectsPlaneAndPoint(this._right, point);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 4:\r\n\t\t\t\t\tplaneResult = CollisionUtils.intersectsPlaneAndPoint(this._top, point);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 5:\r\n\t\t\t\t\tplaneResult = CollisionUtils.intersectsPlaneAndPoint(this._bottom, point);\r\n\t\t\t\t\tbreak;\r\n\t\t\t}\r\n\r\n\t\t\tswitch (planeResult) {\r\n\t\t\t\tcase Plane.PlaneIntersectionType_Back:\r\n\t\t\t\t\treturn ContainmentType.Disjoint;\r\n\t\t\t\tcase Plane.PlaneIntersectionType_Intersecting:\r\n\t\t\t\t\tresult = Plane.PlaneIntersectionType_Intersecting;\r\n\t\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tswitch (result) {\r\n\t\t\tcase Plane.PlaneIntersectionType_Intersecting:\r\n\t\t\t\treturn ContainmentType.Intersects;\r\n\t\t\tdefault:\r\n\t\t\t\treturn ContainmentType.Contains;\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t * @param box \r\n\t * @returns boolean \r\n\t */\r\n\tintersects(box: BoundBox|Bounds): boolean {\r\n\t\tvar min: Vector3 = box.min;\r\n\t\tvar max: Vector3 = box.max;\r\n\t\tvar minX: number = min.x;\r\n\t\tvar minY: number = min.y;\r\n\t\tvar minZ: number = min.z;\r\n\t\tvar maxX: number = max.x;\r\n\t\tvar maxY: number = max.y;\r\n\t\tvar maxZ: number = max.z;\r\n\r\n\t\tvar nearNormal: Vector3 = this._near.normal;\r\n\t\tif (this._near.distance + (nearNormal.x * (nearNormal.x < 0 ? minX : maxX)) + (nearNormal.y * (nearNormal.y < 0 ? minY : maxY)) + (nearNormal.z * (nearNormal.z < 0 ? minZ : maxZ)) < 0)\r\n\t\t\treturn false;\r\n\r\n\t\tvar leftNormal: Vector3 = this._left.normal;\r\n\t\tif (this._left.distance + (leftNormal.x * (leftNormal.x < 0 ? minX : maxX)) + (leftNormal.y * (leftNormal.y < 0 ? minY : maxY)) + (leftNormal.z * (leftNormal.z < 0 ? minZ : maxZ)) < 0)\r\n\t\t\treturn false\r\n\r\n\t\tvar rightNormal: Vector3 = this._right.normal;\r\n\t\tif (this._right.distance + (rightNormal.x * (rightNormal.x < 0 ? minX : maxX)) + (rightNormal.y * (rightNormal.y < 0 ? minY : maxY)) + (rightNormal.z * (rightNormal.z < 0 ? minZ : maxZ)) < 0)\r\n\t\t\treturn false;\r\n\r\n\t\tvar bottomNormal: Vector3 = this._bottom.normal;\r\n\t\tif (this._bottom.distance + (bottomNormal.x * (bottomNormal.x < 0 ? minX : maxX)) + (bottomNormal.y * (bottomNormal.y < 0 ? minY : maxY)) + (bottomNormal.z * (bottomNormal.z < 0 ? minZ : maxZ)) < 0)\r\n\t\t\treturn false;\r\n\r\n\t\tvar topNormal: Vector3 = this._top.normal;\r\n\t\tif (this._top.distance + (topNormal.x * (topNormal.x < 0 ? minX : maxX)) + (topNormal.y * (topNormal.y < 0 ? minY : maxY)) + (topNormal.z * (topNormal.z < 0 ? minZ : maxZ)) < 0)\r\n\t\t\treturn false;\r\n\r\n\t\t// Can ignore far plane when distant object culling is handled by another mechanism\r\n\t\tvar farNormal: Vector3 = this._far.normal;\r\n\t\tif (this._far.distance + (farNormal.x * (farNormal.x < 0 ? minX : maxX)) + (farNormal.y * (farNormal.y < 0 ? minY : maxY)) + (farNormal.z * (farNormal.z < 0 ? minZ : maxZ)) < 0)\r\n\t\t\treturn false;\r\n\r\n\t\treturn true;\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t * @param  box  \r\n\t * @returns :1,:2,:0\r\n\t */\r\n\tcontainsBoundBox(box: BoundBox|Bounds): number {\r\n\t\tvar p: Vector3 = BoundFrustum._tempV30, n: Vector3 = BoundFrustum._tempV31;\r\n\t\tvar boxMin: Vector3 = box.min;\r\n\t\tvar boxMax: Vector3 = box.max;\r\n\t\tvar result: number = ContainmentType.Contains;\r\n\t\tfor (var i: number = 0; i < 6; i++) {\r\n\t\t\tvar plane: Plane = this.getPlane(i);\r\n\t\t\tvar planeNor: Vector3 = plane.normal;\r\n\r\n\t\t\tif (planeNor.x >= 0) {\r\n\t\t\t\tp.x = boxMax.x;\r\n\t\t\t\tn.x = boxMin.x;\r\n\t\t\t} else {\r\n\t\t\t\tp.x = boxMin.x;\r\n\t\t\t\tn.x = boxMax.x;\r\n\t\t\t}\r\n\t\t\tif (planeNor.y >= 0) {\r\n\t\t\t\tp.y = boxMax.y;\r\n\t\t\t\tn.y = boxMin.y;\r\n\t\t\t} else {\r\n\t\t\t\tp.y = boxMin.y;\r\n\t\t\t\tn.y = boxMax.y;\r\n\t\t\t}\r\n\t\t\tif (planeNor.z >= 0) {\r\n\t\t\t\tp.z = boxMax.z;\r\n\t\t\t\tn.z = boxMin.z;\r\n\t\t\t} else {\r\n\t\t\t\tp.z = boxMin.z;\r\n\t\t\t\tn.z = boxMax.z;\r\n\t\t\t}\r\n\r\n\t\t\tif (CollisionUtils.intersectsPlaneAndPoint(plane, p) === Plane.PlaneIntersectionType_Back)\r\n\t\t\t\treturn ContainmentType.Disjoint;\r\n\r\n\t\t\tif (CollisionUtils.intersectsPlaneAndPoint(plane, n) === Plane.PlaneIntersectionType_Back)\r\n\t\t\t\tresult = ContainmentType.Intersects;\r\n\t\t}\r\n\t\treturn result;\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t * @param  sphere  \r\n\t * @returns :1,:2,:0\r\n\t */\r\n\tcontainsBoundSphere(sphere: BoundSphere): number {\r\n\t\tvar result: number = Plane.PlaneIntersectionType_Front;\r\n\t\tvar planeResult: number = Plane.PlaneIntersectionType_Front;\r\n\t\tfor (var i: number = 0; i < 6; i++) {\r\n\t\t\tswitch (i) {\r\n\t\t\t\tcase 0:\r\n\t\t\t\t\tplaneResult = CollisionUtils.intersectsPlaneAndSphere(this._near, sphere);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 1:\r\n\t\t\t\t\tplaneResult = CollisionUtils.intersectsPlaneAndSphere(this._far, sphere);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 2:\r\n\t\t\t\t\tplaneResult = CollisionUtils.intersectsPlaneAndSphere(this._left, sphere);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 3:\r\n\t\t\t\t\tplaneResult = CollisionUtils.intersectsPlaneAndSphere(this._right, sphere);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 4:\r\n\t\t\t\t\tplaneResult = CollisionUtils.intersectsPlaneAndSphere(this._top, sphere);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 5:\r\n\t\t\t\t\tplaneResult = CollisionUtils.intersectsPlaneAndSphere(this._bottom, sphere);\r\n\t\t\t\t\tbreak;\r\n\t\t\t}\r\n\r\n\t\t\tswitch (planeResult) {\r\n\r\n\t\t\t\tcase Plane.PlaneIntersectionType_Back:\r\n\t\t\t\t\treturn ContainmentType.Disjoint;\r\n\t\t\t\tcase Plane.PlaneIntersectionType_Intersecting:\r\n\t\t\t\t\tresult = Plane.PlaneIntersectionType_Intersecting;\r\n\t\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tswitch (result) {\r\n\r\n\t\t\tcase Plane.PlaneIntersectionType_Intersecting:\r\n\t\t\t\treturn ContainmentType.Intersects;\r\n\t\t\tdefault:\r\n\t\t\t\treturn ContainmentType.Contains;\r\n\t\t}\r\n\t}\r\n\r\n\tcloneTo(dest: BoundFrustum) {\r\n\t\tdest.matrix = this.matrix;\r\n\t}\r\n\r\n\tclone(): BoundFrustum {\r\n\t\tlet dest = new BoundFrustum(new Matrix4x4);\r\n\t\tthis.cloneTo(dest);\r\n\t\treturn dest;\r\n\t}\r\n}\r\n\r\n\r\n","import { Component } from \"../../../components/Component\";\r\nimport { BaseRender } from \"../../core/render/BaseRender\";\r\nimport { Sprite3D } from \"../../core/Sprite3D\";\r\nimport { Bounds } from \"../../math/Bounds\";\r\nimport { VolumeManager } from \"./VolumeManager\";\r\nimport { Event } from \"../../../events/Event\";\r\nimport { Scene3D } from \"../../core/scene/Scene3D\";\r\nimport { Vector3 } from \"../../../maths/Vector3\";\r\n\r\nexport enum volumeIntersectType {\r\n    /** */\r\n    contain,\r\n    /** */\r\n    intersect,\r\n    /***/\r\n    Disjoint\r\n}\r\n\r\n/**\r\n * Volume\r\n */\r\nexport class volumeIntersectInfo {\r\n    type: volumeIntersectType;\r\n    /** */\r\n    intersectRate: number;\r\n}\r\n\r\nexport class Volume extends Component {\r\n    /**@internal */\r\n    protected _primitiveBounds: Bounds;\r\n    /**  */\r\n    protected _bounds: Bounds;\r\n    /**cache number of around Volume */\r\n    protected _aroundVolumeCacheNum: number = 0;\r\n    /** around Volume */\r\n    protected _aroundVolume: Volume[];\r\n    /** volume manager */\r\n    protected _volumeManager: VolumeManager;\r\n    /** volume intersect Comonent */\r\n    protected _type: number;\r\n    /**  */\r\n    protected _importance: number;\r\n\r\n    /**\r\n     * <code>Volume</code>\r\n     */\r\n    constructor() {\r\n        super();\r\n        this._bounds = new Bounds();\r\n        this._primitiveBounds = new Bounds();\r\n        this._importance = 0;\r\n        this.runInEditor = true;\r\n    }\r\n\r\n    /**\r\n     * volume Type\r\n     */\r\n    get type() {\r\n        return this._type;\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    get bounds(): Bounds {\r\n        return this._bounds;\r\n    }\r\n\r\n    get boundsMax(): Vector3 {\r\n        return this._primitiveBounds.getMax();\r\n    }\r\n\r\n    /**\r\n     * primitivemax\r\n     */\r\n    set boundsMax(value: Vector3) {\r\n        this._primitiveBounds.setMax(value);\r\n        this._reCaculateBoundBox();\r\n    }\r\n\r\n    /**\r\n     * primitiveBoxMax\r\n     */\r\n    set boundsMin(value: Vector3) {\r\n        this._primitiveBounds.setMin(value);\r\n        this._reCaculateBoundBox();\r\n    }\r\n\r\n    get boundsMin(): Vector3 {\r\n        return this._primitiveBounds.getMin();\r\n    }\r\n\r\n    get probePosition(): Vector3 {\r\n        return (this.owner as Sprite3D).transform.position;\r\n    }\r\n\r\n    get importance() {\r\n        return this._importance;\r\n    }\r\n\r\n    set importance(value: number) {\r\n        this._importance = value;\r\n    }\r\n\r\n    /**\r\n     * @inheritDoc\r\n     * @override\r\n     */\r\n    protected _onEnable(): void {\r\n        (this.owner as Sprite3D).transform.on(Event.TRANSFORM_CHANGED, this, this._VolumeChange);\r\n        this._volumeManager = ((this.owner as Sprite3D).scene as Scene3D)._volumeManager;\r\n        this._volumeManager.add(this);\r\n        this._reCaculateBoundBox();\r\n    }\r\n\r\n    /**\r\n     * @inheritDoc\r\n     * @override\r\n     */\r\n    protected _onDisable(): void {\r\n        (this.owner as Sprite3D).transform.off(Event.TRANSFORM_CHANGED, this, this._VolumeChange);\r\n        this._volumeManager.remove(this);\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @param renderNode \r\n     */\r\n    _addRenderNode?(renderNode: BaseRender): void;\r\n\r\n    /**\r\n     * \r\n     * @param renderNode    \r\n     */\r\n    _removeRenderNode?(renderNode: BaseRender): void;\r\n\r\n    /**\r\n     * \r\n     * @param renderNode \r\n     */\r\n    _motionInVolume?(renderNode: BaseRender): void;\r\n\r\n\r\n    /**\r\n     * Volume change\r\n     */\r\n    _VolumeChange() {\r\n        this._volumeManager._needUpdateAllRender = true;\r\n        let reManager = this._volumeManager._regVolumeManager[this.type];\r\n        if (reManager) {\r\n            reManager._needUpdateAllRender = true;\r\n        }\r\n        this._reCaculateBoundBox();\r\n    }\r\n\r\n    _reCaculateBoundBox() {\r\n        this.owner && this._primitiveBounds._tranform((this.owner as Sprite3D).transform.worldMatrix, this._bounds);\r\n    }\r\n\r\n    /**\r\n     * @inheritDoc\r\n     * @override\r\n     * @internal\r\n     */\r\n    _cloneTo(dest: Volume): void {\r\n    }\r\n\r\n}","/**\r\n * \r\n */\r\nexport enum AmbientMode {\r\n    /** */\r\n    SolidColor,\r\n    /** ,  */\r\n    SphericalHarmonics,\r\n    /** , ,  */\r\n    TripleColor\r\n}\r\n","import { TextureDecodeFormat } from \"../../../../RenderEngine/RenderEnum/TextureDecodeFormat\";\r\nimport { Sprite3D } from \"../../../core/Sprite3D\";\r\nimport { Bounds } from \"../../../math/Bounds\";\r\nimport { TextureCube } from \"../../../../resource/TextureCube\";\r\nimport { Volume } from \"../Volume\";\r\nimport { VolumeManager } from \"../VolumeManager\";\r\nimport { SphericalHarmonicsL2, SphericalHarmonicsL2Generater } from \"../../../graphics/SphericalHarmonicsL2\";\r\nimport { ShaderData, ShaderDataType } from \"../../../../RenderEngine/RenderShader/ShaderData\";\r\nimport { RenderableSprite3D } from \"../../../core/RenderableSprite3D\";\r\nimport { Sprite3DRenderDeclaration } from \"../../../core/render/Sprite3DRenderDeclaration\";\r\nimport { ILaya3D } from \"../../../../../ILaya3D\";\r\nimport { AmbientMode } from \"../../../core/scene/AmbientMode\";\r\nimport { Color } from \"../../../../maths/Color\";\r\nimport { Vector3 } from \"../../../../maths/Vector3\";\r\nimport { Vector4 } from \"../../../../maths/Vector4\";\r\n\r\n\r\n/**\r\n * \r\n */\r\nexport enum ReflectionProbeMode {\r\n\t/** */\r\n\toff = 0,//Back\r\n\t/** */\r\n\tsimple = 1,\r\n}\r\n/**\r\n * <code>ReflectionProbe</code> \r\n * @miner\r\n */\r\nexport class ReflectionProbe extends Volume {\r\n\tstatic reflectionCount: number = 0;\r\n\t/**ID*/\r\n\tstatic getID(): number {\r\n\t\treturn ReflectionProbe.reflectionCount++;\r\n\t}\r\n\r\n\t// \r\n\tstatic TEMPVECTOR3: Vector3 = new Vector3();\r\n\t/**  */\r\n\tstatic defaultTextureHDRDecodeValues: Vector4 = new Vector4(1.0, 1.0, 0.0, 0.0);\r\n\t/**  */\r\n\tprivate _boxProjection: boolean = false;\r\n\t/**  */\r\n\tprotected _bounds: Bounds;\r\n\t/**  */\r\n\tprotected _importance: number;\r\n\t/** */\r\n\tprivate _ambientColor: Color = new Color();\r\n\t/**SH */\r\n\tprivate _ambientSH: Float32Array;\r\n\t/** */\r\n\tprivate _ambientIntensity: number;\r\n\t/**ibl */\r\n\tprivate _iblTex: TextureCube;\r\n\t/**ibl */\r\n\tprivate _iblTexRGBD: boolean;\r\n\t/** */\r\n\tprivate _reflectionIntensity: number;\r\n\t/** @internal */\r\n\tprivate _ambientMode: AmbientMode = AmbientMode.SolidColor;\r\n\r\n\t/**  */\r\n\t_isScene: boolean = false;\r\n\t/**shaderupdateMask */\r\n\t_updateMark: number;\r\n\r\n\t/**@internal */\r\n\t_reflectionProbeID: number;\r\n\r\n\tconstructor() {\r\n\t\tsuper();\r\n\t\tthis._importance = 0;\r\n\t\tthis._type = VolumeManager.ReflectionProbeVolumeType;\r\n\t\tthis._ambientIntensity = 1.0;\r\n\t\tthis._reflectionIntensity = 1.0;\r\n\t\tthis.boundsMax = new Vector3(5, 5, 5);\r\n\t\tthis.boundsMin = new Vector3(-5, -5, -5);\r\n\t\tthis._reflectionProbeID = ReflectionProbe.getID();\r\n\t}\r\n\r\n\r\n\t/**\r\n\t * \r\n\t */\r\n\tget boxProjection(): boolean {\r\n\t\treturn this._boxProjection;\r\n\t}\r\n\r\n\tset boxProjection(value: boolean) {\r\n\t\tif (value != this._boxProjection) {\r\n\t\t\tthis._updateMark = ILaya3D.Scene3D._updateMark;\r\n\t\t}\r\n\t\tthis._boxProjection = value;\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t */\r\n\tget importance(): number {\r\n\t\treturn this._importance;\r\n\t}\r\n\r\n\tset importance(value: number) {\r\n\t\tthis._importance = value\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t */\r\n\tget ambientIntensity(): number {\r\n\t\treturn this._ambientIntensity;\r\n\t}\r\n\r\n\tset ambientIntensity(value: number) {\r\n\t\tif (value == this._ambientIntensity) return;\r\n\t\tthis._ambientIntensity = value;\r\n\t\tthis._updateMark = ILaya3D.Scene3D._updateMark;\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t */\r\n\tget reflectionIntensity(): number {\r\n\t\treturn this._reflectionIntensity;\r\n\t}\r\n\r\n\tset reflectionIntensity(value: number) {\r\n\t\tif (value == this._reflectionIntensity) return;\r\n\t\tvalue = Math.max(value, 0.0);\r\n\t\tthis._reflectionIntensity = value\r\n\t\tthis._updateMark = ILaya3D.Scene3D._updateMark;\r\n\t}\r\n\r\n\r\n\t/**\r\n\t * \r\n\t */\r\n\tget bounds(): Bounds {\r\n\t\treturn this._bounds as Bounds;\r\n\t}\r\n\r\n\t/**\r\n\t *  max\r\n\t */\r\n\tset boundsMax(value: Vector3) {\r\n\t\tsuper.boundsMax = value;\r\n\t\tif (this.boxProjection)\r\n\t\t\tthis._updateMark = ILaya3D.Scene3D._updateMark;\r\n\t}\r\n\r\n\tget boundsMax(): Vector3 {\r\n\t\treturn this._primitiveBounds.getMax();\r\n\t}\r\n\r\n\t/**\r\n\t *  min\r\n\t */\r\n\tset boundsMin(value: Vector3) {\r\n\t\tsuper.boundsMin = value;\r\n\t\tif (this.boxProjection)\r\n\t\t\tthis._updateMark = ILaya3D.Scene3D._updateMark;\r\n\t}\r\n\r\n\tget boundsMin(): Vector3 {\r\n\t\treturn this._primitiveBounds.getMin();\r\n\t}\r\n\r\n\t/**\r\n\t * probe \r\n\t */\r\n\tget probePosition(): Vector3 {\r\n\t\treturn (this.owner as Sprite3D).transform.position;\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t */\r\n\tpublic get ambientColor(): Color {\r\n\t\treturn this._ambientColor;\r\n\t}\r\n\tpublic set ambientColor(value: Color) {\r\n\t\tvalue && value.cloneTo(this._ambientColor);\r\n\t\tif (this.ambientMode == AmbientMode.SolidColor)\r\n\t\t\tthis._updateMark = ILaya3D.Scene3D._updateMark;\r\n\t}\r\n\r\n\t/**\r\n\t *  sh\r\n\t */\r\n\tpublic get ambientSH(): Float32Array {\r\n\t\treturn this._ambientSH;\r\n\t}\r\n\r\n\tpublic set ambientSH(value: Float32Array) {\r\n\t\tif (this.ambientMode == AmbientMode.SphericalHarmonics)\r\n\t\t\tthis._updateMark = ILaya3D.Scene3D._updateMark;\r\n\t\tthis._ambientSH = value;\r\n\t}\r\n\r\n\t/**\r\n\t* \r\n\t* AmbientMode.SolidColorambientColorAmbientMode.SphericalHarmonicsambientSphericalHarmonics\r\n\t*/\r\n\tget ambientMode(): AmbientMode {\r\n\t\treturn this._ambientMode;\r\n\t}\r\n\r\n\tset ambientMode(value: AmbientMode) {\r\n\t\tif (value == this.ambientMode) return;\r\n\t\tthis._ambientMode = value;\r\n\t\tif (!this.ambientSH) {\r\n\t\t\tif (value == AmbientMode.SphericalHarmonics) {\r\n\t\t\t\tthis._ambientSphericalHarmonics && this._applySHCoefficients(this._ambientSphericalHarmonics, Math.pow(this._ambientIntensity, 2.2));\r\n\t\t\t} else if (value == AmbientMode.TripleColor) {\r\n\t\t\t\tthis._ambientTripleColorSphericalHarmonics && this._applySHCoefficients(this._ambientTripleColorSphericalHarmonics, 1.0);\r\n\t\t\t}\r\n\t\t}\r\n\t\tthis._updateMark = ILaya3D.Scene3D._updateMark;\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * Image base Light\r\n\t */\r\n\tpublic get iblTex(): TextureCube {\r\n\t\treturn this._iblTex;\r\n\t}\r\n\r\n\tpublic set iblTex(value: TextureCube) {\r\n\t\tif (this.iblTex == value) return;\r\n\t\tif (this.iblTex) this.iblTex._removeReference();\r\n\t\tthis._iblTex = value;\r\n\t\tif (value)\r\n\t\t\tvalue._addReference();\r\n\t\tthis._updateMark = ILaya3D.Scene3D._updateMark;\r\n\t}\r\n\r\n\t/**\r\n\t * Image base Light Compress by RGBD\r\n\t */\r\n\tpublic get iblTexRGBD(): boolean {\r\n\t\treturn this._iblTexRGBD;\r\n\t}\r\n\r\n\tpublic set iblTexRGBD(value: boolean) {\r\n\t\tif (value == this._iblTexRGBD)\r\n\t\t\treturn;\r\n\t\tthis._iblTexRGBD = value;\r\n\t\tthis._updateMark = ILaya3D.Scene3D._updateMark;\r\n\t}\r\n\r\n\tapplyReflectionShaderData(shaderData: ShaderData) {\r\n\t\t//boxProjection\r\n\t\tif (!this.boxProjection) {\r\n\t\t\tshaderData.removeDefine(Sprite3DRenderDeclaration.SHADERDEFINE_SPECCUBE_BOX_PROJECTION);\r\n\t\t} else {\r\n\t\t\tshaderData.addDefine(Sprite3DRenderDeclaration.SHADERDEFINE_SPECCUBE_BOX_PROJECTION);\r\n\t\t\tshaderData.setShaderData(RenderableSprite3D.REFLECTIONCUBE_PROBEPOSITION, ShaderDataType.Vector3, this.probePosition);\r\n\t\t\tshaderData.setShaderData(RenderableSprite3D.REFLECTIONCUBE_PROBEBOXMAX, ShaderDataType.Vector3, this._bounds.getMax());\r\n\t\t\tshaderData.setShaderData(RenderableSprite3D.REFLECTIONCUBE_PROBEBOXMIN, ShaderDataType.Vector3, this._bounds.getMin());\r\n\r\n\t\t}\r\n\t\tif (this.ambientMode == AmbientMode.SolidColor) {\r\n\t\t\tshaderData.removeDefine(Sprite3DRenderDeclaration.SHADERDEFINE_GI_LEGACYIBL);\r\n\t\t\tshaderData.removeDefine(Sprite3DRenderDeclaration.SHADERDEFINE_GI_IBL);\r\n\t\t\tshaderData.setColor(RenderableSprite3D.AMBIENTCOLOR, this.ambientColor);\r\n\t\t} else if (this.iblTex && this.ambientSH) {\r\n\t\t\tshaderData.addDefine(Sprite3DRenderDeclaration.SHADERDEFINE_GI_IBL);\r\n\t\t\tshaderData.removeDefine(Sprite3DRenderDeclaration.SHADERDEFINE_GI_LEGACYIBL);\r\n\t\t\tif (this.iblTex) {\r\n\t\t\t\tshaderData.setTexture(RenderableSprite3D.IBLTEX, this.iblTex);\r\n\t\t\t\tshaderData.setNumber(RenderableSprite3D.IBLROUGHNESSLEVEL, this.iblTex.maxMipmapLevel);\r\n\t\t\t};\r\n\t\t\tthis.iblTexRGBD ? shaderData.addDefine(Sprite3DRenderDeclaration.SHADERDEFINE_IBL_RGBD) : shaderData.removeDefine(Sprite3DRenderDeclaration.SHADERDEFINE_IBL_RGBD);\r\n\t\t\tthis.ambientSH && shaderData.setBuffer(RenderableSprite3D.AMBIENTSH, this.ambientSH);\r\n\t\t} else {//Legency\r\n\t\t\tshaderData.removeDefine(Sprite3DRenderDeclaration.SHADERDEFINE_GI_IBL);\r\n\t\t\tshaderData.addDefine(Sprite3DRenderDeclaration.SHADERDEFINE_GI_LEGACYIBL);\r\n\t\t\tif (this._reflectionTexture) {\r\n\t\t\t\tshaderData.setShaderData(RenderableSprite3D.REFLECTIONTEXTURE, ShaderDataType.TextureCube, this.reflectionTexture ? this.reflectionTexture : TextureCube.blackTexture);\r\n\t\t\t\tshaderData.setShaderData(RenderableSprite3D.REFLECTIONCUBE_HDR_PARAMS, ShaderDataType.Vector4, this.reflectionHDRParams);\r\n\t\t\t}\r\n\r\n\t\t\tif (this._shCoefficients) {\r\n\t\t\t\tshaderData.setVector(RenderableSprite3D.AMBIENTSHAR, this._shCoefficients[0]);\r\n\t\t\t\tshaderData.setVector(RenderableSprite3D.AMBIENTSHAG, this._shCoefficients[1]);\r\n\t\t\t\tshaderData.setVector(RenderableSprite3D.AMBIENTSHAB, this._shCoefficients[2]);\r\n\t\t\t\tshaderData.setVector(RenderableSprite3D.AMBIENTSHBR, this._shCoefficients[3]);\r\n\t\t\t\tshaderData.setVector(RenderableSprite3D.AMBIENTSHBG, this._shCoefficients[4]);\r\n\t\t\t\tshaderData.setVector(RenderableSprite3D.AMBIENTSHBB, this._shCoefficients[5]);\r\n\t\t\t\tshaderData.setVector(RenderableSprite3D.AMBIENTSHC, this._shCoefficients[6]);\r\n\t\t\t}\r\n\r\n\t\t}\r\n\t\tshaderData.setNumber(RenderableSprite3D.AMBIENTINTENSITY, this.ambientIntensity);\r\n\t\tshaderData.setNumber(RenderableSprite3D.REFLECTIONINTENSITY, this.reflectionIntensity);\r\n\t}\r\n\r\n\t/**\r\n\t* @inheritDoc\r\n\t* @override\r\n\t*/\r\n\tprotected _onEnable(): void {\r\n\t\tsuper._onEnable();\r\n\t\tthis._updateMark = ILaya3D.Scene3D._updateMark;\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t * @override\r\n\t */\r\n\tprotected _onDisable(): void {\r\n\t\tsuper._onDisable();\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t * @override\r\n\t */\r\n\tprotected _onDestroy() {\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t * @override\r\n\t * @internal\r\n\t */\r\n\t_cloneTo(dest: ReflectionProbe): void {\r\n\t\t//TODO\r\n\t}\r\n\r\n\r\n\r\n\t//----------------------------------------deprecated--------------------------------------------\r\n\t/**\r\n\t * @deprecated\r\n\t *   */\r\n\tprivate _reflectionTexture: TextureCube;\r\n\t/**\r\n\t * @deprecated\r\n\t *   \r\n\t */\r\n\tprivate _reflectionHDRParams: Vector4 = new Vector4();\r\n\t/**\r\n\t * @deprecated  \r\n\t */\r\n\tprivate _reflectionDecodeFormat: TextureDecodeFormat = TextureDecodeFormat.Normal;\r\n\t/**\r\n\t * @deprecated\r\n\t *  @internal \r\n\t */\r\n\tprivate _ambientSphericalHarmonics: SphericalHarmonicsL2;\r\n\t/**\r\n\t * \r\n\t * @deprecated\r\n\t *  @internal \r\n\t */\r\n\tprivate _ambientTripleColorSphericalHarmonics: SphericalHarmonicsL2;\r\n\t/**\r\n\t * @deprecated\r\n\t *  @internal \r\n\t */\r\n\tprivate _shCoefficients: Vector4[];\r\n\t/**\r\n\t * @deprecated\r\n\t *  @internal \r\n\t */\r\n\tprivate _ambientSkyColor: Vector3 = new Vector3();\r\n\t/**\r\n\t * @deprecated\r\n\t *  @internal \r\n\t */\r\n\tprivate _ambientEquatorColor: Vector3 = new Vector3();\r\n\t/**\r\n\t * @deprecated\r\n\t *  @internal \r\n\t */\r\n\tprivate _ambientGroundColor: Vector3 = new Vector3();\r\n\r\n\t/**\r\n\t * @deprecated\r\n\t * \r\n\t */\r\n\tget reflectionTexture() {\r\n\t\treturn this._reflectionTexture;\r\n\t}\r\n\r\n\tset reflectionTexture(value: TextureCube) {\r\n\t\tif (this._reflectionTexture == value) return;\r\n\t\tif (this._reflectionTexture) this.iblTex._removeReference();\r\n\t\tthis._reflectionTexture = value\r\n\t\tif (value) {\r\n\t\t\tthis._reflectionTexture._addReference();\r\n\t\t\tthis._updateMark = ILaya3D.Scene3D._updateMark;\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t* @deprecated\r\n\t*/\r\n\tget customReflection(): TextureCube {\r\n\t\treturn this.reflectionTexture;\r\n\t}\r\n\r\n\tset customReflection(value: TextureCube) {\r\n\t\tthis.reflectionTexture = value;\r\n\t}\r\n\r\n\t/**\r\n\t * @deprecated\r\n\t * \r\n\t */\r\n\tget reflectionHDRParams(): Vector4 {\r\n\t\treturn this._reflectionHDRParams;\r\n\t}\r\n\r\n\t/**\r\n\t * @deprecated\r\n\t * @internal\r\n\t */\r\n\tset reflectionHDRParams(value: Vector4) {\r\n\t\tthis._reflectionHDRParams = value;\r\n\t\tthis._updateMark = ILaya3D.Scene3D._updateMark;\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t * @deprecated\r\n\t */\r\n\tget reflectionDecodingFormat(): TextureDecodeFormat {\r\n\t\treturn this._reflectionDecodeFormat;\r\n\t}\r\n\r\n\tset reflectionDecodingFormat(value: TextureDecodeFormat) {\r\n\t\tif (this._reflectionDecodeFormat != value) {\r\n\t\t\tthis._reflectionDecodeFormat = value;\r\n\t\t\tif (this._reflectionDecodeFormat == TextureDecodeFormat.RGBM)\r\n\t\t\t\tthis._reflectionHDRParams.x = 5.0;//5.0 is RGBM param\r\n\t\t\tthis._updateMark = ILaya3D.Scene3D._updateMark;\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t* @deprecated\r\n\t* ,\r\n\t* use scene.ambientSH\r\n\t*/\r\n\tget ambientSphericalHarmonics(): SphericalHarmonicsL2 {\r\n\t\treturn this._ambientSphericalHarmonics;\r\n\t}\r\n\r\n\t/**\r\n\t * @deprecated\r\n\t * use scene.ambientSH\r\n\t */\r\n\tset ambientSphericalHarmonics(value: SphericalHarmonicsL2) {\r\n\t\tvar originalSH: SphericalHarmonicsL2 = value || SphericalHarmonicsL2._default;\r\n\r\n\t\tif (!this._ambientSphericalHarmonics) {\r\n\t\t\tthis._ambientSphericalHarmonics = new SphericalHarmonicsL2();\r\n\t\t}\r\n\t\tif (this._ambientSphericalHarmonics != value) {\r\n\t\t\tvalue.cloneTo(this._ambientSphericalHarmonics);\r\n\t\t\tthis._applySHCoefficients(this._ambientSphericalHarmonics, Math.pow(this.ambientIntensity, 2.2))\r\n\t\t}\r\n\t\tif (this.ambientMode == AmbientMode.TripleColor)\r\n\t\t\tthis._applySHCoefficients(originalSH, Math.pow(this.ambientIntensity, 2.2));//Gamma to Linear,I prefer use 'Color.gammaToLinearSpace',but must same with Unity now.\r\n\t\tthis._updateMark = ILaya3D.Scene3D._updateMark;\r\n\t}\r\n\r\n\r\n\t/**\r\n\t * @deprecated\r\n\t * @internal\r\n\t */\r\n\tprivate _applySHCoefficients(originalSH: SphericalHarmonicsL2, intensity: number): void {\r\n\t\tif (!this._shCoefficients) {\r\n\t\t\tthis._shCoefficients = new Array(7);\r\n\t\t\tfor (var i: number = 0; i < 7; i++)\r\n\t\t\t\tthis._shCoefficients[i] = new Vector4();\r\n\t\t}\r\n\t\tvar optSH: Vector4[] = this._shCoefficients;\r\n\t\tfor (var i = 0; i < 3; i++) {\r\n\t\t\tvar shaderSHA: Vector4 = optSH[i];\r\n\t\t\tvar shaderSHB: Vector4 = optSH[i + 3];\r\n\t\t\tshaderSHA.setValue(originalSH.getCoefficient(i, 3) * intensity, originalSH.getCoefficient(i, 1) * intensity, originalSH.getCoefficient(i, 2) * intensity, (originalSH.getCoefficient(i, 0) - originalSH.getCoefficient(i, 6)) * intensity);\r\n\t\t\tshaderSHB.setValue(originalSH.getCoefficient(i, 4) * intensity, originalSH.getCoefficient(i, 5) * intensity, originalSH.getCoefficient(i, 6) * 3 * intensity, originalSH.getCoefficient(i, 7) * intensity);// Quadratic polynomials \r\n\t\t}\r\n\t\toptSH[6].setValue(originalSH.getCoefficient(0, 8) * intensity, originalSH.getCoefficient(1, 8) * intensity, originalSH.getCoefficient(2, 8) * intensity, 1);// Final quadratic polynomial\r\n\t}\r\n\r\n\t/**\r\n   * @deprecated\r\n   *     \r\n   */\r\n\tpublic setGradientAmbient(skyColor: Vector3, equatorColor: Vector3, groundColor: Vector3) {\r\n\t\tthis._ambientSkyColor = skyColor;\r\n\t\tthis._ambientEquatorColor = equatorColor;\r\n\t\tthis._ambientGroundColor = groundColor;\r\n\r\n\t\tlet gradientSH = SphericalHarmonicsL2Generater.CalGradientSH(this._ambientSkyColor, this._ambientEquatorColor, this._ambientGroundColor, true);\r\n\t\tthis._ambientTripleColorSphericalHarmonics = gradientSH;\r\n\r\n\t\tif (this.ambientMode == AmbientMode.TripleColor) {\r\n\t\t\tthis._applySHCoefficients(gradientSH, 2.2);\r\n\t\t}\r\n\t\tthis._updateMark = ILaya3D.Scene3D._updateMark;\r\n\t}\r\n}\r\n\r\n\r\n","import { RenderElement } from \"./RenderElement\";\r\nimport { RenderContext3D } from \"./RenderContext3D\";\r\nimport { RenderableSprite3D } from \"../RenderableSprite3D\"\r\nimport { Transform3D } from \"../Transform3D\"\r\nimport { Material } from \"../../../resource/Material\";\r\nimport { BoundFrustum } from \"../../math/BoundFrustum\"\r\nimport { Event } from \"../../../events/Event\"\r\nimport { Lightmap } from \"../scene/Lightmap\";\r\nimport { MeshSprite3DShaderDeclaration } from \"../../../d3/core/MeshSprite3DShaderDeclaration\";\r\nimport { TextureCube } from \"../../../resource/TextureCube\";\r\nimport { Component } from \"../../../components/Component\";\r\nimport { Sprite3D } from \"../Sprite3D\";\r\nimport { ShaderData, ShaderDataType } from \"../../../RenderEngine/RenderShader/ShaderData\";\r\nimport { TransLargeUBOUtils } from \"../TransLargeUBOUtils\";\r\nimport { IBaseRenderNode } from \"../../../RenderEngine/RenderInterface/RenderPipelineInterface/IBaseRenderNode\";\r\nimport { SubUniformBufferData } from \"../../../RenderEngine/SubUniformBufferData\";\r\nimport { Stat } from \"../../../utils/Stat\";\r\nimport { Bounds } from \"../../math/Bounds\";\r\nimport { Volume } from \"../../component/Volume/Volume\";\r\nimport { ReflectionProbe, ReflectionProbeMode } from \"../../component/Volume/reflectionProbe/ReflectionProbe\";\r\nimport { Mesh } from \"../../resource/models/Mesh\";\r\nimport { ShaderDefine } from \"../../../RenderEngine/RenderShader/ShaderDefine\";\r\nimport { NodeFlags } from \"../../../Const\";\r\nimport { Sprite3DRenderDeclaration } from \"./Sprite3DRenderDeclaration\";\r\nimport { Shader3D } from \"../../../RenderEngine/RenderShader/Shader3D\";\r\nimport { BatchRender } from \"../../component/Volume/BatchVolume/BatchRender\";\r\nimport { IBoundsCell } from \"../../math/IBoundsCell\";\r\nimport { Matrix4x4 } from \"../../../maths/Matrix4x4\";\r\nimport { Vector3 } from \"../../../maths/Vector3\";\r\nimport { Vector4 } from \"../../../maths/Vector4\";\r\nimport { VertexMesh } from \"../../../RenderEngine/RenderShader/VertexMesh\";\r\nimport { LayaGL } from \"../../../layagl/LayaGL\";\r\nimport { Laya3DRender } from \"../../RenderObjs/Laya3DRender\";\r\nimport { VolumetricGI } from \"../../component/Volume/VolumetricGI/VolumetricGI\";\r\n\r\nexport enum RenderBitFlag {\r\n    RenderBitFlag_CullFlag = 0,\r\n    RenderBitFlag_Batch = 1,\r\n    RenderBitFlag_Editor = 2,\r\n    RenderBitFlag_InstanceBatch = 3,\r\n    RenderBitFlag_VertexMergeBatch = 4,\r\n\r\n}\r\n\r\nexport enum IrradianceMode {\r\n    LightMap,\r\n    VolumetricGI,\r\n    Common\r\n}\r\n/**\r\n * <code>Render</code> \r\n */\r\nexport class BaseRender extends Component implements IBoundsCell {\r\n    /** @internal */\r\n    static _meshVerticeDefine: Array<ShaderDefine> = [];\r\n\r\n    /**@internal */\r\n    private static _uniqueIDCounter: number = 0;\r\n\r\n    /**@internal */\r\n    static _tempBoundBoxCorners: Vector3[] = [new Vector3(), new Vector3(), new Vector3(), new Vector3(), new Vector3(), new Vector3(), new Vector3(), new Vector3()];\r\n\r\n    /**@internal */\r\n    static _defaultLightmapScaleOffset: Vector4 = new Vector4(1.0, 1.0, 0.0, 0.0);\r\n\r\n    /**@internal */\r\n    static _transLargeUbO: TransLargeUBOUtils;\r\n\r\n    /**\r\n     * BaseRender Init\r\n     */\r\n    static __init__() {\r\n        BaseRender.shaderValueInit();\r\n        // if (Config3D._config._uniformBlock)\r\n        // \tBaseRender.initRenderableLargeUniformBlock();\r\n    }\r\n    /**\r\n      * @internal\r\n      * @param mesh \r\n      * @param out \r\n      */\r\n    static getMeshDefine(mesh: Mesh, out: Array<ShaderDefine>): number {\r\n        out.length = 0;\r\n        var define: number;\r\n        for (var i: number = 0, n: number = mesh._subMeshes.length; i < n; i++) {\r\n            var subMesh = mesh.getSubMesh(i);\r\n            var vertexElements: any[] = subMesh._vertexBuffer._vertexDeclaration._vertexElements;\r\n            for (var j: number = 0, m: number = vertexElements.length; j < m; j++) {\r\n                var vertexElement = vertexElements[j];\r\n                var name: number = vertexElement._elementUsage;\r\n                switch (name) {\r\n                    case VertexMesh.MESH_COLOR0:\r\n                        out.push(MeshSprite3DShaderDeclaration.SHADERDEFINE_COLOR);\r\n                        break\r\n                    case VertexMesh.MESH_TEXTURECOORDINATE0:\r\n                        out.push(MeshSprite3DShaderDeclaration.SHADERDEFINE_UV0);\r\n                        break;\r\n                    case VertexMesh.MESH_TEXTURECOORDINATE1:\r\n                        out.push(MeshSprite3DShaderDeclaration.SHADERDEFINE_UV1);\r\n                        break;\r\n                    case VertexMesh.MESH_TANGENT0:\r\n                        out.push(MeshSprite3DShaderDeclaration.SHADERDEFINE_TANGENT);\r\n                        break;\r\n                }\r\n            }\r\n        }\r\n        return define;\r\n    }\r\n\r\n    static changeVertexDefine(oldMesh: Mesh, mesh: Mesh, defineDatas: ShaderData) {\r\n\r\n        var lastValue: Mesh = oldMesh;\r\n        if (lastValue) {\r\n            BaseRender.getMeshDefine(lastValue, BaseRender._meshVerticeDefine);\r\n            for (var i: number = 0, n: number = BaseRender._meshVerticeDefine.length; i < n; i++)\r\n                defineDatas.removeDefine(BaseRender._meshVerticeDefine[i]);\r\n        }\r\n        if (mesh) {\r\n            BaseRender.getMeshDefine(mesh, BaseRender._meshVerticeDefine);\r\n            for (var i: number = 0, n: number = BaseRender._meshVerticeDefine.length; i < n; i++)\r\n                defineDatas.addDefine(BaseRender._meshVerticeDefine[i]);\r\n        }\r\n    }\r\n\r\n    static shaderValueInit() {\r\n        Sprite3DRenderDeclaration.SHADERDEFINE_GI_LEGACYIBL = Shader3D.getDefineByName(\"GI_LEGACYIBL\");\r\n        Sprite3DRenderDeclaration.SHADERDEFINE_GI_IBL = Shader3D.getDefineByName(\"GI_IBL\");\r\n        Sprite3DRenderDeclaration.SHADERDEFINE_IBL_RGBD = Shader3D.getDefineByName(\"IBL_RGBD\");\r\n        Sprite3DRenderDeclaration.SHADERDEFINE_SPECCUBE_BOX_PROJECTION = Shader3D.getDefineByName(\"SPECCUBE_BOX_PROJECTION\");\r\n\r\n        Sprite3DRenderDeclaration.SHADERDEFINE_VOLUMETRICGI = Shader3D.getDefineByName(\"VOLUMETRICGI\");\r\n    }\r\n\r\n    /** @internal */\r\n    private _lightmapScaleOffset: Vector4 = new Vector4(1, 1, 0, 0);\r\n    /** @internal */\r\n    private _lightmapIndex: number;\r\n    /** @internal */\r\n    private _materialsInstance: boolean[];\r\n    /**@internal */\r\n    _commonUniformMap: Array<string> = [];\r\n    /** @internal */\r\n    _sharedMaterials: Material[] = [];\r\n    /** @internal TODO*/\r\n    _supportOctree: boolean = true;\r\n    /** @internal TODO*/\r\n    _scene: any;//Scene3D\r\n    /** @internal */\r\n    _sceneUpdateMark: number = -1;\r\n    /** @internal */\r\n    _updateMark: number = -1;\r\n    /** @internal */\r\n    _probReflection: ReflectionProbe;\r\n    /**@internal  */\r\n    _probeReflectionUpdateMark: number = -1;\r\n    /**@internal lightProbe*/\r\n    _lightProb: VolumetricGI;\r\n    /**@internal */\r\n    _lightProbUpdateMark: number = -1;\r\n    /** @internal */\r\n    _surportReflectionProbe: boolean = false;\r\n    /**@internal */\r\n    _surportVolumetricGI: boolean = false;\r\n    /** @internal  off  simple */\r\n    _reflectionMode: number = ReflectionProbeMode.simple;\r\n    /**@internal */\r\n    _irradientMode: IrradianceMode;\r\n    /** @internal */\r\n    _shaderValues: ShaderData;\r\n    /**@internal */\r\n    _renderElements: RenderElement[];\r\n    /** @internal */\r\n    _updateRenderType: number = -1;\r\n    /***/\r\n    sortingFudge: number;\r\n    /**@internal */\r\n    _subUniformBufferData: SubUniformBufferData;\r\n    /**@internal motion list indexnot motion is -1*/\r\n    _motionIndexList: number = -1;\r\n    /**@internal needRender*/\r\n    _customCull: boolean;\r\n    /**@internal */\r\n    _ratioIgnor: number = 0.005;//TODO\r\n    /**@internal TODO*/\r\n    _LOD: number = -1;\r\n    /**@internal TODO*/\r\n    _batchRender: BatchRender;\r\n\r\n    /**@internal */\r\n    protected _lightmapDirtyFlag: number = -1;\r\n    /**@internal 0,1lod*/\r\n    private _volume: Volume;\r\n    /**@internal */\r\n    protected _worldParams: Vector4;//x:invertFaceFront  yzw?\r\n    /**\r\n     * DistanceVolumCull\r\n     * \r\n     */\r\n    set ratioIgnor(value: number) {\r\n        this._ratioIgnor = value;\r\n    }\r\n\r\n    get ratioIgnor(): number {\r\n        return this._ratioIgnor;\r\n    }\r\n\r\n    get renderbitFlag() {\r\n        return this._rendernode.renderbitFlag;\r\n    }\r\n\r\n    set boundsChange(value: boolean) {\r\n        this._rendernode.boundsChange = value\r\n    }\r\n\r\n    get boundsChange(): boolean {\r\n        return this._rendernode.boundsChange;\r\n    }\r\n\r\n    shadowCullPass(): boolean {\r\n        return this.castShadow && this._enabled && (this.renderbitFlag == 0);\r\n    }\r\n\r\n    /**@internal */\r\n    protected _rendernode: IBaseRenderNode;\r\n\r\n    /** @internal */\r\n    protected _bounds: Bounds;\r\n\r\n    /** @internal */\r\n    protected _baseGeometryBounds: Bounds;\r\n\r\n    /**@internal */\r\n    protected _transform: Transform3D;\r\n\r\n    /**@internal */\r\n    _distanceForSort: number;\r\n\r\n    /**@interface */\r\n    _receiveShadow: boolean;\r\n\r\n    get renderNode(): IBaseRenderNode {\r\n        return this._rendernode;\r\n    }\r\n\r\n    set distanceForSort(value: number) {\r\n        this._distanceForSort = value;\r\n        this._rendernode.distanceForSort = value;\r\n    }\r\n\r\n    get distanceForSort() {\r\n        return this._distanceForSort;\r\n    }\r\n\r\n    /**\r\n     * GeometryBounds\r\n     * boundsgeometryBoundstransformnative\r\n     * @internal\r\n     */\r\n    set geometryBounds(value: Bounds) {\r\n        this._baseGeometryBounds = this._rendernode.geometryBounds = value;\r\n    }\r\n\r\n    get geometryBounds(): Bounds {\r\n        return this._baseGeometryBounds;\r\n    }\r\n    /**\r\n     * ID,\r\n     */\r\n    get id(): number {\r\n        return this._rendernode.renderId;\r\n    }\r\n\r\n    /**\r\n     * \r\n     */\r\n    get lightmapIndex(): number {\r\n        return this._lightmapIndex;\r\n    }\r\n\r\n    set lightmapIndex(value: number) {\r\n        this._lightmapIndex = value;\r\n        this._scene && this._applyLightMapParams();\r\n        this._getIrradientMode();\r\n    }\r\n\r\n    /**\r\n     * \r\n     */\r\n    get irradientMode() {\r\n        return this._irradientMode;\r\n    }\r\n\r\n    /**\r\n     * \r\n     */\r\n    get lightmapScaleOffset(): Vector4 {\r\n        return this._lightmapScaleOffset;\r\n    }\r\n\r\n    set lightmapScaleOffset(value: Vector4) {\r\n        if (!value)\r\n            throw \"BaseRender: lightmapScaleOffset can't be null.\";\r\n        this._lightmapScaleOffset = value;\r\n        this._setShaderValue(RenderableSprite3D.LIGHTMAPSCALEOFFSET, ShaderDataType.Vector4, value);\r\n    }\r\n\r\n    /**\r\n     * ,\r\n     */\r\n    get material(): Material {\r\n        var material: Material = this._sharedMaterials[0];\r\n        if (material && !this._materialsInstance[0]) {\r\n            var insMat: Material = this._getInstanceMaterial(material, 0);\r\n            var renderElement: RenderElement = this._renderElements[0];\r\n            (renderElement) && (renderElement.material = insMat);\r\n        }\r\n        return this._sharedMaterials[0];\r\n    }\r\n\r\n    set material(value: Material) {\r\n        this.sharedMaterial = value;\r\n        this._isSupportRenderFeature();\r\n    }\r\n\r\n    /**\r\n     * ,\r\n     */\r\n    get materials(): Material[] {\r\n        for (var i: number = 0, n: number = this._sharedMaterials.length; i < n; i++) {\r\n            if (!this._materialsInstance[i]) {\r\n                var insMat: Material = this._getInstanceMaterial(this._sharedMaterials[i], i);\r\n                var renderElement: RenderElement = this._renderElements[i];\r\n                (renderElement) && (renderElement.material = insMat);\r\n            }\r\n        }\r\n        return this._sharedMaterials.slice();\r\n    }\r\n\r\n    set materials(value: Material[]) {\r\n        this.sharedMaterials = value;\r\n        this._isSupportRenderFeature();\r\n    }\r\n\r\n    /**\r\n     * \r\n     */\r\n    get sharedMaterial(): Material {\r\n        return this._sharedMaterials[0];\r\n    }\r\n\r\n    set sharedMaterial(value: Material) {\r\n\r\n        let lastMat = this._sharedMaterials[0];\r\n        this._changeMaterialReference(lastMat, value);\r\n        this._sharedMaterials[0] = value;\r\n\r\n        let element = this._renderElements[0];\r\n        if (element && element.material !== value) {\r\n            this._materialsInstance[0] = false;\r\n            element.material = value;\r\n        }\r\n\r\n        this._isSupportRenderFeature();\r\n    }\r\n\r\n    /**\r\n     * \r\n     */\r\n    get sharedMaterials(): Material[] {\r\n        return this._sharedMaterials.slice();\r\n    }\r\n\r\n    set sharedMaterials(value: Material[]) {\r\n        var materialsInstance: boolean[] = this._materialsInstance;\r\n        var sharedMats: Material[] = this._sharedMaterials;\r\n\r\n        if (value) {\r\n            let count = value.length;\r\n            for (let i = 0; i < count; i++) {\r\n                let mat = value[i];\r\n                let lastMat = sharedMats[i];\r\n                this._changeMaterialReference(lastMat, mat);\r\n                sharedMats[i] = mat;\r\n\r\n                let element = this._renderElements[i];\r\n                if (element && element.material !== mat) {\r\n                    materialsInstance[i] = false;\r\n                    element.material = mat;\r\n                }\r\n            }\r\n\r\n            for (let i = count, n = sharedMats.length; i < n; i++) {\r\n                let mat = sharedMats[i];\r\n                mat && mat._removeReference();\r\n\r\n                let renderElement = this._renderElements[i];\r\n                renderElement && (renderElement.material = null);\r\n            }\r\n\r\n            materialsInstance.length = count;\r\n            sharedMats.length = count;\r\n        }\r\n        else {\r\n            for (var i = 0, n = sharedMats.length; i < n; i++) {\r\n                let lastMat = sharedMats[i];\r\n                (lastMat) && (lastMat._removeReference());\r\n            }\r\n\r\n            this._sharedMaterials = [];\r\n        }\r\n        this._isSupportRenderFeature();\r\n    }\r\n\r\n    /**\r\n     * ,,\r\n     */\r\n    get bounds(): Bounds {\r\n        if (this.boundsChange) {\r\n            this._calculateBoundingBox();\r\n            this.boundsChange = false;\r\n        }\r\n        return this._bounds as Bounds;\r\n    }\r\n\r\n    set receiveShadow(value: boolean) {\r\n        if (this.renderNode.receiveShadow !== value) {\r\n            this.renderNode.receiveShadow = value;\r\n            this._receiveShadow = value;\r\n            if (value)\r\n                this._shaderValues.addDefine(RenderableSprite3D.SHADERDEFINE_RECEIVE_SHADOW);\r\n            else\r\n                this._shaderValues.removeDefine(RenderableSprite3D.SHADERDEFINE_RECEIVE_SHADOW);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * \r\n     */\r\n    get receiveShadow(): boolean {\r\n        return this.renderNode.receiveShadow;\r\n    }\r\n\r\n    /**\r\n     * \r\n     */\r\n    get castShadow(): boolean {\r\n        return this.renderNode.castShadow;\r\n    }\r\n\r\n    set castShadow(value: boolean) {\r\n        this.renderNode.castShadow = value;\r\n    }\r\n\r\n    /**\r\n     * \r\n     */\r\n    set reflectionMode(value: ReflectionProbeMode) {\r\n        this._reflectionMode = value;\r\n    }\r\n\r\n    get reflectionMode(): ReflectionProbeMode {\r\n        return this._reflectionMode;\r\n    }\r\n\r\n\r\n\r\n    set volume(value: Volume) {\r\n        if (!value) {//value = null,\r\n            if (this._volume) {\r\n                this._volume._removeRenderNode && this._volume._removeRenderNode(this);\r\n                this._volume = null;\r\n            }\r\n            return;\r\n        }\r\n        if (this._volume != value) {\r\n            value._addRenderNode && value._addRenderNode(this);\r\n            this._volume = value;\r\n            return;\r\n        } else {\r\n            value._motionInVolume && value._motionInVolume(this);\r\n        }\r\n    }\r\n\r\n    get volume(): Volume {\r\n        return this._volume;\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     * \r\n     */\r\n    set probReflection(voluemProbe: ReflectionProbe) {\r\n        if (this._probReflection == voluemProbe)\r\n            return;\r\n        this._probeReflectionUpdateMark = -1;\r\n        this._probReflection = voluemProbe;\r\n        if (this._reflectionMode == ReflectionProbeMode.off) {\r\n            this._shaderValues.removeDefine(Sprite3DRenderDeclaration.SHADERDEFINE_SPECCUBE_BOX_PROJECTION);\r\n            this._shaderValues.addDefine(Sprite3DRenderDeclaration.SHADERDEFINE_GI_IBL);\r\n            this._setShaderValue(RenderableSprite3D.IBLTEX, ShaderDataType.TextureCube, TextureCube.blackTexture);\r\n            this._setShaderValue(RenderableSprite3D.IBLROUGHNESSLEVEL, ShaderDataType.Float, 0);\r\n        } else {\r\n            this._probReflection.applyReflectionShaderData(this._shaderValues);\r\n        }\r\n        this._getIrradientMode();\r\n    }\r\n\r\n    set lightProb(volumetricGI: VolumetricGI) {\r\n        if (this._lightProb == volumetricGI) {\r\n            return;\r\n        }\r\n        this._lightProbUpdateMark = -1;\r\n        this._lightProb = volumetricGI;\r\n        if (this.lightmapIndex < 0) {\r\n            this._lightProb && this._lightProb.applyVolumetricGI(this._shaderValues)\r\n        };\r\n        this._getIrradientMode();\r\n    }\r\n\r\n\r\n\r\n    /**\r\n     *  <code>BaseRender</code> \r\n     */\r\n    constructor() {\r\n        super();\r\n        this._commonUniformMap = this._getcommonUniformMap();\r\n        this._rendernode = this._createBaseRenderNode();\r\n        this._rendernode.owner = this;\r\n        this._rendernode.renderId = ++BaseRender._uniqueIDCounter;\r\n        this._bounds = this._rendernode.bounds = new Bounds(Vector3.ZERO, Vector3.ZERO);\r\n        this._renderElements = [];\r\n        this._enabled = true;\r\n        this._materialsInstance = [];\r\n        this._shaderValues = LayaGL.renderOBJCreate.createShaderData(null);\r\n        this.lightmapIndex = -1;\r\n        this.receiveShadow = false;\r\n        this.sortingFudge = 0.0;\r\n        this._customCull = this._needRender !== BaseRender.prototype._needRender;\r\n        this.runInEditor = true;\r\n        this.boundsChange = true;\r\n        this._rendernode.renderbitFlag = 0;\r\n        this._rendernode.staticMask = 1;\r\n        this._worldParams = new Vector4(1.0, 0.0, 0.0, 0.0);\r\n    }\r\n\r\n    private _getIrradientMode() {\r\n        if (this.lightmapIndex >= 0) {\r\n            this._irradientMode = IrradianceMode.LightMap;\r\n        } else if (this.lightProb) {\r\n            this._irradientMode = IrradianceMode.VolumetricGI;\r\n        } else {\r\n\r\n        }\r\n    }\r\n\r\n    protected _getcommonUniformMap(): Array<string> {\r\n        return [\"Sprite3D\"];\r\n    }\r\n\r\n    protected _createBaseRenderNode(): IBaseRenderNode {\r\n        return Laya3DRender.renderOBJCreate.createBaseRenderNode();\r\n    }\r\n\r\n    private _changeLayer(layer: number) {\r\n        this._rendernode.layer = layer;\r\n    }\r\n\r\n    private _changeStaticMask(staticmask: number) {\r\n        this._rendernode.staticMask = staticmask;\r\n    }\r\n\r\n    protected _onAdded(): void {\r\n        this._transform = (this.owner as Sprite3D).transform;\r\n        (this.owner as Sprite3D)._isRenderNode++;\r\n        this.setRenderbitFlag(RenderBitFlag.RenderBitFlag_Editor, this.owner._getBit(NodeFlags.HIDE_BY_EDITOR));\r\n        this._rendernode.transform = this._transform;\r\n        this._changeLayer((this.owner as Sprite3D).layer);\r\n        this._changeStaticMask((this.owner as Sprite3D)._isStatic);\r\n    }\r\n\r\n    protected _onEnable(): void {\r\n        super._onEnable();\r\n        if (this.owner) {\r\n            (this.owner as Sprite3D).transform.on(Event.TRANSFORM_CHANGED, this, this._onWorldMatNeedChange);//BaseRender,owner\r\n            (this.owner as Sprite3D).on(Event.LAYERCHANGE, this, this._changeLayer);\r\n            (this.owner as Sprite3D).on(Event.staticMask, this, this._changeStaticMask);\r\n            this._changeLayer((this.owner as Sprite3D).layer);\r\n            this._changeStaticMask((this.owner as Sprite3D)._isStatic);\r\n        }\r\n        this.owner.scene._addRenderObject(this);\r\n        this._setBelongScene(this.owner.scene);\r\n    }\r\n\r\n    protected _onDisable(): void {\r\n        if (this.owner) {\r\n            (this.owner as Sprite3D).transform.off(Event.TRANSFORM_CHANGED, this, this._onWorldMatNeedChange);//BaseRender,owner\r\n            (this.owner as Sprite3D).off(Event.LAYERCHANGE, this, this._changeLayer);\r\n            (this.owner as Sprite3D).off(Event.staticMask, this, this._changeStaticMask);\r\n        }\r\n        this.owner.scene._removeRenderObject(this);\r\n        this._setUnBelongScene();\r\n        this.volume = null;\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    private _changeMaterialReference(lastValue: Material, value: Material): void {\r\n        (lastValue) && (lastValue._removeReference());\r\n        value && value._addReference();\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    private _getInstanceMaterial(material: Material, index: number): Material {\r\n        var insMat: Material = material.clone();//\r\n        insMat.name = insMat.name + \"(Instance)\";\r\n        this._materialsInstance[index] = true;\r\n        this._changeMaterialReference(this._sharedMaterials[index], insMat);\r\n        this._sharedMaterials[index] = insMat;\r\n        return insMat;\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    private _isSupportRenderFeature() {\r\n        //surportReflectionProbe\r\n        let preReflection = this._surportReflectionProbe;\r\n        let prelightprob = this._surportVolumetricGI;\r\n        this._surportReflectionProbe = false;\r\n        this._surportVolumetricGI = false;\r\n        var sharedMats: Material[] = this._sharedMaterials;\r\n        for (var i: number = 0, n: number = sharedMats.length; i < n; i++) {\r\n            var mat: Material = sharedMats[i];\r\n            this._surportReflectionProbe ||= (this._surportReflectionProbe || (mat && mat._shader._supportReflectionProbe));//TODO\r\n            this._surportVolumetricGI ||= (this._surportVolumetricGI || (mat && mat._shader._surportVolumetricGI));\r\n        }\r\n        if ((!preReflection && this._surportReflectionProbe) || (!prelightprob && this._surportVolumetricGI))//Reflection\r\n            this._addReflectionProbeUpdate();\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     * BaseRender motion\r\n     */\r\n    protected _onWorldMatNeedChange(flag: number): void {\r\n        this.boundsChange = true;\r\n        this._addReflectionProbeUpdate();\r\n        this._subUniformBufferData && (this._subUniformBufferData._needUpdate = true);\r\n        this._batchRender && this._batchRender._updateOneRender(this);\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    protected _calculateBoundingBox(): void {\r\n        throw (\"BaseRender: must override it.\");\r\n    }\r\n\r\n\r\n    /**\r\n     * flag,1lod\r\n     */\r\n    setRenderbitFlag(flag: number, pass: boolean) {\r\n        if (pass)\r\n            this._rendernode.renderbitFlag |= (1 << flag);\r\n        else\r\n            this._rendernode.renderbitFlag &= ~(1 << flag);\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    _setShaderValue(index: number, shaderdataType: ShaderDataType, value: any) {\r\n        this._shaderValues.setShaderData(index, shaderdataType, value);\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @internal\r\n     */\r\n    _addReflectionProbeUpdate() {\r\n        //TODOsimpleoff\r\n        this._scene && this._scene._volumeManager.addMotionObject(this);\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     * \r\n     */\r\n    _applyLightMapParams(): void {\r\n        if (!this._scene) return;\r\n        var lightMaps: Lightmap[] = this._scene.lightmaps;\r\n        var shaderValues: ShaderData = this._shaderValues;\r\n        var lightmapIndex: number = this._lightmapIndex;\r\n        if (lightmapIndex >= 0 && lightmapIndex < lightMaps.length) {\r\n            var lightMap: Lightmap = lightMaps[lightmapIndex];\r\n            shaderValues.setTexture(RenderableSprite3D.LIGHTMAP, lightMap.lightmapColor);\r\n            shaderValues.addDefine(RenderableSprite3D.SAHDERDEFINE_LIGHTMAP);\r\n            if (lightMap.lightmapDirection) {\r\n                shaderValues.setTexture(RenderableSprite3D.LIGHTMAP_DIRECTION, lightMap.lightmapDirection);\r\n                shaderValues.addDefine(RenderableSprite3D.SHADERDEFINE_LIGHTMAP_DIRECTIONAL);\r\n            }\r\n            else {\r\n                shaderValues.removeDefine(RenderableSprite3D.SHADERDEFINE_LIGHTMAP_DIRECTIONAL);\r\n            }\r\n        } else {\r\n            shaderValues.removeDefine(RenderableSprite3D.SAHDERDEFINE_LIGHTMAP);\r\n            shaderValues.removeDefine(RenderableSprite3D.SHADERDEFINE_LIGHTMAP_DIRECTIONAL);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * apply lightProb\r\n     * @returns \r\n     */\r\n    _applyLightProb() {\r\n        if (this.lightmapIndex >= 0 || !this._lightProb) return;\r\n        if (this._lightProb._updateMark != this._lightProbUpdateMark) {\r\n            this._lightProbUpdateMark = this._lightProb._updateMark;\r\n            this._lightProb.applyVolumetricGI(this._shaderValues);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * apply reflection\r\n     * @returns \r\n     */\r\n    _applyReflection() {\r\n        if (!this._probReflection) return;\r\n        if (this._probReflection._updateMark != this._probeReflectionUpdateMark) {\r\n            this._probeReflectionUpdateMark = this._probReflection._updateMark;\r\n            this._probReflection.applyReflectionShaderData(this._shaderValues);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    _setBelongScene(scene: any): void {\r\n        this._scene = scene;\r\n        this._onWorldMatNeedChange(1);\r\n        this._isSupportRenderFeature();\r\n        this._batchRender && this._batchRender._batchOneRender(this);\r\n        this.lightmapIndex = this.lightmapIndex;\r\n        Stat.renderNode++;\r\n        if (false) {\r\n            this._subUniformBufferData = BaseRender._transLargeUbO.create();\r\n            this._subUniformBufferData.setMatrix(\"u_WorldMat\", Matrix4x4.DEFAULT);\r\n            this._addReflectionProbeUpdate();\r\n            this.probReflection = this._probReflection;\r\n            this.lightmapScaleOffset = this._lightmapScaleOffset;\r\n            this._subUniformBufferData._needUpdate = true;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    _setUnBelongScene() {\r\n        Stat.renderNode--;\r\n        this._scene._volumeManager.removeMotionObject(this);\r\n        let batch = this._batchRender;\r\n        this._batchRender && this._batchRender._removeOneRender(this);\r\n        this._batchRender = batch;\r\n        if (false) {\r\n            this._subUniformBufferData && BaseRender._transLargeUbO.recover(this._subUniformBufferData);\r\n            this._subUniformBufferData = null;\r\n        }\r\n        this._scene = null;\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     * @param boundFrustum \r\n     */\r\n    _needRender(boundFrustum: BoundFrustum, context: RenderContext3D): boolean {\r\n        if (boundFrustum)\r\n            return boundFrustum.intersects(this.bounds);\r\n        else\r\n            return true;\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     * \r\n     */\r\n    _CullOut(): void {\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    _renderUpdate(context: RenderContext3D, transform: Transform3D): void {\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    _renderUpdateWithCamera(context: RenderContext3D, transform: Transform3D): void {\r\n    }\r\n\r\n    protected _onDestroy() {\r\n        if (this.owner as Sprite3D)\r\n            (this.owner as Sprite3D)._isRenderNode--;\r\n        (this._motionIndexList !== -1) && (this._scene._sceneRenderManager.removeMotionObject(this));\r\n        (this._scene) && this._scene.sceneRenderableManager.removeRenderObject(this);\r\n        var i: number = 0, n: number = 0;\r\n        for (i = 0, n = this._renderElements.length; i < n; i++)\r\n            this._renderElements[i].destroy();\r\n        for (i = 0, n = this._sharedMaterials.length; i < n; i++) {\r\n            let m = this._sharedMaterials[i];\r\n            m && !m.destroyed && m._removeReference();\r\n        }\r\n        this._renderElements = null;\r\n        this._sharedMaterials = null;\r\n        this._bounds = null;\r\n        this._lightmapScaleOffset = null;\r\n        this._lightmapIndex = -1;\r\n        this._scene = null;\r\n        this._rendernode = null;\r\n        this._shaderValues.destroy();\r\n        this._shaderValues = null;\r\n        this._transform = null;\r\n        this._batchRender = null;\r\n        if (this._subUniformBufferData) {\r\n            BaseRender._transLargeUbO.recover(this._subUniformBufferData);\r\n            this._subUniformBufferData = null;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * @override\r\n     * @param dest \r\n     */\r\n    _cloneTo(dest: Component): void {\r\n        super._cloneTo(dest);\r\n        let render = (dest as BaseRender);\r\n        render.receiveShadow = this.receiveShadow;\r\n        render.sharedMaterials = this.sharedMaterials;\r\n        render.reflectionMode = this.reflectionMode;\r\n        render.castShadow = this.castShadow;\r\n        render.sortingFudge = this.sortingFudge;\r\n    }\r\n}\r\n\r\n","/**\r\n * \r\n */\r\nexport enum ShadowMode {\r\n    /***/\r\n    None,\r\n    /***/\r\n    Hard,\r\n    /***/\r\n    SoftLow,\r\n    /**,*/\r\n    SoftHigh\r\n}","/**\r\n * \r\n */\r\nexport enum ShadowCascadesMode {\r\n    /**  */\r\n    NoCascades,\r\n    /**  */\r\n    TwoCascades,\r\n    /**  */\r\n    FourCascades,\r\n}","import { Config3D } from \"../../../../Config3D\";\r\nimport { Scene3D } from \"../scene/Scene3D\";\r\nimport { Sprite3D } from \"../Sprite3D\";\r\nimport { ShadowMode } from \"./ShadowMode\";\r\nimport { Component } from \"../../../components/Component\";\r\nimport { Color } from \"../../../maths/Color\";\r\nimport { Matrix4x4 } from \"../../../maths/Matrix4x4\";\r\nimport { Vector3 } from \"../../../maths/Vector3\";\r\n\r\n\r\nexport enum LightType {\r\n    Directional,\r\n    Spot,\r\n    Point,\r\n    Area\r\n}\r\n\r\nexport enum LightMode {\r\n    mix,\r\n    realTime,//\r\n    bakeOnly\r\n}\r\n\r\n/**\r\n * <code>LightSprite</code> \r\n */\r\nexport class Light extends Component {\r\n\r\n    /** @internal */\r\n    protected _shadowMode: ShadowMode = ShadowMode.None;\r\n\r\n    /** @internal */\r\n    _isAlternate: boolean = false;\r\n    /** @internal */\r\n    _intensityColor: Vector3;\r\n    /** @internal */\r\n    _intensity: number;\r\n    /** @internal */\r\n    _shadowResolution: number = 2048;\r\n    /** @internal */\r\n    _shadowDistance: number = 50.0;\r\n    /** @internal */\r\n    _shadowDepthBias: number = 1.0;\r\n    /** @internal */\r\n    _shadowNormalBias: number = 1.0;\r\n    /** @internal */\r\n    _shadowNearPlane: number = 0.1;\r\n    /** @internal */\r\n    _shadowStrength: number = 1.0;\r\n    /** @internal */\r\n    _lightmapBakedType: LightMode;\r\n    /** @internal */\r\n    _lightType: LightType;\r\n    /** @internal scale*/\r\n    _lightWoldMatrix: Matrix4x4 = new Matrix4x4();\r\n\r\n    /**  */\r\n    color: Color;\r\n\r\n    /**\r\n     * \r\n     */\r\n    get intensity(): number {\r\n        return this._intensity;\r\n    }\r\n\r\n    set intensity(value: number) {\r\n        this._intensity = value;\r\n    }\r\n\r\n    /**\r\n     * \r\n     */\r\n    get shadowMode(): ShadowMode {\r\n        return this._shadowMode;\r\n    }\r\n\r\n    set shadowMode(value: ShadowMode) {\r\n        this._shadowMode = value\r\n    }\r\n\r\n    /**\r\n     * \r\n     */\r\n    get shadowDistance(): number {\r\n        return this._shadowDistance;\r\n    }\r\n\r\n    set shadowDistance(value: number) {\r\n        this._shadowDistance = value;\r\n    }\r\n\r\n    /**\r\n     * \r\n     */\r\n    get shadowResolution(): number {\r\n        return this._shadowResolution;\r\n    }\r\n\r\n    set shadowResolution(value: number) {\r\n        this._shadowResolution = value;\r\n    }\r\n\r\n    /**\r\n     * \r\n     */\r\n    get shadowDepthBias(): number {\r\n        return this._shadowDepthBias;\r\n    }\r\n\r\n    set shadowDepthBias(value: number) {\r\n        this._shadowDepthBias = value;\r\n    }\r\n\r\n    /**\r\n     * \r\n     */\r\n    get shadowNormalBias(): number {\r\n        return this._shadowNormalBias;\r\n    }\r\n\r\n    set shadowNormalBias(value: number) {\r\n        this._shadowNormalBias = value;\r\n    }\r\n\r\n    /**\r\n     * \r\n     */\r\n    get shadowStrength(): number {\r\n        return this._shadowStrength;\r\n    }\r\n\r\n    set shadowStrength(value: number) {\r\n        this._shadowStrength = value;\r\n    }\r\n\r\n    /**\r\n     * \r\n     */\r\n    get shadowNearPlane(): number {\r\n        return this._shadowNearPlane;\r\n    }\r\n\r\n    set shadowNearPlane(value: number) {\r\n        this._shadowNearPlane = value;\r\n    }\r\n\r\n    /**\r\n     * \r\n     */\r\n    get lightmapBakedType(): LightMode {\r\n        return this._lightmapBakedType;\r\n    }\r\n\r\n    set lightmapBakedType(value: LightMode) {\r\n        let premode = this._lightmapBakedType;\r\n        if (this._lightmapBakedType !== value) {\r\n            this._lightmapBakedType = value;\r\n            if (this._enabled) {\r\n                if (value == LightMode.bakeOnly)\r\n                    this._removeFromScene();\r\n                else\r\n                    if (premode == LightMode.bakeOnly)\r\n                        this._addToScene();\r\n            }\r\n        }\r\n    }\r\n\r\n    get lightWorldMatrix(): Matrix4x4 {\r\n        var position = (this.owner as Sprite3D).transform.position;\r\n        var quaterian = (this.owner as Sprite3D).transform.rotation;\r\n        Matrix4x4.createAffineTransformation(position, quaterian, Vector3.ONE, this._lightWoldMatrix);\r\n        return this._lightWoldMatrix;\r\n    }\r\n\r\n    get lightType() {\r\n        return this._lightType;\r\n    }\r\n\r\n    /**\r\n     *  <code>LightSprite</code> \r\n     */\r\n    constructor() {\r\n        super();\r\n\r\n        this.runInEditor = true;\r\n        this._intensity = 1.0;\r\n        this._intensityColor = new Vector3();\r\n        this.color = new Color(1.0, 1.0, 1.0, 1.0);\r\n        this._lightmapBakedType = LightMode.realTime;\r\n    }\r\n\r\n    /**\r\n     * @inheritDoc\r\n     * @override\r\n     * @internal\r\n     */\r\n    _parse(data: any, spriteMap: any): void {\r\n        super._parse(data, spriteMap);\r\n        var colorData: any[] = data.color;\r\n        this.color.r = colorData[0];\r\n        this.color.g = colorData[1];\r\n        this.color.b = colorData[2];\r\n        this.intensity = data.intensity;\r\n        this.lightmapBakedType = data.lightmapBakedType;\r\n    }\r\n    /**\r\n     * @inheritDoc\r\n     * @override\r\n     * @internal\r\n     */\r\n    _cloneTo(dest: Component) {\r\n        super._cloneTo(dest);\r\n        var light = <Light>dest;\r\n        light.color = this.color.clone();\r\n        light.intensity = this.intensity;\r\n        light.lightmapBakedType = this.lightmapBakedType;\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    private _addToScene(): void {\r\n        var scene: Scene3D = <Scene3D>this.owner.scene;\r\n        var maxLightCount: number = Config3D.maxLightCount;\r\n        if (scene._lightCount < maxLightCount) {\r\n            scene._lightCount++;\r\n            this._addToLightQueue();\r\n            this._isAlternate = false;\r\n        }\r\n        else {\r\n            scene._alternateLights.add(this);\r\n            this._isAlternate = true;\r\n            console.warn(\"LightSprite:light count has large than maxLightCount,the latest added light will be ignore.\");\r\n        }\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    private _removeFromScene(): void {\r\n        var scene: Scene3D = <Scene3D>this.owner._scene;\r\n        if (!scene)\r\n            return;\r\n        if (this._isAlternate) {\r\n            scene._alternateLights.remove(this);\r\n        }\r\n        else {\r\n            scene._lightCount--;\r\n            this._removeFromLightQueue();\r\n            if (scene._alternateLights._length > 0) {\r\n                var alternateLight = scene._alternateLights.shift();\r\n                alternateLight!._addToLightQueue();\r\n                alternateLight!._isAlternate = false;\r\n                scene._lightCount++;\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    protected _addToLightQueue(): void {\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    protected _removeFromLightQueue(): void {\r\n    }\r\n\r\n    protected _onEnable(): void {\r\n        (this.lightmapBakedType !== LightMode.bakeOnly) && (this._addToScene());\r\n    }\r\n\r\n    protected _onDisable(): void {\r\n        (this.lightmapBakedType !== LightMode.bakeOnly) && (this._removeFromScene());\r\n    }\r\n\r\n    protected _onDestroy() {\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    protected _create(): Component {\r\n        return new Light();\r\n    }\r\n}\r\n\r\n","import { BoundFrustum, FrustumCorner } from \"../../math/BoundFrustum\";\r\nimport { BoundSphere } from \"../../math/BoundSphere\";\r\nimport { Plane } from \"../../math/Plane\";\r\nimport { ShadowSliceData, ShadowSpotData } from \"../../shadowMap/ShadowSliceData\";\r\nimport { Utils3D } from \"../../utils/Utils3D\";\r\nimport { ShadowCascadesMode } from \"./ShadowCascadesMode\";\r\nimport { ShadowMode } from \"./ShadowMode\";\r\nimport { Light, LightType } from \"./Light\";\r\nimport { SpotLightCom } from \"./SpotLightCom\";\r\nimport { Sprite3D } from \"../Sprite3D\";\r\nimport { DirectionLightCom } from \"./DirectionLightCom\";\r\nimport { FilterMode } from \"../../../RenderEngine/RenderEnum/FilterMode\";\r\nimport { WrapMode } from \"../../../RenderEngine/RenderEnum/WrapMode\";\r\nimport { RenderCapable } from \"../../../RenderEngine/RenderEnum/RenderCapable\";\r\nimport { TextureCompareMode } from \"../../../RenderEngine/RenderEnum/TextureCompareMode\";\r\nimport { MathUtils3D } from \"../../../maths/MathUtils3D\";\r\nimport { Matrix4x4 } from \"../../../maths/Matrix4x4\";\r\nimport { Vector3 } from \"../../../maths/Vector3\";\r\nimport { Vector4 } from \"../../../maths/Vector4\";\r\nimport { RenderTexture } from \"../../../resource/RenderTexture\";\r\nimport { RenderTargetFormat } from \"../../../RenderEngine/RenderEnum/RenderTargetFormat\";\r\nimport { LayaGL } from \"../../../layagl/LayaGL\";\r\n\r\n/**\r\n * @internal\r\n */\r\nenum FrustumFace {\r\n    Near = 0,\r\n    Far = 1,\r\n    Left = 2,\r\n    Right = 3,\r\n    Bottom = 4,\r\n    Top = 5,\r\n}\r\n\r\nexport enum ShadowMapFormat {\r\n    bit16,\r\n    bit24_8,\r\n    bit32\r\n}\r\n\r\n/**\r\n * @internal\r\n */\r\nexport class ShadowUtils {\r\n    /** @internal */\r\n    private static _tempMatrix0: Matrix4x4 = new Matrix4x4()\r\n\r\n\r\n    /** @internal */\r\n    private static _shadowMapScaleOffsetMatrix: Matrix4x4 = new Matrix4x4(\r\n        0.5, 0.0, 0.0, 0.0,\r\n        0.0, 0.5, 0.0, 0.0,\r\n        0.0, 0.0, 1.0, 0.0,\r\n        0.5, 0.5, 0.0, 1.0,\r\n    );\r\n\r\n    /** @internal */\r\n    private static _frustumCorners: Vector3[] = [new Vector3(), new Vector3(), new Vector3(), new Vector3(), new Vector3(), new Vector3(), new Vector3(), new Vector3()];\r\n    /** @internal */\r\n    private static _adjustNearPlane: Plane;\r\n    /** @internal */\r\n    private static _adjustFarPlane: Plane;\r\n    /** @internal */\r\n    private static _backPlaneFaces: FrustumFace[] = new Array(5);\r\n    /** @internal */\r\n    private static _edgePlanePoint2: Vector3 = new Vector3();\r\n\r\n    /** @internal */\r\n    private static _frustumPlaneNeighbors: FrustumFace[][] = [\r\n        [FrustumFace.Left, FrustumFace.Right, FrustumFace.Top, FrustumFace.Bottom],// near\r\n        [FrustumFace.Left, FrustumFace.Right, FrustumFace.Top, FrustumFace.Bottom],// far\r\n        [FrustumFace.Near, FrustumFace.Far, FrustumFace.Top, FrustumFace.Bottom],// left\r\n        [FrustumFace.Near, FrustumFace.Far, FrustumFace.Top, FrustumFace.Bottom],// right\r\n        [FrustumFace.Near, FrustumFace.Far, FrustumFace.Left, FrustumFace.Right],// bottom\r\n        [FrustumFace.Near, FrustumFace.Far, FrustumFace.Left, FrustumFace.Right]];// top\r\n\r\n    /** @internal */\r\n    private static _frustumTwoPlaneCorners: FrustumCorner[][][] = [\r\n        [[FrustumCorner.unknown, FrustumCorner.unknown]/* near */, [FrustumCorner.unknown, FrustumCorner.unknown]/* far */, [FrustumCorner.nearBottomLeft, FrustumCorner.nearTopLeft]/* left */, [FrustumCorner.nearTopRight, FrustumCorner.nearBottomRight]/* right */, [FrustumCorner.nearBottomRight, FrustumCorner.nearBottomLeft]/* bottom */, [FrustumCorner.nearTopLeft, FrustumCorner.nearTopRight]/* top */],// near\r\n        [[FrustumCorner.unknown, FrustumCorner.unknown]/* near */, [FrustumCorner.unknown, FrustumCorner.unknown]/* far */, [FrustumCorner.FarTopLeft, FrustumCorner.FarBottomLeft]/* left */, [FrustumCorner.FarBottomRight, FrustumCorner.FarTopRight]/* right */, [FrustumCorner.FarBottomLeft, FrustumCorner.FarBottomRight]/* bottom */, [FrustumCorner.FarTopRight, FrustumCorner.FarTopLeft]/* top */],// far\r\n        [[FrustumCorner.nearTopLeft, FrustumCorner.nearBottomLeft]/* near */, [FrustumCorner.FarBottomLeft, FrustumCorner.FarTopLeft]/* far */, [FrustumCorner.unknown, FrustumCorner.unknown]/* left */, [FrustumCorner.unknown, FrustumCorner.unknown]/* right */, [FrustumCorner.nearBottomLeft, FrustumCorner.FarBottomLeft]/* bottom */, [FrustumCorner.FarTopLeft, FrustumCorner.nearTopLeft]/* top */],// left\r\n        [[FrustumCorner.nearBottomRight, FrustumCorner.nearTopRight]/* near */, [FrustumCorner.FarTopRight, FrustumCorner.FarBottomRight]/* far */, [FrustumCorner.unknown, FrustumCorner.unknown]/* left */, [FrustumCorner.unknown, FrustumCorner.unknown]/* right */, [FrustumCorner.FarBottomRight, FrustumCorner.nearBottomRight]/* bottom */, [FrustumCorner.nearTopRight, FrustumCorner.FarTopRight]/* top */],// right\r\n        [[FrustumCorner.nearBottomLeft, FrustumCorner.nearBottomRight]/* near */, [FrustumCorner.FarBottomRight, FrustumCorner.FarBottomLeft]/* far */, [FrustumCorner.FarBottomLeft, FrustumCorner.nearBottomLeft]/* left */, [FrustumCorner.nearBottomRight, FrustumCorner.FarBottomRight]/* right */, [FrustumCorner.unknown, FrustumCorner.unknown]/* bottom */, [FrustumCorner.unknown, FrustumCorner.unknown]/* top */],// bottom\r\n        [[FrustumCorner.nearTopRight, FrustumCorner.nearTopLeft]/* near */, [FrustumCorner.FarTopLeft, FrustumCorner.FarTopRight]/* far */, [FrustumCorner.nearTopLeft, FrustumCorner.FarTopLeft]/* left */, [FrustumCorner.FarTopRight, FrustumCorner.nearTopRight], [FrustumCorner.unknown/* right */, FrustumCorner.unknown]/* bottom */, [FrustumCorner.unknown, FrustumCorner.unknown]/* top */]// top\r\n    ];\r\n\r\n    /** @internal */\r\n    static readonly atlasBorderSize: number = 4.0;//now max shadow sample tent is 5x5,atlas borderSize at leate 3=ceil(2.5),and +1 pixle is for global border for no cascade mode.\r\n\r\n    static init() {\r\n        ShadowUtils._adjustNearPlane = new Plane(new Vector3(), 0);\r\n        ShadowUtils._adjustFarPlane = new Plane(new Vector3(), 0);\r\n    }\r\n\r\n    /**\r\n    * @internal\r\n    */\r\n    static supportShadow(): boolean {\r\n        return LayaGL.renderEngine.getCapable(RenderCapable.RenderTextureFormat_Depth);\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    static getTemporaryShadowTexture(witdh: number, height: number, shadowFormat: ShadowMapFormat): RenderTexture {\r\n        let depthFormat = RenderTargetFormat.DEPTH_16;\r\n        switch (shadowFormat) {\r\n            case ShadowMapFormat.bit16:\r\n                depthFormat = RenderTargetFormat.DEPTH_16;\r\n                break;\r\n            case ShadowMapFormat.bit24_8:\r\n                depthFormat = RenderTargetFormat.DEPTHSTENCIL_24_8;\r\n                break;\r\n            case ShadowMapFormat.bit32:\r\n                depthFormat = RenderTargetFormat.DEPTH_32;\r\n                break;\r\n        }\r\n\r\n        var shadowMap: RenderTexture = RenderTexture.createFromPool(witdh, height, depthFormat, RenderTargetFormat.None, false, 1);\r\n        shadowMap.compareMode = TextureCompareMode.LESS;\r\n        shadowMap.filterMode = FilterMode.Bilinear;\r\n        shadowMap.wrapModeU = WrapMode.Clamp;\r\n        shadowMap.wrapModeV = WrapMode.Clamp;\r\n        return shadowMap;\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    static getShadowBias(light: Light, shadowProjectionMatrix: Matrix4x4, shadowResolution: number, out: Vector4): void {\r\n        var frustumSize: number;\r\n        if (light._lightType == LightType.Directional) {\r\n            // Frustum size is guaranteed to be a cube as we wrap shadow frustum around a sphere\r\n            // elements[0] = 2.0 / (right - left)\r\n            frustumSize = 2.0 / shadowProjectionMatrix.elements[0];\r\n        }\r\n        else if (light._lightType == LightType.Spot) {\r\n            // For perspective projections, shadow texel size varies with depth\r\n            // It will only work well if done in receiver side in the pixel shader. Currently We\r\n            // do bias on caster side in vertex shader. When we add shader quality tiers we can properly\r\n            // handle this. For now, as a poor approximation we do a constant bias and compute the size of\r\n            // the frustum as if it was orthogonal considering the size at mid point between near and far planes.\r\n            // Depending on how big the light range is, it will be good enough with some tweaks in bias\r\n            frustumSize = Math.tan((<SpotLightCom>light).spotAngle * 0.5 * MathUtils3D.Deg2Rad) * (<SpotLightCom>light).range;\r\n        }\r\n        else {\r\n            console.warn(\"ShadowUtils:Only spot and directional shadow casters are supported now.\");\r\n            frustumSize = 0.0;\r\n        }\r\n\r\n        // depth and normal bias scale is in shadowmap texel size in world space\r\n        var texelSize: number = frustumSize / shadowResolution;\r\n        var depthBias: number = -light._shadowDepthBias * texelSize;\r\n        var normalBias: number = -light._shadowNormalBias * texelSize;\r\n\r\n        if (light.shadowMode == ShadowMode.SoftHigh) {\r\n            // TODO: depth and normal bias assume sample is no more than 1 texel away from shadowmap\r\n            // This is not true with PCF. Ideally we need to do either\r\n            // cone base bias (based on distance to center sample)\r\n            // or receiver place bias based on derivatives.\r\n            // For now we scale it by the PCF kernel size (5x5)\r\n            const kernelRadius: number = 2.5;\r\n            depthBias *= kernelRadius;\r\n            normalBias *= kernelRadius;\r\n        }\r\n        out.setValue(depthBias, normalBias, 0.0, 0.0);\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    static getCameraFrustumPlanes(cameraViewProjectMatrix: Matrix4x4, frustumPlanes: Plane[]): void {\r\n        BoundFrustum.getPlanesFromMatrix(cameraViewProjectMatrix, frustumPlanes[FrustumFace.Near], frustumPlanes[FrustumFace.Far], frustumPlanes[FrustumFace.Left], frustumPlanes[FrustumFace.Right], frustumPlanes[FrustumFace.Top], frustumPlanes[FrustumFace.Bottom]);\r\n    }\r\n\r\n    /**\r\n    * @internal\r\n    */\r\n    static getFarWithRadius(radius: number, denominator: number): number {\r\n        // use the frustum side as the radius and get the far distance form camera.\r\n        // var tFov: number = Math.tan(fov * 0.5);// get this the equation using Pythagorean\r\n        // return Math.sqrt(radius * radius / (1.0 + tFov * tFov * (aspectRatio * aspectRatio + 1.0)));\r\n        return Math.sqrt(radius * radius / denominator);\r\n    }\r\n\r\n    /**\r\n    * @internal\r\n    */\r\n    static getCascadesSplitDistance(twoSplitRatio: number, fourSplitRatio: Vector3, cameraNear: number, shadowFar: number, fov: number, aspectRatio: number, cascadesMode: ShadowCascadesMode, out: number[]): void {\r\n        out[0] = cameraNear;\r\n        var range: number = shadowFar - cameraNear;\r\n        var tFov: number = Math.tan(fov * 0.5);\r\n        var denominator: number = 1.0 + tFov * tFov * (aspectRatio * aspectRatio + 1.0);\r\n        switch (cascadesMode) {\r\n            case ShadowCascadesMode.NoCascades:\r\n                out[1] = ShadowUtils.getFarWithRadius(shadowFar, denominator);\r\n                break;\r\n            case ShadowCascadesMode.TwoCascades:\r\n                out[1] = ShadowUtils.getFarWithRadius(cameraNear + range * twoSplitRatio, denominator);\r\n                out[2] = ShadowUtils.getFarWithRadius(shadowFar, denominator);\r\n                break;\r\n            case ShadowCascadesMode.FourCascades:\r\n                out[1] = ShadowUtils.getFarWithRadius(cameraNear + range * fourSplitRatio.x, denominator);\r\n                out[2] = ShadowUtils.getFarWithRadius(cameraNear + range * fourSplitRatio.y, denominator);\r\n                out[3] = ShadowUtils.getFarWithRadius(cameraNear + range * fourSplitRatio.z, denominator);\r\n                out[4] = ShadowUtils.getFarWithRadius(shadowFar, denominator);\r\n                break;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    static applySliceTransform(shadowSliceData: ShadowSliceData, atlasWidth: number, atlasHeight: number, cascadeIndex: number, outShadowMatrices: Float32Array): void {\r\n        // Apply shadow slice scale and offset\r\n        var sliceE: Float32Array = ShadowUtils._tempMatrix0.elements;\r\n        var oneOverAtlasWidth: number = 1.0 / atlasWidth;\r\n        var oneOverAtlasHeight: number = 1.0 / atlasHeight;\r\n\r\n        sliceE[0] = shadowSliceData.resolution * oneOverAtlasWidth;//scale\r\n        sliceE[5] = shadowSliceData.resolution * oneOverAtlasHeight;\r\n        sliceE[12] = shadowSliceData.offsetX * oneOverAtlasWidth;//offset\r\n        sliceE[13] = shadowSliceData.offsetY * oneOverAtlasHeight;\r\n        sliceE[1] = sliceE[2] = sliceE[2] = sliceE[4] = sliceE[6] = sliceE[7] = sliceE[8] = sliceE[9] = sliceE[11] = sliceE[14] = 0;\r\n        sliceE[10] = sliceE[15] = 1;\r\n\r\n        var offset: number = cascadeIndex * 16;\r\n        Utils3D._mulMatrixArray(sliceE, outShadowMatrices, offset, outShadowMatrices, offset);\r\n    }\r\n\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    static getDirectionLightShadowCullPlanes(cameraFrustumPlanes: Array<Plane>, cascadeIndex: number, splitDistance: number[], cameraNear: number, direction: Vector3, shadowSliceData: ShadowSliceData): void {\r\n        // http://lspiroengine.com/?p=187\r\n        var frustumCorners: Vector3[] = ShadowUtils._frustumCorners;\r\n        var backPlaneFaces: FrustumFace[] = ShadowUtils._backPlaneFaces;\r\n        var planeNeighbors: FrustumFace[][] = ShadowUtils._frustumPlaneNeighbors;\r\n        var twoPlaneCorners: FrustumCorner[][][] = ShadowUtils._frustumTwoPlaneCorners;\r\n        var edgePlanePoint2: Vector3 = ShadowUtils._edgePlanePoint2;\r\n        var out: Plane[] = shadowSliceData.cullPlanes;\r\n\r\n        // cameraFrustumPlanes is share\r\n        var near: Plane = cameraFrustumPlanes[FrustumFace.Near], far: Plane = cameraFrustumPlanes[FrustumFace.Far];\r\n        var left: Plane = cameraFrustumPlanes[FrustumFace.Left], right: Plane = cameraFrustumPlanes[FrustumFace.Right];\r\n        var bottom: Plane = cameraFrustumPlanes[FrustumFace.Bottom], top: Plane = cameraFrustumPlanes[FrustumFace.Top];\r\n\r\n        // adjustment the near/far plane\r\n        var splitNearDistance: number = splitDistance[cascadeIndex] - cameraNear;\r\n        var splitNear: Plane = ShadowUtils._adjustNearPlane;\r\n        var splitFar: Plane = ShadowUtils._adjustFarPlane;\r\n        splitNear.normal = near.normal;\r\n        splitFar.normal = far.normal;\r\n        splitNear.distance = near.distance - splitNearDistance;\r\n        splitFar.distance = Math.min(-near.distance + shadowSliceData.sphereCenterZ + shadowSliceData.splitBoundSphere.radius, far.distance);//do a clamp is the sphere is out of range the far plane\r\n\r\n        BoundFrustum.get3PlaneInterPoint(splitNear, bottom, right, frustumCorners[FrustumCorner.nearBottomRight]);\r\n        BoundFrustum.get3PlaneInterPoint(splitNear, top, right, frustumCorners[FrustumCorner.nearTopRight]);\r\n        BoundFrustum.get3PlaneInterPoint(splitNear, top, left, frustumCorners[FrustumCorner.nearTopLeft]);\r\n        BoundFrustum.get3PlaneInterPoint(splitNear, bottom, left, frustumCorners[FrustumCorner.nearBottomLeft]);\r\n        BoundFrustum.get3PlaneInterPoint(splitFar, bottom, right, frustumCorners[FrustumCorner.FarBottomRight]);\r\n        BoundFrustum.get3PlaneInterPoint(splitFar, top, right, frustumCorners[FrustumCorner.FarTopRight]);\r\n        BoundFrustum.get3PlaneInterPoint(splitFar, top, left, frustumCorners[FrustumCorner.FarTopLeft]);\r\n        BoundFrustum.get3PlaneInterPoint(splitFar, bottom, left, frustumCorners[FrustumCorner.FarBottomLeft]);\r\n\r\n        var backIndex: number = 0;\r\n        for (var i: FrustumFace = 0; i < 6; i++) {// meybe 345(light eye is at far, forward is near, or orth camera is any axis)\r\n            var plane: Plane;\r\n            switch (i) {\r\n                case FrustumFace.Near:\r\n                    plane = splitNear;\r\n                    break;\r\n                case FrustumFace.Far:\r\n                    plane = splitFar;\r\n                    break;\r\n                default:\r\n                    plane = cameraFrustumPlanes[i];\r\n                    break;\r\n            }\r\n            if (Vector3.dot(plane.normal, direction) < 0.0) {\r\n                plane.cloneTo(out[backIndex]);\r\n                backPlaneFaces[backIndex] = i;\r\n                backIndex++;\r\n            }\r\n        }\r\n\r\n        var edgeIndex: number = backIndex;\r\n        for (var i: FrustumFace = 0; i < backIndex; i++) {\r\n            var backFace: FrustumFace = backPlaneFaces[i];\r\n            var neighborFaces: Array<FrustumFace> = planeNeighbors[backFace];\r\n            for (var j: number = 0; j < 4; j++) {\r\n                var neighborFace: FrustumFace = neighborFaces[j];\r\n                var notBackFace: boolean = true;\r\n                for (var k: number = 0; k < backIndex; k++)\r\n                    if (neighborFace == backPlaneFaces[k]) {\r\n                        notBackFace = false;\r\n                        break;\r\n                    }\r\n                if (notBackFace) {\r\n                    var corners: Array<FrustumCorner> = twoPlaneCorners[backFace][neighborFace];\r\n                    var point0: Vector3 = frustumCorners[corners[0]];\r\n                    var point1: Vector3 = frustumCorners[corners[1]];\r\n                    Vector3.add(point0, direction, edgePlanePoint2);\r\n                    Plane.createPlaneBy3P(point0, point1, edgePlanePoint2, out[edgeIndex++]);\r\n                }\r\n            }\r\n        }\r\n        shadowSliceData.cullPlaneCount = edgeIndex;\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    static getBoundSphereByFrustum(near: number, far: number, fov: number, aspectRatio: number, cameraPos: Vector3, forward: Vector3, outBoundSphere: BoundSphere): number {\r\n        // https://lxjk.github.io/2017/04/15/Calculate-Minimal-Bounding-Sphere-of-Frustum.html\r\n        var centerZ: number;\r\n        var radius: number;\r\n        var k: number = Math.sqrt(1.0 + aspectRatio * aspectRatio) * Math.tan(fov / 2.0);\r\n        var k2: number = k * k;\r\n        var farSNear: number = far - near;\r\n        var farANear: number = far + near;\r\n        if (k2 > farSNear / farANear) {\r\n            centerZ = far;\r\n            radius = far * k;\r\n        }\r\n        else {\r\n            centerZ = 0.5 * farANear * (1 + k2);\r\n            radius = 0.5 * Math.sqrt(farSNear * farSNear + 2.0 * (far * far + near * near) * k2 + farANear * farANear * k2 * k2);\r\n        }\r\n\r\n        var center: Vector3 = outBoundSphere.center;\r\n        outBoundSphere.radius = radius;\r\n        Vector3.scale(forward, centerZ, center);\r\n        Vector3.add(cameraPos, center, center);\r\n        outBoundSphere.center = center;\r\n        return centerZ;\r\n    }\r\n\r\n    /**\r\n     * @inernal\r\n     */\r\n    static getMaxTileResolutionInAtlas(atlasWidth: number, atlasHeight: number, tileCount: number): number {\r\n        var resolution: number = Math.min(atlasWidth, atlasHeight);\r\n        var currentTileCount: number = Math.floor(atlasWidth / resolution) * Math.floor(atlasHeight / resolution);\r\n        while (currentTileCount < tileCount) {\r\n            resolution = Math.floor(resolution >> 1);\r\n            currentTileCount = Math.floor(atlasWidth / resolution) * Math.floor(atlasHeight / resolution);\r\n        }\r\n        return resolution;\r\n    }\r\n\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    static getDirectionalLightMatrices(lightUp: Vector3, lightSide: Vector3, lightForward: Vector3, cascadeIndex: number, nearPlane: number, shadowResolution: number, shadowSliceData: ShadowSliceData, shadowMatrices: Float32Array): void {\r\n        var boundSphere: BoundSphere = shadowSliceData.splitBoundSphere;\r\n\r\n        // To solve shdow swimming problem.\r\n        var center: Vector3 = boundSphere.center;\r\n        var radius: number = boundSphere.radius;\r\n        var halfShadowResolution: number = shadowResolution / 2;\r\n        // Add border to prject edge pixel PCF.\r\n        // Improve:the clip planes not conside the border,but I think is OK,because the object can clip is not continuous.\r\n        var borderRadius: number = radius * halfShadowResolution / (halfShadowResolution - ShadowUtils.atlasBorderSize);\r\n        var borderDiam: number = borderRadius * 2.0;\r\n        var sizeUnit: number = shadowResolution / borderDiam;\r\n        var radiusUnit: number = borderDiam / shadowResolution;\r\n        var upLen: number = Math.ceil(Vector3.dot(center, lightUp) * sizeUnit) * radiusUnit;\r\n        var sideLen: number = Math.ceil(Vector3.dot(center, lightSide) * sizeUnit) * radiusUnit;\r\n        var forwardLen: number = Vector3.dot(center, lightForward);\r\n        center.x = lightUp.x * upLen + lightSide.x * sideLen + lightForward.x * forwardLen;\r\n        center.y = lightUp.y * upLen + lightSide.y * sideLen + lightForward.y * forwardLen;\r\n        center.z = lightUp.z * upLen + lightSide.z * sideLen + lightForward.z * forwardLen;\r\n        boundSphere.center = center;\r\n\r\n        // Direction light use shadow pancaking tech,do special dispose with nearPlane.\r\n        var origin: Vector3 = shadowSliceData.position;\r\n        var viewMatrix: Matrix4x4 = shadowSliceData.viewMatrix;\r\n        var projectMatrix: Matrix4x4 = shadowSliceData.projectionMatrix;\r\n        var viewProjectMatrix: Matrix4x4 = shadowSliceData.viewProjectMatrix;\r\n\r\n        shadowSliceData.resolution = shadowResolution;\r\n        shadowSliceData.offsetX = (cascadeIndex % 2) * shadowResolution;\r\n        shadowSliceData.offsetY = Math.floor(cascadeIndex / 2) * shadowResolution;\r\n\r\n        Vector3.scale(lightForward, radius + nearPlane, origin);\r\n        Vector3.subtract(center, origin, origin);\r\n        Matrix4x4.createLookAt(origin, center, lightUp, viewMatrix);\r\n        Matrix4x4.createOrthoOffCenter(- borderRadius, borderRadius, - borderRadius, borderRadius, 0.0, radius * 2.0 + nearPlane, projectMatrix);\r\n        Matrix4x4.multiply(projectMatrix, viewMatrix, viewProjectMatrix);\r\n        Utils3D._mulMatrixArray(ShadowUtils._shadowMapScaleOffsetMatrix.elements, viewProjectMatrix.elements, 0, shadowMatrices, cascadeIndex * 16);\r\n    }\r\n\r\n    /** \r\n    * @internal\r\n    */\r\n    static getSpotLightShadowData(shadowSpotData: ShadowSpotData, spotLight: SpotLightCom, resolution: number, shadowParams: Vector4, shadowSpotMatrices: Matrix4x4, shadowMapSize: Vector4) {\r\n        var out: Vector3 = shadowSpotData.position = (spotLight.owner as Sprite3D).transform.position;\r\n        shadowSpotData.resolution = resolution;\r\n        shadowMapSize.setValue(1.0 / resolution, 1.0 / resolution, resolution, resolution);\r\n        shadowSpotData.offsetX = 0;\r\n        shadowSpotData.offsetY = 0;\r\n\r\n        var spotWorldMatrix: Matrix4x4 = spotLight.lightWorldMatrix;\r\n        var viewMatrix: Matrix4x4 = shadowSpotData.viewMatrix;\r\n        var projectMatrix: Matrix4x4 = shadowSpotData.projectionMatrix;\r\n        var viewProjectMatrix: Matrix4x4 = shadowSpotData.viewProjectMatrix;\r\n        var BoundFrustum: BoundFrustum = shadowSpotData.cameraCullInfo.boundFrustum;\r\n        spotWorldMatrix.invert(viewMatrix);\r\n        Matrix4x4.createPerspective(3.1416 * spotLight.spotAngle / 180.0, 1, 0.1, spotLight.range, projectMatrix);\r\n        shadowParams.y = spotLight.shadowStrength;\r\n        Matrix4x4.multiply(projectMatrix, viewMatrix, viewProjectMatrix);\r\n        BoundFrustum.matrix = viewProjectMatrix;\r\n        viewProjectMatrix.cloneTo(shadowSpotMatrices);\r\n        shadowSpotData.cameraCullInfo.position = out;\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    static prepareShadowReceiverShaderValues(light: DirectionLightCom, shadowMapWidth: number, shadowMapHeight: number, shadowSliceDatas: ShadowSliceData[], cascadeCount: number, shadowMapSize: Vector4, shadowParams: Vector4, shadowMatrices: Float32Array, splitBoundSpheres: Float32Array): void {\r\n        shadowMapSize.setValue(1.0 / shadowMapWidth, 1.0 / shadowMapHeight, shadowMapWidth, shadowMapHeight);\r\n        shadowParams.setValue(light._shadowStrength, 0.0, 0.0, 0.0);\r\n        if (cascadeCount > 1) {\r\n            const matrixFloatCount: number = 16;\r\n            for (var i: number = cascadeCount * matrixFloatCount, n: number = 4 * matrixFloatCount; i < n; i++)//the last matrix is always ZERO\r\n                shadowMatrices[i] = 0.0;//set Matrix4x4.ZERO to project the cascade index is 4\r\n\r\n            for (var i: number = 0; i < cascadeCount; i++) {\r\n                var boundSphere: BoundSphere = shadowSliceDatas[i].splitBoundSphere;\r\n                var center: Vector3 = boundSphere.center;\r\n                var radius: number = boundSphere.radius;\r\n                var offset: number = i * 4;\r\n                splitBoundSpheres[offset] = center.x;\r\n                splitBoundSpheres[offset + 1] = center.y;\r\n                splitBoundSpheres[offset + 2] = center.z;\r\n                splitBoundSpheres[offset + 3] = radius * radius;\r\n            }\r\n            const sphereFloatCount: number = 4;\r\n            for (var i: number = cascadeCount * sphereFloatCount, n: number = 4 * sphereFloatCount; i < n; i++)\r\n                splitBoundSpheres[i] = 0.0;//set Matrix4x4.ZERO to project the cascade index is 4\r\n        }\r\n    }\r\n}","/**\r\n * Shadow Light enum\r\n */\r\n export enum ShadowLightType {\r\n    /** */\r\n    DirectionLight,\r\n    /** */\r\n    SpotLight,\r\n    /** */\r\n    PointLight\r\n}","import { Scene3D } from \"./laya/d3/core/scene/Scene3D\";\r\nimport { Laya3D } from \"./Laya3D\";\r\n\r\n/**\r\n * @internal\r\n * \r\n */\r\nexport class ILaya3D {\r\n    static Scene3D: typeof Scene3D = null;\r\n    static Laya3D: typeof Laya3D = null;\r\n}\r\n","import { Config3D } from \"../../../../Config3D\";\r\nimport { Matrix4x4 } from \"../../../maths/Matrix4x4\";\r\nimport { Vector2 } from \"../../../maths/Vector2\";\r\nimport { Vector3 } from \"../../../maths/Vector3\";\r\nimport { Texture2D } from \"../../../resource/Texture2D\";\r\nimport { Camera } from \"../../core/Camera\";\r\nimport { LightQueue } from \"../../core/light/LightQueue\";\r\nimport { PointLightCom } from \"../../core/light/PointLightCom\";\r\nimport { SpotLightCom } from \"../../core/light/SpotLightCom\";\r\nimport { Scene3D } from \"../../core/scene/Scene3D\";\r\nimport { Sprite3D } from \"../../core/Sprite3D\";\r\n\r\nimport { Utils3D } from \"../../utils/Utils3D\";\r\n\r\n/**\r\n * @internal\r\n */\r\nclass LightBound {\r\n    xMin: number;\r\n    xMax: number;\r\n    yMin: number;\r\n    yMax: number;\r\n    zMin: number;\r\n    zMax: number;\r\n}\r\n\r\n/**\r\n * @internal\r\n */\r\nclass ClusterData {\r\n    updateMark: number = -1;\r\n    pointLightCount: number = 0;\r\n    spotLightCount: number = 0;\r\n    indices: number[] = [];\r\n}\r\n\r\n/**\r\n * @internal\r\n */\r\nexport class Cluster {\r\n    private static _tempVector30: Vector3 = new Vector3();\r\n    private static _tempVector31: Vector3 = new Vector3();\r\n    private static _tempVector32: Vector3 = new Vector3();\r\n    private static _tempVector33: Vector3 = new Vector3();\r\n    private static _tempVector34: Vector3 = new Vector3();\r\n    private static _tempVector35: Vector3 = new Vector3();\r\n    private static _tempVector36: Vector3 = new Vector3();\r\n    private static _tempVector37: Vector3 = new Vector3();\r\n    private static _tempLightBound: LightBound = new LightBound();\r\n\r\n    static instance: Cluster;\r\n\r\n    private _xSlices: number;\r\n    private _ySlices: number;\r\n    private _zSlices: number;\r\n    private _clusterDatas: ClusterData[][][];\r\n    private _clusterPixels: Float32Array;\r\n    private _updateMark: number = 0;\r\n    private _depthSliceParam: Vector2 = new Vector2();\r\n\r\n    public _clusterTexture: Texture2D;\r\n\r\n    constructor(xSlices: number, ySlices: number, zSlices: number, maxLightsPerClusterAverage: number) {\r\n        this._xSlices = xSlices;\r\n        this._ySlices = ySlices;\r\n        this._zSlices = zSlices;\r\n        var clusterTexWidth: number = xSlices * ySlices;\r\n        var clisterTexHeight: number = zSlices * (1 + Math.ceil(maxLightsPerClusterAverage / 4));\r\n        this._clusterTexture = Utils3D._createFloatTextureBuffer(clusterTexWidth, clisterTexHeight);\r\n        this._clusterTexture.lock = true;\r\n        this._clusterPixels = new Float32Array(clusterTexWidth * clisterTexHeight * 4);\r\n\r\n        //Init for every cluster\r\n        var clusterDatas: ClusterData[][][] = new Array<Array<Array<ClusterData>>>(this._zSlices);\r\n        for (var z = 0; z < this._zSlices; z++) {\r\n            clusterDatas[z] = new Array<Array<ClusterData>>(this._ySlices);\r\n            for (var y = 0; y < this._ySlices; y++) {\r\n                clusterDatas[z][y] = new Array<ClusterData>(this._xSlices);\r\n                for (var x = 0; x < this._xSlices; x++)\r\n                    clusterDatas[z][y][x] = new ClusterData();\r\n            }\r\n        }\r\n        this._clusterDatas = clusterDatas;\r\n\r\n        /*\r\n        Layout of clusterTexture\r\n        |------------------------------------------------------U(XY)\r\n        |               cluster0               cluster1       \r\n        |        (PCou|SCou|Off0|Off1) | (PCou|SCou|Off0|Off1) \r\n        |               cluster2               cluster3      \r\n        |        (PCou|SCou|Off0|Off1) | (PCou|SCou|Off0|Off1) \r\n        |-----------------------------------------------------------\r\n        |                                    _                              \r\n        |        (poi0|poi1|spo0|spo1) |(spo2|poi0|poi1|poi2)\r\n        |             _\r\n        |        (poi3|spo0|....|....) |(....|....|....|....) \r\n        |\r\n        V(Z)\r\n        */\r\n    }\r\n\r\n    // private _insertSpotLightSphere(origin: Vector3, forward: Vector3, size: number, angle: number, testSphere: Vector4): boolean {\r\n    //     //combine cone cull and sphere range cull\r\n    //     var V: Vector3 = Cluster._tempVector35;\r\n    //     V.x = testSphere.x - origin.x;\r\n    //     V.y = testSphere.y - origin.y;\r\n    //     V.z = testSphere.z - origin.z;\r\n\r\n    //     var VlenSq = Vector3.dot(V, V);\r\n    //     var sphereRadius: number = testSphere.w;\r\n\r\n    //     var rangeCull: boolean = VlenSq > sphereRadius * sphereRadius;\r\n    //     if (!rangeCull)\r\n    //         return false;\r\n\r\n    //     var V1len: number = Vector3.dot(V, forward);\r\n    //     var distanceClosestPoint: number = Math.cos(angle) * Math.sqrt(VlenSq - V1len * V1len) - V1len * Math.sin(angle);\r\n\r\n    //     var angleCull: boolean = distanceClosestPoint > sphereRadius;\r\n    //     var frontCull: boolean = V1len > sphereRadius + size;\r\n    //     var backCull: boolean = V1len < -sphereRadius;\r\n    //     return !(angleCull || frontCull || backCull);\r\n    // }\r\n\r\n    private _placePointLightToClusters(lightIndex: number, lightBound: LightBound): void {\r\n        var clusterDatas: ClusterData[][][] = this._clusterDatas;\r\n        var updateMark: number = this._updateMark;\r\n        for (var z: number = lightBound.zMin, zEnd: number = lightBound.zMax; z < zEnd; z++) {\r\n            for (var y: number = lightBound.yMin, yEnd: number = lightBound.yMax; y < yEnd; y++) {\r\n                for (var x: number = lightBound.xMin, xEnd: number = lightBound.xMax; x < xEnd; x++) {\r\n                    var data: ClusterData = clusterDatas[z][y][x];\r\n                    if (data.updateMark != updateMark) {\r\n                        data.pointLightCount = 0;\r\n                        data.spotLightCount = 0;\r\n                        data.updateMark = updateMark;\r\n                    }\r\n                    var indices: number[] = data.indices;\r\n                    var lightCount: number = data.pointLightCount++;\r\n                    if (lightCount < indices.length)\r\n                        indices[lightCount] = lightIndex;\r\n                    else\r\n                        indices.push(lightIndex);\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    private _placeSpotLightToClusters(lightIndex: number, lightBound: LightBound): void {\r\n        var clusterDatas: ClusterData[][][] = this._clusterDatas;\r\n        var updateMark: number = this._updateMark;\r\n        for (var z: number = lightBound.zMin, zEnd: number = lightBound.zMax; z < zEnd; z++) {\r\n            for (var y: number = lightBound.yMin, yEnd: number = lightBound.yMax; y < yEnd; y++) {\r\n                for (var x: number = lightBound.xMin, xEnd: number = lightBound.xMax; x < xEnd; x++) {\r\n                    var data: ClusterData = clusterDatas[z][y][x];\r\n                    if (data.updateMark != updateMark) {\r\n                        data.pointLightCount = 0;\r\n                        data.spotLightCount = 0;\r\n                        data.updateMark = updateMark;\r\n                    }\r\n                    var indices: number[] = data.indices;\r\n                    var lightCount: number = data.pointLightCount + data.spotLightCount++;\r\n                    if (lightCount < indices.length)\r\n                        indices[lightCount] = lightIndex;\r\n                    else\r\n                        indices.push(lightIndex);\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n\r\n    private _insertConePlane(origin: Vector3, forward: Vector3, radius: number, halfAngle: number, pNor: Vector3): boolean {\r\n        //https://bartwronski.com/2017/04/13/cull-that-cone/\r\n        //because distance is always zero so we ease this method\r\n        var V1: Vector3 = Cluster._tempVector36;\r\n        var V2: Vector3 = Cluster._tempVector37;\r\n        Vector3.cross(pNor, forward, V1);\r\n        Vector3.cross(V1, forward, V2);\r\n        Vector3.normalize(V2, V2);\r\n        var tanR: number = radius * Math.tan(halfAngle);\r\n        var capRimX: number = origin.x + radius * forward.x + tanR * V2.x;\r\n        var capRimY: number = origin.y + radius * forward.y + tanR * V2.y;\r\n        var capRimZ: number = origin.z + radius * forward.z + tanR * V2.z;\r\n\r\n        return capRimX * pNor.x + capRimY * pNor.y + capRimZ * pNor.z <= 0 || origin.x * pNor.x + origin.y * pNor.y + origin.z * pNor.z <= 0;\r\n    }\r\n\r\n\r\n    private _shrinkSphereLightZPerspective(near: number, far: number, lightviewPos: Vector3, radius: number, lightBound: LightBound): boolean {\r\n        var lvZ: number = lightviewPos.z;\r\n        var minZ: number = lvZ - radius;\r\n        var maxZ: number = lvZ + radius;\r\n\r\n        if ((minZ > far) || (maxZ <= near))\r\n            return false;\r\n        // slice = Math.log2(z) * (numSlices / Math.log2(far / near)) - Math.log2(near) * numSlices / Math.log2(far / near)\r\n        // slice start from near plane,near is index:0,z must large than near,or the result will NaN\r\n        var depthSliceParam: Vector2 = this._depthSliceParam;\r\n        lightBound.zMin = Math.floor(Math.log2(Math.max(minZ, near)) * depthSliceParam.x - depthSliceParam.y);\r\n        lightBound.zMax = Math.min(Math.ceil(Math.log2(maxZ) * depthSliceParam.x - depthSliceParam.y), this._zSlices);\r\n        return true;\r\n    }\r\n\r\n    private _shrinkSpotLightZPerspective(near: number, far: number, viewLightPos: Vector3, viewConeCap: Vector3, radius: number, halfAngle: number, lightBound: LightBound): boolean {\r\n        //https://bartwronski.com/2017/04/13/cull-that-cone/\r\n        //http://www.iquilezles.org/www/articles/diskbbox/diskbbox.htm\r\n\r\n        var pbX: number = viewConeCap.x, pbY: number = viewConeCap.y, pbZ: number = viewConeCap.z;\r\n        var rb: number = Math.tan(halfAngle) * radius;\r\n        var paX: number = viewLightPos.x, paY: number = viewLightPos.y, paZ: number = viewLightPos.z;\r\n        var aX: number = pbX - paX, aY: number = pbY - paY, aZ: number = pbZ - paZ;\r\n        var dotA: number = aX * aX + aY * aY + aZ * aZ;\r\n        var eZ: number = Math.sqrt(1.0 - aZ * aZ / dotA);\r\n\r\n        //flat-capped cone is not spotLight shape,spoltlight is sphere-capped.so we get the common boundBox of flat-capped cone bounds and sphere bounds.\r\n        var minZ: number = Math.max(Math.min(paZ, pbZ - eZ * rb), viewLightPos.z - radius);\r\n        var maxZ: number = Math.min(Math.max(paZ, pbZ + eZ * rb), viewLightPos.z + radius);\r\n\r\n        if ((minZ > far) || (maxZ <= near))\r\n            return false;\r\n        // slice = Math.log2(z) * (numSlices / Math.log2(far / near)) - Math.log2(near) * numSlices / Math.log2(far / near)\r\n        // slice start from near plane,near is index:0,z must large than near,or the result will NaN\r\n        var depthSliceParam: Vector2 = this._depthSliceParam;\r\n        lightBound.zMin = Math.floor(Math.log2(Math.max(minZ, near)) * depthSliceParam.x - depthSliceParam.y);\r\n        lightBound.zMax = Math.min(Math.ceil(Math.log2(maxZ) * depthSliceParam.x - depthSliceParam.y), this._zSlices);\r\n        return true;\r\n    }\r\n\r\n    private _shrinkSphereLightByBoundOrth(halfX: number, halfY: number, near: number, far: number, lightviewPos: Vector3, radius: number, lightBound: LightBound): boolean {\r\n        var lvZ: number = lightviewPos.z;\r\n        var minZ: number = lvZ - radius, maxZ: number = lvZ + radius;\r\n        if ((minZ > far) || (maxZ <= near))\r\n            return false;\r\n        var lvX: number = lightviewPos.x;\r\n        var minX: number = lvX - radius, maxX: number = lvX + radius;\r\n        if ((minX > halfX) || (maxX <= -halfX))\r\n            return false;\r\n        var lvY: number = lightviewPos.y;\r\n        var minY: number = lvY - radius, maxY: number = lvY + radius;\r\n        if ((minY > halfY) || (maxY <= -halfY))\r\n            return false;\r\n\r\n        // slice = Math.log2(z) * (numSlices / Math.log2(far / near)) - Math.log2(near) * numSlices / Math.log2(far / near)\r\n        // slice start from near plane,near is index:0,z must large than near,or the result will NaN\r\n        var xSlices: number = this._xSlices, ySlices: number = this._ySlices;\r\n        var depthSliceParam: Vector2 = this._depthSliceParam;\r\n        var xStride: number = halfX * 2 / xSlices, yStride: number = halfY * 2 / ySlices;\r\n        lightBound.xMin = Math.max(Math.floor((minX + halfX) / xStride), 0);\r\n        lightBound.xMax = Math.min(Math.ceil((maxX + halfX) / xStride), xSlices);\r\n        lightBound.yMin = Math.max(Math.floor((halfY - maxY) / yStride), 0);//zero is from top\r\n        lightBound.yMax = Math.min(Math.ceil((halfY - minY) / yStride), ySlices);\r\n        lightBound.zMin = Math.floor(Math.log2(Math.max(minZ, near)) * depthSliceParam.x - depthSliceParam.y);\r\n        lightBound.zMax = Math.min(Math.ceil(Math.log2(maxZ) * depthSliceParam.x - depthSliceParam.y), this._zSlices);\r\n        return true;\r\n    }\r\n\r\n    private _shrinkSpotLightByBoundOrth(halfX: number, halfY: number, near: number, far: number, viewLightPos: Vector3, viewConeCap: Vector3, radius: number, halfAngle: number, lightBound: LightBound): boolean {\r\n        //https://bartwronski.com/2017/04/13/cull-that-cone/\r\n        //http://www.iquilezles.org/www/articles/diskbbox/diskbbox.htm\r\n        var pbX: number = viewConeCap.x, pbY: number = viewConeCap.y, pbZ: number = viewConeCap.z;\r\n        var rb: number = Math.tan(halfAngle) * radius;\r\n        var paX: number = viewLightPos.x, paY: number = viewLightPos.y, paZ: number = viewLightPos.z;\r\n        var aX: number = pbX - paX, aY: number = pbY - paY, aZ: number = pbZ - paZ;\r\n        var dotA: number = aX * aX + aY * aY + aZ * aZ;\r\n\r\n        //flat-capped cone is not spotLight shape,spoltlight is sphere-capped.so we get the common boundBox of flat-capped cone bounds and sphere bounds.\r\n        var eZ: number = Math.sqrt(1.0 - aZ * aZ / dotA);\r\n        var minZ: number = Math.max(Math.min(paZ, pbZ - eZ * rb), viewLightPos.z - radius);\r\n        var maxZ: number = Math.min(Math.max(paZ, pbZ + eZ * rb), viewLightPos.z + radius);\r\n        if ((minZ > far) || (maxZ <= near))\r\n            return false;\r\n        var eX: number = Math.sqrt(1.0 - aX * aX / dotA);\r\n        var minX: number = Math.max(Math.min(paX, pbX - eX * rb), viewLightPos.x - radius);\r\n        var maxX: number = Math.min(Math.max(paX, pbX + eX * rb), viewLightPos.x + radius);\r\n        if ((minX > halfX) || (maxX <= -halfX))\r\n            return false;\r\n        var eY: number = Math.sqrt(1.0 - aY * aY / dotA);\r\n        var minY: number = Math.max(Math.min(paY, pbY - eY * rb), viewLightPos.y - radius);\r\n        var maxY: number = Math.min(Math.max(paY, pbY + eY * rb), viewLightPos.y + radius);\r\n        if ((minY > halfY) || (maxY <= -halfY))\r\n            return false;\r\n\r\n        // slice = Math.log2(z) * (numSlices / Math.log2(far / near)) - Math.log2(near) * numSlices / Math.log2(far / near)\r\n        // slice start from near plane,near is index:0,z must large than near,or the result will NaN\r\n        var xSlices: number = this._xSlices, ySlices: number = this._ySlices;\r\n        var depthSliceParam: Vector2 = this._depthSliceParam;\r\n        var xStride: number = halfX * 2 / xSlices, yStride: number = halfY * 2 / ySlices;\r\n        lightBound.xMin = Math.max(Math.floor((minX + halfX) / xStride), 0);\r\n        lightBound.xMax = Math.min(Math.ceil((maxX + halfX) / xStride), xSlices);\r\n        lightBound.yMin = Math.max(Math.floor((halfY - maxY) / yStride), 0);//zero is from top\r\n        lightBound.yMax = Math.min(Math.ceil((halfY - minY) / yStride), ySlices);\r\n        lightBound.zMin = Math.floor(Math.log2(Math.max(minZ, near)) * depthSliceParam.x - depthSliceParam.y);\r\n        lightBound.zMax = Math.min(Math.ceil(Math.log2(maxZ) * depthSliceParam.x - depthSliceParam.y), this._zSlices);\r\n        return true;\r\n    }\r\n\r\n\r\n    private _shrinkXYByRadiusPerspective(lightviewPos: Vector3, radius: number, lightBound: LightBound, xPlanes: Vector3[], yPlanes: Vector3[]): boolean {\r\n        var xMin: number, yMin: number;\r\n        var xMax: number, yMax: number;\r\n        var lvX: number = lightviewPos.x, lvY: number = lightviewPos.y, lvZ: number = lightviewPos.z;\r\n\r\n        var i: number;\r\n        var n: number = this._ySlices + 1;\r\n        for (i = 0; i < n; i++) {\r\n            var plane: Vector3 = yPlanes[i];\r\n            if (lvY * plane.y + lvZ * plane.z < radius) {//Dot\r\n                yMin = Math.max(0, i - 1);\r\n                break;\r\n            }\r\n        }\r\n        if (i == n)//fail scan insert\r\n            return false;\r\n        yMax = this._ySlices;\r\n        for (i = yMin + 1; i < n; i++) {\r\n            var plane: Vector3 = yPlanes[i];\r\n            if (lvY * plane.y + lvZ * plane.z <= -radius) {//Dot\r\n                yMax = Math.max(0, i);\r\n                break;\r\n            }\r\n        }\r\n\r\n        n = this._xSlices + 1;\r\n        for (i = 0; i < n; i++) {\r\n            var plane: Vector3 = xPlanes[i];\r\n            if (lvX * plane.x + lvZ * plane.z < radius) {//Dot\r\n                xMin = Math.max(0, i - 1);\r\n                break;\r\n            }\r\n        }\r\n        xMax = this._xSlices;\r\n        for (i = xMin + 1; i < n; i++) {\r\n            var plane: Vector3 = xPlanes[i];\r\n            if (lvX * plane.x + lvZ * plane.z <= -radius) {//Dot\r\n                xMax = Math.max(0, i);\r\n                break;\r\n            }\r\n        }\r\n\r\n\r\n        lightBound.xMin = xMin\r\n        lightBound.xMax = xMax;\r\n        lightBound.yMin = yMin;\r\n        lightBound.yMax = yMax;\r\n        return true;\r\n    }\r\n\r\n    private _shrinkSpotXYByConePerspective(lightviewPos: Vector3, viewForward: Vector3, radius: number, halfAngle: number, lightBound: LightBound, xPlanes: Vector3[], yPlanes: Vector3[]): void {\r\n        var xMin: number, yMin: number;\r\n        var xMax: number, yMax: number;\r\n\r\n        var normal: Vector3 = Cluster._tempVector32;\r\n        var n: number = lightBound.yMax + 1;\r\n        for (var i: number = lightBound.yMin + 1; i < n; i++) {\r\n            if (this._insertConePlane(lightviewPos, viewForward, radius, halfAngle, yPlanes[i])) {\r\n                yMin = Math.max(0, i - 1);\r\n                break;\r\n            }\r\n        }\r\n\r\n        yMax = lightBound.yMax;\r\n        for (var i: number = yMin + 1; i < n; i++) {\r\n            var plane: Vector3 = yPlanes[i];\r\n            normal.setValue(0, -plane.y, -plane.z);\r\n            if (!this._insertConePlane(lightviewPos, viewForward, radius, halfAngle, normal)) {\r\n                yMax = Math.max(0, i);\r\n                break;\r\n            }\r\n        }\r\n\r\n        n = lightBound.xMax + 1;\r\n        for (var i: number = lightBound.xMin + 1; i < n; i++) {\r\n            if (this._insertConePlane(lightviewPos, viewForward, radius, halfAngle, xPlanes[i])) {\r\n                xMin = Math.max(0, i - 1);\r\n                break;\r\n            }\r\n        }\r\n        xMax = lightBound.xMax;\r\n        for (var i: number = xMin + 1; i < n; i++) {\r\n            var plane: Vector3 = xPlanes[i];\r\n            normal.setValue(-plane.x, 0, -plane.z);\r\n            if (!this._insertConePlane(lightviewPos, viewForward, radius, halfAngle, normal)) {\r\n                xMax = Math.max(0, i);\r\n                break;\r\n            }\r\n        }\r\n\r\n        lightBound.xMin = xMin;\r\n        lightBound.xMax = xMax;\r\n        lightBound.yMin = yMin;\r\n        lightBound.yMax = yMax;\r\n    }\r\n\r\n\r\n\r\n    private _updatePointLightPerspective(near: number, far: number, viewMat: Matrix4x4, pointLight: PointLightCom, lightIndex: number, xPlanes: Vector3[], yPlanes: Vector3[]): void {\r\n        var lightBound: LightBound = Cluster._tempLightBound;\r\n        var lightviewPos: Vector3 = Cluster._tempVector30;\r\n        Vector3.transformV3ToV3((pointLight.owner as Sprite3D)._transform.position, viewMat, lightviewPos);//World to View\r\n        lightviewPos.z *= -1;\r\n        if (!this._shrinkSphereLightZPerspective(near, far, lightviewPos, pointLight.range, lightBound))\r\n            return;\r\n        if (!this._shrinkXYByRadiusPerspective(lightviewPos, pointLight.range, lightBound, xPlanes, yPlanes))\r\n            return;\r\n\r\n        this._placePointLightToClusters(lightIndex, lightBound);\r\n    }\r\n\r\n    private _updateSpotLightPerspective(near: number, far: number, viewMat: Matrix4x4, spotLight: SpotLightCom, lightIndex: number, xPlanes: Vector3[], yPlanes: Vector3[]): void {\r\n        // technically could fall outside the bounds we make because the planes themeselves are tilted by some angle\r\n        // the effect is exaggerated the steeper the angle the plane makes is\r\n        var lightBound: LightBound = Cluster._tempLightBound;\r\n        var viewPos: Vector3 = Cluster._tempVector30;\r\n        var forward: Vector3 = Cluster._tempVector31;\r\n        var viewConeCap: Vector3 = Cluster._tempVector34;\r\n        var position: Vector3 = (spotLight.owner as Sprite3D)._transform.position;\r\n        var range: number = spotLight.range;\r\n        (spotLight.owner as Sprite3D)._transform.worldMatrix.getForward(forward);\r\n        Vector3.normalize(forward, forward);\r\n        Vector3.scale(forward, range, viewConeCap);\r\n        Vector3.add(position, viewConeCap, viewConeCap);\r\n\r\n        Vector3.transformV3ToV3(position, viewMat, viewPos);//World to View\r\n        Vector3.transformV3ToV3(viewConeCap, viewMat, viewConeCap);//World to View\r\n        viewPos.z *= -1;\r\n        viewConeCap.z *= -1;\r\n        var halfAngle: number = (spotLight.spotAngle / 2) * Math.PI / 180;\r\n        if (!this._shrinkSpotLightZPerspective(near, far, viewPos, viewConeCap, range, halfAngle, lightBound))\r\n            return;\r\n        if (!this._shrinkXYByRadiusPerspective(viewPos, range, lightBound, xPlanes, yPlanes))\r\n            return;\r\n        var viewFor: Vector3 = Cluster._tempVector33;\r\n        viewFor.x = viewConeCap.x - viewPos.x, viewFor.y = viewConeCap.y - viewPos.y, viewFor.z = viewConeCap.z - viewPos.z;\r\n        Vector3.normalize(viewFor, viewFor);\r\n        this._shrinkSpotXYByConePerspective(viewPos, viewFor, range, halfAngle, lightBound, xPlanes, yPlanes);\r\n\r\n        this._placeSpotLightToClusters(lightIndex, lightBound);\r\n    }\r\n\r\n    private _updatePointLightOrth(halfX: number, halfY: number, near: number, far: number, viewMat: Matrix4x4, pointLight: PointLightCom, lightIndex: number): void {\r\n        var lightBound: LightBound = Cluster._tempLightBound;\r\n        var lightviewPos: Vector3 = Cluster._tempVector30;\r\n        Vector3.transformV3ToV3((pointLight.owner as Sprite3D)._transform.position, viewMat, lightviewPos);//World to View\r\n        lightviewPos.z *= -1;\r\n\r\n        if (!this._shrinkSphereLightByBoundOrth(halfX, halfY, near, far, lightviewPos, pointLight.range, lightBound))\r\n            return;\r\n\r\n        this._placePointLightToClusters(lightIndex, lightBound);\r\n    }\r\n\r\n    private _updateSpotLightOrth(halfX: number, halfY: number, near: number, far: number, viewMat: Matrix4x4, spotLight: SpotLightCom, lightIndex: number): void {\r\n        // technically could fall outside the bounds we make because the planes themeselves are tilted by some angle\r\n        // the effect is exaggerated the steeper the angle the plane makes is\r\n        var lightBound: LightBound = Cluster._tempLightBound;\r\n        var viewPos: Vector3 = Cluster._tempVector30;\r\n        var forward: Vector3 = Cluster._tempVector31;\r\n        var viewConeCap: Vector3 = Cluster._tempVector34;\r\n        var position: Vector3 = (spotLight.owner as Sprite3D)._transform.position;\r\n        var range: number = spotLight.range;\r\n        (spotLight.owner as Sprite3D)._transform.worldMatrix.getForward(forward);\r\n        Vector3.normalize(forward, forward);\r\n        Vector3.scale(forward, range, viewConeCap);\r\n        Vector3.add(position, viewConeCap, viewConeCap);\r\n\r\n        Vector3.transformV3ToV3(position, viewMat, viewPos);//World to View\r\n        Vector3.transformV3ToV3(viewConeCap, viewMat, viewConeCap);//World to View\r\n        viewPos.z *= -1;\r\n        viewConeCap.z *= -1;\r\n        var halfAngle: number = (spotLight.spotAngle / 2) * Math.PI / 180;\r\n        if (!this._shrinkSpotLightByBoundOrth(halfX, halfY, near, far, viewPos, viewConeCap, range, halfAngle, lightBound))\r\n            return;\r\n\r\n        this._placeSpotLightToClusters(lightIndex, lightBound);\r\n    }\r\n\r\n    update(camera: Camera, scene: Scene3D): void {\r\n        this._updateMark++;\r\n        var camNear: number = camera.nearPlane;\r\n        this._depthSliceParam.x = Config3D.lightClusterCount.z / Math.log2(camera.farPlane / camNear);\r\n        this._depthSliceParam.y = Math.log2(camNear) * this._depthSliceParam.x;\r\n\r\n        var near: number = camera.nearPlane;\r\n        var far: number = camera.farPlane;\r\n        var viewMat: Matrix4x4 = camera.viewMatrix;\r\n        var curCount: number = scene._directionLights._length;\r\n        var pointLights: LightQueue<PointLightCom> = scene._pointLights;\r\n        var poiCount: number = pointLights._length;\r\n        var poiElements: PointLightCom[] = <PointLightCom[]>pointLights._elements;\r\n        var spotLights: LightQueue<SpotLightCom> = scene._spotLights;\r\n        var spoCount: number = spotLights._length;\r\n        var spoElements: SpotLightCom[] = <SpotLightCom[]>spotLights._elements;\r\n        if (camera.orthographic) {\r\n            var halfY: number = camera.orthographicVerticalSize / 2.0;\r\n            var halfX: number = halfY * camera.aspectRatio;\r\n            for (var i = 0; i < poiCount; i++, curCount++)\r\n                this._updatePointLightOrth(halfX, halfY, near, far, viewMat, poiElements[i], curCount);\r\n            for (var i = 0; i < spoCount; i++, curCount++)\r\n                this._updateSpotLightOrth(halfX, halfY, near, far, viewMat, spoElements[i], curCount);\r\n        }\r\n        else {\r\n            camera._updateClusterPlaneXY();\r\n            var xPlanes: Vector3[] = camera._clusterXPlanes;//must after camera._updateClusterPlaneXY()\r\n            var yPlanes: Vector3[] = camera._clusterYPlanes;\r\n            for (var i = 0; i < poiCount; i++, curCount++)\r\n                this._updatePointLightPerspective(near, far, viewMat, poiElements[i], curCount, xPlanes, yPlanes);\r\n            for (var i = 0; i < spoCount; i++, curCount++)\r\n                this._updateSpotLightPerspective(near, far, viewMat, spoElements[i], curCount, xPlanes, yPlanes);\r\n        }\r\n\r\n        if (poiCount + spoCount > 0) {\r\n            var xSlices: number = this._xSlices, ySlices: number = this._ySlices, zSlices: number = this._zSlices;\r\n            var widthFloat: number = xSlices * ySlices * 4;\r\n            var lightOff: number = widthFloat * zSlices;\r\n            var clusterPixels: Float32Array = this._clusterPixels;\r\n            var clusterPixelsCount: number = clusterPixels.length;\r\n            var clusterDatas: ClusterData[][][] = this._clusterDatas;\r\n            var updateMark: number = this._updateMark;\r\n            var freeSpace: boolean = true;\r\n            for (var z = 0; z < zSlices; z++) {\r\n                for (var y = 0; y < ySlices; y++) {\r\n                    for (var x = 0; x < xSlices; x++) {\r\n                        var data: ClusterData = clusterDatas[z][y][x];\r\n                        var clusterOff: number = (x + y * xSlices + z * xSlices * ySlices) * 4;\r\n                        if (data.updateMark !== updateMark) {\r\n                            clusterPixels[clusterOff] = 0;\r\n                            clusterPixels[clusterOff + 1] = 0;\r\n                        }\r\n                        else {\r\n                            if (freeSpace) {\r\n                                var indices: number[] = data.indices;\r\n                                var pCount: number = data.pointLightCount;\r\n                                var sCount: number = data.spotLightCount;\r\n                                var count: number = pCount + sCount;\r\n                                if (lightOff + count < clusterPixelsCount) {\r\n                                    clusterPixels[clusterOff] = pCount;\r\n                                    clusterPixels[clusterOff + 1] = sCount;\r\n                                    clusterPixels[clusterOff + 2] = Math.floor(lightOff / widthFloat);//solve precision problme, if data is big some GPU int(float) have problem\r\n                                    clusterPixels[clusterOff + 3] = lightOff % widthFloat;\r\n                                    for (var i: number = 0; i < count; i++)\r\n                                        clusterPixels[lightOff++] = indices[i];\r\n                                }\r\n                                else {\r\n                                    count = clusterPixelsCount - (lightOff + count);\r\n                                    pCount = Math.min(pCount, count);\r\n                                    clusterPixels[clusterOff] = pCount;\r\n                                    clusterPixels[clusterOff + 1] = Math.min(sCount, count - pCount);\r\n                                    clusterPixels[clusterOff + 2] = Math.floor(lightOff / widthFloat);//solve precision problme, if data is big some GPU int(float) have problem\r\n                                    clusterPixels[clusterOff + 3] = lightOff % widthFloat;\r\n                                    for (var i: number = 0; i < count; i++)\r\n                                        clusterPixels[lightOff++] = indices[i];\r\n                                    freeSpace = false;//remain cluster light will be ignore\r\n                                }\r\n                            }\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n            var width: number = this._clusterTexture.width;\r\n            this._clusterTexture.setSubPixelsData(0, 0, width, Math.ceil(lightOff / (4 * width)), clusterPixels, 0, false, false, false);\r\n        }\r\n    }\r\n}\r\n","import { Vector3 } from \"../../maths/Vector3\";\r\n\r\n/**\r\n * \r\n */\r\nexport class Plane {\r\n\t/***/\r\n\tstatic PlaneIntersectionType_Back: number = 0;\r\n\tstatic PlaneIntersectionType_Front: number = 1;\r\n\tstatic PlaneIntersectionType_Intersecting: number = 2;\r\n\t\r\n\t/** */\r\n\tnormal: Vector3;\r\n\t\r\n\t/** */\r\n\tdistance: number;\r\n\r\n\t/**\r\n\t *  <code>Plane</code> \r\n\t * @param\tnormal \r\n\t * @param\td  \r\n\t */\r\n\tconstructor(normal: Vector3 = new Vector3, d: number = 0) {\r\n\t\tthis.normal = normal;\r\n\t\tthis.distance = d;//this.distance = d;\r\n\t}\r\n\t\r\n\t/**\r\n\t * \r\n\t * @param\tpoint0 \r\n\t * @param\tpoint1 \r\n\t * @param\tpoint2 \r\n\t */\r\n\tstatic createPlaneBy3P(point0: Vector3, point1: Vector3, point2: Vector3, out: Plane): void {\r\n\t\tvar x1: number = point1.x - point0.x;\r\n\t\tvar y1: number = point1.y - point0.y;\r\n\t\tvar z1: number = point1.z - point0.z;\r\n\t\tvar x2: number = point2.x - point0.x;\r\n\t\tvar y2: number = point2.y - point0.y;\r\n\t\tvar z2: number = point2.z - point0.z;\r\n\t\tvar yz: number = (y1 * z2) - (z1 * y2);\r\n\t\tvar xz: number = (z1 * x2) - (x1 * z2);\r\n\t\tvar xy: number = (x1 * y2) - (y1 * x2);\r\n\t\tvar invPyth: number = 1.0 / (Math.sqrt((yz * yz) + (xz * xz) + (xy * xy)));\r\n\r\n\t\tvar x: number = yz * invPyth;\r\n\t\tvar y: number = xz * invPyth;\r\n\t\tvar z: number = xy * invPyth;\r\n\r\n\t\tvar normal: Vector3 = out.normal;\r\n\t\tnormal.x = x;\r\n\t\tnormal.y = y;\r\n\t\tnormal.z = z;\r\n\t\tout.normal = normal.normalize();\r\n\t\tout.distance = -((x * point0.x) + (y * point0.y) + (z * point0.z));\r\n\t}\r\n\r\n\r\n\t/**\r\n\t * \r\n\t */\r\n\tnormalize(): void {\r\n\t\tvar normalEX: number = this.normal.x;\r\n\t\tvar normalEY: number = this.normal.y;\r\n\t\tvar normalEZ: number = this.normal.z;\r\n\t\tvar magnitude: number = 1.0 / Math.sqrt(normalEX * normalEX + normalEY * normalEY + normalEZ * normalEZ);\r\n\r\n\t\tthis.normal.x = normalEX * magnitude;\r\n\t\tthis.normal.y = normalEY * magnitude;\r\n\t\tthis.normal.z = normalEZ * magnitude;\r\n\t\tthis.distance *= magnitude;\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t * @param\tdestObject \r\n\t */\r\n\tcloneTo(destObject: any): void {\r\n\t\tvar dest: Plane = <Plane>destObject;\r\n\t\tthis.normal.cloneTo(dest.normal);\r\n\t\tdest.distance = this.distance;\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t * @return\t \r\n\t */\r\n\tclone(): Plane {\r\n\t\tvar dest = new Plane();\r\n\t\tthis.cloneTo(dest);\r\n\t\treturn dest;\r\n\t}\r\n\r\n}\r\n\r\n\r\n\r\n","import { Vector3 } from \"../../maths/Vector3\";\r\n\r\n/**\r\n\t * <code>Ray</code> \r\n\t */\r\nexport class Ray {\r\n\t/***/\r\n\torigin: Vector3;\r\n\t/***/\r\n\tdirection: Vector3;\r\n\r\n\t/**\r\n\t *  <code>Ray</code> \r\n\t * @param\torigin \r\n\t * @param\tdirection  \r\n\t */\r\n\tconstructor(origin: Vector3, direction: Vector3) {\r\n\t\tthis.origin = origin;\r\n\t\tthis.direction = direction;\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t * @param t \r\n\t * @param out \r\n\t */\r\n\tat(t: number, out: Vector3) {\r\n\t\tVector3.scale(this.direction, t, out);\r\n\t\tVector3.add(this.origin, out, out);\r\n\t}\r\n\r\n}\r\n\r\n","/**\r\n * <code>ContainmentType</code> \r\n */\r\nexport class ContainmentType {\r\n\r\n\t/***/\r\n\tstatic Disjoint: number = 0;\r\n\t/***/\r\n\tstatic Contains: number = 1;\r\n\t/***/\r\n\tstatic Intersects: number = 2;\r\n\r\n}\r\n\r\n\r\n","import { Plane } from \"./Plane\";\r\nimport { BoundBox } from \"./BoundBox\";\r\nimport { BoundSphere } from \"./BoundSphere\";\r\nimport { Ray } from \"./Ray\";\r\nimport { ContainmentType } from \"./ContainmentType\";\r\nimport { MathUtils3D } from \"../../maths/MathUtils3D\";\r\nimport { Vector3 } from \"../../maths/Vector3\";\r\n/**\r\n     * <code>Collision</code> \r\n     */\r\nexport class CollisionUtils {\r\n\r\n    /** @internal */\r\n    private static _tempV30: Vector3 = new Vector3();\r\n    /** @internal */\r\n    private static _tempV31: Vector3 = new Vector3();\r\n    /** @internal */\r\n    private static _tempV32: Vector3 = new Vector3();\r\n    /** @internal */\r\n    private static _tempV33: Vector3 = new Vector3();\r\n    /** @internal */\r\n    private static _tempV34: Vector3 = new Vector3();\r\n    /** @internal */\r\n    private static _tempV35: Vector3 = new Vector3();\r\n    /** @internal */\r\n    private static _tempV36: Vector3 = new Vector3();\r\n\r\n\r\n    /**\r\n     *  <code>Collision</code> \r\n     */\r\n    constructor() {\r\n\r\n    }\r\n\r\n\r\n    /**\r\n     * \r\n     * @param\tplane \r\n     * @param\tpoint \r\n     */\r\n    static distancePlaneToPoint(plane: Plane, point: Vector3): number {\r\n\r\n        var dot: number = Vector3.dot(plane.normal, point);\r\n        return dot + plane.distance;\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @param\tbox \r\n     * @param\tpoint \r\n     */\r\n    static distanceBoxToPoint(box: BoundBox, point: Vector3): number {\r\n\r\n        var boxMin: Vector3 = box.min;\r\n        var boxMineX: number = boxMin.x;\r\n        var boxMineY: number = boxMin.y;\r\n        var boxMineZ: number = boxMin.z;\r\n\r\n        var boxMax: Vector3 = box.max;\r\n        var boxMaxeX: number = boxMax.x;\r\n        var boxMaxeY: number = boxMax.y;\r\n        var boxMaxeZ: number = boxMax.z;\r\n\r\n        var pointeX: number = point.x;\r\n        var pointeY: number = point.y;\r\n        var pointeZ: number = point.z;\r\n\r\n        var distance: number = 0;\r\n\r\n        if (pointeX < boxMineX)\r\n            distance += (boxMineX - pointeX) * (boxMineX - pointeX);\r\n        if (pointeX > boxMaxeX)\r\n            distance += (boxMaxeX - pointeX) * (boxMaxeX - pointeX);\r\n\r\n        if (pointeY < boxMineY)\r\n            distance += (boxMineY - pointeY) * (boxMineY - pointeY);\r\n        if (pointeY > boxMaxeY)\r\n            distance += (boxMaxeY - pointeY) * (boxMaxeY - pointeY);\r\n\r\n        if (pointeZ < boxMineZ)\r\n            distance += (boxMineZ - pointeZ) * (boxMineZ - pointeZ);\r\n        if (pointeZ > boxMaxeZ)\r\n            distance += (boxMaxeZ - pointeZ) * (boxMaxeZ - pointeZ);\r\n\r\n        return Math.sqrt(distance);\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @param\tbox1 1\r\n     * @param\tbox2 2\r\n     */\r\n    static distanceBoxToBox(box1: BoundBox, box2: BoundBox): number {\r\n\r\n        var box1Mine: Vector3 = box1.min;\r\n        var box1MineX: number = box1Mine.x;\r\n        var box1MineY: number = box1Mine.y;\r\n        var box1MineZ: number = box1Mine.z;\r\n\r\n        var box1Maxe: Vector3 = box1.max;\r\n        var box1MaxeX: number = box1Maxe.x;\r\n        var box1MaxeY: number = box1Maxe.y;\r\n        var box1MaxeZ: number = box1Maxe.z;\r\n\r\n        var box2Mine: Vector3 = box2.min;\r\n        var box2MineX: number = box2Mine.x;\r\n        var box2MineY: number = box2Mine.y;\r\n        var box2MineZ: number = box2Mine.z;\r\n\r\n        var box2Maxe: Vector3 = box2.max;\r\n        var box2MaxeX: number = box2Maxe.x;\r\n        var box2MaxeY: number = box2Maxe.y;\r\n        var box2MaxeZ: number = box2Maxe.z;\r\n\r\n        var distance: number = 0;\r\n        var delta: number;\r\n\r\n        if (box1MineX > box2MaxeX) {\r\n\r\n            delta = box1MineX - box2MaxeX;\r\n            distance += delta * delta;\r\n        } else if (box2MineX > box1MaxeX) {\r\n\r\n            delta = box2MineX - box1MaxeX;\r\n            distance += delta * delta;\r\n        }\r\n\r\n        if (box1MineY > box2MaxeY) {\r\n\r\n            delta = box1MineY - box2MaxeY;\r\n            distance += delta * delta;\r\n        } else if (box2MineY > box1MaxeY) {\r\n\r\n            delta = box2MineY - box1MaxeY;\r\n            distance += delta * delta;\r\n        }\r\n\r\n        if (box1MineZ > box2MaxeZ) {\r\n\r\n            delta = box1MineZ - box2MaxeZ;\r\n            distance += delta * delta;\r\n        } else if (box2MineZ > box1MaxeZ) {\r\n\r\n            delta = box2MineZ - box1MaxeZ;\r\n            distance += delta * delta;\r\n        }\r\n\r\n        return Math.sqrt(distance);\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @param\tsphere \r\n     * @param\tpoint  \r\n     */\r\n    static distanceSphereToPoint(sphere: BoundSphere, point: Vector3): number {\r\n\r\n        var distance: number = Math.sqrt(Vector3.distanceSquared(sphere.center, point));\r\n        distance -= sphere.radius;\r\n\r\n        return Math.max(distance, 0);\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @param\tsphere1 1\r\n     * @param\tsphere2 2\r\n     */\r\n    static distanceSphereToSphere(sphere1: BoundSphere, sphere2: BoundSphere): number {\r\n\r\n        var distance: number = Math.sqrt(Vector3.distanceSquared(sphere1.center, sphere2.center));\r\n        distance -= sphere1.radius + sphere2.radius;\r\n\r\n        return Math.max(distance, 0);\r\n    }\r\n\r\n\r\n    /**\r\n     * ,\r\n     * @param\tray \r\n     * @param\tvertex1 1\r\n     * @param\tvertex2\t2\r\n     * @param\tvertex3 3\r\n     * @param\tout \r\n     * @return  \r\n     */\r\n    static intersectsRayAndTriangleRD(ray: Ray, vertex1: Vector3, vertex2: Vector3, vertex3: Vector3, out: number): boolean {\r\n\r\n        var rayO: Vector3 = ray.origin;\r\n        var rayOeX: number = rayO.x;\r\n        var rayOeY: number = rayO.y;\r\n        var rayOeZ: number = rayO.z;\r\n\r\n        var rayD: Vector3 = ray.direction;\r\n        var rayDeX: number = rayD.x;\r\n        var rayDeY: number = rayD.y;\r\n        var rayDeZ: number = rayD.z;\r\n\r\n        var v1eX: number = vertex1.x;\r\n        var v1eY: number = vertex1.y;\r\n        var v1eZ: number = vertex1.z;\r\n\r\n        var v2eX: number = vertex2.x;\r\n        var v2eY: number = vertex2.y;\r\n        var v2eZ: number = vertex2.z;\r\n\r\n        var v3eX: number = vertex3.x;\r\n        var v3eY: number = vertex3.y;\r\n        var v3eZ: number = vertex3.z;\r\n\r\n        var _tempV30eX: number = CollisionUtils._tempV30.x;\r\n        var _tempV30eY: number = CollisionUtils._tempV30.y;\r\n        var _tempV30eZ: number = CollisionUtils._tempV30.z;\r\n\r\n        _tempV30eX = v2eX - v1eX;\r\n        _tempV30eY = v2eY - v1eY;\r\n        _tempV30eZ = v2eZ - v1eZ;\r\n\r\n        var _tempV31eX: number = CollisionUtils._tempV31.x;\r\n        var _tempV31eY: number = CollisionUtils._tempV31.y;\r\n        var _tempV31eZ: number = CollisionUtils._tempV31.z;\r\n\r\n        _tempV31eX = v3eX - v1eX;\r\n        _tempV31eY = v3eY - v1eY;\r\n        _tempV31eZ = v3eZ - v1eZ;\r\n\r\n        var _tempV32eX: number = CollisionUtils._tempV32.x;\r\n        var _tempV32eY: number = CollisionUtils._tempV32.y;\r\n        var _tempV32eZ: number = CollisionUtils._tempV32.z;\r\n\r\n        _tempV32eX = (rayDeY * _tempV31eZ) - (rayDeZ * _tempV31eY);\r\n        _tempV32eY = (rayDeZ * _tempV31eX) - (rayDeX * _tempV31eZ);\r\n        _tempV32eZ = (rayDeX * _tempV31eY) - (rayDeY * _tempV31eX);\r\n\r\n        var determinant: number = (_tempV30eX * _tempV32eX) + (_tempV30eY * _tempV32eY) + (_tempV30eZ * _tempV32eZ);\r\n\r\n        if (MathUtils3D.isZero(determinant)) {\r\n\r\n            out = 0;\r\n            return false;\r\n        }\r\n\r\n        var inversedeterminant: number = 1 / determinant;\r\n\r\n        var _tempV33eX: number = CollisionUtils._tempV33.x;\r\n        var _tempV33eY: number = CollisionUtils._tempV33.y;\r\n        var _tempV33eZ: number = CollisionUtils._tempV33.z;\r\n\r\n        _tempV33eX = rayOeX - v1eX;\r\n        _tempV33eY = rayOeY - v1eY;\r\n        _tempV33eZ = rayOeZ - v1eZ;\r\n\r\n        var triangleU: number = (_tempV33eX * _tempV32eX) + (_tempV33eY * _tempV32eY) + (_tempV33eZ * _tempV32eZ);\r\n        triangleU *= inversedeterminant;\r\n\r\n        if (triangleU < 0 || triangleU > 1) {\r\n\r\n            out = 0;\r\n            return false;\r\n        }\r\n\r\n        var _tempV34eX: number = CollisionUtils._tempV34.x;\r\n        var _tempV34eY: number = CollisionUtils._tempV34.y;\r\n        var _tempV34eZ: number = CollisionUtils._tempV34.z;\r\n\r\n        _tempV34eX = (_tempV33eY * _tempV30eZ) - (_tempV33eZ * _tempV30eY);\r\n        _tempV34eY = (_tempV33eZ * _tempV30eX) - (_tempV33eX * _tempV30eZ);\r\n        _tempV34eZ = (_tempV33eX * _tempV30eY) - (_tempV33eY * _tempV30eX);\r\n\r\n        var triangleV: number = ((rayDeX * _tempV34eX) + (rayDeY * _tempV34eY)) + (rayDeZ * _tempV34eZ);\r\n        triangleV *= inversedeterminant;\r\n\r\n        if (triangleV < 0 || triangleU + triangleV > 1) {\r\n\r\n            out = 0;\r\n            return false;\r\n        }\r\n\r\n        var raydistance: number = (_tempV31eX * _tempV34eX) + (_tempV31eY * _tempV34eY) + (_tempV31eZ * _tempV34eZ);\r\n        raydistance *= inversedeterminant;\r\n\r\n        if (raydistance < 0) {\r\n\r\n            out = 0;\r\n            return false;\r\n        }\r\n\r\n        out = raydistance;\r\n        return true;\r\n    }\r\n\r\n    /**\r\n     * ,\r\n     * @param\tray \r\n     * @param\tvertex1 1\r\n     * @param\tvertex2\t2\r\n     * @param\tvertex3 3\r\n     * @param\tout \r\n     * @return  \r\n     */\r\n    static intersectsRayAndTriangleRP(ray: Ray, vertex1: Vector3, vertex2: Vector3, vertex3: Vector3, out: Vector3): boolean {\r\n\r\n        var distance: number;\r\n        if (!CollisionUtils.intersectsRayAndTriangleRD(ray, vertex1, vertex2, vertex3, distance)) {\r\n\r\n            Vector3.ZERO.cloneTo(out);\r\n            return false;\r\n        }\r\n\r\n        Vector3.scale(ray.direction, distance, CollisionUtils._tempV30);\r\n        Vector3.add(ray.origin, CollisionUtils._tempV30, out);\r\n        return true;\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @param\tsphere1 1\r\n     * @param\tsphere2 2\r\n     */\r\n    static intersectsRayAndPoint(ray: Ray, point: Vector3): boolean {\r\n\r\n        Vector3.subtract(ray.origin, point, CollisionUtils._tempV30);\r\n\r\n        var b: number = Vector3.dot(CollisionUtils._tempV30, ray.direction);\r\n        var c: number = Vector3.dot(CollisionUtils._tempV30, CollisionUtils._tempV30) - MathUtils3D.zeroTolerance;\r\n\r\n        if (c > 0 && b > 0)\r\n            return false;\r\n        var discriminant: number = b * b - c;\r\n        if (discriminant < 0)\r\n            return false;\r\n        return true;\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @param\tray1 1\r\n     * @param\tray2 2\r\n     * @param\tout \r\n     */\r\n    static intersectsRayAndRay(ray1: Ray, ray2: Ray, out: Vector3): boolean {\r\n\r\n        var ray1o: Vector3 = ray1.origin;\r\n        var ray1oeX: number = ray1o.x;\r\n        var ray1oeY: number = ray1o.y;\r\n        var ray1oeZ: number = ray1o.z;\r\n\r\n        var ray1d: Vector3 = ray1.direction;\r\n        var ray1deX: number = ray1d.x;\r\n        var ray1deY: number = ray1d.y;\r\n        var ray1deZ: number = ray1d.z;\r\n\r\n        var ray2o: Vector3 = ray2.origin;\r\n        var ray2oeX: number = ray2o.x;\r\n        var ray2oeY: number = ray2o.y;\r\n        var ray2oeZ: number = ray2o.z;\r\n\r\n        var ray2d: Vector3 = ray2.direction;\r\n        var ray2deX: number = ray2d.x;\r\n        var ray2deY: number = ray2d.y;\r\n        var ray2deZ: number = ray2d.z;\r\n\r\n        Vector3.cross(ray1d, ray2d, CollisionUtils._tempV30);\r\n        var tempV3: Vector3 = CollisionUtils._tempV30;\r\n        var denominator: number = Vector3.scalarLength(CollisionUtils._tempV30);\r\n\r\n        if (MathUtils3D.isZero(denominator)) {\r\n\r\n            if (MathUtils3D.nearEqual(ray2oeX, ray1oeX) && MathUtils3D.nearEqual(ray2oeY, ray1oeY) && MathUtils3D.nearEqual(ray2oeZ, ray1oeZ)) {\r\n                Vector3.ZERO.cloneTo(out);\r\n                return true;\r\n            }\r\n        }\r\n\r\n        denominator = denominator * denominator;\r\n\r\n        var m11: number = ray2oeX - ray1oeX;\r\n        var m12: number = ray2oeY - ray1oeY;\r\n        var m13: number = ray2oeZ - ray1oeZ;\r\n        var m21: number = ray2deX;\r\n        var m22: number = ray2deY;\r\n        var m23: number = ray2deZ;\r\n        var m31: number = tempV3.x;\r\n        var m32: number = tempV3.y;\r\n        var m33: number = tempV3.z;\r\n\r\n        var dets: number = m11 * m22 * m33 + m12 * m23 * m31 + m13 * m21 * m32 - m11 * m23 * m32 - m12 * m21 * m33 - m13 * m22 * m31;\r\n\r\n        m21 = ray1deX;\r\n        m22 = ray1deY;\r\n        m23 = ray1deZ;\r\n\r\n\r\n        var s: number = dets / denominator;\r\n\r\n        Vector3.scale(ray1d, s, CollisionUtils._tempV30);\r\n        Vector3.scale(ray2d, s, CollisionUtils._tempV31);\r\n\r\n        Vector3.add(ray1o, CollisionUtils._tempV30, CollisionUtils._tempV32);\r\n        Vector3.add(ray2o, CollisionUtils._tempV31, CollisionUtils._tempV33);\r\n\r\n        var point1e: Vector3 = CollisionUtils._tempV32;\r\n        var point2e: Vector3 = CollisionUtils._tempV33;\r\n\r\n        if (!MathUtils3D.nearEqual(point2e.x, point1e.x) || !MathUtils3D.nearEqual(point2e.y, point1e.y) || !MathUtils3D.nearEqual(point2e.z, point1e.z)) {\r\n            Vector3.ZERO.cloneTo(out);\r\n            return false;\r\n        }\r\n\r\n        out = CollisionUtils._tempV32;\r\n        return true;\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @param\tplane \r\n     * @param\tvertex1 1\r\n     * @param\tvertex2 2\r\n     * @param\tvertex3 3\r\n     * @return  \r\n     */\r\n    static intersectsPlaneAndTriangle(plane: Plane, vertex1: Vector3, vertex2: Vector3, vertex3: Vector3): number {\r\n\r\n        var test1: number = CollisionUtils.intersectsPlaneAndPoint(plane, vertex1);\r\n        var test2: number = CollisionUtils.intersectsPlaneAndPoint(plane, vertex2);\r\n        var test3: number = CollisionUtils.intersectsPlaneAndPoint(plane, vertex3);\r\n\r\n        if (test1 == Plane.PlaneIntersectionType_Front && test2 == Plane.PlaneIntersectionType_Front && test3 == Plane.PlaneIntersectionType_Front)\r\n            return Plane.PlaneIntersectionType_Front;\r\n\r\n        if (test1 == Plane.PlaneIntersectionType_Back && test2 == Plane.PlaneIntersectionType_Back && test3 == Plane.PlaneIntersectionType_Back)\r\n            return Plane.PlaneIntersectionType_Back;\r\n\r\n        return Plane.PlaneIntersectionType_Intersecting;\r\n    }\r\n\r\n    /**\r\n     * ,\r\n     * @param\tray   \r\n     * @param\tplane \r\n     * @return\t,-1\r\n     */\r\n    static intersectsRayAndPlaneRD(ray: Ray, plane: Plane): number {\r\n        //Source: Real-Time Collision Detection by Christer Ericson\r\n        //Reference: Page 175\r\n        var planeNor: Vector3 = plane.normal;\r\n        var direction: number = Vector3.dot(planeNor, ray.direction);\r\n\r\n        if (Math.abs(direction) < MathUtils3D.zeroTolerance)\r\n            return -1;\r\n\r\n        var position: number = Vector3.dot(planeNor, ray.origin);\r\n        var distance: number = (-plane.distance - position) / direction;\r\n\r\n        if (distance < 0) {\r\n            if (distance < -MathUtils3D.zeroTolerance)\r\n                return -1;\r\n            distance = 0;\r\n        }\r\n        return distance;\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @param\tray   \r\n     * @param\tplane \r\n     * @param\tout \r\n     */\r\n    static intersectsRayAndPlaneRP(ray: Ray, plane: Plane, out: Vector3): boolean {\r\n        //Source: Real-Time Collision Detection by Christer Ericson\r\n        //Reference: Page 175\r\n        var distance: number = CollisionUtils.intersectsRayAndPlaneRD(ray, plane);\r\n        if (distance == -1) {\r\n            out.setValue(0, 0, 0);\r\n            return false;\r\n        }\r\n\r\n        var scaDis: Vector3 = CollisionUtils._tempV30;\r\n        Vector3.scale(ray.direction, distance, scaDis);\r\n        Vector3.add(ray.origin, scaDis, out);\r\n        return true;\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @param\tray \r\n     * @param\tbox\t\r\n     * @param\tout ,0,\r\n     */\r\n    static intersectsRayAndBoxRD(ray: Ray, box: BoundBox): number {\r\n\r\n        var rayoe: Vector3 = ray.origin;\r\n        var rayoeX: number = rayoe.x;\r\n        var rayoeY: number = rayoe.y;\r\n        var rayoeZ: number = rayoe.z;\r\n\r\n        var rayde: Vector3 = ray.direction;\r\n        var raydeX: number = rayde.x;\r\n        var raydeY: number = rayde.y;\r\n        var raydeZ: number = rayde.z;\r\n\r\n        var boxMine: Vector3 = box.min;\r\n        var boxMineX: number = boxMine.x;\r\n        var boxMineY: number = boxMine.y;\r\n        var boxMineZ: number = boxMine.z;\r\n\r\n        var boxMaxe: Vector3 = box.max;\r\n        var boxMaxeX: number = boxMaxe.x;\r\n        var boxMaxeY: number = boxMaxe.y;\r\n        var boxMaxeZ: number = boxMaxe.z;\r\n\r\n        var out: number = 0;\r\n\r\n        var tmax: number = MathUtils3D.MaxValue;\r\n\r\n        if (MathUtils3D.isZero(raydeX)) {\r\n\r\n            if (rayoeX < boxMineX || rayoeX > boxMaxeX) {\r\n\r\n                //out = 0;\r\n                return -1;\r\n            }\r\n        } else {\r\n\r\n            var inverse: number = 1 / raydeX;\r\n            var t1: number = (boxMineX - rayoeX) * inverse;\r\n            var t2: number = (boxMaxeX - rayoeX) * inverse;\r\n\r\n            if (t1 > t2) {\r\n\r\n                var temp: number = t1;\r\n                t1 = t2;\r\n                t2 = temp;\r\n            }\r\n\r\n            out = Math.max(t1, out);\r\n            tmax = Math.min(t2, tmax);\r\n\r\n            if (out > tmax) {\r\n\r\n                //out = 0;\r\n                return -1;\r\n            }\r\n        }\r\n\r\n        if (MathUtils3D.isZero(raydeY)) {\r\n\r\n            if (rayoeY < boxMineY || rayoeY > boxMaxeY) {\r\n\r\n                //out = 0;\r\n                return -1;\r\n            }\r\n        } else {\r\n\r\n            var inverse1: number = 1 / raydeY;\r\n            var t3: number = (boxMineY - rayoeY) * inverse1;\r\n            var t4: number = (boxMaxeY - rayoeY) * inverse1;\r\n\r\n            if (t3 > t4) {\r\n\r\n                var temp1: number = t3;\r\n                t3 = t4;\r\n                t4 = temp1;\r\n            }\r\n\r\n            out = Math.max(t3, out);\r\n            tmax = Math.min(t4, tmax);\r\n\r\n            if (out > tmax) {\r\n\r\n                //out = 0;\r\n                return -1;\r\n            }\r\n        }\r\n\r\n        if (MathUtils3D.isZero(raydeZ)) {\r\n\r\n            if (rayoeZ < boxMineZ || rayoeZ > boxMaxeZ) {\r\n\r\n                //out = 0;\r\n                return -1;\r\n            }\r\n        } else {\r\n\r\n            var inverse2: number = 1 / raydeZ;\r\n            var t5: number = (boxMineZ - rayoeZ) * inverse2;\r\n            var t6: number = (boxMaxeZ - rayoeZ) * inverse2;\r\n\r\n            if (t5 > t6) {\r\n\r\n                var temp2: number = t5;\r\n                t5 = t6;\r\n                t6 = temp2;\r\n            }\r\n\r\n            out = Math.max(t5, out);\r\n            tmax = Math.min(t6, tmax);\r\n\r\n            if (out > tmax) {\r\n\r\n                //out = 0;\r\n                return -1;\r\n            }\r\n        }\r\n\r\n        return out;\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @param\tray \r\n     * @param\tbox\t\r\n     * @param\tout \r\n     */\r\n    static intersectsRayAndBoxRP(ray: Ray, box: BoundBox, out: Vector3): number {\r\n\r\n        var distance: number = CollisionUtils.intersectsRayAndBoxRD(ray, box);\r\n        if (distance === -1) {\r\n\r\n            Vector3.ZERO.cloneTo(out);\r\n            return distance;\r\n        }\r\n        Vector3.scale(ray.direction, distance, CollisionUtils._tempV30);\r\n        Vector3.add(ray.origin, CollisionUtils._tempV30, CollisionUtils._tempV31);\r\n\r\n        CollisionUtils._tempV31.cloneTo(out);\r\n\r\n        return distance;\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @param\tray    \r\n     * @param\tsphere \r\n     * @return\t,-1\r\n     */\r\n    static intersectsRayAndSphereRD(ray: Ray, sphere: BoundSphere): number {\r\n\r\n        var sphereR: number = sphere.radius;\r\n        Vector3.subtract(ray.origin, sphere.center, CollisionUtils._tempV30);\r\n\r\n        var b: number = Vector3.dot(CollisionUtils._tempV30, ray.direction);\r\n        var c: number = Vector3.dot(CollisionUtils._tempV30, CollisionUtils._tempV30) - (sphereR * sphereR);\r\n\r\n        if (c > 0 && b > 0) {\r\n            return -1;\r\n        }\r\n\r\n        var discriminant: number = b * b - c;\r\n\r\n        if (discriminant < 0) {\r\n            return -1;\r\n        }\r\n\r\n        var distance: number = -b - Math.sqrt(discriminant);\r\n\r\n        if (distance < 0)\r\n            distance = 0;\r\n\r\n        return distance;\r\n\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @param\tray    \r\n     * @param\tsphere \r\n     * @param\tout    \r\n     * @return  ,-1\r\n     */\r\n    static intersectsRayAndSphereRP(ray: Ray, sphere: BoundSphere, out: Vector3): number {\r\n        var distance: number = CollisionUtils.intersectsRayAndSphereRD(ray, sphere);\r\n        if (distance === -1) {\r\n            Vector3.ZERO.cloneTo(out);\r\n            return distance;\r\n        }\r\n\r\n        Vector3.scale(ray.direction, distance, CollisionUtils._tempV30);\r\n        Vector3.add(ray.origin, CollisionUtils._tempV30, CollisionUtils._tempV31);\r\n\r\n        CollisionUtils._tempV31.cloneTo(out);\r\n        return distance;\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @param\tsphere \r\n     * @param\tvertex1 1\r\n     * @param\tvertex2 2\r\n     * @param\tvertex3 3\r\n     * @return  \r\n     */\r\n    static intersectsSphereAndTriangle(sphere: BoundSphere, vertex1: Vector3, vertex2: Vector3, vertex3: Vector3): boolean {\r\n\r\n        var sphereC: Vector3 = sphere.center;\r\n        var sphereR: number = sphere.radius;\r\n\r\n        CollisionUtils.closestPointPointTriangle(sphereC, vertex1, vertex2, vertex3, CollisionUtils._tempV30);\r\n        Vector3.subtract(CollisionUtils._tempV30, sphereC, CollisionUtils._tempV31);\r\n\r\n        var dot: number = Vector3.dot(CollisionUtils._tempV31, CollisionUtils._tempV31);\r\n\r\n        return dot <= sphereR * sphereR;\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @param\tplane  \r\n     * @param\tpoint  \r\n     * @return  \r\n     */\r\n    static intersectsPlaneAndPoint(plane: Plane, point: Vector3): number {\r\n        var distance: number = Vector3.dot(plane.normal, point) + plane.distance;\r\n        if (distance > 0)\r\n            return Plane.PlaneIntersectionType_Front;\r\n        if (distance < 0)\r\n            return Plane.PlaneIntersectionType_Back;\r\n        return Plane.PlaneIntersectionType_Intersecting;\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @param\tplane1 1\r\n     * @param\tplane2 2\r\n     * @return  \r\n     */\r\n    static intersectsPlaneAndPlane(plane1: Plane, plane2: Plane): boolean {\r\n\r\n        Vector3.cross(plane1.normal, plane2.normal, CollisionUtils._tempV30);\r\n\r\n        var denominator: number = Vector3.dot(CollisionUtils._tempV30, CollisionUtils._tempV30);\r\n\r\n        if (MathUtils3D.isZero(denominator))\r\n            return false;\r\n\r\n        return true;\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @param\tplane1 1\r\n     * @param\tplane2 2\r\n     * @param\tline   \r\n     * @return  \r\n     */\r\n    static intersectsPlaneAndPlaneRL(plane1: Plane, plane2: Plane, line: Ray): boolean {\r\n\r\n        var plane1nor: Vector3 = plane1.normal;\r\n        var plane2nor: Vector3 = plane2.normal;\r\n\r\n        Vector3.cross(plane1nor, plane2nor, CollisionUtils._tempV34);\r\n        var denominator: number = Vector3.dot(CollisionUtils._tempV34, CollisionUtils._tempV34);\r\n\r\n        if (MathUtils3D.isZero(denominator))\r\n            return false;\r\n\r\n        Vector3.scale(plane2nor, plane1.distance, CollisionUtils._tempV30);\r\n        Vector3.scale(plane1nor, plane2.distance, CollisionUtils._tempV31);\r\n        Vector3.subtract(CollisionUtils._tempV30, CollisionUtils._tempV31, CollisionUtils._tempV32);\r\n        Vector3.cross(CollisionUtils._tempV32, CollisionUtils._tempV34, CollisionUtils._tempV33);\r\n\r\n        Vector3.normalize(CollisionUtils._tempV34, CollisionUtils._tempV34);\r\n        line = new Ray(CollisionUtils._tempV33, CollisionUtils._tempV34);\r\n\r\n        return true;\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @param\tplane \r\n     * @param   box  \r\n     * @return  \r\n     */\r\n    static intersectsPlaneAndBox(plane: Plane, box: BoundBox): number {\r\n\r\n        var planeD: number = plane.distance;\r\n\r\n        var planeNor: Vector3 = plane.normal;\r\n        var planeNoreX: number = planeNor.x;\r\n        var planeNoreY: number = planeNor.y;\r\n        var planeNoreZ: number = planeNor.z;\r\n\r\n        var boxMine: Vector3 = box.min;\r\n        var boxMineX: number = boxMine.x;\r\n        var boxMineY: number = boxMine.y;\r\n        var boxMineZ: number = boxMine.z;\r\n\r\n        var boxMaxe: Vector3 = box.max;\r\n        var boxMaxeX: number = boxMaxe.x;\r\n        var boxMaxeY: number = boxMaxe.y;\r\n        var boxMaxeZ: number = boxMaxe.z;\r\n\r\n        CollisionUtils._tempV30.x = (planeNoreX > 0) ? boxMineX : boxMaxeX;\r\n        CollisionUtils._tempV30.y = (planeNoreY > 0) ? boxMineY : boxMaxeY;\r\n        CollisionUtils._tempV30.z = (planeNoreZ > 0) ? boxMineZ : boxMaxeZ;\r\n\r\n        CollisionUtils._tempV31.x = (planeNoreX > 0) ? boxMaxeX : boxMineX;\r\n        CollisionUtils._tempV31.y = (planeNoreY > 0) ? boxMaxeY : boxMineY;\r\n        CollisionUtils._tempV31.z = (planeNoreZ > 0) ? boxMaxeZ : boxMineZ;\r\n\r\n        var distance: number = Vector3.dot(planeNor, CollisionUtils._tempV30);\r\n        if (distance + planeD > 0)\r\n            return Plane.PlaneIntersectionType_Front;\r\n\r\n        distance = Vector3.dot(planeNor, CollisionUtils._tempV31);\r\n        if (distance + planeD < 0)\r\n            return Plane.PlaneIntersectionType_Back;\r\n\r\n        return Plane.PlaneIntersectionType_Intersecting;\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @param\tplane \r\n     * @param   sphere \r\n     * @return  \r\n     */\r\n    static intersectsPlaneAndSphere(plane: Plane, sphere: BoundSphere): number {\r\n\r\n        var sphereR: number = sphere.radius;\r\n        var distance: number = Vector3.dot(plane.normal, sphere.center) + plane.distance;\r\n\r\n        if (distance > sphereR)\r\n            return Plane.PlaneIntersectionType_Front;\r\n        if (distance < -sphereR)\r\n            return Plane.PlaneIntersectionType_Back;\r\n        return Plane.PlaneIntersectionType_Intersecting;\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @param\tbox1 1\r\n     * @param   box2 2\r\n     * @return  \r\n     */\r\n    static intersectsBoxAndBox(box1: BoundBox, box2: BoundBox): boolean {\r\n\r\n        var box1Mine: Vector3 = box1.min;\r\n        var box1Maxe: Vector3 = box1.max;\r\n        var box2Mine: Vector3 = box2.min;\r\n        var box2Maxe: Vector3 = box2.max;\r\n\r\n        if (box1Mine.x > box2Maxe.x || box2Mine.x > box1Maxe.x)\r\n            return false;\r\n        if (box1Mine.y > box2Maxe.y || box2Mine.y > box1Maxe.y)\r\n            return false;\r\n        if (box1Mine.z > box2Maxe.z || box2Mine.z > box1Maxe.z)\r\n            return false;\r\n        return true;\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @param\tbox \r\n     * @param   sphere \r\n     * @return  \r\n     */\r\n    static intersectsBoxAndSphere(box: BoundBox, sphere: BoundSphere): boolean {\r\n        var center: Vector3 = sphere.center;\r\n        var radius: number = sphere.radius;\r\n        var nearest: Vector3 = CollisionUtils._tempV30;\r\n        Vector3.Clamp(center, box.min, box.max, nearest);\r\n        var distance: number = Vector3.distanceSquared(center, nearest);\r\n        return distance <= radius * radius;\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @param\tsphere1 1\r\n     * @param   sphere2 2\r\n     * @return  \r\n     */\r\n    static intersectsSphereAndSphere(sphere1: BoundSphere, sphere2: BoundSphere): boolean {\r\n\r\n        var radiisum: number = sphere1.radius + sphere2.radius;\r\n        return Vector3.distanceSquared(sphere1.center, sphere2.center) <= radiisum * radiisum;\r\n    }\r\n\r\n\r\n    /**\r\n     * \r\n     * @param\tbox \r\n     * @param   point \r\n     * @return  :0 ,1 , 2 \r\n     */\r\n    static boxContainsPoint(box: BoundBox, point: Vector3): number {\r\n        var boxMine: Vector3 = box.min;\r\n        var boxMaxe: Vector3 = box.max;\r\n        if (boxMine.x <= point.x && boxMaxe.x >= point.x && boxMine.y <= point.y && boxMaxe.y >= point.y && boxMine.z <= point.z && boxMaxe.z >= point.z)\r\n            return ContainmentType.Contains;\r\n        return ContainmentType.Disjoint;\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @param\tbox1 1\r\n     * @param   box2 2\r\n     * @return  :0 ,1 , 2 \r\n     */\r\n    static boxContainsBox(box1: BoundBox, box2: BoundBox): number {\r\n\r\n        var box1Mine: Vector3 = box1.min;\r\n        var box1MineX: number = box1Mine.x;\r\n        var box1MineY: number = box1Mine.y;\r\n        var box1MineZ: number = box1Mine.z;\r\n\r\n        var box1Maxe: Vector3 = box1.max;\r\n        var box1MaxeX: number = box1Maxe.x;\r\n        var box1MaxeY: number = box1Maxe.y;\r\n        var box1MaxeZ: number = box1Maxe.z;\r\n\r\n        var box2Mine: Vector3 = box2.min;\r\n        var box2MineX: number = box2Mine.x;\r\n        var box2MineY: number = box2Mine.y;\r\n        var box2MineZ: number = box2Mine.z;\r\n\r\n        var box2Maxe: Vector3 = box2.max;\r\n        var box2MaxeX: number = box2Maxe.x;\r\n        var box2MaxeY: number = box2Maxe.y;\r\n        var box2MaxeZ: number = box2Maxe.z;\r\n\r\n        if (box1MaxeX < box2MineX || box1MineX > box2MaxeX)\r\n            return ContainmentType.Disjoint;\r\n\r\n        if (box1MaxeY < box2MineY || box1MineY > box2MaxeY)\r\n            return ContainmentType.Disjoint;\r\n\r\n        if (box1MaxeZ < box2MineZ || box1MineZ > box2MaxeZ)\r\n            return ContainmentType.Disjoint;\r\n\r\n        if (box1MineX <= box2MineX && box2MaxeX <= box1MaxeX && box1MineY <= box2MineY && box2MaxeY <= box1MaxeY && box1MineZ <= box2MineZ && box2MaxeZ <= box1MaxeZ) {\r\n            return ContainmentType.Contains;\r\n        }\r\n\r\n        return ContainmentType.Intersects;\r\n    }\r\n\r\n\r\n    /**\r\n     * \r\n     * @param\tbox \r\n     * @param   sphere \r\n     * @return  :0 ,1 , 2 \r\n     */\r\n    static boxContainsSphere(box: BoundBox, sphere: BoundSphere): number {\r\n\r\n        var boxMin: Vector3 = box.min;\r\n        var boxMineX: number = boxMin.x;\r\n        var boxMineY: number = boxMin.y;\r\n        var boxMineZ: number = boxMin.z;\r\n\r\n        var boxMax: Vector3 = box.max;\r\n        var boxMaxeX: number = boxMax.x;\r\n        var boxMaxeY: number = boxMax.y;\r\n        var boxMaxeZ: number = boxMax.z;\r\n\r\n        var sphereC: Vector3 = sphere.center;\r\n        var sphereCeX: number = sphereC.x;\r\n        var sphereCeY: number = sphereC.y;\r\n        var sphereCeZ: number = sphereC.z;\r\n\r\n        var sphereR: number = sphere.radius;\r\n\r\n        Vector3.Clamp(sphereC, boxMin, boxMax, CollisionUtils._tempV30);\r\n        var distance: number = Vector3.distanceSquared(sphereC, CollisionUtils._tempV30);\r\n\r\n        if (distance > sphereR * sphereR)\r\n            return ContainmentType.Disjoint;\r\n\r\n        if ((((boxMineX + sphereR <= sphereCeX) && (sphereCeX <= boxMaxeX - sphereR)) && ((boxMaxeX - boxMineX > sphereR) &&\r\n            (boxMineY + sphereR <= sphereCeY))) && (((sphereCeY <= boxMaxeY - sphereR) && (boxMaxeY - boxMineY > sphereR)) &&\r\n                (((boxMineZ + sphereR <= sphereCeZ) && (sphereCeZ <= boxMaxeZ - sphereR)) && (boxMaxeZ - boxMineZ > sphereR))))\r\n            return ContainmentType.Contains;\r\n\r\n        return ContainmentType.Intersects;\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @param\tsphere \r\n     * @param   point \r\n     * @return  :0 ,1 , 2 \r\n     */\r\n    static sphereContainsPoint(sphere: BoundSphere, point: Vector3): number {\r\n\r\n        if (Vector3.distanceSquared(point, sphere.center) <= sphere.radius * sphere.radius)\r\n            return ContainmentType.Contains;\r\n\r\n        return ContainmentType.Disjoint;\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @param\tsphere\r\n     * @param\tvertex1 1\r\n     * @param\tvertex2 2\r\n     * @param\tvertex3 3\r\n     * @return  \r\n     */\r\n    static sphereContainsTriangle(sphere: BoundSphere, vertex1: Vector3, vertex2: Vector3, vertex3: Vector3): number {\r\n        var test1: number = CollisionUtils.sphereContainsPoint(sphere, vertex1);\r\n        var test2: number = CollisionUtils.sphereContainsPoint(sphere, vertex2);\r\n        var test3: number = CollisionUtils.sphereContainsPoint(sphere, vertex3);\r\n\r\n        if (test1 == ContainmentType.Contains && test2 == ContainmentType.Contains && test3 == ContainmentType.Contains)\r\n            return ContainmentType.Contains;\r\n\r\n        if (CollisionUtils.intersectsSphereAndTriangle(sphere, vertex1, vertex2, vertex3))\r\n            return ContainmentType.Intersects;\r\n\r\n        return ContainmentType.Disjoint;\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @param\tsphere \r\n     * @param   box \r\n     * @return  :0 ,1 , 2 \r\n     */\r\n    static sphereContainsBox(sphere: BoundSphere, box: BoundBox): number {\r\n\r\n        var sphereC: Vector3 = sphere.center;\r\n        var sphereCeX: number = sphereC.x;\r\n        var sphereCeY: number = sphereC.y;\r\n        var sphereCeZ: number = sphereC.z;\r\n\r\n        var sphereR: number = sphere.radius;\r\n\r\n        var boxMin: Vector3 = box.min;\r\n        var boxMineX: number = boxMin.x;\r\n        var boxMineY: number = boxMin.y;\r\n        var boxMineZ: number = boxMin.z;\r\n\r\n        var boxMax: Vector3 = box.max;\r\n        var boxMaxeX: number = boxMax.x;\r\n        var boxMaxeY: number = boxMax.y;\r\n        var boxMaxeZ: number = boxMax.z;\r\n\r\n        var _tempV30e: Vector3 = CollisionUtils._tempV30;\r\n        var _tempV30eX: number = _tempV30e.x;\r\n        var _tempV30eY: number = _tempV30e.y;\r\n        var _tempV30eZ: number = _tempV30e.z;\r\n\r\n        if (!CollisionUtils.intersectsBoxAndSphere(box, sphere))\r\n            return ContainmentType.Disjoint;\r\n\r\n        var radiusSquared: number = sphereR * sphereR;\r\n\r\n        _tempV30eX = sphereCeX - boxMineX;\r\n        _tempV30eY = sphereCeY - boxMaxeY;\r\n        _tempV30eZ = sphereCeZ - boxMaxeZ;\r\n        if (Vector3.scalarLengthSquared(CollisionUtils._tempV30) > radiusSquared)\r\n            return ContainmentType.Intersects;\r\n\r\n        _tempV30eX = sphereCeX - boxMaxeX;\r\n        _tempV30eY = sphereCeY - boxMaxeY;\r\n        _tempV30eZ = sphereCeZ - boxMaxeZ;\r\n        if (Vector3.scalarLengthSquared(CollisionUtils._tempV30) > radiusSquared)\r\n            return ContainmentType.Intersects;\r\n\r\n        _tempV30eX = sphereCeX - boxMaxeX;\r\n        _tempV30eY = sphereCeY - boxMineY;\r\n        _tempV30eZ = sphereCeZ - boxMaxeZ;\r\n        if (Vector3.scalarLengthSquared(CollisionUtils._tempV30) > radiusSquared)\r\n            return ContainmentType.Intersects;\r\n\r\n        _tempV30eX = sphereCeX - boxMineX;\r\n        _tempV30eY = sphereCeY - boxMineY;\r\n        _tempV30eZ = sphereCeZ - boxMaxeZ;\r\n        if (Vector3.scalarLengthSquared(CollisionUtils._tempV30) > radiusSquared)\r\n            return ContainmentType.Intersects;\r\n\r\n        _tempV30eX = sphereCeX - boxMineX;\r\n        _tempV30eY = sphereCeY - boxMaxeY;\r\n        _tempV30eZ = sphereCeZ - boxMineZ;\r\n        if (Vector3.scalarLengthSquared(CollisionUtils._tempV30) > radiusSquared)\r\n            return ContainmentType.Intersects;\r\n\r\n        _tempV30eX = sphereCeX - boxMaxeX;\r\n        _tempV30eY = sphereCeY - boxMaxeY;\r\n        _tempV30eZ = sphereCeZ - boxMineZ;\r\n        if (Vector3.scalarLengthSquared(CollisionUtils._tempV30) > radiusSquared)\r\n            return ContainmentType.Intersects;\r\n\r\n        _tempV30eX = sphereCeX - boxMaxeX;\r\n        _tempV30eY = sphereCeY - boxMineY;\r\n        _tempV30eZ = sphereCeZ - boxMineZ;\r\n        if (Vector3.scalarLengthSquared(CollisionUtils._tempV30) > radiusSquared)\r\n            return ContainmentType.Intersects;\r\n\r\n        _tempV30eX = sphereCeX - boxMineX;\r\n        _tempV30eY = sphereCeY - boxMineY;\r\n        _tempV30eZ = sphereCeZ - boxMineZ;\r\n        if (Vector3.scalarLengthSquared(CollisionUtils._tempV30) > radiusSquared)\r\n            return ContainmentType.Intersects;\r\n\r\n        return ContainmentType.Contains;\r\n\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @param\tsphere1 \r\n     * @param   sphere2 \r\n     * @return  :0 ,1 , 2 \r\n     */\r\n    static sphereContainsSphere(sphere1: BoundSphere, sphere2: BoundSphere): number {\r\n\r\n        var sphere1R: number = sphere1.radius;\r\n        var sphere2R: number = sphere2.radius;\r\n\r\n        var distance: number = Vector3.distance(sphere1.center, sphere2.center);\r\n\r\n        if (sphere1R + sphere2R < distance)\r\n            return ContainmentType.Disjoint;\r\n\r\n        if (sphere1R - sphere2R < distance)\r\n            return ContainmentType.Intersects;\r\n\r\n        return ContainmentType.Contains;\r\n    }\r\n\r\n\r\n    /**\r\n     * \r\n     * @param\tpoint \r\n     * @param\tvertex1 1\r\n     * @param\tvertex2\t2\r\n     * @param\tvertex3 3\r\n     * @param\tout \r\n     */\r\n    static closestPointPointTriangle(point: Vector3, vertex1: Vector3, vertex2: Vector3, vertex3: Vector3, out: Vector3): void {\r\n\r\n        Vector3.subtract(vertex2, vertex1, CollisionUtils._tempV30);\r\n        Vector3.subtract(vertex3, vertex1, CollisionUtils._tempV31);\r\n\r\n        Vector3.subtract(point, vertex1, CollisionUtils._tempV32);\r\n        Vector3.subtract(point, vertex2, CollisionUtils._tempV33);\r\n        Vector3.subtract(point, vertex3, CollisionUtils._tempV34);\r\n\r\n        var d1: number = Vector3.dot(CollisionUtils._tempV30, CollisionUtils._tempV32);\r\n        var d2: number = Vector3.dot(CollisionUtils._tempV31, CollisionUtils._tempV32);\r\n        var d3: number = Vector3.dot(CollisionUtils._tempV30, CollisionUtils._tempV33);\r\n        var d4: number = Vector3.dot(CollisionUtils._tempV31, CollisionUtils._tempV33);\r\n        var d5: number = Vector3.dot(CollisionUtils._tempV30, CollisionUtils._tempV34);\r\n        var d6: number = Vector3.dot(CollisionUtils._tempV31, CollisionUtils._tempV34);\r\n\r\n        if (d1 <= 0 && d2 <= 0) {\r\n            vertex1.cloneTo(out);\r\n            return;\r\n        }\r\n\r\n        if (d3 >= 0 && d4 <= d3) {\r\n            vertex2.cloneTo(out);\r\n            return;\r\n        }\r\n\r\n        var vc: number = d1 * d4 - d3 * d2;\r\n        if (vc <= 0 && d1 >= 0 && d3 <= 0) {\r\n            var v: number = d1 / (d1 - d3);\r\n            Vector3.scale(CollisionUtils._tempV30, v, out);\r\n            Vector3.add(vertex1, out, out);\r\n            return;\r\n        }\r\n\r\n        if (d6 >= 0 && d5 <= d6) {\r\n            vertex3.cloneTo(out);\r\n            return;\r\n        }\r\n\r\n        var vb: number = d5 * d2 - d1 * d6;\r\n        if (vb <= 0 && d2 >= 0 && d6 <= 0) {\r\n            var w: number = d2 / (d2 - d6);\r\n            Vector3.scale(CollisionUtils._tempV31, w, out);\r\n            Vector3.add(vertex1, out, out);\r\n            return;\r\n        }\r\n\r\n        var va: number = d3 * d6 - d5 * d4;\r\n        if (va <= 0 && (d4 - d3) >= 0 && (d5 - d6) >= 0) {\r\n            var w3: number = (d4 - d3) / ((d4 - d3) + (d5 - d6));\r\n            Vector3.subtract(vertex3, vertex2, out);\r\n            Vector3.scale(out, w3, out);\r\n            Vector3.add(vertex2, out, out);\r\n            return;\r\n        }\r\n\r\n        var denom: number = 1 / (va + vb + vc);\r\n        var v2: number = vb * denom;\r\n        var w2: number = vc * denom;\r\n        Vector3.scale(CollisionUtils._tempV30, v2, CollisionUtils._tempV35);\r\n        Vector3.scale(CollisionUtils._tempV31, w2, CollisionUtils._tempV36);\r\n        Vector3.add(CollisionUtils._tempV35, CollisionUtils._tempV36, out);\r\n        Vector3.add(vertex1, out, out);\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @param\tplane \r\n     * @param\tpoint \r\n     * @param\tout \r\n     */\r\n    static closestPointPlanePoint(plane: Plane, point: Vector3, out: Vector3): void {\r\n\r\n        var planeN: Vector3 = plane.normal;\r\n        var t: number = Vector3.dot(planeN, point) - plane.distance;\r\n\r\n        Vector3.scale(planeN, t, CollisionUtils._tempV30);\r\n        Vector3.subtract(point, CollisionUtils._tempV30, out);\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @param\tbox \r\n     * @param\tpoint \r\n     * @param\tout \r\n     */\r\n    static closestPointBoxPoint(box: BoundBox, point: Vector3, out: Vector3): void {\r\n        Vector3.max(point, box.min, CollisionUtils._tempV30);\r\n        Vector3.min(CollisionUtils._tempV30, box.max, out);\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @param\tsphere \r\n     * @param\tpoint \r\n     * @param\tout \r\n     */\r\n    static closestPointSpherePoint(sphere: BoundSphere, point: Vector3, out: Vector3): void {\r\n        var sphereC: Vector3 = sphere.center;\r\n\r\n        Vector3.subtract(point, sphereC, out);\r\n        Vector3.normalize(out, out);\r\n\r\n        Vector3.scale(out, sphere.radius, out);\r\n        Vector3.add(out, sphereC, out);\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @param\tsphere1 1\r\n     * @param\tsphere2 2\r\n     * @param\tout \r\n     */\r\n    static closestPointSphereSphere(sphere1: BoundSphere, sphere2: BoundSphere, out: Vector3): void {\r\n        var sphere1C: Vector3 = sphere1.center;\r\n\r\n        Vector3.subtract(sphere2.center, sphere1C, out);\r\n        Vector3.normalize(out, out);\r\n\r\n        Vector3.scale(out, sphere1.radius, out);\r\n        Vector3.add(out, sphere1C, out);\r\n    }\r\n\r\n}\r\n\r\n\r\n\r\n","import { Matrix4x4 } from \"../../maths/Matrix4x4\";\r\nimport { Vector3 } from \"../../maths/Vector3\";\r\nimport { Vector4 } from \"../../maths/Vector4\";\r\n\r\n/**\r\n * <code>Viewport</code> \r\n */\r\nexport class Viewport {\r\n\t/** @internal */\r\n\tstatic _tempMatrix4x4: Matrix4x4 = new Matrix4x4();\r\n\tstatic _tempViewport: Viewport = new Viewport(0, 0, 0, 0);\r\n\t/**X*/\r\n\tx: number;\r\n\t/**Y*/\r\n\ty: number;\r\n\t/***/\r\n\twidth: number;\r\n\t/***/\r\n\theight: number;\r\n\t/***/\r\n\tminDepth: number;\r\n\t/***/\r\n\tmaxDepth: number;\r\n\r\n\t/**\r\n\t *  <code>Viewport</code> \r\n\t * @param\tx x\r\n\t * @param\ty y\r\n\t * @param\twidth \r\n\t * @param\theight \r\n\t */\r\n\tconstructor(x?: number, y?: number, width?: number, height?: number) {\r\n\t\tthis.minDepth = 0.0;\r\n\t\tthis.maxDepth = 1.0;\r\n\r\n\t\tthis.x = x ?? 0;\r\n\t\tthis.y = y ?? 0;\r\n\t\tthis.width = width ?? 0;\r\n\t\tthis.height = height ?? 0;\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t * @param\tsource \r\n\t * @param\tmatrix \r\n\t * @param\tout xyz,wz\r\n\t */\r\n\tproject(source: Vector3, matrix: Matrix4x4, out: Vector4): void {\r\n\t\tVector3.transformV3ToV4(source, matrix, out);\r\n\t\tvar x: number = out.x, y: number = out.y, z: number = out.z;\r\n\t\tvar w: number = out.w;\r\n\t\tif (w !== 1.0) {\r\n\t\t\tx = x / w;\r\n\t\t\ty = y / w;\r\n\t\t\tz = z / w;\r\n\t\t}\r\n\t\tout.x = (x + 1.0) * 0.5 * this.width + this.x;\r\n\t\tout.y = (-y + 1.0) * 0.5 * this.height + this.y;\r\n\t\tout.z = z * (this.maxDepth - this.minDepth) + this.minDepth;\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t * @param\tsource \r\n\t * @param\tmatrix \r\n\t * @param\tout \r\n\t */\r\n\tunprojectFromMat(source: Vector3, matrix: Matrix4x4, out: Vector3): void {\r\n\t\tvar matrixEleme: Float32Array = matrix.elements;\r\n\r\n\t\tout.x = (((source.x - this.x) / this.width) * 2.0) - 1.0;\r\n\t\tout.y = -((((source.y - this.y) / this.height) * 2.0) - 1.0);\r\n\t\tout.z = (source.z - this.minDepth) / (this.maxDepth - this.minDepth);\r\n\t\tvar a: number = (((out.x * matrixEleme[3]) + (out.y * matrixEleme[7])) + (out.z * matrixEleme[11])) + matrixEleme[15];\r\n\t\tVector3.transformV3ToV3(out, matrix, out);\r\n\t\tif (a !== 1.0) {\r\n\t\t\tout.x = out.x / a;\r\n\t\t\tout.y = out.y / a;\r\n\t\t\tout.z = out.z / a;\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t * @param\tsource \r\n\t * @param\tprojection  \r\n\t * @param\tview \r\n\t * @param\tworld ,null\r\n\t * @param   out \r\n\t */\r\n\tunprojectFromWVP(source: Vector3, projection: Matrix4x4, view: Matrix4x4, world: Matrix4x4, out: Vector3): void {\r\n\r\n\t\tMatrix4x4.multiply(projection, view, Viewport._tempMatrix4x4);\r\n\t\t(world) && (Matrix4x4.multiply(Viewport._tempMatrix4x4, world, Viewport._tempMatrix4x4));\r\n\t\tViewport._tempMatrix4x4.invert(Viewport._tempMatrix4x4);\r\n\t\tthis.unprojectFromMat(source, Viewport._tempMatrix4x4, out);\r\n\t}\r\n\r\n\tset(x: number, y: number, width: number, height: number) {\r\n\t\tthis.x = x;\r\n\t\tthis.y = y;\r\n\t\tthis.width = width;\r\n\t\tthis.height = height;\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t * @param\tout\r\n\t */\r\n\tcloneTo(out: Viewport): void {\r\n\t\tout.x = this.x;\r\n\t\tout.y = this.y;\r\n\t\tout.width = this.width;\r\n\t\tout.height = this.height;\r\n\t\tout.minDepth = this.minDepth;\r\n\t\tout.maxDepth = this.maxDepth;\r\n\t}\r\n}\r\n\r\n\r\n","\r\nimport { Matrix4x4 } from \"../../maths/Matrix4x4\";\r\nimport { Vector2 } from \"../../maths/Vector2\";\r\nimport { Vector3 } from \"../../maths/Vector3\";\r\nimport { Plane } from \"../math/Plane\"\r\nimport { Ray } from \"../math/Ray\"\r\n\r\nimport { Viewport } from \"../math/Viewport\"\r\n\r\n/**\r\n * <code>Picker</code> \r\n */\r\nexport class Picker {\r\n\tprivate static _tempVector30: Vector3 = new Vector3();\r\n\tprivate static _tempVector31: Vector3 = new Vector3();\r\n\tprivate static _tempVector32: Vector3 = new Vector3();\r\n\tprivate static _tempVector33: Vector3 = new Vector3();\r\n\tprivate static _tempVector34: Vector3 = new Vector3();\r\n\r\n\t/**\r\n\t *  <code>Picker</code> \r\n\t */\r\n\tconstructor() {\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t * @param\tpoint \r\n\t * @param\tviewPort \r\n\t * @param\tprojectionMatrix \r\n\t * @param\tviewMatrix \r\n\t * @param\tworld \r\n\t * @return  out  \r\n\t */\r\n\tstatic calculateCursorRay(point: Vector2, viewPort: Viewport, projectionMatrix: Matrix4x4, viewMatrix: Matrix4x4, world: Matrix4x4, out: Ray): void {\r\n\r\n\t\tvar x: number = point.x;\r\n\t\tvar y: number = point.y;\r\n\r\n\t\tvar nearSource: Vector3 = Picker._tempVector30;\r\n\t\tvar nerSourceE: Vector3 = nearSource;\r\n\t\tnerSourceE.x = x;\r\n\t\tnerSourceE.y = y;\r\n\t\tnerSourceE.z = viewPort.minDepth;\r\n\r\n\t\tvar farSource: Vector3 = Picker._tempVector31;\r\n\t\tvar farSourceE: Vector3 = farSource;\r\n\t\tfarSourceE.x = x;\r\n\t\tfarSourceE.y = y;\r\n\t\tfarSourceE.z = viewPort.maxDepth;\r\n\r\n\t\tvar nearPoint: Vector3 = out.origin;\r\n\t\tvar farPoint: Vector3 = Picker._tempVector32;\r\n\r\n\t\tviewPort.unprojectFromWVP(nearSource, projectionMatrix, viewMatrix, world, nearPoint);\r\n\t\tviewPort.unprojectFromWVP(farSource, projectionMatrix, viewMatrix, world, farPoint);\r\n\r\n\t\tvar outDire: Vector3 = out.direction;\r\n\t\toutDire.x = farPoint.x - nearPoint.x;\r\n\t\toutDire.y = farPoint.y - nearPoint.y;\r\n\t\toutDire.z = farPoint.z - nearPoint.z;\r\n\t\tVector3.normalize(out.direction, out.direction);\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t * @param\tray \r\n\t * @param\tvertex1 1\r\n\t * @param\tvertex2 2\r\n\t * @param\tvertex3 3\r\n\t * @return   Number.NaN\r\n\t */\r\n\tstatic rayIntersectsTriangle(ray: Ray, vertex1: Vector3, vertex2: Vector3, vertex3: Vector3): number {\r\n\r\n\t\tvar result: number;\r\n\t\t// Compute vectors along two edges of the triangle.\r\n\t\tvar edge1: Vector3 = Picker._tempVector30, edge2: Vector3 = Picker._tempVector31;\r\n\r\n\t\tVector3.subtract(vertex2, vertex1, edge1);\r\n\t\tVector3.subtract(vertex3, vertex1, edge2);\r\n\r\n\t\t// Compute the determinant.\r\n\t\tvar directionCrossEdge2: Vector3 = Picker._tempVector32;\r\n\t\tVector3.cross(ray.direction, edge2, directionCrossEdge2);\r\n\r\n\t\tvar determinant: number;\r\n\t\tdeterminant = Vector3.dot(edge1, directionCrossEdge2);\r\n\r\n\t\t// If the ray is parallel to the triangle plane, there is no collision.\r\n\t\tif (determinant > -Number.MIN_VALUE && determinant < Number.MIN_VALUE) {\r\n\t\t\tresult = Number.NaN;\r\n\t\t\treturn result;\r\n\t\t}\r\n\r\n\t\tvar inverseDeterminant: number = 1.0 / determinant;\r\n\r\n\t\t// Calculate the U parameter of the intersection point.\r\n\t\tvar distanceVector: Vector3 = Picker._tempVector33;\r\n\t\tVector3.subtract(ray.origin, vertex1, distanceVector);\r\n\r\n\t\tvar triangleU: number;\r\n\t\ttriangleU = Vector3.dot(distanceVector, directionCrossEdge2);\r\n\t\ttriangleU *= inverseDeterminant;\r\n\r\n\t\t// Make sure it is inside the triangle.\r\n\t\tif (triangleU < 0 || triangleU > 1) {\r\n\t\t\tresult = Number.NaN;\r\n\t\t\treturn result;\r\n\t\t}\r\n\r\n\t\t// Calculate the V parameter of the intersection point.\r\n\t\tvar distanceCrossEdge1: Vector3 = Picker._tempVector34;\r\n\t\tVector3.cross(distanceVector, edge1, distanceCrossEdge1);\r\n\r\n\t\tvar triangleV: number;\r\n\t\ttriangleV = Vector3.dot(ray.direction, distanceCrossEdge1);\r\n\t\ttriangleV *= inverseDeterminant;\r\n\r\n\t\t// Make sure it is inside the triangle.\r\n\t\tif (triangleV < 0 || triangleU + triangleV > 1) {\r\n\t\t\tresult = Number.NaN;\r\n\t\t\treturn result;\r\n\t\t}\r\n\r\n\t\t// Compute the distance along the ray to the triangle.\r\n\t\tvar rayDistance: number;\r\n\t\trayDistance = Vector3.dot(edge2, distanceCrossEdge1);\r\n\t\trayDistance *= inverseDeterminant;\r\n\r\n\t\t// Is the triangle behind the ray origin?\r\n\t\tif (rayDistance < 0) {\r\n\t\t\tresult = Number.NaN;\r\n\t\t\treturn result;\r\n\t\t}\r\n\r\n\t\tresult = rayDistance;\r\n\t\treturn result;\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t * @param ray \r\n\t * @param plane \r\n\t * @returns \r\n\t */\r\n\tstatic rayPlaneIntersection(ray: Ray, plane: Plane): Vector3 {\r\n\t\tlet point = new Vector3();\r\n\t\tlet ddotn = Vector3.dot(ray.direction.normalize(), plane.normal.normalize());\r\n\t\tif (ddotn == 0) {\r\n\t\t\treturn null;\r\n\t\t}\r\n\r\n\t\tlet t = (-plane.distance - Vector3.dot(ray.origin, plane.normal)) / ddotn;\r\n\t\tif (t < 0)\r\n\t\t\treturn null;\r\n\t\tray.at(t, point);\r\n\t\treturn point;\r\n\t}\r\n}\r\n\r\n\r\n","import { Node } from \"../../display/Node\";\r\nimport { Sprite3D } from \"./Sprite3D\";\r\nimport { BaseRender } from \"./render/BaseRender\";\r\nimport { Shader3D } from \"../../RenderEngine/RenderShader/Shader3D\";\r\nimport { ShaderDefine } from \"../../RenderEngine/RenderShader/ShaderDefine\";\r\nimport { ShaderDataType } from \"../../RenderEngine/RenderShader/ShaderData\";\r\nimport { LayaGL } from \"../../layagl/LayaGL\";\r\n\r\n/**\r\n * @deprecated\r\n * <code>RenderableSprite3D</code> 3D\r\n */\r\nexport class RenderableSprite3D extends Sprite3D {\r\n\t/**,*/\r\n\tstatic SHADERDEFINE_RECEIVE_SHADOW: ShaderDefine;\r\n\t/**,*/\r\n\tstatic SAHDERDEFINE_LIGHTMAP: ShaderDefine;\r\n\t/**, */\r\n\tstatic SHADERDEFINE_LIGHTMAP_DIRECTIONAL: ShaderDefine;\r\n\t/***/\r\n\tstatic LIGHTMAPSCALEOFFSET: number;\r\n\t/***/\r\n\tstatic LIGHTMAP: number;\r\n\t/***/\r\n\tstatic LIGHTMAP_DIRECTION: number;\r\n\t/***/\r\n\tstatic PICKCOLOR: number;\r\n\r\n\r\n\t/**  */\r\n\tstatic REFLECTIONCUBE_PROBEPOSITION: number;\r\n\tstatic REFLECTIONCUBE_PROBEBOXMAX: number;\r\n\tstatic REFLECTIONCUBE_PROBEBOXMIN: number;\r\n\r\n\t/** volumetric GI */\r\n\r\n\tstatic VOLUMETRICGI_PROBECOUNTS: number;\r\n\tstatic VOLUMETRICGI_PROBESTEPS: number;\r\n\tstatic VOLUMETRICGI_PROBESTARTPOS: number;\r\n\tstatic VOLUMETRICGI_PROBEPARAMS: number;\r\n\tstatic VOLUMETRICGI_IRRADIANCE: number;\r\n\tstatic VOLUMETRICGI_DISTANCE: number;\r\n\r\n\t/** @internal */\r\n\tstatic IBLTEX: number;\r\n\t/** @internal */\r\n\tstatic IBLROUGHNESSLEVEL: number;\r\n\t/** @internal */\r\n\tstatic AMBIENTSH: number;\r\n\t/** @internal */\r\n\tstatic AMBIENTCOLOR: number;\r\n\t/** @internal */\r\n\tstatic AMBIENTINTENSITY: number;\r\n\t/** @internal */\r\n\tstatic REFLECTIONINTENSITY: number;\r\n\r\n\t/// Morph target\r\n\r\n\tstatic SHADERDEFINE_MORPHTARGET: ShaderDefine;\r\n\tstatic SHADERDEFINE_MORPHTARGET_POSITION: ShaderDefine;\r\n\tstatic SHADERDEFINE_MORPHTARGET_NORMAL: ShaderDefine;\r\n\tstatic SHADERDEFINE_MORPHTARGET_TANGENT: ShaderDefine;\r\n\r\n\t/** @internal */\r\n\tstatic MorphTex: number;\r\n\t/** @internal */\r\n\tstatic MorphParams: number;\r\n\t/** @internal */\r\n\tstatic MorphAttriOffset: number;\r\n\t/** @internal */\r\n\tstatic MorphActiceTargets: number;\r\n\t/** @internal */\r\n\tstatic MorphActiveWeights: number;\r\n\t/** @internal */\r\n\tstatic MorphActiveCount: number;\r\n\r\n\t//--------------------------------------------------------deprecated------------------------------------------------------------------------\r\n\t/**\r\n\t * @deprecated\r\n\t * @internal\r\n\t */\r\n\tstatic AMBIENTSHAR: number;\r\n\t/**\r\n\t * @deprecated\r\n\t * @internal\r\n\t */\r\n\tstatic AMBIENTSHAG: number;\r\n\t/**\r\n\t * @deprecated\r\n\t * @internal\r\n\t */\r\n\tstatic AMBIENTSHAB: number;\r\n\t/**\r\n\t * @deprecated\r\n\t * @internal\r\n\t */\r\n\tstatic AMBIENTSHBR: number;\r\n\t/**\r\n\t* @deprecated\r\n\t* @internal\r\n\t*/\r\n\tstatic AMBIENTSHBG: number;\r\n\t/**\r\n\t* @deprecated\r\n\t* @internal\r\n\t*/\r\n\tstatic AMBIENTSHBB: number;\r\n\t/**\r\n\t* @deprecated\r\n\t* @internal\r\n\t*/\r\n\tstatic AMBIENTSHC: number;\r\n\t/**\r\n\t * @deprecated\r\n\t *   \r\n\t */\r\n\tstatic REFLECTIONTEXTURE: number;\r\n\t/**\r\n\t * @deprecated\r\n\t *   \r\n\t */\r\n\tstatic REFLECTIONCUBE_HDR_PARAMS: number;\r\n\r\n\r\n\t/**\r\n\t * @internal\r\n\t */\r\n\tstatic __init__(): void {\r\n\t\tRenderableSprite3D.SHADERDEFINE_RECEIVE_SHADOW = Shader3D.getDefineByName(\"RECEIVESHADOW\");\r\n\t\tRenderableSprite3D.SAHDERDEFINE_LIGHTMAP = Shader3D.getDefineByName(\"LIGHTMAP\");\r\n\t\tRenderableSprite3D.SHADERDEFINE_LIGHTMAP_DIRECTIONAL = Shader3D.getDefineByName(\"LIGHTMAP_DIRECTIONAL\");\r\n\r\n\t\tRenderableSprite3D.LIGHTMAPSCALEOFFSET = Shader3D.propertyNameToID(\"u_LightmapScaleOffset\");\r\n\t\tRenderableSprite3D.LIGHTMAP = Shader3D.propertyNameToID(\"u_LightMap\");\r\n\t\tRenderableSprite3D.LIGHTMAP_DIRECTION = Shader3D.propertyNameToID(\"u_LightMapDirection\");\r\n\t\tRenderableSprite3D.PICKCOLOR = Shader3D.propertyNameToID(\"u_PickColor\");\r\n\r\n\t\tRenderableSprite3D.REFLECTIONCUBE_PROBEPOSITION = Shader3D.propertyNameToID(\"u_SpecCubeProbePosition\");\r\n\t\tRenderableSprite3D.REFLECTIONCUBE_PROBEBOXMAX = Shader3D.propertyNameToID(\"u_SpecCubeBoxMax\");\r\n\t\tRenderableSprite3D.REFLECTIONCUBE_PROBEBOXMIN = Shader3D.propertyNameToID(\"u_SpecCubeBoxMin\");\r\n\r\n\t\t// volumestric GI\r\n\t\tRenderableSprite3D.VOLUMETRICGI_PROBECOUNTS = Shader3D.propertyNameToID(\"u_VolumetricGI.probeCounts\");\r\n\t\tRenderableSprite3D.VOLUMETRICGI_PROBESTEPS = Shader3D.propertyNameToID(\"u_VolumetricGI.probeStep\");\r\n\t\tRenderableSprite3D.VOLUMETRICGI_PROBESTARTPOS = Shader3D.propertyNameToID(\"u_VolumetricGI.probeStartPosition\");\r\n\t\tRenderableSprite3D.VOLUMETRICGI_PROBEPARAMS = Shader3D.propertyNameToID(\"u_VolumetricGI.probeParams\");\r\n\t\tRenderableSprite3D.VOLUMETRICGI_IRRADIANCE = Shader3D.propertyNameToID(\"u_ProbeIrradiance\");\r\n\t\tRenderableSprite3D.VOLUMETRICGI_DISTANCE = Shader3D.propertyNameToID(\"u_ProbeDistance\");\r\n\r\n\t\t//ambient Color\r\n\t\tRenderableSprite3D.AMBIENTCOLOR = Shader3D.propertyNameToID(\"u_AmbientColor\");\r\n\t\t// sh \r\n\t\tRenderableSprite3D.AMBIENTSH = Shader3D.propertyNameToID(\"u_IblSH\");\r\n\t\t//GI instance\r\n\t\tRenderableSprite3D.AMBIENTINTENSITY = Shader3D.propertyNameToID(\"u_AmbientIntensity\");\r\n\t\tRenderableSprite3D.REFLECTIONINTENSITY = Shader3D.propertyNameToID(\"u_ReflectionIntensity\");\r\n\t\tRenderableSprite3D.IBLTEX = Shader3D.propertyNameToID(\"u_IBLTex\");\r\n\t\tRenderableSprite3D.IBLROUGHNESSLEVEL = Shader3D.propertyNameToID(\"u_IBLRoughnessLevel\");\r\n\r\n\t\tconst commandUniform = LayaGL.renderOBJCreate.createGlobalUniformMap(\"Sprite3D\");\r\n\r\n\t\t/// morph target\r\n\r\n\t\tRenderableSprite3D.SHADERDEFINE_MORPHTARGET = Shader3D.getDefineByName(\"MORPHTARGETS\");\r\n\t\tRenderableSprite3D.SHADERDEFINE_MORPHTARGET_POSITION = Shader3D.getDefineByName(\"MORPHTARGETS_POSITION\");\r\n\t\tRenderableSprite3D.SHADERDEFINE_MORPHTARGET_NORMAL = Shader3D.getDefineByName(\"MORPHTARGETS_NORMAL\");\r\n\t\tRenderableSprite3D.SHADERDEFINE_MORPHTARGET_TANGENT = Shader3D.getDefineByName(\"MORPHTARGETS_TANGENT\");\r\n\r\n\t\tRenderableSprite3D.MorphTex = Shader3D.propertyNameToID(\"u_MorphTargetsTex\");\r\n\t\tRenderableSprite3D.MorphParams = Shader3D.propertyNameToID(\"u_MorphParams\");\r\n\t\tRenderableSprite3D.MorphAttriOffset = Shader3D.propertyNameToID(\"u_MorphAttrOffset\");\r\n\t\tRenderableSprite3D.MorphActiceTargets = Shader3D.propertyNameToID(\"u_MorphActiveTargets\");\r\n\t\tRenderableSprite3D.MorphActiveWeights = Shader3D.propertyNameToID(\"u_MorphTargetWeights\");\r\n\t\tRenderableSprite3D.MorphActiveCount = Shader3D.propertyNameToID(\"u_MorphTargetActiveCount\");\r\n\r\n\t\tcommandUniform.addShaderUniform(RenderableSprite3D.MorphTex, \"u_MorphTargetsTex\",ShaderDataType.Texture2D);\r\n\t\tcommandUniform.addShaderUniform(RenderableSprite3D.MorphParams, \"u_MorphParams\",ShaderDataType.Vector4);\r\n\t\tcommandUniform.addShaderUniform(RenderableSprite3D.MorphAttriOffset, \"u_MorphAttrOffset\",ShaderDataType.Vector4);\r\n\t\tcommandUniform.addShaderUniform(RenderableSprite3D.MorphActiceTargets, \"u_MorphActiveTargets\",ShaderDataType.Buffer);\r\n\t\tcommandUniform.addShaderUniform(RenderableSprite3D.MorphActiveWeights, \"u_MorphTargetWeights\",ShaderDataType.Buffer);\r\n\t\tcommandUniform.addShaderUniform(RenderableSprite3D.MorphActiveCount, \"u_MorphTargetActiveCount\",ShaderDataType.Int);\r\n\r\n\t\tcommandUniform.addShaderUniform(RenderableSprite3D.LIGHTMAPSCALEOFFSET, \"u_LightmapScaleOffset\",ShaderDataType.Vector4);\r\n\t\tcommandUniform.addShaderUniform(RenderableSprite3D.LIGHTMAP, \"u_LightMap\",ShaderDataType.Texture2D);\r\n\t\tcommandUniform.addShaderUniform(RenderableSprite3D.LIGHTMAP_DIRECTION, \"u_LightMapDirection\",ShaderDataType.Texture2D);\r\n\t\tcommandUniform.addShaderUniform(RenderableSprite3D.PICKCOLOR, \"u_PickColor\",ShaderDataType.Vector3);\r\n\r\n\t\tcommandUniform.addShaderUniform(RenderableSprite3D.REFLECTIONCUBE_PROBEPOSITION, \"u_SpecCubeProbePosition\",ShaderDataType.Vector3);\r\n\t\tcommandUniform.addShaderUniform(RenderableSprite3D.REFLECTIONCUBE_PROBEBOXMAX, \"u_SpecCubeBoxMax\",ShaderDataType.Vector3);\r\n\t\tcommandUniform.addShaderUniform(RenderableSprite3D.REFLECTIONCUBE_PROBEBOXMIN, \"u_SpecCubeBoxMin\",ShaderDataType.Vector3);\r\n\t\tcommandUniform.addShaderUniform(RenderableSprite3D.IBLTEX, \"u_IBLTex\",ShaderDataType.Texture2D);\r\n\t\tcommandUniform.addShaderUniform(RenderableSprite3D.IBLROUGHNESSLEVEL, \"u_IBLRoughnessLevel\",ShaderDataType.Float);\r\n\t\tcommandUniform.addShaderUniform(RenderableSprite3D.VOLUMETRICGI_PROBECOUNTS, \"u_VolumetricGI.probeCounts\",ShaderDataType.Vector3);\r\n\t\tcommandUniform.addShaderUniform(RenderableSprite3D.VOLUMETRICGI_PROBESTEPS, \"u_VolumetricGI.probeStep\",ShaderDataType.Vector3);\r\n\t\tcommandUniform.addShaderUniform(RenderableSprite3D.VOLUMETRICGI_PROBESTARTPOS, \"u_VolumetricGI.probeStartPosition\",ShaderDataType.Vector3);\r\n\t\tcommandUniform.addShaderUniform(RenderableSprite3D.VOLUMETRICGI_PROBEPARAMS, \"u_VolumetricGI.probeParams\",ShaderDataType.Vector4);\r\n\t\tcommandUniform.addShaderUniform(RenderableSprite3D.VOLUMETRICGI_IRRADIANCE, \"u_ProbeIrradiance\",ShaderDataType.Texture2D);\r\n\t\tcommandUniform.addShaderUniform(RenderableSprite3D.VOLUMETRICGI_DISTANCE, \"u_ProbeDistance\",ShaderDataType.Texture2D);\r\n\t\tcommandUniform.addShaderUniform(RenderableSprite3D.AMBIENTSH, \"u_IblSH\",ShaderDataType.Buffer);\r\n\t\tcommandUniform.addShaderUniform(RenderableSprite3D.AMBIENTCOLOR, \"u_AmbientColor\",ShaderDataType.Vector4);\r\n\t\tcommandUniform.addShaderUniform(RenderableSprite3D.AMBIENTINTENSITY, \"u_AmbientIntensity\",ShaderDataType.Float);\r\n\t\tcommandUniform.addShaderUniform(RenderableSprite3D.REFLECTIONINTENSITY, \"u_ReflectionIntensity\",ShaderDataType.Float);\r\n\r\n\t\t//Legency Reflectexture\r\n\t\tRenderableSprite3D.REFLECTIONTEXTURE = Shader3D.propertyNameToID(\"u_ReflectTexture\");\r\n\t\tRenderableSprite3D.REFLECTIONCUBE_HDR_PARAMS = Shader3D.propertyNameToID(\"u_ReflectCubeHDRParams\");\r\n\t\tcommandUniform.addShaderUniform(RenderableSprite3D.REFLECTIONTEXTURE, \"u_ReflectTexture\",ShaderDataType.TextureCube);\r\n\t\tcommandUniform.addShaderUniform(RenderableSprite3D.REFLECTIONCUBE_HDR_PARAMS, \"u_ReflectCubeHDRParams\",ShaderDataType.Vector4);\r\n\t\t// legacy sh\r\n\t\tRenderableSprite3D.AMBIENTSHAR = Shader3D.propertyNameToID(\"u_AmbientSHAr\");\r\n\t\tcommandUniform.addShaderUniform(RenderableSprite3D.AMBIENTSHAR, \"u_AmbientSHAr\",ShaderDataType.Vector4);\r\n\t\tRenderableSprite3D.AMBIENTSHAG = Shader3D.propertyNameToID(\"u_AmbientSHAg\");\r\n\t\tcommandUniform.addShaderUniform(RenderableSprite3D.AMBIENTSHAG, \"u_AmbientSHAg\",ShaderDataType.Vector4);\r\n\t\tRenderableSprite3D.AMBIENTSHAB = Shader3D.propertyNameToID(\"u_AmbientSHAb\");\r\n\t\tcommandUniform.addShaderUniform(RenderableSprite3D.AMBIENTSHAB, \"u_AmbientSHAb\",ShaderDataType.Vector4);\r\n\t\tRenderableSprite3D.AMBIENTSHBR = Shader3D.propertyNameToID(\"u_AmbientSHBr\");\r\n\t\tcommandUniform.addShaderUniform(RenderableSprite3D.AMBIENTSHBR, \"u_AmbientSHBr\",ShaderDataType.Vector4);\r\n\t\tRenderableSprite3D.AMBIENTSHBG = Shader3D.propertyNameToID(\"u_AmbientSHBg\");\r\n\t\tcommandUniform.addShaderUniform(RenderableSprite3D.AMBIENTSHBG, \"u_AmbientSHBg\",ShaderDataType.Vector4);\r\n\t\tRenderableSprite3D.AMBIENTSHBB = Shader3D.propertyNameToID(\"u_AmbientSHBb\");\r\n\t\tcommandUniform.addShaderUniform(RenderableSprite3D.AMBIENTSHBB, \"u_AmbientSHBb\",ShaderDataType.Vector4);\r\n\t\tRenderableSprite3D.AMBIENTSHC = Shader3D.propertyNameToID(\"u_AmbientSHC\");\r\n\t\tcommandUniform.addShaderUniform(RenderableSprite3D.AMBIENTSHC, \"u_AmbientSHC\",ShaderDataType.Vector4);\r\n\t}\r\n\r\n\t/** @internal */\r\n\t_render: BaseRender;\r\n\r\n\t/**\r\n\t * @deprecated\r\n\t *  <code>RenderableSprite3D</code> \r\n\t */\r\n\tconstructor(name: string) {\r\n\t\tsuper(name);\r\n\t}\r\n\r\n\t/** \r\n\t * @inheritDoc\r\n\t * @override\r\n\t */\r\n\tprotected _onInActive(): void {\r\n\t\tsuper._onInActive();\r\n\t}\r\n\r\n\t/** \r\n\t * @inheritDoc\r\n\t * @override\r\n\t */\r\n\tprotected _onActive(): void {\r\n\t\tsuper._onActive();\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t * @override\r\n\t */\r\n\tprotected _onActiveInScene(): void {\r\n\t\tsuper._onActiveInScene();\r\n\t}\r\n\r\n\t/**\r\n\t * @internal\r\n\t */\r\n\tprotected _create(): Node {\r\n\t\treturn new Sprite3D(this.name);\r\n\t}\r\n\r\n\t/**\r\n\t * @internal\r\n\t */\r\n\t_addToInitStaticBatchManager(): void {\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t * @internal\r\n\t * @override\r\n\t */\r\n\t_setBelongScene(scene: Node): void {\r\n\t\tsuper._setBelongScene(scene);\r\n\t\t//this._render._setBelongScene(<Scene3D>scene);\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t * @internal\r\n\t * @override\r\n\t */\r\n\t_setUnBelongScene(): void {\r\n\t\tsuper._setUnBelongScene();\r\n\t}\r\n}\r\n\r\n\r\n","import { ShaderDefine } from \"../../RenderEngine/RenderShader/ShaderDefine\";\r\n\r\n/**\r\n * \r\n */\r\nexport class MeshSprite3DShaderDeclaration {\r\n\t/**UV0 */\r\n\tstatic SHADERDEFINE_UV0: ShaderDefine;\r\n\t/** */\r\n\tstatic SHADERDEFINE_COLOR: ShaderDefine;\r\n\t/**UV1 */\r\n\tstatic SHADERDEFINE_UV1: ShaderDefine;\r\n\t/** Tangent  */\r\n\tstatic SHADERDEFINE_TANGENT: ShaderDefine;\r\n\t/**instance */\r\n\tstatic SHADERDEFINE_GPU_INSTANCE: ShaderDefine;\r\n\t\r\n}\r\n","import { Matrix4x4 } from \"../../maths/Matrix4x4\";\r\nimport { Vector3 } from \"../../maths/Vector3\";\r\nimport { IClone } from \"../../utils/IClone\";\r\nimport { Laya3DRender } from \"../RenderObjs/Laya3DRender\";\r\nimport { BoundBox } from \"./BoundBox\";\r\n\r\n/**\r\n * <code>Bounds</code> \r\n */\r\nexport class Bounds implements IClone {\r\n    /**\r\n     * \r\n     * @param\tbox1 1\r\n     * @param\tbox2 2\r\n     * @param\tout \r\n     */\r\n    static merge(box1: Bounds, box2: Bounds, out: Bounds): void {\r\n        Vector3.min(box1.min, box2.min, out.min);\r\n        Vector3.max(box1.max, box2.max, out.max);\r\n        out.min = out.min;\r\n        out.max = out.max;\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @param box \r\n     * @param point \r\n     * @returns \r\n     */\r\n    static containPoint(box: Bounds, point: Vector3): boolean {\r\n        let max = box.getMax();\r\n        let min = box.getMin();\r\n        if (point.x > max.x || point.x < min.x) return false;\r\n        if (point.y > max.y || point.y < min.y) return false;\r\n        if (point.z > max.z || point.z < min.z) return false;\r\n        return true;\r\n    }\r\n\r\n\r\n    /**@internal */\r\n    static _UPDATE_MIN: number = 0x01;\r\n    /**@internal */\r\n    static _UPDATE_MAX: number = 0x02;\r\n    /**@internal */\r\n    static _UPDATE_CENTER: number = 0x04;\r\n    /**@internal */\r\n    static _UPDATE_EXTENT: number = 0x08;\r\n\r\n    /**@internal\t*/\r\n    _imp: any;\r\n\r\n    get min() {\r\n        return this.getMin();\r\n    }\r\n\r\n    set min(value: Vector3) {\r\n        this.setMin(value);\r\n    }\r\n\r\n    get max() {\r\n        return this.getMax();\r\n    }\r\n\r\n    set max(value: Vector3) {\r\n        this.setMax(value);\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @param value\t\r\n     */\r\n    setMin(value: Vector3): void {\r\n        this._imp.setMin(value);\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @return\t\r\n     */\r\n    getMin(): Vector3 {\r\n        return this._imp.getMin();\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @param value\t\r\n     */\r\n    setMax(value: Vector3): void {\r\n        this._imp.setMax(value);\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @return\t\r\n     */\r\n    getMax(): Vector3 {\r\n        return this._imp.getMax();\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @param value\t\r\n     */\r\n    setCenter(value: Vector3): void {\r\n        this._imp.setCenter(value);\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @return\t\r\n     */\r\n    getCenter(): Vector3 {\r\n        return this._imp.getCenter();\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @param value\t\r\n     */\r\n    setExtent(value: Vector3): void {\r\n        this._imp.setExtent(value);\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @return\t\r\n     */\r\n    getExtent(): Vector3 {\r\n        return this._imp.getExtent();\r\n    }\r\n\r\n    /**\r\n     *  <code>Bounds</code> \r\n     * @param\tmin  min \r\n     * @param\tmax  max \r\n     */\r\n    constructor(min?: Vector3, max?: Vector3) {\r\n        this._imp = Laya3DRender.renderOBJCreate.createBounds(min, max);\r\n    }\r\n\r\n    protected _getUpdateFlag(type: number): boolean {\r\n        return this._imp._getUpdateFlag(type);\r\n    }\r\n\r\n\r\n    protected _setUpdateFlag(type: number, value: boolean): void {\r\n        this._imp._setUpdateFlag(type, value);\r\n    }\r\n\r\n\r\n    protected _getCenter(min: Vector3, max: Vector3, out: Vector3): void {\r\n        Vector3.add(min, max, out);\r\n        Vector3.scale(out, 0.5, out);\r\n    }\r\n\r\n\r\n    protected _getExtent(min: Vector3, max: Vector3, out: Vector3): void {\r\n        Vector3.subtract(max, min, out);\r\n        Vector3.scale(out, 0.5, out);\r\n    }\r\n\r\n\r\n    protected _getMin(center: Vector3, extent: Vector3, out: Vector3): void {\r\n        Vector3.subtract(center, extent, out);\r\n    }\r\n\r\n\r\n    protected _getMax(center: Vector3, extent: Vector3, out: Vector3): void {\r\n        Vector3.add(center, extent, out);\r\n    }\r\n\r\n    protected _rotateExtents(extents: Vector3, rotation: Matrix4x4, out: Vector3): void {\r\n        var extentsX: number = extents.x;\r\n        var extentsY: number = extents.y;\r\n        var extentsZ: number = extents.z;\r\n        var matE: Float32Array = rotation.elements;\r\n        out.x = Math.abs(matE[0] * extentsX) + Math.abs(matE[4] * extentsY) + Math.abs(matE[8] * extentsZ);\r\n        out.y = Math.abs(matE[1] * extentsX) + Math.abs(matE[5] * extentsY) + Math.abs(matE[9] * extentsZ);\r\n        out.z = Math.abs(matE[2] * extentsX) + Math.abs(matE[6] * extentsY) + Math.abs(matE[10] * extentsZ);\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    _tranform(matrix: Matrix4x4, out: Bounds): void {\r\n        this._imp._tranform(matrix, out._imp);\r\n    }\r\n\r\n    getCorners(corners: Vector3[]) {\r\n        this._imp.getCorners(corners);\r\n    }\r\n\r\n    /**\r\n     * TODO\r\n     * @param box \r\n     */\r\n    getBoundBox(box: BoundBox): void {\r\n        this._imp._getBoundBox().cloneTo(box);\r\n    }\r\n\r\n    /**\r\n     * @returns -1 0\r\n     */\r\n    calculateBoundsintersection(bounds: Bounds): number {\r\n        return this._imp.calculateBoundsintersection(bounds._imp);\r\n    }\r\n\r\n\r\n    /**\r\n     * \r\n     * @param\tdestObject \r\n     */\r\n    cloneTo(destObject: any): void {\r\n        this._imp.cloneTo(destObject._imp);\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @return\t \r\n     */\r\n    clone(): any {\r\n        var dest: Bounds = new Bounds(new Vector3(), new Vector3());\r\n        this.cloneTo(dest);\r\n        return dest;\r\n    }\r\n\r\n}\r\n\r\nconst TEMP_VECTOR3_MAX0 = new Vector3();\r\nconst TEMP_VECTOR3_MAX1 = new Vector3();","import { SingletonList } from \"../../../../utils/SingletonList\";\r\nimport { BaseRender } from \"../../../core/render/BaseRender\";\r\nimport { Bounds } from \"../../../math/Bounds\";\r\nimport { IVolumeManager } from \"../IVolumeManager\";\r\nimport { Volume } from \"../Volume\";\r\nimport { ReflectionProbe } from \"./ReflectionProbe\";\r\n\r\n/**\r\n *<code>ReflectionProbeManager</code> \r\n */\r\nexport class ReflectionProbeManager implements IVolumeManager {\r\n\r\n    /** @internal  */\r\n    private _reflectionProbes: SingletonList<ReflectionProbe> = new SingletonList<ReflectionProbe>();\r\n    /** @internal  */\r\n    private _sceneReflectionProbe: ReflectionProbe;\r\n    /** @internal */\r\n    _needUpdateAllRender: boolean = false;\r\n\r\n    /**\r\n     * \r\n     */\r\n    constructor() {\r\n        this._sceneReflectionProbe = new ReflectionProbe();\r\n        this._sceneReflectionProbe.boxProjection = false;\r\n        this._sceneReflectionProbe._isScene = true;\r\n    }\r\n\r\n    /**\r\n     * Scene Reflection\r\n     */\r\n    set sceneReflectionProbe(value: ReflectionProbe) {\r\n        this._sceneReflectionProbe = value;\r\n        this._needUpdateAllRender = true;//update Reflection\r\n    }\r\n\r\n    get sceneReflectionProbe(): ReflectionProbe {\r\n        return this._sceneReflectionProbe;\r\n    }\r\n\r\n    /**\r\n     * baseRender\r\n     * @param baseRender \r\n     */\r\n    _updateRenderObject(baseRender: BaseRender): void {\r\n        if (this._reflectionProbes.length == 0) {\r\n            baseRender.probReflection = this._sceneReflectionProbe;\r\n            return;\r\n        }\r\n        var elements: ReflectionProbe[] = this._reflectionProbes.elements;\r\n        var maxOverlap: number = 0;\r\n        var mainProbe: ReflectionProbe;\r\n        var renderBounds: Bounds = baseRender.bounds;\r\n        var overlop;\r\n        for (var i: number = 0, n: number = this._reflectionProbes.length; i < n; i++) {\r\n            var renflectProbe = elements[i];\r\n            if (!mainProbe) {\r\n                overlop = renderBounds.calculateBoundsintersection(renflectProbe.bounds);\r\n                if (overlop < maxOverlap) continue;\r\n            } else {\r\n                if (mainProbe.importance > renflectProbe.importance) continue;//\r\n                overlop = renderBounds.calculateBoundsintersection(renflectProbe.bounds);\r\n                if (overlop < maxOverlap && mainProbe.importance == renflectProbe.importance) continue;\r\n            }\r\n            mainProbe = renflectProbe;\r\n            maxOverlap = overlop;\r\n        }\r\n        if (!mainProbe && this._sceneReflectionProbe)// \r\n            mainProbe = this._sceneReflectionProbe;\r\n        baseRender.probReflection = mainProbe;\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @internal\r\n     * @param reflectionProbe \r\n     */\r\n    add(volume: ReflectionProbe) {\r\n        this._reflectionProbes.add(volume);\r\n        this._needUpdateAllRender = true;\r\n    }\r\n    /**\r\n     * \r\n     * @internal\r\n     * @param reflectionProbe \r\n     */\r\n    remove(volume: ReflectionProbe) {\r\n        this._reflectionProbes.remove(volume);\r\n        this._needUpdateAllRender = true;\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     * \r\n     */\r\n    handleMotionlist(motionObjects: SingletonList<BaseRender>): void {\r\n        var elements: BaseRender[] = motionObjects.elements;\r\n        let render: BaseRender;\r\n        for (var i: number = 0, n: number = motionObjects.length; i < n; i++) {\r\n            render = elements[i];\r\n            if (render._surportReflectionProbe && render._reflectionMode == 1) {\r\n                this._updateRenderObject(elements[i]);\r\n            }\r\n        }\r\n        //this.clearMotionObjects();\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     * \r\n     * @param \r\n     */\r\n    reCaculateAllRenderObjects(baseRenders: SingletonList<BaseRender>) {\r\n        var elements = baseRenders.elements;\r\n        let render: BaseRender;\r\n        for (var i: number = 0, n: number = baseRenders.length; i < n; i++) {\r\n            render = elements[i];\r\n            if (render._surportReflectionProbe && render._reflectionMode == 1) {\r\n                this._updateRenderObject(render);\r\n            }\r\n            this._needUpdateAllRender = false;\r\n        }\r\n    }\r\n\r\n\r\n    /**\r\n     * @internal\r\n     * destroy\r\n     */\r\n    destroy() {\r\n        for (let index = 0; index < this._reflectionProbes.length; index++) {\r\n            let probe = this._reflectionProbes.elements[index];\r\n            probe.destroy();\r\n        }\r\n        this._reflectionProbes.length = 0;\r\n        this._sceneReflectionProbe.destroy();\r\n        this._sceneReflectionProbe = null;\r\n    }\r\n}\r\n\r\n\r\n","import { ShaderDefine } from \"../../../RenderEngine/RenderShader/ShaderDefine\";\r\n\r\nexport class Sprite3DRenderDeclaration{\r\n\t/**@internal */\r\n\tstatic SHADERDEFINE_GI_LEGACYIBL: ShaderDefine;\r\n\t/**@internal */\r\n\tstatic SHADERDEFINE_GI_IBL: ShaderDefine;\r\n\t/**@internal */\r\n\tstatic SHADERDEFINE_IBL_RGBD: ShaderDefine;\r\n    /** */\r\n\tstatic SHADERDEFINE_SPECCUBE_BOX_PROJECTION: ShaderDefine;\r\n\r\n\t/// Volumetric GI\r\n\tstatic SHADERDEFINE_VOLUMETRICGI: ShaderDefine;\r\n\r\n}","import { SingletonList } from \"../../../../utils/SingletonList\";\r\nimport { BaseRender } from \"../../../core/render/BaseRender\";\r\nimport { Sprite3DRenderDeclaration } from \"../../../core/render/Sprite3DRenderDeclaration\";\r\nimport { IVolumeManager } from \"../IVolumeManager\";\r\nimport { VolumetricGI } from \"./VolumetricGI\";\r\n\r\nexport class VolumetricGIManager implements IVolumeManager {\r\n    _needUpdateAllRender: boolean;\r\n\r\n    private _GIVolumes: SingletonList<VolumetricGI> = new SingletonList<VolumetricGI>();\r\n\r\n    constructor() {\r\n        this._needUpdateAllRender = true;\r\n    }\r\n\r\n    removeVolumetricGI(renderer: BaseRender) {\r\n        let shaderData = renderer._shaderValues;\r\n        shaderData.removeDefine(Sprite3DRenderDeclaration.SHADERDEFINE_VOLUMETRICGI);\r\n        renderer.lightProb = null;\r\n    }\r\n\r\n    add(volume: VolumetricGI): void {\r\n        this._GIVolumes.add(volume);\r\n        this._needUpdateAllRender = true;\r\n    }\r\n\r\n    remove(volume: VolumetricGI): void {\r\n        this._GIVolumes.remove(volume);\r\n        this._needUpdateAllRender = true;\r\n    }\r\n\r\n    _updateRenderObject(renderer: BaseRender): void {\r\n        if (this._GIVolumes.length == 0) {\r\n            this.removeVolumetricGI(renderer);\r\n            return;\r\n        }\r\n\r\n        let renderBounds = renderer.bounds;\r\n        let maxOverlap = 0, overlap = 0;\r\n        let currentVolume: VolumetricGI;\r\n\r\n        let volumes = this._GIVolumes.elements;\r\n        for (let index = 0; index < this._GIVolumes.length; index++) {\r\n            let volume = volumes[index];\r\n            if (!currentVolume) {\r\n                overlap = renderBounds.calculateBoundsintersection(volume.bounds);\r\n                if (overlap < maxOverlap)\r\n                    continue;\r\n            }\r\n            else {\r\n                if (currentVolume.importance > volume.importance)\r\n                    continue;\r\n                overlap = renderBounds.calculateBoundsintersection(volume.bounds);\r\n                if (overlap < maxOverlap && currentVolume.importance == volume.importance)\r\n                    continue;\r\n            }\r\n            currentVolume = volume;\r\n            maxOverlap = overlap;\r\n        }\r\n\r\n        if (currentVolume) {\r\n            renderer.lightProb = currentVolume;\r\n        }\r\n        else {\r\n            this.removeVolumetricGI(renderer);\r\n        }\r\n\r\n    }\r\n    handleMotionlist(motionObjects: SingletonList<BaseRender>): void {\r\n        for (let index = 0; index < motionObjects.length; index++) {\r\n            let render = motionObjects.elements[index];\r\n            if (render._surportVolumetricGI) {\r\n                this._updateRenderObject(render);\r\n            }\r\n        }\r\n        this._needUpdateAllRender = false;\r\n    }\r\n\r\n    reCaculateAllRenderObjects(renders: SingletonList<BaseRender>): void {\r\n        for (let index = 0; index < renders.length; index++) {\r\n            let render = renders.elements[index];\r\n            if (render._surportVolumetricGI) {\r\n                this._updateRenderObject(render);\r\n            }\r\n        }\r\n        this._needUpdateAllRender = false;\r\n    }\r\n\r\n    destroy(): void {\r\n        // throw new Error(\"Method not implemented.\");\r\n    }\r\n}","import { FastSinglelist, SingletonList } from \"../../../utils/SingletonList\";\r\nimport { BaseRender } from \"../../core/render/BaseRender\";\r\nimport { Bounds } from \"../../math/Bounds\";\r\nimport { IVolumeManager } from \"./IVolumeManager\";\r\nimport { ReflectionProbeManager } from \"./reflectionProbe/ReflectionProbeManager\";\r\nimport { Volume } from \"./Volume\";\r\nimport { VolumetricGIManager } from \"./VolumetricGI/VolumetricGIManager\";\r\n\r\n\r\n\r\n\r\n/**\r\n * <code>VolumeManager</code> \r\n */\r\nexport class VolumeManager implements IVolumeManager {\r\n    static ReflectionProbeVolumeType: number = 1;\r\n\r\n    static VolumetricGIType: number = 2;\r\n\r\n    //Volume\r\n    //static regVolumeManager: { [key: number]: any } = {};\r\n    /** @internal  */\r\n    private _motionObjects: SingletonList<BaseRender> = new SingletonList<BaseRender>();\r\n    /** @internal volume list */\r\n    private _volumeList: SingletonList<Volume> = new SingletonList<Volume>();\r\n\r\n    /** @internal */\r\n    _needUpdateAllRender: boolean = false;\r\n    /** Volume */\r\n    _regVolumeManager: { [key: number]: IVolumeManager } = {};\r\n\r\n    /**@internal */\r\n    _reflectionProbeManager: ReflectionProbeManager;\r\n\r\n    _volumetricGIManager: VolumetricGIManager;\r\n\r\n    constructor() {\r\n        this._reflectionProbeManager = new ReflectionProbeManager();\r\n        this._regVolumeManager[VolumeManager.ReflectionProbeVolumeType] = this._reflectionProbeManager;\r\n\r\n        this._volumetricGIManager = new VolumetricGIManager();\r\n        this._regVolumeManager[VolumeManager.VolumetricGIType] = this._volumetricGIManager;\r\n\r\n    }\r\n\r\n    /**\r\n     * get reflection manager\r\n     */\r\n    get reflectionProbeManager(): ReflectionProbeManager {\r\n        return this._reflectionProbeManager;\r\n    }\r\n\r\n    get volumetricGIManager(): VolumetricGIManager {\r\n        return this._volumetricGIManager;\r\n    }\r\n\r\n    /**\r\n     * add volume\r\n     * @param volume \r\n     */\r\n    add(volume: Volume) {\r\n        let reManager = this._regVolumeManager[volume.type];\r\n        if (reManager) {\r\n            reManager.add(volume);\r\n        } else {\r\n            this._volumeList.add(volume);\r\n            this._needUpdateAllRender = true;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * remove volume\r\n     * @param volume \r\n     */\r\n    remove(volume: Volume) {\r\n        let reManager = this._regVolumeManager[volume.type];\r\n        if (reManager) {\r\n            reManager.remove(volume);\r\n        } else {\r\n            this._volumeList.remove(volume);\r\n            this._needUpdateAllRender = true;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * add motion obj to handle list\r\n     * @param renderObj \r\n     */\r\n    addMotionObject(renderObj: BaseRender) {\r\n        this._motionObjects.add(renderObj);\r\n    }\r\n\r\n    removeMotionObject(renderObj: BaseRender) {\r\n        this._motionObjects.remove(renderObj);\r\n    }\r\n\r\n    /**\r\n     * update one RenderNode Volume info\r\n     * @param baseRender \r\n     */\r\n    _updateRenderObject(baseRender: BaseRender): void {\r\n        let elements: Volume[] = this._volumeList.elements;\r\n\r\n        let renderBounds: Bounds = baseRender.bounds;\r\n        let center = renderBounds.getCenter();\r\n        let mainVolume: Volume;\r\n        for (var i: number = 0, n: number = this._volumeList.length; i < n; i++) {\r\n            let volume = elements[i];\r\n            let bounds = volume.bounds;\r\n            if (Bounds.containPoint(bounds, center)) {\r\n                mainVolume = volume;\r\n                continue;\r\n            }\r\n        }\r\n        baseRender.volume = mainVolume;\r\n    }\r\n    /**\r\n     * @internal\r\n     * handle motion list\r\n     */\r\n    handleMotionlist(): void {\r\n        var elements: BaseRender[] = this._motionObjects.elements;\r\n        for (var i: number = 0, n: number = this._motionObjects.length; i < n; i++) {\r\n            this._updateRenderObject(elements[i]);\r\n        }\r\n\r\n        if (!this.reflectionProbeManager._needUpdateAllRender)\r\n            this.reflectionProbeManager.handleMotionlist(this._motionObjects);\r\n        if (!this.volumetricGIManager._needUpdateAllRender)\r\n            this.volumetricGIManager.handleMotionlist(this._motionObjects);\r\n\r\n        this.clearMotionObjects();\r\n    }\r\n\r\n    /**\r\n     * Volume\r\n     */\r\n    reCaculateAllRenderObjects(baseRenders: SingletonList<BaseRender>) {\r\n        if (this._needUpdateAllRender) {\r\n            var elements = baseRenders.elements;\r\n            for (var i: number = 0, n: number = baseRenders.length; i < n; i++) {\r\n                this._updateRenderObject(elements[i]);\r\n            }\r\n            this._needUpdateAllRender = false;\r\n        } else {\r\n            this.handleMotionlist();\r\n        }\r\n\r\n        //minerTODO \r\n        if (this.reflectionProbeManager._needUpdateAllRender) {\r\n            this.reflectionProbeManager.reCaculateAllRenderObjects(baseRenders);\r\n        } else {\r\n            this.reflectionProbeManager.handleMotionlist(this._motionObjects);\r\n        }\r\n\r\n        if (this.volumetricGIManager._needUpdateAllRender) {\r\n            this.volumetricGIManager.reCaculateAllRenderObjects(baseRenders);\r\n        }\r\n        else {\r\n            this.volumetricGIManager.handleMotionlist(this._motionObjects);\r\n        }\r\n\r\n    }\r\n\r\n    needreCaculateAllRenderObjects(): boolean {\r\n        return this._needUpdateAllRender || this.reflectionProbeManager._needUpdateAllRender || this.volumetricGIManager._needUpdateAllRender;\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     * \r\n     */\r\n    clearMotionObjects() {\r\n        this._motionObjects.length = 0;\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     * destroy\r\n     */\r\n    destroy() {\r\n\r\n    }\r\n}","\r\nimport { Color } from \"../../maths/Color\";\r\nimport { Vector3 } from \"../../maths/Vector3\";\r\nimport { TextureCubeFace } from \"../../resource/TextureCube\";\r\n\r\n/**\r\n * \r\n */\r\nexport class SphericalHarmonicsL2 {\r\n    /** @internal */\r\n    static _default: SphericalHarmonicsL2 = new SphericalHarmonicsL2();\r\n\r\n    /** @internal */\r\n    private _coefficients: Float32Array = new Float32Array(27);\r\n\r\n    /**\r\n     * \r\n     * @param i 02\r\n     * @param j 08\r\n     */\r\n    getCoefficient(i: number, j: number): number {\r\n        return this._coefficients[i * 9 + j];\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @param i 02\r\n     * @param j 08\r\n     */\r\n    setCoefficient(i: number, j: number, coefficient: number): void {\r\n        this._coefficients[i * 9 + j] = coefficient;\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @param i 02\r\n     * @param coefficient0 0\r\n     * @param coefficient1 1\r\n     * @param coefficient2 2\r\n     * @param coefficient3 3\r\n     * @param coefficient4 4\r\n     * @param coefficient5 5\r\n     * @param coefficient6 6\r\n     * @param coefficient7 7\r\n     * @param coefficient8 8\r\n     */\r\n    setCoefficients(i: number, coefficient0: number, coefficient1: number, coefficient2: number, coefficient3: number, coefficient4: number, coefficient5: number, coefficient6: number, coefficient7: number, coefficient8: number): void {\r\n        var offset: number = i * 9;\r\n        this._coefficients[offset] = coefficient0;\r\n        this._coefficients[++offset] = coefficient1;\r\n        this._coefficients[++offset] = coefficient2;\r\n        this._coefficients[++offset] = coefficient3;\r\n        this._coefficients[++offset] = coefficient4;\r\n        this._coefficients[++offset] = coefficient5;\r\n        this._coefficients[++offset] = coefficient6;\r\n        this._coefficients[++offset] = coefficient7;\r\n        this._coefficients[++offset] = coefficient8;\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @param dest \r\n     */\r\n    cloneTo(dest: SphericalHarmonicsL2): void {\r\n        if (this === dest)\r\n            return;\r\n        var coes: Float32Array = this._coefficients;\r\n        var destCoes: Float32Array = dest._coefficients;\r\n        for (var i: number = 0; i < 27; i++)\r\n            destCoes[i] = coes[i];\r\n    }\r\n}\r\n\r\n/**\r\n * @internal\r\n * \r\n */\r\nexport class SphericalHarmonicsL2Generater {\r\n\r\n    private static _tempSHR: Float32Array = new Float32Array(9);\r\n    private static _tempSHG: Float32Array = new Float32Array(9);\r\n    private static _tempSHB: Float32Array = new Float32Array(9);\r\n\r\n    /**\r\n     * k0: 1/2  * sqrt(1/Pi)\r\n     * k1: 1/3  * sqrt(3/Pi)\r\n     * k2: 1/8  * sqrt(15/Pi)\r\n     * k3: 1/16 * sqrt(5/Pi)\r\n     * k4: 1/16 * sqrt(15/Pi)\r\n     * [\r\n     *  k0,\r\n     * -k1, k1, k1\r\n     * k2, -k2, k3, -k2, k4\r\n     * ]\r\n     */\r\n    private static readonly k = [\r\n        0.28209479177387814347,\r\n        -0.32573500793527994772, 0.32573500793527994772, -0.32573500793527994772,\r\n        0.27313710764801976764, -0.27313710764801976764, 0.07884789131313000151, -0.27313710764801976764, 0.13656855382400988382\r\n    ]\r\n\r\n    /** @internal */\r\n    static readonly GradientSimulateSize: number = 3;\r\n    /** @internal */\r\n    static readonly SH_Count: number = 9;\r\n\r\n    private static _tempSkyPixels: Float32Array = new Float32Array(SphericalHarmonicsL2Generater.GradientSimulateSize * SphericalHarmonicsL2Generater.GradientSimulateSize * 3);\r\n    private static _tempEquatorPixels: Float32Array = new Float32Array(SphericalHarmonicsL2Generater.GradientSimulateSize * SphericalHarmonicsL2Generater.GradientSimulateSize * 3);\r\n    private static _tempGroundPixels: Float32Array = new Float32Array(SphericalHarmonicsL2Generater.GradientSimulateSize * SphericalHarmonicsL2Generater.GradientSimulateSize * 3);\r\n    /**\r\n     * @internal\r\n     * uv   \r\n     * @param u \r\n     * @param v \r\n     */\r\n    static surfaceArea(u: number, v: number) {\r\n        return Math.atan2(u * v, Math.sqrt(u * u + v * v + 1.0));\r\n    }\r\n\r\n    /**\r\n     * uv  () \r\n     * @param u \r\n     * @param v \r\n     * @param face \r\n     * @param out_dir \r\n     */\r\n    static uv2Dir(u: number, v: number, face: TextureCubeFace, out_dir: Vector3) {\r\n        switch (face) {\r\n            case TextureCubeFace.PositiveX:\r\n                out_dir.x = 1.0;\r\n                out_dir.y = -v;\r\n                out_dir.z = -u;\r\n                break;\r\n            case TextureCubeFace.NegativeX:\r\n                out_dir.x = -1.0;\r\n                out_dir.y = -v;\r\n                out_dir.z = u;\r\n                break;\r\n            case TextureCubeFace.PositiveY:\r\n                out_dir.x = u;\r\n                out_dir.y = 1.0;\r\n                out_dir.z = v;\r\n                break;\r\n            case TextureCubeFace.NegativeY:\r\n                out_dir.x = u;\r\n                out_dir.y = -1.0;\r\n                out_dir.z = -v;\r\n                break;\r\n            case TextureCubeFace.PositiveZ:\r\n                out_dir.x = u;\r\n                out_dir.y = -v;\r\n                out_dir.z = 1.0;\r\n                break;\r\n            case TextureCubeFace.NegativeZ:\r\n                out_dir.x = -u;\r\n                out_dir.y = -v;\r\n                out_dir.z = -1.0;\r\n                break;\r\n            default:\r\n                break;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     *  \r\n     * @param i \r\n     * @param x \r\n     * @param y \r\n     * @param z \r\n     * @returns \r\n     */\r\n    static sh_eval_9(i: number, x: number, y: number, z: number) {\r\n        const sqrt = Math.sqrt;\r\n        const M_PI = Math.PI;\r\n        switch (i) {\r\n            case 0:\r\n                return 0.5 * sqrt(1.0 / M_PI);\r\n            case 1:\r\n                return -y * 0.5 * sqrt(3.0 / M_PI);\r\n            case 2:\r\n                return z * 0.5 * sqrt(3.0 / M_PI);\r\n            case 3:\r\n                return -x * 0.5 * sqrt(3.0 / M_PI);\r\n            case 4:\r\n                return x * y * 0.5 * sqrt(15.0 / M_PI);\r\n            case 5:\r\n                return -y * z * 0.5 * sqrt(15.0 / M_PI);\r\n            case 6:\r\n                return (3.0 * z * z - 1.0) * 0.25 * sqrt(5.0 / M_PI);\r\n            case 7:\r\n                return -x * z * 0.5 * sqrt(15.0 / M_PI);\r\n            case 8:\r\n                return (x * x - y * y) * 0.25 * sqrt(15.0 / M_PI);\r\n            default:\r\n                return 0;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     *  cubemap  \r\n     * @param cubemapPixels cubemap \r\n     * @param pixelComponentSize  (RGB 3, RGBA 4)\r\n     * @param cubemapSize cubemap \r\n     * @param isGamma \r\n     */\r\n    static CalCubemapSH(cubemapPixels: Float32Array[], pixelComponentSize: number, cubemapSize: number, isGamma: boolean = true): SphericalHarmonicsL2 {\r\n\r\n        let width = cubemapSize;\r\n        let height = cubemapSize;\r\n\r\n        let shr = this._tempSHR.fill(0);\r\n        let shg = this._tempSHG.fill(0);\r\n        let shb = this._tempSHB.fill(0);\r\n\r\n        let dir = new Vector3();\r\n        for (let face = 0; face < 6; face++) {\r\n\r\n            let facePixels = cubemapPixels[face];\r\n\r\n            for (let y = 0; y < height; y++) {\r\n                for (let x = 0; x < width; x++) {\r\n\r\n                    let px = x + 0.5;\r\n                    let py = y + 0.5;\r\n\r\n                    let u = 2.0 * (px / width) - 1.0;\r\n                    let v = 2.0 * (py / height) - 1.0;\r\n\r\n                    let dx = 1.0 / width;\r\n                    let dy = 1.0 / height;\r\n                    // 4 uv \r\n                    let x0 = u - dx;\r\n                    let y0 = v - dy;\r\n                    let x1 = u + dx;\r\n                    let y1 = v + dy;\r\n\r\n                    // \r\n                    let da = this.surfaceArea(x0, y0) - this.surfaceArea(x0, y1) - this.surfaceArea(x1, y0) + this.surfaceArea(x1, y1);\r\n\r\n                    this.uv2Dir(u, v, face, dir);\r\n                    Vector3.normalize(dir, dir);\r\n\r\n                    let pixelOffset = (x + y * width) * pixelComponentSize;\r\n                    let r = facePixels[pixelOffset];\r\n                    let g = facePixels[pixelOffset + 1];\r\n                    let b = facePixels[pixelOffset + 2];\r\n                    if (isGamma) {\r\n                        r = Color.gammaToLinearSpace(r);\r\n                        g = Color.gammaToLinearSpace(g);\r\n                        b = Color.gammaToLinearSpace(b);\r\n                    }\r\n\r\n                    for (let s = 0; s < this.SH_Count; s++) {\r\n                        let sh_val = this.sh_eval_9(s, dir.x, dir.y, dir.z);\r\n                        shr[s] += r * sh_val * da;\r\n                        shg[s] += g * sh_val * da;\r\n                        shb[s] += b * sh_val * da;\r\n                    }\r\n                }\r\n            }\r\n        }\r\n\r\n        let sh = new SphericalHarmonicsL2();\r\n\r\n        for (let index = 0; index < this.SH_Count; index++) {\r\n            let scale = this.k[index];\r\n\r\n            let r = shr[index];\r\n            sh.setCoefficient(0, index, r * scale);\r\n\r\n            let g = shg[index];\r\n            sh.setCoefficient(1, index, g * scale);\r\n\r\n            let b = shb[index];\r\n            sh.setCoefficient(2, index, b * scale);\r\n        }\r\n\r\n        return sh;\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     *  , , \r\n     * @param skyColor \r\n     * @param equatorColor \r\n     * @param groundColor \r\n     * @param isGamma \r\n     */\r\n    static CalGradientSH(skyColor: Vector3, equatorColor: Vector3, groundColor: Vector3, isGamma: boolean = true): SphericalHarmonicsL2 {\r\n\r\n        console.time(\"Gradient SH\");\r\n\r\n        let skyPixels = this._tempSkyPixels;\r\n        let equatorPixels = this._tempEquatorPixels;\r\n        let groundPixels = this._tempGroundPixels;\r\n\r\n        const fillPixelBuffer = (float32: Float32Array, color: Vector3, isGamma: boolean) => {\r\n            let fillColor = new Color(color.x, color.y, color.z, 1.0);\r\n            if (isGamma) {\r\n                fillColor.toLinear(fillColor);\r\n            }\r\n            let r = Math.min(fillColor.r, 1.0);\r\n            let g = Math.min(fillColor.g, 1.0);\r\n            let b = Math.min(fillColor.b, 1.0);\r\n            for (let index = 0; index < float32.length; index += 3) {\r\n                float32[index] = r;\r\n                float32[index + 1] = g;\r\n                float32[index + 2] = b;\r\n            }\r\n        }\r\n\r\n        fillPixelBuffer(skyPixels, skyColor, isGamma);\r\n        fillPixelBuffer(equatorPixels, equatorColor, isGamma);\r\n        fillPixelBuffer(groundPixels, groundColor, isGamma);\r\n\r\n        let gradientPixles = [];\r\n        gradientPixles[TextureCubeFace.PositiveY] = skyPixels;\r\n        gradientPixles[TextureCubeFace.NegativeY] = groundPixels;\r\n        gradientPixles[TextureCubeFace.PositiveX] = equatorPixels;\r\n        gradientPixles[TextureCubeFace.NegativeX] = equatorPixels;\r\n        gradientPixles[TextureCubeFace.PositiveZ] = equatorPixels;\r\n        gradientPixles[TextureCubeFace.NegativeZ] = equatorPixels;\r\n\r\n        let sh = SphericalHarmonicsL2Generater.CalCubemapSH(gradientPixles, 3, this.GradientSimulateSize, false);\r\n\r\n        console.timeEnd(\"Gradient SH\");\r\n        return sh;\r\n    }\r\n}","import { BaseRender } from \"./BaseRender\"\r\nimport { RenderContext3D } from \"./RenderContext3D\"\r\nimport { Camera } from \"../Camera\"\r\nimport { GeometryElement } from \"../GeometryElement\"\r\nimport { Transform3D } from \"../Transform3D\"\r\nimport { Material } from \"../../../resource/Material\"\r\nimport { IRenderElement } from \"../../../RenderEngine/RenderInterface/RenderPipelineInterface/IRenderElement\"\r\nimport { Shader3D } from \"../../../RenderEngine/RenderShader/Shader3D\"\r\nimport { DefineDatas } from \"../../../RenderEngine/RenderShader/DefineDatas\"\r\nimport { IRenderContext3D } from \"../../../RenderEngine/RenderInterface/RenderPipelineInterface/IRenderContext3D\"\r\nimport { ILaya3D } from \"../../../../ILaya3D\"\r\nimport { ShaderInstance } from \"../../../RenderEngine/RenderShader/ShaderInstance\"\r\nimport { ShaderPass } from \"../../../RenderEngine/RenderShader/ShaderPass\"\r\nimport { SubShader } from \"../../../RenderEngine/RenderShader/SubShader\"\r\nimport { Laya3DRender } from \"../../RenderObjs/Laya3DRender\"\r\n\r\n/**\r\n * <code>RenderElement</code> \r\n */\r\nexport class RenderElement {\r\n    /** @internal */\r\n    static RENDERTYPE_NORMAL: number = 0;\r\n    /** @internal */\r\n    static RENDERTYPE_STATICBATCH: number = 1;\r\n    /** @internal */\r\n    static RENDERTYPE_INSTANCEBATCH: number = 2;\r\n    /** @internal */\r\n    static RENDERTYPE_VERTEXBATCH: number = 3;\r\n\r\n    /** @internal */\r\n    static _compileDefine: DefineDatas = new DefineDatas();\r\n\r\n    /**\r\n     * \r\n     */\r\n    _renderElementOBJ: IRenderElement;\r\n    /** @internal */\r\n    _geometry: GeometryElement;\r\n    /**@internal */\r\n    _canBatch: boolean = false;\r\n    /** @internal */\r\n    _material: Material;//\r\n    /** @internal */\r\n    _baseRender: BaseRender;\r\n    /**@internal */\r\n    _subShader: SubShader;\r\n    /**@internal */\r\n    _subShaderIndex: number = 0;\r\n    _batchElement: RenderElement;\r\n    _transform: Transform3D;\r\n\r\n    /** @internal */\r\n    set transform(value: Transform3D) {\r\n        this._transform = value;\r\n        this._renderElementOBJ._transform = value;\r\n    }\r\n\r\n    /**@internal */\r\n    get transform(): Transform3D {\r\n        return this._renderElementOBJ._transform;\r\n    }\r\n\r\n    /**\r\n     * set RenderElement Material/Shaderdata\r\n     */\r\n    set material(value: Material) {\r\n        if (value) {\r\n            this._material = value;\r\n            this._renderElementOBJ._materialShaderData = value.shaderData;\r\n        }\r\n        else {\r\n            this._material = null;\r\n            this._renderElementOBJ._materialShaderData = null;\r\n        }\r\n    }\r\n\r\n    /**@internal */\r\n    get material(): Material {\r\n        return this._material;\r\n    }\r\n\r\n    /**\r\n     *  SubShader\r\n     */\r\n    set renderSubShader(value: SubShader) {\r\n        this._subShader = value;\r\n    }\r\n\r\n    get renderSubShader(): SubShader {\r\n        return this._subShader;\r\n    }\r\n\r\n    set subShaderIndex(value: number) {\r\n        this._subShaderIndex = value;\r\n    }\r\n\r\n    get subShaderIndex() {\r\n        return this._subShaderIndex;\r\n    }\r\n    /**@internal */\r\n    set render(value: BaseRender) {\r\n        this._baseRender = value;\r\n        this._renderElementOBJ._renderShaderData = value._shaderValues;\r\n    }\r\n\r\n    get render(): BaseRender {\r\n        return this._baseRender;\r\n    }\r\n\r\n\r\n\r\n    /** @internal */\r\n    staticBatch: GeometryElement;\r\n    /** @internal */\r\n    renderType: number = RenderElement.RENDERTYPE_NORMAL;\r\n    /**\r\n     *  <code>RenderElement</code> \r\n     */\r\n    constructor() {\r\n        this._createRenderElementOBJ();\r\n    }\r\n\r\n    protected _createRenderElementOBJ() {\r\n        this._renderElementOBJ = Laya3DRender.renderOBJCreate.createRenderElement();\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    getInvertFront(): boolean {\r\n        return this.transform ? this.transform._isFrontFaceInvert : false;\r\n    }\r\n\r\n    /**\r\n     * \r\n     */\r\n    setTransform(transform: Transform3D): void {\r\n        this.transform = transform;\r\n    }\r\n\r\n    /**\r\n     * \r\n     */\r\n    setGeometry(geometry: GeometryElement): void {\r\n        this._geometry = geometry;\r\n        this._renderElementOBJ._geometry = geometry._geometryElementOBj;\r\n    }\r\n\r\n    /**\r\n     * shader\r\n     * @param context \r\n     */\r\n    compileShader(context: IRenderContext3D) {\r\n        var passes: ShaderPass[] = this._subShader._passes;\r\n        this._renderElementOBJ._clearShaderInstance();\r\n        for (var j: number = 0, m: number = passes.length; j < m; j++) {\r\n            var pass: ShaderPass = passes[j];\r\n            //NOTE:this will cause maybe a shader not render but do prepare beforebut the developer can avoide this manual,for example shaderCaster=false.\r\n            if (pass._pipelineMode !== context.pipelineMode)\r\n                continue;\r\n\r\n            var comDef: DefineDatas = RenderElement._compileDefine;\r\n\r\n            // context.configShaderData._defineDatas.cloneTo(comDef);\r\n\r\n            if (context.sceneShaderData) {\r\n                context.sceneShaderData._defineDatas.cloneTo(comDef);\r\n            } else {\r\n                Shader3D._configDefineValues.cloneTo(comDef);\r\n            }\r\n\r\n            comDef.addDefineDatas(context.configShaderData._defineDatas);\r\n\r\n            context.cameraShaderData && comDef.addDefineDatas(context.cameraShaderData._defineDatas);\r\n            if (this.render) {\r\n                comDef.addDefineDatas(this.render._shaderValues._defineDatas);\r\n                pass.nodeCommonMap = this.render._commonUniformMap;\r\n            } else {\r\n                pass.nodeCommonMap = null;\r\n            }\r\n\r\n            this._renderElementOBJ._materialShaderData && comDef.addDefineDatas(this._renderElementOBJ._materialShaderData._defineDatas);\r\n            var shaderIns: ShaderInstance = pass.withCompile(comDef);\r\n            this._renderElementOBJ._addShaderInstance(shaderIns);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Shader\r\n     * @param customShader \r\n     * @param replacementTag \r\n     * @param subshaderIndex \r\n     * @returns \r\n     */\r\n    _convertSubShader(customShader: Shader3D, replacementTag: string, subshaderIndex: number = 0) {\r\n        var subShader: SubShader = this.material._shader.getSubShaderAt(this._subShaderIndex);//TODO:\r\n        this.renderSubShader = null;\r\n        if (customShader) {\r\n            if (replacementTag) {\r\n                var oriTag: string = subShader.getFlag(replacementTag);\r\n                if (oriTag) {\r\n                    var customSubShaders: SubShader[] = customShader._subShaders;\r\n                    for (var k: number = 0, p: number = customSubShaders.length; k < p; k++) {\r\n                        var customSubShader: SubShader = customSubShaders[k];\r\n                        if (oriTag === customSubShader.getFlag(replacementTag)) {\r\n                            this.renderSubShader = customSubShader;\r\n                            break;\r\n                        }\r\n                    }\r\n                    if (!this.renderSubShader)\r\n                        return;\r\n                } else {\r\n                    return;\r\n                }\r\n            } else {\r\n                this.renderSubShader = customShader.getSubShaderAt(subshaderIndex);//TODO:\r\n            }\r\n        } else {\r\n            this.renderSubShader = subShader;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    _update(scene: any, context: RenderContext3D, customShader: Shader3D, replacementTag: string, subshaderIndex: number = 0): void {\r\n        this.material && this._convertSubShader(customShader, replacementTag, subshaderIndex);\r\n        if (!this.renderSubShader || !this._renderElementOBJ._materialShaderData) {\r\n            return;\r\n        }\r\n        let renderQueue = scene._getRenderQueue(this.material.renderQueue);\r\n        renderQueue.addRenderElement(this);\r\n    }\r\n\r\n    /**\r\n     * pre update data\r\n     * @param context \r\n     */\r\n    _renderUpdatePre(context: RenderContext3D) {\r\n        var sceneMark: number = ILaya3D.Scene3D._updateMark;\r\n        var transform: Transform3D = this.transform;\r\n        context.renderElement = this;\r\n        //model local\r\n        var modelDataRender: boolean = (!!this._baseRender) ? (sceneMark !== this._baseRender._sceneUpdateMark || this.renderType !== this._baseRender._updateRenderType) : false;\r\n        if (modelDataRender) {\r\n            this._baseRender._renderUpdate(context, transform);\r\n            this._baseRender._sceneUpdateMark = sceneMark;\r\n        }\r\n        //camera\r\n        var updateMark: number = Camera._updateMark;\r\n        var updateRender: boolean = (!!this._baseRender) ? (updateMark !== this._baseRender._updateMark || this.renderType !== this._baseRender._updateRenderType) : false;\r\n        if (updateRender) {//\r\n            this._baseRender._renderUpdateWithCamera(context, transform);\r\n            this._baseRender._updateMark = updateMark;\r\n            this._baseRender._updateRenderType = this.renderType;\r\n        }\r\n\r\n        const subUbo = (!!this._baseRender) ? this._baseRender._subUniformBufferData : false;\r\n        if (subUbo) {\r\n            subUbo._needUpdate && BaseRender._transLargeUbO.updateSubData(subUbo);\r\n        }\r\n        //context.shader = this._renderElementOBJ._subShader;\r\n        this._renderElementOBJ._isRender = this._geometry._prepareRender(context);\r\n        this._geometry._updateRenderParams(context);\r\n        this.compileShader(context._contextOBJ);\r\n        this._renderElementOBJ._invertFront = this.getInvertFront();\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    _render(context: IRenderContext3D): void {\r\n        this._renderElementOBJ._render(context);\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    destroy(): void {\r\n        this._renderElementOBJ._destroy();\r\n        this._renderElementOBJ = null;\r\n        this._geometry = null;\r\n        this._baseRender = null;\r\n        this._material = null\r\n        this._baseRender = null;\r\n        this._subShader = null;\r\n    }\r\n}\r\n\r\n","import { RenderContext3D } from \"./render/RenderContext3D\"\r\nimport { IRenderGeometryElement } from \"../../RenderEngine/RenderInterface/RenderPipelineInterface/IRenderGeometryElement\";\r\nimport { MeshTopology } from \"../../RenderEngine/RenderEnum/RenderPologyMode\";\r\nimport { IndexFormat } from \"../../RenderEngine/RenderEnum/IndexFormat\";\r\nimport { DrawType } from \"../../RenderEngine/RenderEnum/DrawType\";\r\nimport { BufferState } from \"../../webgl/utils/BufferState\";\r\nimport { LayaGL } from \"../../layagl/LayaGL\";\r\nimport { Laya3DRender } from \"../RenderObjs/Laya3DRender\";\r\n\r\n/**\r\n * <code>GeometryElement</code> ,\r\n */\r\nexport class GeometryElement {\r\n\t/** @internal */\r\n\tprivate static _uniqueIDCounter: number = 0;\r\n\tprotected _owner: any;\r\n\tstatic _typeCounter: number = 0;\r\n\t/**@internal */\r\n\tprotected _destroyed: boolean;\r\n\t_geometryElementOBj: IRenderGeometryElement;\r\n\t/** @internal */\r\n\t_id: number;\r\n\t/**\r\n\t * VAO OBJ\r\n\t */\r\n\tset bufferState(value: BufferState) {\r\n\t\tthis._geometryElementOBj.bufferState = value;\r\n\t}\r\n\r\n\tget bufferState(): BufferState {\r\n\t\treturn this._geometryElementOBj.bufferState;\r\n\t}\r\n\r\n\t/**\r\n\t * mesh topology type\r\n\t */\r\n\tset mode(value: MeshTopology) {\r\n\t\tthis._geometryElementOBj.mode = value;\r\n\t}\r\n\r\n\tget mode(): MeshTopology {\r\n\t\treturn this._geometryElementOBj.mode;\r\n\t}\r\n\r\n\t/**\r\n\t * draw Type\r\n\t */\r\n\tset drawType(value: number) {\r\n\t\tthis._geometryElementOBj.drawType = value;\r\n\t}\r\n\r\n\tget drawType(): number {\r\n\t\treturn this._geometryElementOBj.drawType;\r\n\t}\r\n\r\n\tsetDrawArrayParams(first: number, count: number): void {\r\n\t\tthis._geometryElementOBj.setDrawArrayParams(first, count);\r\n\r\n\t}\r\n\r\n\tsetDrawElemenParams(count: number, offset: number): void {\r\n\t\tthis._geometryElementOBj.setDrawElemenParams(count, offset);\r\n\t}\r\n\r\n\tset instanceCount(value: number) {\r\n\t\tthis._geometryElementOBj.instanceCount = value;\r\n\t}\r\n\r\n\tget instanceCount(): number {\r\n\t\treturn this._geometryElementOBj.instanceCount;\r\n\t}\r\n\r\n\tset indexFormat(value: IndexFormat) {\r\n\t\tthis._geometryElementOBj.indexFormat = value;\r\n\t}\r\n\r\n\tget indexFormat(): IndexFormat {\r\n\t\treturn this._geometryElementOBj.indexFormat;\r\n\t}\r\n\r\n\r\n\r\n\t/**\r\n\t * \r\n\t * @return \r\n\t */\r\n\tget destroyed(): boolean {\r\n\t\treturn this._destroyed;\r\n\t}\r\n\r\n\t/**\r\n\t *  <code>GeometryElement</code> \r\n\t */\r\n\tconstructor(mode: MeshTopology, drawType: DrawType) {\r\n\t\tthis._destroyed = false;\r\n\t\tthis._geometryElementOBj = Laya3DRender.renderOBJCreate.createRenderGeometry(mode, drawType);\r\n\t\tthis._id = ++GeometryElement._uniqueIDCounter;\r\n\t}\r\n\r\n\r\n\r\n\r\n\r\n\r\n\t/**\r\n\t * \r\n\t */\r\n\t_getType(): number {\r\n\t\tthrow \"GeometryElement:must override it.\";\r\n\t}\r\n\r\n\t/**\r\n\t * @internal\r\n\t * @return  \r\n\t */\r\n\t_prepareRender(state: RenderContext3D): boolean {\r\n\t\treturn true;\r\n\t}\r\n\r\n\t/**\r\n\t * @internal\r\n\t * UpdateGeometry Data\r\n\t */\r\n\t_updateRenderParams(state: RenderContext3D): void {\r\n\t\tthrow \"GeometryElement:must override it.\";\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t */\r\n\tdestroy(): void {\r\n\t\tif (this._destroyed)\r\n\t\t\treturn;\r\n\t\tthis._destroyed = true;\r\n\t\tthis._geometryElementOBj.destroy();\r\n\t}\r\n\r\n\tclearRenderParams() {\r\n\t\tthis._geometryElementOBj.clearRenderParams();\r\n\t}\r\n}\r\n\r\n","import { BufferUsage } from \"../../../RenderEngine/RenderEnum/BufferTargetType\";\r\nimport { DrawType } from \"../../../RenderEngine/RenderEnum/DrawType\";\r\nimport { IndexFormat } from \"../../../RenderEngine/RenderEnum/IndexFormat\";\r\nimport { MeshTopology } from \"../../../RenderEngine/RenderEnum/RenderPologyMode\";\r\nimport { VertexMesh } from \"../../../RenderEngine/RenderShader/VertexMesh\";\r\nimport { VertexDeclaration } from \"../../../RenderEngine/VertexDeclaration\";\r\nimport { BufferState } from \"../../../webgl/utils/BufferState\";\r\nimport { Laya3DRender } from \"../../RenderObjs/Laya3DRender\";\r\nimport { GeometryElement } from \"../../core/GeometryElement\";\r\nimport { RenderContext3D } from \"../../core/render/RenderContext3D\";\r\n\r\n\r\n/**\r\n * <code>SkyBox</code> \r\n */\r\nexport class SkyBox extends GeometryElement {\r\n\tstatic instance: SkyBox;\r\n\t/**\r\n\t * @internal\r\n\t */\r\n\tstatic __init__(): void {\r\n\t\tSkyBox.instance = new SkyBox();//TODO:Mesh\r\n\t}\r\n\r\n\t/**\r\n\t *  <code>SkyBox</code> \r\n\t */\r\n\tconstructor() {\r\n\t\tsuper(MeshTopology.Triangles, DrawType.DrawElement);\r\n\t\tvar halfHeight: number = 1.0;\r\n\t\tvar halfWidth: number = 1.0;\r\n\t\tvar halfDepth: number = 1.0;\r\n\t\tvar vertices: Float32Array = new Float32Array([-halfDepth, halfHeight, -halfWidth, halfDepth, halfHeight, -halfWidth, halfDepth, halfHeight, halfWidth, -halfDepth, halfHeight, halfWidth,//\r\n\t\t-halfDepth, -halfHeight, -halfWidth, halfDepth, -halfHeight, -halfWidth, halfDepth, -halfHeight, halfWidth, -halfDepth, -halfHeight, halfWidth]);//\r\n\t\tvar indices: Uint8Array = new Uint8Array([\r\n\t\t\t0, 2, 1, 2, 0, 3, //\r\n\t\t\t4, 6, 7, 6, 4, 5, //\r\n\t\t\t0, 7, 3, 7, 0, 4, //\r\n\t\t\t1, 6, 5, 6, 1, 2,//\r\n\t\t\t3, 6, 2, 6, 3, 7, //\r\n\t\t\t0, 5, 4, 5, 0, 1]);//\r\n\t\tvar verDec: VertexDeclaration = VertexMesh.getVertexDeclaration(\"POSITION\");\r\n\t\tlet vertexBuffer = Laya3DRender.renderOBJCreate.createVertexBuffer3D(verDec.vertexStride * 8, BufferUsage.Static, false);\r\n\t\tvertexBuffer.vertexDeclaration = verDec;\r\n\t\tlet indexBuffer = Laya3DRender.renderOBJCreate.createIndexBuffer3D(IndexFormat.UInt8, 36, BufferUsage.Static, false);\r\n\t\tvertexBuffer.setData(vertices);\r\n\t\tindexBuffer.setData(indices);\r\n\t\tthis.bufferState = new BufferState();\r\n\t\tthis.bufferState.applyState([vertexBuffer], indexBuffer);\r\n\t\tthis._geometryElementOBj.setDrawElemenParams(36, 0);\r\n\t\tthis.indexFormat = IndexFormat.UInt8;\r\n\t}\r\n\r\n\t/**\r\n\t * @internal\r\n\t * UpdateGeometry Data\r\n\t */\r\n\t_updateRenderParams(state: RenderContext3D): void {\r\n\r\n\t}\r\n}\r\n\r\n","import { IVertex } from \"../IVertex\"\r\nimport { VertexDeclaration } from \"../../../RenderEngine/VertexDeclaration\";\r\nimport { Vector2 } from \"../../../maths/Vector2\";\r\nimport { Vector3 } from \"../../../maths/Vector3\";\r\nimport { VertexElementFormat } from \"../../../renders/VertexElementFormat\";\r\nimport { VertexElement } from \"../../../renders/VertexElement\";\r\nimport { VertexMesh } from \"../../../RenderEngine/RenderShader/VertexMesh\";\r\n\r\n/**\r\n * @internal\r\n * <code>VertexPositionNormalTexture</code> \r\n */\r\nexport class VertexPositionTexture0 implements IVertex {\r\n\r\n\tprivate static _vertexDeclaration: VertexDeclaration;\r\n\r\n\tstatic get vertexDeclaration(): VertexDeclaration {\r\n\t\treturn VertexPositionTexture0._vertexDeclaration;\r\n\t}\r\n\r\n\t/**\r\n\t * @internal\r\n\t */\r\n\tstatic __init__(): void {\r\n\t\tVertexPositionTexture0._vertexDeclaration = new VertexDeclaration(20, [new VertexElement(0, VertexElementFormat.Vector3, VertexMesh.MESH_POSITION0),\r\n\t\tnew VertexElement(12, VertexElementFormat.Vector2, VertexMesh.MESH_TEXTURECOORDINATE0)]);\r\n\t}\r\n\r\n\tprivate _position: Vector3;\r\n\tprivate _textureCoordinate0: Vector2;\r\n\r\n\tget position(): Vector3 {\r\n\t\treturn this._position;\r\n\t}\r\n\r\n\tget textureCoordinate0(): Vector2 {\r\n\t\treturn this._textureCoordinate0;\r\n\t}\r\n\r\n\tget vertexDeclaration(): VertexDeclaration {\r\n\t\treturn VertexPositionTexture0._vertexDeclaration;\r\n\t}\r\n\r\n\tconstructor(position: Vector3, textureCoordinate0: Vector2) {\r\n\t\tthis._position = position;\r\n\t\tthis._textureCoordinate0 = textureCoordinate0;\r\n\t}\r\n\r\n}\r\n\r\n\r\n","import { VertexPositionTexture0 } from \"../../graphics/Vertex/VertexPositionTexture0\"\r\nimport { BufferUsage } from \"../../../RenderEngine/RenderEnum/BufferTargetType\";\r\nimport { MeshTopology } from \"../../../RenderEngine/RenderEnum/RenderPologyMode\";\r\nimport { VertexDeclaration } from \"../../../RenderEngine/VertexDeclaration\";\r\nimport { GeometryElement } from \"../../core/GeometryElement\";\r\nimport { DrawType } from \"../../../RenderEngine/RenderEnum/DrawType\";\r\nimport { RenderContext3D } from \"../../core/render/RenderContext3D\";\r\nimport { IndexFormat } from \"../../../RenderEngine/RenderEnum/IndexFormat\";\r\nimport { BufferState } from \"../../../webgl/utils/BufferState\";\r\nimport { Laya3DRender } from \"../../RenderObjs/Laya3DRender\";\r\n\r\n/**\r\n * <code>SkyDome</code> \r\n */\r\nexport class SkyDome extends GeometryElement {\r\n\t/**@internal */\r\n\tprivate static _radius: number = 1;\r\n\r\n\tstatic instance: SkyDome;\r\n\r\n\t/**\r\n\t * @internal\r\n\t */\r\n\tstatic __init__(): void {\r\n\t\tSkyDome.instance = new SkyDome();//TODO:Mesh\r\n\t}\r\n\r\n\t/**@internal */\r\n\tprivate _stacks: number;\r\n\t/**@internal */\r\n\tprivate _slices: number;\r\n\r\n\t/**\r\n\t * \r\n\t */\r\n\tget stacks(): number {\r\n\t\treturn this._stacks;\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t */\r\n\tget slices(): number {\r\n\t\treturn this._slices;\r\n\t}\r\n\r\n\t/**\r\n\t *  <code>SkyDome</code> \r\n\t * @param stacks \r\n\t * @param slices \r\n\t */\r\n\tconstructor(stacks: number = 48, slices: number = 48) {\r\n\t\tsuper(MeshTopology.Triangles,DrawType.DrawElement);\r\n\t\tthis._stacks = stacks;\r\n\t\tthis._slices = slices;\r\n\t\tvar vertexDeclaration: VertexDeclaration = VertexPositionTexture0.vertexDeclaration;\r\n\t\tvar vertexFloatCount: number = vertexDeclaration.vertexStride / 4;\r\n\t\tvar numberVertices: number = (this._stacks + 1) * (this._slices + 1);\r\n\t\tvar numberIndices: number = (3 * this._stacks * (this._slices + 1)) * 2;\r\n\r\n\t\tvar vertices: Float32Array = new Float32Array(numberVertices * vertexFloatCount);\r\n\t\tvar indices: Uint16Array = new Uint16Array(numberIndices);\r\n\r\n\t\tvar stackAngle: number = Math.PI / this._stacks;\r\n\t\tvar sliceAngle: number = (Math.PI * 2.0) / this._slices;\r\n\r\n\t\t// Generate the group of Stacks for the sphere  \r\n\t\tvar vertexIndex: number = 0;\r\n\t\tvar vertexCount: number = 0;\r\n\t\tvar indexCount: number = 0;\r\n\r\n\t\tfor (var stack: number = 0; stack < (this._stacks + 1); stack++) {\r\n\t\t\tvar r: number = Math.sin(stack * stackAngle);\r\n\t\t\tvar y: number = Math.cos(stack * stackAngle);\r\n\r\n\t\t\t// Generate the group of segments for the current Stack  \r\n\t\t\tfor (var slice: number = 0; slice < (this._slices + 1); slice++) {\r\n\t\t\t\tvar x: number = r * Math.sin(slice * sliceAngle);\r\n\t\t\t\tvar z: number = r * Math.cos(slice * sliceAngle);\r\n\t\t\t\tvertices[vertexCount + 0] = x * SkyDome._radius;\r\n\t\t\t\tvertices[vertexCount + 1] = y * SkyDome._radius;\r\n\t\t\t\tvertices[vertexCount + 2] = z * SkyDome._radius;\r\n\t\t\t\tvertices[vertexCount + 3] = -(slice / this._slices) + 0.75;//gzk   slice/_slices\r\n\t\t\t\tvertices[vertexCount + 4] = stack / this._stacks;\r\n\t\t\t\tvertexCount += vertexFloatCount;\r\n\t\t\t\tif (stack != (this._stacks - 1)) {\r\n\t\t\t\t\t// First Face\r\n\t\t\t\t\tindices[indexCount++] = vertexIndex + 1;\r\n\t\t\t\t\tindices[indexCount++] = vertexIndex;\r\n\t\t\t\t\tindices[indexCount++] = vertexIndex + (this._slices + 1);\r\n\t\t\t\t\t// Second \r\n\t\t\t\t\tindices[indexCount++] = vertexIndex + (this._slices + 1);\r\n\t\t\t\t\tindices[indexCount++] = vertexIndex;\r\n\t\t\t\t\tindices[indexCount++] = vertexIndex + (this._slices);\r\n\t\t\t\t\tvertexIndex++;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tlet vertexBuffer = Laya3DRender.renderOBJCreate.createVertexBuffer3D(vertices.length * 4, BufferUsage.Static, false);\r\n\t\tvertexBuffer.vertexDeclaration = vertexDeclaration;\r\n\t\tlet indexBuffer = Laya3DRender.renderOBJCreate.createIndexBuffer3D(IndexFormat.UInt16, indices.length, BufferUsage.Static, false);\r\n\t\tvertexBuffer.setData(vertices.buffer);\r\n\t\tindexBuffer.setData(indices);\r\n\r\n\t\tvar bufferState: BufferState = new BufferState();\r\n\t\tbufferState.applyState([vertexBuffer],indexBuffer);\r\n\t\tthis.bufferState = bufferState;\r\n\t\tthis.indexFormat = IndexFormat.UInt16;\r\n\t\tthis._geometryElementOBj.setDrawElemenParams(indexBuffer.indexCount,0);\r\n\t}\r\n\r\n\t/**\r\n\t * @internal\r\n\t * UpdateGeometry Data\r\n\t */\r\n\t _updateRenderParams(state: RenderContext3D): void {\r\n\t\t\r\n\t}\r\n}\r\n\r\n","import { LayaGL } from \"../../../layagl/LayaGL\";\r\nimport { Matrix4x4 } from \"../../../maths/Matrix4x4\";\r\nimport { Vector3 } from \"../../../maths/Vector3\";\r\nimport { Shader3D } from \"../../../RenderEngine/RenderShader/Shader3D\";\r\nimport { ShaderDataType } from \"../../../RenderEngine/RenderShader/ShaderData\";\r\nimport { Camera } from \"../../core/Camera\";\r\nimport { GeometryElement } from \"../../core/GeometryElement\";\r\nimport { Material } from \"../../../resource/Material\";\r\nimport { BaseRender } from \"../../core/render/BaseRender\";\r\nimport { RenderContext3D } from \"../../core/render/RenderContext3D\";\r\nimport { RenderElement } from \"../../core/render/RenderElement\";\r\nimport { Scene3D } from \"../../core/scene/Scene3D\";\r\nimport { SkyBox } from \"./SkyBox\";\r\nimport { SkyDome } from \"./SkyDome\";\r\n\r\n/**\r\n * <code>SkyRenderer</code> \r\n */\r\nexport class SkyRenderer {\r\n    /** @internal */\r\n    private static _tempMatrix0: Matrix4x4 = new Matrix4x4();\r\n    /** @internal */\r\n    private static _tempMatrix1: Matrix4x4 = new Matrix4x4();\r\n\r\n    /** @internal */\r\n    private _material: Material;\r\n    /** @internal */\r\n    private _mesh: GeometryElement;\r\n    /**@internal */\r\n    private _renderElement: RenderElement;\r\n\r\n    private _renderData: BaseRender;\r\n    static SUNLIGHTDIRECTION: number;\r\n    static SUNLIGHTDIRCOLOR: number;\r\n    static __init__() {\r\n        SkyRenderer.SUNLIGHTDIRECTION = Shader3D.propertyNameToID(\"u_SunLight_direction\");\r\n        SkyRenderer.SUNLIGHTDIRCOLOR = Shader3D.propertyNameToID(\"u_SunLight_color\");\r\n        const commandUniform = LayaGL.renderOBJCreate.createGlobalUniformMap(\"Sprite3D\");\r\n        commandUniform.addShaderUniform(SkyRenderer.SUNLIGHTDIRECTION, \"u_SunLight_direction\", ShaderDataType.Vector3);\r\n        commandUniform.addShaderUniform(SkyRenderer.SUNLIGHTDIRCOLOR, \"u_SunLight_color\", ShaderDataType.Color);\r\n    }\r\n\r\n    /**\r\n     * \r\n     */\r\n    get material(): Material {\r\n        return this._material;\r\n    }\r\n\r\n    set material(value: Material) {\r\n        if (this._material !== value) {\r\n            (this._material) && (this._material._removeReference());\r\n            this._material = value;\r\n            this._renderElement.material = value;\r\n            if (value) {\r\n                value._addReference();\r\n                this._renderElement.renderSubShader = this._material._shader.getSubShaderAt(0);\r\n            }\r\n            else\r\n                this._renderElement.renderSubShader = null;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * \r\n     */\r\n    get mesh(): GeometryElement {\r\n        return this._mesh;\r\n    }\r\n\r\n    set mesh(value: GeometryElement) {\r\n\r\n        if (this._mesh !== value) {\r\n            this._mesh = value;\r\n            this._renderElement.setGeometry(this._mesh);\r\n        }\r\n    }\r\n\r\n    //@internal\r\n    private get meshType(): \"box\" | \"dome\" | \"\" {\r\n        return this.mesh == SkyBox.instance ? \"box\" : (this.mesh == SkyDome.instance ? \"dome\" : \"\");\r\n    }\r\n\r\n    //@internal\r\n    private set meshType(value: \"box\" | \"dome\" | \"\") {\r\n        if (value == \"dome\")\r\n            this.mesh = SkyDome.instance;\r\n        else\r\n            this.mesh = SkyBox.instance;\r\n    }\r\n\r\n    /**\r\n     *  <code>SkyRenderer</code> \r\n     */\r\n    constructor() {\r\n        this._renderElement = new RenderElement();\r\n        this.mesh = SkyDome.instance;\r\n        this._renderData = new BaseRender();\r\n        this._renderElement.render = this._renderData;\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     * \r\n     */\r\n    _isAvailable(): boolean {\r\n        return this._material && this._mesh ? true : false;\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    _render(context: RenderContext3D): void {\r\n        if (this._material && this._mesh) {\r\n            var camera = context.camera;\r\n            var scene: Scene3D = context.scene;\r\n            var projectionMatrix: Matrix4x4 = SkyRenderer._tempMatrix1;\r\n            this._renderData._shaderValues.setColor(SkyRenderer.SUNLIGHTDIRCOLOR, scene._sunColor);\r\n            this._renderData._shaderValues.setVector3(SkyRenderer.SUNLIGHTDIRECTION, scene._sundir);\r\n            //,DirectX\r\n            //http://terathon.com/gdc07_lengyel.pdf\r\n\r\n            //xScale  0     0                          0\r\n            //0     yScale  0                          0\r\n            //0       0    \t-zfar /(zfar-znear)        -1.0\r\n            //0       0     -znear*zfar /(zfar-znear)  0\r\n\r\n            //xScale  0     0       0        mul   [x,y,z,0] =[xScale*x,yScale*y,-z,-z]\r\n            //0     yScale  0       0\t\t\r\n            //0       0    \t-1      -1.0\t\r\n            //0       0     -0      0\r\n\r\n            //[xScale*x,yScale*y,-z,-z]=>[-xScale*x/z,-yScale*y/z,1]\r\n\r\n            //xScale  0     0       0      \r\n            //0     yScale  0       0\t\t\r\n            //0       0    \t-1+e    -1.0\t\r\n            //0       0     -0  0\r\n            var viewMatrix: Matrix4x4 = SkyRenderer._tempMatrix0;\r\n\r\n            camera.viewMatrix.cloneTo(viewMatrix);//\r\n            viewMatrix.setTranslationVector(Vector3.ZERO);\r\n            if (!camera.orthographic) {\r\n                camera.projectionMatrix.cloneTo(projectionMatrix);\r\n\r\n                var epsilon: number = 1e-6;\r\n                var yScale: number = 1.0 / Math.tan(3.1416 * camera.fieldOfView / 180 * 0.5);\r\n                projectionMatrix.elements[0] = yScale / camera.aspectRatio;\r\n                projectionMatrix.elements[5] = yScale;\r\n                projectionMatrix.elements[10] = epsilon - 1.0;\r\n                projectionMatrix.elements[11] = -1.0;\r\n                projectionMatrix.elements[14] = -0;//znear\r\n\r\n            } else {\r\n\r\n                var halfWidth: number = 0.2;\r\n                var halfHeight: number = halfWidth;\r\n                Matrix4x4.createOrthoOffCenter(-halfWidth, halfWidth, -halfHeight, halfHeight, camera.nearPlane, camera.farPlane, projectionMatrix);\r\n            }\r\n            if ((camera as any).isWebXR) {\r\n                camera._applyViewProject(context, viewMatrix, camera.projectionMatrix);//TODO: Camera\r\n            } else {\r\n                camera._applyViewProject(context, viewMatrix, projectionMatrix);//TODO: Camera\r\n            }\r\n\r\n\r\n            context._contextOBJ.applyContext(Camera._updateMark);\r\n            context.drawRenderElement(this._renderElement);\r\n            camera._applyViewProject(context, camera.viewMatrix, camera.projectionMatrix);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    destroy(): void {\r\n\r\n        if (this._material) {\r\n            this._material._removeReference();\r\n            this._material = null;\r\n        }\r\n        this._renderData.destroy();\r\n        this._renderElement.destroy();\r\n\r\n\r\n    }\r\n\r\n}\r\n\r\n\r\n","import { Node } from \"../../display/Node\";\r\nimport { Event } from \"../../events/Event\";\r\nimport { Loader } from \"../../net/Loader\";\r\nimport { Config3D } from \"../../../Config3D\";\r\nimport { IRenderEngine } from \"../../RenderEngine/RenderInterface/IRenderEngine\";\r\nimport { Shader3D } from \"../../RenderEngine/RenderShader/Shader3D\";\r\nimport { ShaderData, ShaderDataType } from \"../../RenderEngine/RenderShader/ShaderData\";\r\nimport { ShaderDefine } from \"../../RenderEngine/RenderShader/ShaderDefine\";\r\nimport { UniformBufferParamsType, UnifromBufferData } from \"../../RenderEngine/UniformBufferData\";\r\nimport { Scene3D } from \"./scene/Scene3D\";\r\nimport { Sprite3D, StaticFlag } from \"./Sprite3D\";\r\nimport { UniformBufferObject } from \"../../RenderEngine/UniformBufferObject\";\r\nimport { BufferUsage } from \"../../RenderEngine/RenderEnum/BufferTargetType\";\r\nimport { CommandUniformMap } from \"../../RenderEngine/CommandUniformMap\";\r\nimport { ILaya } from \"../../../ILaya\";\r\nimport { Color } from \"../../maths/Color\";\r\nimport { Matrix4x4 } from \"../../maths/Matrix4x4\";\r\nimport { Vector3 } from \"../../maths/Vector3\";\r\nimport { SkyRenderer } from \"../resource/models/SkyRenderer\";\r\nimport { LayaGL } from \"../../layagl/LayaGL\";\r\n\r\n/**\r\n * <code>BaseCamera</code> \r\n */\r\nexport class BaseCamera extends Sprite3D {\r\n    /** @internal CameraUniformBlock Map */\r\n    static cameraUniformMap: CommandUniformMap;\r\n    /**Camera Uniform PropertyID */\r\n    /**@internal */\r\n    static CAMERAPOS: number;\r\n    /**@internal */\r\n    static VIEWMATRIX: number;\r\n    /**@internal */\r\n    static PROJECTMATRIX: number;\r\n    /**@internal */\r\n    static VIEWPROJECTMATRIX: number;\r\n    /**@internal */\r\n    static CAMERADIRECTION: number;\r\n    /**@internal */\r\n    static CAMERAUP: number;\r\n    /**@internal */\r\n    static VIEWPORT: number;\r\n    /**@internal */\r\n    static PROJECTION_PARAMS: number;\r\n    /**@internal */\r\n    static OPAQUETEXTURE: number\r\n    /**@internal */\r\n    static OPAQUETEXTUREPARAMS: number;\r\n    /**@internal */\r\n    static DEPTHTEXTURE: number;\r\n    /**@internal */\r\n    static DEPTHNORMALSTEXTURE: number;\r\n    /**@internal */\r\n    static DEPTHZBUFFERPARAMS: number;\r\n    /**@internal */\r\n    static CAMERAUNIFORMBLOCK: number;\r\n    /**Camera Define*/\r\n    /**@internal */\r\n    static SHADERDEFINE_DEPTH: ShaderDefine;\r\n    /**@internal */\r\n    static SHADERDEFINE_DEPTHNORMALS: ShaderDefine;\r\n    /**@internal */\r\n    static SHADERDEFINE_ORTHOGRAPHIC: ShaderDefine;\r\n    /**@internal */\r\n    static SHADERDEFINE_FXAA: ShaderDefine;\r\n    /**@internal */\r\n    static RENDERINGTYPE_SHADERDEFINE_FXAA: string = \"FXAA\";\r\n    /**,*/\r\n    static RENDERINGTYPE_DEFERREDLIGHTING: string = \"DEFERREDLIGHTING\";\r\n    /**,*/\r\n    static RENDERINGTYPE_FORWARDRENDERING: string = \"FORWARDRENDERING\";\r\n    /**@internal */\r\n    protected static _invertYScaleMatrix: Matrix4x4 = new Matrix4x4(1, 0, 0, 0, 0, -1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1);//Matrix4x4.createScaling(new Vector3(1, -1, 1), _invertYScaleMatrix);\r\n    /**@internal */\r\n    protected static _invertYProjectionMatrix: Matrix4x4 = new Matrix4x4();\r\n    /**@internal */\r\n    protected static _invertYProjectionViewMatrix: Matrix4x4 = new Matrix4x4();\r\n    /**@internal */\r\n    static _tempMatrix4x40: Matrix4x4 = new Matrix4x4();\r\n    /**@internal */\r\n    static CameraUBOData: UnifromBufferData;\r\n    /**\r\n     * @internal\r\n     * shaderInfo init\r\n     */\r\n    static shaderValueInit() {\r\n        BaseCamera.SHADERDEFINE_DEPTH = Shader3D.getDefineByName(\"DEPTHMAP\");\r\n        BaseCamera.SHADERDEFINE_DEPTHNORMALS = Shader3D.getDefineByName(\"DEPTHNORMALSMAP\");\r\n        BaseCamera.SHADERDEFINE_ORTHOGRAPHIC = Shader3D.getDefineByName(\"CAMERAORTHOGRAPHIC\");\r\n        BaseCamera.SHADERDEFINE_FXAA = Shader3D.getDefineByName(\"FXAA\");\r\n        let camerauniformMap = BaseCamera.cameraUniformMap = LayaGL.renderOBJCreate.createGlobalUniformMap(\"BaseCamera\");\r\n\r\n        BaseCamera.CAMERAPOS = Shader3D.propertyNameToID(\"u_CameraPos\");\r\n        BaseCamera.VIEWMATRIX = Shader3D.propertyNameToID(\"u_View\");\r\n        BaseCamera.VIEWPROJECTMATRIX = Shader3D.propertyNameToID(\"u_ViewProjection\");\r\n        BaseCamera.PROJECTMATRIX = Shader3D.propertyNameToID(\"u_Projection\");\r\n        BaseCamera.CAMERADIRECTION = Shader3D.propertyNameToID(\"u_CameraDirection\");\r\n        BaseCamera.CAMERAUP = Shader3D.propertyNameToID(\"u_CameraUp\");\r\n        BaseCamera.VIEWPORT = Shader3D.propertyNameToID(\"u_Viewport\");\r\n        BaseCamera.PROJECTION_PARAMS = Shader3D.propertyNameToID(\"u_ProjectionParams\");\r\n        BaseCamera.DEPTHTEXTURE = Shader3D.propertyNameToID(\"u_CameraDepthTexture\");\r\n        BaseCamera.DEPTHNORMALSTEXTURE = Shader3D.propertyNameToID(\"u_CameraDepthNormalsTexture\");\r\n        BaseCamera.OPAQUETEXTURE = Shader3D.propertyNameToID(\"u_CameraOpaqueTexture\");\r\n        BaseCamera.OPAQUETEXTUREPARAMS = Shader3D.propertyNameToID(\"u_OpaqueTextureParams\");\r\n        BaseCamera.DEPTHZBUFFERPARAMS = Shader3D.propertyNameToID(\"u_ZBufferParams\");\r\n        BaseCamera.CAMERAUNIFORMBLOCK = Shader3D.propertyNameToID(UniformBufferObject.UBONAME_CAMERA);\r\n        if (Config3D._uniformBlock) {\r\n            camerauniformMap.addShaderBlockUniform(BaseCamera.CAMERAUNIFORMBLOCK, UniformBufferObject.UBONAME_CAMERA, [\r\n                {\r\n                    id: BaseCamera.VIEWMATRIX,\r\n                    propertyName: \"u_View\",\r\n                    uniformtype: ShaderDataType.Matrix4x4\r\n                },\r\n                {\r\n                    id: BaseCamera.PROJECTMATRIX,\r\n                    propertyName: \"u_Projection\",\r\n                    uniformtype: ShaderDataType.Matrix4x4\r\n                },\r\n                {\r\n                    id: BaseCamera.VIEWPROJECTMATRIX,\r\n                    propertyName: \"u_ViewProjection\",\r\n                    uniformtype: ShaderDataType.Matrix4x4\r\n                },\r\n\r\n                {\r\n                    id: BaseCamera.PROJECTION_PARAMS,\r\n                    propertyName: \"u_ProjectionParams\",\r\n                    uniformtype: ShaderDataType.Vector4\r\n                },\r\n                {\r\n                    id: BaseCamera.VIEWPORT,\r\n                    propertyName: \"u_Viewport\",\r\n                    uniformtype: ShaderDataType.Vector4\r\n                },\r\n                {\r\n                    id: BaseCamera.CAMERADIRECTION,\r\n                    propertyName: \"u_CameraDirection\",\r\n                    uniformtype: ShaderDataType.Vector3\r\n                },\r\n                {\r\n                    id: BaseCamera.CAMERAUP,\r\n                    propertyName: \"u_CameraUp\",\r\n                    uniformtype: ShaderDataType.Vector3\r\n                },\r\n                {\r\n                    id: BaseCamera.CAMERAPOS,\r\n                    propertyName: \"u_CameraPos\",\r\n                    uniformtype: ShaderDataType.Vector3\r\n                }\r\n            ]);\r\n        } else {\r\n            camerauniformMap.addShaderUniform(BaseCamera.CAMERAPOS, \"u_CameraPos\", ShaderDataType.Vector3);\r\n            camerauniformMap.addShaderUniform(BaseCamera.VIEWMATRIX, \"u_View\", ShaderDataType.Matrix4x4);\r\n            camerauniformMap.addShaderUniform(BaseCamera.PROJECTMATRIX, \"u_Projection\", ShaderDataType.Matrix4x4);\r\n            camerauniformMap.addShaderUniform(BaseCamera.VIEWPROJECTMATRIX, \"u_ViewProjection\", ShaderDataType.Vector4);\r\n            camerauniformMap.addShaderUniform(BaseCamera.CAMERADIRECTION, \"u_CameraDirection\", ShaderDataType.Vector3);\r\n            camerauniformMap.addShaderUniform(BaseCamera.CAMERAUP, \"u_CameraUp\", ShaderDataType.Vector3);\r\n            camerauniformMap.addShaderUniform(BaseCamera.VIEWPORT, \"u_Viewport\", ShaderDataType.Vector4);\r\n            camerauniformMap.addShaderUniform(BaseCamera.PROJECTION_PARAMS, \"u_ProjectionParams\", ShaderDataType.Vector4);\r\n        }\r\n        camerauniformMap.addShaderUniform(BaseCamera.DEPTHTEXTURE, \"u_CameraDepthTexture\", ShaderDataType.Texture2D);\r\n        camerauniformMap.addShaderUniform(BaseCamera.DEPTHNORMALSTEXTURE, \"u_CameraDepthNormalsTexture\", ShaderDataType.Texture2D);\r\n        camerauniformMap.addShaderUniform(BaseCamera.OPAQUETEXTURE, \"u_CameraOpaqueTexture\", ShaderDataType.Texture2D);\r\n        camerauniformMap.addShaderUniform(BaseCamera.OPAQUETEXTUREPARAMS, \"u_OpaqueTextureParams\", ShaderDataType.Vector4);\r\n        camerauniformMap.addShaderUniform(BaseCamera.DEPTHZBUFFERPARAMS, \"u_ZBufferParams\", ShaderDataType.Vector4);\r\n    }\r\n\r\n    /**\r\n     * create BaseCamera UniformBuffer\r\n     * @internal\r\n     * @returns \r\n     */\r\n    static createCameraUniformBlock() {\r\n        if (!BaseCamera.CameraUBOData) {\r\n            let uniformPara: Map<string, UniformBufferParamsType> = new Map<string, UniformBufferParamsType>();\r\n            uniformPara.set(\"u_View\", UniformBufferParamsType.Matrix4x4);\r\n            uniformPara.set(\"u_Projection\", UniformBufferParamsType.Matrix4x4);\r\n            uniformPara.set(\"u_ViewProjection\", UniformBufferParamsType.Matrix4x4);\r\n            uniformPara.set(\"u_ProjectionParams\", UniformBufferParamsType.Vector4);\r\n            uniformPara.set(\"u_Viewport\", UniformBufferParamsType.Vector4);\r\n            uniformPara.set(\"u_CameraDirection\", UniformBufferParamsType.Vector3);\r\n            uniformPara.set(\"u_CameraUp\", UniformBufferParamsType.Vector3);\r\n            uniformPara.set(\"u_CameraPos\", UniformBufferParamsType.Vector3);\r\n\r\n            let uniformMap = new Map<number, UniformBufferParamsType>();\r\n            uniformPara.forEach((value, key) => {\r\n                uniformMap.set(Shader3D.propertyNameToID(key), value);\r\n            })\r\n            BaseCamera.CameraUBOData = new UnifromBufferData(uniformMap);\r\n        }\r\n\r\n        return BaseCamera.CameraUBOData;\r\n    }\r\n    /**\r\n     * Camera Init\r\n     */\r\n    static __init__() {\r\n        BaseCamera.shaderValueInit();\r\n    }\r\n\r\n    /** @internal */\r\n    _renderingOrder: number\r\n    /** @internal */\r\n    _cameraUniformData: UnifromBufferData;\r\n    /** @internal */\r\n    _cameraUniformUBO: UniformBufferObject;\r\n    /** */\r\n    protected _nearPlane: number;\r\n    /** */\r\n    protected _farPlane: number;\r\n    /** */\r\n    protected _renderEngine: IRenderEngine;\r\n    /**@internal */\r\n    private _yrange: number;\r\n    /** */\r\n    private _fieldOfView: number;\r\n    /** */\r\n    private _orthographicVerticalSize: number;\r\n    /** skyRender */\r\n    private _skyRenderer: SkyRenderer = new SkyRenderer();\r\n    /** */\r\n    _forward: Vector3 = new Vector3();\r\n    /** up */\r\n    _up: Vector3 = new Vector3();\r\n    /**  */\r\n    protected _orthographic: boolean;\r\n    /**@internal ResetProjectionMatrix*/\r\n    protected _useUserProjectionMatrix: boolean;\r\n\r\n    /** @internal */\r\n    _shaderValues: ShaderData;\r\n\r\n    /** @internal */\r\n    _linearClearColor: Color;\r\n    /**,CornflowerBlue*/\r\n    private _clearColor: Color;\r\n    public get clearColor(): Color {\r\n        return this._clearColor;\r\n    }\r\n    public set clearColor(value: Color) {\r\n        this._clearColor = value;\r\n        value.toLinear(this._linearClearColor);\r\n    }\r\n    /** , :cullingMask=Math.pow(2,0)|Math.pow(2,1)01*/\r\n    private _cullingMask: number;\r\n\r\n    /**\r\n     * @internal\r\n     * \r\n     */\r\n    staticMask: number;\r\n\r\n    /**  */\r\n    useOcclusionCulling: boolean;\r\n\r\n    /**\r\n     * \r\n     */\r\n    get skyRenderer(): SkyRenderer {\r\n        return this._skyRenderer;\r\n    }\r\n\r\n    /**\r\n     * \r\n     */\r\n    get fieldOfView(): number {\r\n        return this._fieldOfView;\r\n    }\r\n\r\n    set fieldOfView(value: number) {\r\n        this._fieldOfView = value;\r\n        this._calculateProjectionMatrix();\r\n        this._caculateMaxLocalYRange();\r\n    }\r\n\r\n    /**\r\n   * \r\n   */\r\n    get maxlocalYDistance(): number {\r\n        return this._yrange;\r\n    }\r\n\r\n    /**\r\n     * \r\n     */\r\n    get nearPlane(): number {\r\n        return this._nearPlane;\r\n    }\r\n\r\n    set nearPlane(value: number) {\r\n        this._nearPlane = value;\r\n        this._calculateProjectionMatrix();\r\n\r\n    }\r\n\r\n    /**\r\n     * \r\n     */\r\n    get farPlane(): number {\r\n        return this._farPlane;\r\n    }\r\n\r\n    set farPlane(vaule: number) {\r\n        this._farPlane = vaule;\r\n        this._calculateProjectionMatrix();\r\n        this._caculateMaxLocalYRange();\r\n    }\r\n\r\n    /**\r\n     * \r\n     */\r\n    get orthographic(): boolean {\r\n        return this._orthographic;\r\n    }\r\n\r\n    set orthographic(vaule: boolean) {\r\n        this._orthographic = vaule;\r\n        this._calculateProjectionMatrix();\r\n        if (vaule) {\r\n            this._shaderValues.addDefine(BaseCamera.SHADERDEFINE_ORTHOGRAPHIC);\r\n        } else\r\n            this._shaderValues.removeDefine(BaseCamera.SHADERDEFINE_ORTHOGRAPHIC);\r\n    }\r\n\r\n    /**\r\n     * \r\n     */\r\n    get orthographicVerticalSize(): number {\r\n        return this._orthographicVerticalSize;\r\n    }\r\n\r\n    set orthographicVerticalSize(vaule: number) {\r\n        this._orthographicVerticalSize = vaule;\r\n        this._calculateProjectionMatrix();\r\n    }\r\n\r\n    get cullingMask() {\r\n        return this._cullingMask;\r\n    }\r\n\r\n    set cullingMask(value: number) {\r\n        this._cullingMask = value;\r\n    }\r\n\r\n    /**\r\n     * \r\n     */\r\n    get renderingOrder(): number {\r\n        return this._renderingOrder;\r\n    }\r\n\r\n    set renderingOrder(value: number) {\r\n        this._renderingOrder = value;\r\n        this._sortCamerasByRenderingOrder();\r\n    }\r\n\r\n    /**\r\n     *  <code>BaseCamera</code> \r\n     * @param\tfieldOfView \r\n     * @param\tnearPlane \r\n     * @param\tfarPlane \r\n     */\r\n    constructor(nearPlane: number = 0.3, farPlane: number = 1000) {\r\n        super();\r\n        this._shaderValues = LayaGL.renderOBJCreate.createShaderData(null);\r\n\r\n        this._linearClearColor = new Color();\r\n        this.clearColor = new Color(100 / 255, 149 / 255, 237 / 255, 255 / 255);\r\n\r\n        this._fieldOfView = 60;\r\n        this._useUserProjectionMatrix = false;\r\n\r\n\r\n        this._orthographicVerticalSize = 10;\r\n        this.renderingOrder = 0;\r\n\r\n        this._nearPlane = nearPlane;\r\n        this._farPlane = farPlane;\r\n\r\n        this.cullingMask = 2147483647/*int.MAX_VALUE*/;\r\n        this.staticMask = 0xffffffff;\r\n        this.useOcclusionCulling = true;\r\n        this._renderEngine = LayaGL.renderEngine;\r\n        this._orthographic = false;\r\n        if (Config3D._uniformBlock) {\r\n            this._cameraUniformUBO = UniformBufferObject.getBuffer(UniformBufferObject.UBONAME_CAMERA, 0);\r\n            this._cameraUniformData = BaseCamera.createCameraUniformBlock();\r\n            if (!this._cameraUniformUBO) {\r\n                this._cameraUniformUBO = UniformBufferObject.create(UniformBufferObject.UBONAME_CAMERA, BufferUsage.Dynamic, this._cameraUniformData.getbyteLength(), false);\r\n            }\r\n            this._shaderValues._addCheckUBO(UniformBufferObject.UBONAME_CAMERA, this._cameraUniformUBO, this._cameraUniformData);\r\n            this._shaderValues.setUniformBuffer(BaseCamera.CAMERAUNIFORMBLOCK, this._cameraUniformUBO);\r\n        }\r\n    }\r\n\r\n    private _caculateMaxLocalYRange() {\r\n        let halffield = 3.1416 * this.fieldOfView / 180.0 / 2;\r\n        let dist = this.farPlane;\r\n        this._yrange = Math.tan(halffield) * dist * 2;\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    protected _calculateProjectionMatrix(): void {\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    protected _onScreenSizeChanged(): void {\r\n        this._calculateProjectionMatrix();\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    protected _create(): Node {\r\n        return new BaseCamera();\r\n    }\r\n\r\n    /**\r\n     * RenderingOrder\r\n     * @internal\r\n     */\r\n    _sortCamerasByRenderingOrder(): void {\r\n        if (this.displayedInStage) {\r\n            var cameraPool: BaseCamera[] = this.scene._cameraPool;//TODO:\r\n            var n: number = cameraPool.length - 1;\r\n            for (var i: number = 0; i < n; i++) {\r\n                if (cameraPool[i].renderingOrder > cameraPool[n].renderingOrder) {\r\n                    var tempCamera: BaseCamera = cameraPool[i];\r\n                    cameraPool[i] = cameraPool[n];\r\n                    cameraPool[n] = tempCamera;\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    _prepareCameraToRender(): void {\r\n        //var cameraSV: ShaderData = this._shaderValues;\r\n        this.transform.getForward(this._forward);\r\n        this.transform.getUp(this._up);\r\n        this._shaderValues.setVector3(BaseCamera.CAMERAPOS, this.transform.position);\r\n        this._shaderValues.setVector3(BaseCamera.CAMERADIRECTION, this._forward);\r\n        this._shaderValues.setVector3(BaseCamera.CAMERAUP, this._up);\r\n    }\r\n\r\n    // /**\r\n    //  * @internal\r\n    //  */\r\n    // _setShaderValue(index: number, value: any) {\r\n    // \tif (this._cameraUniformData && this._cameraUniformData._has(index))\r\n    // \t\tthis._cameraUniformData._setData(index, value);\r\n    // \tthis._shaderValues.setValueData(index, value);\r\n    // }\r\n\r\n    // /**\r\n    //  * @internal\r\n    //  */\r\n    // _getShaderValue(index: number): any {\r\n    // \treturn this._shaderValues.getValueData(index);\r\n    // }\r\n\r\n\r\n    /**\r\n     * \r\n     * @param\tshader \r\n     * @param   replacementTag \r\n     */\r\n    render(shader: Shader3D = null, replacementTag: string = null): void {\r\n    }\r\n\r\n    /**\r\n     * ,layer031\r\n     * @param layer \r\n     */\r\n    addLayer(layer: number): void {\r\n        this.cullingMask |= Math.pow(2, layer);\r\n    }\r\n\r\n    /**\r\n     * ,layer031\r\n     * @param layer \r\n     */\r\n    removeLayer(layer: number): void {\r\n        this.cullingMask &= ~Math.pow(2, layer);\r\n    }\r\n\r\n    /**\r\n     * \r\n     */\r\n    addAllLayers(): void {\r\n        this.cullingMask = 2147483647/*int.MAX_VALUE*/;\r\n    }\r\n\r\n    /**\r\n     * \r\n     */\r\n    removeAllLayers(): void {\r\n        this.cullingMask = 0;\r\n    }\r\n\r\n    /**\r\n     * \r\n     */\r\n    resetProjectionMatrix(): void {\r\n        this._useUserProjectionMatrix = false;\r\n        this._calculateProjectionMatrix();\r\n    }\r\n\r\n    /**\r\n     * @inheritDoc\r\n     * @override\r\n     */\r\n    protected _onActive(): void {\r\n        ((<Scene3D>this._scene))._addCamera(this);\r\n        super._onActive();\r\n    }\r\n\r\n    /**\r\n     * @inheritDoc\r\n     * @override\r\n     */\r\n    protected _onInActive(): void {\r\n        ((<Scene3D>this._scene))._removeCamera(this);\r\n        super._onInActive();\r\n    }\r\n\r\n    /**\r\n     * @inheritDoc\r\n     * @override\r\n     * @internal\r\n     */\r\n    _parse(data: any, spriteMap: any): void {\r\n        super._parse(data, spriteMap);\r\n\r\n        this.orthographic = data.orthographic;\r\n        (data.orthographicVerticalSize !== undefined) && (this.orthographicVerticalSize = data.orthographicVerticalSize);\r\n        (data.fieldOfView !== undefined) && (this.fieldOfView = data.fieldOfView);\r\n        this.nearPlane = data.nearPlane;\r\n        this.farPlane = data.farPlane;\r\n\r\n        var color: any[] = data.clearColor;\r\n        this.clearColor = new Color(color[0], color[1], color[2], color[3]);\r\n        var skyboxMaterial: any = data.skyboxMaterial;\r\n        if (skyboxMaterial) {\r\n            this._skyRenderer.material = Loader.getRes(skyboxMaterial.path);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @inheritDoc\r\n     * @override\r\n     * @param \r\n     */\r\n    destroy(destroyChild: boolean = true): void {\r\n        //postProcess = null;\r\n        //AmbientLight = null;\r\n        this._skyRenderer.destroy();\r\n        this._skyRenderer = null;\r\n\r\n        ILaya.stage.off(Event.RESIZE, this, this._onScreenSizeChanged);\r\n        super.destroy(destroyChild);\r\n    }\r\n}\r\n\r\n","import { RenderElement } from \"./RenderElement\";\r\nimport { Scene3D } from \"../scene/Scene3D\"\r\nimport { Viewport } from \"../../math/Viewport\"\r\nimport { ShaderData } from \"../../../RenderEngine/RenderShader/ShaderData\";\r\nimport { Camera } from \"../Camera\";\r\nimport { Shader3D } from \"../../../RenderEngine/RenderShader/Shader3D\";\r\nimport { IRenderContext3D, PipelineMode } from \"../../../RenderEngine/RenderInterface/RenderPipelineInterface/IRenderContext3D\";\r\nimport { IRenderTarget } from \"../../../RenderEngine/RenderInterface/IRenderTarget\";\r\nimport { Matrix4x4 } from \"../../../maths/Matrix4x4\";\r\nimport { Vector4 } from \"../../../maths/Vector4\";\r\nimport { ShaderInstance } from \"../../../RenderEngine/RenderShader/ShaderInstance\";\r\nimport { ShaderDefine } from \"../../../RenderEngine/RenderShader/ShaderDefine\";\r\nimport { Laya3DRender } from \"../../RenderObjs/Laya3DRender\";\r\n\r\n/**\r\n * <code>RenderContext3D</code> \r\n */\r\nexport class RenderContext3D {\r\n    static _instance: RenderContext3D;\r\n\r\n    /***/\r\n    static clientWidth: number;\r\n    /***/\r\n    static clientHeight: number;\r\n\r\n    /** @internal */\r\n    static GammaCorrect: ShaderDefine;\r\n\r\n    /**@internal */\r\n    static __init__() {\r\n        RenderContext3D._instance = new RenderContext3D();\r\n\r\n        this.GammaCorrect = Shader3D.getDefineByName(\"GAMMACORRECT\");\r\n    }\r\n\r\n    /** @internal */\r\n    viewMatrix: Matrix4x4;\r\n    /**@internal */\r\n    customShader: Shader3D;\r\n    /**@internal */\r\n    replaceTag: string;\r\n\r\n    /** @internal */\r\n    projectionMatrix: Matrix4x4;\r\n    /** @internal */\r\n    projectionViewMatrix: Matrix4x4;\r\n    /** @internal */\r\n    renderElement: RenderElement;\r\n\r\n    camera: Camera;\r\n    /**@internal */\r\n    _scene: Scene3D;\r\n    /** @internal */\r\n    shader: ShaderInstance;\r\n    /** */\r\n    configPipeLineMode: PipelineMode = \"Forward\";\r\n    /**@internal contextOBJ*/\r\n    _contextOBJ: IRenderContext3D;\r\n    /**@internal */\r\n    get destTarget(): IRenderTarget {\r\n        return this._contextOBJ.destTarget;\r\n    }\r\n\r\n    /**@internal */\r\n    set destTarget(value: IRenderTarget) {\r\n        this._contextOBJ.destTarget = value;\r\n\r\n        // todo ohter color gamut\r\n        // let sRGBGammaOut = false;\r\n        // if (value) {\r\n        //     // todo \r\n        //     if (value._renderTarget._textures[0].gammaCorrection == 2.2) {\r\n        //         sRGBGammaOut = true;\r\n        //     }\r\n        // }\r\n        // else {\r\n        //     // , srgb gamma 2.2\r\n        //     sRGBGammaOut = true;\r\n        // }\r\n\r\n        // if (sRGBGammaOut) {\r\n        //     this._contextOBJ.configShaderData.addDefine(RenderContext3D.GammaCorrect);\r\n        // }\r\n        // else {\r\n        //     this._contextOBJ.configShaderData.removeDefine(RenderContext3D.GammaCorrect);\r\n        // }\r\n    }\r\n\r\n    /** @internal */\r\n    get viewport(): Viewport {\r\n        return this._contextOBJ.viewPort;\r\n    }\r\n\r\n    set viewport(value: Viewport) {\r\n        value.cloneTo(this._contextOBJ.viewPort);\r\n    }\r\n    /** @internal */\r\n    get scissor(): Vector4 {\r\n        return this._contextOBJ.scissor;\r\n    }\r\n\r\n    set scissor(value: Vector4) {\r\n        value.cloneTo(this._contextOBJ.scissor);\r\n    }\r\n\r\n    /** @internal */\r\n    get invertY(): boolean {\r\n        return this._contextOBJ.invertY;\r\n    }\r\n\r\n    set invertY(value: boolean) {\r\n        this._contextOBJ.invertY = value;\r\n    }\r\n\r\n    /** @internal */\r\n    get pipelineMode(): PipelineMode {\r\n        return this._contextOBJ.pipelineMode;\r\n    }\r\n\r\n    set pipelineMode(value: PipelineMode) {\r\n        this._contextOBJ.pipelineMode = value;\r\n    }\r\n    //Camera Shader Data\r\n    get cameraShaderValue(): ShaderData {\r\n        return this._contextOBJ.cameraShaderData;\r\n    }\r\n\r\n    set cameraShaderValue(value: ShaderData) {\r\n        this._contextOBJ.cameraShaderData = value;\r\n    }\r\n\r\n    /** @internal */\r\n    set scene(value: Scene3D) {\r\n        if (value) {\r\n            this._contextOBJ.sceneID = value._id;\r\n            this._contextOBJ.sceneShaderData = value._shaderValues;\r\n            this._scene = value;\r\n        } else {\r\n            this._contextOBJ.sceneID = -1;\r\n            this._contextOBJ.sceneShaderData = null;\r\n            this._scene = null;\r\n        }\r\n\r\n    }\r\n\r\n    get scene(): Scene3D {\r\n        return this._scene;\r\n    }\r\n\r\n    changeViewport(x: number, y: number, width: number, height: number) {\r\n        Viewport._tempViewport.set(x, y, width, height);\r\n        this.viewport = Viewport._tempViewport;\r\n    }\r\n\r\n    changeScissor(x: number, y: number, width: number, height: number) {\r\n        Vector4.tempVec4.setValue(x, y, width, height);\r\n        this.scissor = Vector4.tempVec4;\r\n    }\r\n\r\n    applyContext(cameraUpdateMark: number) {\r\n        this._contextOBJ.applyContext(cameraUpdateMark);\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @param element \r\n     */\r\n    drawRenderElement(element: RenderElement): void {\r\n        element.material && element._convertSubShader(this.customShader, this.replaceTag);\r\n        if (!element.renderSubShader || !element._renderElementOBJ._materialShaderData)\r\n            return;\r\n        element._renderUpdatePre(this);\r\n        this._contextOBJ.drawRenderElement(element._renderElementOBJ);\r\n    }\r\n    /**\r\n     *  <code>RenderContext3D</code> \r\n     */\r\n    constructor() {\r\n        this._contextOBJ = Laya3DRender.renderOBJCreate.createRenderContext3D();\r\n    }\r\n\r\n}\r\n\r\n\r\n","import { BufferUsage } from \"../../../RenderEngine/RenderEnum/BufferTargetType\"\r\nimport { DrawType } from \"../../../RenderEngine/RenderEnum/DrawType\"\r\nimport { MeshTopology } from \"../../../RenderEngine/RenderEnum/RenderPologyMode\"\r\nimport { VertexDeclaration } from \"../../../RenderEngine/VertexDeclaration\"\r\nimport { VertexElement } from \"../../../renders/VertexElement\"\r\nimport { VertexElementFormat } from \"../../../renders/VertexElementFormat\"\r\nimport { BufferState } from \"../../../webgl/utils/BufferState\"\r\nimport { Laya3DRender } from \"../../RenderObjs/Laya3DRender\"\r\nimport { VertexBuffer3D } from \"../../graphics/VertexBuffer3D\"\r\nimport { GeometryElement } from \"../GeometryElement\"\r\nimport { RenderContext3D } from \"./RenderContext3D\"\r\n\r\n/**\r\n * <code>ScreenQuad</code> \r\n */\r\nexport class ScreenQuad extends GeometryElement {\r\n\t/** @internal */\r\n\tstatic SCREENQUAD_POSITION_UV: number = 0;\r\n\t/** @internal */\r\n\tprivate static _vertexDeclaration: VertexDeclaration;\r\n\t/** @internal */\r\n\tprivate static _vertices: Float32Array = new Float32Array([\r\n\t\t1, 1, 1, 1, \r\n\t\t1, -1, 1, 0,\r\n\t\t-1, 1, 0, 1,\r\n\t\t-1, -1, 0, 0]);//the rule of OpenGL\r\n\t/** @internal */\r\n\tprivate static _verticesInvertUV: Float32Array = new Float32Array([\r\n\t\t1, 1, 1, 0, \r\n\t\t1, -1, 1, 1,\r\n\t\t-1, 1, 0, 0, \r\n\t\t-1, -1, 0, 1]);\r\n\t/**@internal */\r\n\tstatic instance: ScreenQuad;\r\n\r\n\t/**\r\n\t * @internal\r\n\t */\r\n\tstatic __init__(): void {\r\n\t\tScreenQuad._vertexDeclaration = new VertexDeclaration(16, [new VertexElement(0, VertexElementFormat.Vector4, ScreenQuad.SCREENQUAD_POSITION_UV)]);\r\n\t\tScreenQuad.instance = new ScreenQuad();\r\n\t}\r\n\r\n\t/** @internal */\r\n\tprivate _vertexBuffer: VertexBuffer3D;\r\n\t/** @internal */\r\n\tprivate _bufferState: BufferState = new BufferState();\r\n\t/** @internal */\r\n\tprivate _vertexBufferInvertUV: VertexBuffer3D;\r\n\t/** @internal */\r\n\tprivate _bufferStateInvertUV: BufferState = new BufferState();\r\n\r\n\t/**\r\n\t *  <code>ScreenQuad</code> ,\r\n\t */\r\n\tconstructor() {\r\n\t\tsuper(MeshTopology.TriangleStrip, DrawType.DrawArray);\r\n\t\tthis.setDrawArrayParams(0, 4);\r\n\t\t//buffer\r\n\t\tthis._vertexBuffer = Laya3DRender.renderOBJCreate.createVertexBuffer3D(16 * 4, BufferUsage.Static, false);\r\n\t\tthis._vertexBuffer.vertexDeclaration = ScreenQuad._vertexDeclaration;\r\n\t\tthis._vertexBuffer.setData(ScreenQuad._vertices.buffer);\r\n\t\tthis._bufferState.applyState([this._vertexBuffer], null);\r\n\r\n\t\tthis._vertexBufferInvertUV = Laya3DRender.renderOBJCreate.createVertexBuffer3D(16 * 4, BufferUsage.Static, false);\r\n\t\tthis._vertexBufferInvertUV.vertexDeclaration = ScreenQuad._vertexDeclaration;\r\n\t\tthis._vertexBufferInvertUV.setData(ScreenQuad._verticesInvertUV.buffer);\r\n\t\tthis._bufferStateInvertUV.applyState([this._vertexBufferInvertUV], null);\r\n\t}\r\n\r\n\t/**\r\n\t * set BufferState\r\n\t */\r\n\tset invertY(value: boolean) {\r\n\t\tthis.bufferState = value ? this._bufferStateInvertUV : this._bufferState;\r\n\t}\r\n\r\n\t/**\r\n\t * @internal\r\n\t * UpdateGeometry Data\r\n\t */\r\n\t_updateRenderParams(state: RenderContext3D): void {\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t * @override\r\n\t */\r\n\tdestroy(): void {\r\n\t\tsuper.destroy();\r\n\t\tthis._bufferState.destroy();\r\n\t\tthis._vertexBuffer.destroy();\r\n\t\tthis._bufferStateInvertUV.destroy();\r\n\t\tthis._vertexBufferInvertUV.destroy();\r\n\r\n\t}\r\n\r\n}\r\n\r\n\r\n","import { Shader3D } from \"../../../../RenderEngine/RenderShader/Shader3D\";\r\nimport { ShaderData } from \"../../../../RenderEngine/RenderShader/ShaderData\";\r\nimport { LayaGL } from \"../../../../layagl/LayaGL\";\r\nimport { RenderContext3D } from \"../RenderContext3D\";\r\nimport { CommandBuffer } from \"./CommandBuffer\";\r\n\r\n/**\r\n * <code>Command</code> \r\n */\r\nexport class Command {\r\n\t/**@internal */\r\n\tstatic _screenShaderData: ShaderData;\r\n\t/** @internal */\r\n\tstatic _screenShader: Shader3D;\r\n\r\n\t/** @internal */\r\n\tstatic SCREENTEXTURE_NAME: string = \"u_MainTex\";\r\n\t/** @internal */\r\n\tstatic SCREENTEXTUREOFFSETSCALE_NAME: string = \"u_OffsetScale\";\r\n\t/** @internal */\r\n\tstatic MAINTEXTURE_TEXELSIZE_NAME: string = \"u_MainTex_TexelSize\";//todo\r\n\t/** @internal */\r\n\tstatic SCREENTEXTURE_ID: number ;//todo\r\n\t/** @internal */\r\n\tstatic SCREENTEXTUREOFFSETSCALE_ID: number;//todo\r\n\t/** @internal */\r\n\tstatic MAINTEXTURE_TEXELSIZE_ID: number ;//todo\r\n\r\n\t/**@internal */\r\n\t_commandBuffer: CommandBuffer = null;\r\n\t/**@internal */\r\n\t_context: RenderContext3D;\r\n\t/**\r\n\t* @internal\r\n\t*/\r\n\tstatic __init__(): void {\r\n\t\tCommand._screenShaderData = LayaGL.renderOBJCreate.createShaderData(null);\r\n\t\tCommand._screenShader = Shader3D.find(\"BlitScreen\");\r\n\t\tCommand.SCREENTEXTURE_ID = Shader3D.propertyNameToID(Command.SCREENTEXTURE_NAME);//todo\r\n\t\tCommand.SCREENTEXTUREOFFSETSCALE_ID = Shader3D.propertyNameToID(Command.SCREENTEXTUREOFFSETSCALE_NAME);//todo\r\n\t\tCommand.MAINTEXTURE_TEXELSIZE_ID = Shader3D.propertyNameToID(Command.MAINTEXTURE_TEXELSIZE_NAME);//todo\r\n\t}\r\n\r\n\t/**\r\n\t *  <code>Command</code> \r\n\t */\r\n\tconstructor() {\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t */\r\n\trun(): void {\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t */\r\n\trecover(): void {\r\n\t\tthis._commandBuffer = null;\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t * @param context  \r\n\t */\r\n\tsetContext(context: RenderContext3D) {\r\n\t\tthis._context = context;\r\n\t}\r\n\r\n\t/**\r\n\t * @internal\r\n\t * @destroy\r\n\t */\r\n\tdestroy(){\r\n\t\tthis._commandBuffer = null;\r\n\t\tthis._context = null;\r\n\t}\r\n\r\n}\r\n\r\n\r\n","import { Shader3D } from \"../../../../RenderEngine/RenderShader/Shader3D\";\r\nimport { ShaderData } from \"../../../../RenderEngine/RenderShader/ShaderData\";\r\nimport { BaseTexture } from \"../../../../resource/BaseTexture\";\r\nimport { Stat } from \"../../../../utils/Stat\";\r\nimport { Viewport } from \"../../../math/Viewport\";\r\nimport { Transform3D } from \"../../Transform3D\";\r\nimport { RenderContext3D } from \"../RenderContext3D\";\r\nimport { RenderElement } from \"../RenderElement\";\r\nimport { ScreenQuad } from \"../ScreenQuad\";\r\nimport { Command } from \"./Command\";\r\nimport { CommandBuffer } from \"./CommandBuffer\";\r\nimport { Camera } from \"../../Camera\";\r\nimport { Vector4 } from \"../../../../maths/Vector4\";\r\nimport { RenderTexture } from \"../../../../resource/RenderTexture\";\r\nimport { Laya3DRender } from \"../../../RenderObjs/Laya3DRender\";\r\n\r\nexport class BlitScreenQuadCMD extends Command {\r\n\t/**@internal */\r\n\tstatic _SCREENTYPE_QUAD: number = 0;\r\n\t/**@internal */\r\n\tstatic _SCREENTYPE_TRIANGLE: number = 1;\r\n\t/**@internal */\r\n\tprivate static _pool: any[] = [];\r\n\t/** @internal */\r\n\tprivate static _defaultOffsetScale: Vector4 = new Vector4(0, 0, 1, 1);\r\n\t/**\r\n\t* \r\n\t* @param source  null  CameraRenderTexture\r\n\t* @param dest  nullcamera\r\n\t* @param offsetScale \r\n\t* @param shader shader\r\n\t* @param shaderData \r\n\t* @param subShader subshader\r\n\t* @param screenType \r\n\t*/\r\n\tstatic create(source: BaseTexture, dest: RenderTexture, offsetScale: Vector4 = null, shader: Shader3D = null, shaderData: ShaderData = null, subShader: number = 0, screenType: number = BlitScreenQuadCMD._SCREENTYPE_QUAD, commandbuffer: CommandBuffer = null): BlitScreenQuadCMD {\r\n\t\tvar cmd: BlitScreenQuadCMD;\r\n\t\tcmd = BlitScreenQuadCMD._pool.length > 0 ? BlitScreenQuadCMD._pool.pop() : new BlitScreenQuadCMD();\r\n\t\tcmd._source = source;\r\n\t\tcmd._dest = dest;\r\n\t\tcmd._offsetScale = offsetScale;\r\n\t\tcmd.setshader(shader, subShader, shaderData);\r\n\t\t// cmd._shader = shader;\r\n\t\t// cmd.shaderData = shaderData;\r\n\t\t// cmd._subShader = subShader;\r\n\t\tcmd._commandBuffer = commandbuffer;\r\n\t\treturn cmd;\r\n\t}\r\n\r\n\t/**@internal */\r\n\tprivate _source: BaseTexture = null;\r\n\t/**@internal */\r\n\tprivate _dest: RenderTexture = null;\r\n\t/**@internal */\r\n\tprivate _offsetScale: Vector4 = null;\r\n\t/**@internal */\r\n\tprivate _shader: Shader3D = null;\r\n\t/**@internal */\r\n\tprivate _shaderData: ShaderData = null;\r\n\t/**@internal */\r\n\tprivate _subShader: number = 0;\r\n\t/**@internal */\r\n\tprivate _sourceTexelSize: Vector4 = new Vector4();\r\n\t/**@internal */\r\n\tprivate _renderElement: RenderElement;\r\n\t/**@internal */\r\n\tprivate _transform3D: Transform3D;\r\n\r\n\r\n\r\n\tconstructor() {\r\n\t\tsuper();\r\n\t\tthis._transform3D = Laya3DRender.renderOBJCreate.createTransform(null);\r\n\t\tthis._renderElement = new RenderElement();\r\n\t\tthis._renderElement.setTransform(this._transform3D);\r\n\t\tthis._renderElement.setGeometry(ScreenQuad.instance);\r\n\t}\r\n\r\n\tset shaderData(value: ShaderData) {\r\n\t\tthis._shaderData = value || Command._screenShaderData;\r\n\t\tthis._renderElement._renderElementOBJ._materialShaderData = this._shaderData;\r\n\t}\r\n\r\n\tsetshader(shader: Shader3D, subShader: number, shaderData: ShaderData) {\r\n\t\tthis._shader = shader || Command._screenShader;\r\n\t\tthis._subShader = subShader || 0;\r\n\t\tthis.shaderData = shaderData;\r\n\t\tthis._renderElement.renderSubShader = this._shader.getSubShaderAt(this._subShader);\r\n\t\tthis._renderElement._subShaderIndex = subShader;\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t * @override\r\n\t */\r\n\trun(): void {//TODO:UV\r\n\t\tthis._commandBuffer && (this.setContext(this._commandBuffer._context));\r\n\t\tvar context = this._context;\r\n\t\tvar source;\r\n\t\tif (!this._source) {\r\n\t\t\tif (!this._commandBuffer._camera._internalRenderTexture)//source null, Bind define FrameBuffer\r\n\t\t\t\tthrow \"camera internalRenderTexture is null,please set camera enableBuiltInRenderTexture\";\r\n\t\t\tsource = this._commandBuffer._camera._internalRenderTexture;\r\n\t\t} else\r\n\t\t\tsource = this._source;\r\n\t\tvar shaderData: ShaderData = this._shaderData;\r\n\t\tvar dest: RenderTexture = this._dest ? this._dest : this._commandBuffer._camera._internalRenderTexture;//set dest\r\n\t\tif (dest) {//set viewport\r\n\t\t\tcontext.changeViewport(0, 0, dest.width, dest.height);\r\n\t\t\tcontext.changeScissor(0, 0, dest.width, dest.height);\r\n\t\t} else {\r\n\t\t\tlet camera = this._commandBuffer._camera;\r\n\t\t\tlet viewport: Viewport = camera.viewport;\r\n\t\t\tlet vpH = viewport.height;\r\n\t\t\tlet vpY = RenderContext3D.clientHeight - viewport.y - vpH;\r\n\t\t\tcontext.changeViewport(viewport.x, vpY, viewport.width, vpH);\r\n\t\t\tcontext.changeScissor(viewport.x, vpY, viewport.width, vpH);\r\n\t\t}\r\n\t\tshaderData.setTexture(Command.SCREENTEXTURE_ID, source);\r\n\t\tshaderData.setVector(Command.SCREENTEXTUREOFFSETSCALE_ID, this._offsetScale || BlitScreenQuadCMD._defaultOffsetScale);\r\n\t\tthis._sourceTexelSize.setValue(1.0 / source.width, 1.0 / source.height, source.width, source.height);\r\n\t\tshaderData.setVector(Command.MAINTEXTURE_TEXELSIZE_ID, this._sourceTexelSize);\r\n\t\tcontext.destTarget = dest;\r\n\t\tcontext._contextOBJ.applyContext(Camera._updateMark);\r\n\t\t// ScreenQuad.instance.invertY = dest ? dest._isCameraTarget : false;\r\n\t\tScreenQuad.instance.invertY = context.invertY;\r\n\t\tcontext.drawRenderElement(this._renderElement);\r\n\t\tStat.blitDrawCall++;\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t * @override\r\n\t */\r\n\trecover(): void {\r\n\t\tBlitScreenQuadCMD._pool.push(this);\r\n\t\tthis._source = null;\r\n\t\tthis._dest = null;\r\n\t\tthis._offsetScale = null;\r\n\t\tthis._shader = null;\r\n\t\tthis._shaderData = null;\r\n\t\tsuper.recover();\r\n\t}\r\n\r\n\tdestroy(): void {\r\n\t\tthis._source = null;\r\n\t\tthis._dest = null;\r\n\t\tthis._offsetScale = null;\r\n\t\tthis._shader = null;\r\n\t\tthis._shaderData = null;\r\n\t\tthis._renderElement.destroy();\r\n\t}\r\n}","import { Command } from \"./Command\";\r\nimport { RenderContext3D } from \"../RenderContext3D\";\r\nimport { Camera } from \"../../Camera\";\r\nimport { RenderTexture } from \"../../../../resource/RenderTexture\";\r\n\r\n/**\r\n * @internal\r\n * <code>SetRenderTargetCMD</code> \r\n */\r\nexport class SetRenderTargetCMD extends Command {\r\n\t/**@internal */\r\n\tprivate static _pool: any[] = [];\r\n\r\n\t/**@internal */\r\n\tprivate _renderTexture: RenderTexture = null;\r\n\r\n\t/**\r\n\t * @internal\r\n\t */\r\n\tstatic create(renderTexture: RenderTexture): SetRenderTargetCMD {\r\n\t\tvar cmd: SetRenderTargetCMD;\r\n\t\tcmd = SetRenderTargetCMD._pool.length > 0 ? SetRenderTargetCMD._pool.pop() : new SetRenderTargetCMD();\r\n\t\tcmd._renderTexture = renderTexture;\r\n\t\treturn cmd;\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t * @override\r\n\t */\r\n\trun(): void {\r\n\t\t//buffer  \r\n\t\t(RenderTexture.currentActive) && (RenderTexture.currentActive._end());\r\n\t\tRenderContext3D._instance.destTarget = this._renderTexture;\r\n\t\tRenderContext3D._instance.changeScissor(0, 0, this._renderTexture.width, this._renderTexture.height);\r\n\t\tRenderContext3D._instance.changeViewport(0, 0, this._renderTexture.width, this._renderTexture.height);\r\n\t\tRenderContext3D._instance._contextOBJ.applyContext(Camera._updateMark);\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t * @override\r\n\t */\r\n\trecover(): void {\r\n\t\tSetRenderTargetCMD._pool.push(this);\r\n\t\tthis._renderTexture = null;\r\n\t}\r\n}\r\n\r\n\r\n","import { Command } from \"./Command\";\r\nimport { BaseTexture } from \"../../../../resource/BaseTexture\";\r\nimport { CommandBuffer } from \"./CommandBuffer\";\r\nimport { ShaderData, ShaderDataItem, ShaderDataType } from \"../../../../RenderEngine/RenderShader/ShaderData\";\r\nimport { ShaderDefine } from \"../../../../RenderEngine/RenderShader/ShaderDefine\";\r\nimport { Shader3D } from \"../../../../RenderEngine/RenderShader/Shader3D\";\r\nimport { Color } from \"../../../../maths/Color\";\r\nimport { Matrix4x4 } from \"../../../../maths/Matrix4x4\";\r\nimport { Vector2 } from \"../../../../maths/Vector2\";\r\nimport { Vector3 } from \"../../../../maths/Vector3\";\r\nimport { Vector4 } from \"../../../../maths/Vector4\";\r\n\r\n/**\r\n * @internal\r\n * <code>SetShaderDataTextureCMD</code> \r\n */\r\nexport class SetShaderDataCMD extends Command {\r\n\tstatic ShaderDataType_define: number = -2;\r\n\t/**@internal */\r\n\tprivate static _pool: any[] = [];\r\n\r\n\t/**@internal */\r\n\tprivate _shaderData: ShaderData = null;\r\n\t/**@internal */\r\n\tprivate _nameID: number | string = 0;\r\n\t/**@internal */\r\n\tprivate _value: ShaderDataItem = null;\r\n\t/**@internal */\r\n\tprivate _dataType: number = -1;\r\n\r\n\t/**\r\n\t * @internal\r\n\t */\r\n\tstatic create(shaderData: ShaderData, nameID: number | string, value: ShaderDataItem, shaderDataType: ShaderDataType | number, commandBuffer: CommandBuffer): SetShaderDataCMD {\r\n\t\tvar cmd: SetShaderDataCMD;\r\n\t\tcmd = SetShaderDataCMD._pool.length > 0 ? SetShaderDataCMD._pool.pop() : new SetShaderDataCMD();\r\n\t\tcmd._shaderData = shaderData;\r\n\t\tcmd._nameID = nameID;\r\n\t\tcmd._value = (value as any).clone ? (value as any).clone() : value;\r\n\t\tcmd._dataType = shaderDataType;\r\n\t\tcmd._commandBuffer = commandBuffer;\r\n\t\treturn cmd;\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t * @override\r\n\t */\r\n\trun(): void {\r\n\t\tswitch (this._dataType) {\r\n\t\t\tcase ShaderDataType.Int:\r\n\t\t\t\tthis._shaderData.setInt(this._nameID as number, this._value as number);\r\n\t\t\t\tbreak;\r\n\t\t\tcase ShaderDataType.Float:\r\n\t\t\t\tthis._shaderData.setNumber(this._nameID as number, this._value as number);\r\n\t\t\t\tbreak;\r\n\t\t\tcase ShaderDataType.Bool:\r\n\t\t\t\tthis._shaderData.setBool(this._nameID as number, this._value as boolean);\r\n\t\t\t\tbreak;\r\n\t\t\tcase ShaderDataType.Matrix4x4:\r\n\t\t\t\tthis._shaderData.setMatrix4x4(this._nameID as number, this._value as Matrix4x4);\r\n\t\t\t\tbreak;\r\n\t\t\tcase ShaderDataType.Color:\r\n\t\t\t\tthis._shaderData.setColor(this._nameID as number, this._value as Color);\r\n\t\t\t\tbreak;\r\n\t\t\tcase ShaderDataType.Texture2D:\r\n\t\t\tcase ShaderDataType.TextureCube:\r\n\t\t\tcase ShaderDataType.Texture2DArray:\r\n\t\t\tcase ShaderDataType.Texture3D:\r\n\t\t\t\tthis._shaderData.setTexture(this._nameID as number, this._value as BaseTexture);\r\n\t\t\t\tbreak;\r\n\t\t\tcase ShaderDataType.Vector4:\r\n\t\t\t\tthis._shaderData.setVector(this._nameID as number, this._value as Vector4);\r\n\t\t\t\tbreak;\r\n\t\t\tcase ShaderDataType.Vector2:\r\n\t\t\t\tthis._shaderData.setVector2(this._nameID as number, this._value as Vector2);\r\n\t\t\t\tbreak;\r\n\t\t\tcase ShaderDataType.Vector3:\r\n\t\t\t\tthis._shaderData.setVector3(this._nameID as number, this._value as Vector3);\r\n\t\t\t\tbreak;\r\n\t\t\tcase ShaderDataType.Buffer:\r\n\t\t\t\tthis._shaderData.setBuffer(this._nameID as number, this._value as Float32Array);\r\n\t\t\t\tbreak;\r\n\t\t\t// case ShaderDataType.ShaderDefine:\r\n\t\t\t// \tlet defineData :ShaderDefine = Shader3D.getDefineByName(this._nameID as string);\r\n\t\t\t// \tif(this._value)\r\n\t\t\t// \tthis._shaderData.addDefine(defineData);\r\n\t\t\t// \telse\r\n\t\t\t// \tthis._shaderData.removeDefine(defineData);\r\n\t\t\t// \tbreak;\r\n\r\n\t\t\tdefault:\r\n\t\t\t\tif (this._dataType == SetShaderDataCMD.ShaderDataType_define) {\r\n\t\t\t\t\tlet defineData: ShaderDefine = Shader3D.getDefineByName(this._nameID as string);\r\n\t\t\t\t\tif (this._value)\r\n\t\t\t\t\t\tthis._shaderData.addDefine(defineData);\r\n\t\t\t\t\telse\r\n\t\t\t\t\t\tthis._shaderData.removeDefine(defineData);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t} else\r\n\t\t\t\t\tthrow \"no type shaderValue on this CommendBuffer\";\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t * @override\r\n\t */\r\n\trecover(): void {\r\n\t\tSetShaderDataCMD._pool.push(this);\r\n\t\tthis._shaderData = null;\r\n\t\tthis._nameID = 0;\r\n\t\tthis._value = null;\r\n\t\tthis._dataType = -1;\r\n\t}\r\n\r\n}\r\n\r\n\r\n","import { Color } from \"../../../maths/Color\";\r\nimport { Vector4 } from \"../../../maths/Vector4\";\r\nimport { RenderState } from \"../../../RenderEngine/RenderShader/RenderState\";\r\nimport { Shader3D } from \"../../../RenderEngine/RenderShader/Shader3D\";\r\nimport { ShaderDefine } from \"../../../RenderEngine/RenderShader/ShaderDefine\";\r\nimport { BaseTexture } from \"../../../resource/BaseTexture\";\r\nimport { Material } from \"../../../resource/Material\";\r\n\r\n\r\n/**\r\n * <code>BlinnPhongMaterial</code> Blinn-Phong\r\n */\r\nexport class BlinnPhongMaterial extends Material {\r\n\t/**_Alpha*/\r\n\tstatic SPECULARSOURCE_DIFFUSEMAPALPHA: number;\r\n\t/**_RGB*/\r\n\tstatic SPECULARSOURCE_SPECULARMAP: number;\r\n\r\n\t/**_*/\r\n\tstatic RENDERMODE_OPAQUE: number = 0;\r\n\t/**_*/\r\n\tstatic RENDERMODE_CUTOUT: number = 1;\r\n\t/**_*/\r\n\tstatic RENDERMODE_TRANSPARENT: number = 2;\r\n\r\n\t/**@internal */\r\n\tstatic SHADERDEFINE_DIFFUSEMAP: ShaderDefine;\r\n\t/**@internal */\r\n\tstatic SHADERDEFINE_NORMALMAP: ShaderDefine;\r\n\t/**@internal */\r\n\tstatic SHADERDEFINE_SPECULARMAP: ShaderDefine;\r\n\t/**@internal */\r\n\tstatic SHADERDEFINE_ENABLEVERTEXCOLOR: ShaderDefine;\r\n\t/**@internal */\r\n\tstatic SHADERDEFINE_ENABLETRANSMISSION: ShaderDefine;\r\n\t/**@internal */\r\n\tstatic SHADERDEFINE_THICKNESSMAP: ShaderDefine;\r\n\t/**@internal */\r\n\tstatic ALBEDOTEXTURE: number;\r\n\t/**@internal */\r\n\tstatic NORMALTEXTURE: number;\r\n\t/**@internal */\r\n\tstatic SPECULARTEXTURE: number;\r\n\t/**@internal */\r\n\tstatic ALBEDOCOLOR: number;\r\n\t/**@internal */\r\n\tstatic MATERIALSPECULAR: number;\r\n\t/**@internal */\r\n\tstatic SHININESS: number;\r\n\t/**@internal */\r\n\tstatic TILINGOFFSET: number;\r\n\t/**@internal */\r\n\tstatic TRANSMISSIONRATE: number;\r\n\t/**@internal */\r\n\tstatic IBACKDIFFUSE: number;\r\n\t/**@internal */\r\n\tstatic IBACKSCALE: number;\r\n\t/**@internal */\r\n\tstatic THINKNESSTEXTURE: number;\r\n\t/**@internal */\r\n\tstatic TRANSMISSIONCOLOR: number;\r\n\t/**@internal */\r\n\tstatic AlbedoIntensity: number;\r\n\r\n\t/** */\r\n\tstatic defaultMaterial: BlinnPhongMaterial;\r\n\r\n\t/**\r\n\t * @internal\r\n\t */\r\n\tstatic __initDefine__(): void {\r\n\t\tBlinnPhongMaterial.SHADERDEFINE_DIFFUSEMAP = Shader3D.getDefineByName(\"DIFFUSEMAP\");\r\n\t\tBlinnPhongMaterial.SHADERDEFINE_NORMALMAP = Shader3D.getDefineByName(\"NORMALMAP\");\r\n\t\tBlinnPhongMaterial.SHADERDEFINE_SPECULARMAP = Shader3D.getDefineByName(\"SPECULARMAP\");\r\n\t\tBlinnPhongMaterial.SHADERDEFINE_ENABLEVERTEXCOLOR = Shader3D.getDefineByName(\"ENABLEVERTEXCOLOR\");\r\n\t\tBlinnPhongMaterial.SHADERDEFINE_ENABLETRANSMISSION = Shader3D.getDefineByName(\"ENABLETRANSMISSION\");\r\n\t\tBlinnPhongMaterial.SHADERDEFINE_THICKNESSMAP = Shader3D.getDefineByName(\"THICKNESSMAP\");\r\n\r\n\t\tBlinnPhongMaterial.ALBEDOTEXTURE = Shader3D.propertyNameToID(\"u_DiffuseTexture\");\r\n\t\tBlinnPhongMaterial.NORMALTEXTURE = Shader3D.propertyNameToID(\"u_NormalTexture\");\r\n\t\tBlinnPhongMaterial.SPECULARTEXTURE = Shader3D.propertyNameToID(\"u_SpecularTexture\");\r\n\t\tBlinnPhongMaterial.ALBEDOCOLOR = Shader3D.propertyNameToID(\"u_DiffuseColor\");\r\n\t\tBlinnPhongMaterial.MATERIALSPECULAR = Shader3D.propertyNameToID(\"u_MaterialSpecular\");\r\n\t\tBlinnPhongMaterial.SHININESS = Shader3D.propertyNameToID(\"u_Shininess\");\r\n\t\tBlinnPhongMaterial.TILINGOFFSET = Shader3D.propertyNameToID(\"u_TilingOffset\");\r\n\t\tBlinnPhongMaterial.TRANSMISSIONRATE = Shader3D.propertyNameToID(\"u_TransmissionRate\");\r\n\t\tBlinnPhongMaterial.IBACKDIFFUSE = Shader3D.propertyNameToID(\"u_BackDiffuse\");\r\n\t\tBlinnPhongMaterial.IBACKSCALE = Shader3D.propertyNameToID(\"u_BackScale\");\r\n\t\tBlinnPhongMaterial.THINKNESSTEXTURE = Shader3D.propertyNameToID(\"u_ThinknessTexture\");\r\n\t\tBlinnPhongMaterial.TRANSMISSIONCOLOR = Shader3D.propertyNameToID(\"u_TransmissionColor\");\r\n\t\tBlinnPhongMaterial.AlbedoIntensity = Shader3D.propertyNameToID(\"u_AlbedoIntensity\");\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t * @param \r\n\t */\r\n\tset renderMode(value: number) {\r\n\t\tswitch (value) {\r\n\t\t\tcase BlinnPhongMaterial.RENDERMODE_OPAQUE:\r\n\t\t\t\tthis.alphaTest = false;\r\n\t\t\t\tthis.renderQueue = Material.RENDERQUEUE_OPAQUE;\r\n\t\t\t\tthis.depthWrite = true;\r\n\t\t\t\tthis.cull = RenderState.CULL_BACK;\r\n\t\t\t\tthis.blend = RenderState.BLEND_DISABLE;\r\n\t\t\t\tthis.depthTest = RenderState.DEPTHTEST_LESS;\r\n\t\t\t\tbreak;\r\n\t\t\tcase BlinnPhongMaterial.RENDERMODE_CUTOUT:\r\n\t\t\t\tthis.renderQueue = Material.RENDERQUEUE_ALPHATEST;\r\n\t\t\t\tthis.alphaTest = true;\r\n\t\t\t\tthis.depthWrite = true;\r\n\t\t\t\tthis.cull = RenderState.CULL_BACK;\r\n\t\t\t\tthis.blend = RenderState.BLEND_DISABLE;\r\n\t\t\t\tthis.depthTest = RenderState.DEPTHTEST_LESS;\r\n\t\t\t\tbreak;\r\n\t\t\tcase BlinnPhongMaterial.RENDERMODE_TRANSPARENT:\r\n\t\t\t\tthis.renderQueue = Material.RENDERQUEUE_TRANSPARENT;\r\n\t\t\t\tthis.alphaTest = false;\r\n\t\t\t\tthis.depthWrite = false;\r\n\t\t\t\tthis.cull = RenderState.CULL_BACK;\r\n\t\t\t\tthis.blend = RenderState.BLEND_ENABLE_ALL;\r\n\t\t\t\tthis.blendSrc = RenderState.BLENDPARAM_SRC_ALPHA;\r\n\t\t\t\tthis.blendDst = RenderState.BLENDPARAM_ONE_MINUS_SRC_ALPHA;\r\n\t\t\t\tthis.depthTest = RenderState.DEPTHTEST_LESS;\r\n\t\t\t\tbreak;\r\n\t\t\tdefault:\r\n\t\t\t\tthrow new Error(\"Material:renderMode value error.\");\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t */\r\n\tget enableVertexColor(): boolean {\r\n\t\treturn this.hasDefine(BlinnPhongMaterial.SHADERDEFINE_ENABLEVERTEXCOLOR);\r\n\t}\r\n\r\n\tset enableVertexColor(value: boolean) {\r\n\t\tif (value)\r\n\t\t\tthis.addDefine(BlinnPhongMaterial.SHADERDEFINE_ENABLEVERTEXCOLOR);\r\n\t\telse\r\n\t\t\tthis.removeDefine(BlinnPhongMaterial.SHADERDEFINE_ENABLEVERTEXCOLOR);\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t */\r\n\tget tilingOffset(): Vector4 {\r\n\t\treturn (<Vector4>this.getVector4ByIndex(BlinnPhongMaterial.TILINGOFFSET));\r\n\t}\r\n\r\n\tset tilingOffset(value: Vector4) {\r\n\t\tif (value) {\r\n\t\t\tthis.setVector4ByIndex(BlinnPhongMaterial.TILINGOFFSET, value);\r\n\t\t}\r\n\t\telse {\r\n\t\t\tthis.getVector4ByIndex(BlinnPhongMaterial.TILINGOFFSET).setValue(1.0, 1.0, 0.0, 0.0);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t */\r\n\tget albedoColor(): Color {\r\n\t\treturn this.getColorByIndex(BlinnPhongMaterial.ALBEDOCOLOR);\r\n\t}\r\n\r\n\tset albedoColor(value: Color) {\r\n\t\tthis.setColorByIndex(BlinnPhongMaterial.ALBEDOCOLOR, value);//,NATIVE\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t */\r\n\tget albedoIntensity(): number {\r\n\t\treturn this.getFloatByIndex(BlinnPhongMaterial.AlbedoIntensity);\r\n\t}\r\n\r\n\tset albedoIntensity(value: number) {\r\n\t\tthis.setFloatByIndex(BlinnPhongMaterial.AlbedoIntensity, value);\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t */\r\n\tget specularColor(): Color {\r\n\t\treturn this.getColorByIndex(BlinnPhongMaterial.MATERIALSPECULAR);\r\n\t}\r\n\r\n\tset specularColor(value: Color) {\r\n\t\tthis.setColorByIndex(BlinnPhongMaterial.MATERIALSPECULAR, value);\r\n\t}\r\n\r\n\t/**\r\n\t * ,01\r\n\t */\r\n\tget shininess(): number {\r\n\t\treturn this.getFloatByIndex(BlinnPhongMaterial.SHININESS);\r\n\t}\r\n\r\n\tset shininess(value: number) {\r\n\t\tvalue = Math.max(0.0, Math.min(1.0, value));\r\n\t\tthis.setFloatByIndex(BlinnPhongMaterial.SHININESS, value);\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t */\r\n\tget albedoTexture(): BaseTexture {\r\n\t\treturn this.getTextureByIndex(BlinnPhongMaterial.ALBEDOTEXTURE);\r\n\t}\r\n\r\n\tset albedoTexture(value: BaseTexture) {\r\n\t\tif (value)\r\n\t\t\tthis.addDefine(BlinnPhongMaterial.SHADERDEFINE_DIFFUSEMAP);\r\n\t\telse\r\n\t\t\tthis.removeDefine(BlinnPhongMaterial.SHADERDEFINE_DIFFUSEMAP);\r\n\t\tthis.setTextureByIndex(BlinnPhongMaterial.ALBEDOTEXTURE, value);\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t */\r\n\tget normalTexture(): BaseTexture {\r\n\t\treturn this.getTextureByIndex(BlinnPhongMaterial.NORMALTEXTURE);\r\n\t}\r\n\r\n\tset normalTexture(value: BaseTexture) {\r\n\t\tif (value) {\r\n\t\t\tthis.addDefine(BlinnPhongMaterial.SHADERDEFINE_NORMALMAP);\r\n\t\t}\r\n\t\telse {\r\n\t\t\tthis.removeDefine(BlinnPhongMaterial.SHADERDEFINE_NORMALMAP);\r\n\t\t}\r\n\t\tthis.setTextureByIndex(BlinnPhongMaterial.NORMALTEXTURE, value);\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t */\r\n\tget specularTexture(): BaseTexture {\r\n\t\treturn this.getTextureByIndex(BlinnPhongMaterial.SPECULARTEXTURE);\r\n\t}\r\n\r\n\tset specularTexture(value: BaseTexture) {\r\n\t\tif (value)\r\n\t\t\tthis.addDefine(BlinnPhongMaterial.SHADERDEFINE_SPECULARMAP);\r\n\t\telse\r\n\t\t\tthis.removeDefine(BlinnPhongMaterial.SHADERDEFINE_SPECULARMAP);\r\n\r\n\t\tthis.setTextureByIndex(BlinnPhongMaterial.SPECULARTEXTURE, value);\r\n\t}\r\n\t/**\r\n\t * \r\n\t */\r\n\tget enableTransmission(): boolean {\r\n\t\treturn this.hasDefine(BlinnPhongMaterial.SHADERDEFINE_ENABLETRANSMISSION);\r\n\t}\r\n\r\n\tset enableTransmission(value: boolean) {\r\n\t\tif (value)\r\n\t\t\tthis.addDefine(BlinnPhongMaterial.SHADERDEFINE_ENABLETRANSMISSION);\r\n\t\telse\r\n\t\t\tthis.removeDefine(BlinnPhongMaterial.SHADERDEFINE_ENABLETRANSMISSION);\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t */\r\n\tget transmissionRata(): number {\r\n\t\treturn this.getFloatByIndex(BlinnPhongMaterial.TRANSMISSIONRATE);\r\n\t}\r\n\r\n\tset transmissionRata(value: number) {\r\n\t\tthis.setFloatByIndex(BlinnPhongMaterial.TRANSMISSIONRATE, value);\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t */\r\n\tget backDiffuse(): number {\r\n\t\treturn this.getFloatByIndex(BlinnPhongMaterial.IBACKDIFFUSE);\r\n\t}\r\n\tset backDiffuse(value: number) {\r\n\t\tthis.setFloatByIndex(BlinnPhongMaterial.IBACKDIFFUSE, Math.max(value, 1.0));\r\n\t}\r\n\t/**\r\n\t * \r\n\t */\r\n\tget backScale(): number {\r\n\t\treturn this.getFloatByIndex(BlinnPhongMaterial.IBACKSCALE);\r\n\t}\r\n\tset backScale(value: number) {\r\n\t\tthis.setFloatByIndex(BlinnPhongMaterial.IBACKSCALE, value);\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t */\r\n\tget thinknessTexture(): BaseTexture {\r\n\t\treturn this.getTextureByIndex(BlinnPhongMaterial.THINKNESSTEXTURE);\r\n\t}\r\n\tset thinknessTexture(value: BaseTexture) {\r\n\t\tif (value)\r\n\t\t\tthis.addDefine(BlinnPhongMaterial.SHADERDEFINE_THICKNESSMAP);\r\n\t\telse\r\n\t\t\tthis.removeDefine(BlinnPhongMaterial.SHADERDEFINE_THICKNESSMAP);\r\n\r\n\t\tthis.setTextureByIndex(BlinnPhongMaterial.THINKNESSTEXTURE, value);\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t */\r\n\tget transmissionColor(): Color {\r\n\t\treturn this.getColorByIndex(BlinnPhongMaterial.TRANSMISSIONCOLOR);\r\n\t}\r\n\tset transmissionColor(value: Color) {\r\n\t\tthis.setColorByIndex(BlinnPhongMaterial.TRANSMISSIONCOLOR, value);\r\n\t}\r\n\r\n\t/**\r\n\t * transmissionRata\r\n\t * @deprecated\r\n\t */\r\n\tget transmissionRate(): number {\r\n\t\treturn this.getFloatByIndex(BlinnPhongMaterial.TRANSMISSIONRATE);\r\n\t}\r\n\r\n\t/**\r\n\t *  <code>BlinnPhongMaterial</code> \r\n\t */\r\n\tconstructor() {\r\n\t\tsuper();\r\n\t\tthis.setShaderName(\"BLINNPHONG\");\r\n\t\tthis.renderMode = BlinnPhongMaterial.RENDERMODE_OPAQUE;\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t * @return\t \r\n\t * @override\r\n\t */\r\n\tclone(): any {\r\n\t\tvar dest: BlinnPhongMaterial = new BlinnPhongMaterial();\r\n\t\tthis.cloneTo(dest);\r\n\t\treturn dest;\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t * @override\r\n\t */\r\n\tcloneTo(destObject: any): void {\r\n\t\tsuper.cloneTo(destObject);\r\n\t\tvar destMaterial: BlinnPhongMaterial = (<BlinnPhongMaterial>destObject);\r\n\t\tdestMaterial.albedoIntensity = this.albedoIntensity;\r\n\t\tdestMaterial.enableVertexColor = this.enableVertexColor;\r\n\t\tthis.albedoColor.cloneTo(destMaterial.albedoColor);\r\n\t}\r\n\r\n\r\n}\r\n\r\n\r\n","\r\nimport { Component } from \"../../components/Component\";\r\nimport { ShaderDefine } from \"../../RenderEngine/RenderShader/ShaderDefine\";\r\nimport { Mesh } from \"../resource/models/Mesh\";\r\nimport { MeshRenderer } from \"./MeshRenderer\";\r\n\r\n/**\r\n * <code>MeshFilter</code> \r\n */\r\nexport class MeshFilter extends Component {\r\n    /** @internal */\r\n    static _meshVerticeDefine: Array<ShaderDefine> = [];\r\n\r\n    /** @internal */\r\n    private _sharedMesh: Mesh;\r\n\r\n    constructor() {\r\n        super();\r\n\r\n        this.runInEditor = true;\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    protected _onEnable(): void {\r\n        const render = this.owner.getComponent(MeshRenderer) as MeshRenderer;\r\n        render && render._enabled && render._onMeshChange(this._sharedMesh);\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    protected _onDisable(): void {\r\n        const render = this.owner.getComponent(MeshRenderer) as MeshRenderer;\r\n       // render && render._enabled && render._onMeshChange(null);\r\n    }\r\n\r\n    /**\r\n     * \r\n     */\r\n    get sharedMesh(): Mesh {\r\n        return this._sharedMesh;\r\n    }\r\n\r\n    set sharedMesh(value: Mesh) {\r\n        if (this._sharedMesh !== value) {\r\n            //meshReference\r\n            var lastValue: Mesh = this._sharedMesh;\r\n            if (lastValue) {\r\n                lastValue._removeReference();\r\n            }\r\n            if (value) {\r\n                value._addReference();\r\n            }\r\n            this._sharedMesh = value;\r\n\r\n            const render = this.owner.getComponent(MeshRenderer);\r\n            if (!render) {\r\n                return;\r\n            }\r\n            render._onMeshChange(value);\r\n            this._sharedMesh = value;\r\n        }\r\n    }\r\n\r\n    protected _onDestroy() {\r\n        (this._sharedMesh) && (this._sharedMesh._removeReference(), this._sharedMesh = null);\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     * @param dest \r\n     */\r\n    _cloneTo(dest: Component): void {\r\n        let meshfilter = dest as MeshFilter;\r\n        meshfilter.sharedMesh = this.sharedMesh;\r\n        super._cloneTo(dest);\r\n    }\r\n\r\n}\r\n\r\n\r\n","import { RenderElement } from \"./RenderElement\";\r\nimport { Event } from \"../../../events/Event\";\r\nimport { SubMesh } from \"../../resource/models/SubMesh\";\r\nimport { GeometryElement } from \"../GeometryElement\";\r\nimport { Transform3D } from \"../Transform3D\";\r\nimport { SingletonList } from \"../../../utils/SingletonList\";\r\nimport { VertexDeclaration } from \"../../../RenderEngine/VertexDeclaration\";\r\n\r\n\r\n/**\r\n * @internal\r\n */\r\nexport class SubMeshRenderElement extends RenderElement {\r\n\r\n\t/** @internal */\r\n\tprivate _dynamicWorldPositionNormalNeedUpdate: boolean;\r\n\r\n\t/** @internal */\r\n\tstaticBatchIndexStart: number;\r\n\t/** @internal */\r\n\tstaticBatchIndexEnd: number;\r\n\t/** @internal */\r\n\tstaticBatchElementList: SingletonList<SubMeshRenderElement>;\r\n\r\n\t/** @internal */\r\n\tinstanceSubMesh: SubMesh;\r\n\t/** @internal */\r\n\tinstanceBatchElementList: SingletonList<SubMeshRenderElement>;\r\n\r\n\t/** @internal */\r\n\tvertexBatchElementList: SingletonList<SubMeshRenderElement>;\r\n\t/** @internal */\r\n\tvertexBatchVertexDeclaration: VertexDeclaration;\r\n\r\n\r\n\t/**\r\n\t *  <code>SubMeshRenderElement</code> \r\n\t */\r\n\tconstructor() {\r\n\t\tsuper();\r\n\t\tthis._dynamicWorldPositionNormalNeedUpdate = true;\r\n\t\tthis._canBatch = true;\r\n\t}\r\n\r\n\t/**\r\n\t * @internal\r\n\t */\r\n\tprivate _onWorldMatrixChanged(): void {\r\n\t\tthis._dynamicWorldPositionNormalNeedUpdate = true;\r\n\t}\r\n\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t * @override\r\n\t */\r\n\tsetTransform(transform: Transform3D): void {\r\n\t\tif (this.transform !== transform) {\r\n\t\t\t(this.transform) && (this.transform.off(Event.TRANSFORM_CHANGED, this, this._onWorldMatrixChanged));\r\n\t\t\t(transform) && (transform.on(Event.TRANSFORM_CHANGED, this, this._onWorldMatrixChanged));\r\n\t\t\tthis._dynamicWorldPositionNormalNeedUpdate = true;\r\n\t\t\tthis.transform = transform;\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t * @override\r\n\t */\r\n\tsetGeometry(geometry: GeometryElement): void {\r\n\t\tif (this._geometry !== geometry) {\r\n\t\t\tthis._geometry = geometry;\r\n\t\t\tthis._renderElementOBJ._geometry = geometry._geometryElementOBj;\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t * @override\r\n\t */\r\n\tdestroy(): void {\r\n\t\tif(!this._renderElementOBJ)return;\r\n\t\t(this.transform) && this.transform.off(Event.TRANSFORM_CHANGED, this, this._onWorldMatrixChanged);\r\n\t\tsuper.destroy();\r\n\t\tthis.staticBatch = null;\r\n\t\tthis.instanceSubMesh = null;\r\n\t\tthis.staticBatchElementList && this.staticBatchElementList.destroy();\r\n\t\tthis.instanceBatchElementList && this.instanceBatchElementList.destroy();\r\n\t\tthis.vertexBatchElementList && this.vertexBatchElementList.destroy();\r\n\t\tthis.vertexBatchVertexDeclaration = null;\r\n\t}\r\n}\r\n\r\n\r\n","import { ShaderDefine } from \"../../../RenderEngine/RenderShader/ShaderDefine\";\r\nimport { VertexMesh } from \"../../../RenderEngine/RenderShader/VertexMesh\";\r\nimport { MeshSprite3DShaderDeclaration } from \"../../core/MeshSprite3DShaderDeclaration\";\r\nimport { Mesh } from \"./Mesh\";\r\n\r\n/**\r\n * <code>Mesh</code> \r\n */\r\nexport class MeshUtil {\r\n    /**\r\n     * mesh\r\n     * @param mesh Mesh\r\n     * @param out define\r\n     */\r\n    static getMeshDefine(mesh: Mesh, out: Array<ShaderDefine>) {\r\n        out.length = 0;\r\n        let vertexElements = mesh._vertexBuffer.vertexDeclaration._vertexElements;\r\n        for (const element of vertexElements) {\r\n            switch (element.elementUsage) {\r\n                case VertexMesh.MESH_COLOR0:\r\n                    out.push(MeshSprite3DShaderDeclaration.SHADERDEFINE_COLOR);\r\n                    break;\r\n                case VertexMesh.MESH_TEXTURECOORDINATE0:\r\n                    out.push(MeshSprite3DShaderDeclaration.SHADERDEFINE_UV0);\r\n                    break;\r\n                case VertexMesh.MESH_TEXTURECOORDINATE1:\r\n                    out.push(MeshSprite3DShaderDeclaration.SHADERDEFINE_UV1);\r\n                    break;\r\n                case VertexMesh.MESH_TANGENT0:\r\n                    out.push(MeshSprite3DShaderDeclaration.SHADERDEFINE_TANGENT);\r\n                    break;\r\n            }\r\n        }\r\n    }\r\n}\r\n\r\n\r\n\r\n","import { Config3D } from \"../../../Config3D\"\r\nimport { Component } from \"../../components/Component\"\r\nimport { Matrix4x4 } from \"../../maths/Matrix4x4\"\r\nimport { RenderCapable } from \"../../RenderEngine/RenderEnum/RenderCapable\"\r\nimport { Shader3D } from \"../../RenderEngine/RenderShader/Shader3D\"\r\nimport { ShaderData, ShaderDataType } from \"../../RenderEngine/RenderShader/ShaderData\"\r\nimport { ShaderDefine } from \"../../RenderEngine/RenderShader/ShaderDefine\"\r\nimport { VertexMesh } from \"../../RenderEngine/RenderShader/VertexMesh\"\r\nimport { Mesh } from \"../resource/models/Mesh\"\r\nimport { MorphTargetChannel } from \"../resource/models/MorphTarget\"\r\nimport { BlinnPhongMaterial } from \"./material/BlinnPhongMaterial\"\r\nimport { Material } from \"../../resource/Material\"\r\nimport { MeshFilter } from \"./MeshFilter\"\r\nimport { MeshSprite3DShaderDeclaration } from \"./MeshSprite3DShaderDeclaration\"\r\nimport { BaseRender } from \"./render/BaseRender\"\r\nimport { RenderContext3D } from \"./render/RenderContext3D\"\r\nimport { RenderElement } from \"./render/RenderElement\"\r\nimport { SubMeshRenderElement } from \"./render/SubMeshRenderElement\"\r\nimport { RenderableSprite3D } from \"./RenderableSprite3D\"\r\nimport { Sprite3D } from \"./Sprite3D\"\r\nimport { Transform3D } from \"./Transform3D\"\r\nimport { MeshUtil } from \"../resource/models/MeshUtil\"\r\nimport { LayaGL } from \"../../layagl/LayaGL\"\r\n\r\n/**\r\n * <code>MeshRenderer</code> \r\n */\r\nexport class MeshRenderer extends BaseRender {\r\n    /** @internal */\r\n    protected _revertStaticBatchDefineUV1: boolean = false;\r\n    /** @internal */\r\n    protected _projectionViewWorldMatrix: Matrix4x4;\r\n    /** @internal */\r\n    protected _mesh: Mesh;\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    static __init__(): void {\r\n        MeshSprite3DShaderDeclaration.SHADERDEFINE_UV0 = Shader3D.getDefineByName(\"UV\");\r\n        MeshSprite3DShaderDeclaration.SHADERDEFINE_COLOR = Shader3D.getDefineByName(\"COLOR\");\r\n        MeshSprite3DShaderDeclaration.SHADERDEFINE_UV1 = Shader3D.getDefineByName(\"UV1\");\r\n        MeshSprite3DShaderDeclaration.SHADERDEFINE_TANGENT = Shader3D.getDefineByName(\"TANGENT\");\r\n        MeshSprite3DShaderDeclaration.SHADERDEFINE_GPU_INSTANCE = Shader3D.getDefineByName(\"GPU_INSTANCE\");\r\n    }\r\n\r\n    private morphTargetActiveCount: number = 0;\r\n    private morphTargetActiveWeight: Float32Array;\r\n    private morphTargetActiveIndex: Float32Array;\r\n\r\n    /**@internal */\r\n    morphTargetWeight: Float32Array;\r\n    private morphtargetChannels: MorphTargetChannel[];\r\n\r\n    private _morphWeightChange: boolean = true;\r\n\r\n    /**\r\n     *  <code>MeshRender</code> \r\n     */\r\n    constructor() {\r\n        super();\r\n        this._projectionViewWorldMatrix = new Matrix4x4();\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    _createRenderElement(): RenderElement {\r\n        return new SubMeshRenderElement();\r\n    }\r\n\r\n    /**@intermal */\r\n    getMesh() {\r\n        return this._mesh;\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    protected _onEnable(): void {\r\n        super._onEnable();\r\n        const filter = this.owner.getComponent(MeshFilter) as MeshFilter;\r\n        if (filter) filter._enabled && this._onMeshChange(filter.sharedMesh);\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     * @param mesh \r\n     * @param out \r\n     */\r\n    protected _getMeshDefine(mesh: Mesh, out: Array<ShaderDefine>): number {\r\n        let define;\r\n        out.length = 0;\r\n        MeshUtil.getMeshDefine(mesh, out);\r\n        return define;\r\n    }\r\n\r\n    protected _changeVertexDefine(mesh: Mesh) {\r\n        var defineDatas: ShaderData = this._shaderValues;\r\n        var lastValue: Mesh = this._mesh;\r\n        if (lastValue) {\r\n            this._getMeshDefine(lastValue, MeshFilter._meshVerticeDefine);\r\n            for (var i: number = 0, n: number = MeshFilter._meshVerticeDefine.length; i < n; i++)\r\n                defineDatas.removeDefine(MeshFilter._meshVerticeDefine[i]);\r\n        }\r\n        if (mesh) {\r\n            this._getMeshDefine(mesh, MeshFilter._meshVerticeDefine);\r\n            for (var i: number = 0, n: number = MeshFilter._meshVerticeDefine.length; i < n; i++)\r\n                defineDatas.addDefine(MeshFilter._meshVerticeDefine[i]);\r\n        }\r\n\r\n    }\r\n\r\n    private _morphTargetValues: Record<string, number> = {}\r\n    /**\r\n     * @internal\r\n     */\r\n    public get morphTargetValues(): Record<string, number> {\r\n        return this._morphTargetValues;\r\n    }\r\n    /**\r\n     * @internal\r\n     */\r\n    public set morphTargetValues(value: Record<string, number>) {\r\n        this._morphTargetValues = value;\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     * @param key \r\n     */\r\n    _changeMorphTargetValue(key: string) {\r\n        this._morphWeightChange = true;\r\n    }\r\n\r\n    /**\r\n     *  morph target  \r\n     * @param channelName \r\n     * @param weight \r\n     */\r\n    setMorphChannelWeight(channelName: string, weight: number) {\r\n        // todo\r\n        let mesh = this._mesh;\r\n        if (mesh && mesh.morphTargetData) {\r\n            let morphData = mesh.morphTargetData;\r\n            let channel = morphData.getMorphChannel(channelName);\r\n            this.morphTargetValues[channel.name] = weight;\r\n            this._morphWeightChange = true;\r\n        }\r\n    }\r\n\r\n    /**\r\n     *  morph target \r\n     */\r\n    protected _applyMorphdata() {\r\n        let mesh = this._mesh;\r\n        if (this._morphWeightChange && mesh) {\r\n\r\n            let morphData = mesh.morphTargetData;\r\n            let channelCount = morphData.channelCount;\r\n\r\n            for (let channelIndex = 0; channelIndex < channelCount; channelIndex++) {\r\n                let channel = morphData.getMorphChannelbyIndex(channelIndex);\r\n                // channel.targetCount;\r\n                let weight = this.morphTargetValues[channel.name];\r\n\r\n                // update target weight\r\n                let lastFullWeight = 0;\r\n                channel.targets.forEach(target => {\r\n                    if (weight <= target.fullWeight) {\r\n                        this.morphTargetWeight[target._index] = (weight - lastFullWeight) / (target.fullWeight - lastFullWeight);\r\n                    }\r\n                    else {\r\n                        this.morphTargetWeight[target._index] = 1;\r\n                    }\r\n                    lastFullWeight = target.fullWeight;\r\n                });\r\n            }\r\n\r\n            let activeIndex = 0;\r\n            // todo top k\r\n            this.morphTargetWeight.forEach((weight, index) => {\r\n                if (weight > 0) {\r\n                    this.morphTargetActiveIndex[activeIndex] = index;\r\n                    this.morphTargetActiveWeight[activeIndex] = weight;\r\n                    activeIndex++;\r\n                }\r\n            });\r\n\r\n            this.morphTargetActiveCount = Math.min(activeIndex, Config3D.maxMorphTargetCount);\r\n\r\n            if (LayaGL.renderEngine.getCapable(RenderCapable.Texture3D)) {\r\n                this._shaderValues.setInt(RenderableSprite3D.MorphActiveCount, this.morphTargetActiveCount);\r\n\r\n                this._shaderValues.setBuffer(RenderableSprite3D.MorphActiceTargets, this.morphTargetActiveIndex);\r\n                this._shaderValues.setBuffer(RenderableSprite3D.MorphActiveWeights, this.morphTargetActiveWeight);\r\n            }\r\n            else {\r\n                // todo\r\n            }\r\n            this._morphWeightChange = false;\r\n            // todo \r\n            // active count == 0 disable morph ?\r\n        }\r\n\r\n    }\r\n\r\n    /**\r\n     *  mesh   morph target data (shader define)\r\n     * @param mesh \r\n     */\r\n    protected _changeMorphData(mesh: Mesh) {\r\n        let shaderData = this._shaderValues;\r\n        let oldMesh = this._mesh;\r\n\r\n        // todo\r\n        // config max count\r\n        const maxMorphTargetCount = Config3D.maxMorphTargetCount;\r\n        let maxCount = maxMorphTargetCount;\r\n\r\n        this.morphTargetActiveIndex = new Float32Array(maxCount);\r\n        this.morphTargetActiveWeight = new Float32Array(maxCount);\r\n\r\n        if (LayaGL.renderEngine.getCapable(RenderCapable.Texture3D)) {\r\n            if (oldMesh && oldMesh.morphTargetData) {\r\n                let morphData = oldMesh.morphTargetData;\r\n                shaderData.removeDefine(RenderableSprite3D.SHADERDEFINE_MORPHTARGET);\r\n\r\n                let morphVertexDec = morphData.vertexDec;\r\n\r\n                morphVertexDec._vertexElements.forEach(element => {\r\n                    switch (element.elementUsage) {\r\n                        case VertexMesh.MESH_POSITION0:\r\n                            shaderData.removeDefine(RenderableSprite3D.SHADERDEFINE_MORPHTARGET_POSITION);\r\n                            break;\r\n                        case VertexMesh.MESH_NORMAL0:\r\n                            shaderData.removeDefine(RenderableSprite3D.SHADERDEFINE_MORPHTARGET_NORMAL);\r\n                            break;\r\n                        case VertexMesh.MESH_TANGENT0:\r\n                            shaderData.removeDefine(RenderableSprite3D.SHADERDEFINE_MORPHTARGET_TANGENT);\r\n                            break;\r\n                        default:\r\n                            break;\r\n                    }\r\n                })\r\n            }\r\n\r\n            if (mesh && mesh.morphTargetData) {\r\n\r\n                let morphData = mesh.morphTargetData;\r\n\r\n                shaderData.addDefine(RenderableSprite3D.SHADERDEFINE_MORPHTARGET);\r\n                let morphVertexDec = morphData.vertexDec;\r\n                morphVertexDec._vertexElements.forEach(element => {\r\n                    switch (element.elementUsage) {\r\n                        case VertexMesh.MESH_POSITION0:\r\n                            shaderData.addDefine(RenderableSprite3D.SHADERDEFINE_MORPHTARGET_POSITION);\r\n                            break;\r\n                        case VertexMesh.MESH_NORMAL0:\r\n                            shaderData.addDefine(RenderableSprite3D.SHADERDEFINE_MORPHTARGET_NORMAL);\r\n                            break;\r\n                        case VertexMesh.MESH_TANGENT0:\r\n                            shaderData.addDefine(RenderableSprite3D.SHADERDEFINE_MORPHTARGET_TANGENT);\r\n                            break;\r\n                        default:\r\n                            break;\r\n                    }\r\n                })\r\n\r\n                shaderData.setVector(RenderableSprite3D.MorphAttriOffset, mesh.morphTargetData.attributeOffset);\r\n\r\n                shaderData.setTexture(RenderableSprite3D.MorphTex, mesh.morphTargetData.targetTexture);\r\n\r\n                shaderData.setVector(RenderableSprite3D.MorphParams, morphData.params);\r\n\r\n                shaderData.setBuffer(RenderableSprite3D.MorphActiceTargets, this.morphTargetActiveIndex);\r\n                shaderData.setBuffer(RenderableSprite3D.MorphActiveWeights, this.morphTargetActiveWeight);\r\n            }\r\n        }\r\n\r\n        if (oldMesh && oldMesh.morphTargetData) {\r\n            this.morphTargetWeight = null;\r\n\r\n            this.morphtargetChannels = null;\r\n            this._morphTargetValues = {};\r\n        }\r\n\r\n        if (mesh && mesh.morphTargetData) {\r\n\r\n            let morphData = mesh.morphTargetData;\r\n\r\n            let channelCount = morphData.channelCount;\r\n\r\n            this.morphTargetWeight = new Float32Array(morphData.targetCount);\r\n\r\n            this.morphtargetChannels = new Array<MorphTargetChannel>(channelCount);\r\n            for (let index = 0; index < channelCount; index++) {\r\n                let channel = morphData.getMorphChannelbyIndex(index);\r\n                this.morphtargetChannels[index] = channel;\r\n                this._morphTargetValues[channel.name] = 0;\r\n            }\r\n        }\r\n\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    _onMeshChange(mesh: Mesh): void {\r\n        if (mesh && this._mesh != mesh) {\r\n            this._changeVertexDefine(mesh);\r\n            this._changeMorphData(mesh);\r\n            this._mesh = mesh;\r\n            this.geometryBounds = mesh.bounds;\r\n            var count: number = mesh.subMeshCount;\r\n            this._renderElements.length = count;\r\n            let materials = this.sharedMaterials;\r\n            materials.length = count;\r\n            for (var i: number = 0; i < count; i++) {\r\n                var renderElement: RenderElement = this._renderElements[i];\r\n                if (!renderElement) {\r\n                    renderElement = this._renderElements[i] = this._renderElements[i] ? this._renderElements[i] : this._createRenderElement();\r\n                    this.owner && renderElement.setTransform((this.owner as Sprite3D)._transform);\r\n                    renderElement.render = this;\r\n                }\r\n                materials[i] = materials[i] || BlinnPhongMaterial.defaultMaterial;\r\n                renderElement.setGeometry(mesh.getSubMesh(i));\r\n            }\r\n\r\n            this.sharedMaterials = materials;\r\n\r\n        } else if (!mesh) {\r\n            this._renderElements.forEach\r\n            this._renderElements.forEach(element => {\r\n                element.destroy();\r\n            });\r\n            this._renderElements.length = 0;\r\n            this._mesh = null;\r\n            this._changeVertexDefine(null);\r\n            this._changeMorphData(null);\r\n        }\r\n        this.boundsChange = true;\r\n        // if (this._octreeNode && this._indexInOctreeMotionList === -1) {\r\n        // \tthis._octreeNode.getManagerNode().addMotionObject(this);\r\n        // }\r\n    }\r\n\r\n    /**\r\n     * @inheritDoc\r\n     * @override\r\n     * @internal\r\n     */\r\n    protected _calculateBoundingBox(): void {\r\n        var sharedMesh: Mesh = this._mesh;\r\n        if (sharedMesh) {\r\n            var worldMat: Matrix4x4 = this._transform.worldMatrix;\r\n            if (sharedMesh.morphTargetData) {\r\n                sharedMesh.morphTargetData.bounds._tranform(worldMat, this._bounds);\r\n            }\r\n            else {\r\n                sharedMesh.bounds._tranform(worldMat, this._bounds);\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * @inheritDoc\r\n     * @override\r\n     * @internal\r\n     */\r\n    _renderUpdate(context: RenderContext3D, transform: Transform3D): void {\r\n        (this._lightmapDirtyFlag == this.owner?.scene?._lightmapDirtyFlag) && this._applyLightMapParams();\r\n        this._applyReflection();\r\n        this._applyLightProb();\r\n        this._mesh.morphTargetData && this._applyMorphdata();\r\n        let trans = transform ? transform : this._transform;\r\n        this._setShaderValue(Sprite3D.WORLDMATRIX, ShaderDataType.Matrix4x4, trans.worldMatrix);\r\n        this._worldParams.x = trans.getFrontFaceValue();\r\n        this._setShaderValue(Sprite3D.WORLDINVERTFRONT, ShaderDataType.Vector4, this._worldParams);\r\n    }\r\n    /**\r\n     * @internal\r\n     * @override\r\n     */\r\n    _revertBatchRenderUpdate(context: RenderContext3D): void {\r\n        var element: SubMeshRenderElement = (<SubMeshRenderElement>context.renderElement);\r\n        switch (element.renderType) {\r\n            case RenderElement.RENDERTYPE_STATICBATCH:\r\n                if (this._revertStaticBatchDefineUV1)\r\n                    this._shaderValues.removeDefine(MeshSprite3DShaderDeclaration.SHADERDEFINE_UV1);\r\n                this._shaderValues.setVector(RenderableSprite3D.LIGHTMAPSCALEOFFSET, this.lightmapScaleOffset);\r\n                break;\r\n            case RenderElement.RENDERTYPE_INSTANCEBATCH:\r\n                this._shaderValues.removeDefine(MeshSprite3DShaderDeclaration.SHADERDEFINE_GPU_INSTANCE);\r\n                break;\r\n        }\r\n    }\r\n\r\n    protected _onDestroy() {\r\n        super._onDestroy();\r\n        this._morphTargetValues = null;\r\n    }\r\n\r\n    /**\r\n     * @override\r\n     * @param dest \r\n     */\r\n    _cloneTo(dest: Component): void {\r\n        super._cloneTo(dest);\r\n        // todo clone morphtarget weight\r\n        // onMeshChange in onEnable\r\n        if (this.morphTargetWeight) {\r\n            (<MeshRenderer>dest).morphTargetWeight = new Float32Array(this.morphTargetWeight);\r\n        }\r\n        for (const key in this._morphTargetValues) {\r\n            (<MeshRenderer>dest)._morphTargetValues[key] = this._morphTargetValues[key];\r\n        }\r\n    }\r\n}","import { Mesh } from \"../../../resource/models/Mesh\";\r\nimport { Material } from \"../../../../resource/Material\";\r\nimport { Command } from \"./Command\";\r\nimport { CommandBuffer } from \"./CommandBuffer\";\r\nimport { MeshRenderer } from \"../../../core/MeshRenderer\";\r\nimport { RenderElement } from \"../RenderElement\";\r\nimport { Transform3D } from \"../../Transform3D\";\r\nimport { RenderContext3D } from \"../RenderContext3D\";\r\nimport { Camera } from \"../../Camera\";\r\nimport { Matrix4x4 } from \"../../../../maths/Matrix4x4\";\r\nimport { Laya3DRender } from \"../../../RenderObjs/Laya3DRender\";\r\n/**\r\n * @internal\r\n * <code>SetShaderDataTextureCMD</code> \r\n */\r\nexport class DrawMeshCMD extends Command {\r\n\r\n    /**@internal */\r\n    private static _pool: DrawMeshCMD[] = [];\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    static create(mesh: Mesh, matrix: Matrix4x4, material: Material, subMeshIndex: number, subShaderIndex: number, commandBuffer: CommandBuffer): DrawMeshCMD {\r\n        var cmd: DrawMeshCMD;\r\n        cmd = DrawMeshCMD._pool.length > 0 ? DrawMeshCMD._pool.pop() : new DrawMeshCMD();\r\n\r\n        cmd._matrix = matrix;\r\n        cmd._transform.worldMatrix = cmd._matrix;\r\n        cmd.material = material;\r\n        cmd._subMeshIndex = subMeshIndex;\r\n        cmd._subShaderIndex = subShaderIndex;\r\n        cmd.mesh = mesh;\r\n        cmd._commandBuffer = commandBuffer;\r\n        return cmd;\r\n    }\r\n\r\n    /**@internal */\r\n    private _material: Material;\r\n\r\n    /**@internal */\r\n    private _matrix: Matrix4x4;\r\n\r\n    /**@internal */\r\n    private _subMeshIndex: number;\r\n\r\n    /**@internal */\r\n    private _subShaderIndex: number;\r\n\r\n    /**@internal */\r\n    private _mesh: Mesh;\r\n\r\n    /**@internal */\r\n    _renderElemnts: RenderElement[];\r\n\r\n    /**@internal */\r\n    _meshRender: MeshRenderer;\r\n\r\n    /**@internal */\r\n    _transform: Transform3D;\r\n\r\n    /**\r\n     * \r\n     */\r\n    constructor() {\r\n        super();\r\n        this._transform = Laya3DRender.renderOBJCreate.createTransform(null);\r\n        this._meshRender = new MeshRenderer();\r\n    }\r\n\r\n    set material(value: Material) {\r\n        this._material && this._material._removeReference(1);\r\n        this._material = value;\r\n        this._material && this._material._addReference(1);\r\n    }\r\n\r\n    set mesh(value: Mesh) {\r\n        if (this._mesh == value)\r\n            return;\r\n        this._mesh = value;\r\n        this._meshRender._onMeshChange(this._mesh);\r\n        this._renderElemnts = this._meshRender._renderElements;\r\n        this._renderElemnts.forEach(element => {\r\n            element.material = this._material;\r\n            element.setTransform(this._transform);\r\n            element.renderSubShader = this._material._shader.getSubShaderAt(this._subShaderIndex);\r\n            element._subShaderIndex = this._subShaderIndex;\r\n        });\r\n    }\r\n    /**\r\n     * @inheritDoc\r\n     * @override\r\n     */\r\n    run(): void {\r\n        var context = RenderContext3D._instance;\r\n        this._meshRender.probReflection = context.scene.sceneReflectionProb;\r\n        context._contextOBJ.applyContext(Camera._updateMark);\r\n        let submeshs = this._mesh._subMeshes\r\n        if (this._subMeshIndex == -1) {\r\n            for (let i = 0, n = submeshs.length; i < n; i++) {\r\n                let element = this._renderElemnts[i];\r\n                context.drawRenderElement(element);\r\n            }\r\n        } else {\r\n            let element = this._renderElemnts[this._subMeshIndex];\r\n            context.drawRenderElement(element);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * @inheritDoc\r\n     * @override\r\n     */\r\n    recover(): void {\r\n        DrawMeshCMD._pool.push(this);\r\n        super.recover();\r\n        this._material && (this.material = null);\r\n        this._mesh && (this.mesh = null);\r\n    }\r\n\r\n    /**\r\n     * @inheritDoc\r\n     * @override\r\n     */\r\n    destroy() {\r\n        super.destroy();\r\n        this._renderElemnts.forEach(element => {\r\n            element.destroy();\r\n        });\r\n        this._material && this._material._removeReference(1);\r\n        this._material = null;\r\n        this._renderElemnts = null;\r\n        this._transform = null;\r\n        this._material = null;\r\n        this._matrix = null\r\n    }\r\n}","import { LayaGL } from \"../../../../layagl/LayaGL\";\r\nimport { Color } from \"../../../../maths/Color\";\r\nimport { RenderClearFlag } from \"../../../../RenderEngine/RenderEnum/RenderClearFlag\";\r\nimport { Command } from \"./Command\";\r\nimport { CommandBuffer } from \"./CommandBuffer\";\r\n\r\n\r\n/**\r\n * @internal\r\n * <code>SetShaderDataTextureCMD</code> \r\n */\r\nexport class ClearRenderTextureCMD extends Command {\r\n\t/**@internal */\r\n\tprivate static _pool: any[] = [];\r\n\t/**@internal */\r\n\tprivate _clearColor: boolean = false;\r\n\t/**@internal */\r\n\tprivate _clearDepth: boolean = false;\r\n\t/**@internal */\r\n\tprivate _backgroundColor: Color = new Color();\r\n\t/**@internal */\r\n\tprivate _linearbackgroundColor: Color = new Color();\r\n\t/**@internal */\r\n\tprivate _depth: number = 1;\r\n\t/**\r\n\t * @internal\r\n\t */\r\n\tstatic create(clearColor: boolean, clearDepth: boolean, backgroundColor: Color, depth: number = 1, commandBuffer: CommandBuffer): ClearRenderTextureCMD {\r\n\t\tvar cmd: ClearRenderTextureCMD;\r\n\t\tcmd = ClearRenderTextureCMD._pool.length > 0 ? ClearRenderTextureCMD._pool.pop() : new ClearRenderTextureCMD();\r\n\t\tcmd._clearColor = clearColor;\r\n\t\tcmd._clearDepth = clearDepth;\r\n\t\tbackgroundColor.cloneTo(cmd._backgroundColor);\r\n\t\tbackgroundColor.toLinear(cmd._linearbackgroundColor);\r\n\t\tcmd._depth = depth;\r\n\t\tcmd._commandBuffer = commandBuffer;\r\n\t\treturn cmd;\r\n\t}\r\n\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t * @override\r\n\t */\r\n\trun(): void {\r\n\t\tvar flag: number;\r\n\t\t// var backgroundColor: Color = this._backgroundColor;\r\n\t\tlet linearBgColor = this._linearbackgroundColor;\r\n\t\tif (this._clearDepth && this._clearColor) {\r\n\t\t\tLayaGL.renderEngine.clearRenderTexture(RenderClearFlag.Color | RenderClearFlag.Depth, linearBgColor, this._depth);\r\n\t\t} else if (this._clearDepth) {\r\n\t\t\tLayaGL.renderEngine.clearRenderTexture(RenderClearFlag.Depth, linearBgColor, this._depth);\r\n\t\t} else if (this._clearColor) {\r\n\t\t\tLayaGL.renderEngine.clearRenderTexture(RenderClearFlag.Color, linearBgColor, this._depth);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t * @override\r\n\t */\r\n\trecover(): void {\r\n\r\n\t}\r\n\r\n}\r\n\r\n\r\n","import { Camera } from \"../../Camera\";\r\nimport { Material } from \"../../../../resource/Material\";\r\nimport { BaseRender } from \"../BaseRender\";\r\nimport { RenderContext3D } from \"../RenderContext3D\";\r\nimport { RenderElement } from \"../RenderElement\";\r\nimport { Command } from \"./Command\";\r\nimport { CommandBuffer } from \"./CommandBuffer\";\r\n\r\nexport class DrawRenderCMD extends Command {\r\n    /**@internal */\r\n    private static _pool: any[] = [];\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    static create(render: BaseRender, material: Material, subShaderIndex: number, commandBuffer: CommandBuffer): DrawRenderCMD {\r\n        var cmd: DrawRenderCMD;\r\n        cmd = DrawRenderCMD._pool.length > 0 ? DrawRenderCMD._pool.pop() : new DrawRenderCMD();\r\n        cmd._render = render;\r\n        cmd.material = material;\r\n        cmd._subShaderIndex = subShaderIndex;\r\n        cmd._commandBuffer = commandBuffer;\r\n        return cmd;\r\n    }\r\n\r\n\r\n\r\n    /**@internal */\r\n    private _material: Material;\r\n    /**@internal */\r\n    private _render: BaseRender;\r\n    /**@internal */\r\n    private _subShaderIndex: number;\r\n\r\n\r\n    constructor() {\r\n        super();\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    private _elementRender(renderElement: RenderElement, context: RenderContext3D): void {\r\n        renderElement.renderSubShader = this._material._shader.getSubShaderAt(this._subShaderIndex);//TODO\r\n        renderElement.material = this._material;\r\n        context.drawRenderElement(renderElement);\r\n    }\r\n\r\n    set material(value: Material) {\r\n        this._material && this._material._removeReference(1);\r\n        this._material = value;\r\n        this._material && this._material._addReference(1);\r\n    }\r\n\r\n    /**\r\n     * @inheritDoc\r\n     * @override\r\n     */\r\n    run(): void {\r\n        if (!this._material)\r\n            throw \"This render command material cannot be empty\";\r\n        this.setContext(this._commandBuffer._context);\r\n        var context = this._context;\r\n        context._contextOBJ.applyContext(Camera._updateMark);\r\n        var renderElements = this._render._renderElements;\r\n        for (var i: number = 0, n = renderElements.length; i < n; i++) {\r\n            var renderelement = renderElements[i];\r\n            //change Material\r\n            let mat = renderelement.material;\r\n            this._elementRender(renderelement, context);\r\n            //Recover Material\r\n            renderelement.material = mat;\r\n        }\r\n    }\r\n\r\n\r\n    /**\r\n     * @inheritDoc\r\n     * @override\r\n     */\r\n    recover(): void {\r\n        DrawRenderCMD._pool.push(this);\r\n        super.recover();\r\n        this._material && this._material._removeReference(1);\r\n        this._material = null;\r\n    }\r\n\r\n    destroy(): void {\r\n        super.destroy();\r\n        this._material && this._material._removeReference(1);\r\n        this._material = null;\r\n    }\r\n\r\n}","import { Command } from \"./Command\";\r\nimport { BaseTexture } from \"../../../../resource/BaseTexture\";\r\nimport { CommandBuffer } from \"./CommandBuffer\";\r\nimport { RenderContext3D } from \"../RenderContext3D\";\r\nimport { ShaderDataItem, ShaderDataType } from \"../../../../RenderEngine/RenderShader/ShaderData\";\r\nimport { Color } from \"../../../../maths/Color\";\r\nimport { Matrix4x4 } from \"../../../../maths/Matrix4x4\";\r\nimport { Vector2 } from \"../../../../maths/Vector2\";\r\nimport { Vector3 } from \"../../../../maths/Vector3\";\r\nimport { Vector4 } from \"../../../../maths/Vector4\";\r\nimport { LayaGL } from \"../../../../layagl/LayaGL\";\r\n\r\n/**\r\n * @internal\r\n * <code>SetShaderDataTextureCMD</code> \r\n */\r\nexport class SetGlobalShaderDataCMD extends Command {\r\n\t/**@internal */\r\n\tprivate static _pool: any[] = [];\r\n\t/**@internal */\r\n\tprivate _nameID: number = 0;\r\n\t/**@internal */\r\n\tprivate _value: ShaderDataItem = null;\r\n\t/**@internal */\r\n\tprivate _dataType: number = -1;\r\n\r\n\t/**\r\n\t * @internal\r\n\t */\r\n\tstatic create(nameID: number, value: any, shaderDataType: ShaderDataType, commandBuffer: CommandBuffer): SetGlobalShaderDataCMD {\r\n\t\tvar cmd: SetGlobalShaderDataCMD;\r\n\t\tcmd = SetGlobalShaderDataCMD._pool.length > 0 ? SetGlobalShaderDataCMD._pool.pop() : new SetGlobalShaderDataCMD();\r\n\t\tcmd._nameID = nameID;\r\n\t\tcmd._value = value;\r\n\t\tcmd._dataType = shaderDataType;\r\n\t\tcmd._commandBuffer = commandBuffer;\r\n\t\treturn cmd;\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t * @override\r\n\t */\r\n\trun(): void {\r\n\t\t//var shaderData:ShaderData = (this._commandBuffer._camera.scene as Scene3D)._shaderValues;\r\n\t\tlet context = RenderContext3D._instance;\r\n\t\tlet shaderData = context._contextOBJ.globalShaderData;\r\n\t\tif (!shaderData)\r\n\t\t\tshaderData = context._contextOBJ.globalShaderData = LayaGL.renderOBJCreate.createShaderData(null);\r\n\t\tswitch (this._dataType) {\r\n\t\t\tcase ShaderDataType.Int:\r\n\t\t\t\tshaderData.setInt(this._nameID, this._value as number);\r\n\t\t\t\tbreak;\r\n\t\t\tcase ShaderDataType.Float:\r\n\t\t\t\tshaderData.setNumber(this._nameID, this._value as number);\r\n\t\t\t\tbreak;\r\n\t\t\tcase ShaderDataType.Bool:\r\n\t\t\t\tshaderData.setBool(this._nameID, this._value as boolean);\r\n\t\t\t\tbreak;\r\n\t\t\tcase ShaderDataType.Matrix4x4:\r\n\t\t\t\tshaderData.setMatrix4x4(this._nameID, this._value as Matrix4x4);\r\n\t\t\t\tbreak;\r\n\t\t\tcase ShaderDataType.Texture2D:\r\n\t\t\tcase ShaderDataType.TextureCube:\r\n\t\t\tcase ShaderDataType.Texture2DArray:\r\n\t\t\tcase ShaderDataType.Texture3D:\r\n\t\t\t\tshaderData.setTexture(this._nameID, this._value as BaseTexture);\r\n\t\t\t\tbreak;\r\n\t\t\tcase ShaderDataType.Vector4:\r\n\t\t\t\tshaderData.setVector(this._nameID, this._value as Vector4);\r\n\t\t\t\tbreak;\r\n\t\t\tcase ShaderDataType.Vector2:\r\n\t\t\t\tshaderData.setVector2(this._nameID, this._value as Vector2);\r\n\t\t\t\tbreak;\r\n\t\t\tcase ShaderDataType.Vector3:\r\n\t\t\t\tshaderData.setVector3(this._nameID, this._value as Vector3);\r\n\t\t\t\tbreak;\r\n\t\t\tcase ShaderDataType.Buffer:\r\n\t\t\t\tshaderData.setBuffer(this._nameID, this._value as Float32Array);\r\n\t\t\t\tbreak;\r\n\t\t\tcase ShaderDataType.Color:\r\n\t\t\t\tshaderData.setColor(this._nameID, this._value as Color);\r\n\t\t\t\tbreak;\r\n\t\t\tdefault:\r\n\t\t\t\tthrow \"no type shaderValue on this CommendBuffer\";\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t * @override\r\n\t */\r\n\trecover(): void {\r\n\t\tSetGlobalShaderDataCMD._pool.push(this);\r\n\t\tthis._nameID = 0;\r\n\t\tthis._value = null;\r\n\t\tthis._dataType = -1;\r\n\t}\r\n\r\n}\r\n\r\n\r\n","import { DrawType } from \"../../RenderEngine/RenderEnum/DrawType\";\r\nimport { MeshTopology } from \"../../RenderEngine/RenderEnum/RenderPologyMode\";\r\nimport { GeometryElement } from \"../core/GeometryElement\";\r\nimport { RenderContext3D } from \"../core/render/RenderContext3D\";\r\nimport { SubMesh } from \"../resource/models/SubMesh\";\r\n\r\n/**\r\n * @internal\r\n */\r\nexport class MeshInstanceGeometry extends GeometryElement {\r\n    private _subMesh:SubMesh;\r\n    constructor(subMesh: SubMesh) {\r\n        super(subMesh?subMesh._geometryElementOBj.mode:MeshTopology.Triangles, DrawType.DrawElementInstance);\r\n        this._subMesh = subMesh;\r\n        if(subMesh)\r\n        this.indexFormat = subMesh._mesh.indexFormat;\r\n    }\r\n\r\n    set subMesh(value:SubMesh){\r\n        this._subMesh = value;\r\n        if(value)\r\n        this.indexFormat = value._mesh.indexFormat;\r\n        this.mode = value._geometryElementOBj.mode;\r\n    }\r\n\r\n    get subMesh():SubMesh{\r\n        return this._subMesh\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     * UpdateGeometry Data\r\n     */\r\n    _updateRenderParams(state: RenderContext3D): void {\r\n        this.clearRenderParams();\r\n\t\tthis.setDrawElemenParams(this._subMesh.indexCount, this._subMesh._indexStart * 2);\r\n    }\r\n\r\n}","import { BufferUsage } from \"../../../../RenderEngine/RenderEnum/BufferTargetType\";\r\nimport { VertexBuffer } from \"../../../../RenderEngine/VertexBuffer\";\r\nimport { VertexBuffer3D } from \"../../../graphics/VertexBuffer3D\";\r\nimport { Mesh } from \"../../../resource/models/Mesh\";\r\nimport { Material } from \"../../../../resource/Material\";\r\nimport { Transform3D } from \"../../Transform3D\";\r\nimport { Command } from \"./Command\";\r\nimport { CommandBuffer } from \"./CommandBuffer\";\r\nimport { MaterialInstancePropertyBlock } from \"./MaterialInstancePropertyBlock\";\r\nimport { RenderElement } from \"../RenderElement\";\r\nimport { MeshInstanceGeometry } from \"../../../graphics/MeshInstanceGeometry\";\r\nimport { RenderContext3D } from \"../RenderContext3D\";\r\nimport { BaseRender } from \"../../../core/render/BaseRender\";\r\nimport { MeshSprite3DShaderDeclaration } from \"../../MeshSprite3DShaderDeclaration\";\r\nimport { Camera } from \"../../Camera\";\r\nimport { Matrix4x4 } from \"../../../../maths/Matrix4x4\";\r\nimport { BufferState } from \"../../../../webgl/utils/BufferState\";\r\nimport { VertexMesh } from \"../../../../RenderEngine/RenderShader/VertexMesh\";\r\nimport { Laya3DRender } from \"../../../RenderObjs/Laya3DRender\";\r\n\r\n\r\nexport class DrawMeshInstancedCMD extends Command {\r\n    /**@internal */\r\n    private static _pool: DrawMeshInstancedCMD[] = [];\r\n    /**DrawInstance */\r\n    static maxInstanceCount = 1024;\r\n\r\n    /**\r\n     * \r\n     * @internal\r\n     */\r\n    static create(mesh: Mesh, subMeshIndex: number, matrixs: Matrix4x4[], material: Material, subShaderIndex: number, instanceProperty: MaterialInstancePropertyBlock, drawnums: number, commandBuffer: CommandBuffer): DrawMeshInstancedCMD {\r\n        var cmd: DrawMeshInstancedCMD;\r\n        if ((matrixs && matrixs.length > DrawMeshInstancedCMD.maxInstanceCount) || drawnums > DrawMeshInstancedCMD.maxInstanceCount) {\r\n            throw \"the number of renderings exceeds the maximum number of merges\";\r\n        }\r\n        cmd = DrawMeshInstancedCMD._pool.length > 0 ? DrawMeshInstancedCMD._pool.pop() : new DrawMeshInstancedCMD();\r\n\r\n\r\n        cmd._matrixs = matrixs;\r\n        cmd.material = material;\r\n        cmd._subMeshIndex = subMeshIndex;\r\n        cmd._subShaderIndex = subShaderIndex;\r\n        cmd._commandBuffer = commandBuffer;\r\n        cmd._instanceProperty = instanceProperty;\r\n        cmd._drawnums = drawnums;\r\n        cmd.mesh = mesh;\r\n        matrixs && cmd._updateWorldMatrixBuffer();\r\n        cmd._setInstanceBuffer();\r\n        cmd.setContext(RenderContext3D._instance);\r\n        return cmd;\r\n    }\r\n\r\n    /**@internal */\r\n    private _material: Material;\r\n    /**@internal */\r\n    private _matrixs: Matrix4x4[];\r\n    /**@internal */\r\n    private _subMeshIndex: number;\r\n    /**@internal */\r\n    private _subShaderIndex: number = 0;\r\n    /**@internal */\r\n    private _mesh: Mesh;\r\n    /**@internal */\r\n    private _instanceProperty: MaterialInstancePropertyBlock;\r\n    /** @internal */\r\n    private _instanceBufferState: BufferState;\r\n    /** @internal */\r\n    private _drawnums: number;\r\n    /**@internal */\r\n    private _instanceWorldMatrixData: Float32Array;\r\n    /**@internal buffer*/\r\n    private _instanceWorldMatrixBuffer: VertexBuffer3D;\r\n    /**@internal */\r\n    private _instanceGeometryArray: MeshInstanceGeometry[];\r\n    /**@internal */\r\n    private _instanceRenderElementArray: RenderElement[];\r\n    /**@internal */\r\n    _byteCount: number;\r\n    /**@internal */\r\n    _transform: Transform3D;\r\n    /**@internal */\r\n    _instanceRenderElement: RenderElement;\r\n    /**@internal */\r\n    _render: BaseRender;\r\n\r\n\r\n    constructor() {\r\n        super();\r\n        this._transform = Laya3DRender.renderOBJCreate.createTransform(null);\r\n        this._instanceRenderElementArray = [];\r\n        this._instanceGeometryArray = [];\r\n        this._instanceWorldMatrixData = new Float32Array(DrawMeshInstancedCMD.maxInstanceCount * 16);\r\n        this._instanceWorldMatrixBuffer = Laya3DRender.renderOBJCreate.createVertexBuffer3D(this._instanceWorldMatrixData.length * 4, BufferUsage.Dynamic, false);\r\n        this._instanceWorldMatrixBuffer.vertexDeclaration = VertexMesh.instanceWorldMatrixDeclaration;\r\n        this._instanceWorldMatrixBuffer.instanceBuffer = true;\r\n        this._render = new BaseRender();\r\n        this._render._shaderValues.addDefine(MeshSprite3DShaderDeclaration.SHADERDEFINE_GPU_INSTANCE);\r\n\r\n    }\r\n\r\n    set material(value: Material) {\r\n        this._material && this._material._removeReference(1);\r\n        this._material = value;\r\n        this._material && this._material._addReference(1);\r\n    }\r\n\r\n    get bufferState() {\r\n        return this._instanceWorldMatrixBuffer;\r\n    }\r\n\r\n    set mesh(value: Mesh) {\r\n\r\n        if (this._mesh == value)\r\n            return;\r\n        BaseRender.changeVertexDefine(this._mesh, value, this._render._shaderValues);\r\n        this._mesh = value;\r\n        if (!this._mesh)\r\n            return;\r\n        let submeshs = this._mesh._subMeshes;\r\n        if (this._subMeshIndex == -1) {\r\n            for (let i = 0, n = submeshs.length; i < n; i++) {\r\n                let element = this._instanceRenderElementArray[i] = this._instanceRenderElementArray[i] ? this._instanceRenderElementArray[i] : new RenderElement();\r\n                let geometry = this._instanceGeometryArray[i] = this._instanceGeometryArray[i] ? this._instanceGeometryArray[i] : new MeshInstanceGeometry(submeshs[i]);\r\n                element.setGeometry(geometry);\r\n                element.transform = this._transform;\r\n                element.material = this._material;\r\n                element.renderSubShader = this._material._shader.getSubShaderAt(this._subShaderIndex);\r\n                element._subShaderIndex = this._subShaderIndex;\r\n                element.render = this._render;\r\n\r\n                geometry.bufferState = this._instanceBufferState;\r\n                geometry.instanceCount = this._drawnums;\r\n            }\r\n        } else {\r\n            let element = this._instanceRenderElementArray[0] = this._instanceRenderElementArray[0] ? this._instanceRenderElementArray[0] : new RenderElement();\r\n            let geometry = this._instanceGeometryArray[0] = this._instanceGeometryArray[0] ? this._instanceGeometryArray[0] : new MeshInstanceGeometry(submeshs[this._subMeshIndex]);\r\n            element.setGeometry(geometry);\r\n            element.transform = this._transform;\r\n            element.material = this._material;\r\n            element.render = this._render;\r\n            element.renderSubShader = this._material._shader.getSubShaderAt(this._subShaderIndex);\r\n            geometry.bufferState = this._instanceBufferState;\r\n            geometry.instanceCount = this._drawnums;\r\n        }\r\n\r\n    }\r\n\r\n    get mesh(): Mesh {\r\n        return this._mesh;\r\n    }\r\n\r\n    /**\r\n * @internal\r\n     */\r\n    private _setInstanceBuffer(): void {\r\n        if (!this._instanceBufferState) {\r\n            this._instanceBufferState = new BufferState();\r\n        }\r\n        let instanceBufferState = this._instanceBufferState;\r\n\r\n        let vertexArray: Array<VertexBuffer> = [];\r\n        let meshVertexBuffer = this._mesh._bufferState._vertexBuffers;\r\n        meshVertexBuffer.forEach(element => {\r\n            vertexArray.push(element);\r\n        });\r\n        vertexArray.push(this._instanceWorldMatrixBuffer);\r\n        let propertyMap = this._instanceProperty._propertyMap;\r\n        for (let i in propertyMap) {\r\n            vertexArray.push(propertyMap[i]._vertexBuffer);\r\n        }\r\n        instanceBufferState.applyState(vertexArray, this._mesh._indexBuffer);\r\n        this._instanceGeometryArray.forEach(element => {\r\n            element.bufferState = instanceBufferState;\r\n        });\r\n    }\r\n\r\n    /**\r\n     * buffer\r\n     * @internal\r\n     */\r\n    private _updateWorldMatrixBuffer() {\r\n        let worldMatrixData: Float32Array = this._instanceWorldMatrixData;\r\n        let count: number = this._drawnums;\r\n        for (let i = 0; i < count; i++) {\r\n            worldMatrixData.set(this._matrixs[i].elements, i * 16);\r\n        }\r\n        let worldBuffer: VertexBuffer3D = this._instanceWorldMatrixBuffer;\r\n        worldBuffer.orphanStorage();\r\n        worldBuffer.setData(worldMatrixData.buffer, 0, 0, count * 64);\r\n    }\r\n\r\n    /**\r\n     * DrawInstance\r\n     * @param worldMatrixArray \r\n     */\r\n    setWorldMatrix(worldMatrixArray: Matrix4x4[]): void {\r\n        if (worldMatrixArray.length < this._drawnums)\r\n            throw \"worldMatrixArray length is less then drawnums\";\r\n        this._matrixs = worldMatrixArray;\r\n        this._matrixs && this._updateWorldMatrixBuffer();\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @param drawNums \r\n     */\r\n    setDrawNums(drawNums: number): void {\r\n        if (this._matrixs && this._matrixs.length < drawNums)\r\n            throw \"worldMatrixArray length is less then drawnums\";\r\n        this._drawnums = drawNums;\r\n        let submeshs = this._mesh._subMeshes;\r\n        if (this._subMeshIndex == -1) {\r\n            for (let i = 0, n = submeshs.length; i < n; i++) {\r\n                let geometry = this._instanceGeometryArray[i] ? this._instanceGeometryArray[i] : new MeshInstanceGeometry(submeshs[i]);\r\n                geometry.instanceCount = this._drawnums;\r\n            }\r\n        } else {\r\n            let geometry = this._instanceGeometryArray[0] ? this._instanceGeometryArray[0] : new MeshInstanceGeometry(submeshs[0]);\r\n            geometry.instanceCount = this._drawnums;\r\n        }\r\n        this._matrixs && this._updateWorldMatrixBuffer();\r\n    }\r\n\r\n    run(): void {\r\n        //update blockData\r\n        let context = RenderContext3D._instance;\r\n        context._contextOBJ.applyContext(Camera._updateMark);\r\n        let propertyMap = this._instanceProperty._propertyMap;\r\n        for (let i in propertyMap) {\r\n            //Instancebuffer\r\n            propertyMap[i].updateVertexBufferData(this._drawnums);\r\n        }\r\n\r\n        let submeshs = this.mesh._subMeshes\r\n        if (this._subMeshIndex == -1) {\r\n            for (let i = 0, n = submeshs.length; i < n; i++) {\r\n                let element = this._instanceRenderElementArray[i];\r\n                context.drawRenderElement(element);\r\n            }\r\n        } else {\r\n            let element = this._instanceRenderElementArray[0];\r\n            context.drawRenderElement(element);\r\n        }\r\n    }\r\n\r\n\r\n    /**\r\n     * @inheritDoc\r\n     * @override\r\n     */\r\n    recover(): void {\r\n        DrawMeshInstancedCMD._pool.push(this);\r\n        super.recover();\r\n        this._material && this._material._removeReference(1);\r\n        this._material = null;\r\n        this._instanceBufferState.destroy();\r\n        this._instanceBufferState = null;\r\n        delete this._instanceRenderElementArray;\r\n        this._instanceRenderElementArray = [];\r\n        delete this._instanceGeometryArray;\r\n        this._instanceGeometryArray = [];\r\n        this.mesh = null;\r\n\r\n    }\r\n\r\n    destroy(): void {\r\n        super.destroy();\r\n        this._material && this._material._removeReference(1);\r\n        this._material = null;\r\n        this._instanceBufferState.destroy();\r\n        this._instanceBufferState = null;\r\n        delete this._instanceRenderElementArray;\r\n        this._instanceRenderElementArray = [];\r\n        delete this._instanceGeometryArray;\r\n        this._instanceGeometryArray = [];\r\n        this.mesh = null;\r\n    }\r\n\r\n}","\r\nimport { Camera } from \"../../Camera\";\r\nimport { BlitScreenQuadCMD } from \"./BlitScreenQuadCMD\";\r\nimport { SetRenderTargetCMD } from \"./SetRenderTargetCMD\";\r\nimport { Command } from \"./Command\";\r\nimport { BaseTexture } from \"../../../../resource/BaseTexture\";\r\nimport { Mesh } from \"../../../resource/models/Mesh\";\r\nimport { Material } from \"../../../../resource/Material\";\r\nimport { SetShaderDataCMD } from \"./SetShaderDataCMD\";\r\nimport { DrawMeshCMD } from \"./DrawMeshCMD\";\r\nimport { RenderContext3D } from \"../RenderContext3D\";\r\nimport { ClearRenderTextureCMD } from \"./ClearRenderTextureCMD\";\r\nimport { BaseRender } from \"../BaseRender\";\r\nimport { DrawRenderCMD } from \"./DrawRenderCMD\";\r\nimport { SetGlobalShaderDataCMD } from \"./SetGlobalShaderDataCMD\";\r\nimport { DrawMeshInstancedCMD } from \"./DrawMeshInstancedCMD\";\r\nimport { MaterialInstancePropertyBlock } from \"./MaterialInstancePropertyBlock\";\r\nimport { RenderCapable } from \"../../../../RenderEngine/RenderEnum/RenderCapable\";\r\nimport { Shader3D } from \"../../../../RenderEngine/RenderShader/Shader3D\";\r\nimport { ShaderData, ShaderDataType } from \"../../../../RenderEngine/RenderShader/ShaderData\";\r\nimport { Stat } from \"../../../../utils/Stat\";\r\nimport { Color } from \"../../../../maths/Color\";\r\nimport { Matrix4x4 } from \"../../../../maths/Matrix4x4\";\r\nimport { Vector2 } from \"../../../../maths/Vector2\";\r\nimport { Vector3 } from \"../../../../maths/Vector3\";\r\nimport { Vector4 } from \"../../../../maths/Vector4\";\r\nimport { RenderTexture } from \"../../../../resource/RenderTexture\";\r\nimport { LayaGL } from \"../../../../layagl/LayaGL\";\r\n\r\n/**\r\n * <code>CommandBuffer</code> \r\n */\r\nexport class CommandBuffer {\r\n\t/**@internal */\r\n\t_name: string\r\n\t/**@internal */\r\n\tprivate _shadow: boolean = false;\r\n\t/**@internal */\r\n\t_camera: Camera = null;\r\n\t/**@internal */\r\n\t_context: RenderContext3D;\r\n\t/**@internal */\r\n\tprivate _commands: Command[] = [];\r\n\r\n\r\n\t/**\r\n\t *  <code>CommandBuffer</code> \r\n\t */\r\n\tconstructor(name: string = null, shadowCaster: boolean = false) {\r\n\t\tthis._name = name;\r\n\t\tthis._shadow = shadowCaster;\r\n\t}\r\n\r\n\tget name(): string {\r\n\t\treturn this._name;\r\n\t}\r\n\r\n\tget casterShadow() {\r\n\t\treturn this._shadow;\r\n\t}\r\n\r\n\tset context(value: RenderContext3D) {\r\n\t\tthis._context = value;\r\n\t}\r\n\r\n\tget context() {\r\n\t\treturn this._context;\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t */\r\n\t_apply(): void {\r\n\t\tfor (var i: number = 0, n: number = this._commands.length; i < n; i++)\r\n\t\t\tthis._commands[i].run();\r\n\t\tStat.cmdDrawCall += this._commands.length;\r\n\t}\r\n\r\n\t_applyOne(): boolean {\r\n\t\tif (this._commands.length) {\r\n\t\t\tvar cmd = this._commands.shift();\r\n\t\t\tcmd.run();\r\n\t\t\tcmd.recover();\r\n\t\t}\r\n\t\treturn this._commands.length > 0;\r\n\t}\r\n\r\n\tgetCommandsSize(): number {\r\n\t\treturn this._commands.length;\r\n\t}\r\n\r\n\t/**\r\n\t * shader\r\n\t * @param shaderData shader\r\n\t * @param nameID UniformID\r\n\t * @param source \r\n\t */\r\n\tsetShaderDataTexture(shaderData: ShaderData, nameID: number, source: BaseTexture): void {\r\n\t\tthis._commands.push(SetShaderDataCMD.create(shaderData, nameID, source, ShaderDataType.Texture2D, this));\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t * @param nameID uniformID\r\n\t * @param source \r\n\t */\r\n\tsetGlobalTexture(nameID: number, source: BaseTexture) {\r\n\t\tthis._commands.push(SetGlobalShaderDataCMD.create(nameID, source, ShaderDataType.Texture2D, this));\r\n\t}\r\n\r\n\t/**\r\n\t * shader Vector4\r\n\t * @param shaderData shader\r\n\t * @param nameID ID\r\n\t * @param value \r\n\t */\r\n\tsetShaderDataColor(shaderData: ShaderData, nameID: number, value: Color): void {\r\n\t\tthis._commands.push(SetShaderDataCMD.create(shaderData, nameID, value, ShaderDataType.Color, this));\r\n\t}\r\n\r\n\t/**\r\n\t * Vector4\r\n\t * @param nameID Vector4ID\r\n\t * @param source \r\n\t */\r\n\tsetGlobalColor(nameID: number, source: Color) {\r\n\r\n\t\tthis._commands.push(SetGlobalShaderDataCMD.create(nameID, source, ShaderDataType.Color, this));\r\n\t}\r\n\r\n\t/**\r\n\t * shader Vector4\r\n\t * @param shaderData shader\r\n\t * @param nameID ID\r\n\t * @param value \r\n\t */\r\n\tsetShaderDataVector(shaderData: ShaderData, nameID: number, value: Vector4): void {\r\n\t\tthis._commands.push(SetShaderDataCMD.create(shaderData, nameID, value, ShaderDataType.Vector4, this));\r\n\t}\r\n\r\n\t/**\r\n\t * Vector4\r\n\t * @param nameID Vector4ID\r\n\t * @param source \r\n\t */\r\n\tsetGlobalVector(nameID: number, source: Vector4) {\r\n\r\n\t\tthis._commands.push(SetGlobalShaderDataCMD.create(nameID, source, ShaderDataType.Vector4, this));\r\n\t}\r\n\r\n\t/**\r\n\t * shader Vector3\r\n\t * @param shaderData shader\r\n\t * @param nameID ID\r\n\t * @param value \r\n\t */\r\n\tsetShaderDataVector3(shaderData: ShaderData, nameID: number, value: Vector3): void {\r\n\t\tthis._commands.push(SetShaderDataCMD.create(shaderData, nameID, value, ShaderDataType.Vector3, this));\r\n\t}\r\n\r\n\t/**\r\n\t * Vector3\r\n\t * @param nameID ID\r\n\t * @param source \r\n\t */\r\n\tsetGlobalVector3(nameID: number, source: Vector3) {\r\n\r\n\t\tthis._commands.push(SetGlobalShaderDataCMD.create(nameID, source, ShaderDataType.Vector3, this));\r\n\t}\r\n\r\n\t/**\r\n\t * shader Vector2\r\n\t * @param shaderData shader\r\n\t * @param nameID ID\r\n\t * @param value \r\n\t */\r\n\tsetShaderDataVector2(shaderData: ShaderData, nameID: number, value: Vector2): void {\r\n\t\tthis._commands.push(SetShaderDataCMD.create(shaderData, nameID, value, ShaderDataType.Vector2, this));\r\n\t}\r\n\r\n\t/**\r\n\t * Vector2\r\n\t * @param nameID ID\r\n\t * @param source \r\n\t */\r\n\tsetGlobalVector2(nameID: number, source: Vector2) {\r\n\r\n\t\tthis._commands.push(SetGlobalShaderDataCMD.create(nameID, source, ShaderDataType.Vector2, this));\r\n\t}\r\n\r\n\t/**\r\n\t * shader Number\r\n\t * @param shaderData shader\r\n\t * @param nameID ID\r\n\t * @param value \r\n\t */\r\n\tsetShaderDataNumber(shaderData: ShaderData, nameID: number, value: number): void {\r\n\t\tthis._commands.push(SetShaderDataCMD.create(shaderData, nameID, value, ShaderDataType.Float, this));\r\n\t}\r\n\r\n\t/**\r\n\t * number\r\n\t * @param nameID ID\r\n\t * @param source \r\n\t */\r\n\tsetGlobalNumber(nameID: number, source: number) {\r\n\r\n\t\tthis._commands.push(SetGlobalShaderDataCMD.create(nameID, source, ShaderDataType.Float, this));\r\n\t}\r\n\r\n\t/**\r\n\t * shader Int\r\n\t * @param shaderData shader\r\n\t * @param nameID ID\r\n\t * @param value \r\n\t */\r\n\tsetShaderDataInt(shaderData: ShaderData, nameID: number, value: number): void {\r\n\t\tthis._commands.push(SetShaderDataCMD.create(shaderData, nameID, value, ShaderDataType.Int, this));\r\n\t}\r\n\r\n\t/**\r\n\t * int\r\n\t * @param nameID ID\r\n\t * @param source \r\n\t */\r\n\tsetGlobalInt(nameID: number, source: number) {\r\n\r\n\t\tthis._commands.push(SetGlobalShaderDataCMD.create(nameID, source, ShaderDataType.Int, this));\r\n\t}\r\n\r\n\t/**\r\n\t * shader Matrix\r\n\t * @param shaderData shader\r\n\t * @param nameID ID\r\n\t * @param value \r\n\t */\r\n\tsetShaderDataMatrix(shaderData: ShaderData, nameID: number, value: Matrix4x4): void {\r\n\t\tthis._commands.push(SetShaderDataCMD.create(shaderData, nameID, value, ShaderDataType.Matrix4x4, this));\r\n\t}\r\n\r\n\tsetShaderDefine(shaderData: ShaderData, define: string, value: boolean): void {\r\n\t\tthis._commands.push(SetShaderDataCMD.create(shaderData, define, value, SetShaderDataCMD.ShaderDataType_define, this));\r\n\t}\r\n\r\n\t/**\r\n\t * Matrix\r\n\t * @param nameID ID\r\n\t * @param source \r\n\t */\r\n\tsetGlobalMatrix(nameID: number, source: number) {\r\n\r\n\t\tthis._commands.push(SetGlobalShaderDataCMD.create(nameID, source, ShaderDataType.Matrix4x4, this));\r\n\t}\r\n\r\n\r\n\r\n\t/**\r\n\t * \r\n\t * @param\tsource . null,\r\n\t * @param\tdest  . null\r\n\t * @param\toffsetScale \r\n\t * @param\tshader ,null,\r\n\t * @param\tshaderData ,nullsourceTexture\r\n\t * @param\tsubShader subShader,0\r\n\t */\r\n\tblitScreenQuad(source: BaseTexture, dest: RenderTexture, offsetScale: Vector4 = null, shader: Shader3D = null, shaderData: ShaderData = null, subShader: number = 0): void {\r\n\t\tthis._commands.push(BlitScreenQuadCMD.create(source, dest, offsetScale, shader, shaderData, subShader, BlitScreenQuadCMD._SCREENTYPE_QUAD, this));\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t * @param source  null,\r\n\t * @param dest  null\r\n\t * @param offsetScale \r\n\t * @param material \r\n\t * @param subShader shader\r\n\t */\r\n\tblitScreenQuadByMaterial(source: BaseTexture, dest: RenderTexture, offsetScale: Vector4 = null, material: Material = null, subShader: number = 0): void {\r\n\t\tvar shader: Shader3D;\r\n\t\tvar shaderData: ShaderData;\r\n\t\tif (material) {\r\n\t\t\tshader = material._shader;\r\n\t\t\tshaderData = material.shaderData\r\n\t\t}\r\n\t\tthis._commands.push(BlitScreenQuadCMD.create(source, dest, offsetScale, shader, shaderData, subShader, BlitScreenQuadCMD._SCREENTYPE_QUAD, this));\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t * @param\tsource \r\n\t * @param\tdest  \r\n\t * @param\toffsetScale \r\n\t * @param\tshader ,null,\r\n\t * @param\tshaderData ,nullsourceTexture\r\n\t * @param\tsubShader subShader,0\r\n\t */\r\n\tblitScreenTriangle(source: BaseTexture, dest: RenderTexture, offsetScale: Vector4 = null, shader: Shader3D = null, shaderData: ShaderData = null, subShader: number = 0): void {\r\n\t\tthis._commands.push(BlitScreenQuadCMD.create(source, dest, offsetScale, shader, shaderData, subShader, BlitScreenQuadCMD._SCREENTYPE_TRIANGLE, this));\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t * @param renderTexture RT\r\n\t */\r\n\tsetRenderTarget(renderTexture: RenderTexture): void {\r\n\t\tthis._commands.push(SetRenderTargetCMD.create(renderTexture));\r\n\t}\r\n\r\n\t/**\r\n\t * clear\r\n\t * @param clearColor \r\n\t * @param clearDepth \r\n\t * @param backgroundColor \r\n\t * @param depth \r\n\t */\r\n\tclearRenderTarget(clearColor: boolean, clearDepth: boolean, backgroundColor: Color, depth: number = 1): void {\r\n\t\tthis._commands.push(ClearRenderTextureCMD.create(clearColor, clearDepth, backgroundColor, depth, this));\r\n\t}\r\n\r\n\t/**\r\n\t * Mesh\r\n\t * @param mesh \r\n\t * @param matrix \r\n\t * @param material \r\n\t * @param submeshIndex  \r\n\t * @param subShaderIndex shader 0\r\n\t */\r\n\tdrawMesh(mesh: Mesh, matrix: Matrix4x4, material: Material, submeshIndex: number, subShaderIndex: number): void {\r\n\t\tthis._commands.push(DrawMeshCMD.create(mesh, matrix, material, submeshIndex, subShaderIndex, this));\r\n\t}\r\n\r\n\t/**\r\n\t * Render\r\n\t * @param render \r\n\t * @param material \r\n\t * @param subShaderIndex shader 0\r\n\t */\r\n\tdrawRender(render: BaseRender, material: Material, subShaderIndex: number): void {\r\n\t\tthis._commands.push(DrawRenderCMD.create(render, material, subShaderIndex, this));\r\n\t}\r\n\r\n\r\n\t/**\r\n\t * instanceMesh\r\n\t * @param mesh \r\n\t * @param subMeshIndex mesh\r\n\t * @param matrixs Mesh,nullBuffer\r\n\t * @param material \r\n\t * @param subShaderIndex shader\r\n\t * @param instanceProperty Instance\r\n\t * @param drawnums \r\n\t */\r\n\tdrawMeshInstance(mesh: Mesh, subMeshIndex: number = 0, matrixs: Matrix4x4[], material: Material, subShaderIndex: number = 0, instanceProperty: MaterialInstancePropertyBlock, drawnums: number): any {\r\n\t\tif (!LayaGL.renderEngine.getCapable(RenderCapable.DrawElement_Instance))\r\n\t\t\treturn null;\r\n\t\tvar drawMeshInstancedCMD = DrawMeshInstancedCMD.create(mesh, subMeshIndex, matrixs, material, subShaderIndex, instanceProperty, drawnums, this);\r\n\t\tthis._commands.push(drawMeshInstancedCMD);\r\n\t\treturn drawMeshInstancedCMD;\r\n\t}\r\n\r\n\t/**\r\n\t * add \r\n\t * @param command \r\n\t */\r\n\taddCustomCMD(command: Command) {\r\n\t\tcommand._commandBuffer = this;\r\n\t\tthis._commands.push(command);\r\n\t}\r\n\r\n\t/**\r\n\t *@internal\r\n\t */\r\n\tclear(): void {\r\n\t\tfor (var i: number = 0, n: number = this._commands.length; i < n; i++)\r\n\t\t\tthis._commands[i].recover();\r\n\t\tthis._commands.length = 0;\r\n\t}\r\n\r\n}","/**\r\n * <code>PhysicsSettings</code> \r\n */\r\nexport class PhysicsSettings {\r\n    /***/\r\n    flags: number = 0;\r\n\r\n    /***/\r\n    maxSubSteps: number = 1;\r\n\r\n    /***/\r\n    fixedTimeStep: number = 1.0 / 60.0;\r\n\r\n    /** */\r\n    enableCCD: boolean = false;\r\n\r\n    /** */\r\n    ccdThreshold: number = 0.0001;\r\n\r\n    /** */\r\n    ccdSphereRadius: number = 0.0001;\r\n}\r\n\r\n\r\n","import { Light } from \"./Light\";\r\n\r\n\r\n\r\n/**\r\n * @internal\r\n */\r\nexport class LightQueue<T extends Light> {\r\n    _length: number = 0;\r\n    _elements: T[] = [];\r\n\r\n    add(light: T): void {\r\n        let index = this._elements.indexOf(light);\r\n        if (index !=-1 && index < this._length) {\r\n            return;\r\n        }\r\n        if (this._length === this._elements.length)\r\n            this._elements.push(light);\r\n        else\r\n            this._elements[this._length] = light;\r\n        this._length++;\r\n    }\r\n\r\n    remove(light: T): void {\r\n        var index: number = this._elements.indexOf(light);\r\n        if(index == -1)\r\n            return;\r\n        this._length--;\r\n        if (index !== this._length) {\r\n            var end: T = this._elements[this._length];\r\n            this._elements[index] = end;\r\n        }\r\n    }\r\n\r\n    shift(): T | undefined {\r\n        this._length--;\r\n        return this._elements.shift();\r\n    }\r\n\r\n    getBrightestLight(): number | undefined {\r\n        var maxIntIndex;\r\n        var maxIntensity: number = -1;\r\n        var elements: T[] = this._elements;\r\n        for (var i: number = 0; i < this._length; i++) {\r\n            var intensity: number = elements[i]._intensity;\r\n            if (maxIntensity < intensity) {\r\n                maxIntensity = intensity;\r\n                maxIntIndex = i;\r\n            }\r\n        }\r\n        return maxIntIndex;\r\n    }\r\n    normalLightOrdering(brightestIndex: number) {\r\n        var firstLight: T = this._elements[0];\r\n        this._elements[0] = this._elements[brightestIndex];\r\n        this._elements[brightestIndex] = firstLight;\r\n    }\r\n}\r\n\r\n\r\n\r\n\r\n/**\r\n * @internal\r\n */\r\nexport class AlternateLightQueue extends LightQueue<Light>{\r\n\r\n    remove(light: Light): void {\r\n        //sort must base added time\r\n        var index: number = this._elements.indexOf(light);\r\n        this._elements.splice(index, 1);\r\n        this._length--;\r\n    }\r\n}\r\n","import { Texture2D } from \"../../../resource/Texture2D\";\r\n\r\n/**\r\n * \r\n */\r\nexport class Lightmap {\r\n    static ApplyLightmapEvent:string = \"ApplyLightmap\";\r\n    /**  */\r\n    lightmapColor: Texture2D;\r\n    /**  */\r\n    lightmapDirection: Texture2D;\r\n\r\n    \r\n}","import { ShaderDefine } from \"../../../RenderEngine/RenderShader/ShaderDefine\";\r\n\r\n/**\r\n * @internal\r\n * \r\n */\r\nexport class Scene3DShaderDeclaration {\r\n\t/**@internal */\r\n\tstatic SHADERDEFINE_FOG: ShaderDefine;\r\n\t/**@internal */\r\n\tstatic SHADERDEFINE_FOG_LINEAR: ShaderDefine;\r\n\t/**@internal */\r\n\tstatic SHADERDEFINE_FOG_EXP: ShaderDefine;\r\n\t/**@internal */\r\n\tstatic SHADERDEFINE_FOG_EXP2: ShaderDefine;\r\n\t/**@internal */\r\n\tstatic SHADERDEFINE_DIRECTIONLIGHT: ShaderDefine;\r\n\t/**@internal */\r\n\tstatic SHADERDEFINE_POINTLIGHT: ShaderDefine;\r\n\t/**@internal */\r\n\tstatic SHADERDEFINE_SPOTLIGHT: ShaderDefine;\r\n\t/**@internal */\r\n\tstatic SHADERDEFINE_SHADOW: ShaderDefine;\r\n\t/**@internal */\r\n\tstatic SHADERDEFINE_SHADOW_CASCADE: ShaderDefine;\r\n\t/**@internal */\r\n\tstatic SHADERDEFINE_SHADOW_SOFT_SHADOW_LOW: ShaderDefine;\r\n\t/**@internal */\r\n\tstatic SHADERDEFINE_SHADOW_SOFT_SHADOW_HIGH: ShaderDefine;\r\n\t/**@internal */\r\n\tstatic SHADERDEFINE_SHADOW_SPOT: ShaderDefine;\r\n\t/**@internal */\r\n\tstatic SHADERDEFINE_SHADOW_SPOT_SOFT_SHADOW_LOW: ShaderDefine;\r\n\t/**@internal */\r\n\tstatic SHADERDEFINE_SHADOW_SPOT_SOFT_SHADOW_HIGH: ShaderDefine;\r\n\r\n}","import { Ray } from \"./Ray\";\r\nimport { CollisionUtils } from \"./CollisionUtils\";\r\nimport { IClone } from \"../../utils/IClone\"\r\nimport { Vector3 } from \"../../maths/Vector3\";\r\n\r\n/**\r\n * <code>BoundSphere</code> \r\n */\r\nexport class BoundSphere implements IClone {\r\n\tprivate static _tempVector3: Vector3 = new Vector3();\r\n\r\n\t/***/\r\n\t_center: Vector3;\r\n\t/***/\r\n\t_radius: number;\r\n\tset center(value: Vector3) {\r\n\t\tvalue.cloneTo(this._center);\r\n\t}\r\n\r\n\tget center() {\r\n\t\treturn this._center;\r\n\t}\r\n\r\n\tset radius(value: number) {\r\n\t\tthis._radius = value;\r\n\t}\r\n\r\n\tget radius(): number {\r\n\t\treturn this._radius\r\n\t}\r\n\t/**\r\n\t *  <code>BoundSphere</code> \r\n\t * @param\tcenter \r\n\t * @param\tradius \r\n\t */\r\n\tconstructor(center: Vector3 = new Vector3, radius: number = 0) {\r\n\t\tthis._center = center;\r\n\t\tthis._radius = radius;\r\n\t}\r\n\r\n\ttoDefault(): void {\r\n\t\tthis._center.toDefault();\r\n\t\tthis._radius = 0;\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t * @param\tpoints \r\n\t * @param\tstart \r\n\t * @param\tcount \r\n\t * @param\tresult \r\n\t */\r\n\tstatic createFromSubPoints(points: Vector3[], start: number, count: number, out: BoundSphere): void {\r\n\t\tif (points == null) {\r\n\t\t\tthrow new Error(\"points\");\r\n\t\t}\r\n\r\n\t\t// Check that start is in the correct range \r\n\t\tif (start < 0 || start >= points.length) {\r\n\t\t\tthrow new Error(\"start\" + start + \"Must be in the range [0, \" + (points.length - 1) + \"]\");\r\n\t\t}\r\n\r\n\t\t// Check that count is in the correct range \r\n\t\tif (count < 0 || (start + count) > points.length) {\r\n\t\t\tthrow new Error(\"count\" + count + \"Must be in the range <= \" + points.length + \"}\");\r\n\t\t}\r\n\r\n\t\tvar upperEnd: number = start + count;\r\n\r\n\t\t//Find the center of all points. \r\n\t\tvar center: Vector3 = BoundSphere._tempVector3;\r\n\t\tcenter.x = 0;\r\n\t\tcenter.y = 0;\r\n\t\tcenter.z = 0;\r\n\t\tfor (var i: number = start; i < upperEnd; ++i) {\r\n\t\t\tVector3.add(points[i], center, center);\r\n\t\t}\r\n\r\n\t\tvar outCenter: Vector3 = out.center;\r\n\t\t//This is the center of our sphere. \r\n\t\tVector3.scale(center, 1 / count, outCenter);\r\n\r\n\t\t//Find the radius of the sphere \r\n\t\tvar radius: number = 0.0;\r\n\t\tfor (i = start; i < upperEnd; ++i) {\r\n\t\t\t//We are doing a relative distance comparison to find the maximum distance \r\n\t\t\t//from the center of our sphere. \r\n\t\t\tvar distance: number = Vector3.distanceSquared(outCenter, points[i]);\r\n\r\n\t\t\tif (distance > radius)\r\n\t\t\t\tradius = distance;\r\n\t\t}\r\n\r\n\t\t//Find the real distance from the DistanceSquared. \r\n\t\tout.radius = Math.sqrt(radius);\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t * @param\tpoints \r\n\t * @param\tresult \r\n\t */\r\n\tstatic createfromPoints(points: Vector3[], out: BoundSphere): void {\r\n\t\tif (points == null) {\r\n\t\t\tthrow new Error(\"points\");\r\n\t\t}\r\n\r\n\t\tBoundSphere.createFromSubPoints(points, 0, points.length, out);\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t * @param\tray \r\n\t * @return -1\r\n\t */\r\n\tintersectsRayDistance(ray: Ray): number {\r\n\t\treturn CollisionUtils.intersectsRayAndSphereRD(ray, this);\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t * @param\tray  \r\n\t * @param\toutPoint \r\n\t * @return  -1\r\n\t */\r\n\tintersectsRayPoint(ray: Ray, outPoint: Vector3): number {\r\n\t\treturn CollisionUtils.intersectsRayAndSphereRP(ray, this, outPoint);\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t * @param\tdestObject \r\n\t */\r\n\tcloneTo(destObject: any): void {\r\n\t\tvar dest: BoundSphere = (<BoundSphere>destObject);\r\n\t\tthis._center.cloneTo(dest._center);\r\n\t\tdest._radius = this._radius;\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t * @return\t \r\n\t */\r\n\tclone(): any {\r\n\t\tvar dest: BoundSphere = new BoundSphere(new Vector3(), 0);\r\n\t\tthis.cloneTo(dest);\r\n\t\treturn dest;\r\n\t}\r\n\r\n}\r\n\r\n","import { Plane } from \"../math/Plane\";\r\nimport { ShaderData } from \"../../RenderEngine/RenderShader/ShaderData\";\r\nimport { ICameraCullInfo } from \"../../RenderEngine/RenderInterface/RenderPipelineInterface/ICameraCullInfo\";\r\nimport { BoundSphere } from \"../math/BoundSphere\";\r\nimport { Matrix4x4 } from \"../../maths/Matrix4x4\";\r\nimport { Vector3 } from \"../../maths/Vector3\";\r\nimport { LayaGL } from \"../../layagl/LayaGL\";\r\nimport { Laya3DRender } from \"../RenderObjs/Laya3DRender\";\r\n\r\n/**\r\n * @internal\r\n * \r\n */\r\nexport class ShadowSliceData {\r\n    cameraShaderValue: ShaderData = LayaGL.renderOBJCreate.createShaderData(null);\r\n    position: Vector3 = new Vector3();\r\n    offsetX: number;\r\n    offsetY: number;\r\n    resolution: number;\r\n    viewMatrix: Matrix4x4 = new Matrix4x4();\r\n    projectionMatrix: Matrix4x4 = new Matrix4x4();\r\n    viewProjectMatrix: Matrix4x4 = new Matrix4x4();\r\n    cullPlanes: Array<Plane> = [new Plane(new Vector3(), 0), new Plane(new Vector3(), 0), new Plane(new Vector3(), 0), new Plane(new Vector3(), 0), new Plane(new Vector3(), 0), new Plane(new Vector3(), 0), new Plane(new Vector3(), 0), new Plane(new Vector3(), 0), new Plane(new Vector3(), 0), new Plane(new Vector3(), 0)];\r\n    cullPlaneCount: number;\r\n    splitBoundSphere: BoundSphere = new BoundSphere(new Vector3(), 0.0);\r\n    sphereCenterZ: number;\r\n}\r\n\r\n/**\r\n * @internal\r\n * \r\n */\r\nexport class ShadowSpotData {\r\n    cameraShaderValue: ShaderData = LayaGL.renderOBJCreate.createShaderData(null);\r\n    position: Vector3 = new Vector3;\r\n    offsetX: number;\r\n    offsetY: number;\r\n    resolution: number;\r\n    viewMatrix: Matrix4x4 = new Matrix4x4();\r\n    projectionMatrix: Matrix4x4 = new Matrix4x4();\r\n    viewProjectMatrix: Matrix4x4 = new Matrix4x4();\r\n    cameraCullInfo: ICameraCullInfo = Laya3DRender.renderOBJCreate.createCameraCullInfo();\r\n\r\n}\r\n","import { Plane } from \"../math/Plane\";\r\nimport { ICameraCullInfo } from \"../../RenderEngine/RenderInterface/RenderPipelineInterface/ICameraCullInfo\";\r\nimport { IShadowCullInfo } from \"../../RenderEngine/RenderInterface/RenderPipelineInterface/IShadowCullInfo\";\r\nimport { Bounds } from \"../math/Bounds\";\r\nimport { ContainmentType } from \"../math/ContainmentType\";\r\nimport { CollisionUtils } from \"../math/CollisionUtils\";\r\nimport { Vector3 } from \"../../maths/Vector3\";\r\nimport { Laya3DRender } from \"../RenderObjs/Laya3DRender\";\r\n\r\n/**\r\n * @internal\r\n * <code>FrustumCulling</code> \r\n */\r\nexport class FrustumCulling {\r\n\t/**@internal */\r\n\tstatic _cameraCullInfo: ICameraCullInfo;\r\n\t/**@internal */\r\n\tstatic _shadowCullInfo: IShadowCullInfo;\r\n\t/**@internal */\r\n\tprivate static _tempV30: Vector3 = new Vector3();\r\n\t/**@internal */\r\n\tprivate static _tempV31: Vector3 = new Vector3();\r\n\r\n\t/**\r\n\t * @internal\r\n\t */\r\n\tstatic __init__(): void {\r\n\t\tFrustumCulling._cameraCullInfo = Laya3DRender.renderOBJCreate.createCameraCullInfo();\r\n\t\tFrustumCulling._shadowCullInfo = Laya3DRender.renderOBJCreate.createShadowCullInfo();\r\n\t}\r\n\r\n\t// /**\r\n\t//  * @internal\r\n\t//  */\r\n\t// private static _drawTraversalCullingBound(renderList: SingletonList<ISingletonElement>, debugTool: PixelLineSprite3D): void {\r\n\t// \tvar renders: ISingletonElement[] = renderList.elements;\r\n\t// \tfor (var i: number = 0, n: number = renderList.length; i < n; i++) {\r\n\t// \t\tvar color: Color = FrustumCulling._tempColor0;\r\n\t// \t\tcolor.r = 0;\r\n\t// \t\tcolor.g = 1;\r\n\t// \t\tcolor.b = 0;\r\n\t// \t\tcolor.a = 1;\r\n\t// \t\tUtils3D._drawBound(debugTool, ((<BaseRender>renders[i])).bounds._getBoundBox(), color);\r\n\t// \t}\r\n\t// }\r\n\r\n\r\n\t/**\r\n\t * caculate Bounds by ShadowCullInfo\r\n\t * @param bounds \r\n\t * @param cullInfo \r\n\t * @returns \r\n\t */\r\n\tstatic cullingRenderBounds(bounds: Bounds, cullInfo: IShadowCullInfo): boolean {\r\n\t\tvar cullPlaneCount: number = cullInfo.cullPlaneCount;\r\n\t\tvar cullPlanes: Plane[] = cullInfo.cullPlanes;\r\n\r\n\t\tvar min: Vector3 = bounds.getMin();\r\n\t\tvar max: Vector3 = bounds.getMax();\r\n\t\tvar minX: number = min.x;\r\n\t\tvar minY: number = min.y;\r\n\t\tvar minZ: number = min.z;\r\n\t\tvar maxX: number = max.x;\r\n\t\tvar maxY: number = max.y;\r\n\t\tvar maxZ: number = max.z;\r\n\t\t//TODO:pass\r\n\r\n\t\tvar pass: boolean = true;\r\n\t\t// cull by planes\r\n\t\t// Improve:Maybe use sphre and direction cull can savle the far plane cull\r\n\t\tfor (var j: number = 0; j < cullPlaneCount; j++) {\r\n\t\t\tvar plane: Plane = cullPlanes[j];\r\n\t\t\tvar normal: Vector3 = plane.normal;\r\n\t\t\tif (plane.distance + (normal.x * (normal.x < 0.0 ? minX : maxX)) + (normal.y * (normal.y < 0.0 ? minY : maxY)) + (normal.z * (normal.z < 0.0 ? minZ : maxZ)) < 0.0) {\r\n\t\t\t\tpass = false;\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn pass;\r\n\t}\r\n\r\n\t/**\r\n\t * caculate Bounds by ShadowCullInfo\r\n\t * @param bounds \r\n\t * @param cullInfo \r\n\t * @returns \r\n\t */\r\n\tstatic cullingRenderBoundsState(bounds: Bounds, cullInfo: IShadowCullInfo): ContainmentType {\r\n\t\tvar p: Vector3 = FrustumCulling._tempV30, n: Vector3 = FrustumCulling._tempV31;\r\n\t\tvar boxMin: Vector3 = bounds.min;\r\n\t\tvar boxMax: Vector3 = bounds.max;\r\n\t\tvar result: number = ContainmentType.Contains;\r\n\t\tfor (var i = 0, nn = cullInfo.cullPlaneCount; i < nn; i++) {\r\n\t\t\tvar plane: Plane = cullInfo.cullPlanes[i];\r\n\t\t\tvar planeNor: Vector3 = plane.normal;\r\n\r\n\t\t\tif (planeNor.x >= 0) {\r\n\t\t\t\tp.x = boxMax.x;\r\n\t\t\t\tn.x = boxMin.x;\r\n\t\t\t} else {\r\n\t\t\t\tp.x = boxMin.x;\r\n\t\t\t\tn.x = boxMax.x;\r\n\t\t\t}\r\n\t\t\tif (planeNor.y >= 0) {\r\n\t\t\t\tp.y = boxMax.y;\r\n\t\t\t\tn.y = boxMin.y;\r\n\t\t\t} else {\r\n\t\t\t\tp.y = boxMin.y;\r\n\t\t\t\tn.y = boxMax.y;\r\n\t\t\t}\r\n\t\t\tif (planeNor.z >= 0) {\r\n\t\t\t\tp.z = boxMax.z;\r\n\t\t\t\tn.z = boxMin.z;\r\n\t\t\t} else {\r\n\t\t\t\tp.z = boxMin.z;\r\n\t\t\t\tn.z = boxMax.z;\r\n\t\t\t}\r\n\r\n\t\t\tif (CollisionUtils.intersectsPlaneAndPoint(plane, p) === Plane.PlaneIntersectionType_Back)\r\n\t\t\t\treturn ContainmentType.Disjoint;\r\n\r\n\t\t\tif (CollisionUtils.intersectsPlaneAndPoint(plane, n) === Plane.PlaneIntersectionType_Back)\r\n\t\t\t\tresult = ContainmentType.Intersects;\r\n\t\t}\r\n\t\treturn result;\r\n\t}\r\n\r\n\r\n}\r\n\r\n","import { BaseCamera } from \"../core/BaseCamera\";\r\nimport { Camera } from \"../core/Camera\";\r\nimport { ShadowCascadesMode } from \"../core/light/ShadowCascadesMode\";\r\nimport { ShadowMode } from \"../core/light/ShadowMode\";\r\nimport { ShadowMapFormat, ShadowUtils } from \"../core/light/ShadowUtils\";\r\nimport { RenderContext3D } from \"../core/render/RenderContext3D\";\r\nimport { Scene3DShaderDeclaration } from \"../core/scene/Scene3DShaderDeclaration\";\r\nimport { Plane } from \"../math/Plane\";\r\nimport { Light, LightType } from \"../core/light/Light\";\r\nimport { DirectionLightCom } from \"../core/light/DirectionLightCom\";\r\nimport { Sprite3D } from \"../core/Sprite3D\";\r\nimport { SpotLightCom } from \"../core/light/SpotLightCom\";\r\nimport { Config3D } from \"../../../Config3D\";\r\nimport { Shader3D } from \"../../RenderEngine/RenderShader/Shader3D\";\r\nimport { ShaderData, ShaderDataType } from \"../../RenderEngine/RenderShader/ShaderData\";\r\nimport { UnifromBufferData } from \"../../RenderEngine/UniformBufferData\";\r\nimport { UniformBufferObject } from \"../../RenderEngine/UniformBufferObject\";\r\nimport { BoundFrustum } from \"../math/BoundFrustum\";\r\nimport { ShadowSliceData, ShadowSpotData } from \"./ShadowSliceData\";\r\nimport { RenderClearFlag } from \"../../RenderEngine/RenderEnum/RenderClearFlag\";\r\nimport { Viewport } from \"../math/Viewport\";\r\nimport { IShadowCullInfo } from \"../../RenderEngine/RenderInterface/RenderPipelineInterface/IShadowCullInfo\";\r\nimport { FrustumCulling } from \"../graphics/FrustumCulling\";\r\nimport { BufferUsage } from \"../../RenderEngine/RenderEnum/BufferTargetType\";\r\nimport { Stat } from \"../../utils/Stat\";\r\nimport { ShadowLightType } from \"./ShadowLightType\";\r\nimport { DepthCasterData } from \"../depthMap/DepthCasterData\";\r\nimport { MathUtils3D } from \"../../maths/MathUtils3D\";\r\nimport { Matrix4x4 } from \"../../maths/Matrix4x4\";\r\nimport { Vector3 } from \"../../maths/Vector3\";\r\nimport { Vector4 } from \"../../maths/Vector4\";\r\nimport { RenderTexture } from \"../../resource/RenderTexture\";\r\nimport { Scene3D } from \"../core/scene/Scene3D\";\r\nimport { LayaGL } from \"../../layagl/LayaGL\";\r\n\r\n/**\r\n * @internal\r\n * <code>ShadowCasterPass</code> \r\n */\r\nexport class ShadowCasterPass {\r\n    /**@internal */\r\n    private static _tempVector30: Vector3 = new Vector3();\r\n    /**@internal */\r\n    private static _tempVector4: Vector4 = new Vector4();\r\n    /**@internal */\r\n    private static _tempMatrix0: Matrix4x4 = new Matrix4x4();\r\n    /** @internal */\r\n    static SHADOW_BIAS: number;\r\n    /** @internal */\r\n    static SHADOW_LIGHT_DIRECTION: number;\r\n    /** @internal */\r\n    static SHADOW_SPLIT_SPHERES: number;\r\n    /** @internal */\r\n    static SHADOW_MATRICES: number;\r\n    /** @internal */\r\n    static SHADOW_MAP_SIZE: number;\r\n    /** @internal */\r\n    static SHADOW_MAP: number;\r\n    /** @internal */\r\n    static SHADOW_PARAMS: number;\r\n    /** @internal */\r\n    static SHADOW_SPOTMAP_SIZE: number;\r\n    /** @internal */\r\n    static SHADOW_SPOTMAP: number;\r\n    /** @internal */\r\n    static SHADOW_SPOTMATRICES: number;\r\n    /** @internal */\r\n    private static _maxCascades: number = 4;\r\n    /**@internal */\r\n    private static _cascadesSplitDistance: number[] = new Array(ShadowCasterPass._maxCascades + 1);\r\n    /** @internal */\r\n    private static _frustumPlanes: Plane[] = new Array();\r\n\r\n    /**\r\n     * @internal\r\n     * init Scene UniformMap\r\n     */\r\n    static __init__() {\r\n        ShadowCasterPass._frustumPlanes = new Array(new Plane(new Vector3(), 0), new Plane(new Vector3(), 0), new Plane(new Vector3(), 0), new Plane(new Vector3(), 0), new Plane(new Vector3(), 0), new Plane(new Vector3(), 0));\r\n        ShadowCasterPass.SHADOW_BIAS = Shader3D.propertyNameToID(\"u_ShadowBias\");\r\n        ShadowCasterPass.SHADOW_LIGHT_DIRECTION = Shader3D.propertyNameToID(\"u_ShadowLightDirection\");\r\n        ShadowCasterPass.SHADOW_SPLIT_SPHERES = Shader3D.propertyNameToID(\"u_ShadowSplitSpheres\");\r\n        ShadowCasterPass.SHADOW_MATRICES = Shader3D.propertyNameToID(\"u_ShadowMatrices\");\r\n        ShadowCasterPass.SHADOW_MAP_SIZE = Shader3D.propertyNameToID(\"u_ShadowMapSize\");\r\n        ShadowCasterPass.SHADOW_MAP = Shader3D.propertyNameToID(\"u_ShadowMap\");\r\n        ShadowCasterPass.SHADOW_PARAMS = Shader3D.propertyNameToID(\"u_ShadowParams\");\r\n        ShadowCasterPass.SHADOW_SPOTMAP_SIZE = Shader3D.propertyNameToID(\"u_SpotShadowMapSize\");\r\n        ShadowCasterPass.SHADOW_SPOTMAP = Shader3D.propertyNameToID(\"u_SpotShadowMap\");\r\n        ShadowCasterPass.SHADOW_SPOTMATRICES = Shader3D.propertyNameToID(\"u_SpotViewProjectMatrix\");\r\n\r\n        const sceneUniformMap = LayaGL.renderOBJCreate.createGlobalUniformMap(\"Scene3D\");\r\n\r\n        if (Config3D._uniformBlock) {\r\n            sceneUniformMap.addShaderBlockUniform(Shader3D.propertyNameToID(UniformBufferObject.UBONAME_SHADOW), UniformBufferObject.UBONAME_SHADOW, [\r\n                {\r\n                    id: ShadowCasterPass.SHADOW_BIAS,\r\n                    propertyName: \"u_ShadowBias\",\r\n                    uniformtype: ShaderDataType.Vector4\r\n\r\n                },\r\n                {\r\n                    id: ShadowCasterPass.SHADOW_LIGHT_DIRECTION,\r\n                    propertyName: \"u_ShadowLightDirection\",\r\n                    uniformtype: ShaderDataType.Vector3\r\n                }\r\n            ])\r\n        }else{\r\n            sceneUniformMap.addShaderUniform(ShadowCasterPass.SHADOW_BIAS, \"u_ShadowBias\",ShaderDataType.Vector4);\r\n            sceneUniformMap.addShaderUniform(ShadowCasterPass.SHADOW_LIGHT_DIRECTION, \"u_ShadowLightDirection\",ShaderDataType.Vector3);\r\n        }\r\n\r\n\r\n        \r\n        sceneUniformMap.addShaderUniform(ShadowCasterPass.SHADOW_SPLIT_SPHERES, \"u_ShadowSplitSpheres\",ShaderDataType.Vector4);\r\n        sceneUniformMap.addShaderUniform(ShadowCasterPass.SHADOW_MATRICES, \"u_ShadowMatrices\",ShaderDataType.Matrix4x4);\r\n        sceneUniformMap.addShaderUniform(ShadowCasterPass.SHADOW_MAP_SIZE, \"u_ShadowMapSize\",ShaderDataType.Vector4);\r\n        sceneUniformMap.addShaderUniform(ShadowCasterPass.SHADOW_MAP, \"u_ShadowMap\",ShaderDataType.Texture2D);\r\n        sceneUniformMap.addShaderUniform(ShadowCasterPass.SHADOW_PARAMS, \"u_ShadowParams\",ShaderDataType.Vector4);\r\n        sceneUniformMap.addShaderUniform(ShadowCasterPass.SHADOW_SPOTMAP_SIZE, \"u_SpotShadowMapSize\",ShaderDataType.Vector4);\r\n        sceneUniformMap.addShaderUniform(ShadowCasterPass.SHADOW_SPOTMAP, \"u_SpotShadowMap\",ShaderDataType.Texture2D);\r\n        sceneUniformMap.addShaderUniform(ShadowCasterPass.SHADOW_SPOTMATRICES, \"u_SpotViewProjectMatrix\",ShaderDataType.Matrix4x4);\r\n        //sceneUniformMap.addShaderUniform(Shader3D.propertyNameToID(UniformBufferObject.UBONAME_SHADOW), UniformBufferObject.UBONAME_SHADOW);\r\n    }\r\n\r\n\r\n\r\n    /** @internal */\r\n    private _shadowBias: Vector4 = new Vector4();\r\n    /** @internal */\r\n    private _shadowParams: Vector4 = new Vector4();\r\n    /** @internal */\r\n    private _shadowMapSize: Vector4 = new Vector4();\r\n    /** @internal */\r\n    private _shadowSpotMapSize: Vector4 = new Vector4();\r\n    /** @internal */\r\n    private _shadowMatrices: Float32Array = new Float32Array(16 * (ShadowCasterPass._maxCascades));\r\n    /** @internal */\r\n    private _shadowSpotMatrices: Matrix4x4 = new Matrix4x4();\r\n    /**@internal */\r\n    private _splitBoundSpheres: Float32Array = new Float32Array(ShadowCasterPass._maxCascades * 4);\r\n    /** @internal */\r\n    private _cascadeCount: number = 0;\r\n    /** @internal */\r\n    private _shadowMapWidth: number = 0;\r\n    /** @internal */\r\n    private _shadowMapHeight: number = 0;\r\n    /** @internal */\r\n    private _shadowDirectLightMap: RenderTexture;\r\n    /** @internal */\r\n    private _shadowSpotLightMap: RenderTexture;\r\n    /** @internal */\r\n    private _shadowSliceDatas: ShadowSliceData[] = [new ShadowSliceData(), new ShadowSliceData(), new ShadowSliceData(), new ShadowSliceData()];\r\n    /** @internal */\r\n    private _shadowSpotData: ShadowSpotData = new ShadowSpotData();\r\n    /**@internal */\r\n    private _light: Light;\r\n    /** @internal */\r\n    private _lightUp: Vector3 = new Vector3();\r\n    /** @internal */\r\n    private _lightSide: Vector3 = new Vector3();\r\n    /** @internal */\r\n    private _lightForward: Vector3 = new Vector3();\r\n    /** @internal */\r\n    _castDepthBufferData: UnifromBufferData;\r\n    _castDepthBufferOBJ: UniformBufferObject;\r\n\r\n    _castDepthCameraBufferData: UnifromBufferData;\r\n    _castDepthCameraBufferOBJ: UniformBufferObject;\r\n\r\n    constructor() {\r\n        this._shadowSpotData.cameraCullInfo.boundFrustum = new BoundFrustum(new Matrix4x4());\r\n        if (Config3D._uniformBlock) {\r\n            this._castDepthBufferData = DepthCasterData.createDepthCasterUniformBlock();\r\n            this._castDepthBufferOBJ = UniformBufferObject.getBuffer(UniformBufferObject.UBONAME_SHADOW, 0);\r\n            if (!this._castDepthBufferOBJ) {\r\n                this._castDepthBufferOBJ = UniformBufferObject.create(UniformBufferObject.UBONAME_SHADOW, BufferUsage.Dynamic, this._castDepthBufferData.getbyteLength(), true);\r\n            }\r\n            BaseCamera.createCameraUniformBlock();\r\n            this._castDepthCameraBufferData = BaseCamera.CameraUBOData.clone();\r\n            this._castDepthCameraBufferOBJ = UniformBufferObject.getBuffer(UniformBufferObject.UBONAME_CAMERA, 1);\r\n            if (!this._castDepthCameraBufferOBJ) {\r\n                this._castDepthCameraBufferOBJ = UniformBufferObject.create(UniformBufferObject.UBONAME_CAMERA, BufferUsage.Dynamic, this._castDepthCameraBufferData.getbyteLength(), false);\r\n            }\r\n        }\r\n\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @internal\r\n     * @param context \r\n     * @param shaderValues \r\n     * @param shadowSliceData \r\n     * @param LightParam \r\n     * @param shadowparams \r\n     * @param shadowBias \r\n     * @param lightType \r\n     */\r\n    private _setupShadowCasterShaderValues(context: RenderContext3D, shaderValues: ShaderData, shadowSliceData: any, LightParam: Vector3, shadowparams: Vector4, shadowBias: Vector4, lightType: LightType): void {\r\n        //shaderValues.setVector(ShadowCasterPass.SHADOW_BIAS, shadowBias);\r\n        shaderValues.setVector(ShadowCasterPass.SHADOW_BIAS, shadowBias);\r\n        switch (lightType) {\r\n            case LightType.Directional:\r\n                shaderValues.setVector3(ShadowCasterPass.SHADOW_LIGHT_DIRECTION, LightParam);\r\n                //this._setcommandBlockData(ShadowCasterPass.SHADOW_LIGHT_DIRECTION, LightParam);\r\n                break;\r\n            case LightType.Spot:\r\n                shaderValues.setVector(ShadowCasterPass.SHADOW_PARAMS, shadowparams);\r\n                break;\r\n            case LightType.Point:\r\n                break;\r\n        }\r\n        var cameraSV: ShaderData = shadowSliceData.cameraShaderValue;//TODO:should optimization with shader upload.\r\n        if (this._castDepthCameraBufferOBJ) {\r\n            cameraSV._addCheckUBO(UniformBufferObject.UBONAME_CAMERA, this._castDepthCameraBufferOBJ, this._castDepthCameraBufferData);\r\n            cameraSV.setUniformBuffer(BaseCamera.CAMERAUNIFORMBLOCK, this._castDepthCameraBufferOBJ);\r\n        }\r\n\r\n        cameraSV.setMatrix4x4(BaseCamera.VIEWMATRIX, shadowSliceData.viewMatrix);\r\n        cameraSV.setMatrix4x4(BaseCamera.PROJECTMATRIX, shadowSliceData.projectionMatrix);\r\n        cameraSV.setMatrix4x4(BaseCamera.VIEWPROJECTMATRIX, shadowSliceData.viewProjectMatrix);\r\n        shaderValues.setMatrix4x4(BaseCamera.VIEWPROJECTMATRIX, shadowSliceData.viewProjectMatrix);\r\n        context.viewMatrix = shadowSliceData.viewMatrix;\r\n        context.projectionMatrix = shadowSliceData.projectionMatrix;\r\n        context.projectionViewMatrix = shadowSliceData.viewProjectMatrix;\r\n        //this._castDepthBufferOBJ && shaderValues.setUniformBuffer(Shader3D.propertyNameToID(UniformBufferObject.UBONAME_SHADOW), this._castDepthBufferOBJ);\r\n    }\r\n\r\n\r\n    /**\r\n     *\r\n     * @internal\r\n     * @param shaderValues \r\n     */\r\n    private _setupShadowReceiverShaderValues(shaderValues: ShaderData): void {\r\n        var light: DirectionLightCom = <DirectionLightCom>this._light;\r\n        if (light.shadowCascadesMode !== ShadowCascadesMode.NoCascades)\r\n            shaderValues.addDefine(Scene3DShaderDeclaration.SHADERDEFINE_SHADOW_CASCADE);\r\n        else\r\n            shaderValues.removeDefine(Scene3DShaderDeclaration.SHADERDEFINE_SHADOW_CASCADE);\r\n        switch (light.shadowMode) {\r\n            case ShadowMode.Hard:\r\n                shaderValues.removeDefine(Scene3DShaderDeclaration.SHADERDEFINE_SHADOW_SOFT_SHADOW_LOW);\r\n                shaderValues.removeDefine(Scene3DShaderDeclaration.SHADERDEFINE_SHADOW_SOFT_SHADOW_HIGH);\r\n                break;\r\n            case ShadowMode.SoftLow:\r\n                shaderValues.addDefine(Scene3DShaderDeclaration.SHADERDEFINE_SHADOW_SOFT_SHADOW_LOW);\r\n                shaderValues.removeDefine(Scene3DShaderDeclaration.SHADERDEFINE_SHADOW_SOFT_SHADOW_HIGH);\r\n                break;\r\n            case ShadowMode.SoftHigh:\r\n                shaderValues.addDefine(Scene3DShaderDeclaration.SHADERDEFINE_SHADOW_SOFT_SHADOW_HIGH);\r\n                shaderValues.removeDefine(Scene3DShaderDeclaration.SHADERDEFINE_SHADOW_SOFT_SHADOW_LOW);\r\n                break;\r\n        }\r\n        shaderValues.setTexture(ShadowCasterPass.SHADOW_MAP, this._shadowDirectLightMap);\r\n        shaderValues.setBuffer(ShadowCasterPass.SHADOW_MATRICES, this._shadowMatrices);\r\n        shaderValues.setVector(ShadowCasterPass.SHADOW_MAP_SIZE, this._shadowMapSize);\r\n        shaderValues.setVector(ShadowCasterPass.SHADOW_PARAMS, this._shadowParams);\r\n        shaderValues.setBuffer(ShadowCasterPass.SHADOW_SPLIT_SPHERES, this._splitBoundSpheres);\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @internal\r\n     * @param shaderValues \r\n     */\r\n    private _setupSpotShadowReceiverShaderValues(shaderValues: ShaderData): void {\r\n        var spotLight: SpotLightCom = <SpotLightCom>this._light;\r\n        switch (spotLight.shadowMode) {\r\n            case ShadowMode.Hard:\r\n                shaderValues.removeDefine(Scene3DShaderDeclaration.SHADERDEFINE_SHADOW_SPOT_SOFT_SHADOW_HIGH);\r\n                shaderValues.removeDefine(Scene3DShaderDeclaration.SHADERDEFINE_SHADOW_SPOT_SOFT_SHADOW_LOW);\r\n                break;\r\n            case ShadowMode.SoftLow:\r\n                shaderValues.addDefine(Scene3DShaderDeclaration.SHADERDEFINE_SHADOW_SPOT_SOFT_SHADOW_LOW);\r\n                shaderValues.removeDefine(Scene3DShaderDeclaration.SHADERDEFINE_SHADOW_SPOT_SOFT_SHADOW_HIGH);\r\n                break;\r\n            case ShadowMode.SoftHigh:\r\n                shaderValues.addDefine(Scene3DShaderDeclaration.SHADERDEFINE_SHADOW_SPOT_SOFT_SHADOW_HIGH);\r\n                shaderValues.removeDefine(Scene3DShaderDeclaration.SHADERDEFINE_SHADOW_SPOT_SOFT_SHADOW_LOW);\r\n                break;\r\n        }\r\n        shaderValues.setTexture(ShadowCasterPass.SHADOW_SPOTMAP, this._shadowSpotLightMap);\r\n        shaderValues.setMatrix4x4(ShadowCasterPass.SHADOW_SPOTMATRICES, this._shadowSpotMatrices)\r\n        shaderValues.setVector(ShadowCasterPass.SHADOW_SPOTMAP_SIZE, this._shadowSpotMapSize);\r\n        shaderValues.setVector(ShadowCasterPass.SHADOW_PARAMS, this._shadowParams);\r\n    }\r\n\r\n    // /**\r\n    //  * set castDepthBuffer data\r\n    //  */\r\n    // private _setcommandBlockData(index: number, value: any) {\r\n    // \tif (this._castDepthBufferData && this._castDepthBufferData._has(index))\r\n    // \t\tthis._castDepthBufferData._setData(index, value);\r\n    // }\r\n\r\n\r\n    /**\r\n     * \r\n     * @internal\r\n     * @param camera \r\n     * @param light \r\n     * @param lightType \r\n     */\r\n    update(camera: Camera, light: Light, lightType: ShadowLightType): void {\r\n        this.cleanUp();\r\n        switch (lightType) {\r\n            case ShadowLightType.DirectionLight:\r\n                this._light = light;\r\n                var lightWorld: Matrix4x4 = ShadowCasterPass._tempMatrix0;\r\n                var lightWorldE: Float32Array = lightWorld.elements;\r\n                var lightUp: Vector3 = this._lightUp;\r\n                var lightSide: Vector3 = this._lightSide;\r\n                var lightForward: Vector3 = this._lightForward;\r\n                //  \r\n                Matrix4x4.createFromQuaternion((light.owner as Sprite3D)._transform.rotation, lightWorld);//to remove scale problem\r\n                lightSide.setValue(lightWorldE[0], lightWorldE[1], lightWorldE[2]);\r\n                lightUp.setValue(lightWorldE[4], lightWorldE[5], lightWorldE[6]);\r\n                lightForward.setValue(-lightWorldE[8], -lightWorldE[9], -lightWorldE[10]);\r\n                //\r\n                var atlasResolution: number = light._shadowResolution;\r\n                var cascadesMode: ShadowCascadesMode = (<DirectionLightCom>light)._shadowCascadesMode;\r\n                var cascadesCount: number;\r\n                var shadowTileResolution: number;\r\n                var shadowMapWidth: number, shadowMapHeight: number;\r\n                if (cascadesMode == ShadowCascadesMode.NoCascades) {\r\n                    cascadesCount = 1;\r\n                    shadowTileResolution = atlasResolution;\r\n                    shadowMapWidth = atlasResolution;\r\n                    shadowMapHeight = atlasResolution;\r\n                }\r\n                else {\r\n                    cascadesCount = cascadesMode == ShadowCascadesMode.TwoCascades ? 2 : 4;\r\n                    shadowTileResolution = ShadowUtils.getMaxTileResolutionInAtlas(atlasResolution, atlasResolution, cascadesCount);\r\n                    shadowMapWidth = shadowTileResolution * 2;\r\n                    shadowMapHeight = cascadesMode == ShadowCascadesMode.TwoCascades ? shadowTileResolution : shadowTileResolution * 2;\r\n                }\r\n                this._cascadeCount = cascadesCount;\r\n                this._shadowMapWidth = shadowMapWidth;\r\n                this._shadowMapHeight = shadowMapHeight;\r\n\r\n                var splitDistance: number[] = ShadowCasterPass._cascadesSplitDistance;\r\n                var frustumPlanes: Plane[] = ShadowCasterPass._frustumPlanes;\r\n                var cameraNear: number = camera.nearPlane;\r\n                var shadowFar: number = Math.min(camera.farPlane, light._shadowDistance);\r\n                var shadowMatrices: Float32Array = this._shadowMatrices;\r\n                var boundSpheres: Float32Array = this._splitBoundSpheres;\r\n                ShadowUtils.getCascadesSplitDistance((<DirectionLightCom>light)._shadowTwoCascadeSplits, (<DirectionLightCom>light)._shadowFourCascadeSplits, cameraNear, shadowFar, camera.fieldOfView * MathUtils3D.Deg2Rad, camera.aspectRatio, cascadesMode, splitDistance);\r\n                ShadowUtils.getCameraFrustumPlanes(camera.projectionViewMatrix, frustumPlanes);\r\n                var forward: Vector3 = ShadowCasterPass._tempVector30;\r\n                camera._transform.getForward(forward);\r\n                Vector3.normalize(forward, forward);\r\n                for (var i: number = 0; i < cascadesCount; i++) {\r\n                    var sliceData: ShadowSliceData = this._shadowSliceDatas[i];\r\n                    sliceData.sphereCenterZ = ShadowUtils.getBoundSphereByFrustum(splitDistance[i], splitDistance[i + 1], camera.fieldOfView * MathUtils3D.Deg2Rad, camera.aspectRatio, camera._transform.position, forward, sliceData.splitBoundSphere);\r\n                    ShadowUtils.getDirectionLightShadowCullPlanes(frustumPlanes, i, splitDistance, cameraNear, lightForward, sliceData);\r\n                    ShadowUtils.getDirectionalLightMatrices(lightUp, lightSide, lightForward, i, light._shadowNearPlane, shadowTileResolution, sliceData, shadowMatrices);\r\n                    if (cascadesCount > 1)\r\n                        ShadowUtils.applySliceTransform(sliceData, shadowMapWidth, shadowMapHeight, i, shadowMatrices);\r\n                }\r\n                ShadowUtils.prepareShadowReceiverShaderValues((<DirectionLightCom>light), shadowMapWidth, shadowMapHeight, this._shadowSliceDatas, cascadesCount, this._shadowMapSize, this._shadowParams, shadowMatrices, boundSpheres);\r\n                break;\r\n            case ShadowLightType.SpotLight:\r\n                this._light = light;\r\n                var lightWorld: Matrix4x4 = ShadowCasterPass._tempMatrix0;\r\n                var lightForward: Vector3 = this._lightForward;\r\n                var shadowResolution: number = this._light._shadowResolution;\r\n                this._shadowMapWidth = shadowResolution;\r\n                this._shadowMapHeight = shadowResolution;\r\n                var shadowSpotData: ShadowSpotData = this._shadowSpotData;\r\n                ShadowUtils.getSpotLightShadowData(shadowSpotData, <SpotLightCom>this._light, shadowResolution, this._shadowParams, this._shadowSpotMatrices, this._shadowSpotMapSize);\r\n                break;\r\n            case ShadowLightType.PointLight:\r\n                //TODO:\r\n                break;\r\n            default:\r\n                throw (\"There is no shadow of this type\")\r\n                break;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @internal\r\n     * @param context \r\n     * @param scene 3DScene\r\n     * @param lightType \r\n     */\r\n    render(context: RenderContext3D, scene: Scene3D, lightType: ShadowLightType, camera: Camera): void {\r\n        switch (lightType) {\r\n            case ShadowLightType.DirectionLight:\r\n                var shaderValues: ShaderData = scene._shaderValues;\r\n                context.pipelineMode = \"ShadowCaster\";\r\n                var shadowMap: RenderTexture = this._shadowDirectLightMap = ShadowUtils.getTemporaryShadowTexture(this._shadowMapWidth, this._shadowMapHeight, ShadowMapFormat.bit16);\r\n                shadowMap._start();\r\n                context.destTarget = shadowMap;\r\n                var light: DirectionLightCom = <DirectionLightCom>this._light;\r\n                for (var i: number = 0, n: number = this._cascadeCount; i < n; i++) {\r\n                    var sliceData: ShadowSliceData = this._shadowSliceDatas[i];\r\n                    ShadowUtils.getShadowBias(light, sliceData.projectionMatrix, sliceData.resolution, this._shadowBias);\r\n                    this._setupShadowCasterShaderValues(context, shaderValues, sliceData, this._lightForward, this._shadowParams, this._shadowBias, LightType.Directional);\r\n                    var shadowCullInfo: IShadowCullInfo = FrustumCulling._shadowCullInfo;\r\n                    shadowCullInfo.position = sliceData.position;\r\n                    shadowCullInfo.cullPlanes = sliceData.cullPlanes;\r\n                    shadowCullInfo.cullPlaneCount = sliceData.cullPlaneCount;\r\n                    shadowCullInfo.cullSphere = sliceData.splitBoundSphere;\r\n                    shadowCullInfo.direction = this._lightForward;\r\n                    //cull\r\n                    scene._directLightShadowCull(shadowCullInfo, context);\r\n                    context.cameraShaderValue = sliceData.cameraShaderValue;\r\n                    Camera._updateMark++;\r\n\r\n                    var resolution: number = sliceData.resolution;\r\n                    var offsetX: number = sliceData.offsetX;\r\n                    var offsetY: number = sliceData.offsetY;\r\n\r\n                    LayaGL.renderEngine.viewport(offsetX, offsetY, resolution, resolution);\r\n                    LayaGL.renderEngine.scissor(offsetX, offsetY, resolution, resolution);\r\n\r\n                    LayaGL.renderEngine.clearRenderTexture(RenderClearFlag.Depth, null, 1);\r\n                    if (scene._opaqueQueue.elements.length > 0) {// if one cascade have anything to render.\r\n                        Viewport._tempViewport.set(offsetX, offsetY, resolution, resolution);\r\n                        ShadowCasterPass._tempVector4.setValue(offsetX + 1, offsetY + 1, resolution - 2, resolution - 2);\r\n                        context.viewport = Viewport._tempViewport;\r\n                        context.scissor = ShadowCasterPass._tempVector4;\r\n                        Stat.depthCastDrawCall += scene._opaqueQueue.renderQueue(context);//\r\n                    }\r\n                    camera._applyCasterPassCommandBuffer(context);\r\n                }\r\n                shadowMap._end();\r\n                this._setupShadowReceiverShaderValues(shaderValues);\r\n                context.pipelineMode = context.configPipeLineMode;\r\n                break;\r\n            case ShadowLightType.SpotLight:\r\n                var shaderValues: ShaderData = scene._shaderValues;\r\n                context.pipelineMode = \"ShadowCaster\";\r\n                var spotlight: SpotLightCom = <SpotLightCom>this._light;\r\n                var shadowMap: RenderTexture = this._shadowSpotLightMap = ShadowUtils.getTemporaryShadowTexture(this._shadowMapWidth, this._shadowMapHeight, ShadowMapFormat.bit16);\r\n                shadowMap._start();\r\n                context.destTarget = shadowMap;\r\n                var shadowSpotData: ShadowSpotData = this._shadowSpotData;\r\n                ShadowUtils.getShadowBias(spotlight, shadowSpotData.projectionMatrix, shadowSpotData.resolution, this._shadowBias);\r\n                this._setupShadowCasterShaderValues(context, shaderValues, shadowSpotData, (this._light.owner as Sprite3D).transform.position, this._shadowParams, this._shadowBias, LightType.Spot);\r\n                scene._sportLightShadowCull(shadowSpotData.cameraCullInfo, context);\r\n                context.cameraShaderValue = shadowSpotData.cameraShaderValue;\r\n                Camera._updateMark++;\r\n\r\n                LayaGL.renderEngine.viewport(shadowSpotData.offsetX, shadowSpotData.offsetY, shadowSpotData.resolution, shadowSpotData.resolution);\r\n                LayaGL.renderEngine.scissor(shadowSpotData.offsetX, shadowSpotData.offsetY, shadowSpotData.resolution, shadowSpotData.resolution);\r\n                LayaGL.renderEngine.clearRenderTexture(RenderClearFlag.Depth, null, 1);\r\n\r\n                if (scene._opaqueQueue.elements.length > 0) {\r\n                    context.changeViewport(shadowSpotData.offsetX, shadowSpotData.offsetY, shadowSpotData.resolution, shadowSpotData.resolution);\r\n                    context.changeScissor(shadowSpotData.offsetX, shadowSpotData.offsetY, shadowSpotData.resolution, shadowSpotData.resolution);\r\n                    Stat.depthCastDrawCall += scene._opaqueQueue.renderQueue(context);//\r\n                }\r\n                camera._applyCasterPassCommandBuffer(context);\r\n                shadowMap._end();\r\n                this._setupSpotShadowReceiverShaderValues(shaderValues);\r\n                context.pipelineMode = context.configPipeLineMode;\r\n                break;\r\n            case ShadowLightType.PointLight:\r\n                //TODO:\r\n                break;\r\n            default:\r\n                throw (\"There is no shadow of this type\");\r\n        }\r\n\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @internal\r\n     */\r\n    cleanUp(): void {\r\n        this._shadowDirectLightMap && RenderTexture.recoverToPool(this._shadowDirectLightMap);\r\n        this._shadowSpotLightMap && RenderTexture.recoverToPool(this._shadowSpotLightMap);\r\n        this._shadowDirectLightMap = null;\r\n        this._shadowSpotLightMap = null;\r\n        this._light = null;\r\n    }\r\n}\r\n\r\n","import { BaseTexture } from \"../../../../resource/BaseTexture\";\r\nimport { Viewport } from \"../../../math/Viewport\";\r\nimport { RenderContext3D } from \"../RenderContext3D\";\r\nimport { ScreenQuad } from \"../ScreenQuad\";\r\nimport { Command } from \"./Command\";\r\nimport { Shader3D } from \"../../../../RenderEngine/RenderShader/Shader3D\";\r\nimport { ShaderData } from \"../../../../RenderEngine/RenderShader/ShaderData\";\r\nimport { RenderElement } from \"../RenderElement\";\r\nimport { Transform3D } from \"../../Transform3D\";\r\nimport { Camera } from \"../../Camera\";\r\nimport { Vector4 } from \"../../../../maths/Vector4\";\r\nimport { RenderTexture } from \"../../../../resource/RenderTexture\";\r\nimport { ShaderPass } from \"../../../../RenderEngine/RenderShader/ShaderPass\";\r\nimport { SubShader } from \"../../../../RenderEngine/RenderShader/SubShader\";\r\nimport { LayaGL } from \"../../../../layagl/LayaGL\";\r\nimport { Laya3DRender } from \"../../../RenderObjs/Laya3DRender\";\r\n\r\n\r\n/**\r\n * \r\n */\r\nexport class BlitFrameBufferCMD {\r\n\t/**@internal */\r\n\tprivate static _pool: any[] = [];\r\n\t/** @internal */\r\n\tprivate static _defaultOffsetScale: Vector4 = new Vector4(0, 0, 1, 1);\r\n\t/** @internal */\r\n\tstatic shaderdata: ShaderData;\r\n\r\n\t/** @internal */\r\n\tstatic __init__(): void {\r\n\t\tBlitFrameBufferCMD.shaderdata = LayaGL.renderOBJCreate.createShaderData(null);\r\n\t}\r\n\r\n\t/**\r\n   * \r\n   * @param source \r\n   * @param dest \r\n   * @param viewport \r\n   * @param offsetScale \r\n   * @param shader \r\n   * @param shaderData \r\n   * @param subShader \r\n   */\r\n\tstatic create(source: BaseTexture, dest: RenderTexture, viewport: Viewport, offsetScale: Vector4 = null, shader: Shader3D = null, shaderData: ShaderData = null, subShader: number = 0) {\r\n\t\tvar cmd: BlitFrameBufferCMD;\r\n\t\tcmd = BlitFrameBufferCMD._pool.length > 0 ? BlitFrameBufferCMD._pool.pop() : new BlitFrameBufferCMD();\r\n\t\tcmd._source = source;\r\n\t\tcmd._dest = dest;\r\n\t\tcmd._offsetScale = offsetScale;\r\n\t\tcmd.setshader(shader, subShader, shaderData);\r\n\t\tcmd._source && cmd._texture_size.setValue(source.width, source.height, 1.0 / source.width, 1.0 / source.height);\r\n\t\t//cmd._shader = shader;\r\n\t\t//cmd._shaderData = shaderData;\r\n\t\t//cmd._subShader = subShader;\r\n\t\tcmd._viewPort = viewport;\r\n\t\treturn cmd;\r\n\t}\r\n\t/**@internal source */\r\n\tprivate _source: BaseTexture = null;\r\n\t/**@internal dest  null*/\r\n\tprivate _dest: RenderTexture = null;\r\n\t/**@internal */\r\n\tprivate _offsetScale: Vector4 = null;\r\n\t/**@internal */\r\n\t_texture_size: Vector4 = null;\r\n\t/**@internal shader*/\r\n\tprivate _shader: Shader3D = null;\r\n\t/**@internal */\r\n\tprivate _shaderData: ShaderData = null;\r\n\t/**@internal subshader*/\r\n\tprivate _subShader: number = 0;\r\n\t/**@internal */\r\n\tprivate _viewPort: Viewport = null;\r\n\t// /**@internal */\r\n\t// private _sourceTexelSize: Vector4 = new Vector4();\r\n\t/**@internal */\r\n\tprivate _renderElement: RenderElement;\r\n\t/**@internal */\r\n\tprivate _transform3D: Transform3D;\r\n\tconstructor() {\r\n\t\tthis._transform3D = Laya3DRender.renderOBJCreate.createTransform(null);\r\n\t\tthis._renderElement = new RenderElement();\r\n\t\tthis._renderElement.setTransform(this._transform3D);\r\n\t\tthis._renderElement.setGeometry(ScreenQuad.instance);\r\n\t\tthis._texture_size = new Vector4();\r\n\t}\r\n\r\n\tset shaderData(value: ShaderData) {\r\n\t\tthis._shaderData = value || BlitFrameBufferCMD.shaderdata;\r\n\t\tthis._renderElement._renderElementOBJ._materialShaderData = this._shaderData;\r\n\t}\r\n\r\n\tsetshader(shader: Shader3D, subShader: number, shaderData: ShaderData) {\r\n\t\tthis._shader = shader || Command._screenShader;\r\n\t\tthis._subShader = subShader || 0;\r\n\t\tthis.shaderData = shaderData;\r\n\t\tthis._renderElement.renderSubShader = this._shader.getSubShaderAt(this._subShader);\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t * @override\r\n\t */\r\n\trun(): void {\r\n\t\tif (!this._source || !this._viewPort)\r\n\t\t\treturn;\r\n\t\tvar source = this._source;\r\n\t\tvar dest = this._dest;\r\n\t\tvar shader: Shader3D = this._shader;\r\n\t\tvar shaderData: ShaderData = this._shaderData;\r\n\t\tvar viewport = this._viewPort;\r\n\r\n\t\tlet vph = RenderContext3D.clientHeight - viewport.y - viewport.height;\r\n\r\n\t\t// LayaGL.renderEngine.viewport(viewport.x, vph, viewport.width, viewport.height);\r\n\t\t// LayaGL.renderEngine.scissor(viewport.x, vph, viewport.width, viewport.height);\r\n\t\tlet context = RenderContext3D._instance;\r\n\t\tcontext.changeViewport(viewport.x, vph, viewport.width, viewport.height);\r\n\t\tcontext.changeScissor(viewport.x, vph, viewport.width, viewport.height);\r\n\r\n\t\tshaderData.setTexture(Command.SCREENTEXTURE_ID, source);\r\n\t\tshaderData.setVector(Command.SCREENTEXTUREOFFSETSCALE_ID, this._offsetScale || BlitFrameBufferCMD._defaultOffsetScale);\r\n\t\tsource && (shaderData.setVector(Command.MAINTEXTURE_TEXELSIZE_ID, this._texture_size));\r\n\t\t//this._sourceTexelSize.setValue(1.0 / source.width, 1.0 / source.height, source.width, source.height);\r\n\t\t(RenderTexture.currentActive) && (RenderTexture.currentActive._end());\r\n\r\n\t\tif (dest) {\r\n\t\t\tdest._start();\r\n\t\t\tshaderData.removeDefine(RenderContext3D.GammaCorrect);\r\n\t\t}\r\n\t\telse {\r\n\t\t\tshaderData.addDefine(RenderContext3D.GammaCorrect);\r\n\t\t}\r\n\t\tvar subShader: SubShader = shader.getSubShaderAt(this._subShader);\r\n\t\tvar passes: ShaderPass[] = subShader._passes;\r\n\t\tScreenQuad.instance.invertY = false;\r\n\r\n\t\tcontext.destTarget = dest;\r\n\t\tcontext._contextOBJ.applyContext(Camera._updateMark);\r\n\t\tcontext.drawRenderElement(this._renderElement);\r\n\t\t//RenderContext3D._instance.invertY ? ScreenQuad.instance.renderInvertUV() : ScreenQuad.instance.render();\r\n\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t * @override\r\n\t */\r\n\trecover(): void {\r\n\t\tBlitFrameBufferCMD._pool.push(this);\r\n\t\tthis._source = null;\r\n\t\tthis._dest = null;\r\n\t\tthis._offsetScale = null;\r\n\t\tthis._shader = null;\r\n\t\tthis._shaderData = null;\r\n\t\tthis._viewPort = null;\r\n\t}\r\n}","import { ISceneRenderManager } from \"../../../RenderEngine/RenderInterface/RenderPipelineInterface/ISceneRenderManager\";\r\nimport { SingletonList } from \"../../../utils/SingletonList\";\r\nimport { Laya3DRender } from \"../../RenderObjs/Laya3DRender\";\r\nimport { BaseRender } from \"../render/BaseRender\";\r\n\r\n/**\r\n * <code><code/>\r\n */\r\nexport class SceneRenderManager {\r\n    /**@internal */\r\n    protected _sceneManagerOBJ: ISceneRenderManager;\r\n    \r\n    /**\r\n     * \r\n     */\r\n    constructor() {\r\n        this._sceneManagerOBJ = Laya3DRender.renderOBJCreate.createSceneRenderManager();\r\n    }\r\n\r\n    /**\r\n     * get RenderList\r\n     */\r\n    get list(): SingletonList<BaseRender> {\r\n        return this._sceneManagerOBJ.list;\r\n    }\r\n\r\n    set list(value: SingletonList<BaseRender>) {\r\n        this._sceneManagerOBJ.list = value;\r\n    }\r\n\r\n    /**\r\n     * add Render Node\r\n     * @param object \r\n     */\r\n    addRenderObject(object: BaseRender): void {\r\n        this._sceneManagerOBJ.addRenderObject(object);\r\n    }\r\n\r\n    /**\r\n     * remove Render Node\r\n     * @param object \r\n     */\r\n    removeRenderObject(object: BaseRender): void {\r\n        this._sceneManagerOBJ.removeRenderObject(object);\r\n    }\r\n\r\n    /**\r\n     * remove motion Object\r\n     * @param object \r\n     */\r\n    removeMotionObject(object: BaseRender): void {\r\n        this._sceneManagerOBJ.removeMotionObject(object);\r\n    }\r\n\r\n    /**\r\n     * update All Motion Render Data\r\n     */\r\n    updateMotionObjects(): void {\r\n        this._sceneManagerOBJ.updateMotionObjects();\r\n    }\r\n\r\n    /**\r\n     * add motion Render Data\r\n     * @param object \r\n     */\r\n    addMotionObject(object: BaseRender): void {\r\n        this._sceneManagerOBJ.addMotionObject(object);\r\n    }\r\n\r\n    /**\r\n     * destroy\r\n     */\r\n    destroy(): void {\r\n        this._sceneManagerOBJ.destroy();\r\n    }\r\n\r\n}","import { SingletonList } from \"../../../utils/SingletonList\";\r\nimport { Ray } from \"../../math/Ray\";\r\nimport { UI3D } from \"./UI3D\";\r\n\r\nexport class UI3DManager {\r\n\r\n    _UI3Dlist: SingletonList<UI3D> = new SingletonList<UI3D>();\r\n\r\n    constructor() {\r\n    }\r\n\r\n    add(value: UI3D) {\r\n        this._UI3Dlist.add(value);\r\n    }\r\n\r\n    remove(value: UI3D) {\r\n        this._UI3Dlist.remove(value);\r\n    }\r\n\r\n    //\r\n    update() {\r\n        let elements = this._UI3Dlist.elements;\r\n        for (var i = 0, n = this._UI3Dlist.length; i < n; i++) {\r\n            elements[i]._submitRT();\r\n        }\r\n    }\r\n\r\n    /**\r\n     * \r\n     */\r\n    rayCast(ray: Ray): any {\r\n        let rayOri = ray.origin;\r\n        this._UI3Dlist.clean();\r\n        //sort\r\n        this._UI3Dlist.elements.sort(\r\n            (a: UI3D, b: UI3D) => {\r\n                return a._getCameraDistance(rayOri) - b._getCameraDistance(rayOri);\r\n            }\r\n        );\r\n        let elements = this._UI3Dlist.elements;\r\n        for (var i = 0, n = this._UI3Dlist.length; i < n; i++) {\r\n            let hit = elements[i]._checkUIPos(ray);\r\n            if (hit) {//\r\n                return hit;\r\n            }\r\n        }\r\n        return null;\r\n    }\r\n\r\n    /**\r\n     * Destroy\r\n     */\r\n    destory() {\r\n        this._UI3Dlist.destroy();\r\n    }\r\n}","import { SingletonList } from \"../../../../utils/SingletonList\";\r\nimport { IBoundsCell } from \"../../../math/IBoundsCell\";\r\nimport { BVHSpatialBox } from \"./BVHSpatialBox\";\r\n\r\n/**\r\n *    \r\n */\r\nexport class BVHSpatialManager {\r\n    /**@internal */\r\n    bvhManager: Map<number, BVHSpatialBox<IBoundsCell>>;\r\n\r\n    /**@internal */\r\n    cellCount: number = 0;\r\n\r\n    /**@internal */\r\n    updateBVHBoxList: SingletonList<BVHSpatialBox<IBoundsCell>>;\r\n\r\n    /**\r\n     * BVHSpatialManager\r\n     */\r\n    constructor() {\r\n        this.bvhManager = new Map();\r\n        this.updateBVHBoxList = new SingletonList<BVHSpatialBox<IBoundsCell>>();\r\n    }\r\n\r\n    /**\r\n     * clear\r\n     */\r\n    clear() {\r\n        this.cellCount = 0;\r\n        this.updateBVHBoxList.clear();\r\n    }\r\n\r\n    /**\r\n     * destroy\r\n     */\r\n    destroy() {\r\n        this.bvhManager = null;\r\n        this.updateBVHBoxList.destroy();\r\n    }\r\n}\r\n\r\n/**\r\n * BVHConfig\r\n */\r\nexport class BVHSpatialConfig {\r\n    /**@internal BVHcell*/\r\n    public max_SpatialCount = 7;\r\n    /**@internal BVH*/\r\n    public limit_size = 32;\r\n    /**@internal cellbuildBVH*/\r\n    public Min_BVH_Build_Nums = 10;\r\n}","import { Vector3 } from \"../../../../maths/Vector3\";\r\nimport { ICameraCullInfo } from \"../../../../RenderEngine/RenderInterface/RenderPipelineInterface/ICameraCullInfo\";\r\nimport { IShadowCullInfo } from \"../../../../RenderEngine/RenderInterface/RenderPipelineInterface/IShadowCullInfo\";\r\nimport { SingletonList } from \"../../../../utils/SingletonList\";\r\nimport { BoundFrustum } from \"../../../math/BoundFrustum\";\r\nimport { Bounds } from \"../../../math/Bounds\";\r\nimport { CollisionUtils } from \"../../../math/CollisionUtils\";\r\nimport { ContainmentType } from \"../../../math/ContainmentType\";\r\nimport { IBoundsCell } from \"../../../math/IBoundsCell\";\r\nimport { Plane } from \"../../../math/Plane\";\r\nimport { BVHSpatialConfig, BVHSpatialManager } from \"./SpatialManager\";\r\n\r\n/**\r\n * BVH\r\n */\r\nexport class BVHSpatialBox<T> {\r\n    private static _tempV3: Vector3 = new Vector3();\r\n    private static _tempV3_2: Vector3 = new Vector3();\r\n\r\n    /**\r\n     * \r\n     * @param box\r\n     * @param cullInfo \r\n     * @returns 0: 1 2\r\n     */\r\n    static sciContainsBox(box: Bounds, cullInfo: IShadowCullInfo) {\r\n        const p = BVHSpatialBox._tempV3;\r\n        const n = BVHSpatialBox._tempV3_2;\r\n        const boxMin = box.min;\r\n        const boxMax = box.max;\r\n        let result = ContainmentType.Contains;\r\n        for (let i = 0, nn = cullInfo.cullPlaneCount; i < nn; i++) {\r\n            const plane = cullInfo.cullPlanes[i];\r\n            const planeNor = plane.normal;\r\n\r\n            if (planeNor.x >= 0) {\r\n                p.x = boxMax.x;\r\n                n.x = boxMin.x;\r\n            } else {\r\n                p.x = boxMin.x;\r\n                n.x = boxMax.x;\r\n            }\r\n            if (planeNor.y >= 0) {\r\n                p.y = boxMax.y;\r\n                n.y = boxMin.y;\r\n            } else {\r\n                p.y = boxMin.y;\r\n                n.y = boxMax.y;\r\n            }\r\n            if (planeNor.z >= 0) {\r\n                p.z = boxMax.z;\r\n                n.z = boxMin.z;\r\n            } else {\r\n                p.z = boxMin.z;\r\n                n.z = boxMax.z;\r\n            }\r\n\r\n            if (CollisionUtils.intersectsPlaneAndPoint(plane, p) === Plane.PlaneIntersectionType_Back)\r\n                return ContainmentType.Disjoint;\r\n            if (CollisionUtils.intersectsPlaneAndPoint(plane, n) === Plane.PlaneIntersectionType_Back)\r\n                result = ContainmentType.Intersects;\r\n        }\r\n        return result;\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @param box \r\n     * @param cullInfo \r\n    */\r\n    static sciIntersectsBox(box: Bounds, cullInfo: IShadowCullInfo) {\r\n        const cullPlaneCount = cullInfo.cullPlaneCount;\r\n        const cullPlanes = cullInfo.cullPlanes;\r\n\r\n        const min: Vector3 = box.min;\r\n        const max: Vector3 = box.max;\r\n        const minX: number = min.x;\r\n        const minY: number = min.y;\r\n        const minZ: number = min.z;\r\n        const maxX: number = max.x;\r\n        const maxY: number = max.y;\r\n        const maxZ: number = max.z;\r\n\r\n        let pass: boolean = true;\r\n        for (let j = 0; j < cullPlaneCount; j++) {\r\n            const plane = cullPlanes[j];\r\n            const normal = plane.normal;\r\n            if (plane.distance + (normal.x * (normal.x < 0.0 ? minX : maxX)) + (normal.y * (normal.y < 0.0 ? minY : maxY)) + (normal.z * (normal.z < 0.0 ? minZ : maxZ)) < 0.0) {\r\n                pass = false;\r\n                break;\r\n            }\r\n        }\r\n        return pass;\r\n    }\r\n    /**@internal */\r\n    protected _bounds: Bounds;\r\n    /**@internal BVH */\r\n    protected _cellList: Array<IBoundsCell>;\r\n    /**@internal  */\r\n    protected _cellCount: number; //\r\n    /**@internal  */\r\n    protected _parent: BVHSpatialBox<T>; //\r\n    /**@internal  */\r\n    protected _children0: BVHSpatialBox<T>;\r\n    protected _children1: BVHSpatialBox<T>;\r\n    /**BVH */\r\n    protected _config: BVHSpatialConfig;\r\n    /**BVH */\r\n    protected _bvhmanager: BVHSpatialManager;\r\n    /**@internal  */\r\n    _boundchanged: boolean;\r\n\r\n    /**\r\n     * BVHSpaticalBox\r\n     * @param bvhmanager \r\n     * @param config \r\n     */\r\n    constructor(bvhmanager: BVHSpatialManager, config: BVHSpatialConfig) {\r\n        this._bounds = new Bounds(new Vector3(Number.MAX_VALUE, Number.MAX_VALUE, Number.MAX_VALUE), new Vector3(-Number.MAX_VALUE, -Number.MAX_VALUE, -Number.MAX_VALUE));\r\n        this._cellList = [];\r\n        this._cellCount = 0;\r\n        this._bvhmanager = bvhmanager;\r\n        this._config = config;\r\n    }\r\n\r\n    /**\r\n     * \r\n     */\r\n    set parent(value: BVHSpatialBox<IBoundsCell>) {\r\n        this._parent = value;\r\n    }\r\n\r\n    get parent() {\r\n        return this._parent;\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @param cell \r\n     * @returns \r\n     */\r\n    private _isRepeat(cell: IBoundsCell): boolean {\r\n        return (this._cellList.indexOf(cell) != -1);\r\n    }\r\n\r\n    /**\r\n     * add one cell to list\r\n     * @param cell \r\n     */\r\n    private _addOneCell(cell: IBoundsCell) {\r\n        this._cellList.push(cell);\r\n        this._cellCount++;\r\n        this._bvhmanager.bvhManager.set(cell.id, this);\r\n        this._bvhmanager.cellCount++;\r\n        // this._addBounds(cell);\r\n    }\r\n\r\n    /**\r\n     * remove one cell to list\r\n     * @param cell \r\n     * @returns \r\n     */\r\n    private _removeOneCell(cell: IBoundsCell) {\r\n        let index = this._cellList.indexOf(cell);\r\n        if (index == -1)\r\n            return false;\r\n        this._cellCount--;\r\n        this._cellList.splice(index, 1);\r\n        this._bvhmanager.bvhManager.delete(cell.id);\r\n        this._bvhmanager.cellCount--;\r\n        return true;\r\n    }\r\n\r\n    /**\r\n     * \r\n     * TODO bvhmanager\r\n     */\r\n    private _clearList() {\r\n        this._bvhmanager.cellCount -= this._cellCount;\r\n        this._cellCount = 0;\r\n        this._cellList = null;\r\n    }\r\n\r\n    /**\r\n     * Float\r\n     * @param x \r\n     * @param y \r\n     * @returns \r\n     */\r\n    private _isFloatMax(x: number, y: number) {\r\n        return x - y > 0.0001;//x>y \r\n    }\r\n\r\n    /**\r\n     * Box\r\n     */\r\n    private _isBoundsContainedBySpatialBox(cell: IBoundsCell) {\r\n        let cellMin = cell.bounds.getMin();\r\n        let cellMax = cell.bounds.getMax();\r\n        let boxMin = this._bounds.getMin();\r\n        let boxMax = this._bounds.getMax();\r\n        //cell box,\r\n        if (this._isFloatMax(cellMin.x, boxMin.x) && this._isFloatMax(cellMin.y, boxMin.y) && this._isFloatMax(cellMin.z, boxMin.z) &&\r\n            this._isFloatMax(boxMax.x, cellMax.x) && this._isFloatMax(boxMax.y, cellMax.y) && this._isFloatMax(boxMax.z, cellMax.z)) {\r\n            return false;\r\n        }\r\n        return true;\r\n    }\r\n\r\n    /**\r\n     * boxBounds\r\n     * @param cell \r\n     */\r\n    private _addBounds(cell: IBoundsCell) {\r\n        this._boundchanged = this._isBoundsContainedBySpatialBox(cell);\r\n    }\r\n\r\n    /**\r\n     * boxbounds\r\n     * @param cell \r\n     */\r\n    private _removeBounds(cell: IBoundsCell) {\r\n        this._boundchanged = this._isBoundsContainedBySpatialBox(cell);\r\n    }\r\n\r\n    /**\r\n     * list\r\n     * @returns \r\n     */\r\n    getList() {\r\n        return this._cellList;\r\n    }\r\n\r\n    /**\r\n     * child0\r\n     * @returns \r\n     */\r\n    getchild0() {\r\n        return this._children0;\r\n    }\r\n    /**\r\n     * child1\r\n     * @returns \r\n     */\r\n    getchild1() {\r\n        return this._children1;\r\n    }\r\n\r\n    /**\r\n     * fill one Cell\r\n     * add but dont Split immediately\r\n     */\r\n    fillCell(cell: IBoundsCell) {\r\n        if (this._isRepeat(cell)) {\r\n            return;\r\n        }\r\n        this._addOneCell(cell);\r\n        this._boundchanged = true;\r\n        this._bvhmanager.updateBVHBoxList.add(this);\r\n    }\r\n\r\n    /**\r\n     * fill remove one cell\r\n     * remove but dont split imediately\r\n     * @param cell \r\n     */\r\n    fillRemove(cell: IBoundsCell) {\r\n        if (!this._isRepeat(cell)) {\r\n            return;\r\n        }\r\n        this._removeOneCell(cell);\r\n        this._boundchanged = true;\r\n        this._bvhmanager.updateBVHBoxList.add(this);\r\n    }\r\n\r\n    /**\r\n     * add one Cell\r\n     * @param cell \r\n     * @returns \r\n     */\r\n    addCell(cell: IBoundsCell) {\r\n        if (this._isRepeat(cell)) {\r\n            return;\r\n        }\r\n        this._addOneCell(cell);\r\n        this._addBounds(cell);\r\n    }\r\n\r\n    /**\r\n     * remove one Cell\r\n     * @param cell \r\n     */\r\n    removeCell(cell: IBoundsCell) {\r\n        if (this._removeOneCell(cell)) {\r\n            this._removeBounds(cell);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * BVHBox\r\n     * @returns \r\n     */\r\n    splitBox() {\r\n        if (!this.isContentBox()) {\r\n            this._children0 && this._children0.splitBox();\r\n            this._children1 && this._children1.splitBox();\r\n            return;\r\n        }\r\n\r\n        let v1 = this._bounds.getExtent(); //\r\n\r\n        if ((this._config.max_SpatialCount > this._cellCount && this._config.limit_size >= 2 * Math.max(v1.x, v1.y, v1.z)) || this._cellCount <= 1)\r\n            return;\r\n\r\n        //sort\r\n        if (v1.x > v1.y && v1.x > v1.z)\r\n            this._cellList.sort((a: IBoundsCell, b: IBoundsCell) => {\r\n                if (a && b)\r\n                    return a.bounds.getCenter().x - b.bounds.getCenter().x;\r\n                else return 0;\r\n            }); //X\r\n        else if (v1.y > v1.x && v1.y > v1.z) //\r\n            this._cellList.sort((a: IBoundsCell, b: IBoundsCell) => {\r\n                if (a && b) return a.bounds.getCenter().y - b.bounds.getCenter().y;\r\n                else return 0;\r\n            }); //Y\r\n        else if (v1.z > v1.x && v1.z > v1.y) //\r\n            this._cellList.sort((a: IBoundsCell, b: IBoundsCell) => {\r\n                if (a && b) return a.bounds.getCenter().z - b.bounds.getCenter().z;\r\n                else return 0;\r\n            }); //Y\r\n        const mid = this._cellCount / 2 | 0; //\r\n\r\n        this._children0 = this._creatChildNode();\r\n        this._children0.parent = this;\r\n        for (let i = 0; i < mid; i++) { //\r\n            const cell = this._cellList[i];\r\n            this._children0.fillCell(cell);\r\n            Bounds.merge(this._children0._bounds, cell.bounds, this._children0._bounds);\r\n        }\r\n        this._children0._boundchanged = false;\r\n        this._children0.splitBox();\r\n\r\n        this._children1 = this._creatChildNode();\r\n        this._children1.parent = this;\r\n\r\n        for (let i = mid; i < this._cellCount; i++) { //\r\n            const cell = this._cellList[i];\r\n            this._children1.fillCell(cell);\r\n            Bounds.merge(this._children1._bounds, cell.bounds, this._children1._bounds);\r\n        }\r\n        this._children1._boundchanged = false;\r\n        this._children1.splitBox();\r\n\r\n        this._clearList();\r\n    }\r\n\r\n    /**\r\n     * Content BVHBox\r\n     * @param checkPos \r\n     * @returns \r\n     */\r\n    getNearlist(checkPos: Vector3): BVHSpatialBox<T> {\r\n        if (this.isContentBox())\r\n            return this;\r\n        else {\r\n            let v1 = this._children0._bounds.getCenter();\r\n            let v2 = this._children1._bounds.getCenter();\r\n            return Vector3.distanceSquared(v1, checkPos) < Vector3.distanceSquared(v2, checkPos) ? this._children0.getNearlist(checkPos) : this._children1.getNearlist(checkPos);\r\n        }\r\n\r\n    }\r\n\r\n    /**\r\n     * content\r\n     * @param out \r\n     * @param conditionalFun\r\n     */\r\n    traverseBoundsCell(out: SingletonList<IBoundsCell>, conditionalFun: Function = null) {\r\n        if (this.isContentBox()) {\r\n            if (!conditionalFun)\r\n                for (var i = 0; i < this._cellCount; i++) {\r\n                    out.add(this._cellList[i]);\r\n                }\r\n            else\r\n                for (var i = 0; i < this._cellCount; i++) {\r\n                    var node = this._cellList[i]\r\n                    conditionalFun(node) && out.add(node);\r\n                }\r\n        } else {\r\n            this._children0 && this._children0.traverseBoundsCell(out, conditionalFun);\r\n            this._children1 && this._children1.traverseBoundsCell(out, conditionalFun);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Override it\r\n     * @returns \r\n     */\r\n    protected _creatChildNode(): BVHSpatialBox<T> {\r\n        return new BVHSpatialBox<T>(this._bvhmanager, this._config);\r\n    }\r\n\r\n    /**\r\n     * CameraCull\r\n     * @override\r\n     * @param frustum \r\n     * @param out \r\n     */\r\n    getItemByCameraCullInfo(cameraCullInfo: ICameraCullInfo, out: SingletonList<IBoundsCell>) {\r\n        var frustum: BoundFrustum = cameraCullInfo.boundFrustum;\r\n        const result = frustum.containsBoundBox(this._bounds);\r\n        if (result == 1) //\r\n            this.traverseBoundsCell(out); //\r\n        else if (result == 2) { //\r\n            if (this.isContentBox()) {\r\n                for (let i = 0; i < this._cellList.length; i++) { //\r\n                    if (frustum.intersects(this._cellList[i].bounds))\r\n                        out.add(this._cellList[i]);\r\n                }\r\n            } else {\r\n                this._children0.getItemByCameraCullInfo(cameraCullInfo, out); //\r\n                this._children1.getItemByCameraCullInfo(cameraCullInfo, out); //\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @override\r\n     * @param frustum \r\n     * @param out \r\n     */\r\n    getItemByFrustum(frustum: BoundFrustum, out: SingletonList<IBoundsCell>) {\r\n        const result = frustum.containsBoundBox(this._bounds);\r\n        if (result == 1) //\r\n            this.traverseBoundsCell(out); //\r\n        else if (result == 2) { //\r\n            if (this.isContentBox()) {\r\n                for (let i = 0; i < this._cellList.length; i++) { //\r\n                    if (frustum.intersects(this._cellList[i].bounds))\r\n                        out.add(this._cellList[i]);\r\n                }\r\n            } else {\r\n                this._children0.getItemByFrustum(frustum, out); //\r\n                this._children1.getItemByFrustum(frustum, out); //\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @override \r\n     * @param sci\r\n     * @param out \r\n     */\r\n    getItemBySCI(sci: IShadowCullInfo, out: SingletonList<IBoundsCell>) {\r\n        const result = BVHSpatialBox.sciContainsBox(this._bounds, sci);\r\n        if (result == 1) { //\r\n            let fn = (data: IBoundsCell) => { return data.shadowCullPass() };\r\n            this.traverseBoundsCell(out, fn); //\r\n        }\r\n        else if (result == 2) { //\r\n            if (this.isContentBox()) {\r\n                for (let i = 0; i < this._cellList.length; i++) { //\r\n                    let render = this._cellList[i];\r\n                    let pass = render.shadowCullPass();\r\n                    if (pass && BVHSpatialBox.sciIntersectsBox(this._cellList[i].bounds, sci))\r\n                        out.add(this._cellList[i]);\r\n                }\r\n            } else {\r\n                this._children0.getItemBySCI(sci, out); //\r\n                this._children1.getItemBySCI(sci, out); //\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * \r\n     * null need Update by child\r\n     * contents need Update by List\r\n     */\r\n    recaculateBox() {\r\n        if (!!this._children0 && !!this._children1) {\r\n            Bounds.merge(this._children0._bounds, this._children1._bounds, this._bounds);\r\n        }\r\n        else if (this._cellList && this._cellList.length >= 1) {\r\n            this._cellList[0].bounds.cloneTo(this._bounds);\r\n            for (var i = 0, n = this._cellList.length; i < n; i++) {\r\n                Bounds.merge(this._cellList[i].bounds, this._bounds, this._bounds);\r\n            }\r\n        } else {\r\n            console.error(\"BVHSpatialBox is illegal\");\r\n        }\r\n        this.parent && this.parent.recaculateBox();\r\n        this._boundchanged = false;\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @returns \r\n     */\r\n    isRoot(): boolean {\r\n        return !this._parent;\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @returns \r\n     */\r\n    isContentBox(): boolean {\r\n        return this._cellCount != 0;\r\n    }\r\n\r\n    /**\r\n     * box\r\n     */\r\n    destroy() {\r\n        if (this.isContentBox()) {\r\n            this._cellList = null;\r\n        } else {\r\n            this._children0 && this._children0.destroy();\r\n            this._children1 && this._children1.destroy();\r\n            this._children0 = null;\r\n            this._children1 = null;\r\n        }\r\n        this._bounds = null;\r\n        this._config = null;\r\n        this._bvhmanager = null;\r\n    }\r\n\r\n}","import { ICameraCullInfo } from \"../../../../RenderEngine/RenderInterface/RenderPipelineInterface/ICameraCullInfo\";\r\nimport { IShadowCullInfo } from \"../../../../RenderEngine/RenderInterface/RenderPipelineInterface/IShadowCullInfo\";\r\nimport { SingletonList } from \"../../../../utils/SingletonList\";\r\nimport { BoundFrustum } from \"../../../math/BoundFrustum\";\r\nimport { IBoundsCell } from \"../../../math/IBoundsCell\";\r\nimport { BVHSpatialBox } from \"./BVHSpatialBox\";\r\nimport { BVHSpatialConfig, BVHSpatialManager } from \"./SpatialManager\";\r\n\r\n/**\r\n * BVH\r\n */\r\nexport class BVHSpatial {\r\n\r\n    /**@internal */\r\n    protected _BVHConfig: BVHSpatialConfig;\r\n\r\n    /**@internal */\r\n    protected _BVHManager: BVHSpatialManager;\r\n\r\n    /**@internal */\r\n    protected _BVHSpatialBox: BVHSpatialBox<IBoundsCell>;\r\n\r\n    /**@internal */\r\n    protected _isBuild: boolean = false;\r\n\r\n    /**\r\n     * Override it\r\n     * @returns \r\n     */\r\n    protected _creatChildNode(): BVHSpatialBox<IBoundsCell> {\r\n        return new BVHSpatialBox<IBoundsCell>(this._BVHManager, this._BVHConfig);\r\n    }\r\n\r\n    /**\r\n     * BVH\r\n     */\r\n    constructor(bvhConfig: BVHSpatialConfig = null, bvhManager: BVHSpatialManager = null) {\r\n        this._BVHConfig = bvhConfig ? bvhConfig : new BVHSpatialConfig();\r\n        this._BVHManager = bvhManager ? bvhManager : new BVHSpatialManager();\r\n        this._BVHSpatialBox = this._creatChildNode();\r\n    }\r\n\r\n    /**\r\n     * \r\n     */\r\n    get bvhSpatialBox(){\r\n        return this._BVHSpatialBox;\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @param cell \r\n     * @returns \r\n     */\r\n    cellLegal(cell: IBoundsCell): boolean {\r\n        let extend = cell.bounds.getExtent();\r\n        return this._BVHConfig.limit_size > (Math.max(extend.x, extend.y, extend.z) * 2);// too large is cant \r\n    }\r\n\r\n    /**\r\n     * add one\r\n     * @param cell \r\n     */\r\n    addOne(cell: IBoundsCell) {\r\n        if (!this.cellLegal(cell)) {\r\n            return false\r\n        }\r\n        if (this._isBuild) {\r\n            let spatial = this._BVHSpatialBox.getNearlist(cell.bounds.getCenter());\r\n            spatial.addCell(cell);\r\n            this._BVHManager.updateBVHBoxList.add(spatial);\r\n        } else {\r\n            this._BVHSpatialBox.fillCell(cell);\r\n        }\r\n        return true;\r\n    }\r\n\r\n    /**\r\n     * remove one\r\n     * @param cell \r\n     * @returns \r\n     */\r\n    removeOne(cell: IBoundsCell) {\r\n        if (!this._BVHManager.bvhManager.has(cell.id)) {\r\n            return false;\r\n        }\r\n        if (this._isBuild) {\r\n            let spatial = this._BVHManager.bvhManager.get(cell.id);\r\n            spatial.removeCell(cell);\r\n            this._BVHManager.updateBVHBoxList.add(spatial);\r\n        } else {\r\n            this._BVHSpatialBox.fillRemove(cell);\r\n        }\r\n        return true;\r\n    }\r\n\r\n    /**\r\n     * remove\r\n     * @param cell \r\n     */\r\n    motionOne(cell: IBoundsCell) {\r\n        if (this._BVHSpatialBox.getNearlist(cell.bounds.getCenter()) == this._BVHManager.bvhManager.get(cell.id)) {\r\n            return;\r\n        } else {\r\n            this.removeOne(cell);\r\n            this.addOne(cell);\r\n        }\r\n\r\n    }\r\n\r\n    /**\r\n    * CameraCull\r\n    * @override\r\n    * @param frustum \r\n    * @param out \r\n    */\r\n    getItemByCameraCullInfo(cameraCullInfo: ICameraCullInfo, out: SingletonList<IBoundsCell>) {\r\n        if (this._BVHManager.updateBVHBoxList.length > 0) {\r\n            this.update();\r\n        }\r\n        if (this._isBuild) {\r\n            this._BVHSpatialBox.getItemByCameraCullInfo(cameraCullInfo, out);\r\n        } else {\r\n            this._BVHSpatialBox.traverseBoundsCell(out);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @override\r\n     * @param frustum \r\n     * @param out \r\n     */\r\n    getItemByFrustum(frustum: BoundFrustum, out: SingletonList<IBoundsCell>) {\r\n        if (this._BVHManager.updateBVHBoxList.length > 0) {\r\n            this.update();\r\n        }\r\n        if (this._isBuild) {\r\n            this._BVHSpatialBox.getItemByFrustum(frustum, out);\r\n        } else {\r\n            this._BVHSpatialBox.traverseBoundsCell(out);\r\n        }\r\n\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @override \r\n     * @param sci\r\n     * @param out \r\n     */\r\n    getItemBySCI(sci: IShadowCullInfo, out: SingletonList<IBoundsCell>) {\r\n        if (this._BVHManager.updateBVHBoxList.length > 0) {\r\n            this.update();\r\n        }\r\n        if (this._isBuild) {\r\n            this._BVHSpatialBox.getItemBySCI(sci, out);\r\n        } else {\r\n            this._BVHSpatialBox.traverseBoundsCell(out,(data:IBoundsCell)=>{return data.shadowCullPass()});\r\n        }\r\n    }\r\n\r\n    /**\r\n     * \r\n     */\r\n    update() {\r\n        if (!this._isBuild) {//first build\r\n            if (this._BVHManager.cellCount > this._BVHConfig.Min_BVH_Build_Nums) {\r\n                this._BVHSpatialBox.recaculateBox();\r\n                this._BVHSpatialBox.splitBox();//build\r\n                this._BVHManager.updateBVHBoxList.remove(this._BVHSpatialBox);\r\n                this._isBuild = true;\r\n            }\r\n            this._BVHManager.updateBVHBoxList.length = 0;\r\n        } else {\r\n            let list = this._BVHManager.updateBVHBoxList;\r\n            for (let i = 0, n = list.length; i < n; i++) {\r\n                let spatial = list.elements[i];\r\n                spatial._boundchanged && spatial.recaculateBox();\r\n                spatial.splitBox();\r\n            }\r\n            list.length = 0;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * rebuild\r\n     */\r\n    rebuild() {\r\n        if (this._isBuild) {//reBuild\r\n            let out = new SingletonList<IBoundsCell>();\r\n            this._BVHSpatialBox.traverseBoundsCell(out);\r\n            this._BVHSpatialBox.destroy();\r\n            this._BVHManager.clear();\r\n            this._isBuild = false;\r\n            this._BVHSpatialBox = this._creatChildNode();\r\n            for (let i = 0, n = out.length; i < n; i++) {\r\n                this.addOne(out.elements[i]);\r\n            }\r\n            this._BVHSpatialBox.recaculateBox();\r\n            this._BVHSpatialBox.splitBox();//build\r\n        }\r\n    }\r\n\r\n    /**\r\n     * destroy\r\n     */\r\n    destroy() {\r\n        this._BVHSpatialBox.destroy();\r\n        this._BVHManager.destroy();\r\n    }\r\n}","import { ICameraCullInfo } from \"../../../../RenderEngine/RenderInterface/RenderPipelineInterface/ICameraCullInfo\";\r\nimport { IShadowCullInfo } from \"../../../../RenderEngine/RenderInterface/RenderPipelineInterface/IShadowCullInfo\";\r\nimport { SingletonList } from \"../../../../utils/SingletonList\";\r\nimport { Stat } from \"../../../../utils/Stat\";\r\nimport { FrustumCulling } from \"../../../graphics/FrustumCulling\";\r\nimport { BoundFrustum } from \"../../../math/BoundFrustum\";\r\nimport { BaseRender } from \"../../render/BaseRender\";\r\nimport { RenderContext3D } from \"../../render/RenderContext3D\";\r\nimport { BVHSpatialBox } from \"../bvh/BVHSpatialBox\";\r\n\r\nexport class BVHRenderBox<T> extends BVHSpatialBox<T>{\r\n\r\n    /**@internal BVH */\r\n    protected _cellList: Array<BaseRender>;\r\n\r\n    /**\r\n     * Override it\r\n     * @returns \r\n     */\r\n    protected _creatChildNode(): BVHSpatialBox<T> {\r\n        return new BVHRenderBox<BaseRender>(this._bvhmanager, this._config);\r\n    }\r\n\r\n    /**\r\n     * CameraCull\r\n     * @override\r\n     * @param frustum \r\n     * @param out \r\n     */\r\n    getItemByCameraCullInfo(cameraCullInfo: ICameraCullInfo, out: SingletonList<BaseRender>) {\r\n        var frustum: BoundFrustum = cameraCullInfo.boundFrustum;\r\n        const result = frustum.containsBoundBox(this._bounds);\r\n        if (result == 1) {\r\n            this.traverseBoundsCell(out); //\r\n            Stat.frustumCulling++;\r\n        } //\r\n        else if (result == 2) { //\r\n            if (this.isContentBox()) {\r\n                var cullMask: number = cameraCullInfo.cullingMask;\r\n                let staticMask = cameraCullInfo.staticMask;\r\n                let context = RenderContext3D._instance;\r\n                for (let i = 0; i < this._cellList.length; i++) { //\r\n                    var canPass: boolean;\r\n                    let render = this._cellList[i]\r\n                    canPass = ((1 << render.renderNode.layer) & cullMask) != 0 && render._enabled && (render.renderbitFlag == 0);\r\n                    canPass = canPass && ((render.renderNode.staticMask & staticMask) != 0);\r\n                    if (canPass) {\r\n                        Stat.frustumCulling++;\r\n                        if (!cameraCullInfo.useOcclusionCulling || render._needRender(frustum, context)) {\r\n                            out.add(render);\r\n                        }\r\n                    }\r\n                }\r\n            } else {\r\n                this._children0.getItemByCameraCullInfo(cameraCullInfo, out); //\r\n                this._children1.getItemByCameraCullInfo(cameraCullInfo, out); //\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n    * \r\n    * @override\r\n    * @param sci\r\n    * @param out \r\n    */\r\n    getItemBySCI(sci: IShadowCullInfo, out: SingletonList<BaseRender>) {\r\n        const result = BVHSpatialBox.sciContainsBox(this._bounds, sci);\r\n        if (result == 1) //\r\n            this.traverseBoundsCell(out); //\r\n        else if (result == 2) { //\r\n            if (this.isContentBox()) {\r\n                for (let i = 0; i < this._cellList.length; i++) { //\r\n                    var render = this._cellList[i];\r\n                    var canPass = render.shadowCullPass();\r\n                    if (canPass) {\r\n                        Stat.frustumCulling++;\r\n                        let pass = FrustumCulling.cullingRenderBounds(render.bounds, sci);\r\n                        pass && out.add(render);\r\n                    }\r\n                    // if (BVHSpatialBox.sciIntersectsBox(this._cellList[i].bounds, sci))\r\n                    //     out.add(this._cellList[i]);\r\n                }\r\n            } else {\r\n                this._children0.getItemBySCI(sci, out); //\r\n                this._children1.getItemBySCI(sci, out); //\r\n            }\r\n        }\r\n    }\r\n\r\n}","import { BaseRender } from \"../../render/BaseRender\";\r\nimport { StaticFlag } from \"../../Sprite3D\";\r\nimport { BVHSpatial } from \"../bvh/BVHSpatial\";\r\nimport { BVHRenderBox } from \"./BVHRenderSpatialBox\";\r\n\r\nexport class BVHRenderSpatial extends BVHSpatial {\r\n    /**\r\n     * Override it\r\n     * @returns \r\n     */\r\n    protected _creatChildNode(): BVHRenderBox<BaseRender> {\r\n        return new BVHRenderBox<BaseRender>(this._BVHManager, this._BVHConfig);\r\n    }\r\n    \r\n    /**\r\n     * \r\n     * @param cell \r\n     * @returns \r\n     */\r\n    cellLegal(cell: BaseRender): boolean {\r\n        if (cell.renderNode.staticMask == StaticFlag.StaticBatch&&super.cellLegal(cell))\r\n            return true;\r\n        return false;\r\n    }\r\n}","import { ISceneRenderManager } from \"../../../../RenderEngine/RenderInterface/RenderPipelineInterface/ISceneRenderManager\";\r\nimport { SingletonList } from \"../../../../utils/SingletonList\";\r\nimport { BaseRender } from \"../../render/BaseRender\";\r\nimport { BVHSpatialConfig } from \"../bvh/SpatialManager\";\r\nimport { SceneRenderManager } from \"../SceneRenderManager\";\r\nimport { BVHRenderSpatial } from \"./BVHRenderSpatial\";\r\n\r\nexport class BVHSceneRenderManager extends SceneRenderManager {\r\n    /**@internal */\r\n    protected _sceneManagerOBJ: ISceneRenderManager;\r\n    /**@internal */\r\n    private _bvhRenderSpatial: BVHRenderSpatial;\r\n\r\n    private _allRenderList:SingletonList<BaseRender>;\r\n\r\n    /**\r\n     * \r\n     */\r\n    constructor(bvhConfig:BVHSpatialConfig = null) {\r\n        super();\r\n        this._bvhRenderSpatial = new BVHRenderSpatial(bvhConfig);\r\n        this._allRenderList = new SingletonList<BaseRender>();\r\n    }\r\n\r\n    /**\r\n    * get RenderList\r\n    */\r\n    get list(): SingletonList<BaseRender> {\r\n        return this._allRenderList;\r\n    }\r\n\r\n    set list(value: SingletonList<BaseRender>) {\r\n        for(let i = 0,n = value.length;i<n;i++){\r\n            let render = value.elements[i];\r\n            this.addRenderObject(render);\r\n        }\r\n    }\r\n\r\n    get bvhSpatial(){\r\n        return this._bvhRenderSpatial;\r\n    }\r\n\r\n    get otherList(){\r\n        return this._sceneManagerOBJ.list;\r\n    }\r\n\r\n    /**\r\n     * add Render Node\r\n     * @param object \r\n     */\r\n    addRenderObject(object: BaseRender): void {\r\n        if (!this._bvhRenderSpatial.addOne(object)) {\r\n            this._sceneManagerOBJ.addRenderObject(object);\r\n        }\r\n        this._allRenderList.add(object);\r\n    }\r\n\r\n    /**\r\n     * remove Render Node\r\n     * @param object \r\n     */\r\n    removeRenderObject(object: BaseRender): void {\r\n        if (!this._bvhRenderSpatial.removeOne(object))\r\n            this._sceneManagerOBJ.removeRenderObject(object);\r\n        this._allRenderList.remove(object);\r\n    }\r\n\r\n    /**\r\n     * remove motion Object\r\n     * @param object \r\n     */\r\n    removeMotionObject(object: BaseRender): void {\r\n        this._sceneManagerOBJ.removeMotionObject(object);\r\n    }\r\n\r\n    /**\r\n     * update All Motion Render Data\r\n     */\r\n    updateMotionObjects(): void {\r\n        this._bvhRenderSpatial.update();\r\n        this._sceneManagerOBJ.updateMotionObjects();\r\n\r\n    }\r\n\r\n    /**\r\n     * add motion Render Data\r\n     * @param object \r\n     */\r\n    addMotionObject(object: BaseRender): void {\r\n        if (this._bvhRenderSpatial.cellLegal(object)) {\r\n            this._bvhRenderSpatial.motionOne(object);\r\n        } else {\r\n            this._sceneManagerOBJ.addMotionObject(object);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * destroy\r\n     */\r\n    destroy(): void {\r\n        this._sceneManagerOBJ.destroy();\r\n        this._bvhRenderSpatial.destroy();\r\n        this._allRenderList .destroy();\r\n    }\r\n}","import { Vector3 } from \"../../../maths/Vector3\";\r\nimport { ICameraCullInfo } from \"../../../RenderEngine/RenderInterface/RenderPipelineInterface/ICameraCullInfo\";\r\nimport { ICullPass } from \"../../../RenderEngine/RenderInterface/RenderPipelineInterface/ICullPass\";\r\nimport { ISceneRenderManager } from \"../../../RenderEngine/RenderInterface/RenderPipelineInterface/ISceneRenderManager\";\r\nimport { IShadowCullInfo } from \"../../../RenderEngine/RenderInterface/RenderPipelineInterface/IShadowCullInfo\";\r\nimport { FastSinglelist } from \"../../../utils/SingletonList\";\r\nimport { Stat } from \"../../../utils/Stat\";\r\nimport { BaseRender } from \"../../core/render/BaseRender\";\r\nimport { RenderContext3D } from \"../../core/render/RenderContext3D\";\r\nimport { FrustumCulling } from \"../../graphics/FrustumCulling\";\r\nimport { BoundFrustum } from \"../../math/BoundFrustum\";\r\n\r\n\r\nexport class CullPassBase implements ICullPass {\r\n    protected _cullList: FastSinglelist<BaseRender> = new FastSinglelist();\r\n\r\n    get cullList(): FastSinglelist<BaseRender> {\r\n        return this._cullList;\r\n    }\r\n\r\n    /**\r\n     * TODO\r\n\t * \r\n\t * @param context \r\n\t * @param render \r\n\t * @returns \r\n\t */\r\n\tstatic cullDistanceVolume(context:RenderContext3D,render:BaseRender):boolean{\r\n\t\tlet camera = context.camera;\r\n\t\tif(!camera||!camera.transform) return false;\r\n\t\tlet bound = render.bounds;\r\n\t\tlet center = bound.getCenter();\r\n\t\tlet exten = bound.getExtent();\r\n\t\tlet dis:number = Vector3.distance(camera.transform.position,center);\r\n\t\tlet volum:number = Math.max(exten.x,exten.y,exten.z);\r\n\t\tif(volum/dis<render._ratioIgnor){\r\n\t\t\treturn false;\r\n\t\t}\r\n\t\treturn true;\r\n\t}\r\n\r\n    cullByCameraCullInfo(cameraCullInfo: ICameraCullInfo, renderManager: ISceneRenderManager): void {\r\n        this._cullList.length = 0;\r\n        var renders = renderManager.list.elements;\r\n        var boundFrustum: BoundFrustum = cameraCullInfo.boundFrustum;\r\n        var cullMask: number = cameraCullInfo.cullingMask;\r\n        let staticMask = cameraCullInfo.staticMask;\r\n        let context = RenderContext3D._instance;\r\n        for (var i: number = 0, n: number = renderManager.list.length; i < n; i++) {\r\n            var render = renders[i];\r\n            var canPass: boolean;\r\n            canPass = ((1 << render.renderNode.layer) & cullMask) != 0 && render._enabled && (render.renderbitFlag == 0);\r\n            canPass = canPass && (( render.renderNode.staticMask & staticMask) != 0);\r\n            if (canPass) {\r\n                Stat.frustumCulling++;\r\n                if (!cameraCullInfo.useOcclusionCulling || render._needRender(boundFrustum, context)) {\r\n                    this.cullList.add(render);\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    cullByShadowCullInfo(cullInfo: IShadowCullInfo, renderManager: ISceneRenderManager): void {\r\n        this._cullList.length = 0;\r\n        var renderList = renderManager.list;\r\n        var renders = renderList.elements;\r\n        for (var i: number = 0, n: number = renderList.length; i < n; i++) {\r\n            var render = renders[i];\r\n            var canPass: boolean = render.shadowCullPass();\r\n            if (canPass) {\r\n                Stat.frustumCulling++;\r\n                let pass = FrustumCulling.cullingRenderBounds(render.bounds, cullInfo);\r\n                pass && this._cullList.add(render);\r\n                // if (pass) {\r\n                // \trender.distanceForSort = Vector3.distance(render.bounds.getCenter(), position);//TODO:,\r\n                // \tvar elements: RenderElement[] = render._renderElements;\r\n                // \tfor (var j: number = 0, m: number = elements.length; j < m; j++)\r\n                // \t\telements[j]._update(scene, context, null, null);\r\n                // }\r\n            }\r\n        }\r\n    }\r\n    cullingSpotShadow(cameraCullInfo: ICameraCullInfo, renderManager: ISceneRenderManager): void {\r\n        this._cullList.length = 0;\r\n        let renders = renderManager.list.elements;\r\n        let boundFrustum: BoundFrustum = cameraCullInfo.boundFrustum;\r\n        let context = RenderContext3D._instance;\r\n        for (let i = 0, n = renderManager.list.length; i < n; i++) {\r\n            let render = renders[i];\r\n            let canPass: boolean = render.castShadow && render._enabled && (render.renderbitFlag == 0);\r\n            if (canPass) {\r\n                Stat.frustumCulling++;\r\n                if (render._needRender(boundFrustum, context))\r\n                    this._cullList.add(render);\r\n            }\r\n        }\r\n    }\r\n\r\n}","import { ICameraCullInfo } from \"../../../../RenderEngine/RenderInterface/RenderPipelineInterface/ICameraCullInfo\";\r\nimport { ISceneRenderManager } from \"../../../../RenderEngine/RenderInterface/RenderPipelineInterface/ISceneRenderManager\";\r\nimport { IShadowCullInfo } from \"../../../../RenderEngine/RenderInterface/RenderPipelineInterface/IShadowCullInfo\";\r\nimport { SingletonList } from \"../../../../utils/SingletonList\";\r\nimport { Stat } from \"../../../../utils/Stat\";\r\nimport { FrustumCulling } from \"../../../graphics/FrustumCulling\";\r\nimport { BoundFrustum } from \"../../../math/BoundFrustum\";\r\nimport { CullPassBase } from \"../../../RenderObjs/RenderObj/CullPass\";\r\nimport { BaseRender } from \"../../render/BaseRender\";\r\nimport { RenderContext3D } from \"../../render/RenderContext3D\";\r\nimport { BVHSceneRenderManager } from \"./BVHSceneRenderManager\";\r\n\r\n/**\r\n * BVHPass\r\n */\r\nexport class BVHCullPass extends CullPassBase {\r\n    protected _cullList: SingletonList<BaseRender> = new SingletonList();\r\n    /**\r\n     * \r\n     */\r\n    get cullList(): SingletonList<BaseRender> {\r\n        return this._cullList;\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @param cameraCullInfo \r\n     * @param renderManager \r\n     */\r\n    cullByCameraCullInfo(cameraCullInfo: ICameraCullInfo, renderManager: BVHSceneRenderManager): void {\r\n        this._cullList.length = 0;\r\n        //BVH\r\n        renderManager.bvhSpatial.getItemByCameraCullInfo(cameraCullInfo,this._cullList);\r\n        //Dynamic\r\n        var renderList = renderManager.otherList;\r\n        var renders = renderList.elements;\r\n        var boundFrustum: BoundFrustum = cameraCullInfo.boundFrustum;\r\n        var cullMask: number = cameraCullInfo.cullingMask;\r\n        let staticMask = cameraCullInfo.staticMask;\r\n        let context = RenderContext3D._instance;\r\n        for (var i: number = 0, n: number = renderList.length; i < n; i++) {\r\n            var render = renders[i];\r\n            var canPass: boolean;\r\n            canPass = ((1 << render.renderNode.layer) & cullMask) != 0 && render._enabled && (render.renderbitFlag == 0);\r\n            canPass = canPass && ((render.renderNode.staticMask & staticMask) != 0);\r\n            if (canPass) {\r\n                Stat.frustumCulling++;\r\n                if (!cameraCullInfo.useOcclusionCulling || render._needRender(boundFrustum, context)) {\r\n                    this.cullList.add(render);\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @param cullInfo \r\n     * @param renderManager \r\n     */\r\n    cullByShadowCullInfo(cullInfo: IShadowCullInfo, renderManager: BVHSceneRenderManager): void {\r\n        this._cullList.length = 0;\r\n        //BVH\r\n        renderManager.bvhSpatial.getItemBySCI(cullInfo,this._cullList);\r\n        //Dynamic\r\n        var renderList = renderManager.otherList;\r\n        var renders = renderList.elements;\r\n        for (var i: number = 0, n: number = renderList.length; i < n; i++) {\r\n            var render = renders[i];\r\n            var canPass: boolean = render.castShadow && render._enabled && (render.renderbitFlag == 0);\r\n            if (canPass) {\r\n                Stat.frustumCulling++;\r\n                let pass = FrustumCulling.cullingRenderBounds(render.bounds, cullInfo);\r\n                pass && this._cullList.add(render);\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Spot\r\n     * @param cameraCullInfo \r\n     * @param renderManager \r\n     */\r\n    cullingSpotShadow(cameraCullInfo: ICameraCullInfo, renderManager: ISceneRenderManager): void {\r\n        //TODO\r\n    }\r\n} ","import { Camera } from \"../Camera\"\r\nimport { CommandBuffer } from \"./command/CommandBuffer\"\r\nimport { ShaderData } from \"../../../RenderEngine/RenderShader/ShaderData\";\r\nimport { RenderTargetFormat } from \"../../../RenderEngine/RenderEnum/RenderTargetFormat\";\r\nimport { RenderTexture } from \"../../../resource/RenderTexture\";\r\n\r\n/**\r\n * * <code>PostProcessRenderContext</code> \r\n */\r\nexport class PostProcessRenderContext {\r\n\t/** origan RenderTexture RT,RT*/\r\n\tsource: RenderTexture | null = null;\r\n\t/** forward effect target */\r\n\tindirectTarget:RenderTexture|null = null;\r\n\t/** dest RenderTexture RT*/\r\n\tdestination: RenderTexture | null = null;\r\n\t/** */\r\n\tcamera: Camera | null = null;\r\n\t/** */\r\n\tcompositeShaderData: ShaderData | null = null;\r\n\t/** */\r\n\tcommand: CommandBuffer | null = null;\r\n\t/** ,RT*/\r\n\tdeferredReleaseTextures: RenderTexture[] = [];\r\n\r\n\t/**\r\n\t * RTRT \r\n\t */\r\n\tcreateRTByContextReleaseTexture(width: number, height: number, colorFormat: RenderTargetFormat, depthFormat: RenderTargetFormat, mipmap: boolean = false, multiSamples: number = 1, depthTexture: boolean = false, sRGB: boolean = false){\r\n\t\tlet n =this.deferredReleaseTextures.length\r\n\t\tfor (let index = 0; index <n ; index++) {\r\n            let rt = this.deferredReleaseTextures[index];\r\n            if (rt.width == width && rt.height == height && rt.colorFormat == colorFormat && rt.depthStencilFormat == depthFormat && rt._generateMipmap == mipmap && rt.multiSamples == multiSamples && rt.generateDepthTexture == depthTexture && rt._gammaSpace == sRGB) {\r\n                rt._inPool = false;\r\n                let end = this.deferredReleaseTextures[n - 1];\r\n                this.deferredReleaseTextures[index] = end;\r\n                this.deferredReleaseTextures.length -= 1;\r\n                return rt;\r\n            }\r\n        }\r\n\t\treturn null;\r\n\t}\r\n\r\n}\r\n\r\n\r\n","import { PostProcess } from \"../../component/PostProcess\";\r\nimport { PostProcessRenderContext } from \"./PostProcessRenderContext\";\r\n/**\r\n\t * <code>PostProcessEffect</code> \r\n\t */\r\nexport class PostProcessEffect {\r\n\r\n\t/**@internal */\r\n\tprotected _active:boolean;\r\n\t/**@internal */\r\n\tprotected _singleton:boolean;\r\n\r\n\t/**\r\n\t *  <code>PostProcessEffect</code> \r\n\t */\r\n\tconstructor() {\r\n\t\tthis._active = true;\r\n\t\tthis._singleton = true;\r\n\t}\r\n\r\n\t/**\r\n\t * @internal\r\n\t */\r\n\tset singleton(value:boolean){\r\n\t\tthis._singleton = value;\r\n\t}\r\n\r\n\tget singleton(){\r\n\t\treturn this._singleton;\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t */\r\n\tget active(){\r\n\t\treturn this._active;\r\n\t}\r\n\r\n\tset active(value:boolean){\r\n\t\tthis._active = value;\r\n\t}\r\n\r\n\t/**\r\n\t * cameraDepthTextureMode\r\n\t * @inheritDoc\r\n\t * @override\r\n\t * @returns \r\n\t */\r\n\tgetCameraDepthTextureModeFlag() {\r\n\t\treturn 0;\r\n\t}\r\n\r\n\t/**\r\n\t * ,\r\n\t * @inheritDoc\r\n\t * @override\r\n\t */\r\n\teffectInit(postprocess:PostProcess) {\r\n\t\treturn;\r\n\t}\r\n\r\n\t/**\r\n\t * Effect\r\n\t * @inheritDoc\r\n\t * @override\r\n\t */\r\n\trelease(postprocess:PostProcess){\r\n\t\t\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t * @internal\r\n\t */\r\n\trender(context: PostProcessRenderContext): void {\r\n\r\n\t}\r\n}\r\n\r\n\r\n","#define SHADER_NAME BlitVS\r\n\r\nvarying vec2 v_Texcoord0;\r\n\r\nvoid main()\r\n{\r\n    gl_Position = vec4(u_OffsetScale.x * 2.0 - 1.0 + (a_PositionTexcoord.x + 1.0) * u_OffsetScale.z, (1.0 - ((u_OffsetScale.y * 2.0 - 1.0 + (-a_PositionTexcoord.y + 1.0) * u_OffsetScale.w) + 1.0) / 2.0) * 2.0 - 1.0, 0.0, 1.0);\r\n\r\n    v_Texcoord0 = a_PositionTexcoord.zw;\r\n}","import { Vector3 } from \"../../../../maths/Vector3\";\r\nimport { Vector4 } from \"../../../../maths/Vector4\";\r\nimport { FilterMode } from \"../../../../RenderEngine/RenderEnum/FilterMode\";\r\nimport { RenderTargetFormat } from \"../../../../RenderEngine/RenderEnum/RenderTargetFormat\";\r\nimport { WrapMode } from \"../../../../RenderEngine/RenderEnum/WrapMode\";\r\nimport { Shader3D, ShaderFeatureType } from \"../../../../RenderEngine/RenderShader/Shader3D\";\r\nimport { ShaderData, ShaderDataType } from \"../../../../RenderEngine/RenderShader/ShaderData\";\r\nimport { ShaderDefine } from \"../../../../RenderEngine/RenderShader/ShaderDefine\";\r\nimport { SubShader } from \"../../../../RenderEngine/RenderShader/SubShader\";\r\nimport { VertexMesh } from \"../../../../RenderEngine/RenderShader/VertexMesh\";\r\nimport { RenderTexture } from \"../../../../resource/RenderTexture\";\r\nimport { Material } from \"../../../../resource/Material\";\r\nimport { CommandBuffer } from \"../command/CommandBuffer\";\r\nimport { PostProcessEffect } from \"../PostProcessEffect\";\r\nimport { PostProcessRenderContext } from \"../PostProcessRenderContext\";\r\nimport BlitVS from \"../../../../d3/shader/postprocess/BlitScreen.vs\";\r\nimport BlitLUTShader from \"../../../../d3/shader/postprocess/BlitLUTScreen.fs\";\r\nimport { RenderState } from \"../../../../RenderEngine/RenderShader/RenderState\";\r\nimport { Texture2D } from \"../../../../resource/Texture2D\";\r\nimport { RenderContext3D } from \"../RenderContext3D\";\r\nimport { Color } from \"../../../../maths/Color\";\r\nimport { PostProcess } from \"../../../component/PostProcess\";\r\nimport { LayaGL } from \"../../../../layagl/LayaGL\";\r\n\r\nexport enum ToneMappingType {\r\n\tNone,\r\n\tACES\r\n}\r\n\r\n/**\r\n * <code>ColorGradEffect</code> Effect\r\n */\r\nexport class ColorGradEffect extends PostProcessEffect {\r\n\tstatic SHADERDEFINE_ACES: ShaderDefine;\r\n\tstatic SHADERDEFINE_CUSTOMLUT: ShaderDefine;\r\n\r\n\tstatic SHADERVALUE_LUT: number;\r\n\tstatic SHADERVALUE_LUTPARAMS: number;\r\n\tstatic SHADERVALUE_CUSTOMLUT: number;\r\n\tstatic SHADERVALUE_CUSTOMLUTPARAMS: number;\r\n\r\n\t/**\r\n\t * bloom resource init\r\n\t */\r\n\tstatic init() {\r\n\t\tColorGradEffect.__initDefine__();\r\n\t\tlet attributeMap: { [name: string]: [number, ShaderDataType] } = {\r\n\t\t\t\"a_PositionTexcoord\": [VertexMesh.MESH_POSITION0, ShaderDataType.Vector4]\r\n\t\t};\r\n\r\n\t\tlet uniformMap = {\r\n\t\t\t\"u_OffsetScale\": ShaderDataType.Vector4,\r\n\t\t\t\"u_MainTex\": ShaderDataType.Texture2D,\r\n\t\t\t\"u_MainTex_TexelSize\": ShaderDataType.Vector4, //x:width,y:height,z:1/width,w:1/height\r\n\t\t};\r\n\t\tlet shader = Shader3D.add(\"blitLUTShader\");\r\n\t\tshader.shaderType = ShaderFeatureType.PostProcess;\r\n\t\tlet subShader = new SubShader(attributeMap, uniformMap);\r\n\t\tshader.addSubShader(subShader);\r\n\t\tlet pass = subShader.addShaderPass(BlitVS, BlitLUTShader);\r\n\t\tpass.renderState.depthTest = RenderState.DEPTHTEST_ALWAYS;\r\n\t\tpass.renderState.depthWrite = false;\r\n\t\tpass.renderState.cull = RenderState.CULL_NONE;\r\n\t\tpass.renderState.blend = RenderState.BLEND_DISABLE;\r\n\t}\r\n\r\n\tstatic __initDefine__() {\r\n\t\tColorGradEffect.SHADERDEFINE_ACES = Shader3D.getDefineByName(\"ACES\");\r\n\t\tColorGradEffect.SHADERDEFINE_CUSTOMLUT = Shader3D.getDefineByName(\"CUSTOMLUT\");\r\n\r\n\r\n\t\tColorGradEffect.SHADERVALUE_LUT = Shader3D.propertyNameToID(\"u_Lut\");\r\n\t\tColorGradEffect.SHADERVALUE_LUTPARAMS = Shader3D.propertyNameToID(\"u_LutParams\");\r\n\t\tColorGradEffect.SHADERVALUE_CUSTOMLUT = Shader3D.propertyNameToID(\"u_CustomLut\");\r\n\t\tColorGradEffect.SHADERVALUE_CUSTOMLUTPARAMS = Shader3D.propertyNameToID(\"u_CustomLutParams\");\r\n\t}\r\n\r\n\tprivate _needBuildLUT: boolean = false;\r\n\r\n\tprivate _lutCommond: CommandBuffer;\r\n\t_lutTex: RenderTexture;\r\n\tprivate _lutBuilderMat = new Material();\r\n\r\n\r\n\tprivate _LUTShader: Shader3D;\r\n\tprivate _lutShaderData: ShaderData;\r\n\tprivate _blitlutParams: Vector4;\r\n\r\n\t/**color Tone */\r\n\t/**@internal */\r\n\tprivate _toneMapping: ToneMappingType;\r\n\t/**@internal lut height size */\r\n\tprivate _lutSize = 32;\r\n\r\n\t// split toning\r\n\t/**@internal */\r\n\tprivate _enableSplitTone: boolean = false;\r\n\tprivate _splitShadow: Vector3 = new Vector3(0.5, 0.5, 0.5);\r\n\tprivate _splitBalance: number = 0;//-1-1\r\n\tprivate _splithighlights: Vector3 = new Vector3(0.5, 0.5, 0.5);\r\n\tprivate _u_SplitShadow: Vector4 = new Vector4(0, 0, 0);\r\n\r\n\t// shadows, midtones, highlights\r\n\tprivate _enableSMH: boolean = false;\r\n\t/**@internal */\r\n\tprivate _shadows: Vector3 = new Vector3(1, 1, 1);//0-5\r\n\t/**@internal */\r\n\tprivate _midtones: Vector3 = new Vector3(1, 1, 1);//0-5\r\n\t/**@internal */\r\n\tprivate _highlights: Vector3 = new Vector3(1, 1, 1);//0-5\r\n\t/**@internal */\r\n\tprivate _limits: Vector4 = new Vector4(0, 0.33, 0.55, 1);\r\n\r\n\t//lift gamma gain\r\n\tprivate _enableLiftGammaGain: boolean = false;\r\n\t/**@internal */\r\n\tprivate _lift: Vector3 = new Vector3(0, 0, 0);//-1-1\r\n\t/**@internal */\r\n\tprivate _gamma: Vector3 = new Vector3(1, 1, 1);//999-0.5\r\n\t/**@internal */\r\n\tprivate _gain: Vector3 = new Vector3(1, 1, 1);//0-2\r\n\r\n\t//white balance\r\n\tprivate _enableBalance: boolean = false;\r\n\t/**@internal tint,temperature */\r\n\tprivate _balance: Vector3 = new Vector3();\r\n\tprivate _tint: number = 0;//-100-100\r\n\tprivate _temperature: number = 0;//-100-1\r\n\r\n\t//Color Adjustments\r\n\t/**@internal */\r\n\tprivate _enableColorAdjust: boolean = false;\r\n\t/**@internal */\r\n\tprivate _postExposure = 1;//,1\r\n\t/**@internal */\r\n\tprivate _contrast = 1;//range 0-2//HueSatCon.z\r\n\t/**@internal */\r\n\tprivate _colorFilter = new Color(1, 1, 1);//\r\n\t/**@internal */\r\n\tprivate _HueShift = 0;//-0.5-0.5 HueSatCon.x\r\n\r\n\t/**@internal */\r\n\tprivate _saturation = 1;//0-2HueSatCon.y\r\n\r\n\t/**@internal _HueShift,_saturation,_contrast*/\r\n\tprivate _HueSatCon: Vector4 = new Vector4(0, 1, 1, 0);\r\n\r\n\t/**\r\n\t * Tone Map\r\n\t */\r\n\tpublic get toneMapping(): ToneMappingType {\r\n\t\treturn this._toneMapping;\r\n\t}\r\n\r\n\tpublic set toneMapping(value: ToneMappingType) {\r\n\t\tif (value == this._toneMapping)\r\n\t\t\treturn\r\n\t\tthis._needBuildLUT = true;\r\n\t\tthis._toneMapping = value;\r\n\t}\r\n\r\n\t// split toning\r\n\t/**\r\n\t * Split Tone\r\n\t */\r\n\tpublic get enableSplitTone() {\r\n\t\treturn this._enableSplitTone;\r\n\t}\r\n\r\n\tpublic set enableSplitTone(value: boolean) {\r\n\t\tthis._enableSplitTone = value;\r\n\t\tthis._needBuildLUT = true;\r\n\t}\r\n\r\n\t/**\r\n\t * split shadow\r\n\t */\r\n\tpublic get splitShadow(): Vector3 {\r\n\t\treturn this._splitShadow;\r\n\t}\r\n\r\n\tpublic set splitShadow(value: Vector3) {\r\n\t\tthis._needBuildLUT = true;\r\n\t\tvalue.cloneTo(this._splitShadow);\r\n\t}\r\n\r\n\t/**\r\n\t * split hightLight\r\n\t */\r\n\tpublic get splithighlights(): Vector3 {\r\n\t\treturn this._splithighlights;\r\n\t}\r\n\tpublic set splithighlights(value: Vector3) {\r\n\t\tif (this._splithighlights.equal(value))\r\n\t\t\treturn;\r\n\t\tthis._needBuildLUT = true;\r\n\t\tvalue.cloneTo(this._splithighlights);\r\n\t}\r\n\r\n\t/**\r\n\t * split balance\r\n\t */\r\n\tpublic get splitBalance(): number {\r\n\t\treturn this._splitBalance;\r\n\t}\r\n\r\n\tpublic set splitBalance(value: number) {\r\n\t\tthis._needBuildLUT = true;\r\n\t\tthis._splitBalance = value;\r\n\t}\r\n\r\n\t// shadows, midtones, highlights\r\n\tpublic get enableSMH(): boolean {\r\n\t\treturn this._enableSMH;\r\n\t}\r\n\r\n\tpublic set enableSMH(value: boolean) {\r\n\t\tthis._needBuildLUT = true;\r\n\t\tthis._enableSMH = value;\r\n\t}\r\n\r\n\t/**\r\n\t * shadows 0-5\r\n\t */\r\n\tpublic get shadows(): Vector3 {\r\n\t\treturn this._shadows;\r\n\t}\r\n\r\n\tpublic set shadows(value: Vector3) {\r\n\t\tif (this._shadows.equal(value))\r\n\t\t\treturn;\r\n\t\tthis._needBuildLUT = true;\r\n\t\tvalue.cloneTo(this._shadows);\r\n\t}\r\n\r\n\t/**\r\n\t * midtones 0-5\r\n\t */\r\n\tpublic get midtones(): Vector3 {\r\n\t\treturn this._midtones;\r\n\t}\r\n\tpublic set midtones(value: Vector3) {\r\n\t\tif (this._midtones.equal(value))\r\n\t\t\treturn;\r\n\t\tthis._needBuildLUT = true;\r\n\t\tvalue.cloneTo(this._midtones);\r\n\t}\r\n\r\n\t/**\r\n\t * highlights 0-5\r\n\t */\r\n\tpublic get highlights(): Vector3 {\r\n\t\treturn this._highlights;\r\n\t}\r\n\tpublic set highlights(value: Vector3) {\r\n\t\tif (this._highlights.equal(value))\r\n\t\t\treturn;\r\n\t\tthis._needBuildLUT = true;\r\n\t\tvalue.cloneTo(this._highlights);\r\n\t}\r\n\r\n\t/**\r\n\t * shadow limit start 0-1\r\n\t */\r\n\tpublic get shadowLimitStart(): number {\r\n\t\treturn this._limits.x;\r\n\t}\r\n\r\n\tpublic set shadowLimitStart(value: number) {\r\n\t\tthis._needBuildLUT = true;\r\n\t\tthis._limits.x = Math.min(value, this.shadowLimitEnd);\r\n\t}\r\n\r\n\t/**\r\n\t * shadow limit end 0-1\r\n\t */\r\n\tpublic get shadowLimitEnd(): number {\r\n\t\treturn this._limits.y;\r\n\t}\r\n\r\n\tpublic set shadowLimitEnd(value: number) {\r\n\t\tthis._needBuildLUT = true;\r\n\t\tthis._limits.y = Math.max(value, this.shadowLimitStart);\r\n\t}\r\n\r\n\r\n\t/**\r\n\t * high Light limit start 0-1\r\n\t */\r\n\tpublic get highLightLimitStart(): number {\r\n\t\treturn this._limits.z;\r\n\t}\r\n\r\n\tpublic set highLightLimitStart(value: number) {\r\n\t\tthis._needBuildLUT = true;\r\n\t\tthis._limits.z = Math.min(value, this.highLightLimitEnd);\r\n\t}\r\n\r\n\t/**\r\n\t * high Light limit end 0-1\r\n\t */\r\n\tpublic get highLightLimitEnd(): number {\r\n\t\treturn this._limits.w;\r\n\t}\r\n\r\n\tpublic set highLightLimitEnd(value: number) {\r\n\t\tthis._needBuildLUT = true;\r\n\t\tthis._limits.w = Math.max(this.highLightLimitStart, value);\r\n\t}\r\n\r\n\r\n\t//lift gamma gain\r\n\tpublic get enableLiftGammaGain() {\r\n\t\treturn this._enableLiftGammaGain;\r\n\t}\r\n\r\n\tpublic set enableLiftGammaGain(value: boolean) {\r\n\t\tthis._needBuildLUT = true;\r\n\t\tthis._enableLiftGammaGain = value;\r\n\t}\r\n\r\n\t/**\r\n\t * lift -1-1\r\n\t */\r\n\tpublic get lift(): Vector3 {\r\n\t\treturn this._lift;\r\n\t}\r\n\r\n\tpublic set lift(value: Vector3) {\r\n\t\tif (this.lift.equal(value))\r\n\t\t\treturn;\r\n\t\tthis._needBuildLUT = true;\r\n\t\tvalue.cloneTo(this._lift);\r\n\t}\r\n\r\n\r\n\t/**\r\n\t * gamma 999-0.5\r\n\t */\r\n\tpublic get gamma(): Vector3 {\r\n\t\treturn this._gamma;\r\n\t}\r\n\r\n\tpublic set gamma(value: Vector3) {\r\n\t\tif (this._gamma.equal(value))\r\n\t\t\treturn;\r\n\t\tthis._needBuildLUT = true;\r\n\t\tvalue.cloneTo(this._gamma);\r\n\t}\r\n\r\n\t/**\r\n\t * gain 0-2\r\n\t */\r\n\tpublic get gain(): Vector3 {\r\n\t\treturn this._gain;\r\n\t}\r\n\r\n\tpublic set gain(value: Vector3) {\r\n\t\tif (this._gain.equal(value))\r\n\t\t\treturn;\r\n\t\tthis._needBuildLUT = true;\r\n\t\tvalue.cloneTo(this._gain);\r\n\t}\r\n\r\n\tprivate _StandardIlluminantY(x: number) {\r\n\t\treturn 2.87 * x - 3 * x * x - 0.27509507;\r\n\t};\r\n\r\n\tprivate _CIExyToLMS(x: number, y: number) {\r\n\t\tlet Y = 1;\r\n\t\tlet X = Y * x / y;\r\n\t\tlet Z = Y * (1 - x - y) / y;\r\n\r\n\t\tlet L = 0.7328 * X + 0.4296 * Y - 0.1624 * Z;\r\n\t\tlet M = -0.7036 * X + 1.6975 * Y + 0.0061 * Z;\r\n\t\tlet S = 0.0030 * X + 0.0136 * Y + 0.9834 * Z;\r\n\r\n\t\treturn new Vector3(L, M, S);\r\n\t}\r\n\r\n\t// Converts white balancing parameter to LMS coefficients.\r\n\tprivate _ColorBalanceToLMSCoeffs(temperature: number, tint: number) {\r\n\r\n\t\t// Range ~[-1.5;1.5] works best\r\n\t\tlet t1 = temperature / 65.0;\r\n\t\tlet t2 = tint / 65.0;\r\n\r\n\t\t// Get the CIE xy chromaticity of the reference white point.\r\n\t\t// Note: 0.31271 = x value on the D65 white point\r\n\t\tlet x = 0.31271 - t1 * (t1 < 0 ? 0.1 : 0.05);\r\n\t\tlet y = this._StandardIlluminantY(x) + t2 * 0.05;\r\n\r\n\t\t// Calculate the coefficients in the LMS space.\r\n\t\tlet w1 = new Vector3(0.949237, 1.03542, 1.08728);\r\n\t\tlet w2 = this._CIExyToLMS(x, y);\r\n\r\n\t\tthis._balance.set(w1.x / w2.x, w1.y / w2.y, w1.z / w2.z);\r\n\t}\r\n\r\n\t//balance\r\n\tpublic get enableBalance() {\r\n\t\treturn this._enableBalance;\r\n\t}\r\n\r\n\tpublic set enableBalance(value: boolean) {\r\n\t\tthis._needBuildLUT = true;\r\n\t\tthis._enableBalance = value;\r\n\t}\r\n\r\n\t/**\r\n\t * tint -100 - 100\r\n\t */\r\n\tpublic get tint(): number {\r\n\t\treturn this._tint;\r\n\t}\r\n\r\n\r\n\tpublic set tint(value: number) {\r\n\t\tthis._needBuildLUT = true;\r\n\t\tthis._tint = value;\r\n\t\tthis._ColorBalanceToLMSCoeffs(this._temperature, this._tint);\r\n\t}\r\n\r\n\t/**\r\n\t * temperature -100-100\r\n\t */\r\n\tpublic get temperature(): number {\r\n\t\treturn this._temperature;\r\n\t}\r\n\r\n\tpublic set temperature(value: number) {\r\n\t\tthis._needBuildLUT = true;\r\n\t\tthis._temperature = value;\r\n\t\tthis._ColorBalanceToLMSCoeffs(this._temperature, this._tint);\r\n\t}\r\n\r\n\t//Color Adjustments\r\n\tpublic get enableColorAdjust() {\r\n\t\treturn this._enableColorAdjust;\r\n\t}\r\n\r\n\tpublic set enableColorAdjust(value: boolean) {\r\n\t\tthis._needBuildLUT = true;\r\n\t\tthis._enableColorAdjust = value;\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t */\r\n\tpublic get postExposure() {\r\n\t\treturn this._postExposure;\r\n\t}\r\n\r\n\tpublic set postExposure(value) {\r\n\t\tthis._postExposure = value;\r\n\t}\r\n\r\n\t/**\r\n\t * contrastrange 0-2\r\n\t */\r\n\tpublic get contrast() {\r\n\t\treturn this._contrast;\r\n\t}\r\n\r\n\tpublic set contrast(value) {\r\n\t\tthis._needBuildLUT = true;\r\n\t\tthis._contrast = value;\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t */\r\n\tpublic get colorFilter() {\r\n\t\treturn this._colorFilter;\r\n\t}\r\n\r\n\tpublic set colorFilter(value: Color) {\r\n\t\tthis._needBuildLUT = true;\r\n\t\tvalue.cloneTo(this._colorFilter);\r\n\t}\r\n\r\n\t/** -0.5-0.5*/\r\n\tpublic get HueShift() {\r\n\t\treturn this._HueShift;\r\n\t}\r\n\tpublic set HueShift(value) {\r\n\t\tthis._needBuildLUT = true;\r\n\t\tthis._HueShift = value;\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t */\r\n\tpublic get saturation() {\r\n\t\treturn this._saturation;\r\n\t}\r\n\tpublic set saturation(value) {\r\n\t\tthis._needBuildLUT = true;\r\n\t\tthis._saturation = value;\r\n\t}\r\n\r\n\r\n\r\n\t/**\r\n\t *  <code>BloomEffect</code> \r\n\t */\r\n\tconstructor() {\r\n\t\tsuper();\r\n\t\tthis.singleton = true;\r\n\t\tthis.active = true;\r\n\t\tthis._needBuildLUT = true;\r\n\t\tthis._toneMapping = ToneMappingType.None;\r\n\t\tthis._blitlutParams = new Vector4();\r\n\t\tthis._lutShaderData = LayaGL.renderOBJCreate.createShaderData(null);\r\n\t\tthis.lutSize = 32;\r\n\t\tthis._lutCommond = new CommandBuffer();\r\n\t\tthis._lutBuilderMat = new Material();\r\n\t}\r\n\r\n\r\n\r\n\tprivate get lutSize() {\r\n\t\treturn this._lutSize;\r\n\t}\r\n\tprivate set lutSize(value) {\r\n\t\tif (value > 32)//64*6 = 4096\r\n\t\t\treturn\r\n\t\tthis._lutSize = value;\r\n\t\tif (this._lutTex)\r\n\t\t\tthis._lutTex.destroy();\r\n\t\tthis._lutTex = new RenderTexture(this._lutSize * this._lutSize, this._lutSize, RenderTargetFormat.R16G16B16A16, null, false, 1, false, false);\r\n\t\tthis._lutTex.anisoLevel = 1;\r\n\t\tthis._lutTex.wrapModeU = WrapMode.Clamp;\r\n\t\tthis._lutTex.wrapModeV = WrapMode.Clamp;\r\n\t\tthis._lutTex.filterMode = FilterMode.Bilinear;\r\n\t}\r\n\r\n\r\n\r\n\tprivate default_balance = new Vector3(1, 1, 1);\r\n\tprivate default_splitShadow = new Vector4(0.5, 0.5, 0.5, 0.0);\r\n\tprivate default_splithighlights = new Vector3(0.5, 0.5, 0.5);\r\n\tprivate default_shadow = new Vector3(1, 1, 1);\r\n\tprivate default_midtones = new Vector3(1, 1, 1);\r\n\tprivate default_highlight = new Vector3(1, 1, 1);\r\n\tprivate default_limint = new Vector4(0.0, 0.3, 0.55, 1.0);\r\n\tprivate default_lift = new Vector3(0, 0, 0);\r\n\tprivate default_gamma = new Vector3(1, 1, 1);\r\n\tprivate default_gain = new Vector3(1, 1, 1);\r\n\tprivate default_ColorFilter = new Color(1, 1, 1, 1);\r\n\tprivate default_HueSatCon = new Vector4(0, 1, 1, 0);\r\n\t/**\r\n\t * @internal\r\n\t * LUT\r\n\t */\r\n\t_buildLUT() {\r\n\t\tif (!this._needBuildLUT)\r\n\t\t\treturn;\r\n\t\tlet lutHeight = this.lutSize;\r\n\t\tlet lutWidth = this.lutSize * this.lutSize;\r\n\t\tlet lutParams = new Vector4(lutHeight, 0.5 / lutWidth, 0.5 / lutHeight, lutHeight / (lutHeight - 1));\r\n\t\tthis._lutBuilderMat.setVector4(\"u_LutParams\", lutParams);\r\n\r\n\t\tif (this.enableBalance) {\r\n\t\t\tthis._ColorBalanceToLMSCoeffs(this.temperature, this.tint);\r\n\t\t\tthis._lutBuilderMat.setVector3(\"u_ColorBalance\", this._balance);\r\n\t\t} else {\r\n\t\t\tthis._lutBuilderMat.setVector3(\"u_ColorBalance\", this.default_balance);\r\n\t\t}\r\n\r\n\t\tif (this.enableSplitTone) {\r\n\t\t\tthis._u_SplitShadow.setValue(this._splitShadow.x, this._splitShadow.y, this._splitShadow.z, this.splitBalance);\r\n\t\t\tthis._lutBuilderMat.setVector4(\"u_SplitShadows\", this._u_SplitShadow);\r\n\t\t\tthis._lutBuilderMat.setVector3(\"u_Splithighlights\", this._splithighlights);\r\n\t\t} else {\r\n\t\t\tthis._lutBuilderMat.setVector4(\"u_SplitShadows\", this.default_splitShadow);\r\n\t\t\tthis._lutBuilderMat.setVector3(\"u_Splithighlights\", this.default_splithighlights);\r\n\t\t}\r\n\r\n\t\tif (this.enableSMH) {\r\n\t\t\tthis._lutBuilderMat.setVector3(\"u_Shadows\", this._shadows);\r\n\t\t\tthis._lutBuilderMat.setVector3(\"u_Midtones\", this._midtones);\r\n\t\t\tthis._lutBuilderMat.setVector3(\"u_Highlights\", this._highlights);\r\n\t\t\tthis._lutBuilderMat.setVector4(\"u_Limits\", this._limits);\r\n\t\t} else {\r\n\t\t\tthis._lutBuilderMat.setVector3(\"u_Shadows\", this.default_shadow);\r\n\t\t\tthis._lutBuilderMat.setVector3(\"u_Midtones\", this.default_midtones);\r\n\t\t\tthis._lutBuilderMat.setVector3(\"u_Highlights\", this.default_highlight);\r\n\t\t\tthis._lutBuilderMat.setVector4(\"u_Limits\", this.default_limint);\r\n\t\t}\r\n\t\tif (this._enableLiftGammaGain) {\r\n\t\t\tthis._lutBuilderMat.setVector3(\"u_Lift\", this._lift);\r\n\t\t\tthis._lutBuilderMat.setVector3(\"u_Gamma\", this._gamma);\r\n\t\t\tthis._lutBuilderMat.setVector3(\"u_Gain\", this._gain);\r\n\t\t} else {\r\n\t\t\tthis._lutBuilderMat.setVector3(\"u_Lift\", this.default_lift);\r\n\t\t\tthis._lutBuilderMat.setVector3(\"u_Gamma\", this.default_gamma);\r\n\t\t\tthis._lutBuilderMat.setVector3(\"u_Gain\", this.default_gain);\r\n\t\t}\r\n\t\tif (this.enableColorAdjust) {\r\n\t\t\t//_HueShift,_saturation,_contrast\r\n\t\t\tthis._HueSatCon.setValue(this._HueShift, this.saturation, this._contrast, 0.0);\r\n\t\t\tthis._lutBuilderMat.setColor(\"u_ColorFilter\", this._colorFilter);\r\n\t\t\tthis._lutBuilderMat.setVector4(\"u_HueSatCon\", this._HueSatCon);\r\n\t\t} else {\r\n\t\t\tthis._lutBuilderMat.setColor(\"u_ColorFilter\", this.default_ColorFilter);\r\n\t\t\tthis._lutBuilderMat.setVector4(\"u_HueSatCon\", this.default_HueSatCon);\r\n\t\t}\r\n\r\n\r\n\r\n\t\tif (this._toneMapping == ToneMappingType.ACES) {\r\n\t\t\tthis._lutBuilderMat.addDefine(ColorGradEffect.SHADERDEFINE_ACES);\r\n\t\t} else {\r\n\t\t\tthis._lutBuilderMat.removeDefine(ColorGradEffect.SHADERDEFINE_ACES);\r\n\t\t}\r\n\t\tthis._lutCommond.blitScreenQuadByMaterial(Texture2D.whiteTexture, this._lutTex, null, this._lutBuilderMat);\r\n\t\tthis._lutCommond.context = RenderContext3D._instance;\r\n\t\tthis._lutCommond._apply();\r\n\t\tthis._lutCommond.clear();\r\n\t}\r\n\r\n\t/**\r\n\t * ,\r\n\t */\r\n\teffectInit(postprocess: PostProcess) {\r\n\t\tsuper.effectInit(postprocess);\r\n\t\tthis._lutBuilderMat.setShaderName(\"LUTBuilder\");\r\n\t\tthis._LUTShader = Shader3D.find(\"blitLUTShader\");\r\n\t\tpostprocess._enableColorGrad = true;\r\n\t\tpostprocess._ColorGradEffect = this;\r\n\t\t// this._shader = Shader3D.find(\"PostProcessBloom\");\r\n\t\t// this._pyramid = new Array(BloomEffect.MAXPYRAMIDSIZE * 2);\r\n\t}\r\n\r\n\t/**\r\n\t * Effect\r\n\t */\r\n\trelease(postprocess: PostProcess) {\r\n\t\tsuper.release(postprocess);\r\n\t\tpostprocess._enableColorGrad = false;\r\n\t\tpostprocess._ColorGradEffect = null;\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t * @override\r\n\t * @internal\r\n\t */\r\n\trender(context: PostProcessRenderContext): void {\r\n\t\tlet cmd: CommandBuffer = context.command;\r\n\t\tlet source: RenderTexture = context.indirectTarget;\r\n\t\tif (true) {\r\n\t\t\tthis._blitlutParams.setValue(1 / this._lutTex.width, 1 / this._lutTex.height, this._lutTex.height - 1, this.enableColorAdjust ? this._postExposure : 1);\r\n\t\t\tthis._lutBuilderMat.removeDefine(ColorGradEffect.SHADERDEFINE_CUSTOMLUT);\r\n\t\t\tthis._lutShaderData.setTexture(ColorGradEffect.SHADERVALUE_LUT, this._lutTex);\r\n\t\t\tthis._lutShaderData.setVector(ColorGradEffect.SHADERVALUE_LUTPARAMS, this._blitlutParams);\r\n\t\t}\r\n\t\telse {\r\n\t\t\t//TODO:CustomLUT\r\n\t\t\tthis._lutBuilderMat.addDefine(ColorGradEffect.SHADERDEFINE_CUSTOMLUT);\r\n\r\n\t\t}\r\n\t\tcmd.blitScreenTriangle(source, context.destination, null, this._LUTShader, this._lutShaderData);\r\n\t}\r\n\r\n}\r\n\r\n\r\n\r\n\r\n","/**\r\n * PBR\r\n */\r\nexport enum PBRRenderQuality {\r\n    /***/\r\n    High,\r\n    /***/\r\n    Low\r\n}","#define SHADER_NAME BlitLUTFS\r\n\r\n#include \"Color.glsl\";\r\n\r\n#include \"ColorGrading.glsl\";\r\n#include \"LUT.glsl\";\r\n\r\nuniform sampler2D u_Lut;\r\nuniform vec4 u_LutParams; // w postExposure\r\n\r\n#ifdef CUSTOMLUT\r\nuniform sampler2D u_CustomLut;\r\nuniform vec4 u_CustomLutParams;\r\n#endif // CUSTOMLUT\r\n\r\nvarying vec2 v_Texcoord0;\r\n\r\nvoid main()\r\n{\r\n    gl_FragColor = texture2D(u_MainTex, v_Texcoord0);\r\n#ifdef Gamma_u_MainTex\r\n    gl_FragColor = gammaToLinear(gl_FragColor);\r\n#endif // Gamma_u_MainTex\r\n\r\n    vec3 color = gl_FragColor.rgb;\r\n    // gl_FragColor.rgb = applyLut(color, 1.0, u_Lut, u_LutParams);\r\n    color *= u_LutParams.w;\r\n    color = applyLut(u_Lut, linearToLogC(color), u_LutParams.xyz);\r\n\r\n#ifdef CUSTOMLUT\r\n\r\n    float contrib = u_CustomLutParams.w;\r\n    vec3 gamma = linearToGamma(color);\r\n    vec3 userLut = applyLut(u_CustomLut, gamma, u_CustomLutParams);\r\n    gamma = mix(gamma, userLut, contrib);\r\n    color = gammaToLinear(gamma);\r\n\r\n#endif // CUSTOMLUT\r\n\r\n    gl_FragColor.rgb = color;\r\n\r\n    gl_FragColor = outputTransform(gl_FragColor);\r\n}\r\n","import { ILaya } from \"../../../ILaya\"\r\nimport { Texture2D } from \"../../resource/Texture2D\"\r\nimport { Camera } from \"../core/Camera\"\r\nimport { CommandBuffer } from \"../core/render/command/CommandBuffer\"\r\nimport { PostProcessEffect } from \"../core/render/PostProcessEffect\"\r\nimport { PostProcessRenderContext } from \"../core/render/PostProcessRenderContext\"\r\nimport { Viewport } from \"../math/Viewport\"\r\nimport { RenderContext3D } from \"../core/render/RenderContext3D\"\r\nimport { ShaderDefine } from \"../../RenderEngine/RenderShader/ShaderDefine\"\r\nimport { Shader3D } from \"../../RenderEngine/RenderShader/Shader3D\"\r\nimport { ShaderData } from \"../../RenderEngine/RenderShader/ShaderData\"\r\nimport { RenderTargetFormat } from \"../../RenderEngine/RenderEnum/RenderTargetFormat\"\r\nimport { DepthTextureMode } from \"../depthMap/DepthPass\"\r\nimport { RenderTexture } from \"../../resource/RenderTexture\"\r\nimport { ColorGradEffect } from \"../core/render/PostEffect/ColorGradEffect\"\r\nimport { LayaGL } from \"../../layagl/LayaGL\"\r\n\r\n/**\r\n * <code>PostProcess</code> \r\n */\r\nexport class PostProcess {\r\n\r\n    /**@internal */\r\n    static SHADERDEFINE_BLOOM_LOW: ShaderDefine;\r\n\r\n    /**@internal */\r\n    static SHADERDEFINE_BLOOM: ShaderDefine;\r\n\r\n    /**@internal */\r\n    static SHADERDEFINE_FINALPASS: ShaderDefine;\r\n\r\n    /**@internal */\r\n    static SHADERVALUE_MAINTEX: number;\r\n\r\n    /**@internal */\r\n    static SHADERVALUE_BLOOMTEX: number;\r\n\r\n    /**@internal */\r\n    static SHADERVALUE_AUTOEXPOSURETEX: number;\r\n\r\n    /**@internal */\r\n    static SHADERVALUE_BLOOM_DIRTTEX: number;\r\n\r\n    /**@internal */\r\n    static SHADERVALUE_BLOOMTEX_TEXELSIZE: number;\r\n\r\n    /**@internal */\r\n    static SHADERVALUE_BLOOM_DIRTTILEOFFSET: number;\r\n\r\n    /**@internal */\r\n    static SHADERVALUE_BLOOM_SETTINGS: number;\r\n\r\n    /**@internal */\r\n    static SHADERVALUE_BLOOM_COLOR: number;\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    static __init__(): void {\r\n        PostProcess.SHADERDEFINE_BLOOM_LOW = Shader3D.getDefineByName(\"BLOOM_LOW\");\r\n        PostProcess.SHADERDEFINE_BLOOM = Shader3D.getDefineByName(\"BLOOM\");\r\n        PostProcess.SHADERDEFINE_FINALPASS = Shader3D.getDefineByName(\"FINALPASS\");\r\n        PostProcess.SHADERVALUE_MAINTEX = Shader3D.propertyNameToID(\"u_MainTex\");\r\n        PostProcess.SHADERVALUE_BLOOMTEX = Shader3D.propertyNameToID(\"u_BloomTex\");\r\n        PostProcess.SHADERVALUE_AUTOEXPOSURETEX = Shader3D.propertyNameToID(\"u_AutoExposureTex\");\r\n        PostProcess.SHADERVALUE_BLOOM_DIRTTEX = Shader3D.propertyNameToID(\"u_Bloom_DirtTex\");\r\n        PostProcess.SHADERVALUE_BLOOMTEX_TEXELSIZE = Shader3D.propertyNameToID(\"u_BloomTex_TexelSize\");\r\n        PostProcess.SHADERVALUE_BLOOM_DIRTTILEOFFSET = Shader3D.propertyNameToID(\"u_Bloom_DirtTileOffset\");\r\n        PostProcess.SHADERVALUE_BLOOM_SETTINGS = Shader3D.propertyNameToID(\"u_Bloom_Settings\");\r\n        PostProcess.SHADERVALUE_BLOOM_COLOR = Shader3D.propertyNameToID(\"u_Bloom_Color\");\r\n    }\r\n\r\n    /**@internal */\r\n    private _compositeShader: Shader3D = Shader3D.find(\"PostProcessComposite\");\r\n\r\n    /**@internal */\r\n    private _compositeShaderData: ShaderData = LayaGL.renderOBJCreate.createShaderData(null);\r\n\r\n    /**@internal */\r\n    private _effects: PostProcessEffect[] = [];\r\n\r\n    /**@internal */\r\n    private _enable: boolean = true;\r\n\r\n    /**@internal */\r\n    private _depthtextureFlag: DepthTextureMode;\r\n    /**@internal Effect*/\r\n    _ColorGradEffect: ColorGradEffect;\r\n    /**@internal Effect*/\r\n    _enableColorGrad: boolean = false;\r\n\r\n    /**@internal */\r\n    _context: PostProcessRenderContext | null = null;\r\n\r\n    /**\r\n     * CameraFlag\r\n     */\r\n    private recaculateCameraFlag() {\r\n        this._depthtextureFlag = DepthTextureMode.None;\r\n        let n = this.effects.length;\r\n        for (let i = 0; i < n; i++) {\r\n            this._depthtextureFlag |= this.effects[i].getCameraDepthTextureModeFlag();\r\n        }\r\n    }\r\n\r\n    /**\r\n     *  <code>PostProcess</code> \r\n     */\r\n    constructor() {\r\n        this._context = new PostProcessRenderContext();\r\n        this._context.compositeShaderData = this._compositeShaderData;\r\n        this._context.command = new CommandBuffer();\r\n        this._depthtextureFlag = 0;\r\n    }\r\n\r\n    /**\r\n     * \r\n     */\r\n    get enable(): boolean {\r\n        return this._enable;\r\n    }\r\n\r\n    set enable(value: boolean) {\r\n        this._enable = value;\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @internal\r\n     */\r\n    set commandContext(oriContext: RenderContext3D) {\r\n        this._context.command._context = oriContext;\r\n    }\r\n\r\n    /**\r\n     * IDEmain\r\n     * Effect\r\n     */\r\n    set effects(value: PostProcessEffect[]) {\r\n        this.clearEffect();\r\n        for (var i = 0, n = value.length; i < n; i++) {\r\n            if (value[i])\r\n                this.addEffect(value[i]);\r\n        }\r\n    }\r\n\r\n    get effects(): PostProcessEffect[] {\r\n        return this._effects;\r\n    }\r\n\r\n    /**\r\n     * ,\r\n     */\r\n    get cameraDepthTextureMode() {\r\n        return this._depthtextureFlag;\r\n    }\r\n\r\n    /**\r\n     *@internal\r\n     */\r\n    _init(camera: Camera): void {\r\n        this._context!.camera = camera;\r\n        this._context!.command!._camera = camera;\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    _render(camera: Camera): void {\r\n        this._init(camera);\r\n        var camera = this._context!.camera;\r\n        var viewport: Viewport = camera!.viewport;\r\n        var cameraTarget: RenderTexture = camera!._internalRenderTexture;\r\n        var screenTexture: RenderTexture = RenderTexture.createFromPool(cameraTarget.width, cameraTarget.height, camera._getRenderTextureFormat(), RenderTargetFormat.None, false, 1, false, true);\r\n        var Indirect: RenderTexture[] = [RenderTexture.createFromPool(cameraTarget.width, cameraTarget.height, camera._getRenderTextureFormat(), RenderTargetFormat.None, false, 1, false, true), RenderTexture.createFromPool(cameraTarget.width, cameraTarget.height, camera._getRenderTextureFormat(), RenderTargetFormat.None, false, 1, false, true)];\r\n        //var screenTexture: RenderTexture = cameraTarget;\r\n        this._context!.command!.clear();\r\n        this._context!.source = screenTexture;\r\n        this._context!.indirectTarget = screenTexture;\r\n        this._context!.destination = this._effects.length == 2 ? Indirect[0] : cameraTarget;\r\n        this._context!.compositeShaderData!.clearDefine();\r\n\r\n        this._context.command.blitScreenTriangle(cameraTarget, screenTexture);\r\n\r\n        this._context!.compositeShaderData!.setTexture(PostProcess.SHADERVALUE_AUTOEXPOSURETEX, Texture2D.whiteTexture);//TODO:\r\n        if (this._enableColorGrad) {\r\n            this._ColorGradEffect._buildLUT();\r\n        }\r\n        for (var i: number = 0, n: number = this._effects.length; i < n; i++) {\r\n            if (this._effects[i].active) {\r\n                this._effects[i].render(this._context!);\r\n                if (i == n - 2) {//last effect:destination RenderTexture is CameraTarget\r\n                    this._context.indirectTarget = this._context.destination;\r\n                    this._context.destination = cameraTarget;\r\n                } else {\r\n                    this._context.indirectTarget = this._context.destination;\r\n                    this._context.destination = Indirect[(i + 1) % 2];\r\n                }\r\n            } else if (i == n - 1) {//Effect Activefalse\r\n                this._context.command.blitScreenTriangle(this._context.indirectTarget, cameraTarget);\r\n            }\r\n        }\r\n\r\n        this._compositeShaderData.addDefine(PostProcess.SHADERDEFINE_FINALPASS);\r\n\r\n        var offScreenTex: RenderTexture = camera!._offScreenRenderTexture;\r\n        var dest = offScreenTex ? offScreenTex : null;//TODO:RenderTarget,null\r\n        this._context!.destination = dest;\r\n        var canvasWidth: number = camera!._getCanvasWidth(), canvasHeight: number = camera!._getCanvasHeight();\r\n        if (dest) {\r\n            camera!._screenOffsetScale.setValue(viewport.x / canvasWidth, (canvasHeight - viewport.y - viewport.height) / canvasHeight, viewport.width / canvasWidth, viewport.height / canvasHeight);\r\n            this._context!.command!.blitScreenTriangle(cameraTarget, dest, camera!._screenOffsetScale, null, this._compositeShaderData, 0);\r\n        }\r\n\r\n        //\r\n        RenderTexture.recoverToPool(screenTexture);\r\n        RenderTexture.recoverToPool(Indirect[0]);\r\n        RenderTexture.recoverToPool(Indirect[1]);\r\n        var tempRenderTextures: RenderTexture[] = this._context!.deferredReleaseTextures;\r\n        for (i = 0, n = tempRenderTextures.length; i < n; i++)\r\n            RenderTexture.recoverToPool(tempRenderTextures[i]);\r\n        tempRenderTextures.length = 0;\r\n    }\r\n\r\n    /**\r\n     * \r\n     */\r\n    addEffect(effect: PostProcessEffect): void {\r\n        if (effect.singleton && this.getEffect((effect as any).constructor)) {\r\n            console.error(\"Effect\");\r\n            return;\r\n        }\r\n        if (!this._enableColorGrad || effect instanceof ColorGradEffect) {\r\n            this._effects.push(effect);\r\n        } else {\r\n            this._effects.splice(this._effects.length - 1, 0, effect);\r\n        }\r\n\r\n        this.recaculateCameraFlag();\r\n        effect.effectInit(this);\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @param classReg \r\n     * @returns \r\n     */\r\n    getEffect(classReg: any): any {\r\n        let size: number = this._effects.length;\r\n        for (let i = 0; i < size; i++) {\r\n            let element = this._effects[i];\r\n            if (element instanceof classReg) {\r\n                return element;\r\n            }\r\n        }\r\n        return null\r\n    }\r\n\r\n    /**\r\n     * \r\n     */\r\n    removeEffect(effect: PostProcessEffect): void {\r\n        var index: number = this._effects.indexOf(effect);\r\n        if (index !== -1) {\r\n            this._effects.splice(index, 1);\r\n            effect.release(this);\r\n            this.recaculateCameraFlag();\r\n        }\r\n    }\r\n\r\n    /**\r\n     * \r\n     */\r\n    clearEffect(): void {\r\n        let i = this.effects.length - 1;\r\n        for (; i >= 0; i--) {\r\n            this.removeEffect(this.effects[i]);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @internal\r\n     */\r\n    _applyPostProcessCommandBuffers(): void {\r\n        this._context!.command!._apply();\r\n    }\r\n}\r\n\r\n\r\n","import { HDRTextureInfo } from \"../../../RenderEngine/HDRTextureInfo\";\r\nimport { RenderCapable } from \"../../../RenderEngine/RenderEnum/RenderCapable\";\r\nimport { TextureFormat } from \"../../../RenderEngine/RenderEnum/TextureFormat\";\r\nimport { WrapMode } from \"../../../RenderEngine/RenderEnum/WrapMode\";\r\nimport { LayaGL } from \"../../../layagl/LayaGL\";\r\nimport { Texture2D } from \"../../../resource/Texture2D\";\r\nimport { Base64Tool } from \"../../../utils/Base64Tool\";\r\n\r\n\r\nconst dfg_128 = \"Iz9SQURJQU5DRQojIGNtZ2VuCkZPUk1BVD0zMi1iaXRfcmxlX3JnYmUKR0FNTUE9MQpFWFBPU1VSRT0wCgotWSAxMjggK1ggMTI4CgICAIAJCwoKCQkICAcHAwcGBgMGBQUEBQUEBIQEhwOKAosBhwKQAbYAgPnz7ujj3djTzsvIxcK/vLq3tbOwrqyqqKakoqCenZuZl5aVk5KQj42Mi4mIh4aEg4KBgP78+vj29fPx7+3r6efl4+Lg393c2tnX1tTT0dDPzczKycjHxcTDwsG/vr28u7q5t7a1tLOysbCvrq2srKuqqainpqWkpKOioaCgn56dgJ+alpOQjYuIhoSCgH59e3l4dnV0cnFvbm1samloZ2ZlZGNiYWBfXl1cW1pZWFdXVlVUU6WkoqGfnpybmZiWlZOSkI+OjIuKiIeGhIOCgH9+fXt6eXh3dXRzcnFvbm1sa2ppZ2ZlZGNiYWBfXVxbWllYV1ZVVFNSUVBPTk1LSklIs4DNfwICAIAJCwoKCQkICAcHAwcGBgMGBQWDBYUEiAOKAosBhgKQAbYAgPnz7unj3tjTz8vIxcK/vbq4tbOxr6yqqKalo6GfnZuamJeVlJKRkI6Ni4qJh4aFhIOCgYD+/Pr49vTy8O7s6unn5ePi4N/d3NrZ19bU09LQz87My8rIx8bFxMLBwL++vby6ubi3trW0s7KxsK+ura2sq6qpqKempqWko6KioaCfgJ+al5OQjYuJhoSCgH99e3p4dnV0cnFwbm1sa2loZ2ZlZGNiYWBfXl1cW1pZWFdXVlVUU1KkoqGfnpybmZiWlZOSkI+OjIuKiIeGhIOCgH9+fXt6eXh2dXRzcnBvbm1sa2loZ2ZlZGNiYF9eXVxbWllYV1ZVVFJRUE9OTUxLSklItIDMfwICAIAHCwoKCQkICAUIBwcGBgQGBgUFBAUFBASEBIcDigKMAYYCkAG1AID59O7p5N7Z1M/MycbDwL67uba0srCuq6mopqSioJ6dm5mYlpWUkpGQjo2MiomIh4WEg4KBgP/9+/n39fTy8O7s6unn5eTi4d/e3NvZ2NfV1NPR0M/NzMvKyMfGxcTDwsC/vr28u7q5uLe2tbSzsrGxsK+urayrqqqpqKempqWko4Cgm5eUkY6LiYeFg4F/fXt6eHd1dHJxcG5tbGtqaGdmZWRjYmFgX15dXFtaWVhXV1ZVVFNSUqKhn52cmpmXlpWTkpCPjYyLiYiHhYSDgYB/fnx7enl3dnV0cnFwb25sa2ppaGdmZGNiYWBfXl1cWllYV1ZVVFNSUVBPTk1MS0pJR7WAy38CAgCACgsLCgoJCQgIBwcDBwYGBAYGBQUEBQUEBIMEiAOKAo0BhQKQAbQAgPn07unk39rU0M3JxsTBvry6t7Wzsa+sq6mnpaOhoJ6cm5mYlpWUkpGQjo2MiomIh4aFhIOCgYD+/Pv59/Xz8e/u7Orp5+Xk4+Hg3t3c2tnX1tXU0tHQzs3My8rJyMfFxMPCwcC/vr28u7q5uLe2trW0s7KxsK+vrq2sq6uqqaiogKCbl5SRjoyJh4WDgX99fHp5d3V0c3Fwb21sa2ppZ2ZlZGNiYWBfXl1cW1pZWFdXVlVUU1JSUVCfnZyamZeWlJORkI+NjIqJiIaFhIKBgH59fHt5eHd2dHNycXBubWxramlnZmVkY2JhX15dXFtaWVhXVlVTUlFQT05NTEtKSUhHt4DJfwICAIAKCwsKCgkJCAgHBwMHBgYEBgYFBYMFhQSIA4oCjQGEApABtACA+fTv6uTf2tXQzcrHxMK/vbq4trSysK6sqqimpKOhn56cmpmYlpWUkpGQjo2Mi4qIh4aFhIOCgYD//vz6+Pf18/Hv7uzr6efm5ePi4d/e3Nva2dfW1dTS0dDPzs3LysnIx8bFxMPCwcC/vr28u7q6ubi3trW0tLOysbCwr66trayAoZyYlJGPjIqHhYOBf358enl3dnRzcXBvbWxramlnZmVkY2JhYF9eXVxbWllYV1dWVVRTUlJRUE+dnJqZl5aUk5GQjo2MiomHhoWDgoF/fn18enl4d3V0c3Jwb25tbGppaGdmZWRiYWBfXl1cW1lYV1ZVVFNSUVBPTkxLSklIR0a4gMh/AgIAgAgMCwoKCQkICAMIBwcDBwYGBAYGBQUEBQUEBIQEhwOLAo4BgwKQAbMAgPn07+rl4NvW0c7LyMXCwL67ube1s7Gvraupp6akoqCfnZyamZeWlZSSkZCPjYyLiomIh4aFhIOCgYD//fz6+Pb18/Hw7u3r6ujn5eTj4eDf3tzb2tnX1tXU0tHQz87NzMvKycjHxsXEw8LBwMC/vr28u7q5ubi3trW1tLOysrGwgKGcmJWSj4yKiIaEgoB+fHt5d3Z0c3Jwb25sa2ppaGZlZGNiYWBfXl1cW1pZWFhXVlVUU1JSUVBPTk6amZeWlJORkI6Ni4qJh4aEg4KAf359e3p5d3Z1dHJxcG9ubGtqaWhmZWRjYmFgXl1cW1pZWFdWVFNSUVBPTk1MS0pJSEdGuoDGfwICAIALDAsLCgoJCQgIBwcDBwYGBAYGBQWDBYYEhwOLAo8BBAICAQGOAbIAgPn07+rl4NvX0s7LycbDwb68uri2tLKwrqyqqKelo6Kgnp2bmpmYlpWUk5GQj46Ni4qJiIeGhYSDgoKBgP/9/Pr49vXz8vDv7ezq6ejm5eTi4eDf3tzb2tnY1tXU09LR0M/OzczLysnIx8bFxMTDwsHAv76+vby7urq5uLe3trW0gKKdmZWSj42KiIaEgoB+fXt5eHZ1c3Jwb25ta2ppaGdlZGNiYWBfXl1cW1pZWFhXVlVUU1JSUVBPTk1NTJeVlJKRj46Ni4qIh4aEg4KAf358e3p4d3Z1c3JxcG5tbGtqaGdmZWRjYWBfXl1cW1lYV1ZVVFNSUVBOTUxLSklIR0ZFvIDEfwICAIAJDAsLCgoJCQgIAwgHBwMHBgYEBgYFBYMFhQSIA4oCkQEDAgEBjQGyAID59O/r5uHc19PPzMnGxMG/vbu5t7Wzsa+tq6qopqWjoaCenZuamZiWlZSTkpCPjo2Mi4qJiIeGhYSDgoKBgP/9/Pr49/X08vHv7u3r6unn5uXk4+Hg397d29rZ2NfW1dTT0tHQz87NzMvKycnIx8bFxMTDwsHAwL++vb28u7q6uYCinZmWk5CNi4mGhIKAf317enh2dXNycW9ubWtqaWhnZmRjYmFgX15dXFtaWVhYV1ZVVFNSUVFQT05NTUxLSpSSkY+OjIuKiIeFhIOBgH99fHt5eHd1dHNycG9ubWxqaWhnZmRjYmFgX11cW1pZWFdWVFNSUVBPTk1MS0pIR0ZFRL6Awn8CAgCABwwMCwoKCQkFCQgIBwcEBwcGBgMGBQWDBYYEiAOKApEBAwABAY0BsQCA+fTw6+bh3djT0M3Kx8XCwL68uri2tLKwrqyrqaempKOhoJ6dm5qZmJeVlJOSkZCPjYyLiomIiIeGhYSDgoKBgP/+/Pr59/b08/Lw7+7s6+rp5+bl5OPi4d/e3dzb2tnY19bV1NPS0dDQz87NzMvKysnIx8bGxcTDwsLBwMC/vr6Ao56alpOQjouJh4WDgX99e3p4d3V0cnFwbm1samloZ2ZlY2JhYF9eXVxbWllYWFdWVVRTUlFRUE9OTU1MS0pKSZGPjoyLiYiGhYSCgYB+fXx6eXh2dXRzcXBvbmxramlnZmVkY2JgX15dXFtZWFdWVVRTUlFPTk1MS0pJSEdGRUTAgMB/AgIAgAoMDAsLCgoJCQgIAwgHBwMHBgYEBgYFBYMFhgSHA4sCkQGDAI0BsACA+fXw6+fi3dnU0M3LyMXDwb+9urm3tbOxr62sqqmnpaSioZ+enZuamZiXlpWTkpGQj46NjIuKiYiHhoaFhIODgoGAgP78+/n49/X08/Hw7+7s6+rp6Ofm5OPi4eDf3t3c29rZ2NfX1tXU09LR0M/Pzs3MzMvKycjIx8bGxcTEw8KAo56al5SRjoyJh4WDgX99fHp4d3V0cnFwbm1sa2loZ2ZlZGJhYF9eXVxbWllYWFdWVVRTUlFRUE9OTU1MS0pJSUhHRoyKiYiGhYOCgX9+fXt6eXd2dXNycXBubWxraWhnZmVjYmFgX15cW1pZWFdVVFNSUVBPTk1LSklIR0ZFREPDgL1/AgIAgAgNDAsLCgoJCQUJCAgHBwQHBwYGBAYGBQWDBYYEhwOLApEBhACLAbAAgPn18Ozn4t7Z1dHOy8nGxMLAvbu5uLa0srCurauqqKelpKKhn56dm5qZmJeWlZSTkpGPjo2MjIuKiYiHhoaFhIODgoGBgP79/Pr5+Pb19PPx8O/u7ezr6ejn5uXk4+Lh4N/e3d3c29rZ2NfW1tXU09LS0dDPz87NzMzLysrJyMjHgKSfm5eUkY+MioeFg4GAfnx6eXd2dHNxcG9tbGtqaGdmZWRjYmBfXl1cW1pZWVhXVlVUU1JRUVBPTk1MTEtKSUlIR0ZGRYmHhoSDgoB/fnx7enh3dnRzcnBvbm1ramloZmVkY2JgX15dXFtZWFdWVVRTUlBPTk1MS0pJSEZFRENCxYC7fwICAIALDQwMCwsKCgkJCAgDCAcHAwcGBgQGBgUFgwWGBIgDiwKRAYUAigGvAID59fDs5+Pe2tbRz8zJx8XCwL68uri3tbOxsK6sq6mopqWjoqGfnp2cm5qYl5aVlJOSkZCPjo2Mi4uKiYiHhoaFhISDgoKBgP/+/fv6+ff29fTz8vHv7u3s6+rp6Ofm5eTj4uLh4N/e3dzc29rZ2NfX1tXV1NPS0tHQ0M/Ozs3MzICkn5uYlZKPjIqIhoSCgH58e3l3dnRzcXBvbWxramhnZmVkY2JhX15dXFtaWVlYV1ZVVFNSUVFQT05NTExLSklISEdGRUVEQ4aEg4GAf318enl4dnV0c3Fwb21sa2poZ2ZlZGJhYF9eXFtaWVhXVVRTUlFQT05MS0pJSEdGRURDQceAuX8CAgCACQ0MDAsLCgoJCQMJCAgDCAcHAwcGBgQGBgUFgwWGBIgDigKSAYcAiAGuAID59fHs6OPf29bSz83KyMXDwb+9u7m4trSysa+urKupqKalo6Khn56dnJuamZiXlpWUk5KRkI+OjYyLi4qJiIeHhoWFhIODgoGAgP/+/Pv6+fj39vTz8vHw7+7t7Ovq6ejn5+bl5OPi4uHg397e3dzb29rZ2NjX1tbV1NTT0tLR0YCloJyYlZKPjYqIhoSCgH59e3l4dnVzcnBvbmxramlnZmVkY2JhYF9dXFtaWllYV1ZVVFNSUVBQT05NTEtLSklISEdGRUVEQ0JCQYGAfn17enl3dnVzcnFwbm1samloZ2VkY2JhX15dXFtZWFdWVVRTUVBPTk1MS0pIR0ZFRENCQcqAtn8CAgCADA0NDAwLCwoKCQkICAMIBwcEBwcGBgQGBgUFgwWGBIgDigKRAYoAhQGuAID59fHs6OTg29fT0M3LyMbEwsC+vLq5t7WzsrCvrayqqaempaOioZ+enZybmpmYl5aVlJOSkZCPj46NjIuLiomIiIeGhoWEhIOCgoGAgP/+/fz6+fj39vX08/Lx8fDv7u3s6+rp6Ojn5uXk5OPi4uHg397e3dzc29va2dnY19fW1oCmoJyZlpOQjYuJhoSCgH99e3p4dnVzcnFvbm1ramloZmVkY2JhYF9eXVxbWllYV1ZVVFNSUVBQT05NTEtLSklIR0dGRUREQ0JCQUA/P3x7enh3dnRzcnBvbm1ramlnZmVkYmFgX15cW1pZWFdVVFNSUVBOTUxLSklIR0VEQ0JBQM2As38CAgCACg4NDAwLCwoKCQkDCQgIAwgHBwMHBgaDBoUFhgSHA4sCkQGMAIMBrQCA+fXx7enk4NzY1NDOzMnHxcPBv727uri2tbOxsK6tq6qpp6alo6KhoJ+enZybmpmYl5aVlJOSkZCPj46NjIyLiomJiIeHhoaFhISDgoKBgYD//v38+/r5+Pf39vX08/Lx8O/u7u3s6+rq6ejn5+bl5eTj4uLh4eDf397d3dzc29uApqGdmZaTkI6LiYeFg4F/fXt6eHd1dHJxb25ta2ppaGZlZGNiYWBfXl1cW1pZWFdWVVRTUlFQUE9OTUxLS0pJSEdHRkVERENCQUFAPz8+PTx4d3V0c3Fwb21sa2loZ2ZkY2JhX15dXFtZWFdWVVRSUVBPTk1MSklIR0ZFRENBQD/QgLB/AgIAgA0ODQ0MDAsLCgoJCQgIBAgIBwcDBwYGBAYGBQWDBYYEiAOLApEBuwCA+fXx7enl4d3Z1NHPzMrIxcPCwL68urm3trSysa+urauqqaempaOioaCfnp2cm5qZmJeWlZSUk5KRkI+Pjo2NjIuKiomJiIeHhoaFhISDg4KBgYCA//79/fz7+vn49/b19fTz8vHw8O/u7e3s6+vq6eno5+fm5eXk5OPi4uHh4OCAp6KdmpeUkY6MiYeFg4F/fnx6eHd1dHJxcG5tbGppaGdlZGNiYWBfXl1cW1pZWFdWVVRTUlFQT09OTUxLSkpJSEdGRkVEQ0NCQUBAPz4+PTw8Ozo5cnFvbm1samloZmVkY2FgX15cW1pZWFZVVFNSUU9OTUxLSklHRkVEQ0JBQD/UgKx/AgIAgAsODQ0MDAsLCgoJCQMJCAgDCAcHBAcHBgYEBgYFBYMFhgSIA4sCkAG7AFj59fHt6eXh3dnV0s/Ny8jGxMLBv727uri3tbOysK+urKuqqaempaSioaCfnp2cnJuamZiXlpWUk5OSkZCQj46OjYyLi4qKiYmIh4eGhoWEhIODgoKBgYCAKID//v38+/v6+fj39vb19PPz8vHx8O/v7u3t7Ozr6urp6Ojn5+bm5eWAqKKempeUkY+MioiGg4KAfnx6eXd2dHNxcG5tbGppaGdmZGNiYWBfXl1cW1pZWFdWVVRTUlFQT09OTUxLSkpJSEdGRkVEQ0NCQUBAPz49PTw7Ozo5OTg3NzZramhnZmVjYmFgXl1cW1lYV1ZVU1JRUE9OTEtKSUhHRkRDQkFAPz7ZgKd/AgIAgAwODg0NDAwLCwoKCQkDCQgIAwgHBwQHBwYGBAYGBQWDBYYEiAOLApABugBW+vby7urm4t7a1tLQzsvJx8XDwcC+vLu5uLa1s7Kwr66sq6qpp6alpKOioaCfnp2cm5qZmZiXlpWUk5OSkZGQj4+OjY2Mi4uKiomJiIiHhoaFhYSEg4MHg4KCgYGAgCOA//79/fz7+vn5+Pf39vX19PPz8vLx8PDv7+7u7e3s7Ovr6oCoo5+bmJWSj42KiIaEgoB+fHt5d3Z0c3Fwb21sa2loZ2ZkY2JhYF9eXVxbWllYV1ZVVFNSUVBPTk5NTEtKSUlIR0ZFRURDQkJBQD8/Pj09PDs6Ojk4ODc2NjU0NDMyZGNhYF9eXVtaWVhWVVRTUlBPTk1MS0lIR0ZFRENBQD8+Pd6Aon8CAgCACg8ODQ0MDAsLCgoFCgkJCAgECAgHBwMHBgaDBoUFhgSIA4oCkQG5AFb69vLu6ubi3tvX09DOzMrIxsTCwb+9vLq5t7a0s7Gwr62sq6qpp6alpKOioaCfnp2dnJuamZiYl5aVlJSTkpKRkJCPjo6NjYyMi4uKiYmIiIeHhoaFhQeFhISDg4KCA4KBgSCBgID///79/fz7+/r5+fj49/f29fX09PPz8vLx8fDw74CppJ+bmJWSkI2LiIaEgoB/fXt5eHZ1c3Jwb21sa2poZ2ZlY2JhYF9eXVxbWllYV1ZVVFNSUVBPTk5NTEtKSUhIR0ZFRURDQkFBQD8+Pj08PDs6Ojk4Nzc2NTU0MzMyMTEwMC9dXFtZWFdWVVNSUVBPTUxLSklIRkVEQ0JBQD49POOAnX8CAgCADQ8ODg0NDAwLCwoKCQkDCQgIAwgHBwQHBwYGBAYGBQWDBYcEiAOKApEBuABU+vby7urn49/b2NTRz83LycfFw8HAvry7uri3tbSysbCvrayrqqmopqWko6KhoKCfnp2cnJuamZiYl5aVlZSTk5KRkZCQj46OjY2MjIuLioqJiYiIB4iHh4aGhYUFhYSEg4MDg4KCA4KBgQOBgIASgP///v79/fz7+/r6+fn4+Pf3Bff29vX1gKqkoJyZlpOQjouJh4WDgX99e3p4dnVzcnBvbmxramhnZmVkYmFgX15dXFtaWVhXVlVUU1JRUE9OTU1MS0pJSEhHRkVERENCQUFAPz4+PTw7Ozo5OTg3NzY1NDQzMzIxMTAvLy4tLSwsKypUU1FQT05NTEpJSEdGRUNCQUA/Pj076oCWfwICAIALDw8ODQ0MDAsLCgoDCgkJAwkICAMIBwcEBwcGBgQGBgUFgwWHBIcDiwKQAbgAVPr28u/r5+Pg3NjV0tDNy8nHxcTCwb+9vLu5uLa1tLKxsK+trKuqqainpqWko6KhoJ+fnp2cnJuamZmYl5aWlZSUk5OSkZGQkI+Pjo6NjYyMi4uKigeKiYmIiIeHA4eGhgOGhYUDhYSEA4SDgwODgoIEgoKBgQOBgIAEgID//wn//v79/fz8+/sC+/qAqqWgnZmWk5GOjImHhYOBf318enh3dXRycW9ubGtqaWdmZWRiYWBfXl1cW1pZWFdWVVRTUlFQT05NTExLSklIR0dGRURDQ0JBQEA/Pj09PDs6Ojk4ODc2NjU0NDMyMjEwMC8uLi0sLCsrKikpKCgnJiYlJUhHRkVEQ0FAPz49PDvzgI1/AgIAgAwPDw4ODQ0MDAsLCgoFCgkJCAgECAgHBwQHBwYGBAYGBQWDBYYEiAOLApABtwBU+vby7+vo5ODd2dbS0M7MysjGxcPBwL69u7q5t7a1s7KxsK+urKuqqainpqWko6KioaCfn56dnJybmpmZmJeXlpWVlJSTk5KSkZGQkI+Pjo6NjYyMBYyLi4qKA4qJiQOJiIgDiIeHA4eGhgOGhYUEhYWEhAOEg4MEg4OCgoOChIGGgICrpqGdmpeUkY+MioiFg4GAfnx6eXd1dHJxb25ta2ppZ2ZlZGNhYF9eXVxbWllYV1ZVVFNSUVBPTk1MTEtKSUhHRkZFRENCQkFAPz8+PTw8Ozo6OTg3NzY1NTQzMzIxMTAvLy4tLSwrKyoqKSgoJycmJSUkJCMiIiEhICAfHh4dHf+AAYACAgCAChAPDw4NDQwMCwsFCwoKCQkDCQgIBAgIBwcDBwYGgwaFBYYEiAOLApABtgBL+vbz7+zo5OHd2tbT0c/Ny8nHxcTCwb++vLu6uLe2tLOysbCvrq2sqqmop6ampaSjoqKhoJ+fnp2dnJuampmYmJeXlpaVlJSTk5KSB5KRkZCQj48Fj46OjY0FjYyMi4sDi4qKA4qJiQSJiYiIBIiIh4cDh4aGBIaGhYWDhYWEhYMCgoKArKainpqXlJKPjYqIhoSCgH58e3l3dnRzcXBubWtqaWhmZWRjYWBfXl1cW1pZWFdWVVRTUlFQT05NTEtLSklIR0ZGRURDQkJBQD8+Pj08Ozs6OTk4NzY2NTQ0MzIyMTAwLy4uLSwsKysqKSkoJycmJiUkJCMjIiEhICAfHx4dHRz/gAGAAgIAgA0QEA8ODg0NDAwLCwoKAwoJCQMJCAgDCAcHBAcHBgaDBoUFhgSIA4oCkQG1AE369vPv7Ojl4d7b19TRz83MysjGxcPCwL+9vLu5uLe2tLOysbCvrq2sq6qpqKempaSko6KioaCgn56dnZybm5qamZiYl5eWlpWVlJSTkwWTkpKRkQWRkJCPjwOPjo4Djo2NA42MjAOMi4sEi4uKigSKiomJBImJiIiDiIWHhoaDhYCtp6Kfm5iVkpCNi4iGhIKAfn17eXh2dHNxcG5tbGppaGZlZGNiYF9eXVxbWllYV1ZVVFNSUVBPTk1MS0pKSUhHRkVFRENCQUFAPz49PTw7Ojo5ODg3NjU1NDMzMjExMC8vLi0tLCsrKiopKCgnJiYlJSQjIyIiISAgHx8eHh0cHP+AAYACAgCADhAQDw8ODg0NDAwLCwoKAwoJCQMJCAgDCAcHBAcHBgaDBoUFhgSIA4oCkAG1AE369vPw7Onl4t/b2NXS0M7MysnHxcTCwcC+vby6ubi3tbSzsrGwr66trKuqqainp6alpKSjoqKhoKCfnp6dnZybm5qamZmYmJeXlpaVlQWVlJSTkwOTkpIFkpGRkJADkI+PBI+Pjo4Djo2Ng42EjISLhoqGiYWIgK2oo5+cmJWTkI6LiYeFg4F/fXt6eHZ1c3Jwb21sa2loZ2VkY2JhX15dXFtaWVhXVlVUU1JRUE9OTUxLSklJSEdGRUREQ0JBQEA/Pj08PDs6OTk4Nzc2NTQ0MzIyMTAwLy4uLSwsKyoqKSkoJycmJSUkJCMiIiEhIB8fHh4dHRwb/4ABgAICAIAMERAQDw4ODQ0MDAsLAwsKCgMKCQkDCQgIAwgHBwQHBwYGBAYGBQWEBYYEiAOKApABtABI+vbz8O3p5uPf3NnV09HPzcvJyMbFw8LBv769u7q5uLe1tLOysbCvrq2srKuqqainpqalpKSjo6KhoaCfn56enZycm5uampmZB5mYmJeXlpYDlpWVA5WUlAOUk5MDk5KSA5KRkQSRkZCQA5CPj4OPhY6GjYaMh4uArqikoJyZlpORjoyJh4WDgX99fHp4dnVzcnBvbWxraWhnZWRjYmFfXl1cW1pZWFdWVVRTUlFQT05NTEtKSUhIR0ZFRENDQkFAPz8+PTw7Ozo5OTg3NjY1NDMzMjExMC8vLi0tLCsrKikpKCgnJiYlJCQjIyIhISAgHx4eHR0cHBv/gAGAAgIAgA0RERAPDw4ODQ0MDAsLBQsKCgkJAwkICAQICAcHBAcHBgYEBgYFBYMFhwSIA4oCkAGzAEr69/Pw7erm4+Dd2dbT0c/OzMrIx8XEw8HAv768u7q5uLe1tLOysrGwr66trKuqqamop6ampaWko6OioqGgoJ+fnp6dnZycm5uamgWamZmYmAOYl5cDl5aWA5aVlQOVlJQElJSTkwSTk5KSBJKSkZGDkYaQh4+JjoCvqaWhnZqXlJGPjIqIhoOBgH58enh3dXRycW9ubGtqaGdmZGNiYV9eXVxbWllYV1ZVVFNSUVBPTk1MS0pJSEdHRkVEQ0JCQUA/Pj49PDs6Ojk4ODc2NTU0MzIyMTAwLy4uLSwsKyoqKSgoJycmJSUkIyMiIiEgIB8fHh0dHBwbG/+AAYACAgCAEBIREBAPDw4ODQ0MDAsLCgoDCgkJAwkICAQICAcHBAcHBgYEBgYFBYMFhwSHA4sCjwGzAEf69/Tw7ern5ODd2tfU0tDOzcvJyMbFxMLBwL69vLu6ubi3trW0s7KxsK+uraysq6qpqKinp6alpaSko6OioqGhoJ+fnp6dnQWdnJybmwWbmpqZmQSZmZiYBJiYl5cDl5aWBJaWlZUElZWUlIOUh5OHkomRApCQgLCqpaGempeUko+NioiGhIKAfnx6eXd1dHJxb25sa2poZ2ZkY2JhYF5dXFtaWVhXVlVUU1JRUE9OTUxLSklIR0ZGRURDQkFBQD8+PT08Ozo5OTg3NjY1NDQzMjExMC8vLi0tLCsrKikpKCcnJiYlJCQjIiIhISAfHx4eHRwcGxsa/4ABgAICAIAMEhEREBAPDg4NDQwMBQwLCwoKAwoJCQMJCAgECAgHBwQHBwYGBAYGBQWDBYcEhwOKApABsgBJ+vf08e3q5+Th3tvY1dLRz83MysjHxsTDwsG/vr28u7q5uLe2tbSzsrGwsK+urayrq6qpqainp6ampaWkpKOjoqKhoaCgn5+engOenZ0FnZycm5sEm5uamgSampmZBJmZmJgEmJiXl4OXhZaIlYuUhJOAsaumop6bmJWSkI2LiYaEgoB+fXt5d3Z0c3Fwbm1ramhnZmVjYmFgXl1cW1pZWFdWVVRSUVBQT05NTEtKSUhHRkVFRENCQUA/Pz49PDw7Ojk4ODc2NTU0MzMyMTAwLy4uLSwsKyoqKSgoJyYmJSUkIyMiISEgIB8eHh0dHBsbGhr/gAGAAgIAgA8SEhEQEA8PDg4NDQwMCwsDCwoKAwoJCQMJCAgECAgHBwMHBgaDBoUFhgSIA4oCkAGxAEb69/Tx7uvo5eLf3NnW09HQzszLycjGxcTDwcC/vr28u7q5uLe2tbSzsrKxsK+urq2sq6uqqamoqKenpqalpaSko6OioqGhA6GgoAWgn5+engOenZ0EnZ2cnAScnJubg5uFmoWZh5iLl4iWgLKsp6OfnJmWk5COi4mHhYOBf317eXh2dHNxcG5ta2ppZ2ZlY2JhYF9dXFtaWVhXVlVTUlFQT05NTUxLSklIR0ZFRENDQkFAPz4+PTw7Ojo5ODc3NjU0NDMyMjEwLy8uLS0sKysqKSkoJycmJSUkJCMiIiEgIB8fHh0dHBwbGhoZ/4ABgAICAIAQExISERAQDw8ODg0NDAwLCwMLCgoDCgkJAwkICAMIBwcEBwcGBoMGhQWGBIgDigKPAbEAP/r39PHu6+jl4t/c2dbU0tDPzcvKycfGxcTCwcC/vr28u7q5uLe2tbS0s7KxsbCvrq2trKurqqqpqaiop6empgmmpaWkpKOjoqIDoqGhA6GgoASgoJ+fA5+enoOehZ2FnIebi5qMmYCyraikoJyZlpORjoyKh4WDgX99fHp4dnVzcnBubWxqaWdmZWRiYWBfXVxbWllYV1ZUU1JRUE9OTUxLSkpJSEdGRURDQkJBQD8+PT08Ozo5OTg3NjY1NDMzMjEwMC8uLi0sLCsqKikoKCcmJiUkJCMiIiEhIB8fHh4dHBwbGxoZGf+AAYACAgCADBMTEhEREBAPDg4NDQUNDAwLCwMLCgoDCgkJAwkICAMIBwcEBwcGBoMGhQWGBIgDigKPAbAAPvr39PHu6+nm4+Dd2tfU09HPzszLycjHxsTDwsHAv769vLu6ubi3tra1tLOzsrGwsK+ura2srKurqqqpqaioBainp6amBaalpaSkA6SjowOjoqIEoqKhoQOhoKCDoIafh56JnZKcgLOtqaShnZqXlJGPjIqIhoSCgH58enh3dXNycG9tbGppaGZlZGJhYF9dXFtaWVhXVVRTUlFQT05NTEtKSUhIR0ZFRENCQUFAPz49PDw7Ojk4ODc2NTU0MzIyMTAvLy4tLSwrKyopKSgnJyYlJSQjIyIhISAgHx4eHR0cGxsaGhkY/4ABgAICAIAPFBMSEhEREA8PDg4NDQwMAwwLCwULCgoJCQQJCQgIAwgHBwQHBwYGgwaFBYYEiAOJApABrwA9+vf08e/s6ebj4N7b2NXT0tDOzcvKycfGxcTDwsHAv769vLu6ubi4t7a1tbSzsrKxsLCvrq6traysq6uqqgWqqamoqAOop6cFp6ampaUDpaSkg6SEo4Wih6GJoJefgLSuqaWhnpuYlZKPjYuIhoSCgH58enl3dXRycG9tbGtpaGZlZGJhYF9dXFtaWVhXVVRTUlFQT05NTEtKSUhHRkZFRENCQUA/Pz49PDs6Ojk4Nzc2NTQzMzIxMTAvLi4tLCwrKikpKCcnJiUlJCQjIiIhICAfHx4dHRwbGxoaGRkY/4ABgAICAIAQFBMTEhIREBAPDw4ODQ0MDAUMCwsKCgMKCQkECQkICAMIBwcEBwcGBoMGhQWGBIcDigKPAa8APvr39PLv7Onn5OHe3NnW1NLRz87My8nIx8bFxMPCwcC/vr28u7q5ubi3tra1tLSzsrKxsLCvr66ura2srKurA6uqqgOqqakDqaioA6inpwOnpqYEpqalpYOlhqSIo5CiBqGhoqKhoYahAqKigLWvqqain5uYlZOQjouJh4WCgH99e3l3dnRycW9ubGtpaGdlZGNhYF9eXFtaWVhXVVRTUlFQT05NTEtKSUhHRkVERENCQUA/Pj09PDs6OTk4NzY1NTQzMjIxMC8vLi0tLCsqKikoKCcmJiUkJCMiIiEhIB8fHh0dHBwbGhoZGRgX/4ABgAICAIARFRQTExIRERAQDw8ODg0NDAwFDAsLCgoDCgkJBAkJCAgDCAcHBAcHBgaDBoUFhgSHA4oCjwGuAD369/Xy7+zq5+Ti39za19TT0dDOzcvKycjHxsXEw8LBwL++vby7u7q5uLi3tra1tLSzs7KxsbCwr6+urq2tA62srAOsq6sDq6qqBKqqqakDqaioBKiop6eEp4emjKWYpIC2sKuno5+cmZaTkY6MiYeFg4F/fXt5eHZ0c3FvbmxraWhnZWRjYWBfXlxbWllYVlVUU1JRUE9OTUxLSklIR0ZFRENCQkFAPz49PDw7Ojk4Nzc2NTQ0MzIxMTAvLi4tLCsrKikpKCcnJiUlJCMjIiEhICAfHh4dHBwbGxoZGRgYF/+AAYACAgCAEhUUFBMTEhEREBAPDw4ODQ0MDAUMCwsKCgMKCQkECQkICAMIBwcEBwcGBoMGhQWGBIcDigKOAa4APvr39fLv7ern5eLg3drY1dPS0M/OzMvKycfGxcTDw8LBwL++vb28u7q5ubi3t7a2tbS0s7OysrGxsLCvr66uBK6ura0Era2srAOsq6sEq6uqqgSqqqmphKmJqKKngLexrKikoJ2al5SRj4yKiIWDgX99fHp4dnVzcXBubWtqaGdlZGNhYF9eXFtaWVhWVVRTUlFQT05NTEtKSUhHRkVEQ0JBQEA/Pj08Ozo6OTg3NjY1NDMyMjEwLy8uLS0sKyoqKSgoJyYmJSQkIyIiISAgHx4eHR0cGxsaGhkYGBcX/4ABgAICAIATFhUUFBMSEhEREBAPDw4ODQ0MDAUMCwsKCgMKCQkECQkICAMIBwcEBwcGBoMGhQWGBIcDigKOAa0APfr49fLw7ero5ePg3tvZ1tTS0dDOzczKycjHxsXEw8LCwcC/vr69vLu7urm5uLi3tra1tbS0s7OysrGxsLADsK+vBK+vrq4Erq6trQStraysg6yHq46qjqmOqoC4sq2ppaGempeVko+NioiGhIKAfnx6eHd1c3Fwbm1ramhnZmRjYmBfXlxbWllYVlVUU1JRUE9OTUxLSklIR0ZFRENCQUA/Pj49PDs6OTg4NzY1NDQzMjExMC8uLi0sKysqKSkoJycmJSQkIyIiISEgHx8eHR0cGxsaGhkYGBcXFv+AAYACAgCADxYVFRQUExISEREQDw8ODgcODQ0MDAsLAwsKCgMKCQkDCQgIBAgIBwcEBwcGBgQGBgUFhAWGBIcDiQKOAa0APPr49fLw7evo5uPh3tzZ19TT0tDPzszLysnIx8bFxMPCwsHAv7++vby8u7q6ubm4uLe3tra1tbS0s7OysgOysbEDsbCwg7CFr4WuiK2jrIatgLqzrqmlop6bmJWSkI2LiYaEgoB+fHp5d3VzcnBvbWtqaWdmZGNiYF9eXFtaWVhWVVRTUlFQT05NS0pJSEdHRkVEQ0JBQD8+PTw8Ozo5ODc3NjU0MzMyMTAvLy4tLCwrKiopKCcnJiUlJCMjIiEhIB8fHh4dHBwbGhoZGRgXFxYW/4ABgAICAIAQFxYVFRQTExISERAQDw8ODgcODQ0MDAsLAwsKCgMKCQkDCQgIBAgIBwcEBwcGBgQGBgUFhAWFBIgDiQKOAawANvr49fPw7uvp5uTh39za2NXU0tHQzs3My8rJyMfGxcTDwsLBwMC/vr69vLu7urq5ubi4t7e2tgW2tbW0tAW0s7OysoSyhbGGsImvl66Or4OwgLu0r6qmo5+cmZaTkI6MiYeFg4F/fXt5d3V0cnBvbWxqaWdmZGNiYF9eXFtaWVhWVVRTUlFQTk1MS0pJSEdGRURDQkJBQD8+PTw7Ojo5ODc2NTU0MzIxMTAvLi4tLCsrKikoKCcmJiUkJCMiIiEgIB8eHh0cHBsbGhkZGBcXFhYV/4ABgAICAIATFxcWFRUUExMSEhEQEA8PDg4NDQUNDAwLCwMLCgoDCgkJAwkICAQICAcHBAcHBgYEBgYFBYMFhgSHA4oCjQGsADf6+PXz8O7s6efk4uDd29jW1NPR0M/OzcvKycjIx8bFxMPDwsHBwL+/vr29vLy7u7q6ubm4uLe3Bbe2trW1A7W0tAS0tLOzhbOHso6xhLCVsYqygLy1sKuno6CdmpeUkY+MioeFg4F/fXt5d3Z0cnFvbWxqaWdmZWNiYF9eXFtaWVhWVVRTUlFPTk1MS0pJSEdGRURDQkFAPz8+PTw7Ojk4ODc2NTQzMzIxMC8vLi0sLCsqKSkoJycmJSQkIyIiISAgHx4eHR0cGxsaGRkYGBcWFhUV/4ABgAICAIAUGBcWFhUUFBMTEhEREBAPDw4ODQ0FDQwMCwsDCwoKAwoJCQMJCAgECAgHBwQHBwYGBAYGBQWDBYYEhwOJAo4BqwAz+vj18/Hu7Onn5eLg3tzZ19XT0tHQzs3My8rJyMfHxsXExMPCwsHAwL++vr29vLy7u7q6Bbq5ubi4A7i3twO3trYDtrW1hLWJtKCzi7SHtYC9trGsqKShnZqXlZKPjYqIhoSCf318enh2dHNxb25sa2loZmVjYmBfXlxbWllXVlVUU1JQT05NTEtKSUhHRkVEQ0JBQD8+PTw8Ozo5ODc2NTU0MzIxMTAvLi4tLCsqKikoKCcmJSUkIyMiISEgHx8eHR0cGxsaGhkYGBcXFhUVFP+AAYACAgCAFRkYFxYWFRQUExMSEREQEA8PDg4NDQUNDAwLCwMLCgoDCgkJAwkICAQICAcHBAcHBgYEBgYFBYMFhgSHA4kCjQGrADH6+Pbz8e7s6ujl4+He3NrY1tTT0dDPzs3My8rJyMfHxsXExMPCwsHBwMC/vr69vby8A7y7uwO7uroDurm5A7m4uAO4t7cEt7e2toq2mrWLtom3hLiAvreyramlop6bmJWSkI2LiYaEgoB+fHp4dnVzcW9ubGtpaGZlY2JhX15dW1pZV1ZVVFNRUE9OTUxLSklIR0ZFRENCQUA/Pj08Ozo5OTg3NjU0MzMyMTAvLy4tLCwrKikpKCcmJiUkJCMiIiEgHx8eHh0cHBsaGhkYGBcXFhUVFBT/gAGAAgIAgBYZGBgXFhYVFBQTExIRERAQDw8ODg0NBQ0MDAsLAwsKCgMKCQkDCQgIBAgIBwcEBwcGBgQGBgUFgwWGBIcDiQKNAaoAL/r49vPx7+zq6Obj4d/d29nW1NPS0dDPzszLy8rJyMfHxsXFxMPDwsLBwcDAv76+A769vQO9vLwDvLu7A7u6ugO6ubkEubm4uIa4nLeLuIi5h7oCu7uAv7mzrqqmop+cmZaTkI6LiYeFgoB+fHp5d3VzcXBubGtpaGZlY2JhX15dW1pZV1ZVVFNRUE9OTUxLSklHRkVEQ0JBQEA/Pj08Ozo5ODc2NjU0MzIxMTAvLi0tLCsqKikoJycmJSUkIyIiISAgHx4eHRwcGxoaGRkYFxcWFhUUFBP/gAGAAgIAgBcaGRgYFxYWFRQUExMSEREQEA8PDg4NDQUNDAwLCwMLCgoDCgkJAwkICAQICAcHBAcHBgYEBgYFBYMFhgSGA4kCjQGqADL6+Pbz8e/t6+jm5OLg3tvZ19XU09HQz87NzMvKycnIx8fGxcXExMPDwsLBwcDAv7++vgO+vb0Evb28vAS8vLu7BLu7urqDupq5i7qJu4i8hr2Awbq0r6uno6CdmpeUkY+MioeFg4F/fXt5d3VzcnBubWtqaGZlY2JhX15dW1pZV1ZVVFJRUE9OTUxKSUhHRkVEQ0JBQD8+PTw7Ozo5ODc2NTQ0MzIxMC8vLi0sKysqKSgoJyYlJSQjIyIhISAfHx4dHRwbGxoZGRgXFxYWFRQUExP/gAGAAgIAgBgbGhkYGBcWFhUUFBMTEhEREBAPDw4ODQ0FDQwMCwsDCwoKAwoJCQMJCAgECAgHBwQHBwYGBAYGBQWDBYUEhwOJAo0BqQAw+vj29PHv7evp5+Ti4N7c2tjW1NPS0dDPzs3My8rJycjIx8bGxcXExMPDwsLBwcDAA8C/vwO/vr4Evr69vYO9hbybu4q8h72Ivoe/g8CAwru1sKyopKGempeVko+NioiGg4F/fXt5d3Z0cnBvbWtqaGdlZGJhX15dW1pZV1ZVVFJRUE9OTUtKSUhHRkVEQ0JBQD8+PTw7Ojk4ODc2NTQzMjExMC8uLS0sKyopKSgnJiYlJCQjIiEhIB8fHh0dHBsbGhkZGBgXFhYVFRQTExL/gAGAAgIAgBcbGhoZGBgXFhYVFBQTExIRERAQDw8ODgcODQ0MDAsLAwsKCgMKCQkDCQgIBAgIBwcEBwcGBgQGBgUFgwWFBIcDiAKNAakAKfr49vTy7+3r6efl4+Hf3dvZ19XU09HQz87OzczLysnJyMjHx8bFxcTEBcTDw8LCBcLBwcDABMDAv7+Dv4W+ir0EvLy9vY69ib6Iv4fAhsGGwgHDgMO8t7KtqaWinpuYlZOQjYuIhoSCgH58enh2dHJwb21ramhnZWRiYV9eXVtaWVdWVVNSUVBPTUxLSklIR0ZFRENCQUA/Pj08Ozo5ODc2NTQ0MzIxMC8vLi0sKysqKSgnJyYlJSQjIiIhICAfHh4dHBwbGhoZGBgXFhYVFRQTExIS/4ABgAICAIAYHBsaGhkYGBcWFhUUFBMTEhEREBAPDw4OBQ4NDQwMBQwLCwoKAwoJCQMJCAgECAgHBwQHBwYGBAYGBQUEBQUEBIQEhwOIAo0BqAAp+vj29PLw7uvp5+Xj4d/d29nY1tTT0tHQz87NzMzLysrJyMjHx8bGxcUFxcTEw8MDw8LCA8LBwQTBwcDAhMCJv4m+i7+JwIjBhsKGw4bEhMWAxb64s66qpqOfnJmWk5GOjImHhIKAfnx6eHZ0cnFvbWxqaGdlZGJhX15dW1pYV1ZVU1JRUE5NTEtKSUhHRURDQkFAPz49PDs6OTk4NzY1NDMyMTEwLy4tLCwrKikpKCcmJSUkIyMiISAgHx4eHRwcGxoaGRgYFxcWFRUUExMSEhH/gAGAAgIAgBkdHBsaGhkYGBcWFhUUFBMTEhEREBAPDw4OBQ4NDQwMBQwLCwoKAwoJCQMJCAgECAgHBwMHBgaDBoQFhgSGA4kCjAGoACv6+Pb08vDu7Oro5uTi4N7c2tjW1dPT0tHQz87NzMzLysrJycjIx8fGxsXFA8XExATExMPDA8PCwoPCisGOwIjBicKHw4bEhsWGxoXHAciAxr+5tK+rp6SgnZqXlJGPjIqHhYOBfnx6eHZ1c3FvbmxqaWdlZGJhX15dW1pYV1ZVU1JRUE5NTEtKSUdGRURDQkFAPz49PDs6OTg3NjU1NDMyMTAvLi4tLCsqKikoJycmJSQkIyIhISAfHx4dHBwbGhoZGRgXFxYVFRQUExISERH/gAGAAgIAgBoeHRwbGhoZGBgXFhYVFBQTExIRERAQDw8ODgUODQ0MDAUMCwsKCgMKCQkDCQgIBAgIBwcDBwYGBAYGBQWDBYUEhwOIAowBqAAm+vj29PLw7uzq6Obk4uDf3dvZ19XU09LR0M/Pzs3MzMvKysnJyMgFyMfHxsYDxsXFBMXFxMQExMTDw4XDl8KHw4jEhcWHxoXHhsiFyYPKgMjAurWxrKiloZ6bmJWSj42KiIaDgX99e3l3dXNxb25samlnZWRiYV9eXVtaWFdWVFNSUU9OTUxLSUhHRkVEQ0JBQD8+PTw7Ojk4NzY1NDMyMTEwLy4tLCwrKikoKCcmJSQkIyIiISAfHx4dHRwbGxoZGRgXFxYVFRQUExISEREQ/4ABgAICAIAZHh4dHBsaGhkYGBcWFhUUFBMTEhIREBAPDwcPDg4NDQwMBQwLCwoKAwoJCQMJCAgECAgHBwMHBgYEBgYFBYMFhQSHA4gCjAGnACP6+Pb08vDu7Oro5+Xj4d/d3NrY1tTT09LR0M/Ozs3MzMvKygXKycnIyAPIx8cDx8bGg8aExZ7EhsWHxobHhciGyYXKhcuFzIDJwry2sq2ppqKfnJiWk5CNi4iGhIJ/fXt5d3VzcnBubGtpZ2ZkYmFfXl1bWlhXVlRTUlBPTk1MSklIR0ZFRENBQD8+PTw7Ojk4NzY2NTQzMjEwLy4uLSwrKikpKCcmJSUkIyIiISAgHx4dHRwbGxoZGRgXFxYWFRQUExMSEREQEP+AAYACAgCAGB8eHh0cGxoaGRgYFxYWFRQUExMSEhEQEAkQDw8ODg0NDAwFDAsLCgoDCgkJAwkICAQICAcHAwcGBgQGBgUFgwWFBIYDiAKMAacAJfr49vTy8O7s6+nn5ePh4N7c2tnX1dTT0tHR0M/Ozs3MzMvLysoFysnJyMgEyMjHx4THhcaQxY3GhceGyIbJhcqFy4XMhc2GzgHPgMvDvbizrqqno6CcmZaTkY6MiYeEgoB+fHp3dnRycG5sa2lnZmRjYV9eXVtaWFdWVFNSUE9OTUtKSUhHRURDQkFAPz49PDs6OTg3NjU0MzIxMTAvLi0sKysqKSgnJyYlJCMjIiEgIB8eHh0cHBsaGhkYGBcWFhUUFBMTEhEREBAP/4ABgAICAIAiIB8eHh0cGxsaGRgYFxYWFRUUExMSEhEREBAPDw4ODQ0MDAUMCwsKCgMKCQkDCQgIBAgIBwcDBwYGBAYGBQUEBQUEBIQEhgOIAosBpwAk+vj29PLw7+3r6efl5OLg3t3b2djW1NPT0tHQ0M/Ozs3MzMvLA8vKygPKyckEycnIyITImseIyIXJhcqGy4XMhc2FzoXPhdCD0YDMxb65tLCsqKShnZqXlJGPjIqHhYOAfnx6eHZ0cnBubWtpZ2ZkY2FfXlxbWlhXVVRTUVBPTkxLSklIRkVEQ0JBQD8+PTw7Ojk4NzY1NDMyMTAvLi0tLCsqKSgoJyYlJCQjIiEhIB8fHh0cHBsaGhkYGBcWFhUVFBMTEhEREBAPD/+AAYACAgCAIyEgHx8eHRwbGxoZGBgXFhYVFRQTExISEREQEA8PDg4NDQwMBQwLCwoKAwoJCQMJCAgDCAcHBAcHBgYEBgYFBQQFBQQEgwSGA4gCjAGmACP6+Pb08/Hv7evp5+bk4uHf3dza2NfV1NPS0tHQ0M/Ozs3MzAPMy8sDy8rKg8qIyY3IjMmIyoTLhcyFzYbOhM+F0ITRhdKF04DOxsC6tbGtqaWinpuYlZKPjYqIhYOBf3x6eHZ0cnBvbWtpaGZkY2FfXlxbWlhXVVRTUVBPTUxLSkhHRkVEQ0JAPz49PDs6OTg3NjU0MzIxMDAvLi0sKyoqKSgnJiUlJCMiIiEgHx8eHR0cGxoaGRgYFxYWFRUUExMSEhEQEA8PDv+AAYACAgCAJCIhIB8fHh0cGxsaGRkYFxcWFRUUExMSEhEREBAPDw4ODQ0MDAUMCwsKCgMKCQkDCQgIAwgHBwQHBwYGBAYGBQUEBQUEBIMEhgOHAowBpgAl+vj39fPx7+3r6ujm5OPh397c29nY1tXU09LR0dDQz87Ozc3MzAPMy8uDy5rKicuHzIXNhM6Ez4bQhNGF0oXThdSF1YDQyMG8t7Kuqqajn5yZlpOQjYuIhoSBf317eXd1c3FvbWtpaGZkY2FfXlxbWVhXVVRSUVBOTUxLSUhHRkVDQkFAPz49PDs6OTg3NjU0MzIxMC8uLSwsKyopKCcnJiUkIyMiISAgHx4dHRwbGxoZGRgXFxYVFRQTExISERAQDw8ODv+AAYACAgCAJSMiISAgHx4dHBwbGhkZGBcXFhUVFBMTEhIRERAQDw8ODg0NDAwFDAsLCgoDCgkJAwkICAMIBwcEBwcGBgMGBQWDBYUEhQOIAosBpgAk+vn39fPx7+3r6ujm5ePh4N7d29rY19XU09PS0dHQ0M/Ozs3NA83MzITMlsuHzIfNhs6Fz4TQhNGF0oTThdSG1YTWhdcB2IDSycO9uLOvq6ekoJ2al5SRjoyJhoSCf317eXd1c3FvbWtqaGZkY2FfXlxbWVhWVVRSUVBOTUxKSUhHRURDQkFAPz08Ozo5ODc2NTQzMjEwMC8uLSwrKikoKCcmJSQkIyIhICAfHh4dHBsbGhkZGBcXFhUVFBMTEhIREBAPDw4ODf+AAYACAgCAJiQjIiEgIB8eHRwcGxoZGRgXFxYVFRQUExISEREQEA8PDg4NDQwMBQwLCwoKAwoJCQMJCAgDCAcHAwcGBgQGBgUFBAUFBASDBIYDhwKLAaYAJvv59/Xz8e/t7Oro5+Xj4uDf3dza2djW1dTT0tLR0dDQz8/Ozs3Ng82TzIjNhs6Gz4XQhdGE0oTThNSF1YXWhdeF2IXZAdqA08vFv7q1sKyopaGem5eVko+MioeFgoB+e3l3dXNxb21ramhmZGNhX15cW1lYVlVTUlFPTk1LSklIRkVEQ0JAPz49PDs6OTg3NjU0MzIxMC8uLSwrKiopKCcmJSUkIyIhISAfHh4dHBwbGhkZGBcXFhUVFBQTEhIREBAPDw4ODQz/gAGAAgIAgCclJCMiISEgHx4dHRwbGhoZGBcXFhUVFBQTEhIRERAQDw8ODg0NDAwFDAsLCgoDCgkJAwkICAMIBwcDBwYGBAYGBQUEBQUEBIMEhQOIAooBpgAj+/n39fPx7+7s6ujn5eTi4d/e3Nva2NfW1NTT0tLR0dDQz88Dz87OBM7Ozc2OzYnOhc+F0IXRhtKE04XUg9WE1oXXhdiE2YbahdsB3IDVzcbAu7ayrammop+bmJWSkI2KiIWDgH58enh1c3FvbmxqaGZlY2FfXlxbWVhWVVNSUE9OTEtKSUdGRURCQUA/Pj08Ojk4NzY1NDMyMTAvLi4tLCsqKSgnJyYlJCMiIiEgHx8eHRwcGxoaGRgXFxYVFRQUExISEREQDw8ODg0NDP+AAYACAgCAKCYlJCMiIiEgHx4dHRwbGhoZGBgXFhYVFBQTExIRERAQDw8ODg0NDAwFDAsLCgoDCgkJAwkICAMIBwcDBwYGBAYGBQUEBQUEBAQEBAMDhAOHAosBpQAg+/n39fPx7+7s6unn5uTj4eDe3dva2djW1dTT09LS0dEF0dDQz88Ez8/Ozo3Oh8+H0ITRhNKF04XUhdWE1oTXhNiE2YXahduF3IXdAd6A18/Iwry4s6+rp6OgnJmWk5COi4iGg4F/fHp4dnRycG5samhmZWNhX15cW1lYVlVTUlBPTUxLSkhHRkRDQkFAPz08Ozo5ODc2NTQzMjEwLy4tLCsqKSgoJyYlJCMjIiEgHx8eHRwcGxoaGRgYFxYWFRQUExISEREQDw8ODg0NDAv/gAGAAgIAgCknJiUkJCMiISAfHh4dHBsbGhkYGBcWFhUUFBMTEhEREBAPDw4ODQ0MDAUMCwsKCgMKCQkFCQgIBwcEBwcGBgMGBQUEBQUEBIMEhQOHAosBpQAf+/n39fPx7+7s6unn5uTj4eDf3dzb2djX1tXU09PS0gPS0dED0dDQA9DPz43PhtCG0YXShNOE1ITVhdaF14TYhNmE2oTbhdyE3Ybehd+A2dHKw765tLCsqKShnZqXlJGOjImGhIF/fXp4dnRycG5samhmZWNhX15cW1lXVlRTUVBPTUxLSUhHRURDQkA/Pj08Ozo4NzY1NDMyMTAvLi0sLCsqKSgnJiUkJCMiISAgHx4dHRwbGhoZGBgXFhYVFBQTEhIRERAPDw4ODQ0MCwv/gAGAAgIAgCooKCcmJSQjIiEgHx8eHRwbGxoZGRgXFhYVFRQTExISERAQDw8ODg0NDAwFDAsLCgoFCgkJCAgDCAcHAwcGBgQGBgUFBAUFBAQEBAQDA4QDhwKKAaUAHvv59/Xz8fDu7Ovp5+bk4+Lg397c29rZ2NfW1NTT0wPT0tID0tHRBNHR0NCL0IfRhNKF04XUg9WE1oTXhdiE2YXahNuE3ITdhd6E34XgheGA29PLxcC6trGtqaWinpuYlZKPjIqHhIJ/fXt5dnRycG5samhmZWNhX15cWllXVlRTUVBOTUxKSUhGRURCQUA/Pjw7Ojk4NzY1NDMyMTAvLi0sKyopKCcmJiUkIyIhISAfHh4dHBsbGhkYGBcWFhUUFBMSEhEREA8PDg4NDQwMCwr/gAGAAgIAgCsqKSgnJiUkIyIhICAfHh0cHBsaGRkYFxcWFRUUExMSEhEQEA8PDg4NDQwMBwwLCwoKCQkDCQgIAwgHBwMHBgYEBgYFBQMFBASDBIUDhwKKAaUAH/v59/Xz8fDu7Ovp6Obl4+Lh397d3Nva2NfW1dTU09ME09PS0gTS0tHRi9GH0oTThNSE1YTWhNeD2ITZhdqE24XchN2E3oTfheCE4Ybig+OA3tTNx8G8t7Ouqqejn5yZlpOQjYqHhYKAfnt5d3VycG5samhnZWNhX15cWllXVlRSUVBOTUtKSUdGRUNCQUA+PTw7Ojk3NjU0MzIxMC8uLSwrKikoKCcmJSQjIiIhIB8eHh0cGxsaGRkYFxYWFRQUExMSEREQDw8ODg0NDAwLCgr/gAGAAgIAgCwrKikoJyYlJCMiISEgHx4dHRwbGhoZGBcXFhUVFBMTEhIREBAPDw4ODQ0MDAcMCwsKCgkJAwkICAMIBwcDBwYGAwYFBQQFBQQEBAQEAwOEA4YCigGlAB77+ff18/Hw7uzr6ejm5ePi4eDf3dzb2tnY19bV1NQD1NPTg9OO0oXThNSE1YTWg9eF2IPZhNqE24Tchd2E3oTfhOCE4YbihOOG5AHlgODXz8nDvrm0sKyopKCdmpeTkI6LiIWDgH58eXd1c3FubGpoZ2VjYV9eXFpZV1VUUlFPTkxLSkhHRURDQkA/Pj08Ojk4NzY1NDMyMTAvLi0sKyopKCcmJSQjIyIhIB8fHh0cGxsaGRkYFxYWFRQUExMSEREQEA8ODg0NDAwLCgoJ/4ABgAICAIAvLCsqKSgnJiUkIyMiISAfHh0dHBsaGhkYFxcWFRUUExMSEhEREA8PDg4NDQwMCwsFCwoKCQkFCQgIBwcDBwYGBAYGBQUDBQQEgwSFA4YCigGlAB/7+ff18/Hw7uzr6ejm5eTi4eDf3t3c29rZ2NfW1dTUg9SQ04TUhNWE1oPXg9iE2YTahNuD3IPdhN6G34TghOGE4oXjhuSE5YXmgOLZ0cvFv7q2sa2ppaGem5eUkY6LiYaDgX58end1c3FvbWtpZ2VjYV9dXFpYV1VUUlBPTUxLSUhGRURCQUA/PTw7Ojk4NjU0MzIxMC8uLSwrKikoJyYlJSQjIiEgIB8eHRwcGxoZGRgXFxYVFRQTExIRERAQDw4ODQ0MDAsKCgkJ/4ABgAICAIAyLi0sKikoKCcmJSQjIiEgHx4eHRwbGxoZGBgXFhUVFBQTEhIRERAPDw4ODQ0MDAsLCgoFCgkJCAgDCAcHAwcGBgMGBQUEBQUEBAQEBAMDgwOHAokBpQAf+/n39fPx8O7s6+no5uXk4+Hg397d3Nva2dnY19bV1QPV1NSQ1IPVhNaE14PYg9mD2oTbhNyD3YPehN+E4IXhhOKE44XkheWG5oXnAujogOTb08zGwby3sq6qpqOfnJiVko+MiYeEgX98enh1c3FvbWtpZ2VjYV9dXFpYV1VTUlBPTUxKSUdGRUNCQT8+PTw6OTg3NjU0MzEwLy4tLCsqKSgoJyYlJCMiISAgHx4dHBwbGhkZGBcXFhUVFBMTEhEREBAPDg4NDQwMCwoKCQkI/4ABgAICAIA1Ly4tLCsqKSgnJiUkIyIhICAfHh0cGxsaGRgYFxYWFRQUExISEREQDw8ODg0NDAwLCwoKCQkDCQgIAwgHBwMHBgYDBgUFAwUEBIMEhQOGAooBpAAh+/n39fPx7+7s6+no5uXk4+Lg397d3dzb2tnY2NfW1tXVkNWE1oPXg9iE2YPag9uD3IPdhN6D34PghOGE4oTjheSG5YTmheeG6IXpgOfd1c7Iw725tLCrp6SgnZmWk5CNioeEgn99enh2c3FvbWtpZ2VjYV9dW1pYVlVTUVBOTUtKSEdGRENCQD8+PDs6OTg2NTQzMjEwLy4tLCsqKSgnJiUkIyIiISAfHh0dHBsaGhkYFxcWFRUUExMSEREQEA8ODg0NDAwLCgoJCQgI/4ABgAICAIA2MS8uLSwrKikoJyYlJCMiISEgHx4dHBwbGhkZGBcWFhUUFBMSEhEREA8PDg4NDQwMCwsKCgkJBQkICAcHAwcGBgMGBQUEBQUEBAQEBAMDgwOGAooBpAAh+vn39fPx7+7s6+no5uXk4+Lh4N/e3dzb29rZ2NjX19bWjtaF14PYg9mE2oPbg9yD3YPeg9+D4IThg+KE44PkheWG5oTnheiG6YbqAuvrf+nf19DKxL+6tbGtqaWhnpqXlJGOi4iFgoB9e3h2dHFvbWtpZ2VjYV9dW1pYVlRTUVBOTEtJSEdFREJBQD49PDs5ODc2NTQyMTAvLi0sKyopKCcmJSQjIyIhIB8eHR0cGxoaGRgXFxYVFRQTExIRERAQDw4ODQ0MDAsKCgkJCAgBCP+AAYACAgCAOTIxMC8uLSsqKSgnJiUkJCMiISAfHh0dHBsaGRkYFxYWFRQUExISERAQDw8ODg0NDAwLCwoKCQkICAMIBwcDBwYGAwYFBQMFBAQEBAQDA4MDhgKKAaQAI/r49/Xz8e/u7Ovp6Obl5OPi4eDf3t3d3Nva2tnZ2NjX19bWBNbW19eH14XYhNmD2oPbg9yD3QTe3t/fA9/g4APg4eED4eLiBOLi4+ME4+Pk5APk5eUD5ebmBObm5+eD54bohemF6ofrhOx+7OLa08zGwby3sq6qpqKfm5iUkY6LiIaDgH57eXZ0cm9ta2lnZWNhX11bWVhWVFJRT05MS0lIRkVDQkE/Pj07Ojk4NjU0MzIxMC4tLCsqKSgnJiUlJCMiISAfHh4dHBsaGhkYFxcWFRUUExMSEREQEA8ODg0NDAwLCgoJCQgIAggH/4ABgAICAIA1NDIxMC8uLSwrKikoJyYlJCMiISAfHh4dHBsaGhkYFxYWFRQUExISERAQDw8ODQ0MDAsLCgoHCgkJCAgHBwMHBgYDBgUFBAUFBAQEBAQDAwQDAwIChAKKAaQAIPr49vXz8e/u7Ovp6Obl5OPi4eDf3t7d3Nzb2trZ2djYA9jX14TXhtiE2YTahNuD3ATd3d7eA97f3wPf4OAD4OHhA+Hi4gPi4+MD4+TkBOTk5eUD5ebmA+bn5wTn5+jog+iF6YbqheuF7Ijtf+/k3NXOyMO9uLSvq6ejoJyZlZKPjImGg4F+e3l2dHJvbWtpZ2VjYV9dW1lXVlRSUE9NTEpJR0ZEQ0FAPz08Ozk4NzY1MzIxMC8uLSwrKikoJyYlJCMiISAfHx4dHBsbGhkYFxcWFRUUExMSEREQEA8ODg0NDAwLCgoJCQgIBwcBB/+AAYACAgCAODU0MzIxLy4tLCsqKSgnJiUkIyIhIB8fHh0cGxoaGRgXFxYVFBQTEhIREBAPDw4NDQwMCwsKCgkJBQkICAcHAwcGBgMGBQUDBQQEBAQEAwODA4YCiQGkACD6+Pb08/Hv7ezq6ejm5eTj4uHg39/e3d3c3Nvb2trZ2QPZ2NiF2ITZhNqD24TchN0E3t7f3wPf4OAD4OHhA+Hi4gPi4+MD4+TkA+Tl5QPl5uYE5ubn5wPn6OgE6Ojp6QTp6erqg+qF64bshu2I7gHvfvLn3tfQysS/urWxrailoZ2alpOQjYqHhIF+fHl3dHJwbWtpZ2VjYV9dW1lXVVRSUE5NS0pIR0VEQkE/Pj07Ojk4NjU0MzIwLy4tLCsqKSgnJiUkIyIhICAfHh0cGxsaGRgYFxYVFRQTExIRERAPDw4ODQ0MCwsKCgkJCAgHBwIHBv+AAYACAgCAPTc2NDMyMTAvLiwrKikoJyYlJCMiISEgHx4dHBsaGhkYFxcWFRQUExISERAQDw4ODQ0MDAsLCgoJCQgIBwcDBwYGAwYFBQMFBAQEBAQDA4MDhgKJAaQAHfr49vTz8e/t7Orp5+bl5OPi4eDg397e3d3c3NvbA9va2gPa2dmF2YPahNuD3ITdg96D34Pgg+GD4gTj4+TkBOTk5eUD5ebmA+bn5wPn6OgE6Ojp6QTp6erqBOrq6+sE6+vs7IPsh+2G7ojvAvDwffXq4dnSzMbBvLeyrqqmop6bl5SQjYqHhIJ/fHl3dHJwbWtpZ2ViYF5cW1lXVVNRUE5MS0lIRkVDQkA/PTw7OTg3NjQzMjEwLy0sKyopKCcmJSQjIiEhIB8eHRwbGxoZGBgXFhUVFBMTEhEREA8PDg4NDQwLCwoKCQkICAcHAwcGBv+AAYACAgCAOTk3NjU0MzEwLy4tLCsqKSgnJiUkIyIhIB8eHRwbGxoZGBcXFhUUExMSEREQEA8ODg0NDAsLCgoJCQUJCAgHBwUHBgYFBQQFBQQEAwQDA4MDhgKJAaQAGfr49vTy8e/t7Orp5+bl5OPi4eDg397e3d0D3dzcA9zb24PbhtqD24Pcg92D3oPfhOCD4YPiBOPj5OQD5OXlA+Xm5gbm5ufn6OgD6OnpBOnp6uqD6oTrhOyF7Ybuh++H8ITxfPjt5NzVzsjDvbm0r6uno5+cmJWRjouIhYJ/fHp3dXJwbWtpZ2RiYF5cWlhWVVNRT05MSklHRkRDQUA+PTs6OTg2NTQzMTAvLi0sKykoJyYlJCMjIiEgHx4dHBsbGhkYGBcWFRUUExMSEREQDw8ODg0NDAsLCgoJCQgIBwcEBwYGBf+AAYACAgCAPjo5ODc1NDMyMS8uLSwrKikoJyYlJCMiISAfHh0cGxsaGRgXFhYVFBMTEhEREA8PDg0NDAwLCwoKCQkICAcHAwcGBgMGBQUDBQQEBAQEAwMEAwMCAoQCiQGkABr6+Pb08vDv7evq6Ofm5eTj4uHg4N/f3t7d3QTd3dzchNyG24PcBN3d3t4D3t/fA9/g4APg4eED4eLiA+Lj4wPj5OQD5OXlA+Xm5gPm5+cD5+joA+jp6QPp6uoE6urr6wTr6+zsg+yE7YXuhu+I8IfxhPJ7++/m3tfQysW/urWxrKikoJ2ZlZKPi4iFgoB9end1cnBta2lnZGJgXlxaWFZUUlFPTUxKSEdFREJBPz48Ozk4NzY0MzIxLy4tLCsqKSgnJiUkIyIhIB8eHRwcGxoZGBgXFhUVFBMTEhEREA8PDg4NDAwLCwoKCQkICAcHBQcGBgUF/4ABgAICAIA6PDs6ODc2NTMyMTAvLi0rKikoJyYlJCMiISAfHh0cHBsaGRgXFhYVFBMTEhEREA8PDg0NDAwLCgoJCQcJCAgHBwYGAwYFBQMFBAQEBAQDAwQDAwIChAKJAaQAGPr49vTy8O7t6+ro5+bl5OPi4eDg39/e3gPe3d2H3YPcht0E3t7f3wXf4ODh4QXh4uLj4wPj5OQD5OXlBOXl5uYD5ufnA+fo6APo6ekD6erqBOrq6+sD6+zsBOzs7e0E7e3u7oTuhO+G8InxiPKD83z+8unh2dPMx8G8t7KuqaWhnpqWk4+MiYaDgH16eHVycG1raWZkYmBeXFpYVlRSUE5NS0lIRkRDQUA+PTw6OTc2NTQyMTAvLSwrKikoJyYlJCMiISAfHh0cHBsaGRgYFxYVFRQTExIRERAPDw4ODQwMCwsKCgkJCAgHBwYGBAYFBQT/gAGAAgIAgD8fPTs6OTg2NTQzMTAvLi0sKyooJyYlJCMiISAfHh0cHBsaGRgXFhYVFBMSEhEQEA8ODg0MDAsLCgoJCQgIBwcDBwYGAwYFBQMFBAQDBAMDBAMDAgKEAokBpAAWffj29PLw7uzr6ejn5uTj4+Lh4ODf3wPf3t6R3oPfBuDg4eHi4gXi4+Pk5APk5eUD5ebmA+bn5wPn6OgE6Ojp6QPp6uoD6uvrBOvr7OwE7Ozt7QTt7e7uBO7u7+8E7+/w8ITwhvGJ8ojzg/R7gfbs49zVz8nDvrm0r6uno5+bl5SQjYqGg4B9e3h1c3Bua2lmZGJgXltZV1VUUlBOTEtJR0VEQkE/Pjw7OTg3NTQzMTAvLi0rKikoJyYlJCMiISAfHh0dHBsaGRgYFxYVFRQTEhIRERAPDw4NDQwMCwsKCgkJCAgHBwYGBQYFBQQEA4GAgP2AAgIAgD0gPz08Ozk4NzY0MzIxMC4tLCsqKSgnJiQjIiEgHx4dHBsbGhkYFxYVFRQTEhIREA8PDg0NDAwLCgoJCQgIBQgHBwYGAwYFBQMFBAQDBAMDgwOFAokBpAAUffj29PLw7uzr6ejm5eTj4uLh4OAD4N/fBN/f3t6G3obfheCD4Qji4uPj5OTl5QXl5ubn5wPn6OgD6OnpBOnp6uoD6uvrBOvr7OwE7Ozt7QTt7e7uBO7u7+8E7+/w8IPwhvGG8ofzi/QC9fV6gvnv5t/X0cvFv7q1sayopKCcmJSRjYqHhIF+e3h1c3Bua2lmZGJfXVtZV1VTUU9NTEpIR0VDQkA/PTw6OTc2NTMyMS8uLSwrKignJiUkIyIhIB8eHR0cGxoZGBgXFhUVFBMSEhEQEA8PDg0NDAwLCwoKCQkICAcHBgYFBgUFBAQBBAOBgID9gAICAIBCIUE/Pj07Ojk3NjU0MjEwLy4sKyopKCcmJSQiISAfHh0cGxsaGRgXFhUUFBMSEREQDw4ODQ0MCwsKCgkJCAgHBwYGAwYFBQMFBAQDBAMDgwOFAogBpQAUffj28/Hv7uzq6efm5eTj4uLh4OAD4N/fit+E4IfhBuLi4+Pk5Afk5eXm5ufnBefo6OnpA+nq6gPq6+sE6+vs7ATs7O3tBO3t7u6D7oTvhPCF8YfyhvOF9I31AfZ5hPzy6eHa083Hwby3sq6ppaGdmZWSjouHhIF+e3h1c3Bua2hmZGFfXVtZV1VTUU9NS0lIRkRDQT8+PDs5ODc1NDIxMC8tLCsqKSgmJSQjIiEgHx4eHRwbGhkYGBcWFRUUExISERAQDw4ODQ0MDAsLCgoJCQgIBwcGBgUGBQUEBAIEAwOBgID9gAICAIBAIiFBQD89PDs5ODc1NDMyMC8uLSwqKSgnJiUkIyEgHx4dHBsbGhkYFxYVFBMTEhEQEA8ODQ0MDAsKCgkJCAgHBwUHBgYFBQMFBAQEBAQDAwQDAwICgwKIAaUAFH189fPx7+3r6ujn5uXk4+Lh4eDgBODg39+E34Xgg+GF4oXjCuTk5eXm5ufn6OgF6Onp6uoD6uvrA+vs7APs7e0E7e3u7oPuhO+F8IXxhvKG84f0hvWM9nOGgPXs5NzWz8nDvrm0r6qmop6alpKPi4iFgX57eHZzcG1raGZkYV9dWlhWVFJQTkxLSUdFQ0JAPz08Ojk3NjQzMjAvLi0rKikoJyYlIyIhIB8fHh0cGxoZGBgXFhUUFBMSEhEQEA8ODg0NDAwLCgoJCQgIBwgHBwYGBQUDBQQEAwQDAwSBgYCA/IACAgCARSMiREJBPz48Ozo4NzY0MzIxLy4tLCspKCcmJSQjIiAfHh0cGxoZGBcXFhUUExIRERAPDg4NDAwLCwoKCQkICAcHBgYFBQMFBAQEBAQDAwQDAwICgwKIAaUAFH189fPx7+3r6ujn5uTj4+Lh4eDgiuCD4YPig+OE5IXlCubm5+fo6Onp6uoF6uvr7OwD7O3tA+3u7gTu7u/vg++E8ITxhvKH84b0iPWH9or3dIiB+e/n39jRy8XAurWwrKejn5uXk4+MiIWCf3x5dnNwbWtoZmNhX1xaWFZUUlBOTEpIRkVDQT8+PDs5ODY1MzIxLy4tLCopKCcmJSQjIiEgHx4dHBsaGRgXFxYVFBQTEhIREBAPDg4NDQwLCwoKCQkICAcHBQcGBgUFAwUEBAMEAwMBAwSBgYCA/IACAgCAQyQjRkRDQUA+PTw6OTg2NTQyMTAvLSwrKignJiUkIyIgHx4dHBsaGRgXFhUUFBMSERAQDw4NDQwLCwoKCQkICAcHBgYFBgUFBAQEBAQDAwQDAwICgwKIAaUAEn189fPx7u3r6ejm5eTj4uLh4QPh4OCG4IPhg+KD44PkBOXl5uYE5ubn5wbn5+jo6ekH6erq6+vs7APs7e0D7e7uA+7v7wTv7/DwBPDw8fEE8fHy8oPyhvOI9Ib1ifaI94f4c4qD/PLq4tvUzcfCvLeyramkoJyYlJCMiYaCf3x5dnNwbWtoZWNhXlxaV1VTUU9NS0lHRkRCQD89Ozo4NzU0MzEwLi0sKykoJyYlJCMiISAfHh0cGxoZGBcXFhUUFBMSEREQDw8ODg0MDAsLCgoJCQgIBwcFBwYGBQUDBQQEAwQDAwIDAgSBgYCA/IACAgCAQyUkJEZFQ0JAPz48Ozk4NzU0MzEwLy4sKyopJyYlJCMiIB8eHRwbGhkYFxYVFBMSEhEQDw4ODQwMCwoKCQkICAcHBgYDBgUFAwUEBAMEAwMEAwMCAoMCiAGlABJ9e3ry8O7s6unn5uXk4+Li4eED4eDgg+CE4YPiBOPj5OQF5OXl5uYF5ufn6OgD6Onpg+kE6urr6wfr7Ozt7e7uA+7v7wTv7/DwA/Dx8QTx8fLyBPLy8/OD84b0iPWI9ov3jPh0jIWA9u3l3dbQycS+ubOuqqWhnZmVkY2JhoN/fHl2c3BtamhlY2BeW1lXVVNQTkxKSUdFQ0FAPjw7OTc2NDMyMC8uLCsqKScmJSQjIiEgHx4dHBsaGRgXFxYVFBMTEhEREA8PDg0NDAwLCwoKCQkICAcHBgYDBgUFBQUEBAMDBAMDAgKDgf2AAgIAgEMmJiVJR0ZEQ0FAPj07Ojk3NjQzMjAvLi0rKiknJiUkIyEgHx4dHBsaGRgXFhUUExIREBAPDg0NDAsLCgkJCAgHBwYGAwYFBQMFBAQDBAMDBAMDAgKDAogBpQARfXt68vDu7Oro5+bk4+Pi4eEE4eHg4APg4eEE4eHi4gfi4+Pk5OXlCeXm5ufn6Ojp6QPp6uoD6uvrBOvr7OwD7O3tBe3u7u/vA+/w8ATw8PHxA/Hy8gPy8/ME8/P09IX0hvWH9ov3i/iJ+WyPh4H58Ojg2dLMxsC6tbCrpqKemZWRjoqGg398eXZzcG1qaGViYF1bWVZUUlBOTEpIRkRCQD89Ozo4NzU0MjEvLi0rKikoJiUkIyIhIB8eHRwbGhkYFxYWFRQTExIREBAPDw4NDQwMCwoKCQkHCQgIBwcGBgUGBQUEBAMEAwMEAwMCAgECg4H9gAICAIBBKCcmS0lIRkVDQkA/PTw6OTg2NTMyMS8uLSsqKScmJSQiISAfHh0bGhkYFxYVFBMSEhEQDw4ODQwLCwoKCQkIBwcFBwYGBQUDBQQEAwQDAwQDAwICgwKIAaUAEX17evLv7evp6Obl5OPi4uHhiOEI4uLj4+Tk5eUN5ebm5+fo6Onp6urr6wPr7OwD7O3tBO3t7u4D7u/vA+/w8APw8fED8fLyA/Lz8wTz8/T0g/SG9Yf2h/eP+Iz5g/pvkYqD/fPr49vUzsjCvLexrKijnpqWko6Kh4OAfHl2c3BtamdlYl9dWlhWU1FPTUtJR0VDQT8+PDo5NzY0MzEwLi0sKikoJiUkIyIhIB8eHRwbGhkYFxYWFRQTEhIREBAPDg4NDQwLCwoKCQkICAcHBQcGBgUFAwUEBAMEAwMDAwICAwICAYOB/YACAgCARikoJyZMSklHRURCQT8+PDs5ODc1NDIxMC4tKyopJyYlIyIhIB4dHBsaGRgXFhUUExIREA8PDg0MDAsKCgkJCAgHBwYGBQUDBQQEAwQDAwQDAwICgwKIAaUAEX17ennv7evp5+bl5OPi4uHhhuEE4uLj4xLj5OTl5ebm5+jo6enq6uvr7OwF7O3t7u4E7u7v74Pvg/CD8YPyg/OF9IX1hfaJ94f4lfmH+nCUjIaA9+7m3tfQysS+uLOuqaSfm5eTj4uHg4B8eXZzcG1qZ2RiX1xaV1VTUU5MSkhGREJAPz07OTg2NTMxMC8tLCopKCclJCMiISAfHh0cGxoZGBcWFRUUExISERAQDw4ODQwMCwsKCgkJCAgHBwYGAwYFBQMFBAQDBAMDAwMCAgQCAgEBhIH8gAICAIBGKikpKE5NS0lIRkVDQUA+PTs6ODc2NDMxMC4tKyopJyYlIyIhHx4dHBsZGBcWFRQTEhEREA8ODQ0MCwsKCQkICAcHBgYFBQMFBAQDBAMDBAMDAgKDAocBpgAQfXt6eO/s6unn5uTj4+Lh4YXhg+IX4+Pk5OXl5ubn5+jp6erq6+vs7O3t7u4F7u/v8PAE8PDx8YTxg/KD84T0hfWF9ob3iPiM+ZP6g/tvlo6Igvvx6eHa08zGwLq0r6qloJyYk4+Lh4SAfXl2c3BsaWdkYV5cWVdUUlBOS0lHRUNBPz48Ojg3NTMyMC8uLCspKCcmJCMiISAfHh0cGxoZGBcWFRQUExIRERAPDw4NDQwMCwsKCgkJCAgHBwYGBQYFBQQEBAQEAwMDAwICBAICAQEBAYSB/IACAgCARiwrKilRT01MSkhHRURCQD89PDo5NzY0MzEwLi0rKignJiQjIiAfHhwbGhkYFxYVFBMSERAPDg0NDAsLCgkJCAgHBwYGBQUDBQQEAwQDAwQDAwICgwKHAaYAEH17enju7Oro5uXk4+Li4eGE4YPiGuPj5OTl5ubn5+jp6erq6+vs7O3t7u7v7/DwA/Dx8QPx8vIE8vLz84TzhPSE9YX2hveG+I35i/qQ+2uZkYqE/vXs5NzVzsjBvLaxq6ahnZiUkIyIhIB9eXZyb2xpZmNhXltZVlRRT01LSEZEQkA+PTs5NzY0MjEvLiwrKignJiQjIiEgHx4dHBsaGRgXFhUUExMSEREQDw4ODQ0MCwsKCgkJCAgHBwUHBgYFBQMFBAQDBAMDBAMDAgIEAgIBAQIBAYSB/IACAgCARi0sKyopUVBOTEtJR0ZEQ0E/Pjw7OTg2NDMxMC4tKyooJyUkIiEgHh0cGxkYFxYVFBMSERAPDg4NDAwLCgoJCAgHBwYGBQUDBQQEAwQDAwQDAwICgwKHAaYAEH17eXh36+nn5uXk4+Li4eGD4YPiFuPk5OXl5ubn6Ojp6urr6+zs7e7u7+8F7/Dw8fED8fLyA/Lz8wPz9PQE9PT19YX1hfaG94b4iPmO+pb7bJyTjIaB+O/n39jRysO9uLKtp6KemZWQjIiEgH15dnJvbGlmY2BdW1hVU1BOTEpHRUNBPz07Ojg2NDMxMC4tKyooJyYlIyIhIB8eHBsaGRkYFxYVFBMTEhEQEA8ODg0MDAsLCgoJCQgIBwcGBgMGBQUDBQQEAwQDAwMDAgKDAoUBhYH7gAICAIBGLi0tLCtUUlFPTUtKSEZFQ0JAPj07OTg2NDMxMC4sKykoJiUjIiEfHh0bGhkYFxUUExIREBAPDg0MDAsKCgkICAcHBgYFBQMFBAQDBAMDBAMDAgKDAocBpgAPfXt5eHbr6efl5OPi4uHhg+Ec4uLj4+Tk5ebm5+fo6enq6+vs7O3u7u/v8PDx8QPx8vIF8vPz9PQD9PX1BPX19vaI9oX3hviH+Yz6kPuN/Gaflo+Ig/zz6uLa08zFv7mzrqmjn5qVkYyIhIB9eXVyb2toZWJfXVpXVVJQTUtJRkRCQD48Ojk3NTMyMC4tKyopJyYlIyIhIB8dHBsaGRgXFxYVFBMSEhEQDw8ODQ0MDAsKCgkJCAgHCAcHBgYFBQMFBAQDBAMDBAMDAgIEAgIBAYQBAQCFgfuAAgIAgEQwLy4tLCtVU1FQTkxKSUdFREJAPz07Ojg2NDMxLy4sKiknJiQjISAfHRwbGRgXFhUUExIREA8ODQ0MCwoKCQkIBwcGBgUGBQUEBAMEAwMEAwMCAgQCAgEBhgGmAA99e3l4dnXo5uXk4+Li4eED4eLiHOLj4+Tk5ebm5+jp6erq6+zs7e7u7+/w8PHx8vIF8vPz9PQD9PX1A/X29gT29vf3iveF+If5ivqS+5H8aaKZkYuFgPbt5d3VzsfBu7WvqqSfmpaRjYmEgH15dXJua2hlYl9cWVZUUU9MSkhFQ0E/PTs5NzY0MjAvLSwqKScmJSMiISAfHRwbGhkYFxYVFRQTEhEREA8ODg0NDAsLCgoJCQgIBwcGBgMGBQUDBQQEAwQDAwQDAwICBAICAQGEAQIAAIaB+oACAgCARDEwLy4tLFhWVFJQT01LSUhGREJBPz07Ojg2NDIxLy0sKignJSQiIR8eHBsaGRcWFRQTEhEQDw4NDQwLCgoJCQgHBwYGBQYFBQQEAwQDAwQDAwICBAICAQGGAaYADH17eXd2dejm5OPi4gXi4eHi4h3i4+Pk5eXm5+fo6erq6+zs7e3u7+/w8PHx8vLz8wXz9PT19QP19vYE9vb39wT39/j4hviL+Yn6i/uW/If9Y6WclI2Hgvrx6ODY0cnDvLawq6Wgm5aSjYmEgHx5dXFuamdkYV5bWFVTUE5LSUZEQkA+PDo4NjQyMS8tLCopJyYlIyIhIB4dHBsaGRgXFhUUExMSERAQDw4ODQwMCwsKCQkICAcIBwcGBgUFAwUEBAMEAwMEAwMCAoMChgGDAIaB+oACAgCARDMyMTAvLlpYV1VTUU9OTEpIRkVDQT89Ozk4NjQyMC4tKykoJiQjISAeHRwaGRgXFRQTEhEQDw4ODQwLCwoJCQgHBwYGBQYFBQQEAwQDAwQDAwICBAICAQGFAacAEHx6eXd2dOfl5OPi4uHh4uIe4uPj5OXl5ufo6Onq6+vs7e3u7+/w8PHx8vLz8/T0BfT19fb2A/b394P3hfiG+ZH6ivuR/JD9Zqmfl5CKhP706+Pb08zFvriyrKahnJeSjYmFgHx4dXFtamZjYF1aV1RST01KSEVDQT89Ojk3NTMxLy4sKykoJiUjIiEgHh0cGxoZGBcWFRQTEhIREA8PDg0NDAsLCgoJCQgIBwcGBgMGBQUDBQQEAwQDAwQDAwICBAICAQGEAYUAhoH6gAICAIBENTMyMTAvLltZV1ZUUlBOTEpJR0VDQT89Ozk3NTMyMC4sKiknJSQiIR8eHBsZGBcWFRQSERAPDw4NDAsLCgkJCAgHBgYFBgUFBAQDBAMDAwMCAoMChwGnAAt8enh3dXRz5ePi4gTi4eLiH+Lj4+Tl5ubn6Onp6uvs7O3u7+/w8PHx8vLz8/T09fUD9fb2A/b39wT39/j4BPj4+fmD+Yj6h/uD+or7j/yW/WKtopqSjIaB+O7m3dXOx8C5s62nopyXko6JhIB8eHRwbWlmYl9cWVZTUU5LSUZEQj89Ozk3NTMyMC4sKykoJiUjIiEfHh0cGxoZGBcWFRQTEhEREA8ODg0MDAsLCgkJCAgHBwUHBgYFBQMFBAQDBAMDBAMDAgKDAoYBhgCHgfmAAgIAgEQ2NTQzMjEwXlxaWFZVU1FPTUtJR0VDQT89Ozk3NTMxLy0rKSgmJCMhIB4dGxoZFxYVFBMSERAPDg0MCwsKCQkICAcGBgUGBQUEBAMEAwMDAwICgwKHAacAC3x6eHZ1dHPk4+LihOIY4+Pk5ebm5+jp6uvr7O3u7u/w8PHx8vPzB/P09PX19vYD9vf3BPf3+PgE+Pj5+YP5hvqV+4/8mf0B/mOxpp2Vj4iD/PLp4NjQycK7tK6oop2Yk46JhIB8eHRwbGhlYl5bWFVST01KSEVDQD48Ojg2NDIwLi0rKSgmJSMiIR8eHRwbGRgXFhUUFBMSERAPDw4NDQwLCwoKCQkICAcHBgYFBgUFBAQEBAQDAwQDAwICBAICAQGFAYcAh4H5gAICAIBEODc1NDMyMTBfXVtZV1VTUU9NS0lHRUNBPzw6ODY0MjAuLCopJyUjIiAfHRwaGRgWFRQTEhEQDw4NDAwLCgkJCAgHBgYFBgUFBAQDBAMDAwMCAoMChwGnAAt8enh2dXNycuPi4oPiGePj5OXm5+fo6err7O3t7u/v8PHx8vPz9PQH9PX19vb39wT39/j4BPj4+fkE+fn6+oT6i/uY/JT9i/5htamgmJGLhYD17OPa0svDvLavqaOemJOOiYSAe3dzb2toZGFdWldUUU5LSUZEQT89Ojg2NDIwLy0rKSgmJSMiIB8eHRsaGRgXFhUUExIRERAPDg4NDAwLCgoJCQgIBwcGBgMGBQUDBQQEAwQDAwQDAwICgwKGAYkAiIH4gAICAIBEOjg3NjU0MzJiYF5cWlhWVFJQTktJR0VCQD48Ojc1MzEvLSspJyYkIiEfHhwbGRgXFRQTEhEQDw4NDAwLCgkJCAgHBgYFBgUFBAQDBAMDAwMCAoMChwGnAAp8enh2dHNyceLig+Ia4+Pk5ebn6Onp6uvs7e7v7/Dx8fLz8/T09fUF9fb29/cD9/j4BPj4+fkE+fn6+oT6ifuM/Ij9hfyV/Y7+Xbmto5uUjYeC+e/m3dXNxb63sKqknpiTjomEf3t3cm5qZ2NgXFlWU1BNSkdFQkA9Ozk3NTMxLy0rKSgmJSMiIB8eHBsaGRgXFhUUExIREA8PDg0NDAsLCgoJCAgHBwUHBgYFBQMFBAQDBAMDBAMDAgKDAocBigCIgfiAAgIAgEY7Ojk4NjU0M2VjYV9dW1lXVFJQTktJR0RCQD07OTc0MjAuLCooJiUjISAeHBsaGBcWFBMSERAPDg0MDAsKCQkICAcGBgUFAwUEBAMEAwMDAwICgwKGAagACnx6d3Z0c3Jx4uKD4hzj5OXm5+jp6uvs7O3u7/Dw8fLy8/T09fX29vf3A/f4+AT4+Pn5BPn5+vqE+oj7i/yj/ZL+YL6xp56XkIqE/fPp4NfPx7+4saulnpmTjomEf3p2cm1qZmJeW1hUUU5LSEZDQT48OTc1MzEvLSsqKCYlIyIgHx0cGxoZFxYVFBMSEhEQDw4ODQwMCwoKCQkICAcHBgYFBQMFBAQDBAMDBAMDAgKDAocBjACIgfiAAgIAgEY9PDo5ODc2NTRmZGJgXlxZV1VSUE1LSEZEQT88Ojg1MzEvLSspJyUjIiAeHRsaGBcWFRMSERAPDg0MDAsKCQkICAcGBgUFAwUEBAMEAwMDAwICBAICAQGFAagAC3x5d3V0cnJxceLiHOLj5OXm5+jp6uvs7e7v7/Dx8vLz9PT19fb29/cD9/j4BPj4+fkD+fr6g/qI+4v8kP2I/ov9lv5cw7WropqTjIaA9uzi2dHJwbmyq6WfmZOOiIN+enVxbWhkYV1aVlNQTUpHREE/PDo4NTMxLy0rKigmJCMhIB8dHBsZGBcWFRQTEhEQDw8ODQwMCwsKCQkICAcHBgYFBgUFBAQEBAQDAwMDAgKDAocBjgCJgfeAAgIAgEY/Pjw7Ojg3NjVpZ2VjYV5cWVdVUk9NSkhFQ0A+Ozk3NDIwLiwqKCYkIiAfHRwaGRcWFRQSERAPDg0MDAsKCQkICAcGBgUFAwUEBAMEAwMDAwICBAICAQGFAagACHx5d3VzcnFxHXHi4uPk5ebn6Onq6+zt7u/w8fLy8/P09fX29vf3A/f4+AP4+fkD+fr6g/qH+4r8kP2S/gT9/f7+mP5ayLqvpZ2Vj4iC+u/l3NPKwruzrKafmZONiIN+eXRwa2djX1xYVVFOS0hFQkA9Ozg2NDEvLSsqKCYkIyEgHh0cGhkYFxYVFBMSERAPDg0NDAsLCgkJCAgHBwYGAwYFBQMFBAQDBAMDBAMDAgIEAgIBAYYBjwCJgfeAAgIAgEZBPz49Ozo5ODdsamhmZGFfXFpXVFJPTEpHREI/PDo4NTMxLiwqKCYkIiEfHRwaGRcWFRQSERAPDg0NDAsKCQkICAcGBgUFBQUEBAMDBAMDAgIEAgIBAYUBqAAIfHl2dHNycXEdceLj5OXm5+jp6uvt7u/w8PHy8/P09fX29vf3+PgD+Pn5A/n6+oP6hvuJ/I79sP6F/1bNv7OpoZiRi4T98uje1czEvLStpp+Zk42Hgn14c29qZmJeWlZTUExJRkNAPjs5NjQyMC0rKSgmJCMhHx4dGxoZFxYVFBMSERAPDw4NDAwLCgoJCAgHBwUHBgYFBQMFBAQDBAMDBAMDAgIEAgIBAYYBkQCJgfeAAgIAgEZDQUA+PTw7Ojk4bWtpZ2RhX1xZVlRRTktIRkNAPjs5NjQxLy0rKSclIyEfHhwbGRgWFRQTERAPDg0NDAsKCgkICAcGBgUFBQUEBAMDBAMDAgIEAgIBAYUBqAAHfHl2dHNxcYNxFuPk5ufo6ers7e7v8PHy8/P09fX29/cF9/j4+fkE+fn6+gP6+/uE+4n8iv2e/ob/j/6K/1nTxLitpJyUjYaA9uvh187FvbWtpp+ZkoyHgXx3cm1pZGBcWFVRTkpHREE+PDk3NDIwLispKCYkIiEfHhwbGRgXFhUUExIREA8ODQwMCwoKCQkICAcHBgYFBQMFBAQDBAMDBAMDAgIEAgIBAYYBkwCKgfaAAgIAgEZFQ0FAPz48Ozo5cW9samdkYV9cWVZTUE1KR0RCPzw6NzQyMC0rKSclIyEgHhwbGRgWFRQTEhAPDg4NDAsKCgkICAcGBgUFBQUEBAMDBAMDAgIEAgIBAYUBqAAHfHh2dHJxcYNxFuTl5+jp6+zt7u/w8fLz9PX19vf3+PgD+Pn5A/n6+gT6+vv7g/uI/Ij9nP6n/1faybyxqJ+XkImC+e7j2c/Gvraupp+YkoyGgHt1cWxnY15aVlNPTEhFQj88Ojc0MjAuKyknJSQiIB8dHBoZGBYVFBMSERAPDg0NDAsLCgkJCAgHBwYGBQUDBQQEAwQDAwMDAgKDAocBlgCKgfaAAgIAgEZHRUNCQD8+PTw7dHJvbWpnZGFeW1hVUk5LSUZDQD06ODUzMC4sKiglJCIgHh0bGRgXFRQTEhEQDw4NDAsKCQkICAcGBgUFBQUEBAMDBAMDAgIEAgIBAYQBqQAHfHh1c3JxcRdxcXLl5ujp6+zt7/Dx8vP09fX29/f4+AX4+fn6+gP6+/uD+4f8h/2S/rf/VeDPwbasopqSi4T88ebb0ci/tq6mn5iRi4V/eXRvamVhXVhUUU1JRkNAPTo3NTIwLSspJyUjIiAeHRsaGBcWFRQSERAPDw4NDAsLCgkJCAgHBwYGBQUDBQQEAwQDAwMDAgKDAocBmACKgfaAAgIAgEZJR0VEQkFAPz49PHVzcG1qZ2NgXVpWU1BNSkdEQT47OTYzMS8sKigmJCIgHh0bGhgXFRQTEhEQDw4NDAsKCQkICAcGBgUFBQUEBAMDAwMCAoMChgGpAAZ7eHVzcXGDcRVyc+jp6+zu7/Dx8/P09fb39/j4+fkD+fr6A/r7+wT7+/z8hPyH/ZD+vf9V59XHu7CmnZWNhoD06N3TycC3rqafl5GKhH54cm1oY19aVlJOS0dEQD06ODUyMC0rKSclIyEfHhwbGRgWFRQTEhEQDw4NDAwLCgkJCAgHBwYGBQUEBAMEAwMEAwMCAoMChwGaAIuB9YACAgCASEtJR0VEQ0JBQD89eXZzcGxpZmJfXFhVUk5LSEVCPzw5NzQxLy0qKCYkIiAfHRsaGBcWFBMSERAPDg0MCwoJCQgIBwYGBQUEBAMEAwMDAwICgwKGAakABnt3dHJxcRZxcXJzc+nr7O7v8fLz9PX29vf4+Pn5Bfn6+vv7g/uF/Ib9j/7C/1Pv3M3AtKqgmJCIgvfq39TKwLeupp6Xj4mCfHZxa2ZhXVhUUExIRUE+Ozg1MjAtKyknJSMhHx0cGhkXFhUTEhEQDw4NDAwLCgkJCAgHBwYGBQUEBAMEAwMEAwMCAgQCAgEBhgGcAIuB9YACAgCASE1KSUdGRURDQkA/fHl2c29saGRhXVpWU09MSUZDQD06NzQyLy0rKSYkIiEfHRsaGBcWFBMSERAPDg0MCwoJCQgHBwYGBQUEBAMEAwMDAwICBAICAQGFAakABnt3dHJxcRZxcnJzdOvs7vDx8vP09fb3+Pj5+fr6A/r7+wT7+/z8g/yG/Y3+x/9R+OPTxbmupJuSi4P57eHVy8G3rqadlo6HgXp0bmlkX1pWUU1JRUI+Ozg1MjAtKygmJCIgHh0bGRgWFRQTERAPDg0NDAsKCgkICAcHBgYFBQQEAwQDAwMDAgKDAocBnwCLgfWAAgIAgEgnTEpJSEdGRURCQX98eXVybmpmY19bWFRQTUpGQ0A9Ojg1MjAtKyknJSMhHx0cGhgXFhQTEhEQDw4NDAsKCQkIBwcGBgUFBAQDBAMDAwMCAgQCAgEBhQGpAAY9d3NycXEUcXJzdHXs7vDx8/T19vf4+Pn5+voD+vv7A/v8/IP8hf2N/sv/TIDr2cq+sqeelY2F/O/i18zBt66lnJSNhX94cmxmYVxXU05KRkM/PDg1MjAtKigmIyEfHhwaGRcWFBMSERAPDg0MCwoKCQgIBwYGBQUDBQQEAwQDAwMDAgKDAocBoQADgoGBiIH1gAICAIBIKE5MS0pJSEdGREODf3x4dHBsaGRgXVlVUk5KR0RBPjs4NTMwLispJyUjIR8dHBoYFxYUExIREA8ODQwLCgkJCAcHBgYFBQQEAwQDAwMDAgIEAgIBAYUBqQAFPXZzcXEVcXJzdHV27vDy8/T19vf4+fn6+vv7BPv7/PwE/Pz9/YP9jP7P/0qF8+DQw7aroZiPh//x5NjMwbetpJuTi4N8dm9pZF5ZVFBLR0M/PDg1Mi8tKiclIyEfHRsZGBYVExIREA8ODQwLCgkJCAcHBgYFBQUFBAQDAwQDAwICBAICAQGFAaQAA4KBgYiB9YACAgCASClQTk1MS0pJSEZEQ4J+enZybmpmYl5aVlJPS0hFQT47ODYzMC4sKSclIyEfHRwaGRcWFBMSERAPDg0MCwoJCQgHBwYGBQUEBAMEAwMDAwICBAICAQGFAakABT12cnFxE3Fyc3V2d3jy8/X29/j4+fn6+/sE+/v8/AP8/f2D/Yv+zv+EgAH/Sor86NfIu6+kmpGJgfPl2MzBtqyimZGJgXpzbGZhW1ZRTEhEQDw4NTIvLCknJCIgHhwaGBcVFBMREA8ODQwLCgkJCAcHBgYFBQQEAwQDAwMDAgIEAgIBAYUBpwADgoGBiYHvgISBAYACAgCASCopUE9OTUxLSUhGRIWBfXl0cGtnY19bV1NQTEhFQj88OTYzMS4sKSclIyEfHRwaGRcWFBMSERAPDg0MCwoJCQgHBwYGBQUEBAMEAwMDAwICBAICAQGFAakAFj06cnFxcnN0dnd4efT19vf4+fn6+/sD+/z8BPz8/f0E/f3+/oj+zv+JgEqQgvDezsCzqJ2TioL159nMwLWqoZeOhn53cGljXVdSTUlEQDw4NTIuKykmJCEfHRsZFxYUExIQDw4NDAsKCQkIBwcGBgUFBAQDAwMDAgKDAoYBqgAEgoKBgYiB64CJgQICAIBIKypSUVBPTk1LSkhGiIR/enZxbWhkYFxYVFBNSUZCPzw5NjQxLiwqJyUjIR8dHBoZFxYUExIREA8ODQwLCgkJCAcHBgYFBQQEAwQDAwMDAgIEAgIBAYQBqgAXPTpycXFzdHV3eHl69ff4+Pn6+vv7/PwD/P39BP39/v6I/sz/joBFloj45dTFuKugloyD9+fZzL+zqJ6Vi4N7c2xlX1lUTklFQDw4NTEuKyglIyAeHBoYFhUTEhAPDg0MCwoJCAgHBgYFBQQEAwQDAwMDAgIEAgIBAYQBrQAEgoKBgYiB5oCOgQICAIBILCoqU1JRUE9NS0lHioaBfHdzbmplYV1ZVVFNSkZDPzw5NzQxLywqJyUjIR8eHBoZFxYUExIREA8ODQwLCgkJCAcHBgYFBQQEAwQDAwMDAgIEAgIBAYQBqgAVPTo4cXJzdXZ4eXp79/j5+vr7+/z8A/z9/QT9/f7+hv7L/5OARZ2Nge3byryvo5iOhPjo2cu+saackYh/d29oYVtVT0pFQDw4NDAtKickIh8dGxkXFRMSEQ8ODQwLCgkICAcGBgUFBAQDAwMDAgIEAgIBAYQBsACDgomB4YCTgQICAIBILSsqVVRUUlFPTUtJjYiDfnl0b2tmYl5ZVVFOSkZDQD06NzQxLywqKCUjIR8eHBoZFxYUExIREA8ODQwLCgkJCAcHBgYFBQQEAwQDAwMDAgIEAgIBAYQBqgATPDk4cXN0dnd5ent7+Pn6+/v8/AP8/f0D/f7+hv7I/5mAQqWThvXi0MGzppqPhfno2Mm8r6OYjoR7c2tjXVZQSkVAPDczMCwpJiMgHhwZFxUUEhEPDg0MCwoJCAcHBgUFBAQDAwMDAgIEAgIBAYQBswCDgomB24CZgQICAIBILiwrV1dWVVNRT0xKj4qEf3p1cGxnY15aVlJOSkdDQD06NzQxLywqKCUjIR8eHBoZFxYUExIREA8ODQwLCgkJCAcHBgYFBQQEAwQDAwMDAgIEAgIBAYQBqgAUPDk4cnN1d3l6e3x8+vr7+/z8/f0D/f7+hf7E/6CAQq6ai/7p1sW2qJyQhvnn1se5q5+UiX92bmZeV1FLRUA7NzIvKyglIh8cGhgWFBIRDw4NDAoJCQgHBgYFBQQEAwMCAgQCAgEBhAG2AIOCiYHUgKCBAgIAgEovLSwsWVhXVVNQTUuRi4aAe3ZxbGhjX1pWUk5LR0RAPTo3NDEvLCooJiMhIB4cGhkXFhQTEhEQDg4NDAsKCQkIBwcGBgUFBAQDAwQDAwICBAICAQGEAaoAFDw5ODl1d3h6e3x8ffv7/Pz9/f7+hf7A/6eAPbeikYTx3Mq6q56Rhvjm1MS1p5uPhHpxaGBYUktFQDs2MS0qJiMgHRsYFhQSEQ8ODAsKCQgHBwYFBQQEAwMDAwICAwIBAYQBuQCEgoiBzYCngQICAIADMC4uRy5bWllWVFFOTJKNh4J8d3JtaGRfW1dTT0tHREA9Ojc0Mi8tKigmIyEgHhwaGRcWFBMSERAODQ0MCwoJCQgHBwYGBQUEBAMDBAMDAgIFAgIBAACtABI8ODg5dnh6e3x8fX38/P39/v6E/rv/r4A6wqqYifnjz76tn5KG9+PRwLCilYl+dGphWVJLRT86NTAsKCQhHhsZFhQSEQ8ODAsKCQgHBgUFBAQDAwMDAgIDAgEBgwG9AISCiIHFgK+BAgIAgAMxLy9ILy9dWlhVUk9MlI6Ig314c25pZF9bV1NPS0dEQT06NzQyLy0qKCYkISAeHBoZFxYUExIREA4NDQwLCgkJCAcHBgYFBQQEAwEBhQGwABA7ODk6O3l7fHx9fX79/f7+g/62/7eAN86zn4+B6dTBsKCShfTgzLurnI6Cd2xjWlJLRD44My4qJiIfHBkXFBIQDw0MCwkIBwYGBQQEAwMDAwICAwIBAYMBwACFgoeBvYC3gQICAIADMTAwQDAwXlxZVlNQTZWPiYN+eHNuaWRgW1dTT0tIREE+Ojc1Mi8tKigmJCEgHhwaGRcWFBMSEQ8ODQwMCwoJCQgHAwMDAwICBAICAQGGAbAACzs4OTs8e3x9fX5+A37+/oP+sP+/gDbcvaeVhfDZxLGhkoTw2sa0o5SGem9kWlJKQzw2MSwoJCAdGhcUEhAODQsKCQgHBgUEBAMDAgIDAgEBgwHEAIWCh4G1gL+BAgIAgD8yMTEyMWBdWldUUU6WkIqEfnlzbmllYFxXU09MSERBPjo3NTIvLSooJiQhIB4cGhkXFhQTEhEQDg0GBgUFBAQDBAMDBAMDAgIEAgIBAYYBsAAKOjg6PD18fX1+fgZ+f/7+//+p/8eAM+vJsJuK993HsqGQguvUvqyai31xZVtRSUE6NC8qJSEdGhcUEhAODAsJCAcGBQUEAwMCAgMCAQGDAccAhYKHga2Ax4ECAgCAOjMyMzMyYl9bWFVRnZeQioR/eXRvamVgXFhTT0xIREE+Ozc1Mi8tKigmJCEgHhwaGRcWCgkJCAgHBgYFBgUFBAQDBAMDBAMDAgIEAgIBAYYBsAAOOjk7PD59fX5+f3/+//+k/86ANP3WuqKP/uLJsp+O/uPLtaGQgHJmWlBHPzgxLCYiHhoXFBEPDQsKCQcGBQUEAwMCAgEBAADMAIWChoGngM6BAgIAgDoZMzQ0MzFgXFlVUp6XkYuFf3p0b2plYFxYVFBMSERBPjs4NTIvLSooJiQREA8ODQwLCwoJCQgIBwYGBQYFBQQEAwQDAwQDAwICBAICAQGGAbAACRw5PD0+Pn5/fwR/f///nf/WgCyJ5cWqlYLlyrGdivTYv6iUg3NlWU5EPDQuKCMeGhYTEQ4MCgkIBgUEBAMBAQMBAADRAAODgoKDgoWBn4DWgQICAIA6GjU2NTMyYV1ZVlKemJGLhX96dG9qZWFcWFRQTEhEQT47ODUZFxYVFBMSERAPDg0MCwsKCQkIBwcGBgUGBQUEBAMEAwMEAwMCAgQCAgEBhgGwAAgcOj0+Pj9/f4N/mP/dgCWW99GymoXnya+YhefJsJiFc2RWS0E3MCkjHhoWExANCwkIBgICAwIBAQMBAADVAAODgoKDgoWBmIDdgQICAIA6Ghs3NjQyYV1aVqWfmJKLhYB6dG9qZWFcWFRQTCQiIB8dHBoZFxYVFBMSERAPDg0MCwsKCQkIBwcGBgUGBQUEBAMEAwMEAwMCAgQCAgEBhgGwAAgcHT4+Pz9/fwR/f///kP/kgCSlhd67n4fnxqmR+dW3nYVyYVJGOzIqIx4ZFREOBgUEAwICAQEEAQEAANgABIODgoIEgoKBgQSBgYCAkIDkgQICAIA6Ghw4NjQyYV5aVqafmJKMhYB6dW9qZTAuLCooJiQiIB8dHBoZFxYVFBMSERAPDg0MCwsKCQkIBwcGBgUGBQUEBAMEAwMEAwMCAgQCAgEBhgGwAAUcHj4/PwM/f38Ef3///4r/6oAhuJHtw6OH5MCgh+K9n4VuXEw/NCskHQwJCAYFBAMCAgEBAwEAANwABIODgoIEgoKBgQSBgYCAioDqgQICAIA6Gx05NzUzYl5araafmJKMhkA9Ojc1MzAuLCooJiQiIB8dHBoZFxYVFBMSERAPDg0MCwsKCQkIBwcGBgUGBQUEBAMEAwMEAwMCAgQCAgEBhgGwAAQcHz8/BD8/f38Df///hf/wgB3Qn/3LpYbctJLww56BaVREGxURDQsIBgUEAwIBAQMBAADgAASDg4KCBIKCgYEDgYCAhYDwgQICAIA6HB0cNzUzYl61raafTElGQ0A9Ojc1MzAuLCooJiQiIB8dHBoZFxYVFBMSERAPDg0MCwsKCQkIBwcGBgUGBQUEBAMEAwMEAwMCAgQCAgEBhQGxAAUdHx8/PwU/f3///wT//4CA8oAc77CH0qWBzKH7xpp4LiQbFRAMCQcFAwICAQEAAOQAg4ODggSBgYCABICAgYHygQICAIA6Dh0cNzVmYl5aV1NPTElGQ0A9Ojg1MzAuLCooJiQiIB8dHBoZFxYVFBMSERAPDg0MCwsKCQkIBwcGBgUGBQUEBAMEAwMEAwMCAgQCAgEBhQGxAAkPHx8/P39/gID3gBiMxI/Tneqvg2BHNCYbFA4KBwQDAgEBAADoAAeEg4OCgoGB+YECAgCAOg8eHDc1ZmJeWldTT0xJRkNAPTo4NTMwLiwqKCYkIiAfHRwaGRcWFRQTEhEQDw4NDAsLCgkJCAcHBgYFBgUFBAQDBAMDBAMDAgIEAgIBAYUBsQAHDx8fPz+AgPmAE6rbk8qKvIFYOScZEAoGBAIBAADtAAeEg4OCgoGB+YECAgCAOg8eHTdrZmJeWldTT0xJRkNAPTo4NTMwLiwqKCYkIiAfHRwaGRcWFRQTEhEQDw4NDAsLCgkJCAcHBgYFBgUFBAQDBAMDBAMDAgIEAgIBAYUBsQAGDyAgQICA+oAP2PCNpsJwQCQSCgUCAQAA8QAGhIODgoGB+oECAgCAOgceOW9rZmJeWldTT0xJRkNAPTo4NTMwLiwqKCYkIiAfHRwaGRcWFRQTEhEQDw4NDAsLCgkJCAcHBgYFBgUFBAQDBAMDBAMDAgIEAgIBAYUBsQAFBx9AgIDsgAP/gICIgAT/gP//CpLqwp86FQcCAAD2AAWFg4KBgeyBA4CBgYiBBICBgIA=\"\r\n\r\nconst RGBDMaxRange = 255;\r\n/**\r\n * @internal\r\n */\r\nexport class PBRDefaultDFG {\r\n\r\n    // todo \r\n    private static _defaultDFG: Texture2D;\r\n    public static get defaultDFG(): Texture2D {\r\n        return PBRDefaultDFG._defaultDFG;\r\n    }\r\n    public static set defaultDFG(value: Texture2D) {\r\n        PBRDefaultDFG._defaultDFG = value;\r\n    }\r\n\r\n    static DefaultDfgTexture() {\r\n        let hdrBuffer = Base64Tool.decode(dfg_128);\r\n        let hdrInfo = HDRTextureInfo.getHDRInfo(hdrBuffer);\r\n\r\n        let supportFloatTex = LayaGL.renderEngine.getCapable(RenderCapable.TextureFormat_R32G32B32A32);\r\n        let supportFloatLinearFiltering = LayaGL.renderEngine.getCapable(RenderCapable.Texture_FloatLinearFiltering);\r\n\r\n        let tex: Texture2D;\r\n\r\n        if (supportFloatTex && supportFloatLinearFiltering) {\r\n            tex = new Texture2D(hdrInfo.width, hdrInfo.height, hdrInfo.format, false, false, false);\r\n            tex.setHDRData(hdrInfo);\r\n        }\r\n        else {\r\n            tex = new Texture2D(hdrInfo.width, hdrInfo.height, TextureFormat.R8G8B8A8, false, false, false);\r\n\r\n            let pixelCount = hdrInfo.width * hdrInfo.height;\r\n            let hdrPixelData = <Float32Array>hdrInfo.readScanLine();\r\n            let rgbdPixelData = new Uint8Array(pixelCount * 4);\r\n\r\n            for (let index = 0; index < pixelCount; index++) {\r\n\r\n                let r = hdrPixelData[index * 4];\r\n                let g = hdrPixelData[index * 4 + 1];\r\n                let b = hdrPixelData[index * 4 + 2];\r\n\r\n                let maxRGB = Math.max(r, g, b, 1e-5);\r\n                let d = Math.max(1.0, RGBDMaxRange / maxRGB);\r\n                d = Math.min(1, Math.max(0, (d / 255)));\r\n\r\n                rgbdPixelData[index * 4] = Math.min(1, Math.max(0, (r * d))) * 255;\r\n                rgbdPixelData[index * 4 + 1] = Math.min(1, Math.max(0, (g * d))) * 255;\r\n                rgbdPixelData[index * 4 + 2] = Math.min(1, Math.max(0, (b * d))) * 255;\r\n                rgbdPixelData[index * 4 + 3] = d * 255;\r\n            }\r\n\r\n            tex.setPixelsData(rgbdPixelData, false, false);\r\n        }\r\n\r\n        tex.lock = true;\r\n        tex.wrapModeU = WrapMode.Clamp;\r\n        tex.wrapModeV = WrapMode.Clamp;\r\n        tex.anisoLevel = 1;\r\n\r\n        this._defaultDFG = tex;\r\n    }\r\n\r\n}","import { Shader3D } from \"../../../RenderEngine/RenderShader/Shader3D\";\r\n\r\nimport BRDFGLSL from \"./BRDF.glsl\";\r\nimport PBRGIGLSL from \"./pbrGI.glsl\";\r\n\r\nimport PBRCommonGLSL from \"./pbrCommon.glsl\";\r\nimport PBRVertexGLSL from \"./pbrVertex.glsl\";\r\nimport PBRFragGLSL from \"./pbrFrag.glsl\";\r\nimport PBRMetallicGLSL from \"./pbrMetallicFrag.glsl\";\r\nimport { PBRDefaultDFG } from \"./PBRDefaultDFG\";\r\nimport { ShaderDataType } from \"../../../RenderEngine/RenderShader/ShaderData\";\r\nimport { SubShader } from \"../../../RenderEngine/RenderShader/SubShader\";\r\nimport { ShaderDefine } from \"../../../RenderEngine/RenderShader/ShaderDefine\";\r\n\r\nexport class PBRShaderLib {\r\n\r\n    /**\r\n     * emission\r\n     */\r\n    static DEFINE_EMISSION: ShaderDefine;\r\n\r\n    /**\r\n     * clear coat\r\n     */\r\n    static DEFINE_CLEARCOAT: ShaderDefine;\r\n    static DEFINE_CLEARCOAT_NORMAL: ShaderDefine;\r\n\r\n    /**\r\n     * anisotropy\r\n     */\r\n    static DEFINE_ANISOTROPY: ShaderDefine;\r\n\r\n    /**\r\n     * ior\r\n     */\r\n    static DEFINE_IOR: ShaderDefine;\r\n\r\n    /**\r\n     * iridescence\r\n     */\r\n    static DEFINE_IRIDESCENCE: ShaderDefine;\r\n\r\n    /**\r\n     * sheen\r\n     */\r\n    static DEFINE_SHEEN: ShaderDefine;\r\n\r\n    /**\r\n     * transmission\r\n     */\r\n    static DEFINE_TRANSMISSION: ShaderDefine;\r\n\r\n    /**\r\n     * thick / volume\r\n     */\r\n    static DEFINE_THICKNESS: ShaderDefine;\r\n\r\n    static init() {\r\n\r\n        PBRShaderLib.DEFINE_EMISSION = Shader3D.getDefineByName(\"EMISSION\");\r\n\r\n        PBRShaderLib.DEFINE_CLEARCOAT = Shader3D.getDefineByName(\"CLEARCOAT\");\r\n        PBRShaderLib.DEFINE_CLEARCOAT_NORMAL = Shader3D.getDefineByName(\"CLEARCOAT_NORMAL\");\r\n\r\n        PBRShaderLib.DEFINE_ANISOTROPY = Shader3D.getDefineByName(\"ANISOTROPIC\");\r\n\r\n        PBRShaderLib.DEFINE_IOR = Shader3D.getDefineByName(\"IOR\");\r\n\r\n        PBRShaderLib.DEFINE_IRIDESCENCE = Shader3D.getDefineByName(\"IRIDESCENCE\");\r\n\r\n        PBRShaderLib.DEFINE_SHEEN = Shader3D.getDefineByName(\"SHEEN\");\r\n\r\n        PBRShaderLib.DEFINE_TRANSMISSION = Shader3D.getDefineByName(\"TRANSMISSION\");\r\n\r\n        PBRShaderLib.DEFINE_THICKNESS = Shader3D.getDefineByName(\"THICKNESS\");\r\n\r\n        // pbr lib\r\n        Shader3D.addInclude(\"BRDF.glsl\", BRDFGLSL);\r\n        Shader3D.addInclude(\"PBRGI.glsl\", PBRGIGLSL);\r\n\r\n        Shader3D.addInclude(\"PBRCommon.glsl\", PBRCommonGLSL);\r\n        Shader3D.addInclude(\"PBRVertex.glsl\", PBRVertexGLSL);\r\n        Shader3D.addInclude(\"PBRFrag.glsl\", PBRFragGLSL);\r\n\r\n        PBRDefaultDFG.DefaultDfgTexture();\r\n        SubShader.regIncludeBindUnifrom(\"PBRGI.glsl\", { \"u_IBLDFG\": ShaderDataType.Texture2D }, { \"u_IBLDFG\": PBRDefaultDFG.defaultDFG });\r\n\r\n        Shader3D.addInclude(\"PBRMetallicFrag.glsl\", PBRMetallicGLSL);\r\n    }\r\n}","#if !defined(BRDF)\r\n    #define BRDF\r\n\r\n// Specular implementations\r\nfloat D_GGX(float roughness, float NoH, vec3 h, vec3 n)\r\n{\r\n    // todo \r\n    #if !defined(GL_FRAGMENT_PRECISION_HIGH)\r\n    vec3 NxH = cross(n, h);\r\n    float oneMinusNoHSquared = dot(NxH, NxH);\r\n    #else\r\n    float oneMinusNoHSquared = 1.0 - NoH * NoH;\r\n    #endif\r\n\r\n    float a = NoH * roughness;\r\n    float k = roughness / (oneMinusNoHSquared + a * a);\r\n    float d = k * k * INVERT_PI;\r\n\r\n    return saturateMediump(d);\r\n}\r\n\r\nfloat D_GGX_Anisotropic(float NoH, const vec3 h, const vec3 t, const vec3 b, float at, float ab)\r\n{\r\n    float ToH = dot(t, h);\r\n    float BoH = dot(b, h);\r\n    float a2 = at * ab;\r\n    highp vec3 v = vec3(ab * ToH, at * BoH, a2 * NoH);\r\n    highp float v2 = dot(v, v);\r\n    float w2 = a2 / v2;\r\n    return a2 * w2 * w2 * INVERT_PI;\r\n}\r\n\r\nfloat D_Charlie(float roughness, float NoH)\r\n{\r\n    float invR = 1.0 / roughness;\r\n    float cos2h = NoH * NoH;\r\n    float sin2h = max(1.0 - cos2h, 0.0078125);\r\n    return (2.0 + invR) * pow(sin2h, invR * 0.5) * 0.5 * INVERT_PI;\r\n}\r\n\r\nfloat V_SmithGGXCorrelated(float roughness, float NoV, float NoL)\r\n{\r\n    float a2 = roughness * roughness;\r\n    float lambdaV = NoL * sqrt((NoV - a2 * NoV) * NoV + a2);\r\n    float lambdaL = NoV * sqrt((NoL - a2 * NoL) * NoL + a2);\r\n    float v = 0.5 / (lambdaV + lambdaL);\r\n\r\n    return saturateMediump(v);\r\n}\r\n\r\nfloat V_SmithGGXCorrelated_Fast(float roughness, float NoV, float NoL)\r\n{\r\n    float v = 0.5 / mix(2.0 * NoL * NoV, NoL + NoV, roughness);\r\n    return saturateMediump(v);\r\n}\r\n\r\n// Kelemen 2001, \"A Microfacet Based Coupled Specular-Matte BRDF Model with Importance Sampling\"\r\nfloat V_kelemen(float LoH)\r\n{\r\n    return saturateMediump(0.25 / (LoH * LoH));\r\n}\r\n\r\nfloat lCharlieNumericHelper(float x, float alphaG)\r\n{\r\n    float oneMinusAlphaSq = (1.0 - alphaG) * (1.0 - alphaG);\r\n    float a = mix(21.5473, 25.3245, oneMinusAlphaSq);\r\n    float b = mix(3.82987, 3.32435, oneMinusAlphaSq);\r\n    float c = mix(0.19823, 0.16801, oneMinusAlphaSq);\r\n    float d = mix(-1.97760, -1.27393, oneMinusAlphaSq);\r\n    float e = mix(-4.32054, -4.85967, oneMinusAlphaSq);\r\n    return a / (1.0 + b * pow(x, c)) + d * x + e;\r\n}\r\n\r\nfloat lCharlie(float cosTheta, float alphaG)\r\n{\r\n    if (abs(cosTheta) < 0.5)\r\n\t{\r\n\t    return exp(lCharlieNumericHelper(cosTheta, alphaG));\r\n\t}\r\n    else\r\n\t{\r\n\t    return exp(2.0 * lCharlieNumericHelper(0.5, alphaG) - lCharlieNumericHelper(1.0 - cosTheta, alphaG));\r\n\t}\r\n}\r\n\r\nfloat V_Charlie(float NoL, float NoV, float roughness)\r\n{\r\n    float alphaG = roughness * roughness;\r\n    return clamp(1.0 / ((1.0 + lCharlie(NoV, alphaG) + lCharlie(NoL, alphaG)) * (4.0 * NoV * NoL)), 0.0, 1.0);\r\n}\r\n\r\n// Neubelt and Pettineo 2013, \"Crafting a Next-gen Material Pipeline for The Order: 1886\"\r\nfloat V_Neubelt(float NoV, float NoL)\r\n{\r\n    return saturateMediump(1.0 / (4.0 * (NoL + NoV - NoL * NoV)));\r\n}\r\n\r\nfloat V_SmithGGXCorrelated_Anisotropic(float at, float ab, float ToV, float BoV, float ToL, float BoL, float NoV, float NoL)\r\n{\r\n    float lambdaV = NoL * length(vec3(at * ToV, ab * BoV, NoV));\r\n    float lambdaL = NoV * length(vec3(at * ToL, ab * BoL, NoL));\r\n    float v = 0.5 / (lambdaV + lambdaL);\r\n    return saturateMediump(v);\r\n}\r\n\r\nvec3 F_Schlick(vec3 f0, float f90, float VoH)\r\n{\r\n    return f0 + (f90 - f0) * pow5(1.0 - VoH);\r\n}\r\n\r\nvec3 F_Schlick(vec3 f0, float VoH)\r\n{\r\n    return f0 + (1.0 - f0) * pow5(1.0 - VoH);\r\n}\r\n\r\nfloat F_Schlick(float f0, float f90, float VoH)\r\n{\r\n    return f0 + (f90 - f0) * pow5(1.0 - VoH);\r\n}\r\n\r\nfloat F_Schlick(float f0, float VoH)\r\n{\r\n    return f0 + (1.0 - f0) * pow5(1.0 - VoH);\r\n}\r\n\r\nvec3 F_Schlick(vec3 f0, vec3 f90, float VoH)\r\n{\r\n    return f0 + (f90 - f0) * pow5(1.0 - VoH);\r\n}\r\n\r\n    #ifdef IRIDESCENCE\r\n\r\n// CIE XYZ to REC.709\r\nconst mat3 XYZ_to_REC709_MAT = mat3(\r\n    vec3(3.2409699419, -0.9692436363, 0.0556300797),\r\n    vec3(-1.5373831776, 1.8759675015, -0.2039769589),\r\n    vec3(-0.498610760, 0.0415550574, 1.0569715142));\r\n\r\nfloat IorToFresnel0(float iorT, float iorI)\r\n{\r\n    return pow2((iorT - iorI) / (iorT + iorI));\r\n}\r\n\r\nvec3 IorToFresnel0(vec3 iorT, float iorI)\r\n{\r\n    return pow2((iorT - vec3(iorI)) / (iorT + vec3(iorI)));\r\n}\r\n\r\n// air to surfaceR0 ior\r\nvec3 Fresnel0ToIor(vec3 f0)\r\n{\r\n    vec3 sqrtF0 = sqrt(f0);\r\n    return (1.0 + sqrtF0) / (1.0 - sqrtF0);\r\n}\r\n\r\nvec3 evalSensitivity(float OPD, vec3 shift)\r\n{\r\n    float phase = 2.0 * PI * OPD * 1.0e-9;\r\n    vec3 val = vec3(5.4856e-13, 4.4201e-13, 5.2481e-13);\r\n    vec3 pos = vec3(1.6810e+06, 1.7953e+06, 2.2084e+06);\r\n    vec3 var = vec3(4.3278e+09, 9.3046e+09, 6.6121e+09);\r\n    vec3 xyz = val * sqrt(2.0 * PI * var) * cos(pos * phase + shift) * exp(-pow2(phase) * var);\r\n    xyz.x += 9.7470e-14 * sqrt(2.0 * PI * 4.5282e+09) * cos(2.2399e+06 * phase + shift[0]) * exp(-4.5282e+09 * pow2(phase));\r\n    xyz /= 1.0685e-7;\r\n    vec3 srgb = XYZ_to_REC709_MAT * xyz;\r\n    return srgb;\r\n}\r\n\r\n// https://belcour.github.io/blog/research/publication/2017/05/01/brdf-thin-film.html\r\nvec3 evalIridescence(float outsideIOR, float eta2, float cosTheta1, float thinFilmThickness, vec3 baseF0)\r\n{\r\n    vec3 I;\r\n    float iridescenceIor = mix(outsideIOR, eta2, smoothstep(0.0, 0.03, thinFilmThickness));\r\n\r\n    float sinTheta2Sq = pow2(outsideIOR / iridescenceIor) * (1.0 - pow2(cosTheta1));\r\n\r\n    float cosTheta2Sq = 1.0 - sinTheta2Sq;\r\n    if (cosTheta2Sq < 0.0)\r\n\t{\r\n\t    return vec3(1.0);\r\n\t}\r\n    float cosTheta2 = sqrt(cosTheta2Sq);\r\n\r\n    float R0 = IorToFresnel0(iridescenceIor, outsideIOR);\r\n    float R12 = F_Schlick(R0, cosTheta1);\r\n    float R21 = R12;\r\n    float T121 = 1.0 - R12;\r\n    float phi12 = 0.0;\r\n    if (iridescenceIor < outsideIOR)\r\n\tphi12 = PI;\r\n    float phi21 = PI - phi12;\r\n\r\n    vec3 baseIOR = Fresnel0ToIor(clamp(baseF0, 0.0, 0.9999));\r\n\r\n    vec3 R1 = IorToFresnel0(baseIOR, iridescenceIor);\r\n    vec3 R23 = F_Schlick(R1, cosTheta2);\r\n    vec3 phi23 = vec3(0.0);\r\n\r\n    if (baseIOR[0] < iridescenceIor)\r\n\tphi23[0] = PI;\r\n    if (baseIOR[1] < iridescenceIor)\r\n\tphi23[1] = PI;\r\n    if (baseIOR[2] < iridescenceIor)\r\n\tphi23[2] = PI;\r\n\r\n    float OPD = 2.0 * iridescenceIor * thinFilmThickness * cosTheta2;\r\n    vec3 phi = vec3(phi21) + phi23;\r\n\r\n    vec3 R123 = clamp(R12 * R23, 1e-5, 0.9999);\r\n    vec3 r123 = sqrt(R123);\r\n    vec3 Rs = pow2(T121) * R23 / (vec3(1.0) - R123);\r\n\r\n    vec3 C0 = R12 + Rs;\r\n    I = C0;\r\n\r\n    vec3 Cm = Rs - T121;\r\n    for (int m = 1; m <= 2; ++m)\r\n\t{\r\n\t    Cm *= r123;\r\n\t    vec3 Sm = 2.0 * evalSensitivity(float(m) * OPD, float(m) * phi);\r\n\t    I += Cm * Sm;\r\n\t}\r\n\r\n    return max(I, vec3(0.0));\r\n}\r\n    #endif // IRIDESCENCE\r\n\r\n// Specular dispatch\r\n\r\n// D\r\nfloat distribution(float roughness, float NoH, vec3 h, vec3 n)\r\n{\r\n    return D_GGX(roughness, NoH, h, n);\r\n}\r\n\r\n// V\r\nfloat visibility(float roughness, float NoV, float NoL)\r\n{\r\n    return V_SmithGGXCorrelated(roughness, NoV, NoL);\r\n}\r\n\r\n// F\r\nvec3 fresnel(vec3 f0, float LoH)\r\n{\r\n    float f90 = saturate(dot(f0, vec3(50.0 * 0.33)));\r\n    return F_Schlick(f0, f90, LoH);\r\n\r\n    // return F_Schlick(f0, LoH);\r\n}\r\n\r\nvec3 fresnel(vec3 f0, vec3 f90, float LoH)\r\n{\r\n    return F_Schlick(f0, f90, LoH);\r\n}\r\n\r\n// diffuse BRDF implementations\r\n\r\nfloat Fd_Lambert()\r\n{\r\n    // https://seblagarde.wordpress.com/2012/01/08/pi-or-not-to-pi-in-game-lighting-equation/\r\n    // return INVERT_PI;\r\n    return 1.0;\r\n}\r\n\r\nfloat Fd_Burley(float roughness, float NoV, float NoL, float LoH)\r\n{\r\n    float f90 = 0.5 + 2.0 * roughness * LoH * LoH;\r\n    float lightScatter = F_Schlick(1.0, f90, NoL);\r\n    float veiwScatter = F_Schlick(1.0, f90, NoV);\r\n    return lightScatter * veiwScatter * INVERT_PI;\r\n}\r\n\r\n    #ifdef IRIDESCENCE\r\nvec3 Fd_IridescenceLambert(vec3 f0, vec3 f90, vec3 iridescenceFresnel, float iridescenceFactor, float VoH)\r\n{\r\n    vec3 iridescenceFresnelMax = vec3(vecmax(iridescenceFresnel));\r\n    vec3 schlickFresnel = F_Schlick(f0, f90, VoH);\r\n\r\n    vec3 F = mix(schlickFresnel, iridescenceFresnelMax, iridescenceFactor);\r\n\r\n    return (1.0 - F) * Fd_Lambert();\r\n}\r\n    #endif // IRIDESCENCE\r\n\r\n#endif // BRDF","#if !defined(pbrGI_lib)\r\n    #define pbrGI_lib\r\n\r\n    #include \"globalIllumination.glsl\";\r\n\r\n    #ifdef ANISOTROPIC\r\nvec3 anisotropyBentNormal(const in Surface surface, const in PixelInfo info)\r\n{\r\n    float anisotropy = surface.anisotropy;\r\n    vec3 anisotropyDirection = info.anisotropicB;\r\n\r\n    vec3 n = info.normalWS;\r\n    vec3 v = info.viewDir;\r\n\r\n    // float tangentRoughness = mix(roughness, 1.0, anisotropy * anisotropy);\r\n    float roughness = surface.perceptualRoughness;\r\n    vec3 anisotropicTangent = cross(anisotropyDirection, v);\r\n    vec3 anisotropicNormal = cross(anisotropicTangent, anisotropyDirection);\r\n    float bendFactor = 1.0 - anisotropy * (1.0 - roughness);\r\n    float bendFactorPow4 = pow2(bendFactor) * pow2(bendFactor);\r\n    vec3 bentNormal = normalize(mix(anisotropicNormal, n, bendFactorPow4));\r\n\r\n    return bentNormal;\r\n}\r\n    #endif // ANISOTROPIC\r\n\r\n// \r\nvec3 getReflectedVector(const in vec3 n, const in vec3 v, const in vec3 positionWS)\r\n{\r\n    vec3 r;\r\n    r = reflect(-v, n);\r\n\r\n    #ifdef SPECCUBE_BOX_PROJECTION\r\n    r = getBoxProjectionReflectedVector(r, positionWS);\r\n    #endif // SPECCUBE_BOX_PROJECTION\r\n\r\n    return r;\r\n}\r\n\r\n    #ifdef IRIDESCENCE\r\nvoid iridescenceIBL(const in Surface surface, const in PixelInfo info, in vec3 E, inout vec3 Fd, inout vec3 Fr)\r\n{\r\n    vec3 dfg = info.dfg;\r\n    float NoV = info.NoV;\r\n    vec3 n = info.normalWS;\r\n    vec3 v = info.viewDir;\r\n    vec3 positionWS = info.positionWS;\r\n    vec3 iridescenceFresnel = info.iridescenceFresnel;\r\n\r\n    vec3 diffuseColor = surface.diffuseColor;\r\n    float roughness = surface.perceptualRoughness;\r\n    float occlusion = surface.occlusion;\r\n    float iridescenceFactor = surface.iridescence;\r\n\r\n    // diffuse\r\n    vec3 irradiance = diffuseIrradiance(n, positionWS, info.viewDir);\r\n    Fd += diffuseColor * irradiance * (1.0 - E) * occlusion;\r\n\r\n    // specular\r\n    vec3 iridescenceF0 = mix(surface.f0, iridescenceFresnel, vec3(iridescenceFactor));\r\n    vec3 Er = mix(dfg.xxx, dfg.yyy, iridescenceF0);\r\n\r\n\t#ifdef ANISOTROPIC\r\n    vec3 bentNormal = anisotropyBentNormal(surface, info);\r\n    vec3 r = getReflectedVector(bentNormal, v, positionWS);\r\n\t#else // ANISOTROPIC\r\n    vec3 r = getReflectedVector(n, v, positionWS);\r\n\t#endif // ANISOTROPIC\r\n\r\n    vec3 indirectSpecular = specularRadiance(r, roughness);\r\n    Fr += Er * indirectSpecular * occlusion * (1.0 + Er * (1.0 / dfg.y - 1.0));\r\n}\r\n    #endif // IRIDESCENCE\r\n\r\n    #ifdef SHEEN\r\nvoid sheenIBL(const in Surface surface, const in PixelInfo info, inout vec3 Fd, inout vec3 Fr)\r\n{\r\n    vec3 v = info.viewDir;\r\n    vec3 n = info.normalWS;\r\n    vec3 positionWS = info.positionWS;\r\n\r\n    float occlusion = surface.occlusion;\r\n    float roughness = surface.sheenPerceptualRoughness;\r\n\r\n    Fd *= info.sheenScaling;\r\n    Fr *= info.sheenScaling;\r\n\r\n    vec3 r = getReflectedVector(n, v, positionWS);\r\n    vec3 indirectSpecular = specularRadiance(r, roughness);\r\n\r\n    Fr += indirectSpecular * info.sheenDfg * surface.sheenColor * occlusion;\r\n}\r\n    #endif // SHEEN\r\n\r\n    #ifdef CLEARCOAT\r\nvoid clearCoatIBL(const in Surface surface, const in PixelInfo info, inout vec3 Fd, inout vec3 Fr)\r\n{\r\n    vec3 v = info.viewDir;\r\n    vec3 n = info.clearCoatNormal;\r\n    float NoV = info.clearCoatNoV;\r\n    vec3 positionWS = info.positionWS;\r\n\r\n    float clearCoat = surface.clearCoat;\r\n    float roughness = surface.clearCoatPerceptualRoughness;\r\n    float occlusion = surface.occlusion;\r\n\r\n    float Fc = F_Schlick(0.04, 1.0, NoV) * clearCoat;\r\n    float attenuation = 1.0 - Fc;\r\n    Fd *= attenuation;\r\n    Fr *= attenuation;\r\n\r\n    vec3 r = getReflectedVector(n, v, positionWS);\r\n    vec3 indirectSpecular = specularRadiance(r, roughness);\r\n\r\n    Fr += indirectSpecular * Fc * occlusion;\r\n}\r\n    #endif // CLEARCOAT\r\n\r\n    #ifdef TRANSMISSION\r\nvec3 getRefraction(const in Surface surface, const in PixelInfo info)\r\n{\r\n    vec3 position = info.positionWS;\r\n\r\n\t#ifdef THICKNESS\r\n\r\n    vec3 n = info.normalWS;\r\n    vec3 r = -info.viewDir;\r\n    float airIOR = 1.0;\r\n    float etaIR = airIOR / surface.ior;\r\n\r\n    vec3 refractionV = normalize(refract(r, n, etaIR)) * surface.thickness * info.worldScale.xyz;\r\n\r\n    position += refractionV;\r\n\r\n\t#endif // THICKNESS\r\n\r\n    vec4 p = u_ViewProjection * vec4(position, 1.0);\r\n    vec2 refractionUV = (p.xy / p.w) * 0.5 + 0.5;\r\n\r\n    float refractionLOD = u_OpaqueTextureParams.z * surface.perceptualRoughness * saturate(surface.ior * 2.0 - 2.0);\r\n    vec3 refraction = texture2DLodEXT(u_CameraOpaqueTexture, refractionUV, refractionLOD).xyz;\r\n\r\n    return refraction;\r\n}\r\n\r\nvec3 transmissionIBL(const in Surface surface, const in PixelInfo info, in vec3 E)\r\n{\r\n    // refraction\r\n    vec3 refraction = getRefraction(surface, info);\r\n\r\n\t#ifndef THICKNESS\r\n    E *= 1.0 + surface.transmission * (1.0 - E.g) / (1.0 + E.g);\r\n\t#endif // THICKNESS\r\n\r\n\t#ifdef THICKNESS\r\n\r\n    // ABSORPTION\r\n    vec3 attenuationColor = surface.attenuationColor;\r\n    float attenuationDistance = surface.attenuationDistance;\r\n    vec3 absorption = -log(attenuationColor) / (attenuationDistance);\r\n    vec3 T = exp(-absorption * info.worldScale.xyz * surface.thickness);\r\n\r\n\t#endif // THICKNESS\r\n\r\n    vec3 Ft = refraction;\r\n\r\n    Ft *= surface.diffuseColor;\r\n\r\n    Ft *= 1.0 - E;\r\n\r\n\t#ifdef THICKNESS\r\n    Ft *= T;\r\n\t#endif // THICKNESS\r\n\r\n    return Ft * surface.transmission;\r\n}\r\n\r\n    #endif // TRANSMISSION\r\n\r\nvoid baseIBL(const in Surface surface, const in PixelInfo info, in vec3 E, inout vec3 Fd, inout vec3 Fr)\r\n{\r\n    vec3 dfg = info.dfg;\r\n    float NoV = info.NoV;\r\n    vec3 n = info.normalWS;\r\n    vec3 v = info.viewDir;\r\n    vec3 positionWS = info.positionWS;\r\n\r\n    vec3 diffuseColor = surface.diffuseColor;\r\n    float roughness = surface.perceptualRoughness;\r\n    float occlusion = surface.occlusion;\r\n\r\n    #ifdef ANISOTROPIC\r\n    vec3 bentNormal = anisotropyBentNormal(surface, info);\r\n    vec3 r = getReflectedVector(bentNormal, v, positionWS);\r\n    #else // ANISOTROPIC\r\n    vec3 r = getReflectedVector(n, v, positionWS);\r\n    #endif // ANISOTROPIC\r\n\r\n    vec3 indirectSpecular = specularRadiance(r, roughness);\r\n\r\n    // todo\r\n    float specularAO = occlusion;\r\n    Fr += E * indirectSpecular * specularAO * info.energyCompensation;\r\n\r\n    #if defined(USELIGHTMAP)\r\n\r\n    vec2 lightmapUV = info.lightmapUV;\r\n    vec3 bakedlight = getBakedLightmapColor(lightmapUV, n);\r\n    Fd += bakedlight * diffuseColor;\r\n\r\n    #else // USELIGHTMAP\r\n\r\n    vec3 irradiance = diffuseIrradiance(n, positionWS, info.viewDir);\r\n    Fd += diffuseColor * irradiance * (1.0 - E) * occlusion;\r\n\r\n    #endif // USELIGHTMAP\r\n}\r\n\r\nvec3 getE(const in Surface surface, const in PixelInfo info)\r\n{\r\n    #ifdef IRIDESCENCE\r\n\r\n    vec3 dfg = info.dfg;\r\n    float NoV = info.NoV;\r\n    vec3 iridescenceFresnel = info.iridescenceFresnel;\r\n    vec3 f0 = surface.f0;\r\n    float iridescenceFactor = surface.iridescence;\r\n    vec3 iridescenceFresnelMax = vec3(vecmax(iridescenceFresnel));\r\n    vec3 schlickFresnel = F_Schlick(f0, vec3(1.0), NoV);\r\n    vec3 F = mix(schlickFresnel, iridescenceFresnelMax, iridescenceFactor);\r\n    vec3 E = mix(dfg.xxx, dfg.yyy, F);\r\n\r\n    #else // IRIDESCENCE\r\n\r\n    vec3 dfg = info.dfg;\r\n    vec3 f0 = surface.f0;\r\n    vec3 f90 = surface.f90;\r\n    // vec3 E = mix(dfg.xxx, dfg.yyy, f0);\r\n    vec3 E = (f90 - f0) * dfg.x + f0 * dfg.y;\r\n\r\n    #endif // IRIDESCENCE\r\n    return E;\r\n}\r\n\r\nvec3 PBRGI(const in Surface surface, const in PixelInfo info)\r\n{\r\n    vec3 Fd = vec3(0.0);\r\n    vec3 Fr = vec3(0.0);\r\n\r\n    vec3 E = getE(surface, info);\r\n\r\n    #ifdef IRIDESCENCE\r\n    iridescenceIBL(surface, info, E, Fd, Fr);\r\n    #else // IRIDESCENCE\r\n    baseIBL(surface, info, E, Fd, Fr);\r\n    #endif // IRIDESCENCE\r\n\r\n    // sheen\r\n    #ifdef SHEEN\r\n    sheenIBL(surface, info, Fd, Fr);\r\n    #endif // SHEEN\r\n\r\n    // clear coat\r\n    #ifdef CLEARCOAT\r\n    clearCoatIBL(surface, info, Fd, Fr);\r\n    #endif // CLEARCOAT\r\n\r\n    #ifdef TRANSMISSION\r\n    Fd *= (1.0 - surface.transmission);\r\n    vec3 Ft = transmissionIBL(surface, info, E);\r\n    #endif // TRANSMISSION\r\n\r\n    vec3 gi = Fd + Fr;\r\n\r\n    #ifdef TRANSMISSION\r\n    gi += Ft;\r\n    #endif // TRANSMISSION\r\n\r\n    return gi;\r\n}\r\n\r\n#endif // pbrGI_lib","#if !defined(pbrCommon_lib)\r\n    #define pbrCommon_lib\r\n\r\n// varying\r\nvarying vec3 v_PositionWS;\r\n\r\n// todo\r\nvarying vec3 v_NormalWS;\r\nvarying vec3 v_TangentWS;\r\nvarying vec3 v_BiNormalWS;\r\n\r\n    #ifdef UV\r\nvarying vec2 v_Texcoord0;\r\n    #endif // UV\r\n\r\n    #ifdef UV1\r\n\t#ifdef LIGHTMAP\r\nvarying vec2 v_Texcoord1;\r\n\t#endif // LIGHTMAP\r\n    #endif // UV1\r\n\r\n    #ifdef COLOR\r\nvarying vec4 v_VertexColor;\r\n    #endif // COLOR\r\n\r\n// , vsfs\r\nstruct PixelParams {\r\n\r\n    vec3 positionWS;\r\n\r\n    vec3 normalWS;\r\n    vec3 tangentWS;\r\n    vec3 biNormalWS;\r\n    mat3 TBN;\r\n\r\n    #ifdef UV\r\n    vec2 uv0;\r\n    #endif // UV\r\n\r\n    #ifdef UV1\r\n\t#ifdef LIGHTMAP\r\n    vec2 uv1;\r\n\t#endif // LIGHTMAP\r\n    #endif // UV1\r\n\r\n    #ifdef COLOR\r\n    vec4 vertexColor;\r\n    #endif // COLOR\r\n};\r\n\r\n#endif // pbrCommon_lib","#if !defined(pbrVertex_lib)\r\n    #define pbrVertex_lib\r\n\r\n    #include \"ShadingVertex.glsl\";\r\n\r\n    #ifdef THICKNESS\r\n// xyz: world scale, w: length(xyz)\r\nvarying vec4 v_WorldScale;\r\n    #endif // THICKNESS\r\n\r\nvoid initPixelParams(inout PixelParams params, in Vertex vertex)\r\n{\r\n    shadingPixelParams(params, vertex);\r\n    sharePixelParams(params);\r\n\r\n    #ifdef THICKNESS\r\n    mat4 worldMat = getWorldMatrix();\r\n    v_WorldScale.x = length(vec3(worldMat[0].xyz));\r\n    v_WorldScale.y = length(vec3(worldMat[1].xyz));\r\n    v_WorldScale.z = length(vec3(worldMat[2].xyz));\r\n    v_WorldScale.w = length(v_WorldScale.xyz);\r\n    #endif // THICKNESS\r\n}\r\n\r\n#endif // pbrVertex_lib","#if !defined(pbrFrag_lib)\r\n    #define pbrFrag_lib\r\n\r\n    #include \"PBRLighting.glsl\";\r\n\r\n    #ifdef THICKNESS\r\n// xyz: world scale, w: length(xyz)\r\nvarying vec4 v_WorldScale;\r\n    #endif // THICKNESS\r\n\r\nvoid getPixelInfo(inout PixelInfo info, const in PixelParams pixel, const in Surface surface)\r\n{\r\n    info.positionWS = pixel.positionWS;\r\n    info.vertexNormalWS = pixel.normalWS;\r\n\r\n    #ifdef TANGENT\r\n    info.normalWS = normalize(pixel.TBN * surface.normalTS);\r\n    #else // TANGENT\r\n    info.normalWS = pixel.normalWS;\r\n    #endif // TANGENT\r\n\r\n    info.tangentWS = pixel.tangentWS;\r\n    info.biNormalWS = pixel.biNormalWS;\r\n\r\n    info.viewDir = normalize(u_CameraPos - info.positionWS);\r\n    info.NoV = min(max(dot(info.normalWS, info.viewDir), MIN_N_DOT_V), 1.0);\r\n\r\n    info.dfg = prefilteredDFG_LUT(surface.perceptualRoughness, info.NoV);\r\n\r\n    #ifdef SHEEN\r\n    info.energyCompensation = vec3(1.0);\r\n    #else // SHEEN\r\n    info.energyCompensation = (1.0 + surface.f0 * (1.0 / info.dfg.y - 1.0));\r\n    #endif // SHEEN\r\n\r\n    #ifdef IRIDESCENCE\r\n    info.iridescenceFresnel = evalIridescence(1.0, surface.iridescenceIor, info.NoV, surface.iridescenceThickness, surface.f0);\r\n    #endif // IRIDESCENCE\r\n\r\n    #ifdef SHEEN\r\n    info.sheenDfg = prefilteredDFG_LUT(surface.sheenPerceptualRoughness, info.NoV).z;\r\n    info.sheenScaling = 1.0 - vecmax(surface.sheenColor) * info.sheenDfg;\r\n    #endif // SHEEN\r\n\r\n    #ifdef CLEARCOAT\r\n\t#ifdef CLEARCOAT_NORMAL\r\n    info.clearCoatNormal = normalize(pixel.TBN * surface.clearCoatNormalTS);\r\n\t#else // CLEARCOAT_NORMAL\r\n    info.clearCoatNormal = info.vertexNormalWS;\r\n\t#endif // CLEARCOAT_NORMAL\r\n    info.clearCoatNoV = min(max(dot(info.clearCoatNormal, info.viewDir), MIN_N_DOT_V), 1.0);\r\n    #endif // CLEARCOAT\r\n\r\n    #ifdef ANISOTROPIC\r\n    mat3 anisotropyTBN = mat3(info.tangentWS, info.biNormalWS * -1.0, info.normalWS);\r\n    info.anisotropicT = anisotropyTBN * normalize(vec3(surface.anisotropyDirection, 0.0));\r\n    info.anisotropicB = cross(info.vertexNormalWS, info.anisotropicT);\r\n    info.ToV = dot(info.anisotropicT, info.viewDir);\r\n    info.BoV = dot(info.anisotropicB, info.viewDir);\r\n    info.at = mix(surface.roughness, 1.0, pow2(surface.anisotropy));\r\n    info.ab = surface.roughness;\r\n    #endif // ANISOTROPIC\r\n\r\n    #ifdef THICKNESS\r\n    info.worldScale = v_WorldScale;\r\n    #endif // THICKNESS\r\n\r\n    #ifdef LIGHTMAP\r\n\t#ifdef UV1\r\n    info.lightmapUV = pixel.uv1;\r\n\t#endif // UV1\r\n    #endif // LIGHTMAP\r\n}\r\n\r\nvec3 PBRLighting(const in Surface surface, const in PixelInfo info)\r\n{\r\n    vec3 lightColor = vec3(0.0);\r\n    #ifdef DIRECTIONLIGHT\r\n    for (int i = 0; i < CalculateLightCount; i++)\r\n\t{\r\n\t    if (i >= DirectionCount)\r\n\t\tbreak;\r\n\t    DirectionLight directionLight = getDirectionLight(i, info.positionWS);\r\n\t    if (directionLight.lightMode == LightMode_Mix)\r\n\t\t{\r\n\t\t    continue;\r\n\t\t}\r\n\t    Light light = getLight(directionLight);\r\n\t    lightColor += PBRLighting(surface, info, light) * light.attenuation;\r\n\t}\r\n    #endif // DIRECTIONLIGHT\r\n\r\n    #if defined(POINTLIGHT) || defined(SPOTLIGHT)\r\n    ivec4 clusterInfo = getClusterInfo(u_View, u_Viewport, info.positionWS, gl_FragCoord, u_ProjectionParams);\r\n    #endif // POINTLIGHT || SPOTLIGHT\r\n\r\n    #ifdef POINTLIGHT\r\n    for (int i = 0; i < CalculateLightCount; i++)\r\n\t{\r\n\t    if (i >= clusterInfo.x)\r\n\t\tbreak;\r\n\t    PointLight pointLight = getPointLight(i, clusterInfo, info.positionWS);\r\n\t    if (pointLight.lightMode == LightMode_Mix)\r\n\t\t{\r\n\t\t    continue;\r\n\t\t}\r\n\t    Light light = getLight(pointLight, info.normalWS, info.positionWS);\r\n\t    lightColor += PBRLighting(surface, info, light) * light.attenuation;\r\n\t}\r\n    #endif // POINTLIGHT\r\n\r\n    #ifdef SPOTLIGHT\r\n    for (int i = 0; i < CalculateLightCount; i++)\r\n\t{\r\n\t    if (i >= clusterInfo.y)\r\n\t\tbreak;\r\n\t    SpotLight spotLight = getSpotLight(i, clusterInfo, info.positionWS);\r\n\t    if (spotLight.lightMode == LightMode_Mix)\r\n\t\t{\r\n\t\t    continue;\r\n\t\t}\r\n\t    Light light = getLight(spotLight, info.normalWS, info.positionWS);\r\n\t    lightColor += PBRLighting(surface, info, light) * light.attenuation;\r\n\t}\r\n    #endif // SPOTLIGHT\r\n\r\n    vec3 giColor = PBRGI(surface, info);\r\n\r\n    vec3 color = lightColor + giColor;\r\n\r\n    #ifdef EMISSION\r\n    color += surface.emissionColor;\r\n    #endif //  EMISSION\r\n    return color;\r\n}\r\n\r\n#endif // pbrFrag_lib","#if !defined(PBRMetallic_lib)\r\n    #define PBRMetallic_lib\r\n\r\n    #include \"ShadingFrag.glsl\";\r\n\r\n    #include \"PBRFrag.glsl\";\r\n\r\nstruct SurfaceInputs {\r\n    vec3 diffuseColor;\r\n    float alpha;\r\n    float alphaTest;\r\n    float metallic;\r\n    float smoothness;\r\n    float occlusion;\r\n    vec3 emissionColor;\r\n    vec3 normalTS;\r\n\r\n    #ifdef CLEARCOAT\r\n    float clearCoat;\r\n    float clearCoatRoughness;\r\n\t#ifdef CLEARCOAT_NORMAL\r\n    vec3 clearCoatNormalTS;\r\n\t#endif // CLEARCOAT_NORMAL\r\n    #endif // CLEARCOAT\r\n\r\n    #ifdef ANISOTROPIC\r\n    float anisotropy;\r\n    vec2 anisotropyDirection;\r\n    #endif // ANISOTROPIC\r\n};\r\n\r\nvoid initSurface(inout Surface surface, const in SurfaceInputs inputs, const in PixelParams pixel)\r\n{\r\n    surface.alpha = inputs.alpha;\r\n\r\n    surface.normalTS = inputs.normalTS;\r\n\r\n    vec3 baseColor = inputs.diffuseColor;\r\n    float metallic = inputs.metallic;\r\n    float perceptualRoughness = 1.0 - inputs.smoothness;\r\n\r\n    // default ior 1.5\r\n    float ior = 1.5;\r\n    surface.ior = 1.5;\r\n    vec3 f0 = vec3(0.04, 0.04, 0.04);\r\n\r\n    surface.perceptualRoughness = clamp(perceptualRoughness, MIN_PERCEPTUAL_ROUGHNESS, 1.0);\r\n    surface.roughness = surface.perceptualRoughness * surface.perceptualRoughness;\r\n    surface.diffuseColor = computeDiffuse(baseColor, metallic);\r\n    surface.f0 = computeF0(f0, baseColor, metallic);\r\n    surface.f90 = computeF90(surface.f0);\r\n\r\n    surface.occlusion = inputs.occlusion;\r\n\r\n    #ifdef EMISSION\r\n    surface.emissionColor = inputs.emissionColor;\r\n    #endif // EMISSION\r\n\r\n    #ifdef CLEARCOAT\r\n    surface.clearCoat = inputs.clearCoat;\r\n    surface.clearCoatPerceptualRoughness = clamp(inputs.clearCoatRoughness, MIN_PERCEPTUAL_ROUGHNESS, 1.0);\r\n    surface.clearCoatRoughness = surface.clearCoatPerceptualRoughness * surface.clearCoatPerceptualRoughness;\r\n\t#ifdef CLEARCOAT_NORMAL\r\n    surface.clearCoatNormalTS = inputs.clearCoatNormalTS;\r\n\t#endif // CLEARCOAT_NORMAL\r\n    #endif // CLEARCOAT\r\n\r\n    #ifdef ANISOTROPIC\r\n    surface.anisotropy = inputs.anisotropy;\r\n    surface.anisotropyDirection = inputs.anisotropyDirection;\r\n    #endif // ANISOTROPIC\r\n}\r\n\r\nvec4 PBR_Metallic_Flow(const in SurfaceInputs inputs, in PixelParams pixel)\r\n{\r\n    #ifdef ALPHATEST\r\n    if (inputs.alpha < inputs.alphaTest)\r\n\t{\r\n\t    discard;\r\n\t}\r\n    #endif // ALPHATEST\r\n\r\n    Surface surface;\r\n    initSurface(surface, inputs, pixel);\r\n\r\n    PixelInfo info;\r\n    getPixelInfo(info, pixel, surface);\r\n\r\n    vec3 surfaceColor = vec3(0.0);\r\n    surfaceColor += PBRLighting(surface, info);\r\n\r\n    return vec4(surfaceColor, surface.alpha);\r\n}\r\n\r\n#endif // PBRMetallic_lib\r\n","import { BaseTexture } from \"../../../resource/BaseTexture\";\r\nimport { Material } from \"../../../resource/Material\";\r\nimport { PBRRenderQuality } from \"./PBRRenderQuality\";\r\nimport { Shader3D } from \"../../../RenderEngine/RenderShader/Shader3D\";\r\nimport { ShaderDefine } from \"../../../RenderEngine/RenderShader/ShaderDefine\";\r\nimport { Texture2D } from \"../../../resource/Texture2D\";\r\nimport { Color } from \"../../../maths/Color\";\r\nimport { Vector4 } from \"../../../maths/Vector4\";\r\nimport { RenderState } from \"../../../RenderEngine/RenderShader/RenderState\";\r\nimport { PBRShaderLib } from \"../../shader/pbr/PBRShaderLib\";\r\n\r\n/**\r\n * \r\n */\r\nexport enum PBRRenderMode {\r\n    /***/\r\n    Opaque,\r\n    /***/\r\n    Cutout,\r\n    /**_*/\r\n    Fade,\r\n    /**_*/\r\n    Transparent\r\n}\r\n\r\n/**\r\n * PBR,\r\n */\r\nexport class PBRMaterial extends Material {\r\n    /** @internal */\r\n    static SHADERDEFINE_ALBEDOTEXTURE: ShaderDefine;\r\n    /** @internal */\r\n    static SHADERDEFINE_NORMALTEXTURE: ShaderDefine;\r\n    /** @internal */\r\n    static SHADERDEFINE_OCCLUSIONTEXTURE: ShaderDefine;\r\n    /** @internal */\r\n    static SHADERDEFINE_PARALLAXTEXTURE: ShaderDefine;\r\n    /** @internal */\r\n    static SHADERDEFINE_EMISSIONTEXTURE: ShaderDefine;\r\n\r\n    /**@internal */\r\n    static SHADERDEFINE_DETAILALBEDO: ShaderDefine;\r\n    /**@internal */\r\n    static SHADERDEFINE_DETAILNORMAL: ShaderDefine;\r\n\r\n    /** @internal */\r\n    static SHADERDEFINE_ENABLEVERTEXCOLOR: ShaderDefine;\r\n\r\n    /**@internal */\r\n    static SHADERDEFINE_ANISOTROPYTEXTURE: ShaderDefine;\r\n\r\n    /** @internal */\r\n    static SHADERDEFINE_TRANSPARENTBLEND: ShaderDefine;\r\n    /**@internal */\r\n    static SHADERDEFINE_LAYA_PBR_BRDF_HIGH: ShaderDefine;\r\n    /**@internal */\r\n    static SHADERDEFINE_LAYA_PBR_BRDF_LOW: ShaderDefine;\r\n\r\n    /** @internal */\r\n    static ALBEDOTEXTURE: number;\r\n    /** @internal */\r\n    static ALBEDOCOLOR: number;\r\n    /** @internal */\r\n    static TILINGOFFSET: number;\r\n    /** @internal */\r\n    static NORMALTEXTURE: number;\r\n    /** @internal */\r\n    static NORMALSCALE: number;\r\n    /** @internal */\r\n    static SMOOTHNESS: number;\r\n    /** @internal */\r\n    static SMOOTHNESSSCALE: number;\r\n    /** @internal */\r\n    static OCCLUSIONTEXTURE: number;\r\n    /** @internal */\r\n    static OCCLUSIONSTRENGTH: number;\r\n    /** @internal */\r\n    static PARALLAXTEXTURE: number;\r\n    /** @internal */\r\n    static PARALLAXSCALE: number;\r\n    /** @internal */\r\n    static EMISSIONTEXTURE: number;\r\n    /** @internal */\r\n    static EMISSIONCOLOR: number;\r\n    /**@internal */\r\n    static EMISSIONIntensity: number\r\n\r\n    //Detail\r\n    /** @internal */\r\n    static DETAILALBEDOTEXTURE: number;\r\n    /**@internal */\r\n    static DETAILNORMALTEXTURE: number;\r\n    /**@internal */\r\n    static DETAILTILLINGOFFSET: number;\r\n    /**@internal */\r\n    static DETAILNORMALSCALE: number;\r\n\r\n    // clear coat\r\n    /**@internal */\r\n    static CLEARCOAT: number;\r\n    /**@internal */\r\n    static SHADERDEFINE_CLEARCOATTEXTURE: ShaderDefine;\r\n    /**@internal */\r\n    static CLEARCOATTEXTURE: number;\r\n    /**@internal */\r\n    static CLEARCOATROUGHNESS: number;\r\n    /**@internal */\r\n    static SHADERDEFINE_CLEARCOATROUGHNESSTEXTURE: ShaderDefine;\r\n    /**@internal */\r\n    static CLEARCOATROUGHNESSTEXTURE: number;\r\n    /** @internal */\r\n    static CLEARCOATNORMALTEXTURE: number;\r\n\r\n    // anisotropy\r\n    /** @internal */\r\n    static ANISOTROPY: number;\r\n    /** @internal */\r\n    static ANISOTROPYTEXTURE: number;\r\n    /** @internal */\r\n    static ANISOTROPYROTATION: number;\r\n\r\n    /** */\r\n    static renderQuality: PBRRenderQuality = PBRRenderQuality.High;\r\n\r\n    /**\r\n     * @private\r\n     */\r\n    static __init__(): void {\r\n        PBRMaterial.SHADERDEFINE_ALBEDOTEXTURE = Shader3D.getDefineByName(\"ALBEDOTEXTURE\");\r\n        PBRMaterial.SHADERDEFINE_NORMALTEXTURE = Shader3D.getDefineByName(\"NORMALTEXTURE\");\r\n        PBRMaterial.SHADERDEFINE_PARALLAXTEXTURE = Shader3D.getDefineByName(\"PARALLAXTEXTURE\");\r\n        PBRMaterial.SHADERDEFINE_OCCLUSIONTEXTURE = Shader3D.getDefineByName(\"OCCLUSIONTEXTURE\");\r\n        PBRMaterial.SHADERDEFINE_EMISSIONTEXTURE = Shader3D.getDefineByName(\"EMISSIONTEXTURE\");\r\n        PBRMaterial.SHADERDEFINE_TRANSPARENTBLEND = Shader3D.getDefineByName(\"TRANSPARENTBLEND\");\r\n        PBRMaterial.SHADERDEFINE_LAYA_PBR_BRDF_HIGH = Shader3D.getDefineByName(\"LAYA_PBR_BRDF_HIGH\");\r\n        PBRMaterial.SHADERDEFINE_LAYA_PBR_BRDF_LOW = Shader3D.getDefineByName(\"LAYA_PBR_BRDF_LOW\");\r\n        //Detail\r\n        PBRMaterial.SHADERDEFINE_DETAILALBEDO = Shader3D.getDefineByName(\"DETAILTEXTURE\");\r\n        PBRMaterial.SHADERDEFINE_DETAILNORMAL = Shader3D.getDefineByName(\"DETAILNORMAL\");\r\n\r\n        PBRMaterial.SHADERDEFINE_ENABLEVERTEXCOLOR = Shader3D.getDefineByName(\"ENABLEVERTEXCOLOR\");\r\n\r\n\r\n\r\n        PBRMaterial.ALBEDOTEXTURE = Shader3D.propertyNameToID(\"u_AlbedoTexture\");\r\n        PBRMaterial.ALBEDOCOLOR = Shader3D.propertyNameToID(\"u_AlbedoColor\");\r\n        PBRMaterial.TILINGOFFSET = Shader3D.propertyNameToID(\"u_TilingOffset\");\r\n        PBRMaterial.NORMALTEXTURE = Shader3D.propertyNameToID(\"u_NormalTexture\");\r\n        PBRMaterial.NORMALSCALE = Shader3D.propertyNameToID(\"u_NormalScale\");\r\n        PBRMaterial.SMOOTHNESS = Shader3D.propertyNameToID(\"u_Smoothness\");\r\n        PBRMaterial.OCCLUSIONTEXTURE = Shader3D.propertyNameToID(\"u_OcclusionTexture\");\r\n        PBRMaterial.OCCLUSIONSTRENGTH = Shader3D.propertyNameToID(\"u_OcclusionStrength\");\r\n        PBRMaterial.PARALLAXTEXTURE = Shader3D.propertyNameToID(\"u_ParallaxTexture\");\r\n        PBRMaterial.PARALLAXSCALE = Shader3D.propertyNameToID(\"u_ParallaxScale\");\r\n        PBRMaterial.EMISSIONTEXTURE = Shader3D.propertyNameToID(\"u_EmissionTexture\");\r\n        PBRMaterial.EMISSIONCOLOR = Shader3D.propertyNameToID(\"u_EmissionColor\");\r\n        PBRMaterial.EMISSIONIntensity = Shader3D.propertyNameToID(\"u_EmissionIntensity\");\r\n\r\n        //Detail\r\n        PBRMaterial.DETAILALBEDOTEXTURE = Shader3D.propertyNameToID(\"u_DetailAlbedoTexture\");\r\n        PBRMaterial.DETAILNORMALTEXTURE = Shader3D.propertyNameToID(\"u_DetailNormalTexture\");\r\n        PBRMaterial.DETAILTILLINGOFFSET = Shader3D.propertyNameToID(\"u_DetailTillingOffset\");\r\n        PBRMaterial.DETAILNORMALSCALE = Shader3D.propertyNameToID(\"u_DetailNormalScale\");\r\n\r\n        // clear coat\r\n        PBRMaterial.CLEARCOAT = Shader3D.propertyNameToID(\"u_ClearCoatFactor\");\r\n        PBRMaterial.SHADERDEFINE_CLEARCOATTEXTURE = Shader3D.getDefineByName(\"CLEARCOATMAP\");\r\n        PBRMaterial.CLEARCOATTEXTURE = Shader3D.propertyNameToID(\"u_ClearCoatTexture\");\r\n\r\n        PBRMaterial.CLEARCOATROUGHNESS = Shader3D.propertyNameToID(\"u_ClearCoatRoughness\");\r\n        PBRMaterial.SHADERDEFINE_CLEARCOATROUGHNESSTEXTURE = Shader3D.getDefineByName(\"CLEARCOAT_ROUGHNESSMAP\");\r\n        PBRMaterial.CLEARCOATROUGHNESSTEXTURE = Shader3D.propertyNameToID(\"u_ClearCoatRoughnessTexture\");\r\n        PBRMaterial.CLEARCOATNORMALTEXTURE = Shader3D.propertyNameToID(\"u_ClearCoatNormalTexture\");\r\n\r\n        // anisotropy\r\n        PBRMaterial.ANISOTROPY = Shader3D.propertyNameToID(\"u_AnisotropyStrength\");\r\n        PBRMaterial.SHADERDEFINE_ANISOTROPYTEXTURE = Shader3D.getDefineByName(\"ANISOTROPYMAP\");\r\n        PBRMaterial.ANISOTROPYTEXTURE = Shader3D.propertyNameToID(\"u_AnisotropyTexture\");\r\n        PBRMaterial.ANISOTROPYROTATION = Shader3D.propertyNameToID(\"u_AnisotropyRotation\");\r\n    }\r\n\r\n\r\n    /**\r\n     * \r\n     */\r\n    get albedoColor(): Color {\r\n        return this._shaderValues.getColor(PBRMaterial.ALBEDOCOLOR);\r\n    }\r\n\r\n    set albedoColor(value: Color) {\r\n        this._shaderValues.setColor(PBRMaterial.ALBEDOCOLOR, value);\r\n    }\r\n\r\n    /**\r\n     * \r\n     */\r\n    get albedoTexture(): BaseTexture {\r\n        if (this.hasDefine(PBRMaterial.SHADERDEFINE_ALBEDOTEXTURE)) {\r\n            return this._shaderValues.getTexture(PBRMaterial.ALBEDOTEXTURE);\r\n        }\r\n        else {\r\n            return null;\r\n        }\r\n    }\r\n\r\n    set albedoTexture(value: BaseTexture) {\r\n        if (value)\r\n            this._shaderValues.addDefine(PBRMaterial.SHADERDEFINE_ALBEDOTEXTURE);\r\n        else\r\n            this._shaderValues.removeDefine(PBRMaterial.SHADERDEFINE_ALBEDOTEXTURE);\r\n\r\n        this._shaderValues.setTexture(PBRMaterial.ALBEDOTEXTURE, value);\r\n    }\r\n\r\n    /**\r\n     * \r\n     */\r\n    get normalTexture(): BaseTexture {\r\n        if (this.hasDefine(PBRMaterial.SHADERDEFINE_NORMALTEXTURE)) {\r\n            return this._shaderValues.getTexture(PBRMaterial.NORMALTEXTURE);\r\n        }\r\n        else {\r\n            return null;\r\n        }\r\n    }\r\n\r\n    set normalTexture(value: BaseTexture) {\r\n        if (value) {\r\n            this._shaderValues.addDefine(PBRMaterial.SHADERDEFINE_NORMALTEXTURE);\r\n        } else {\r\n            this._shaderValues.removeDefine(PBRMaterial.SHADERDEFINE_NORMALTEXTURE);\r\n        }\r\n        this._shaderValues.setTexture(PBRMaterial.NORMALTEXTURE, value);\r\n    }\r\n\r\n    /**\r\n     * \r\n     */\r\n    get normalTextureScale(): number {\r\n        return this._shaderValues.getNumber(PBRMaterial.NORMALSCALE);\r\n    }\r\n\r\n    set normalTextureScale(value: number) {\r\n        this._shaderValues.setNumber(PBRMaterial.NORMALSCALE, value);\r\n    }\r\n\r\n    /**\r\n     * \r\n     */\r\n    get parallaxTexture(): BaseTexture {\r\n        return this._shaderValues.getTexture(PBRMaterial.PARALLAXTEXTURE);\r\n    }\r\n\r\n    set parallaxTexture(value: BaseTexture) {\r\n        if (value)\r\n            this._shaderValues.addDefine(PBRMaterial.SHADERDEFINE_PARALLAXTEXTURE);\r\n        else\r\n            this._shaderValues.removeDefine(PBRMaterial.SHADERDEFINE_PARALLAXTEXTURE);\r\n        this._shaderValues.setTexture(PBRMaterial.PARALLAXTEXTURE, value);\r\n    }\r\n\r\n    /**\r\n     * \r\n     */\r\n    get parallaxTextureScale(): number {\r\n        return this._shaderValues.getNumber(PBRMaterial.PARALLAXSCALE);\r\n    }\r\n\r\n    set parallaxTextureScale(value: number) {\r\n        this._shaderValues.setNumber(PBRMaterial.PARALLAXSCALE, Math.max(0.005, Math.min(0.08, value)));\r\n    }\r\n\r\n    /**\r\n     * \r\n     */\r\n    get occlusionTexture(): BaseTexture {\r\n        return this._shaderValues.getTexture(PBRMaterial.OCCLUSIONTEXTURE);\r\n    }\r\n\r\n    set occlusionTexture(value: BaseTexture) {\r\n        if (value)\r\n            this._shaderValues.addDefine(PBRMaterial.SHADERDEFINE_OCCLUSIONTEXTURE);\r\n        else\r\n            this._shaderValues.removeDefine(PBRMaterial.SHADERDEFINE_OCCLUSIONTEXTURE);\r\n\r\n        this._shaderValues.setTexture(PBRMaterial.OCCLUSIONTEXTURE, value);\r\n    }\r\n\r\n    /**\r\n     * ,01\r\n     */\r\n    get occlusionTextureStrength(): number {\r\n        return this._shaderValues.getNumber(PBRMaterial.OCCLUSIONSTRENGTH);\r\n    }\r\n\r\n    set occlusionTextureStrength(value: number) {\r\n        this._shaderValues.setNumber(PBRMaterial.OCCLUSIONSTRENGTH, Math.max(0.0, Math.min(1.0, value)));\r\n    }\r\n\r\n    /**\r\n     * ,01\r\n     */\r\n    get smoothness(): number {\r\n        return this._shaderValues.getNumber(PBRMaterial.SMOOTHNESS);\r\n    }\r\n\r\n    set smoothness(value: number) {\r\n        this._shaderValues.setNumber(PBRMaterial.SMOOTHNESS, Math.max(0.0, Math.min(1.0, value)));\r\n    }\r\n\r\n    /**\r\n      * \r\n      */\r\n    get enableVertexColor(): boolean {\r\n        return this.hasDefine(PBRMaterial.SHADERDEFINE_ENABLEVERTEXCOLOR);\r\n    }\r\n\r\n    set enableVertexColor(value: boolean) {\r\n        if (value)\r\n            this.addDefine(PBRMaterial.SHADERDEFINE_ENABLEVERTEXCOLOR);\r\n        else\r\n            this.removeDefine(PBRMaterial.SHADERDEFINE_ENABLEVERTEXCOLOR);\r\n    }\r\n\r\n    /**\r\n     * \r\n     */\r\n    get enableEmission(): boolean {\r\n        return this._shaderValues.hasDefine(PBRShaderLib.DEFINE_EMISSION);\r\n    }\r\n\r\n    set enableEmission(value: boolean) {\r\n        if (value)\r\n            this._shaderValues.addDefine(PBRShaderLib.DEFINE_EMISSION);\r\n        else\r\n            this._shaderValues.removeDefine(PBRShaderLib.DEFINE_EMISSION);\r\n    }\r\n\r\n    /**\r\n     * \r\n     */\r\n    get emissionColor(): Color {\r\n        return this._shaderValues.getColor(PBRMaterial.EMISSIONCOLOR);\r\n    }\r\n\r\n    set emissionColor(value: Color) {\r\n        this._shaderValues.setColor(PBRMaterial.EMISSIONCOLOR, value);\r\n    }\r\n\r\n    set emissionIntensity(value: number) {\r\n        //u_EmissionIntensity\r\n        this._shaderValues.setNumber(PBRMaterial.EMISSIONIntensity, value);\r\n    }\r\n\r\n    get emissionIntensity() {\r\n        return this._shaderValues.getNumber(PBRMaterial.EMISSIONIntensity);\r\n    }\r\n\r\n    /**\r\n     * \r\n     */\r\n    get emissionTexture(): BaseTexture {\r\n        return this._shaderValues.getTexture(PBRMaterial.EMISSIONTEXTURE);\r\n    }\r\n\r\n    set emissionTexture(value: BaseTexture) {\r\n        if (value)\r\n            this._shaderValues.addDefine(PBRMaterial.SHADERDEFINE_EMISSIONTEXTURE);\r\n        else\r\n            this._shaderValues.removeDefine(PBRMaterial.SHADERDEFINE_EMISSIONTEXTURE);\r\n\r\n        this._shaderValues.setTexture(PBRMaterial.EMISSIONTEXTURE, value);\r\n    }\r\n\r\n    /**\r\n     * \r\n     */\r\n    get tilingOffset(): Vector4 {\r\n        return (<Vector4>this._shaderValues.getVector(PBRMaterial.TILINGOFFSET));\r\n    }\r\n\r\n    set tilingOffset(value: Vector4) {\r\n        if (value) {\r\n            this._shaderValues.setVector(PBRMaterial.TILINGOFFSET, value);\r\n        }\r\n        else {\r\n            this._shaderValues.getVector(PBRMaterial.TILINGOFFSET).setValue(1.0, 1.0, 0.0, 0.0);\r\n        }\r\n    }\r\n\r\n\r\n    /**\r\n     * \r\n     */\r\n    get detailAlbedoTexture(): BaseTexture {\r\n        return this._shaderValues.getTexture(PBRMaterial.DETAILALBEDOTEXTURE);\r\n    }\r\n\r\n    set detailAlbedoTexture(value: BaseTexture) {\r\n        if (value)\r\n            this._shaderValues.addDefine(PBRMaterial.SHADERDEFINE_DETAILALBEDO);\r\n        else\r\n            this._shaderValues.removeDefine(PBRMaterial.SHADERDEFINE_DETAILALBEDO);\r\n\r\n        this._shaderValues.setTexture(PBRMaterial.DETAILALBEDOTEXTURE, value);\r\n    }\r\n\r\n\r\n    /**\r\n     * \r\n     */\r\n    get detailNormalTexture(): BaseTexture {\r\n        return this._shaderValues.getTexture(PBRMaterial.DETAILNORMALTEXTURE);\r\n    }\r\n\r\n    set detailNormalTexture(value: BaseTexture) {\r\n        if (value)\r\n            this._shaderValues.addDefine(PBRMaterial.SHADERDEFINE_DETAILNORMAL);\r\n        else\r\n            this._shaderValues.removeDefine(PBRMaterial.SHADERDEFINE_DETAILNORMAL);\r\n        this._shaderValues.setTexture(PBRMaterial.DETAILNORMALTEXTURE, value);\r\n    }\r\n\r\n    /**\r\n    * \r\n    */\r\n    get detailTilingOffset(): Vector4 {\r\n        return (<Vector4>this._shaderValues.getVector(PBRMaterial.DETAILTILLINGOFFSET));\r\n    }\r\n\r\n    set detailTilingOffset(value: Vector4) {\r\n        if (value) {\r\n            this._shaderValues.setVector(PBRMaterial.DETAILTILLINGOFFSET, value);\r\n        }\r\n        else {\r\n            this._shaderValues.getVector(PBRMaterial.DETAILTILLINGOFFSET).setValue(1.0, 1.0, 0.0, 0.0);\r\n        }\r\n    }\r\n\r\n    /**\r\n    * \r\n    */\r\n    get detailNormalScale(): number {\r\n        return this._shaderValues.getNumber(PBRMaterial.DETAILNORMALSCALE);\r\n    }\r\n\r\n    set detailNormalScale(value: number) {\r\n        this._shaderValues.setNumber(PBRMaterial.DETAILNORMALSCALE, value);\r\n    }\r\n\r\n\r\n\r\n\r\n    /**\r\n     * \r\n     */\r\n    set renderMode(value: number) {\r\n        switch (value) {\r\n            case PBRRenderMode.Opaque:\r\n                this.alphaTest = false;\r\n                this.renderQueue = Material.RENDERQUEUE_OPAQUE;\r\n                this.depthWrite = true;\r\n                this.cull = RenderState.CULL_BACK;\r\n                this.blend = RenderState.BLEND_DISABLE;\r\n                this.depthTest = RenderState.DEPTHTEST_LESS;\r\n                this._shaderValues.removeDefine(PBRMaterial.SHADERDEFINE_TRANSPARENTBLEND);\r\n                break;\r\n            case PBRRenderMode.Cutout:\r\n                this.renderQueue = Material.RENDERQUEUE_ALPHATEST;\r\n                this.alphaTest = true;\r\n                this.depthWrite = true;\r\n                this.cull = RenderState.CULL_BACK;\r\n                this.blend = RenderState.BLEND_DISABLE;\r\n                this.depthTest = RenderState.DEPTHTEST_LESS;\r\n                this._shaderValues.removeDefine(PBRMaterial.SHADERDEFINE_TRANSPARENTBLEND);\r\n                break;\r\n            case PBRRenderMode.Fade:\r\n                this.renderQueue = Material.RENDERQUEUE_TRANSPARENT;\r\n                this.alphaTest = false;\r\n                this.depthWrite = false;\r\n                this.cull = RenderState.CULL_BACK;\r\n                this.blend = RenderState.BLEND_ENABLE_ALL;\r\n                this.blendSrc = RenderState.BLENDPARAM_SRC_ALPHA;\r\n                this.blendDst = RenderState.BLENDPARAM_ONE_MINUS_SRC_ALPHA;\r\n                this.depthTest = RenderState.DEPTHTEST_LESS;\r\n                this._shaderValues.removeDefine(PBRMaterial.SHADERDEFINE_TRANSPARENTBLEND);\r\n                break;\r\n            case PBRRenderMode.Transparent:\r\n                this.renderQueue = Material.RENDERQUEUE_TRANSPARENT;\r\n                this.alphaTest = false;\r\n                this.depthWrite = false;\r\n                this.cull = RenderState.CULL_BACK;\r\n                this.blend = RenderState.BLEND_ENABLE_ALL;\r\n                this.blendSrc = RenderState.BLENDPARAM_ONE;\r\n                this.blendDst = RenderState.BLENDPARAM_ONE_MINUS_SRC_ALPHA;\r\n                this.depthTest = RenderState.DEPTHTEST_LESS;\r\n                this._shaderValues.addDefine(PBRMaterial.SHADERDEFINE_TRANSPARENTBLEND);\r\n                break;\r\n            default:\r\n                throw new Error(\"PBRMaterial:unknown renderMode value.\");\r\n        }\r\n    }\r\n\r\n    /**\r\n     *  anisotropy\r\n     */\r\n    public get anisotropyEnable(): boolean {\r\n        return this.shaderData.hasDefine(PBRShaderLib.DEFINE_ANISOTROPY);\r\n    }\r\n    public set anisotropyEnable(value: boolean) {\r\n        if (value) {\r\n            this.shaderData.addDefine(PBRShaderLib.DEFINE_ANISOTROPY);\r\n        }\r\n        else {\r\n            this.shaderData.removeDefine(PBRShaderLib.DEFINE_ANISOTROPY);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * anisotropy \r\n     */\r\n    public get anisotropy(): number {\r\n        return this.getFloatByIndex(PBRMaterial.ANISOTROPY);\r\n    }\r\n    public set anisotropy(value: number) {\r\n        this.setFloatByIndex(PBRMaterial.ANISOTROPY, Math.min(1, Math.max(-1, value)));\r\n    }\r\n\r\n    /**\r\n     * anisotropy \r\n     */\r\n    public get anisotropyTexture(): Texture2D {\r\n        return <Texture2D>this.getTextureByIndex(PBRMaterial.ANISOTROPYTEXTURE);\r\n    }\r\n\r\n    public set anisotropyTexture(value: Texture2D) {\r\n        this.setTextureByIndex(PBRMaterial.ANISOTROPYTEXTURE, value);\r\n        if (value) {\r\n            this.addDefine(PBRMaterial.SHADERDEFINE_ANISOTROPYTEXTURE);\r\n        }\r\n        else {\r\n            this.removeDefine(PBRMaterial.SHADERDEFINE_ANISOTROPYTEXTURE);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * anisotropy   \r\n     */\r\n    public get anisotropyRotation(): number {\r\n        return this.getFloatByIndex(PBRMaterial.ANISOTROPYROTATION);\r\n    }\r\n    public set anisotropyRotation(value: number) {\r\n        value = Math.max(Math.min(value, 1.0), 0.0);\r\n        this.setFloatByIndex(PBRMaterial.ANISOTROPYROTATION, value);\r\n    }\r\n\r\n    /**\r\n     *  clear coat\r\n     */\r\n    public get clearCoatEnable(): boolean {\r\n        return this.shaderData.hasDefine(PBRShaderLib.DEFINE_CLEARCOAT);\r\n    }\r\n    public set clearCoatEnable(value: boolean) {\r\n        if (value) {\r\n            this.shaderData.addDefine(PBRShaderLib.DEFINE_CLEARCOAT);\r\n        }\r\n        else {\r\n            this.shaderData.removeDefine(PBRShaderLib.DEFINE_CLEARCOAT);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * clear coat  \r\n     */\r\n    public get clearCoat(): number {\r\n        return this.shaderData.getNumber(PBRMaterial.CLEARCOAT);\r\n    }\r\n    public set clearCoat(value: number) {\r\n        this.shaderData.setNumber(PBRMaterial.CLEARCOAT, value);\r\n    }\r\n\r\n    /**\r\n     * clear coat \r\n     */\r\n    public get clearCoatTexture(): BaseTexture {\r\n        return this.shaderData.getTexture(PBRMaterial.CLEARCOATTEXTURE);\r\n    }\r\n    public set clearCoatTexture(value: BaseTexture) {\r\n        if (value) {\r\n            this.shaderData.addDefine(PBRMaterial.SHADERDEFINE_CLEARCOATTEXTURE);\r\n        }\r\n        else {\r\n            this.shaderData.removeDefine(PBRMaterial.SHADERDEFINE_CLEARCOATTEXTURE);\r\n        }\r\n        this.shaderData.setTexture(PBRMaterial.CLEARCOATTEXTURE, value);\r\n    }\r\n\r\n    /**\r\n     * clear coat  \r\n     */\r\n    public get clearCoatRoughness(): number {\r\n        return this.shaderData.getNumber(PBRMaterial.CLEARCOATROUGHNESS);\r\n    }\r\n    public set clearCoatRoughness(value: number) {\r\n        this.shaderData.setNumber(PBRMaterial.CLEARCOATROUGHNESS, value);\r\n    }\r\n\r\n    /**\r\n     * clear coat  \r\n     */\r\n    public get clearCoatRoughnessTexture(): BaseTexture {\r\n        return this.shaderData.getTexture(PBRMaterial.CLEARCOATROUGHNESSTEXTURE);\r\n    }\r\n    public set clearCoatRoughnessTexture(value: BaseTexture) {\r\n        if (value) {\r\n            this.shaderData.addDefine(PBRMaterial.SHADERDEFINE_CLEARCOATROUGHNESSTEXTURE);\r\n        }\r\n        else {\r\n            this.shaderData.removeDefine(PBRMaterial.SHADERDEFINE_CLEARCOATROUGHNESSTEXTURE);\r\n        }\r\n        this.shaderData.setTexture(PBRMaterial.CLEARCOATROUGHNESSTEXTURE, value);\r\n    }\r\n\r\n    /**\r\n     * clear coat \r\n     */\r\n    public get clearCoatNormalTexture(): BaseTexture {\r\n        return this.shaderData.getTexture(PBRMaterial.CLEARCOATNORMALTEXTURE);\r\n    }\r\n    public set clearCoatNormalTexture(value: BaseTexture) {\r\n        if (value) {\r\n            this.shaderData.addDefine(PBRShaderLib.DEFINE_CLEARCOAT_NORMAL);\r\n        }\r\n        else {\r\n            this.shaderData.removeDefine(PBRShaderLib.DEFINE_CLEARCOAT_NORMAL);\r\n        }\r\n        this.shaderData.setTexture(PBRMaterial.CLEARCOATNORMALTEXTURE, value);\r\n    }\r\n\r\n    constructor() {\r\n        super();\r\n        this._shaderValues.setColor(PBRMaterial.ALBEDOCOLOR, new Color(1.0, 1.0, 1.0, 1.0));\r\n        this._shaderValues.setColor(PBRMaterial.EMISSIONCOLOR, new Color(1.0, 1.0, 1.0, 1.0));\r\n        this._shaderValues.setVector(PBRMaterial.TILINGOFFSET, new Vector4(1.0, 1.0, 0.0, 0.0));\r\n        this._shaderValues.setNumber(PBRMaterial.SMOOTHNESS, 0.5);\r\n        this._shaderValues.setNumber(PBRMaterial.OCCLUSIONSTRENGTH, 1.0);\r\n        this._shaderValues.setNumber(PBRMaterial.NORMALSCALE, 1.0);\r\n        this._shaderValues.setNumber(PBRMaterial.PARALLAXSCALE, 0.001);\r\n        this._shaderValues.setNumber(Material.ALPHATESTVALUE, 0.5);\r\n        this.renderMode = PBRRenderMode.Opaque;\r\n    }\r\n\r\n\r\n    //deprecated\r\n    /**\r\n     * @deprecated\r\n     * ,01\r\n     */\r\n    get smoothnessTextureScale(): number {\r\n        return this._shaderValues.getNumber(PBRMaterial.SMOOTHNESS);\r\n    }\r\n\r\n    set smoothnessTextureScale(value: number) {\r\n        this._shaderValues.setNumber(PBRMaterial.SMOOTHNESS, Math.max(0.0, Math.min(1.0, value)));\r\n    }\r\n}","import { BaseTexture } from \"../../../resource/BaseTexture\";\r\nimport { PBRMaterial } from \"./PBRMaterial\";\r\nimport { Shader3D } from \"../../../RenderEngine/RenderShader/Shader3D\";\r\nimport { ShaderDefine } from \"../../../RenderEngine/RenderShader/ShaderDefine\";\r\n\r\n/**\r\n * PBR\r\n */\r\nexport enum PBRMetallicSmoothnessSource {\r\n\t/**Alpha*/\r\n\tMetallicGlossTextureAlpha,\r\n\t/**Alpha*/\r\n\tAlbedoTextureAlpha\r\n}\r\n\r\n/**\r\n * <code>PBRStandardMaterial</code> PBR\r\n */\r\nexport class PBRStandardMaterial extends PBRMaterial {\r\n\t/** @internal */\r\n\tstatic SHADERDEFINE_SMOOTHNESSSOURCE_ALBEDOTEXTURE_ALPHA: ShaderDefine;\r\n\t/** @internal */\r\n\tstatic SHADERDEFINE_METALLICGLOSSTEXTURE: ShaderDefine;\r\n\t/** @internal */\r\n\tstatic METALLICGLOSSTEXTURE: number;\r\n\t/** @internal */\r\n\tstatic METALLIC: number;\r\n\t/** */\r\n\tstatic defaultMaterial: PBRStandardMaterial;\r\n\r\n\t/**\r\n\t * @internal\r\n\t */\r\n\tstatic __init__(): void {\r\n\t\tPBRStandardMaterial.SHADERDEFINE_METALLICGLOSSTEXTURE = Shader3D.getDefineByName(\"METALLICGLOSSTEXTURE\");\r\n\t\tPBRStandardMaterial.SHADERDEFINE_SMOOTHNESSSOURCE_ALBEDOTEXTURE_ALPHA = Shader3D.getDefineByName(\"SMOOTHNESSSOURCE_ALBEDOTEXTURE_ALPHA\");\r\n\t\tPBRStandardMaterial.METALLICGLOSSTEXTURE = Shader3D.propertyNameToID(\"u_MetallicGlossTexture\");\r\n\t\tPBRStandardMaterial.METALLIC = Shader3D.propertyNameToID(\"u_Metallic\");\r\n\t\t// var shader: Shader3D = Shader3D.add(\"PBR\", true, true);\r\n\t\t// var subShader: SubShader = new SubShader();\r\n\t\t// shader.addSubShader(subShader);\r\n\t\t// subShader.addShaderPass(PBRVS, PBRPS, \"Forward\");\r\n\t\t// subShader.addShaderPass(PBRShadowCasterVS, PBRShadowCasterPS, \"ShadowCaster\");\r\n\t\t// subShader.addShaderPass(DepthNormalsTextureVS, DepthNormalsTextureFS, \"DepthNormal\");\r\n\t}\r\n\r\n\t/** @internal */\r\n\tprivate _smoothnessSource: PBRMetallicSmoothnessSource = 0;\r\n\r\n\t/**\r\n\t * \r\n\t */\r\n\tget metallicGlossTexture(): BaseTexture {\r\n\t\treturn this._shaderValues.getTexture(PBRStandardMaterial.METALLICGLOSSTEXTURE);\r\n\t}\r\n\r\n\tset metallicGlossTexture(value: BaseTexture) {\r\n\t\tif (value)\r\n\t\t\tthis._shaderValues.addDefine(PBRStandardMaterial.SHADERDEFINE_METALLICGLOSSTEXTURE);\r\n\t\telse\r\n\t\t\tthis._shaderValues.removeDefine(PBRStandardMaterial.SHADERDEFINE_METALLICGLOSSTEXTURE);\r\n\r\n\t\tthis._shaderValues.setTexture(PBRStandardMaterial.METALLICGLOSSTEXTURE, value);\r\n\t}\r\n\r\n\t/**\r\n\t * ,01\r\n\t */\r\n\tget metallic(): number {\r\n\t\treturn this._shaderValues.getNumber(PBRStandardMaterial.METALLIC);\r\n\t}\r\n\r\n\tset metallic(value: number) {\r\n\t\tthis._shaderValues.setNumber(PBRStandardMaterial.METALLIC, Math.max(0.0, Math.min(1.0, value)));\r\n\t}\r\n\r\n\t/**\r\n\t * ,01\r\n\t */\r\n\tget smoothnessSource(): PBRMetallicSmoothnessSource {\r\n\t\treturn this._smoothnessSource;\r\n\t}\r\n\r\n\tset smoothnessSource(value: PBRMetallicSmoothnessSource) {\r\n\t\tif (value)\r\n\t\t\tthis._shaderValues.addDefine(PBRStandardMaterial.SHADERDEFINE_SMOOTHNESSSOURCE_ALBEDOTEXTURE_ALPHA);\r\n\t\telse\r\n\t\t\tthis._shaderValues.removeDefine(PBRStandardMaterial.SHADERDEFINE_SMOOTHNESSSOURCE_ALBEDOTEXTURE_ALPHA);\r\n\t\tthis._smoothnessSource = value;\r\n\t}\r\n\r\n\t/**\r\n\t *  <code>PBRStandardMaterial</code> \r\n\t */\r\n\tconstructor() {\r\n\t\tsuper();\r\n\t\tthis.setShaderName(\"PBR\");\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t * @return\t \r\n\t * @override\r\n\t */\r\n\tclone(): any {\r\n\t\tvar dest: PBRStandardMaterial = new PBRStandardMaterial();\r\n\t\tthis.cloneTo(dest);\r\n\t\treturn dest;\r\n\t}\r\n}\r\n\r\n\r\n","import { Vector2 } from \"../../../../../maths/Vector2\";\r\nimport { Vector3 } from \"../../../../../maths/Vector3\";\r\nimport { IClone } from \"../../../../../utils/IClone\"\r\nimport { BoundBox } from \"../../../../math/BoundBox\"\r\nimport { Rand } from \"../../../../math/Rand\"\r\n\r\nexport enum ParticleSystemShapeType {\r\n\t/** */\r\n\tBox = 0,\r\n\t/** */\r\n\tCircle = 1,\r\n\t/** */\r\n\tCone = 2,\r\n\t/** */\r\n\tHemisphere = 3,\r\n\t/** */\r\n\tSphere = 4\r\n}\r\n\r\n\r\n/**\r\n * <code>BaseShape</code> \r\n */\r\nexport class BaseShape implements IClone {\r\n\t/***/\r\n\tenable: boolean = true;\r\n\t/***/\r\n\trandomDirection: number = 0;\r\n\r\n\t/** */\r\n\tshapeType: ParticleSystemShapeType;\r\n\r\n\t/**\r\n\t *  <code>BaseShape</code> \r\n\t */\r\n\tconstructor() {\r\n\t}\r\n\r\n\t/**@internal */\r\n\tprotected _getShapeBoundBox(boundBox: BoundBox): void {\r\n\t\tthrow new Error(\"BaseShape: must override it.\");\r\n\t}\r\n\r\n\t/**@internal */\r\n\tprotected _getSpeedBoundBox(boundBox: BoundBox): void {\r\n\t\tthrow new Error(\"BaseShape: must override it.\");\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t * @param\tposition \r\n\t * @param\tdirection \r\n\t */\r\n\tgeneratePositionAndDirection(position: Vector3, direction: Vector3, rand: Rand = null, randomSeeds: Uint32Array = null): void {\r\n\t\tthrow new Error(\"BaseShape: must override it.\");\r\n\t}\r\n\r\n\t/** \r\n\t * @internal \r\n\t */\r\n\t_calculateProceduralBounds(boundBox: BoundBox, emitterPosScale: Vector3, minMaxBounds: Vector2): void {\r\n\t\tthis._getShapeBoundBox(boundBox);\r\n\r\n\t\tvar min: Vector3 = boundBox.min;\r\n\t\tvar max: Vector3 = boundBox.max;\r\n\t\tVector3.multiply(min, emitterPosScale, min);\r\n\t\tVector3.multiply(max, emitterPosScale, max);\r\n\r\n\t\tvar speedBounds: BoundBox = new BoundBox(new Vector3(), new Vector3());\r\n\t\tif (this.randomDirection/* && (m_Type != kCone) && (m_Type != kConeShell)*/)//TODO:randomDirection01\r\n\t\t{\r\n\t\t\tspeedBounds.min = new Vector3(-1, -1, -1);\r\n\t\t\tspeedBounds.max = new Vector3(1, 1, 1);\r\n\t\t\t//minMaxBounds = Abs(minMaxBounds);\r\n\t\t}\r\n\t\telse {\r\n\t\t\tthis._getSpeedBoundBox(speedBounds);\r\n\t\t}\r\n\r\n\r\n\t\tvar maxSpeedBound: BoundBox = new BoundBox(new Vector3(), new Vector3());\r\n\t\tvar maxSpeedMin: Vector3 = maxSpeedBound.min;\r\n\t\tvar maxSpeedMax: Vector3 = maxSpeedBound.max;\r\n\t\tVector3.scale(speedBounds.min, minMaxBounds.y, maxSpeedMin);\r\n\t\tVector3.scale(speedBounds.max, minMaxBounds.y, maxSpeedMax);\r\n\t\tVector3.add(boundBox.min, maxSpeedMin, maxSpeedMin);\r\n\t\tVector3.add(boundBox.max, maxSpeedMax, maxSpeedMax);\r\n\r\n\t\tVector3.min(boundBox.min, maxSpeedMin, boundBox.min);\r\n\t\tVector3.max(boundBox.max, maxSpeedMin, boundBox.max);\r\n\r\n\r\n\t\tvar minSpeedBound: BoundBox = new BoundBox(new Vector3(), new Vector3());\r\n\t\tvar minSpeedMin: Vector3 = minSpeedBound.min;\r\n\t\tvar minSpeedMax: Vector3 = minSpeedBound.max;\r\n\t\tVector3.scale(speedBounds.min, minMaxBounds.x, minSpeedMin);\r\n\t\tVector3.scale(speedBounds.max, minMaxBounds.x, minSpeedMax);\r\n\r\n\t\tVector3.min(minSpeedBound.min, minSpeedMax, maxSpeedMin);\r\n\t\tVector3.max(minSpeedBound.min, minSpeedMax, maxSpeedMax);\r\n\r\n\t\tVector3.min(boundBox.min, maxSpeedMin, boundBox.min);\r\n\t\tVector3.max(boundBox.max, maxSpeedMin, boundBox.max);\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t * @param\tdestObject \r\n\t */\r\n\tcloneTo(destObject: any): void {\r\n\t\tvar destShape: BaseShape = (<BaseShape>destObject);\r\n\t\tdestShape.enable = this.enable;\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t * @return\t \r\n\t */\r\n\tclone(): any {\r\n\t\tvar destShape: BaseShape = new BaseShape();\r\n\t\tthis.cloneTo(destShape);\r\n\t\treturn destShape;\r\n\t}\r\n\r\n}\r\n\r\n\r\n","export enum TrailAlignment {\r\n    /** */\r\n    View,\r\n    /** */\r\n    TransformZ\r\n}\r\n","export enum EPhysicsCapable {\r\n    Physics_Gravity,   //  \r\n    Physics_StaticCollider,  // \r\n    Physics_DynamicCollider, // \r\n    Physics_CharacterCollider,   // \r\n    Physics_BoxColliderShape,   // \r\n    Physics_SphereColliderShape,    // \r\n    Physics_CapsuleColliderShape,   // \r\n    Physics_CylinderColliderShape,  // \r\n    Physics_ConeColliderShape,  // \r\n    Physics_MeshColliderShape,  //  // _bt TODO\r\n    Physics_CompoundColliderShape,  //  // _bt TODO\r\n    Physics_CreateCorveMesh,  //CorveMesh // _bt TODO\r\n    physics_heightFieldColliderShape,\r\n    Physics_Joint,\r\n    Physics_FixedJoint,\r\n    Physics_SpringJoint,\r\n    Physics_HingeJoint,\r\n    Physics_D6Joint,\r\n}","import { Color } from \"../../../maths/Color\";\r\nimport { Shader3D } from \"../../../RenderEngine/RenderShader/Shader3D\";\r\nimport { TextureCube } from \"../../../resource/TextureCube\";\r\nimport { Material } from \"../../../resource/Material\";\r\n\r\n/**\r\n * <code>SkyBoxMaterial</code> SkyBoxMaterial\r\n */\r\nexport class SkyBoxMaterial extends Material {\r\n\tstatic TINTCOLOR: number;\r\n\tstatic EXPOSURE: number;\r\n\tstatic ROTATION: number;\r\n\tstatic TEXTURECUBE: number;\r\n\r\n\t/** */\r\n\tstatic defaultMaterial: SkyBoxMaterial;\r\n\r\n\t/**\r\n\t* @internal\r\n\t*/\r\n\tstatic __initDefine__(): void {\r\n\t\tSkyBoxMaterial.TINTCOLOR = Shader3D.propertyNameToID(\"u_TintColor\");\r\n\t\tSkyBoxMaterial.EXPOSURE = Shader3D.propertyNameToID(\"u_Exposure\");\r\n\t\tSkyBoxMaterial.ROTATION = Shader3D.propertyNameToID(\"u_Rotation\");\r\n\t\tSkyBoxMaterial.TEXTURECUBE = Shader3D.propertyNameToID(\"u_CubeTexture\");\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t */\r\n\tget tintColor(): Color {\r\n\t\treturn this._shaderValues.getColor(SkyBoxMaterial.TINTCOLOR);\r\n\t}\r\n\r\n\tset tintColor(value: Color) {\r\n\t\tthis._shaderValues.setColor(SkyBoxMaterial.TINTCOLOR, value);\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t */\r\n\tget exposure(): number {\r\n\t\treturn this._shaderValues.getNumber(SkyBoxMaterial.EXPOSURE);\r\n\t}\r\n\r\n\tset exposure(value: number) {\r\n\t\tthis._shaderValues.setNumber(SkyBoxMaterial.EXPOSURE, value);\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t */\r\n\tget rotation(): number {\r\n\t\treturn this._shaderValues.getNumber(SkyBoxMaterial.ROTATION);\r\n\t}\r\n\r\n\tset rotation(value: number) {\r\n\t\tthis._shaderValues.setNumber(SkyBoxMaterial.ROTATION, value);\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t */\r\n\tget textureCube(): TextureCube {\r\n\t\treturn (<TextureCube>this._shaderValues.getTexture(SkyBoxMaterial.TEXTURECUBE));\r\n\t}\r\n\r\n\tset textureCube(value: TextureCube) {\r\n\t\tthis._shaderValues.setTexture(SkyBoxMaterial.TEXTURECUBE, value);\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t * @return\t \r\n\t * @override\r\n\t */\r\n\tclone(): any {\r\n\t\tvar dest: SkyBoxMaterial = new SkyBoxMaterial();\r\n\t\tthis.cloneTo(dest);\r\n\t\treturn dest;\r\n\t}\r\n\r\n\t/**\r\n\t *  <code>SkyBoxMaterial</code> \r\n\t */\r\n\tconstructor() {\r\n\t\tsuper();\r\n\t\tthis.setShaderName(\"SkyBox\");\r\n\t}\r\n\r\n}\r\n\r\n\r\n","import { Color } from \"../../../maths/Color\";\r\nimport { Shader3D } from \"../../../RenderEngine/RenderShader/Shader3D\";\r\nimport { ShaderDefine } from \"../../../RenderEngine/RenderShader/ShaderDefine\";\r\nimport { Material } from \"../../../resource/Material\";\r\n\r\n/**\r\n * <code>SkyProceduralMaterial</code> SkyProceduralMaterial\r\n */\r\nexport class SkyProceduralMaterial extends Material {\r\n\t/** _*/\r\n\tstatic SUN_NODE: number = 0;\r\n\t/** _*/\r\n\tstatic SUN_SIMPLE: number = 1;\r\n\t/** _*/\r\n\tstatic SUN_HIGH_QUALITY: number = 2;\r\n\r\n\t/**@internal */\r\n\tstatic SUNSIZE: number;\r\n\t/**@internal */\r\n\tstatic SUNSIZECONVERGENCE: number;\r\n\t/**@internal */\r\n\tstatic ATMOSPHERETHICKNESS: number;\r\n\t/**@internal */\r\n\tstatic SKYTINT: number;\r\n\t/**@internal */\r\n\tstatic GROUNDTINT: number;\r\n\t/**@internal */\r\n\tstatic EXPOSURE: number;\r\n\r\n\t/**@internal */\r\n\tstatic SHADERDEFINE_SUN_HIGH_QUALITY: ShaderDefine;\r\n\t/**@internal */\r\n\tstatic SHADERDEFINE_SUN_SIMPLE: ShaderDefine;\r\n\r\n\t/** */\r\n\tstatic defaultMaterial: SkyProceduralMaterial;\r\n\r\n\t/**\r\n\t * @internal\r\n\t */\r\n\tstatic __initDefine__(): void {\r\n\t\tSkyProceduralMaterial.SHADERDEFINE_SUN_HIGH_QUALITY = Shader3D.getDefineByName(\"SUN_HIGH_QUALITY\");\r\n\t\tSkyProceduralMaterial.SHADERDEFINE_SUN_SIMPLE = Shader3D.getDefineByName(\"SUN_SIMPLE\");\r\n\t\tSkyProceduralMaterial.SUNSIZE = Shader3D.propertyNameToID(\"u_SunSize\");\r\n\t\tSkyProceduralMaterial.SUNSIZECONVERGENCE = Shader3D.propertyNameToID(\"u_SunSizeConvergence\");\r\n\t\tSkyProceduralMaterial.ATMOSPHERETHICKNESS = Shader3D.propertyNameToID(\"u_AtmosphereThickness\");\r\n\t\tSkyProceduralMaterial.SKYTINT = Shader3D.propertyNameToID(\"u_SkyTint\");\r\n\t\tSkyProceduralMaterial.GROUNDTINT = Shader3D.propertyNameToID(\"u_GroundTint\");\r\n\t\tSkyProceduralMaterial.EXPOSURE = Shader3D.propertyNameToID(\"u_Exposure\");\r\n\t}\r\n\r\n\t/**@internal */\r\n\tprivate _sunDisk: number;\r\n\r\n\t/**\r\n\t * \r\n\t */\r\n\tget sunDisk(): number {\r\n\t\treturn this._sunDisk;\r\n\t}\r\n\r\n\tset sunDisk(value: number) {\r\n\t\tswitch (value) {\r\n\t\t\tcase SkyProceduralMaterial.SUN_HIGH_QUALITY:\r\n\t\t\t\tthis._shaderValues.removeDefine(SkyProceduralMaterial.SHADERDEFINE_SUN_SIMPLE);\r\n\t\t\t\tthis._shaderValues.addDefine(SkyProceduralMaterial.SHADERDEFINE_SUN_HIGH_QUALITY);\r\n\t\t\t\tbreak;\r\n\t\t\tcase SkyProceduralMaterial.SUN_SIMPLE:\r\n\t\t\t\tthis._shaderValues.removeDefine(SkyProceduralMaterial.SHADERDEFINE_SUN_HIGH_QUALITY);\r\n\t\t\t\tthis._shaderValues.addDefine(SkyProceduralMaterial.SHADERDEFINE_SUN_SIMPLE);\r\n\t\t\t\tbreak;\r\n\t\t\tcase SkyProceduralMaterial.SUN_NODE:\r\n\t\t\t\tthis._shaderValues.removeDefine(SkyProceduralMaterial.SHADERDEFINE_SUN_HIGH_QUALITY);\r\n\t\t\t\tthis._shaderValues.removeDefine(SkyProceduralMaterial.SHADERDEFINE_SUN_SIMPLE);\r\n\t\t\t\tbreak;\r\n\t\t\tdefault:\r\n\t\t\t\tthrow \"SkyBoxProceduralMaterial: unknown sun value.\";\r\n\t\t}\r\n\t\tthis._sunDisk = value;\r\n\t}\r\n\r\n\t/**\r\n\t * ,01\r\n\t */\r\n\tget sunSize(): number {\r\n\t\treturn this._shaderValues.getNumber(SkyProceduralMaterial.SUNSIZE);\r\n\t}\r\n\r\n\tset sunSize(value: number) {\r\n\t\tvalue = Math.min(Math.max(0.0, value), 1.0);\r\n\t\tthis._shaderValues.setNumber(SkyProceduralMaterial.SUNSIZE, value);\r\n\t}\r\n\r\n\t/**\r\n\t * ,020\r\n\t */\r\n\tget sunSizeConvergence(): number {\r\n\t\treturn this._shaderValues.getNumber(SkyProceduralMaterial.SUNSIZECONVERGENCE);\r\n\t}\r\n\r\n\tset sunSizeConvergence(value: number) {\r\n\t\tvalue = Math.min(Math.max(0.0, value), 20.0);\r\n\t\tthis._shaderValues.setNumber(SkyProceduralMaterial.SUNSIZECONVERGENCE, value);\r\n\t}\r\n\r\n\t/**\r\n\t * ,05\r\n\t */\r\n\tget atmosphereThickness(): number {\r\n\t\treturn this._shaderValues.getNumber(SkyProceduralMaterial.ATMOSPHERETHICKNESS);\r\n\t}\r\n\r\n\tset atmosphereThickness(value: number) {\r\n\t\tvalue = Math.min(Math.max(0.0, value), 5.0);\r\n\t\tthis._shaderValues.setNumber(SkyProceduralMaterial.ATMOSPHERETHICKNESS, value);\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t */\r\n\tget skyTint(): Color {\r\n\t\treturn (<Color>this._shaderValues.getColor(SkyProceduralMaterial.SKYTINT));\r\n\t}\r\n\r\n\tset skyTint(value: Color) {\r\n\t\tthis._shaderValues.setColor(SkyProceduralMaterial.SKYTINT, value);\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t */\r\n\tget groundTint(): Color {\r\n\t\treturn this._shaderValues.getColor(SkyProceduralMaterial.GROUNDTINT);\r\n\t}\r\n\r\n\tset groundTint(value: Color) {\r\n\t\tthis._shaderValues.setColor(SkyProceduralMaterial.GROUNDTINT, value);\r\n\t}\r\n\r\n\t/**\r\n\t * ,08\r\n\t */\r\n\tget exposure(): number {\r\n\t\treturn this._shaderValues.getNumber(SkyProceduralMaterial.EXPOSURE);\r\n\t}\r\n\r\n\tset exposure(value: number) {\r\n\t\tvalue = Math.min(Math.max(0.0, value), 8.0);\r\n\t\tthis._shaderValues.setNumber(SkyProceduralMaterial.EXPOSURE, value);\r\n\t}\r\n\r\n\t/**\r\n\t *  <code>SkyProceduralMaterial</code> \r\n\t */\r\n\tconstructor() {\r\n\t\tsuper();\r\n\t\tthis.setShaderName(\"SkyProcedural\");\r\n\t\tthis.sunDisk = SkyProceduralMaterial.SUN_HIGH_QUALITY;\r\n\t\tthis.sunSize = 0.04;\r\n\t\tthis.sunSizeConvergence = 5;\r\n\t\tthis.atmosphereThickness = 1.0;\r\n\t\tthis.skyTint = new Color(0.5, 0.5, 0.5, 1.0);\r\n\t\tthis.groundTint = new Color(0.369, 0.349, 0.341, 1.0);\r\n\t\tthis.exposure = 1.3;\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t * @return\t \r\n\t * @override\r\n\t */\r\n\tclone(): any {\r\n\t\tvar dest: SkyProceduralMaterial = new SkyProceduralMaterial();\r\n\t\tthis.cloneTo(dest);\r\n\t\treturn dest;\r\n\t}\r\n\r\n}\r\n\r\n\r\n","import { Color } from \"../../../maths/Color\";\r\nimport { Vector4 } from \"../../../maths/Vector4\";\r\nimport { RenderState } from \"../../../RenderEngine/RenderShader/RenderState\";\r\nimport { Shader3D } from \"../../../RenderEngine/RenderShader/Shader3D\";\r\nimport { ShaderDefine } from \"../../../RenderEngine/RenderShader/ShaderDefine\";\r\nimport { BaseTexture } from \"../../../resource/BaseTexture\";\r\nimport { Material } from \"../../../resource/Material\";\r\n\r\n/**\r\n * <code>UnlitMaterial</code> \r\n */\r\nexport class UnlitMaterial extends Material {\r\n\r\n\tstatic SHADERDEFINE_ALBEDOTEXTURE: ShaderDefine;\r\n\r\n\tstatic SHADERDEFINE_ENABLEVERTEXCOLOR: ShaderDefine;\r\n\r\n\tstatic ALBEDOTEXTURE: number;\r\n\r\n\tstatic ALBEDOCOLOR: number;\r\n\r\n\tstatic TILINGOFFSET: number;\r\n\r\n\t/**\r\n\t * @internal\r\n\t */\r\n\tstatic __initDefine__(): void {\r\n\t\tUnlitMaterial.SHADERDEFINE_ALBEDOTEXTURE = Shader3D.getDefineByName(\"ALBEDOTEXTURE\");\r\n\t\tUnlitMaterial.SHADERDEFINE_ENABLEVERTEXCOLOR = Shader3D.getDefineByName(\"ENABLEVERTEXCOLOR\");\r\n\r\n\t\tUnlitMaterial.ALBEDOTEXTURE = Shader3D.propertyNameToID(\"u_AlbedoTexture\");\r\n\t\tUnlitMaterial.ALBEDOCOLOR = Shader3D.propertyNameToID(\"u_AlbedoColor\");\r\n\t\tUnlitMaterial.TILINGOFFSET = Shader3D.propertyNameToID(\"u_TilingOffset\");\r\n\t}\r\n\r\n\tprivate _albedoIntensity: number;\r\n\r\n\t/**\r\n\t * \r\n\t */\r\n\tget albedoColor(): Color {\r\n\t\treturn this.getColorByIndex(UnlitMaterial.ALBEDOCOLOR);\r\n\t}\r\n\r\n\tset albedoColor(value: Color) {\r\n\t\tthis.setColorByIndex(UnlitMaterial.ALBEDOCOLOR, value.scale(this._albedoIntensity));\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t */\r\n\tget albedoIntensity(): number {\r\n\t\treturn this._albedoIntensity;\r\n\t}\r\n\r\n\tset albedoIntensity(value: number) {\r\n\t\tthis._albedoIntensity = value;\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t */\r\n\tget albedoTexture(): BaseTexture {\r\n\t\treturn this.getTextureByIndex(UnlitMaterial.ALBEDOTEXTURE);\r\n\t}\r\n\r\n\tset albedoTexture(value: BaseTexture) {\r\n\t\tif (value)\r\n\t\t\tthis.addDefine(UnlitMaterial.SHADERDEFINE_ALBEDOTEXTURE);\r\n\t\telse\r\n\t\t\tthis.removeDefine(UnlitMaterial.SHADERDEFINE_ALBEDOTEXTURE);\r\n\t\tthis.setTextureByIndex(UnlitMaterial.ALBEDOTEXTURE, value);\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t */\r\n\tget tilingOffset(): Vector4 {\r\n\t\treturn (<Vector4>this.getVector4ByIndex(UnlitMaterial.TILINGOFFSET));\r\n\t}\r\n\r\n\tset tilingOffset(value: Vector4) {\r\n\t\tif (value) {\r\n\t\t\tthis.setVector4ByIndex(UnlitMaterial.TILINGOFFSET, value);\r\n\t\t}\r\n\t\telse {\r\n\t\t\tthis.setVector4ByIndex(UnlitMaterial.TILINGOFFSET, new Vector4(1.0, 1.0, 0.0, 0.0));\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t */\r\n\tget enableVertexColor(): boolean {\r\n\t\treturn this.hasDefine(UnlitMaterial.SHADERDEFINE_ENABLEVERTEXCOLOR);\r\n\t}\r\n\r\n\tset enableVertexColor(value: boolean) {\r\n\t\tif (value)\r\n\t\t\tthis.addDefine(UnlitMaterial.SHADERDEFINE_ENABLEVERTEXCOLOR);\r\n\t\telse\r\n\t\t\tthis.removeDefine(UnlitMaterial.SHADERDEFINE_ENABLEVERTEXCOLOR);\r\n\t}\r\n\r\n\r\n\r\n\tconstructor() {\r\n\t\tsuper();\r\n\t\tthis.setShaderName(\"Unlit\");\r\n\t\tthis.renderMode = UnlitMaterial.RENDERMODE_OPAQUE;\r\n\t\tthis.albedoIntensity = 1.0;\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t * @return\t \r\n\t * @override\r\n\t */\r\n\tclone(): any {\r\n\t\tvar dest: UnlitMaterial = new UnlitMaterial();\r\n\t\tthis.cloneTo(dest);\r\n\t\treturn dest;\r\n\t}\r\n\r\n\r\n\r\n\t//----------------deprecated----------------\r\n\t/**\r\n\t * @deprecated\r\n\t * _\r\n\t */\r\n\tstatic RENDERMODE_OPAQUE: number = 0;\r\n\t/**\r\n\t * @deprecated\r\n\t * _\r\n\t*/\r\n\tstatic RENDERMODE_CUTOUT: number = 1;\r\n\t/**\r\n\t * @deprecated\r\n\t * __ \r\n\t */\r\n\tstatic RENDERMODE_TRANSPARENT: number = 2;\r\n\t/**\r\n\t * @deprecated\r\n\t * __ \r\n\t */\r\n\tstatic RENDERMODE_ADDTIVE: number = 3;\r\n\t/**\r\n\t * @deprecated\r\n\t * \r\n\t */\r\n\tset renderMode(value: number) {\r\n\t\tswitch (value) {\r\n\t\t\tcase UnlitMaterial.RENDERMODE_OPAQUE:\r\n\t\t\t\tthis.alphaTest = false;\r\n\t\t\t\tthis.renderQueue = Material.RENDERQUEUE_OPAQUE;\r\n\t\t\t\tthis.depthWrite = true;\r\n\t\t\t\tthis.cull = RenderState.CULL_BACK;\r\n\t\t\t\tthis.blend = RenderState.BLEND_DISABLE;\r\n\t\t\t\tthis.depthTest = RenderState.DEPTHTEST_LESS;\r\n\t\t\t\tbreak;\r\n\t\t\tcase UnlitMaterial.RENDERMODE_CUTOUT:\r\n\t\t\t\tthis.renderQueue = Material.RENDERQUEUE_ALPHATEST;\r\n\t\t\t\tthis.alphaTest = true;\r\n\t\t\t\tthis.depthWrite = true;\r\n\t\t\t\tthis.cull = RenderState.CULL_BACK;\r\n\t\t\t\tthis.blend = RenderState.BLEND_DISABLE;\r\n\t\t\t\tthis.depthTest = RenderState.DEPTHTEST_LESS;\r\n\t\t\t\tbreak;\r\n\t\t\tcase UnlitMaterial.RENDERMODE_TRANSPARENT:\r\n\t\t\t\tthis.renderQueue = Material.RENDERQUEUE_TRANSPARENT;\r\n\t\t\t\tthis.alphaTest = false;\r\n\t\t\t\tthis.depthWrite = false;\r\n\t\t\t\tthis.cull = RenderState.CULL_BACK;\r\n\t\t\t\tthis.blend = RenderState.BLEND_ENABLE_ALL;\r\n\t\t\t\tthis.blendSrc = RenderState.BLENDPARAM_SRC_ALPHA;\r\n\t\t\t\tthis.blendDst = RenderState.BLENDPARAM_ONE_MINUS_SRC_ALPHA;\r\n\t\t\t\tthis.depthTest = RenderState.DEPTHTEST_LESS;\r\n\t\t\t\tbreak;\r\n\t\t\tdefault:\r\n\t\t\t\tthrow new Error(\"UnlitMaterial : renderMode value error.\");\r\n\t\t}\r\n\t}\r\n}\r\n\r\n","import { RenderableSprite3D } from \"./RenderableSprite3D\";\r\nimport { MeshFilter } from \"./MeshFilter\";\r\nimport { MeshRenderer } from \"./MeshRenderer\";\r\nimport { Material } from \"../../resource/Material\";\r\nimport { Mesh } from \"../resource/models/Mesh\"\r\nimport { Node } from \"../../display/Node\"\r\nimport { Loader } from \"../../net/Loader\";\r\nimport { Sprite3D } from \"./Sprite3D\";\r\nimport { Vector4 } from \"../../maths/Vector4\";\r\n\r\n/**\r\n * @deprecated\r\n * <code>MeshSprite3D</code> \r\n */\r\nexport class MeshSprite3D extends RenderableSprite3D {\r\n    private _meshFilter: MeshFilter;\r\n\r\n    /**\r\n     * \r\n     */\r\n    get meshFilter(): MeshFilter {\r\n        return (<MeshFilter>this._meshFilter);\r\n    }\r\n\r\n    /**\r\n     * \r\n     */\r\n    get meshRenderer(): MeshRenderer {\r\n        return (<MeshRenderer>this._render);\r\n    }\r\n\r\n    /**\r\n     *  <code>MeshSprite3D</code> \r\n     * @param mesh ,\r\n     * @param name \r\n     */\r\n    constructor(mesh: Mesh = null, name: string = null) {\r\n        super(name);\r\n        this._meshFilter = this.addComponent(MeshFilter);\r\n        this._render = this.addComponent(MeshRenderer);\r\n        (mesh) && (this._meshFilter.sharedMesh = mesh);\r\n    }\r\n\r\n    /**\r\n     * @inheritDoc\r\n     * @override\r\n     * @internal\r\n     */\r\n    _parse(data: any, spriteMap: any): void {\r\n        super._parse(data, spriteMap);\r\n        var render: MeshRenderer = this.meshRenderer;\r\n        var lightmapIndex: any = data.lightmapIndex;\r\n        (lightmapIndex != null) && (render.lightmapIndex = lightmapIndex);\r\n        var lightmapScaleOffsetArray: any[] = data.lightmapScaleOffset;\r\n        (lightmapScaleOffsetArray) && (render.lightmapScaleOffset = new Vector4(lightmapScaleOffsetArray[0], lightmapScaleOffsetArray[1], lightmapScaleOffsetArray[2], lightmapScaleOffsetArray[3]));\r\n        (data.meshPath != undefined) && (this.meshFilter.sharedMesh = Loader.getRes(data.meshPath));\r\n        (data.enableRender != undefined) && (render._enabled = data.enableRender);\r\n        (data.receiveShadows != undefined) && (render.receiveShadow = data.receiveShadows);\r\n        (data.castShadow != undefined) && (render.castShadow = data.castShadow);\r\n        var materials: any[] = data.materials;\r\n        if (materials) {\r\n            var sharedMaterials: Material[] = render.sharedMaterials;\r\n            var materialCount: number = materials.length;\r\n            sharedMaterials.length = materialCount;\r\n            for (var i: number = 0; i < materialCount; i++) {\r\n                sharedMaterials[i] = Loader.getRes(materials[i].path);\r\n            }\r\n\r\n            render.sharedMaterials = sharedMaterials;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * @inheritDoc\r\n     * @override\r\n     * @internal\r\n     */\r\n    _cloneTo(destObject: any, rootSprite: Node, dstSprite: Node): void {\r\n        super._cloneTo(destObject, rootSprite, dstSprite);//,\r\n    }\r\n\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    protected _create(): Node {\r\n        return new Sprite3D();\r\n    }\r\n\r\n}\r\n\r\n","/**\r\n\t * ...\r\n\t * @author ...\r\n\t */\r\nexport class GradientMode {\r\n\t/**\r\n\t * ,,\r\n\t */\r\n\tstatic Blend: number = 0;\r\n\r\n\t/**\r\n\t * \r\n\t */\r\n\tstatic Fixed: number = 1;\r\n}\r\n\r\n","import { GradientMode } from \"./GradientMode\";\r\nimport { IClone } from \"../../utils/IClone\";\r\nimport { Color } from \"../../maths/Color\";\r\nimport { Vector4 } from \"../../maths/Vector4\";\r\n\r\n\r\n/**\r\n * <code>Gradient</code> \r\n */\r\nexport class Gradient implements IClone {\r\n\tprivate _mode: number = 0;\r\n\tprivate _maxColorRGBKeysCount: number = 0;\r\n\tprivate _maxColorAlphaKeysCount: number = 0;\r\n\tprivate _colorRGBKeysCount: number = 0;\r\n\tprivate _colorAlphaKeysCount: number = 0;\r\n\r\n\t/**\r\n\t * @internal \r\n\t * element key range\r\n\t * x: colorkey min\r\n\t * y: colorkey max\r\n\t * z: alphakey min\r\n\t * w: alphakey max\r\n\t*/\r\n\t_keyRanges: Vector4 = new Vector4(1, 0, 1, 0);\r\n\r\n\t/**@internal */\r\n\t_alphaElements: Float32Array = null;\r\n\t/**@internal */\r\n\t_rgbElements: Float32Array = null;\r\n\r\n\t/**@internal */\r\n\t__alphaElements: Float32Array = null;\r\n\t/**@internal */\r\n\t__rgbElements: Float32Array = null;\r\n\r\n\t/**\r\n\t * \r\n\t * @return  \r\n\t */\r\n\tget rgbElements(): Float32Array {\r\n\t\tif (this._colorRGBKeysCount < 2) {\r\n\t\t\tif (this.__rgbElements == null) {\r\n\t\t\t\tthis.__rgbElements = new Float32Array(8);\r\n\t\t\t}\r\n\t\t\tlet rgbElements = this.__rgbElements;\r\n\t\t\trgbElements[1] = rgbElements[5] = this._rgbElements[1];\r\n\t\t\trgbElements[2] = rgbElements[6] = this._rgbElements[2];\r\n\t\t\trgbElements[3] = rgbElements[7] = this._rgbElements[3];\r\n\t\t\trgbElements[0] = 0;\r\n\t\t\trgbElements[4] = 1;\r\n\t\t\treturn rgbElements;\r\n\t\t} else {\r\n\t\t\treturn this._rgbElements;\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t *  alpha\r\n\t * @return  alpha\r\n\t */\r\n\tget alphaElements(): Float32Array {\r\n\t\tif (this._colorAlphaKeysCount < 2) {\r\n\t\t\tif (this.__alphaElements == null) {\r\n\t\t\t\tthis.__alphaElements = new Float32Array(4);\r\n\t\t\t}\r\n\t\t\tlet alphaElements = this.__alphaElements;\r\n\t\t\talphaElements[1] = alphaElements[3] = this._alphaElements[1];\r\n\t\t\talphaElements[0] = 0;\r\n\t\t\talphaElements[2] = 1;\r\n\t\t\treturn alphaElements;\r\n\t\t} else {\r\n\t\t\treturn this._alphaElements;\r\n\t\t}\r\n\t}\r\n\r\n\r\n\t/**\r\n\t * \r\n\t * @return  \r\n\t */\r\n\tget mode(): number {\r\n\t\treturn this._mode;\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t * @param value \r\n\t */\r\n\tset mode(value: number) {\r\n\t\tthis._mode = value;\r\n\t}\r\n\r\n\t/**\r\n\t * RGB\r\n\t * @return RGB\r\n\t */\r\n\tget colorRGBKeysCount(): number {\r\n\t\treturn this._colorRGBKeysCount;\r\n\t}\r\n\r\n\t/**\r\n\t * Alpha\r\n\t * @return Alpha\r\n\t */\r\n\tget colorAlphaKeysCount(): number {\r\n\t\treturn this._colorAlphaKeysCount;\r\n\t}\r\n\r\n\t/**\r\n\t * RGB\r\n\t * @return RGB\r\n\t */\r\n\tget maxColorRGBKeysCount(): number {\r\n\t\treturn this._maxColorRGBKeysCount;\r\n\t}\r\n\r\n\t/**\r\n\t * Alpha\r\n\t * @return Alpha\r\n\t */\r\n\tget maxColorAlphaKeysCount(): number {\r\n\t\treturn this._maxColorAlphaKeysCount;\r\n\t}\r\n\r\n\t/**\r\n\t *  <code>Gradient</code> \r\n\t * @param maxColorRGBKeyCount RGB\r\n\t * @param maxColorAlphaKeyCount Alpha\r\n\t */\r\n\tconstructor(maxColorRGBKeyCount: number, maxColorAlphaKeyCount: number) {\r\n\t\tthis._maxColorRGBKeysCount = maxColorRGBKeyCount;\r\n\t\tthis._maxColorAlphaKeysCount = maxColorAlphaKeyCount;\r\n\t\tthis._rgbElements = new Float32Array(maxColorRGBKeyCount * 4);\r\n\t\tthis._alphaElements = new Float32Array(maxColorAlphaKeyCount * 2);\r\n\t}\r\n\r\n\t/**\r\n\t * RGB\r\n\t * @param\tkey 01\r\n\t * @param\tvalue RGB\r\n\t */\r\n\taddColorRGB(key: number, value: Color): void {\r\n\t\tif (this._colorRGBKeysCount < this._maxColorRGBKeysCount) {\r\n\t\t\tvar offset: number = this._colorRGBKeysCount * 4;\r\n\t\t\tthis._rgbElements[offset] = key;\r\n\t\t\tthis._rgbElements[offset + 1] = value.r;\r\n\t\t\tthis._rgbElements[offset + 2] = value.g;\r\n\t\t\tthis._rgbElements[offset + 3] = value.b;\r\n\t\t\tthis._colorRGBKeysCount++;\r\n\t\t} else {\r\n\t\t\tconsole.warn(\"Gradient:warning:data count must lessEqual than \" + this._maxColorRGBKeysCount);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Alpha\r\n\t * @param\tkey 01\r\n\t * @param\tvalue Alpha\r\n\t */\r\n\taddColorAlpha(key: number, value: number): void {\r\n\t\tif (this._colorAlphaKeysCount < this._maxColorAlphaKeysCount) {\r\n\t\t\tvar offset: number = this._colorAlphaKeysCount * 2;\r\n\t\t\tthis._alphaElements[offset] = key;\r\n\t\t\tthis._alphaElements[offset + 1] = value;\r\n\t\t\tthis._colorAlphaKeysCount++;\r\n\t\t} else {\r\n\t\t\tconsole.warn(\"Gradient:warning:data count must lessEqual than \" + this._maxColorAlphaKeysCount);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * RGB\r\n\t * @param   index \r\n\t * @param\tkey 01\r\n\t * @param\tvalue RGB\r\n\t */\r\n\tupdateColorRGB(index: number, key: number, value: Color): void {//TODO:key\r\n\t\tif (index < this._colorRGBKeysCount) {\r\n\t\t\tvar offset: number = index * 4;\r\n\t\t\tthis._rgbElements[offset] = key;\r\n\t\t\tthis._rgbElements[offset + 1] = value.r;\r\n\t\t\tthis._rgbElements[offset + 2] = value.g;\r\n\t\t\tthis._rgbElements[offset + 3] = value.b;\r\n\t\t} else {\r\n\t\t\tconsole.warn(\"Gradient:warning:index must lessEqual than colorRGBKeysCount:\" + this._colorRGBKeysCount);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Alpha\r\n\t * @param   index \r\n\t * @param\tkey 01\r\n\t * @param\tvalue Alpha\r\n\t */\r\n\tupdateColorAlpha(index: number, key: number, value: number): void {\r\n\t\tif (index < this._colorAlphaKeysCount) {\r\n\t\t\tvar offset: number = index * 2;\r\n\t\t\tthis._alphaElements[offset] = key;\r\n\t\t\tthis._alphaElements[offset + 1] = value;\r\n\t\t} else {\r\n\t\t\tconsole.warn(\"Gradient:warning:index must lessEqual than colorAlphaKeysCount:\" + this._colorAlphaKeysCount);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * RGB\r\n\t * @param  lerpFactor \r\n\t * @param  out \r\n\t * @param  \r\n\t * @return \r\n\t */\r\n\tevaluateColorRGB(lerpFactor: number, out: Color, startSearchIndex: number = 0, reverseSearch: boolean = false): number {\r\n\t\tlerpFactor = Math.min(Math.max(lerpFactor, 0.0), 1.0);\r\n\r\n\t\tvar rgbElements: Float32Array = this._rgbElements;\r\n\t\tvar curIndex: number = startSearchIndex;\r\n\r\n\t\tif (reverseSearch) {\r\n\t\t\tfor (var i: number = curIndex; i >= 0; i--) {\r\n\t\t\t\tvar offset: number = i * 4;\r\n\t\t\t\tvar left: number = rgbElements[offset];\r\n\t\t\t\tif (lerpFactor === left) {\r\n\t\t\t\t\tout.r = rgbElements[offset + 1];\r\n\t\t\t\t\tout.g = rgbElements[offset + 2];\r\n\t\t\t\t\tout.b = rgbElements[offset + 3];\r\n\t\t\t\t\treturn curIndex;\r\n\t\t\t\t}\r\n\t\t\t\tvar right: number = rgbElements[offset + 4];\r\n\t\t\t\tswitch (this._mode) {\r\n\t\t\t\t\tcase GradientMode.Blend:\r\n\t\t\t\t\t\tif (lerpFactor > left && right) {\r\n\t\t\t\t\t\t\tif (lerpFactor > right)\r\n\t\t\t\t\t\t\t\tcontinue;\r\n\t\t\t\t\t\t\tvar diff: number = right - left;\r\n\t\t\t\t\t\t\tvar y1: number = right - lerpFactor;\r\n\t\t\t\t\t\t\tvar y2: number = lerpFactor - left;\r\n\t\t\t\t\t\t\tout.r = (y1 * rgbElements[offset + 1] + y2 * rgbElements[offset + 5]) / diff;\r\n\t\t\t\t\t\t\tout.g = (y1 * rgbElements[offset + 2] + y2 * rgbElements[offset + 6]) / diff;\r\n\t\t\t\t\t\t\tout.b = (y1 * rgbElements[offset + 3] + y2 * rgbElements[offset + 7]) / diff;\r\n\t\t\t\t\t\t\treturn curIndex;\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tcurIndex--;\r\n\t\t\t\t\t\t\tcontinue;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\tcase GradientMode.Fixed:\r\n\t\t\t\t\t\tif (lerpFactor > left) {\r\n\t\t\t\t\t\t\tif (lerpFactor > rgbElements[offset + 4])\r\n\t\t\t\t\t\t\t\tthrow \"Gradient:wrong startSearchIndex.\";\r\n\t\t\t\t\t\t\tout.r = rgbElements[offset + 5];\r\n\t\t\t\t\t\t\tout.g = rgbElements[offset + 6];\r\n\t\t\t\t\t\t\tout.b = rgbElements[offset + 7];\r\n\t\t\t\t\t\t\treturn curIndex;\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tcurIndex--;\r\n\t\t\t\t\t\t\tcontinue;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\tdefault:\r\n\t\t\t\t\t\tthrow \"Gradient:unknown mode.\";\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tfor (var i: number = 0, n: number = this._rgbElements.length; i < n; i++) {\r\n\t\t\t\toffset = i * 4;\r\n\t\t\t\tvar right: number = rgbElements[offset];\r\n\t\t\t\tif (lerpFactor === right) {\r\n\t\t\t\t\tout.r = rgbElements[offset + 1];\r\n\t\t\t\t\tout.g = rgbElements[offset + 2];\r\n\t\t\t\t\tout.b = rgbElements[offset + 3];\r\n\t\t\t\t\treturn curIndex;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tswitch (this._mode) {\r\n\t\t\t\t\tcase GradientMode.Blend:\r\n\t\t\t\t\t\tif (lerpFactor < right) {\r\n\t\t\t\t\t\t\tvar left: number = rgbElements[offset - 4];\r\n\t\t\t\t\t\t\tif (lerpFactor < left)\r\n\t\t\t\t\t\t\t\tthrow \"Gradient:wrong startSearchIndex.\";\r\n\t\t\t\t\t\t\tvar diff: number = right - left;\r\n\t\t\t\t\t\t\tvar y1: number = right - lerpFactor;\r\n\t\t\t\t\t\t\tvar y2: number = lerpFactor - left;\r\n\t\t\t\t\t\t\tout.r = (y1 * rgbElements[offset - 3] + y2 * rgbElements[offset + 1]) / diff;\r\n\t\t\t\t\t\t\tout.g = (y1 * rgbElements[offset - 2] + y2 * rgbElements[offset + 2]) / diff;\r\n\t\t\t\t\t\t\tout.b = (y1 * rgbElements[offset - 1] + y2 * rgbElements[offset + 3]) / diff;\r\n\t\t\t\t\t\t\treturn curIndex;\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tcurIndex++;\r\n\t\t\t\t\t\t\tcontinue;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\tcase GradientMode.Fixed:\r\n\t\t\t\t\t\tif (lerpFactor < right) {\r\n\t\t\t\t\t\t\tif (lerpFactor < rgbElements[offset - 4])\r\n\t\t\t\t\t\t\t\tthrow \"Gradient:wrong startSearchIndex.\";\r\n\t\t\t\t\t\t\tout.r = rgbElements[offset + 1];\r\n\t\t\t\t\t\t\tout.g = rgbElements[offset + 2];\r\n\t\t\t\t\t\t\tout.b = rgbElements[offset + 3];\r\n\t\t\t\t\t\t\treturn curIndex;\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tcurIndex++;\r\n\t\t\t\t\t\t\tcontinue;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\tdefault:\r\n\t\t\t\t\t\tthrow \"Gradient:unknown mode.\";\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn curIndex;\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t * @param  lerpFactor \r\n\t * @param  out \r\n\t * @param  \r\n\t * @return  \r\n\t */\r\n\tevaluateColorAlpha(lerpFactor: number, outColor: Color, startSearchIndex: number = 0, reverseSearch: boolean = false): number {\r\n\t\tlerpFactor = Math.min(Math.max(lerpFactor, 0.0), 1.0);\r\n\t\tvar alphaElements: Float32Array = this._alphaElements;\r\n\t\tvar curIndex: number = startSearchIndex;\r\n\r\n\t\tif (reverseSearch) {\r\n\t\t\tfor (var i: number = curIndex; i >= 0; i--) {\r\n\t\t\t\tvar offset: number = i * 2;\r\n\t\t\t\tvar left: number = alphaElements[offset];\r\n\t\t\t\tif (lerpFactor === left) {\r\n\t\t\t\t\toutColor.a = alphaElements[offset + 1];\r\n\t\t\t\t\treturn curIndex;\r\n\t\t\t\t}\r\n\t\t\t\tvar right: number = alphaElements[offset + 2];\r\n\t\t\t\tswitch (this._mode) {\r\n\t\t\t\t\tcase GradientMode.Blend:\r\n\t\t\t\t\t\tif (lerpFactor > left && right) {\r\n\t\t\t\t\t\t\tif (lerpFactor > right)\r\n\t\t\t\t\t\t\t\tcontinue;\r\n\t\t\t\t\t\t\tvar diff: number = right - left;\r\n\t\t\t\t\t\t\tvar x1: number = right - lerpFactor;\r\n\t\t\t\t\t\t\tvar x2: number = lerpFactor - left;\r\n\t\t\t\t\t\t\toutColor.a = (x1 * alphaElements[offset + 1] + x2 * alphaElements[offset + 3]) / diff;\r\n\t\t\t\t\t\t\treturn curIndex;\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tcurIndex--;\r\n\t\t\t\t\t\t\tcontinue;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\tcase GradientMode.Fixed:\r\n\t\t\t\t\t\tif (lerpFactor > left) {\r\n\t\t\t\t\t\t\tif (lerpFactor > alphaElements[offset + 2])\r\n\t\t\t\t\t\t\t\tthrow \"Gradient:wrong startSearchIndex.\";\r\n\t\t\t\t\t\t\toutColor.a = alphaElements[offset + 3];\r\n\t\t\t\t\t\t\treturn curIndex;\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tcurIndex--;\r\n\t\t\t\t\t\t\tcontinue;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\tdefault:\r\n\t\t\t\t\t\tthrow \"Gradient:unknown mode.\";\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tfor (var i: number = curIndex, n: number = this._alphaElements.length; i < n; i++) {\r\n\t\t\t\tvar offset: number = i * 2;\r\n\t\t\t\tvar right: number = alphaElements[offset];\r\n\t\t\t\tif (lerpFactor === right) {\r\n\t\t\t\t\toutColor.a = alphaElements[offset + 1];\r\n\t\t\t\t\treturn curIndex;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tswitch (this._mode) {\r\n\t\t\t\t\tcase GradientMode.Blend:\r\n\t\t\t\t\t\tif (lerpFactor < right) {\r\n\t\t\t\t\t\t\tvar left: number = alphaElements[offset - 2];\r\n\t\t\t\t\t\t\tif (lerpFactor < left)\r\n\t\t\t\t\t\t\t\tthrow \"Gradient:wrong startSearchIndex.\";\r\n\t\t\t\t\t\t\tvar diff: number = right - left;\r\n\t\t\t\t\t\t\tvar x1: number = right - lerpFactor;\r\n\t\t\t\t\t\t\tvar x2: number = lerpFactor - left;\r\n\t\t\t\t\t\t\toutColor.a = (x1 * alphaElements[offset - 1] + x2 * alphaElements[offset + 1]) / diff;\r\n\t\t\t\t\t\t\treturn curIndex;\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tcurIndex++;\r\n\t\t\t\t\t\t\tcontinue;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\tcase GradientMode.Fixed:\r\n\t\t\t\t\t\tif (lerpFactor < right) {\r\n\t\t\t\t\t\t\tif (lerpFactor < alphaElements[offset - 2])\r\n\t\t\t\t\t\t\t\tthrow \"Gradient:wrong startSearchIndex.\";\r\n\t\t\t\t\t\t\toutColor.a = alphaElements[offset + 1];\r\n\t\t\t\t\t\t\treturn curIndex;\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tcurIndex++;\r\n\t\t\t\t\t\t\tcontinue;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\tdefault:\r\n\t\t\t\t\t\tthrow \"Gradient:unknown mode.\";\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn curIndex;\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t * @param\tdestObject \r\n\t */\r\n\tcloneTo(destObject: any): void {\r\n\t\tvar destGradientDataColor: Gradient = (<Gradient>destObject);\r\n\t\tvar i: number, n: number;\r\n\t\tdestGradientDataColor._colorAlphaKeysCount = this._colorAlphaKeysCount;\r\n\t\tlet destAlphaElements = destGradientDataColor._alphaElements = new Float32Array(this._alphaElements.length);\r\n\r\n\t\tfor (i = 0, n = this._alphaElements.length; i < n; i++)\r\n\t\t\tdestAlphaElements[i] = this._alphaElements[i];\r\n\r\n\t\tdestGradientDataColor._colorRGBKeysCount = this._colorRGBKeysCount;\r\n\t\tvar destRGBElements: Float32Array = destGradientDataColor._rgbElements = new Float32Array(this._rgbElements.length);\r\n\t\tfor (i = 0, n = this._rgbElements.length; i < n; i++)\r\n\t\t\tdestRGBElements[i] = this._rgbElements[i];\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t * @return\t \r\n\t */\r\n\tclone(): any {\r\n\t\tvar destGradientDataColor: Gradient = new Gradient(this._maxColorRGBKeysCount, this._maxColorAlphaKeysCount);\r\n\t\tthis.cloneTo(destGradientDataColor);\r\n\t\treturn destGradientDataColor;\r\n\t}\r\n\r\n}\r\n\r\n\r\n","import { IClone } from \"../../../../utils/IClone\"\r\n\r\n/**\r\n * <code>Burst</code> \r\n */\r\nexport class Burst implements IClone {\r\n\t/** ,*/\r\n\tprivate _time: number;\r\n\t/** */\r\n\tprivate _minCount: number;\r\n\t/** */\r\n\tprivate _maxCount: number;\r\n\r\n\t/**\r\n\t * ,\r\n\t * @return ,\r\n\t */\r\n\tget time(): number {\r\n\t\treturn this._time;\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t * @return \r\n\t */\r\n\tget minCount(): number {\r\n\t\treturn this._minCount;\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t * @return \r\n\t */\r\n\tget maxCount(): number {\r\n\t\treturn this._maxCount;\r\n\t}\r\n\r\n\t/**\r\n\t *  <code>Burst</code> \r\n\t * @param time ,\r\n\t * @param minCount \r\n\t * @param time \r\n\t */\r\n\tconstructor(time: number = 0, minCount: number = 0, maxCount: number = 0) {\r\n\t\tthis._time = time;\r\n\t\tthis._minCount = minCount;\r\n\t\tthis._maxCount = maxCount;\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t * @param\tdestObject \r\n\t */\r\n\tcloneTo(destObject: any): void {\r\n\t\tvar destBurst: Burst = (<Burst>destObject);\r\n\t\tdestBurst._time = this._time;\r\n\t\tdestBurst._minCount = this._minCount;\r\n\t\tdestBurst._maxCount = this._maxCount;\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t * @return\t \r\n\t */\r\n\tclone(): any {\r\n\t\tvar destBurst: Burst = new Burst(this._time, this._minCount, this._maxCount);\r\n\t\tthis.cloneTo(destBurst);\r\n\t\treturn destBurst;\r\n\t}\r\n}\r\n\r\n","import { Gradient } from \"../../Gradient\"\r\nimport { IClone } from \"../../../../utils/IClone\"\r\nimport { Vector4 } from \"../../../../maths/Vector4\";\r\n\r\n/**\r\n * <code>GradientColor</code> \r\n */\r\nexport class GradientColor implements IClone {\r\n\t/**\r\n\t *  <code>GradientColor</code> \r\n\t * @param constant \r\n\t */\r\n\tstatic createByConstant(constant: Vector4): GradientColor {\r\n\t\tvar gradientColor: GradientColor = new GradientColor();\r\n\t\tgradientColor._type = 0;\r\n\t\tgradientColor._constant = constant;\r\n\t\treturn gradientColor;\r\n\t}\r\n\r\n\t/**\r\n\t *  <code>GradientColor</code> \r\n\t * @param gradient \r\n\t */\r\n\tstatic createByGradient(gradient: Gradient): GradientColor {\r\n\t\tvar gradientColor: GradientColor = new GradientColor();\r\n\t\tgradientColor._type = 1;\r\n\t\tgradientColor._gradient = gradient;\r\n\t\treturn gradientColor;\r\n\t}\r\n\r\n\t/**\r\n\t *  <code>GradientColor</code> \r\n\t * @param minConstant \r\n\t * @param maxConstant \r\n\t */\r\n\tstatic createByRandomTwoConstant(minConstant: Vector4, maxConstant: Vector4): GradientColor {\r\n\t\tvar gradientColor: GradientColor = new GradientColor();\r\n\t\tgradientColor._type = 2;\r\n\t\tgradientColor._constantMin = minConstant;\r\n\t\tgradientColor._constantMax = maxConstant;\r\n\t\treturn gradientColor;\r\n\t}\r\n\r\n\t/**\r\n\t *  <code>GradientColor</code> \r\n\t * @param minGradient \r\n\t * @param maxGradient \r\n\t */\r\n\tstatic createByRandomTwoGradient(minGradient: Gradient, maxGradient: Gradient): GradientColor {\r\n\t\tvar gradientColor: GradientColor = new GradientColor();\r\n\t\tgradientColor._type = 3;\r\n\t\tgradientColor._gradientMin = minGradient;\r\n\t\tgradientColor._gradientMax = maxGradient;\r\n\t\treturn gradientColor;\r\n\t}\r\n\r\n\tprivate _type: number = 0;\r\n\r\n\tprivate _constant: Vector4 = null;\r\n\tprivate _constantMin: Vector4 = null;\r\n\tprivate _constantMax: Vector4 = null;\r\n\tprivate _gradient: Gradient = null;\r\n\tprivate _gradientMin: Gradient = null;\r\n\tprivate _gradientMax: Gradient = null;\r\n\r\n\t/**\r\n\t *,0,1,2,3\r\n\t */\r\n\tget type(): number {\r\n\t\treturn this._type;\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t */\r\n\tget constant(): Vector4 {\r\n\t\treturn this._constant;\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t */\r\n\tget constantMin(): Vector4 {\r\n\t\treturn this._constantMin;\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t */\r\n\tget constantMax(): Vector4 {\r\n\t\treturn this._constantMax;\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t */\r\n\tget gradient(): Gradient {\r\n\t\treturn this._gradient;\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t */\r\n\tget gradientMin(): Gradient {\r\n\t\treturn this._gradientMin;\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t */\r\n\tget gradientMax(): Gradient {\r\n\t\treturn this._gradientMax;\r\n\t}\r\n\r\n\t/**\r\n\t *  <code>GradientColor,new</code> \r\n\t */\r\n\tconstructor() {\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t * @param\tdestObject \r\n\t */\r\n\tcloneTo(destObject: any): void {\r\n\t\tvar destGradientColor: GradientColor = (<GradientColor>destObject);\r\n\t\tdestGradientColor._type = this._type;\r\n\t\tthis._constant.cloneTo(destGradientColor._constant);\r\n\t\tthis._constantMin.cloneTo(destGradientColor._constantMin);\r\n\t\tthis._constantMax.cloneTo(destGradientColor._constantMax);\r\n\t\tthis._gradient.cloneTo(destGradientColor._gradient);\r\n\t\tthis._gradientMin.cloneTo(destGradientColor._gradientMin);\r\n\t\tthis._gradientMax.cloneTo(destGradientColor._gradientMax);\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t * @return\t \r\n\t */\r\n\tclone(): any {\r\n\t\tvar destGradientColor: GradientColor = new GradientColor();\r\n\t\tthis.cloneTo(destGradientColor);\r\n\t\treturn destGradientColor;\r\n\t}\r\n\r\n}\r\n\r\n\r\n","import { GradientColor } from \"./GradientColor\";\r\n/**\r\n * <code>ColorOverLifetime</code> \r\n */\r\nexport class ColorOverLifetime {\r\n\tprivate _color: GradientColor;\r\n\r\n\t/***/\r\n\tenable: boolean;\r\n\r\n\t/**\r\n\t *\r\n\t */\r\n\tget color(): GradientColor {\r\n\t\treturn this._color;\r\n\t}\r\n\r\n\t/**\r\n\t *  <code>ColorOverLifetime</code> \r\n\t */\r\n\tconstructor(color: GradientColor) {\r\n\t\tthis._color = color;\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t * @param\tdestObject \r\n\t */\r\n\tcloneTo(destObject: any): void {\r\n\t\tvar destColorOverLifetime: ColorOverLifetime = (<ColorOverLifetime>destObject);\r\n\t\tthis._color.cloneTo(destColorOverLifetime._color);\r\n\t\tdestColorOverLifetime.enable = this.enable;\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t * @return\t \r\n\t */\r\n\tclone(): any {\r\n\t\tvar destColor: GradientColor;\r\n\t\tswitch (this._color.type) {\r\n\t\t\tcase 0:\r\n\t\t\t\tdestColor = GradientColor.createByConstant(this._color.constant.clone());\r\n\t\t\t\tbreak;\r\n\t\t\tcase 1:\r\n\t\t\t\tdestColor = GradientColor.createByGradient(this._color.gradient.clone());\r\n\t\t\t\tbreak;\r\n\t\t\tcase 2:\r\n\t\t\t\tdestColor = GradientColor.createByRandomTwoConstant(this._color.constantMin.clone(), this._color.constantMax.clone());\r\n\t\t\t\tbreak;\r\n\t\t\tcase 3:\r\n\t\t\t\tdestColor = GradientColor.createByRandomTwoGradient(this._color.gradientMin.clone(), this._color.gradientMax.clone());\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\r\n\t\tvar destColorOverLifetime: ColorOverLifetime = new ColorOverLifetime(destColor);\r\n\t\tdestColorOverLifetime.enable = this.enable;\r\n\t\treturn destColorOverLifetime;\r\n\t}\r\n\r\n}\r\n\r\n\r\n","import { GradientDataInt } from \"./GradientDataInt\";\r\nimport { IClone } from \"../../../../utils/IClone\"\r\n\r\n\r\n/**\r\n * <code>FrameOverTime</code> \r\n */\r\nexport class FrameOverTime implements IClone {\r\n\t/**\r\n\t *  <code>FrameOverTime</code> \r\n\t * @param\tconstant \r\n\t * @return \r\n\t */\r\n\tstatic createByConstant(constant: number = 0): FrameOverTime {\r\n\t\tvar rotationOverLifetime: FrameOverTime = new FrameOverTime();\r\n\t\trotationOverLifetime._type = 0;\r\n\t\trotationOverLifetime._constant = constant;\r\n\t\treturn rotationOverLifetime;\r\n\t}\r\n\r\n\t/**\r\n\t *  <code>FrameOverTime</code> \r\n\t * @param\toverTime \r\n\t * @return \r\n\t */\r\n\tstatic createByOverTime(overTime: GradientDataInt): FrameOverTime {\r\n\t\tvar rotationOverLifetime: FrameOverTime = new FrameOverTime();\r\n\t\trotationOverLifetime._type = 1;\r\n\t\trotationOverLifetime._overTime = overTime;\r\n\t\treturn rotationOverLifetime;\r\n\t}\r\n\r\n\t/**\r\n\t *  <code>FrameOverTime</code> \r\n\t * @param\tconstantMin \r\n\t * @param\tconstantMax \r\n\t * @return \r\n\t */\r\n\tstatic createByRandomTwoConstant(constantMin: number = 0, constantMax: number = 0): FrameOverTime {\r\n\t\tvar rotationOverLifetime: FrameOverTime = new FrameOverTime();\r\n\t\trotationOverLifetime._type = 2;\r\n\t\trotationOverLifetime._constantMin = constantMin;\r\n\t\trotationOverLifetime._constantMax = constantMax;\r\n\t\treturn rotationOverLifetime;\r\n\t}\r\n\r\n\t/**\r\n\t *  <code>FrameOverTime</code> \r\n\t * @param\tgradientFrameMin \r\n\t * @param\tgradientFrameMax \r\n\t * @return \r\n\t */\r\n\tstatic createByRandomTwoOverTime(gradientFrameMin: GradientDataInt, gradientFrameMax: GradientDataInt): FrameOverTime {\r\n\t\tvar rotationOverLifetime: FrameOverTime = new FrameOverTime();\r\n\t\trotationOverLifetime._type = 3;\r\n\t\trotationOverLifetime._overTimeMin = gradientFrameMin;\r\n\t\trotationOverLifetime._overTimeMax = gradientFrameMax;\r\n\t\treturn rotationOverLifetime;\r\n\t}\r\n\r\n\tprivate _type: number = 0;\r\n\r\n\tprivate _constant: number = 0;\r\n\r\n\tprivate _overTime: GradientDataInt = null;\r\n\r\n\tprivate _constantMin: number = 0;\r\n\tprivate _constantMax: number = 0;\r\n\r\n\tprivate _overTimeMin: GradientDataInt = null;\r\n\tprivate _overTimeMax: GradientDataInt = null;\r\n\r\n\t/**\r\n\t *,0123\r\n\t */\r\n\tget type(): number {\r\n\t\treturn this._type;\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t */\r\n\tget constant(): number {\r\n\t\treturn this._constant;\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t */\r\n\tget frameOverTimeData(): GradientDataInt {\r\n\t\treturn this._overTime;\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t */\r\n\tget constantMin(): number {\r\n\t\treturn this._constantMin;\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t */\r\n\tget constantMax(): number {\r\n\t\treturn this._constantMax;\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t */\r\n\tget frameOverTimeDataMin(): GradientDataInt {\r\n\t\treturn this._overTimeMin;\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t */\r\n\tget frameOverTimeDataMax(): GradientDataInt {\r\n\t\treturn this._overTimeMax;\r\n\t}\r\n\r\n\t/**\r\n\t *  <code>FrameOverTime,new</code> \r\n\t */\r\n\tconstructor() {\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t * @param\tdestObject \r\n\t */\r\n\tcloneTo(destObject: any): void {\r\n\t\tvar destFrameOverTime: FrameOverTime = (<FrameOverTime>destObject);\r\n\t\tdestFrameOverTime._type = this._type;\r\n\t\tdestFrameOverTime._constant = this._constant;\r\n\t\t(this._overTime) && (this._overTime.cloneTo(destFrameOverTime._overTime));\r\n\t\tdestFrameOverTime._constantMin = this._constantMin;\r\n\t\tdestFrameOverTime._constantMax = this._constantMax;\r\n\t\t(this._overTimeMin) && (this._overTimeMin.cloneTo(destFrameOverTime._overTimeMin));\r\n\t\t(this._overTimeMax) && (this._overTimeMax.cloneTo(destFrameOverTime._overTimeMax));\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t * @return\t \r\n\t */\r\n\tclone(): any {\r\n\t\tvar destFrameOverTime: FrameOverTime = new FrameOverTime();\r\n\t\tthis.cloneTo(destFrameOverTime);\r\n\t\treturn destFrameOverTime;\r\n\t}\r\n\r\n}\r\n\r\n\r\n","import { GradientDataNumber } from \"./GradientDataNumber\";\r\nimport { IClone } from \"../../../../utils/IClone\"\r\nimport { Vector3 } from \"../../../../maths/Vector3\";\r\n\r\n\r\n/**\r\n * <code>GradientRotation</code> \r\n */\r\nexport class GradientAngularVelocity implements IClone {\r\n\t/**\r\n\t *  <code>GradientAngularVelocity</code> \r\n\t * @param\tconstant \r\n\t * @return \r\n\t */\r\n\tstatic createByConstant(constant: number): GradientAngularVelocity {\r\n\t\tvar gradientAngularVelocity: GradientAngularVelocity = new GradientAngularVelocity();\r\n\t\tgradientAngularVelocity._type = 0;\r\n\t\tgradientAngularVelocity._separateAxes = false;\r\n\t\tgradientAngularVelocity._constant = constant;\r\n\t\treturn gradientAngularVelocity;\r\n\t}\r\n\r\n\t/**\r\n\t *  <code>GradientAngularVelocity</code> \r\n\t * @param\tseparateConstant \r\n\t * @return \r\n\t */\r\n\tstatic createByConstantSeparate(separateConstant: Vector3): GradientAngularVelocity {\r\n\t\tvar gradientAngularVelocity: GradientAngularVelocity = new GradientAngularVelocity();\r\n\t\tgradientAngularVelocity._type = 0;\r\n\t\tgradientAngularVelocity._separateAxes = true;\r\n\t\tgradientAngularVelocity._constantSeparate = separateConstant;\r\n\t\treturn gradientAngularVelocity;\r\n\t}\r\n\r\n\t/**\r\n\t *  <code>GradientAngularVelocity</code> \r\n\t * @param\tgradient \r\n\t * @return \r\n\t */\r\n\tstatic createByGradient(gradient: GradientDataNumber): GradientAngularVelocity {\r\n\t\tvar gradientAngularVelocity: GradientAngularVelocity = new GradientAngularVelocity();\r\n\t\tgradientAngularVelocity._type = 1;\r\n\t\tgradientAngularVelocity._separateAxes = false;\r\n\t\tgradientAngularVelocity._gradient = gradient;\r\n\t\treturn gradientAngularVelocity;\r\n\t}\r\n\r\n\t/**\r\n\t *  <code>GradientAngularVelocity</code> \r\n\t * @param\tgradientX X\r\n\t * @param\tgradientY Y\r\n\t * @param\tgradientZ Z\r\n\t * @return  \r\n\t */\r\n\tstatic createByGradientSeparate(gradientX: GradientDataNumber, gradientY: GradientDataNumber, gradientZ: GradientDataNumber): GradientAngularVelocity {\r\n\t\tvar gradientAngularVelocity: GradientAngularVelocity = new GradientAngularVelocity();\r\n\t\tgradientAngularVelocity._type = 1;\r\n\t\tgradientAngularVelocity._separateAxes = true;\r\n\t\tgradientAngularVelocity._gradientX = gradientX;\r\n\t\tgradientAngularVelocity._gradientY = gradientY;\r\n\t\tgradientAngularVelocity._gradientZ = gradientZ;\r\n\t\treturn gradientAngularVelocity;\r\n\t}\r\n\r\n\t/**\r\n\t *  <code>GradientAngularVelocity</code> \r\n\t * @param\tconstantMin \r\n\t * @param\tconstantMax \r\n\t * @return \r\n\t */\r\n\tstatic createByRandomTwoConstant(constantMin: number, constantMax: number): GradientAngularVelocity {\r\n\t\tvar gradientAngularVelocity: GradientAngularVelocity = new GradientAngularVelocity();\r\n\t\tgradientAngularVelocity._type = 2;\r\n\t\tgradientAngularVelocity._separateAxes = false;\r\n\t\tgradientAngularVelocity._constantMin = constantMin;\r\n\t\tgradientAngularVelocity._constantMax = constantMax;\r\n\t\treturn gradientAngularVelocity;\r\n\t}\r\n\r\n\t/**\r\n\t *  <code>GradientAngularVelocity</code> \r\n\t * @param\tseparateConstantMin  \r\n\t * @param\tseparateConstantMax  \r\n\t * @return  \r\n\t */\r\n\tstatic createByRandomTwoConstantSeparate(separateConstantMin: Vector3, separateConstantMax: Vector3): GradientAngularVelocity {\r\n\t\tvar gradientAngularVelocity: GradientAngularVelocity = new GradientAngularVelocity();\r\n\t\tgradientAngularVelocity._type = 2;\r\n\t\tgradientAngularVelocity._separateAxes = true;\r\n\t\tgradientAngularVelocity._constantMinSeparate = separateConstantMin;\r\n\t\tgradientAngularVelocity._constantMaxSeparate = separateConstantMax;\r\n\t\treturn gradientAngularVelocity;\r\n\t}\r\n\r\n\t/**\r\n\t *  <code>GradientAngularVelocity</code> \r\n\t * @param\tgradientMin \r\n\t * @param\tgradientMax \r\n\t * @return  \r\n\t */\r\n\tstatic createByRandomTwoGradient(gradientMin: GradientDataNumber, gradientMax: GradientDataNumber): GradientAngularVelocity {\r\n\t\tvar gradientAngularVelocity: GradientAngularVelocity = new GradientAngularVelocity();\r\n\t\tgradientAngularVelocity._type = 3;\r\n\t\tgradientAngularVelocity._separateAxes = false;\r\n\t\tgradientAngularVelocity._gradientMin = gradientMin;\r\n\t\tgradientAngularVelocity._gradientMax = gradientMax;\r\n\t\treturn gradientAngularVelocity;\r\n\t}\r\n\r\n\t/**\r\n\t *  <code>GradientAngularVelocity</code> \r\n\t * @param\tgradientXMin  X\r\n\t * @param\tgradientXMax  X\r\n\t * @param\tgradientYMin  Y\r\n\t * @param\tgradientYMax  Y\r\n\t * @param\tgradientZMin  Z\r\n\t * @param\tgradientZMax  Z\r\n\t * @return  \r\n\t */\r\n\tstatic createByRandomTwoGradientSeparate(gradientXMin: GradientDataNumber, gradientXMax: GradientDataNumber, gradientYMin: GradientDataNumber, gradientYMax: GradientDataNumber, gradientZMin: GradientDataNumber, gradientZMax: GradientDataNumber, gradientWMin: GradientDataNumber, gradientWMax: GradientDataNumber): GradientAngularVelocity {\r\n\t\tvar gradientAngularVelocity: GradientAngularVelocity = new GradientAngularVelocity();\r\n\t\tgradientAngularVelocity._type = 3;\r\n\t\tgradientAngularVelocity._separateAxes = true;\r\n\t\tgradientAngularVelocity._gradientXMin = gradientXMin;\r\n\t\tgradientAngularVelocity._gradientXMax = gradientXMax;\r\n\t\tgradientAngularVelocity._gradientYMin = gradientYMin;\r\n\t\tgradientAngularVelocity._gradientYMax = gradientYMax;\r\n\t\tgradientAngularVelocity._gradientZMin = gradientZMin;\r\n\t\tgradientAngularVelocity._gradientZMax = gradientZMax;\r\n\t\tgradientAngularVelocity._gradientWMin = gradientWMin;\r\n\t\tgradientAngularVelocity._gradientWMax = gradientWMax;\r\n\t\treturn gradientAngularVelocity;\r\n\t}\r\n\r\n\tprivate _type: number = 0;\r\n\tprivate _separateAxes: boolean = false;\r\n\r\n\tprivate _constant: number = 0;\r\n\tprivate _constantSeparate: Vector3 = null;\r\n\r\n\tprivate _gradient: GradientDataNumber = null;\r\n\tprivate _gradientX: GradientDataNumber = null;\r\n\tprivate _gradientY: GradientDataNumber = null;\r\n\tprivate _gradientZ: GradientDataNumber = null;\r\n\tprivate _gradientW: GradientDataNumber = null;\r\n\r\n\tprivate _constantMin: number = 0;\r\n\tprivate _constantMax: number = 0;\r\n\tprivate _constantMinSeparate: Vector3 = null;\r\n\tprivate _constantMaxSeparate: Vector3 = null;\r\n\r\n\tprivate _gradientMin: GradientDataNumber = null;\r\n\tprivate _gradientMax: GradientDataNumber = null;\r\n\tprivate _gradientXMin: GradientDataNumber = null;\r\n\tprivate _gradientXMax: GradientDataNumber = null;\r\n\tprivate _gradientYMin: GradientDataNumber = null;\r\n\tprivate _gradientYMax: GradientDataNumber = null;\r\n\tprivate _gradientZMin: GradientDataNumber = null;\r\n\tprivate _gradientZMax: GradientDataNumber = null;\r\n\tprivate _gradientWMin: GradientDataNumber = null;\r\n\tprivate _gradientWMax: GradientDataNumber = null;\r\n\r\n\t/**\r\n\t *,0123\r\n\t */\r\n\tget type(): number {\r\n\t\treturn this._type;\r\n\t}\r\n\r\n\t/**\r\n\t *\r\n\t */\r\n\tget separateAxes(): boolean {\r\n\t\treturn this._separateAxes;\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t */\r\n\tget constant(): number {\r\n\t\treturn this._constant;\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t */\r\n\tget constantSeparate(): Vector3 {\r\n\t\treturn this._constantSeparate;\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t */\r\n\tget gradient(): GradientDataNumber {\r\n\t\treturn this._gradient;\r\n\t}\r\n\r\n\t/**\r\n\t * X\r\n\t */\r\n\tget gradientX(): GradientDataNumber {\r\n\t\treturn this._gradientX;\r\n\t}\r\n\r\n\t/**\r\n\t * Y\r\n\t */\r\n\tget gradientY(): GradientDataNumber {\r\n\t\treturn this._gradientY;\r\n\t}\r\n\r\n\t/**\r\n\t *Z\r\n\t */\r\n\tget gradientZ(): GradientDataNumber {\r\n\t\treturn this._gradientZ;\r\n\t}\r\n\r\n\t/**\r\n\t *Z\r\n\t */\r\n\tget gradientW(): GradientDataNumber {\r\n\t\treturn this._gradientW;\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t */\r\n\tget constantMin(): number {\r\n\t\treturn this._constantMin;\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t */\r\n\tget constantMax(): number {\r\n\t\treturn this._constantMax;\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t */\r\n\tget constantMinSeparate(): Vector3 {\r\n\t\treturn this._constantMinSeparate;\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t */\r\n\tget constantMaxSeparate(): Vector3 {\r\n\t\treturn this._constantMaxSeparate;\r\n\t}\r\n\r\n\t/**\r\n\t *\r\n\t */\r\n\tget gradientMin(): GradientDataNumber {\r\n\t\treturn this._gradientMin;\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t */\r\n\tget gradientMax(): GradientDataNumber {\r\n\t\treturn this._gradientMax;\r\n\t}\r\n\r\n\t/**\r\n\t * X\r\n\t */\r\n\tget gradientXMin(): GradientDataNumber {\r\n\t\treturn this._gradientXMin;\r\n\t}\r\n\r\n\t/**\r\n\t * X\r\n\t */\r\n\tget gradientXMax(): GradientDataNumber {\r\n\t\treturn this._gradientXMax;\r\n\t}\r\n\r\n\t/**\r\n\t * Y\r\n\t */\r\n\tget gradientYMin(): GradientDataNumber {\r\n\t\treturn this._gradientYMin;\r\n\t}\r\n\r\n\t/**\r\n\t *Y\r\n\t */\r\n\tget gradientYMax(): GradientDataNumber {\r\n\t\treturn this._gradientYMax;\r\n\t}\r\n\r\n\t/**\r\n\t * Z\r\n\t */\r\n\tget gradientZMin(): GradientDataNumber {\r\n\t\treturn this._gradientZMin;\r\n\t}\r\n\r\n\t/**\r\n\t * Z\r\n\t */\r\n\tget gradientZMax(): GradientDataNumber {\r\n\t\treturn this._gradientZMax;\r\n\t}\r\n\r\n\t/**\r\n\t * Z\r\n\t */\r\n\tget gradientWMin(): GradientDataNumber {\r\n\t\treturn this._gradientWMin;\r\n\t}\r\n\r\n\t/**\r\n\t * Z\r\n\t */\r\n\tget gradientWMax(): GradientDataNumber {\r\n\t\treturn this._gradientWMax;\r\n\t}\r\n\r\n\t/**\r\n\t *  <code>GradientAngularVelocity,new</code> \r\n\t */\r\n\tconstructor() {\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t * @param\tdestObject \r\n\t */\r\n\tcloneTo(destObject: any): void {\r\n\t\tvar destGradientAngularVelocity: GradientAngularVelocity = (<GradientAngularVelocity>destObject);\r\n\t\tdestGradientAngularVelocity._type = this._type;\r\n\t\tdestGradientAngularVelocity._separateAxes = this._separateAxes;\r\n\t\tdestGradientAngularVelocity._constant = this._constant;\r\n\t\tthis._constantSeparate.cloneTo(destGradientAngularVelocity._constantSeparate);\r\n\t\tthis._gradient.cloneTo(destGradientAngularVelocity._gradient);\r\n\t\tthis._gradientX.cloneTo(destGradientAngularVelocity._gradientX);\r\n\t\tthis._gradientY.cloneTo(destGradientAngularVelocity._gradientY);\r\n\t\tthis._gradientZ.cloneTo(destGradientAngularVelocity._gradientZ);\r\n\t\tdestGradientAngularVelocity._constantMin = this._constantMin;\r\n\t\tdestGradientAngularVelocity._constantMax = this._constantMax;\r\n\t\tthis._constantMinSeparate.cloneTo(destGradientAngularVelocity._constantMinSeparate);\r\n\t\tthis._constantMaxSeparate.cloneTo(destGradientAngularVelocity._constantMaxSeparate);\r\n\t\tthis._gradientMin.cloneTo(destGradientAngularVelocity._gradientMin);\r\n\t\tthis._gradientMax.cloneTo(destGradientAngularVelocity._gradientMax);\r\n\t\tthis._gradientXMin.cloneTo(destGradientAngularVelocity._gradientXMin);\r\n\t\tthis._gradientXMax.cloneTo(destGradientAngularVelocity._gradientXMax);\r\n\t\tthis._gradientYMin.cloneTo(destGradientAngularVelocity._gradientYMin);\r\n\t\tthis._gradientYMax.cloneTo(destGradientAngularVelocity._gradientYMax);\r\n\t\tthis._gradientZMin.cloneTo(destGradientAngularVelocity._gradientZMin);\r\n\t\tthis._gradientZMax.cloneTo(destGradientAngularVelocity._gradientZMax);\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t * @return\t \r\n\t */\r\n\tclone(): any {\r\n\t\tvar destGradientAngularVelocity: GradientAngularVelocity = new GradientAngularVelocity();\r\n\t\tthis.cloneTo(destGradientAngularVelocity);\r\n\t\treturn destGradientAngularVelocity;\r\n\t}\r\n\r\n}\r\n\r\n\r\n","import { IClone } from \"../../../../utils/IClone\"\r\n\r\n/**\r\n * <code>GradientDataInt</code> \r\n */\r\nexport class GradientDataInt implements IClone {\r\n\tprivate _currentLength: number = 0;\r\n\t/**@internal */\r\n\t_elements: Float32Array;//TODO:int\r\n\r\n\t/***/\r\n\tget gradientCount(): number {\r\n\t\treturn this._currentLength / 2;\r\n\t}\r\n\r\n\t/**\r\n\t *  <code>GradientDataInt</code> \r\n\t */\r\n\tconstructor() {\r\n\t\tthis._elements = new Float32Array(8);\r\n\t}\r\n\r\n\r\n\t/**\r\n\t * @internal\r\n\t * 1\r\n\t */\r\n\t_formatData() {\r\n\t\tif (this._currentLength == 8) return;\r\n\t\tif (this._elements[this._currentLength - 2] !== 1) {\r\n\t\t\tthis._elements[this._currentLength] = 1;\r\n\t\t\tthis._elements[this._currentLength + 1] = this._elements[this._currentLength - 1];\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t * @param\tkey 01\r\n\t * @param\tvalue \r\n\t */\r\n\tadd(key: number, value: number): void {\r\n\t\tif (this._currentLength < 8) {\r\n\t\t\tif ((this._currentLength === 6) && ((key !== 1))) {\r\n\t\t\t\tkey = 1;\r\n\t\t\t\tconsole.log(\"Warning:the forth key is  be force set to 1.\");\r\n\t\t\t}\r\n\r\n\t\t\tthis._elements[this._currentLength++] = key;\r\n\t\t\tthis._elements[this._currentLength++] = value;\r\n\t\t} else {\r\n\t\t\tconsole.log(\"Warning:data count must lessEqual than 4\");\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t * @param\tdestObject \r\n\t */\r\n\tcloneTo(destObject: any): void {\r\n\t\tvar destGradientDataInt: GradientDataInt = <GradientDataInt>destObject;\r\n\t\tdestGradientDataInt._currentLength = this._currentLength;\r\n\t\tvar destElements: Float32Array = destGradientDataInt._elements;\r\n\t\tfor (var i: number = 0, n: number = this._elements.length; i < n; i++) {\r\n\t\t\tdestElements[i] = this._elements[i];\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t * @return\t \r\n\t */\r\n\tclone(): any {\r\n\t\tvar destGradientDataInt: GradientDataInt = new GradientDataInt();\r\n\t\tthis.cloneTo(destGradientDataInt);\r\n\t\treturn destGradientDataInt;\r\n\t}\r\n\r\n}\r\n\r\n\r\n","import { IClone } from \"../../../../utils/IClone\"\r\n\r\n/**\r\n * <code>GradientDataNumber</code> \r\n */\r\nexport class GradientDataNumber implements IClone {\r\n\tprivate _currentLength: number = 0;\r\n\t/**@internal */\r\n\t_elements: Float32Array;\r\n\r\n\t/***/\r\n\tget gradientCount(): number {\r\n\t\treturn this._currentLength / 2;\r\n\t}\r\n\r\n\t/**\r\n\t *  <code>GradientDataNumber</code> \r\n\t */\r\n\tconstructor() {\r\n\t\tthis._elements = new Float32Array(8);\r\n\t}\r\n\r\n\t/**\r\n\t * @internal\r\n\t * 1\r\n\t */\r\n\t_formatData() {\r\n\t\tif (this._currentLength == 8) return;\r\n\t\tif (this._elements[this._currentLength - 2] !== 1) {\r\n\t\t\tthis._elements[this._currentLength] = 1;\r\n\t\t\tthis._elements[this._currentLength + 1] = this._elements[this._currentLength - 1];\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t * @param\tkey 01\r\n\t * @param\tvalue \r\n\t */\r\n\tadd(key: number, value: number): void {\r\n\t\tif (this._currentLength < 8) {\r\n\r\n\t\t\tif ((this._currentLength === 6) && ((key !== 1))) {\r\n\t\t\t\tkey = 1;\r\n\t\t\t\tconsole.log(\"GradientDataNumber warning:the forth key is  be force set to 1.\");\r\n\t\t\t}\r\n\r\n\t\t\tthis._elements[this._currentLength++] = key;\r\n\t\t\tthis._elements[this._currentLength++] = value;\r\n\t\t} else {\r\n\t\t\tconsole.log(\"GradientDataNumber warning:data count must lessEqual than 4\");\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t * @param\tindex \r\n\t * @return\tvalue \r\n\t */\r\n\tgetKeyByIndex(index: number): number {\r\n\t\treturn this._elements[index * 2];\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t * @param\tindex \r\n\t * @return\tvalue \r\n\t */\r\n\tgetValueByIndex(index: number): number {\r\n\t\treturn this._elements[index * 2 + 1];\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t */\r\n\tgetAverageValue(): number {\r\n\t\tvar total: number = 0;\r\n\t\tvar count: number = 0;\r\n\t\tfor (var i: number = 0, n: number = this._currentLength - 2; i < n; i += 2) {\r\n\t\t\tvar subValue: number = this._elements[i + 1];\r\n\t\t\tsubValue += this._elements[i + 3];\r\n\t\t\tsubValue = subValue * (this._elements[i + 2] - this._elements[i]);\r\n\t\t\ttotal += subValue;\r\n\t\t\tcount++;\r\n\t\t}\r\n\t\treturn total / count;\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t * @param\tdestObject \r\n\t */\r\n\tcloneTo(destObject: any): void {\r\n\t\tvar destGradientDataNumber: GradientDataNumber = <GradientDataNumber>destObject;\r\n\t\tdestGradientDataNumber._currentLength = this._currentLength;\r\n\t\tvar destElements: Float32Array = destGradientDataNumber._elements;\r\n\t\tfor (var i: number = 0, n: number = this._elements.length; i < n; i++)\r\n\t\t\tdestElements[i] = this._elements[i];\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t * @return\t \r\n\t */\r\n\tclone(): any {\r\n\t\tvar destGradientDataNumber: GradientDataNumber = new GradientDataNumber();\r\n\t\tthis.cloneTo(destGradientDataNumber);\r\n\t\treturn destGradientDataNumber;\r\n\t}\r\n\r\n}\r\n\r\n\r\n","import { GradientDataNumber } from \"./GradientDataNumber\";\r\nimport { IClone } from \"../../../../utils/IClone\"\r\nimport { Vector3 } from \"../../../../maths/Vector3\";\r\n\r\n/**\r\n * <code>GradientSize</code> \r\n */\r\nexport class GradientSize implements IClone {\r\n\t/**\r\n\t *  <code>GradientSize</code> \r\n\t * @param\tgradient \r\n\t * @return  \r\n\t */\r\n\tstatic createByGradient(gradient: GradientDataNumber): GradientSize {\r\n\t\tvar gradientSize: GradientSize = new GradientSize();\r\n\t\tgradientSize._type = 0;\r\n\t\tgradientSize._separateAxes = false;\r\n\t\tgradientSize._gradient = gradient;\r\n\t\treturn gradientSize;\r\n\t}\r\n\r\n\t/**\r\n\t *  <code>GradientSize</code> \r\n\t * @param\tgradientX X\r\n\t * @param\tgradientY Y\r\n\t * @param\tgradientZ Z\r\n\t * @return  \r\n\t */\r\n\tstatic createByGradientSeparate(gradientX: GradientDataNumber, gradientY: GradientDataNumber, gradientZ: GradientDataNumber): GradientSize {\r\n\t\tvar gradientSize: GradientSize = new GradientSize();\r\n\t\tgradientSize._type = 0;\r\n\t\tgradientSize._separateAxes = true;\r\n\t\tgradientSize._gradientX = gradientX;\r\n\t\tgradientSize._gradientY = gradientY;\r\n\t\tgradientSize._gradientZ = gradientZ;\r\n\t\treturn gradientSize;\r\n\t}\r\n\r\n\t/**\r\n\t *  <code>GradientSize</code> \r\n\t * @param\tconstantMin \r\n\t * @param\tconstantMax \r\n\t * @return \r\n\t */\r\n\tstatic createByRandomTwoConstant(constantMin: number, constantMax: number): GradientSize {\r\n\t\tvar gradientSize: GradientSize = new GradientSize();\r\n\t\tgradientSize._type = 1;\r\n\t\tgradientSize._separateAxes = false;\r\n\t\tgradientSize._constantMin = constantMin;\r\n\t\tgradientSize._constantMax = constantMax;\r\n\t\treturn gradientSize;\r\n\t}\r\n\r\n\t/**\r\n\t *  <code>GradientSize</code> \r\n\t * @param\tconstantMinSeparate .\r\n\t * @param\tconstantMaxSeparate \r\n\t * @return   \r\n\t */\r\n\tstatic createByRandomTwoConstantSeparate(constantMinSeparate: Vector3, constantMaxSeparate: Vector3): GradientSize {\r\n\t\tvar gradientSize: GradientSize = new GradientSize();\r\n\t\tgradientSize._type = 1;\r\n\t\tgradientSize._separateAxes = true;\r\n\t\tgradientSize._constantMinSeparate = constantMinSeparate;\r\n\t\tgradientSize._constantMaxSeparate = constantMaxSeparate;\r\n\t\treturn gradientSize;\r\n\t}\r\n\r\n\t/**\r\n\t *  <code>GradientSize</code> \r\n\t * @param\tgradientMin \r\n\t * @param\tgradientMax \r\n\t * @return \r\n\t */\r\n\tstatic createByRandomTwoGradient(gradientMin: GradientDataNumber, gradientMax: GradientDataNumber): GradientSize {\r\n\t\tvar gradientSize: GradientSize = new GradientSize();\r\n\t\tgradientSize._type = 2;\r\n\t\tgradientSize._separateAxes = false;\r\n\t\tgradientSize._gradientMin = gradientMin;\r\n\t\tgradientSize._gradientMax = gradientMax;\r\n\t\treturn gradientSize;\r\n\t}\r\n\r\n\t/**\r\n\t *  <code>GradientSize</code> \r\n\t * @param\tgradientXMin X\r\n\t * @param\tgradientXMax X\r\n\t * @param\tgradientYMin Y\r\n\t * @param\tgradientYMax Y\r\n\t * @param\tgradientZMin Z\r\n\t * @param\tgradientZMax Z\r\n\t * @return  \r\n\t */\r\n\tstatic createByRandomTwoGradientSeparate(gradientXMin: GradientDataNumber, gradientXMax: GradientDataNumber, gradientYMin: GradientDataNumber, gradientYMax: GradientDataNumber, gradientZMin: GradientDataNumber, gradientZMax: GradientDataNumber): GradientSize {\r\n\t\tvar gradientSize: GradientSize = new GradientSize();\r\n\t\tgradientSize._type = 2;\r\n\t\tgradientSize._separateAxes = true;\r\n\t\tgradientSize._gradientXMin = gradientXMin;\r\n\t\tgradientSize._gradientXMax = gradientXMax;\r\n\t\tgradientSize._gradientYMin = gradientYMin;\r\n\t\tgradientSize._gradientYMax = gradientYMax;\r\n\t\tgradientSize._gradientZMin = gradientZMin;\r\n\t\tgradientSize._gradientZMax = gradientZMax;\r\n\t\treturn gradientSize;\r\n\t}\r\n\r\n\tprivate _type: number = 0;\r\n\tprivate _separateAxes: boolean = false;\r\n\r\n\tprivate _gradient: GradientDataNumber = null;\r\n\tprivate _gradientX: GradientDataNumber = null;\r\n\tprivate _gradientY: GradientDataNumber = null;\r\n\tprivate _gradientZ: GradientDataNumber = null;\r\n\r\n\r\n\tprivate _constantMin: number = 0;\r\n\tprivate _constantMax: number = 0;\r\n\tprivate _constantMinSeparate: Vector3 = null;\r\n\tprivate _constantMaxSeparate: Vector3 = null;\r\n\r\n\r\n\tprivate _gradientMin: GradientDataNumber = null;\r\n\tprivate _gradientMax: GradientDataNumber = null;\r\n\tprivate _gradientXMin: GradientDataNumber = null;\r\n\tprivate _gradientXMax: GradientDataNumber = null;\r\n\tprivate _gradientYMin: GradientDataNumber = null;\r\n\tprivate _gradientYMax: GradientDataNumber = null;\r\n\tprivate _gradientZMin: GradientDataNumber = null;\r\n\tprivate _gradientZMax: GradientDataNumber = null;\r\n\r\n\t/**\r\n\t *012\r\n\t */\r\n\tget type(): number {\r\n\t\treturn this._type;\r\n\t}\r\n\r\n\t/**\r\n\t *\r\n\t */\r\n\tget separateAxes(): boolean {\r\n\t\treturn this._separateAxes;\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t */\r\n\tget gradient(): GradientDataNumber {\r\n\t\treturn this._gradient;\r\n\t}\r\n\r\n\t/**\r\n\t * X\r\n\t */\r\n\tget gradientX(): GradientDataNumber {\r\n\t\treturn this._gradientX;\r\n\t}\r\n\r\n\t/**\r\n\t * Y\r\n\t */\r\n\tget gradientY(): GradientDataNumber {\r\n\t\treturn this._gradientY;\r\n\t}\r\n\r\n\t/**\r\n\t *Z\r\n\t */\r\n\tget gradientZ(): GradientDataNumber {\r\n\t\treturn this._gradientZ;\r\n\t}\r\n\r\n\t/**\r\n\t *\r\n\t */\r\n\tget constantMin(): number {\r\n\t\treturn this._constantMin;\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t */\r\n\tget constantMax(): number {\r\n\t\treturn this._constantMax;\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t */\r\n\tget constantMinSeparate(): Vector3 {\r\n\t\treturn this._constantMinSeparate;\r\n\t}\r\n\r\n\t/**\r\n\t *  \r\n\t */\r\n\tget constantMaxSeparate(): Vector3 {\r\n\t\treturn this._constantMaxSeparate;\r\n\t}\r\n\r\n\t/**\r\n\t *\r\n\t */\r\n\tget gradientMin(): GradientDataNumber {\r\n\t\treturn this._gradientMin;\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t */\r\n\tget gradientMax(): GradientDataNumber {\r\n\t\treturn this._gradientMax;\r\n\t}\r\n\r\n\t/**\r\n\t * X\r\n\t */\r\n\tget gradientXMin(): GradientDataNumber {\r\n\t\treturn this._gradientXMin;\r\n\t}\r\n\r\n\t/**\r\n\t * X\r\n\t */\r\n\tget gradientXMax(): GradientDataNumber {\r\n\t\treturn this._gradientXMax;\r\n\t}\r\n\r\n\t/**\r\n\t * Y\r\n\t */\r\n\tget gradientYMin(): GradientDataNumber {\r\n\t\treturn this._gradientYMin;\r\n\t}\r\n\r\n\t/**\r\n\t *Y\r\n\t */\r\n\tget gradientYMax(): GradientDataNumber {\r\n\t\treturn this._gradientYMax;\r\n\t}\r\n\r\n\t/**\r\n\t * Z\r\n\t */\r\n\tget gradientZMin(): GradientDataNumber {\r\n\t\treturn this._gradientZMin;\r\n\t}\r\n\r\n\t/**\r\n\t * Z\r\n\t */\r\n\tget gradientZMax(): GradientDataNumber {\r\n\t\treturn this._gradientZMax;\r\n\t}\r\n\r\n\t/**\r\n\t *  <code>GradientSize,new</code> \r\n\t */\r\n\tconstructor() {\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t */\r\n\tgetMaxSizeInGradient(meshMode: boolean = false): number {\r\n\t\tvar i: number, n: number;\r\n\t\tvar maxSize: number = -Number.MAX_VALUE;\r\n\t\tswitch (this._type) {\r\n\t\t\tcase 0:\r\n\t\t\t\tif (this._separateAxes) {\r\n\t\t\t\t\tfor (i = 0, n = this._gradientX.gradientCount; i < n; i++)\r\n\t\t\t\t\t\tmaxSize = Math.max(maxSize, this._gradientX.getValueByIndex(i));\r\n\t\t\t\t\tfor (i = 0, n = this._gradientY.gradientCount; i < n; i++)\r\n\t\t\t\t\t\tmaxSize = Math.max(maxSize, this._gradientY.getValueByIndex(i));\r\n\t\t\t\t\tif (meshMode) {\r\n\t\t\t\t\t\tfor (i = 0, n = this._gradientZ.gradientCount; i < n; i++) {\r\n\t\t\t\t\t\t\tmaxSize = Math.max(maxSize, this._gradientZ.getValueByIndex(i));\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\tfor (i = 0, n = this._gradient.gradientCount; i < n; i++)\r\n\t\t\t\t\t\tmaxSize = Math.max(maxSize, this._gradient.getValueByIndex(i));\r\n\t\t\t\t}\r\n\t\t\t\tbreak;\r\n\t\t\tcase 1:\r\n\t\t\t\tif (this._separateAxes) {\r\n\t\t\t\t\tmaxSize = Math.max(this._constantMinSeparate.x, this._constantMaxSeparate.x);\r\n\t\t\t\t\tmaxSize = Math.max(maxSize, this._constantMinSeparate.y);\r\n\t\t\t\t\tif (meshMode) {\r\n\t\t\t\t\t\tmaxSize = maxSize = Math.max(maxSize, this._constantMaxSeparate.z);\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\tmaxSize = Math.max(this._constantMin, this._constantMax);\r\n\t\t\t\t}\r\n\t\t\t\tbreak;\r\n\t\t\tcase 2:\r\n\t\t\t\tif (this._separateAxes) {\r\n\t\t\t\t\tfor (i = 0, n = this._gradientXMin.gradientCount; i < n; i++)\r\n\t\t\t\t\t\tmaxSize = Math.max(maxSize, this._gradientXMin.getValueByIndex(i));\r\n\t\t\t\t\tfor (i = 0, n = this._gradientXMax.gradientCount; i < n; i++)\r\n\t\t\t\t\t\tmaxSize = Math.max(maxSize, this._gradientXMax.getValueByIndex(i));\r\n\r\n\t\t\t\t\tfor (i = 0, n = this._gradientYMin.gradientCount; i < n; i++)\r\n\t\t\t\t\t\tmaxSize = Math.max(maxSize, this._gradientYMin.getValueByIndex(i));\r\n\t\t\t\t\tfor (i = 0, n = this._gradientZMax.gradientCount; i < n; i++)\r\n\t\t\t\t\t\tmaxSize = Math.max(maxSize, this._gradientZMax.getValueByIndex(i));\r\n\t\t\t\t\t\r\n\t\t\t\t\tif (meshMode) {\r\n\t\t\t\t\t\tfor (i = 0, n = this._gradientZMin.gradientCount; i < n; i++) {\r\n\t\t\t\t\t\t\tmaxSize = Math.max(maxSize, this._gradientZMin.getValueByIndex(i));\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tfor (i = 0, n = this._gradientZMax.gradientCount; i < n; i++) {\r\n\t\t\t\t\t\t\tmaxSize = Math.max(maxSize, this._gradientZMax.getValueByIndex(i));\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\tfor (i = 0, n = this._gradientMin.gradientCount; i < n; i++)\r\n\t\t\t\t\t\tmaxSize = Math.max(maxSize, this._gradientMin.getValueByIndex(i));\r\n\t\t\t\t\tfor (i = 0, n = this._gradientMax.gradientCount; i < n; i++)\r\n\t\t\t\t\t\tmaxSize = Math.max(maxSize, this._gradientMax.getValueByIndex(i));\r\n\t\t\t\t}\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\t\treturn maxSize;\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t * @param\tdestObject \r\n\t */\r\n\tcloneTo(destObject: any): void {\r\n\t\tvar destGradientSize: GradientSize = (<GradientSize>destObject);\r\n\t\tdestGradientSize._type = this._type;\r\n\t\tdestGradientSize._separateAxes = this._separateAxes;\r\n\t\tthis._gradient.cloneTo(destGradientSize._gradient);\r\n\t\tthis._gradientX.cloneTo(destGradientSize._gradientX);\r\n\t\tthis._gradientY.cloneTo(destGradientSize._gradientY);\r\n\t\tthis._gradientZ.cloneTo(destGradientSize._gradientZ);\r\n\t\tdestGradientSize._constantMin = this._constantMin;\r\n\t\tdestGradientSize._constantMax = this._constantMax;\r\n\t\tthis._constantMinSeparate.cloneTo(destGradientSize._constantMinSeparate);\r\n\t\tthis._constantMaxSeparate.cloneTo(destGradientSize._constantMaxSeparate);\r\n\t\tthis._gradientMin.cloneTo(destGradientSize._gradientMin);\r\n\t\tthis._gradientMax.cloneTo(destGradientSize._gradientMax);\r\n\t\tthis._gradientXMin.cloneTo(destGradientSize._gradientXMin);\r\n\t\tthis._gradientXMax.cloneTo(destGradientSize._gradientXMax);\r\n\t\tthis._gradientYMin.cloneTo(destGradientSize._gradientYMin);\r\n\t\tthis._gradientYMax.cloneTo(destGradientSize._gradientYMax);\r\n\t\tthis._gradientZMin.cloneTo(destGradientSize._gradientZMin);\r\n\t\tthis._gradientZMax.cloneTo(destGradientSize._gradientZMax);\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t * @return\t \r\n\t */\r\n\tclone(): any {\r\n\t\tvar destGradientSize: GradientSize = new GradientSize();\r\n\t\tthis.cloneTo(destGradientSize);\r\n\t\treturn destGradientSize;\r\n\t}\r\n\r\n}\r\n\r\n\r\n","import { GradientDataNumber } from \"./GradientDataNumber\";\r\nimport { IClone } from \"../../../../utils/IClone\"\r\nimport { Vector3 } from \"../../../../maths/Vector3\";\r\n\r\n/**\r\n * <code>GradientVelocity</code> \r\n */\r\nexport class GradientVelocity implements IClone {\r\n\t/**\r\n\t *  <code>GradientVelocity</code> \r\n\t * @param\tconstant \r\n\t * @return \r\n\t */\r\n\tstatic createByConstant(constant: Vector3): GradientVelocity {\r\n\t\tvar gradientVelocity: GradientVelocity = new GradientVelocity();\r\n\t\tgradientVelocity._type = 0;\r\n\t\tgradientVelocity._constant = constant;\r\n\t\treturn gradientVelocity;\r\n\t}\r\n\r\n\t/**\r\n\t *  <code>GradientVelocity</code> \r\n\t * @param\tgradientX X\r\n\t * @param\tgradientY Y\r\n\t * @param\tgradientZ Z\r\n\t * @return  \r\n\t */\r\n\tstatic createByGradient(gradientX: GradientDataNumber, gradientY: GradientDataNumber, gradientZ: GradientDataNumber): GradientVelocity {\r\n\t\tvar gradientVelocity: GradientVelocity = new GradientVelocity();\r\n\t\tgradientVelocity._type = 1;\r\n\t\tgradientVelocity._gradientX = gradientX;\r\n\t\tgradientVelocity._gradientY = gradientY;\r\n\t\tgradientVelocity._gradientZ = gradientZ;\r\n\t\treturn gradientVelocity;\r\n\t}\r\n\r\n\t/**\r\n\t *  <code>GradientVelocity</code> \r\n\t * @param\tconstantMin \r\n\t * @param\tconstantMax \r\n\t * @return \r\n\t */\r\n\tstatic createByRandomTwoConstant(constantMin: Vector3, constantMax: Vector3): GradientVelocity {\r\n\t\tvar gradientVelocity: GradientVelocity = new GradientVelocity();\r\n\t\tgradientVelocity._type = 2;\r\n\t\tgradientVelocity._constantMin = constantMin;\r\n\t\tgradientVelocity._constantMax = constantMax;\r\n\t\treturn gradientVelocity;\r\n\t}\r\n\r\n\t/**\r\n\t *  <code>GradientVelocity</code> \r\n\t * @param\tgradientXMin X\r\n\t * @param\tgradientXMax X\r\n\t * @param\tgradientYMin Y\r\n\t * @param\tgradientYMax Y\r\n\t * @param\tgradientZMin Z\r\n\t * @param\tgradientZMax Z\r\n\t * @return  \r\n\t */\r\n\tstatic createByRandomTwoGradient(gradientXMin: GradientDataNumber, gradientXMax: GradientDataNumber, gradientYMin: GradientDataNumber, gradientYMax: GradientDataNumber, gradientZMin: GradientDataNumber, gradientZMax: GradientDataNumber): GradientVelocity {\r\n\t\tvar gradientVelocity: GradientVelocity = new GradientVelocity();\r\n\t\tgradientVelocity._type = 3;\r\n\t\tgradientVelocity._gradientXMin = gradientXMin;\r\n\t\tgradientVelocity._gradientXMax = gradientXMax;\r\n\t\tgradientVelocity._gradientYMin = gradientYMin;\r\n\t\tgradientVelocity._gradientYMax = gradientYMax;\r\n\t\tgradientVelocity._gradientZMin = gradientZMin;\r\n\t\tgradientVelocity._gradientZMax = gradientZMax;\r\n\t\treturn gradientVelocity;\r\n\t}\r\n\r\n\tprivate _type: number = 0;\r\n\tprivate _constant: Vector3 = null;\r\n\r\n\t\r\n\tprivate _gradientX: GradientDataNumber = null;\r\n\tprivate _gradientY: GradientDataNumber = null;\r\n\tprivate _gradientZ: GradientDataNumber = null;\r\n\r\n\t\r\n\tprivate _constantMin: Vector3 = null;\r\n\tprivate _constantMax: Vector3 = null;\r\n\r\n\t\r\n\tprivate _gradientXMin: GradientDataNumber = null;\r\n\tprivate _gradientXMax: GradientDataNumber = null;\r\n\tprivate _gradientYMin: GradientDataNumber = null;\r\n\tprivate _gradientYMax: GradientDataNumber = null;\r\n\tprivate _gradientZMin: GradientDataNumber = null;\r\n\tprivate _gradientZMax: GradientDataNumber = null;\r\n\r\n\t/**\r\n\t *0123\r\n\t */\r\n\tget type(): number {\r\n\t\treturn this._type;\r\n\t}\r\n\r\n\t/***/\r\n\tget constant(): Vector3 {\r\n\t\treturn this._constant;\r\n\t}\r\n\r\n\t/**\r\n\t * X\r\n\t */\r\n\tget gradientX(): GradientDataNumber {\r\n\t\treturn this._gradientX;\r\n\t}\r\n\r\n\t/**\r\n\t * Y\r\n\t */\r\n\tget gradientY(): GradientDataNumber {\r\n\t\treturn this._gradientY;\r\n\t}\r\n\r\n\t/**\r\n\t *Z\r\n\t */\r\n\tget gradientZ(): GradientDataNumber {\r\n\t\treturn this._gradientZ;\r\n\t}\r\n\r\n\t/***/\r\n\tget constantMin(): Vector3 {\r\n\t\treturn this._constantMin;\r\n\t}\r\n\r\n\t/***/\r\n\tget constantMax(): Vector3 {\r\n\t\treturn this._constantMax;\r\n\t}\r\n\r\n\t/**\r\n\t * X\r\n\t */\r\n\tget gradientXMin(): GradientDataNumber {\r\n\t\treturn this._gradientXMin;\r\n\t}\r\n\r\n\t/**\r\n\t * X\r\n\t */\r\n\tget gradientXMax(): GradientDataNumber {\r\n\t\treturn this._gradientXMax;\r\n\t}\r\n\r\n\t/**\r\n\t * Y\r\n\t */\r\n\tget gradientYMin(): GradientDataNumber {\r\n\t\treturn this._gradientYMin;\r\n\t}\r\n\r\n\t/**\r\n\t *Y\r\n\t */\r\n\tget gradientYMax(): GradientDataNumber {\r\n\t\treturn this._gradientYMax;\r\n\t}\r\n\r\n\t/**\r\n\t * Z\r\n\t */\r\n\tget gradientZMin(): GradientDataNumber {\r\n\t\treturn this._gradientZMin;\r\n\t}\r\n\r\n\t/**\r\n\t * Z\r\n\t */\r\n\tget gradientZMax(): GradientDataNumber {\r\n\t\treturn this._gradientZMax;\r\n\t}\r\n\r\n\t/**\r\n\t *  <code>GradientVelocity,new</code> \r\n\t */\r\n\tconstructor() {\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t * @param\tdestObject \r\n\t */\r\n\tcloneTo(destObject: any): void {\r\n\t\tvar destGradientVelocity: GradientVelocity = (<GradientVelocity>destObject);\r\n\t\tdestGradientVelocity._type = this._type;\r\n\t\tthis._constant.cloneTo(destGradientVelocity._constant);\r\n\t\tthis._gradientX.cloneTo(destGradientVelocity._gradientX);\r\n\t\tthis._gradientY.cloneTo(destGradientVelocity._gradientY);\r\n\t\tthis._gradientZ.cloneTo(destGradientVelocity._gradientZ);\r\n\t\tthis._constantMin.cloneTo(destGradientVelocity._constantMin);\r\n\t\tthis._constantMax.cloneTo(destGradientVelocity._constantMax);\r\n\t\tthis._gradientXMin.cloneTo(destGradientVelocity._gradientXMin);\r\n\t\tthis._gradientXMax.cloneTo(destGradientVelocity._gradientXMax);\r\n\t\tthis._gradientYMin.cloneTo(destGradientVelocity._gradientYMin);\r\n\t\tthis._gradientYMax.cloneTo(destGradientVelocity._gradientYMax);\r\n\t\tthis._gradientZMin.cloneTo(destGradientVelocity._gradientZMin);\r\n\t\tthis._gradientZMax.cloneTo(destGradientVelocity._gradientZMax);\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t * @return\t \r\n\t */\r\n\tclone(): any {\r\n\t\tvar destGradientVelocity: GradientVelocity = new GradientVelocity();\r\n\t\tthis.cloneTo(destGradientVelocity);\r\n\t\treturn destGradientVelocity;\r\n\t}\r\n\r\n}\r\n\r\n\r\n","import { GradientAngularVelocity } from \"./GradientAngularVelocity\";\r\nimport { IClone } from \"../../../../utils/IClone\"\r\n\r\n/**\r\n * <code>RotationOverLifetime</code> \r\n */\r\nexport class RotationOverLifetime implements IClone {\r\n\tprivate _angularVelocity: GradientAngularVelocity;\r\n\r\n\t/***/\r\n\tenable: boolean;\r\n\r\n\t/**\r\n\t *\r\n\t */\r\n\tget angularVelocity(): GradientAngularVelocity {\r\n\t\treturn this._angularVelocity;\r\n\t}\r\n\r\n\t/**\r\n\t *  <code>RotationOverLifetime,new</code> \r\n\t */\r\n\tconstructor(angularVelocity: GradientAngularVelocity) {\r\n\t\tthis._angularVelocity = angularVelocity;\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t * @param\tdestObject \r\n\t */\r\n\tcloneTo(destObject: any): void {\r\n\t\tvar destRotationOverLifetime: RotationOverLifetime = (<RotationOverLifetime>destObject);\r\n\t\tthis._angularVelocity.cloneTo(destRotationOverLifetime._angularVelocity);\r\n\t\tdestRotationOverLifetime.enable = this.enable;\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t * @return\t \r\n\t */\r\n\tclone(): any {\r\n\t\tvar destAngularVelocity: GradientAngularVelocity;\r\n\t\tswitch (this._angularVelocity.type) {\r\n\t\t\tcase 0:\r\n\t\t\t\tif (this._angularVelocity.separateAxes)\r\n\t\t\t\t\tdestAngularVelocity = GradientAngularVelocity.createByConstantSeparate(this._angularVelocity.constantSeparate.clone());\r\n\t\t\t\telse\r\n\t\t\t\t\tdestAngularVelocity = GradientAngularVelocity.createByConstant(this._angularVelocity.constant);\r\n\t\t\t\tbreak;\r\n\t\t\tcase 1:\r\n\t\t\t\tif (this._angularVelocity.separateAxes)\r\n\t\t\t\t\tdestAngularVelocity = GradientAngularVelocity.createByGradientSeparate(this._angularVelocity.gradientX.clone(), this._angularVelocity.gradientY.clone(), this._angularVelocity.gradientZ.clone());\r\n\t\t\t\telse\r\n\t\t\t\t\tdestAngularVelocity = GradientAngularVelocity.createByGradient(this._angularVelocity.gradient.clone());\r\n\t\t\t\tbreak;\r\n\t\t\tcase 2:\r\n\t\t\t\tif (this._angularVelocity.separateAxes)\r\n\t\t\t\t\tdestAngularVelocity = GradientAngularVelocity.createByRandomTwoConstantSeparate(this._angularVelocity.constantMinSeparate.clone(), this._angularVelocity.constantMaxSeparate.clone());\r\n\t\t\t\telse\r\n\t\t\t\t\tdestAngularVelocity = GradientAngularVelocity.createByRandomTwoConstant(this._angularVelocity.constantMin, this._angularVelocity.constantMax);\r\n\t\t\t\tbreak;\r\n\t\t\tcase 3:\r\n\t\t\t\tif (this._angularVelocity.separateAxes)\r\n\t\t\t\t\tdestAngularVelocity = GradientAngularVelocity.createByRandomTwoGradientSeparate(this._angularVelocity.gradientXMin.clone(), this._angularVelocity.gradientYMin.clone(), this._angularVelocity.gradientZMin.clone(), this._angularVelocity.gradientWMin.clone(), this._angularVelocity.gradientXMax.clone(), this._angularVelocity.gradientYMax.clone(), this._angularVelocity.gradientZMax.clone(), this._angularVelocity.gradientWMax.clone());\r\n\t\t\t\telse\r\n\t\t\t\t\tdestAngularVelocity = GradientAngularVelocity.createByRandomTwoGradient(this._angularVelocity.gradientMin.clone(), this._angularVelocity.gradientMax.clone());\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\r\n\t\tvar destRotationOverLifetime: RotationOverLifetime = new RotationOverLifetime(destAngularVelocity);\r\n\t\tdestRotationOverLifetime.enable = this.enable;\r\n\t\treturn destRotationOverLifetime;\r\n\t}\r\n\r\n}\r\n\r\n\r\n","import { Matrix4x4 } from \"../../maths/Matrix4x4\";\r\nimport { Vector3 } from \"../../maths/Vector3\";\r\nimport { IClone } from \"../../utils/IClone\"\r\n\r\n/**\r\n * <code>BoundBox</code> \r\n */\r\nexport class BoundBox implements IClone {\r\n\t/**@internal */\r\n\tprivate static _tempVector30: Vector3 = new Vector3();\r\n\t/**@internal */\r\n\tprivate static _tempVector31: Vector3 = new Vector3();\r\n\r\n\t/***/\r\n\tmin: Vector3;\r\n\t/***/\r\n\tmax: Vector3;\r\n\r\n\t/**\r\n\t *  <code>BoundBox</code> \r\n\t * @param\tmin \r\n\t * @param\tmax \r\n\t */\r\n\tconstructor(min: Vector3, max: Vector3) {\r\n\t\tthis.min = min;\r\n\t\tthis.max = max;\r\n\t}\r\n\r\n\t/**\r\n\t * @internal\r\n\t */\r\n\tprivate _rotateExtents(extents: Vector3, rotation: Matrix4x4, out: Vector3): void {\r\n\t\tvar extentsX: number = extents.x;\r\n\t\tvar extentsY: number = extents.y;\r\n\t\tvar extentsZ: number = extents.z;\r\n\t\tvar matElements: Float32Array = rotation.elements;\r\n\t\tout.x = Math.abs(matElements[0] * extentsX) + Math.abs(matElements[4] * extentsY) + Math.abs(matElements[8] * extentsZ);\r\n\t\tout.y = Math.abs(matElements[1] * extentsX) + Math.abs(matElements[5] * extentsY) + Math.abs(matElements[9] * extentsZ);\r\n\t\tout.z = Math.abs(matElements[2] * extentsX) + Math.abs(matElements[6] * extentsY) + Math.abs(matElements[10] * extentsZ);\r\n\t}\r\n\r\n\t/**\r\n\t * 8\r\n\t * @param\tcorners \r\n\t */\r\n\tgetCorners(corners: Vector3[]): void {\r\n\t\tcorners.length = 8;\r\n\t\tvar minX: number = this.min.x;\r\n\t\tvar minY: number = this.min.y;\r\n\t\tvar minZ: number = this.min.z;\r\n\t\tvar maxX: number = this.max.x;\r\n\t\tvar maxY: number = this.max.y;\r\n\t\tvar maxZ: number = this.max.z;\r\n\t\tcorners[0] = new Vector3(minX, maxY, maxZ);\r\n\t\tcorners[1] = new Vector3(maxX, maxY, maxZ);\r\n\t\tcorners[2] = new Vector3(maxX, minY, maxZ);\r\n\t\tcorners[3] = new Vector3(minX, minY, maxZ);\r\n\t\tcorners[4] = new Vector3(minX, maxY, minZ);\r\n\t\tcorners[5] = new Vector3(maxX, maxY, minZ);\r\n\t\tcorners[6] = new Vector3(maxX, minY, minZ);\r\n\t\tcorners[7] = new Vector3(minX, minY, minZ);\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t * @param\tout\r\n\t */\r\n\tgetCenter(out: Vector3): void {\r\n\t\tVector3.add(this.min, this.max, out);\r\n\t\tVector3.scale(out, 0.5, out);\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t * @param\tout\r\n\t */\r\n\tgetExtent(out: Vector3): void {\r\n\t\tVector3.subtract(this.max, this.min, out);\r\n\t\tVector3.scale(out, 0.5, out);\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t * @param\tcenter\r\n\t */\r\n\tsetCenterAndExtent(center: Vector3, extent: Vector3): void {\r\n\t\tVector3.subtract(center, extent, this.min);\r\n\t\tVector3.add(center, extent, this.max);\r\n\t}\r\n\r\n\t/**\r\n\t * @internal\r\n\t */\r\n\ttranform(matrix: Matrix4x4, out: BoundBox): void {\r\n\t\tvar center: Vector3 = BoundBox._tempVector30;\r\n\t\tvar extent: Vector3 = BoundBox._tempVector31;\r\n\t\tthis.getCenter(center);\r\n\t\tthis.getExtent(extent);\r\n\t\tVector3.transformCoordinate(center, matrix, center);\r\n\t\tthis._rotateExtents(extent, matrix, extent);\r\n\t\tout.setCenterAndExtent(center, extent);\r\n\t}\r\n\r\n\ttoDefault(): void {\r\n\t\tthis.min.toDefault();\r\n\t\tthis.max.toDefault();\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t * @param\tpoints \r\n\t * @param\tout \r\n\t */\r\n\tstatic createfromPoints(points: Vector3[], out: BoundBox): void {\r\n\t\tif (points == null)\r\n\t\t\tthrow new Error(\"points\");\r\n\r\n\t\tvar min: Vector3 = out.min;\r\n\t\tvar max: Vector3 = out.max;\r\n\t\tmin.x = Number.MAX_VALUE;\r\n\t\tmin.y = Number.MAX_VALUE;\r\n\t\tmin.z = Number.MAX_VALUE;\r\n\t\tmax.x = -Number.MAX_VALUE;\r\n\t\tmax.y = -Number.MAX_VALUE;\r\n\t\tmax.z = -Number.MAX_VALUE;\r\n\r\n\t\tfor (var i: number = 0, n: number = points.length; i < n; ++i) {\r\n\t\t\tVector3.min(min, points[i], min);\r\n\t\t\tVector3.max(max, points[i], max);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t * @param\tbox1 1\r\n\t * @param\tbox2 2\r\n\t * @param\tout \r\n\t */\r\n\tstatic merge(box1: BoundBox, box2: BoundBox, out: BoundBox): void {\r\n\t\tVector3.min(box1.min, box2.min, out.min);\r\n\t\tVector3.max(box1.max, box2.max, out.max);\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t * @param\tdestObject \r\n\t */\r\n\tcloneTo(destObject: BoundBox): void {\r\n\t\tvar dest: BoundBox = (<BoundBox>destObject);\r\n\t\tthis.min.cloneTo(dest.min);\r\n\t\tthis.max.cloneTo(dest.max);\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t * @return\t \r\n\t */\r\n\tclone(): any {\r\n\t\tvar dest: BoundBox = new BoundBox(new Vector3(), new Vector3());\r\n\t\tthis.cloneTo(dest);\r\n\t\treturn dest;\r\n\t}\r\n\r\n}\r\n\r\n\r\n\r\n","import { Vector2 } from \"../../../../../maths/Vector2\";\r\nimport { Vector3 } from \"../../../../../maths/Vector3\";\r\nimport { Rand } from \"../../../../math/Rand\"\r\n\r\n/**\r\n * @internal\r\n * @author ...\r\n */\r\nexport class ShapeUtils {\r\n\tstatic _randomPointUnitArcCircle(arc: number, out: Vector2, rand: Rand = null): void {\r\n\t\tvar angle: number;\r\n\t\tif (rand)\r\n\t\t\tangle = rand.getFloat() * arc;\r\n\t\telse\r\n\t\t\tangle = Math.random() * arc;\r\n\t\tout.x = Math.cos(angle);\r\n\t\tout.y = Math.sin(angle);\r\n\t}\r\n\r\n\tstatic _randomPointInsideUnitArcCircle(arc: number, out: Vector2, rand: Rand = null): void {\r\n\t\tShapeUtils._randomPointUnitArcCircle(arc, out, rand);\r\n\t\tvar range: number;\r\n\t\tif (rand)\r\n\t\t\trange = Math.pow(rand.getFloat(), 1.0 / 2.0);\r\n\t\telse\r\n\t\t\trange = Math.pow(Math.random(), 1.0 / 2.0);\r\n\t\tout.x = out.x * range;\r\n\t\tout.y = out.y * range;\r\n\t}\r\n\r\n\tstatic _randomPointUnitCircle(out: Vector2, rand: Rand = null): void {\r\n\t\tvar angle: number;\r\n\t\tif (rand)\r\n\t\t\tangle = rand.getFloat() * Math.PI * 2;\r\n\t\telse\r\n\t\t\tangle = Math.random() * Math.PI * 2;\r\n\t\tout.x = Math.cos(angle);\r\n\t\tout.y = Math.sin(angle);\r\n\t}\r\n\r\n\tstatic _randomPointInsideUnitCircle(out: Vector2, rand: Rand = null): void {\r\n\t\tShapeUtils._randomPointUnitCircle(out);\r\n\t\tvar range: number;\r\n\t\tif (rand)\r\n\t\t\trange = Math.pow(rand.getFloat(), 1.0 / 2.0);\r\n\t\telse\r\n\t\t\trange = Math.pow(Math.random(), 1.0 / 2.0);\r\n\t\tout.x = out.x * range;\r\n\t\tout.y = out.y * range;\r\n\t}\r\n\r\n\tstatic _randomPointUnitSphere(out: Vector3, rand: Rand = null): void {\r\n\t\tvar z: number;\r\n\t\tvar a: number;\r\n\t\tif (rand) {\r\n\t\t\tz = out.z = rand.getFloat() * 2 - 1.0;\r\n\t\t\ta = rand.getFloat() * Math.PI * 2;\r\n\t\t} else {\r\n\t\t\tz = out.z = Math.random() * 2 - 1.0;\r\n\t\t\ta = Math.random() * Math.PI * 2;\r\n\t\t}\r\n\r\n\t\tvar r: number = Math.sqrt(1.0 - z * z);\r\n\r\n\t\tout.x = r * Math.cos(a);\r\n\t\tout.y = r * Math.sin(a);\r\n\t}\r\n\r\n\tstatic _randomPointInsideUnitSphere(out: Vector3, rand: Rand = null): void {\r\n\t\t;\r\n\t\tShapeUtils._randomPointUnitSphere(out);\r\n\t\tvar range: number;\r\n\t\tif (rand)\r\n\t\t\trange = Math.pow(rand.getFloat(), 1.0 / 3.0);\r\n\t\telse\r\n\t\t\trange = Math.pow(Math.random(), 1.0 / 3.0);\r\n\t\tout.x = out.x * range;\r\n\t\tout.y = out.y * range;\r\n\t\tout.z = out.z * range;\r\n\t}\r\n\r\n\tstatic _randomPointInsideHalfUnitBox(out: Vector3, rand: Rand = null): void {\r\n\t\tif (rand) {\r\n\t\t\tout.x = (rand.getFloat() - 0.5);\r\n\t\t\tout.y = (rand.getFloat() - 0.5);\r\n\t\t\tout.z = (rand.getFloat() - 0.5);\r\n\t\t} else {\r\n\t\t\tout.x = (Math.random() - 0.5);\r\n\t\t\tout.y = (Math.random() - 0.5);\r\n\t\t\tout.z = (Math.random() - 0.5);\r\n\t\t}\r\n\t}\r\n\r\n\tconstructor() {\r\n\t}\r\n\r\n}\r\n\r\n\r\n","import { BaseShape, ParticleSystemShapeType } from \"./BaseShape\";\r\nimport { ShapeUtils } from \"./ShapeUtils\";\r\nimport { BoundBox } from \"../../../../math/BoundBox\"\r\nimport { Rand } from \"../../../../math/Rand\"\r\nimport { Vector3 } from \"../../../../../maths/Vector3\";\r\n\r\n/**\r\n * <code>BoxShape</code> \r\n */\r\nexport class BoxShape extends BaseShape {\r\n\t/**X*/\r\n\tx: number;\r\n\t/**Y*/\r\n\ty: number;\r\n\t/**Z*/\r\n\tz: number;\r\n\r\n\t/**\r\n\t *  <code>BoxShape</code> \r\n\t */\r\n\tconstructor() {\r\n\t\tsuper();\r\n\t\tthis.shapeType = ParticleSystemShapeType.Box;\r\n\t\tthis.x = 1.0;\r\n\t\tthis.y = 1.0;\r\n\t\tthis.z = 1.0;\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t * @override\r\n\t * @internal\r\n\t */\r\n\tprotected _getShapeBoundBox(boundBox: BoundBox): void {\r\n\t\tvar min: Vector3 = boundBox.min;\r\n\t\tmin.x = -this.x * 0.5;\r\n\t\tmin.y = -this.y * 0.5;\r\n\t\tmin.z = -this.z * 0.5;\r\n\t\tvar max: Vector3 = boundBox.max;\r\n\t\tmax.x = this.x * 0.5;\r\n\t\tmax.y = this.y * 0.5;\r\n\t\tmax.z = this.z * 0.5;\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t * @override\r\n\t * @internal\r\n\t */\r\n\tprotected _getSpeedBoundBox(boundBox: BoundBox): void {\r\n\t\tvar min: Vector3 = boundBox.min;\r\n\t\tmin.x = 0.0;\r\n\t\tmin.y = 0.0;\r\n\t\tmin.z = 0.0;\r\n\t\tvar max: Vector3 = boundBox.max;\r\n\t\tmax.x = 0.0;\r\n\t\tmax.y = 1.0;\r\n\t\tmax.z = 0.0;\r\n\t}\r\n\r\n\t/**\r\n\t *  \r\n\t * @param\tposition \r\n\t * @param\tdirection \r\n\t * @override\r\n\t */\r\n\tgeneratePositionAndDirection(position: Vector3, direction: Vector3, rand: Rand = null, randomSeeds: Uint32Array = null): void {\r\n\t\tif (rand) {\r\n\t\t\trand.seed = randomSeeds[16];\r\n\t\t\tShapeUtils._randomPointInsideHalfUnitBox(position, rand);\r\n\t\t\trandomSeeds[16] = rand.seed;\r\n\t\t} else {\r\n\t\t\tShapeUtils._randomPointInsideHalfUnitBox(position);\r\n\t\t}\r\n\t\tposition.x = this.x * position.x;\r\n\t\tposition.y = this.y * position.y;\r\n\t\tposition.z = this.z * position.z;\r\n\t\tif (this.randomDirection) {\r\n\t\t\tif (rand) {\r\n\t\t\t\trand.seed = randomSeeds[17];\r\n\t\t\t\tShapeUtils._randomPointUnitSphere(direction, rand);\r\n\t\t\t\trandomSeeds[17] = rand.seed;\r\n\t\t\t} else {\r\n\t\t\t\tShapeUtils._randomPointUnitSphere(direction);\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tdirection.x = 0.0;\r\n\t\t\tdirection.y = 0.0;\r\n\t\t\tdirection.z = 1.0;\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @param destObject \r\n\t * @override\r\n\t */\r\n\tcloneTo(destObject: any): void {\r\n\t\tsuper.cloneTo(destObject);\r\n\t\tvar destShape: BoxShape = (<BoxShape>destObject);\r\n\t\tdestShape.x = this.x;\r\n\t\tdestShape.y = this.y;\r\n\t\tdestShape.z = this.z;\r\n\t\tdestShape.randomDirection = this.randomDirection;\r\n\t}\r\n\r\n\t/**\r\n\t * @override\r\n\t * \r\n\t * @return\t \r\n\t */\r\n\tclone(): any {\r\n\t\tvar destShape: BoxShape = new BoxShape();\r\n\t\tthis.cloneTo(destShape);\r\n\t\treturn destShape;\r\n\t}\r\n\r\n}\r\n\r\n\r\n","import { BaseShape, ParticleSystemShapeType } from \"./BaseShape\";\r\nimport { ShapeUtils } from \"./ShapeUtils\";\r\nimport { BoundBox } from \"../../../../math/BoundBox\"\r\nimport { Rand } from \"../../../../math/Rand\"\r\nimport { Vector2 } from \"../../../../../maths/Vector2\";\r\nimport { Vector3 } from \"../../../../../maths/Vector3\";\r\n\r\n/**\r\n * <code>CircleShape</code> \r\n */\r\nexport class CircleShape extends BaseShape {\r\n\t/** @internal */\r\n\tprotected static _tempPositionPoint: Vector2 = new Vector2();\r\n\r\n\t/***/\r\n\tradius: number;\r\n\t/***/\r\n\tarc: number;\r\n\t/***/\r\n\temitFromEdge: boolean;\r\n\r\n\t/**\r\n\t *  <code>CircleShape</code> \r\n\t */\r\n\tconstructor() {\r\n\t\tsuper();\r\n\t\tthis.shapeType = ParticleSystemShapeType.Circle;\r\n\t\tthis.radius = 1.0;\r\n\t\tthis.arc = 360.0 / 180.0 * Math.PI;\r\n\t\tthis.emitFromEdge = false;\r\n\t}\r\n\r\n\t/**\r\n\t * 0-360\r\n\t */\r\n\tset arcDEG(deg: number) {\r\n\t\tthis.arc = deg / 180 * Math.PI;\r\n\t}\r\n\r\n\tget arcDEG() {\r\n\t\treturn this.arc * 180 / Math.PI;\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t * @override\r\n\t * @internal\r\n\t */\r\n\tprotected _getShapeBoundBox(boundBox: BoundBox): void {\r\n\t\tvar min: Vector3 = boundBox.min;\r\n\t\tmin.x = min.z = -this.radius;\r\n\t\tmin.y = 0;\r\n\t\tvar max: Vector3 = boundBox.max;\r\n\t\tmax.x = max.z = this.radius;\r\n\t\tmax.y = 0;\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t * @override\r\n\t * @internal\r\n\t */\r\n\tprotected _getSpeedBoundBox(boundBox: BoundBox): void {\r\n\t\tvar min: Vector3 = boundBox.min;\r\n\t\tmin.x = min.y = -1;\r\n\t\tmin.z = 0;\r\n\t\tvar max: Vector3 = boundBox.max;\r\n\t\tmax.x = max.y = 1;\r\n\t\tmax.z = 0;\r\n\t}\r\n\r\n\t/**\r\n\t *  \r\n\t * @param\tposition \r\n\t * @param\tdirection \r\n\t * @override\r\n\t */\r\n\tgeneratePositionAndDirection(position: Vector3, direction: Vector3, rand: Rand = null, randomSeeds: Uint32Array = null): void {\r\n\t\tvar positionPoint: Vector2 = CircleShape._tempPositionPoint;\r\n\t\tif (rand) {\r\n\t\t\trand.seed = randomSeeds[16];\r\n\t\t\tif (this.emitFromEdge)\r\n\t\t\t\tShapeUtils._randomPointUnitArcCircle(this.arc, CircleShape._tempPositionPoint, rand);\r\n\t\t\telse\r\n\t\t\t\tShapeUtils._randomPointInsideUnitArcCircle(this.arc, CircleShape._tempPositionPoint, rand);\r\n\t\t\trandomSeeds[16] = rand.seed;\r\n\t\t} else {\r\n\t\t\tif (this.emitFromEdge)\r\n\t\t\t\tShapeUtils._randomPointUnitArcCircle(this.arc, CircleShape._tempPositionPoint);\r\n\t\t\telse\r\n\t\t\t\tShapeUtils._randomPointInsideUnitArcCircle(this.arc, CircleShape._tempPositionPoint);\r\n\t\t}\r\n\r\n\t\tposition.x = -positionPoint.x;\r\n\t\tposition.y = positionPoint.y;\r\n\t\tposition.z = 0;\r\n\r\n\t\tVector3.scale(position, this.radius, position);\r\n\r\n\t\tif (this.randomDirection) {\r\n\t\t\tif (rand) {\r\n\t\t\t\trand.seed = randomSeeds[17];\r\n\t\t\t\tShapeUtils._randomPointUnitSphere(direction, rand);\r\n\t\t\t\trandomSeeds[17] = rand.seed;\r\n\t\t\t} else {\r\n\t\t\t\tShapeUtils._randomPointUnitSphere(direction);\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tposition.cloneTo(direction);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @param destObject \r\n\t * @override\r\n\t */\r\n\tcloneTo(destObject: any): void {\r\n\t\tsuper.cloneTo(destObject);\r\n\t\tvar destShape: CircleShape = (<CircleShape>destObject);\r\n\t\tdestShape.radius = this.radius;\r\n\t\tdestShape.arc = this.arc;\r\n\t\tdestShape.emitFromEdge = this.emitFromEdge;\r\n\t\tdestShape.randomDirection = this.randomDirection;\r\n\t}\r\n\r\n\t/**\r\n\t * @override\r\n\t * \r\n\t * @return\t \r\n\t */\r\n\tclone(): any {\r\n\t\tvar destShape: CircleShape = new CircleShape();\r\n\t\tthis.cloneTo(destShape);\r\n\t\treturn destShape;\r\n\t}\r\n\r\n}\r\n\r\n\r\n","import { BaseShape, ParticleSystemShapeType } from \"./BaseShape\";\r\nimport { ShapeUtils } from \"./ShapeUtils\";\r\nimport { BoundBox } from \"../../../../math/BoundBox\"\r\nimport { Rand } from \"../../../../math/Rand\"\r\nimport { Vector2 } from \"../../../../../maths/Vector2\";\r\nimport { Vector3 } from \"../../../../../maths/Vector3\";\r\n\r\n/**\r\n * <code>ConeShape</code> \r\n */\r\nexport class ConeShape extends BaseShape {\r\n\t/** @internal */\r\n\tprotected static _tempPositionPoint: Vector2 = new Vector2();\r\n\t/** @internal */\r\n\tprotected static _tempDirectionPoint: Vector2 = new Vector2();\r\n\r\n\t/***/\r\n\tangle: number;\r\n\t/***/\r\n\tradius: number;\r\n\t/***/\r\n\tlength: number;\r\n\t/**,0Base,1BaseShell,2Volume,3VolumeShell*/\r\n\temitType: number;\r\n\r\n\t/**\r\n\t *  <code>ConeShape</code> \r\n\t */\r\n\tconstructor() {\r\n\t\tsuper();\r\n\t\tthis.shapeType = ParticleSystemShapeType.Cone;\r\n\t\tthis.angle = 25.0 / 180.0 * Math.PI;\r\n\t\tthis.radius = 1.0;\r\n\t\tthis.length = 5.0;\r\n\t\tthis.emitType = 0;\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * 0-360\r\n\t */\r\n\tset angleDEG(deg: number) {\r\n\t\tthis.angle = deg / 180 * Math.PI;\r\n\t}\r\n\r\n\tget angleDEG(){\r\n\t\treturn this.angle*180/Math.PI;\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t * @override\r\n\t * @internal\r\n\t */\r\n\tprotected _getShapeBoundBox(boundBox: BoundBox): void {\r\n\t\tconst coneRadius2: number = this.radius + this.length * Math.sin(this.angle);\r\n\t\tconst coneLength: number = this.length * Math.cos(this.angle);\r\n\r\n\t\tvar min: Vector3 = boundBox.min;\r\n\t\tmin.x = min.y = -coneRadius2;\r\n\t\tmin.z = 0;\r\n\r\n\t\tvar max: Vector3 = boundBox.max;\r\n\t\tmax.x = max.y = coneRadius2;\r\n\t\tmax.z = coneLength;//TODO:\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t * @override\r\n\t * @internal\r\n\t */\r\n\tprotected _getSpeedBoundBox(boundBox: BoundBox): void {\r\n\t\tconst sinA: number = Math.sin(this.angle);\r\n\t\tvar min: Vector3 = boundBox.min;\r\n\t\tmin.x = min.y = -sinA;\r\n\t\tmin.z = 0;\r\n\t\tvar max: Vector3 = boundBox.max;\r\n\t\tmax.x = max.y = sinA;\r\n\t\tmax.z = 1;\r\n\t}\r\n\r\n\t/**\r\n\t *  \r\n\t * @param\tposition \r\n\t * @param\tdirection \r\n\t * @override\r\n\t */\r\n\tgeneratePositionAndDirection(position: Vector3, direction: Vector3, rand: Rand = null, randomSeeds: Uint32Array = null): void {\r\n\t\tvar positionPointE: Vector2 = ConeShape._tempPositionPoint;\r\n\t\tvar positionX: number;\r\n\t\tvar positionY: number;\r\n\t\tvar directionPointE: Vector2;\r\n\r\n\t\tvar dirCosA: number = Math.cos(this.angle);\r\n\t\tvar dirSinA: number = Math.sin(this.angle);\r\n\t\tswitch (this.emitType) {\r\n\t\t\tcase 0:\r\n\t\t\t\tif (rand) {\r\n\t\t\t\t\trand.seed = randomSeeds[16];\r\n\t\t\t\t\tShapeUtils._randomPointInsideUnitCircle(ConeShape._tempPositionPoint, rand);\r\n\t\t\t\t\trandomSeeds[16] = rand.seed;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tShapeUtils._randomPointInsideUnitCircle(ConeShape._tempPositionPoint);\r\n\t\t\t\t}\r\n\t\t\t\tpositionX = positionPointE.x;\r\n\t\t\t\tpositionY = positionPointE.y;\r\n\t\t\t\tposition.x = positionX * this.radius;\r\n\t\t\t\tposition.y = positionY * this.radius;\r\n\t\t\t\tposition.z = 0;\r\n\r\n\t\t\t\tif (this.randomDirection) {\r\n\t\t\t\t\tif (rand) {\r\n\t\t\t\t\t\trand.seed = randomSeeds[17];\r\n\t\t\t\t\t\tShapeUtils._randomPointInsideUnitCircle(ConeShape._tempDirectionPoint, rand);\r\n\t\t\t\t\t\trandomSeeds[17] = rand.seed;\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tShapeUtils._randomPointInsideUnitCircle(ConeShape._tempDirectionPoint);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tdirectionPointE = ConeShape._tempDirectionPoint;\r\n\t\t\t\t\tdirection.x = directionPointE.x * dirSinA;\r\n\t\t\t\t\tdirection.y = directionPointE.y * dirSinA;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tdirection.x = positionX * dirSinA;\r\n\t\t\t\t\tdirection.y = positionY * dirSinA;\r\n\t\t\t\t}\r\n\t\t\t\tdirection.z = dirCosA;\r\n\t\t\t\tbreak;\r\n\t\t\tcase 1:\r\n\t\t\t\tif (rand) {\r\n\t\t\t\t\trand.seed = randomSeeds[16];\r\n\t\t\t\t\tShapeUtils._randomPointUnitCircle(ConeShape._tempPositionPoint, rand);\r\n\t\t\t\t\trandomSeeds[16] = rand.seed;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tShapeUtils._randomPointUnitCircle(ConeShape._tempPositionPoint);\r\n\t\t\t\t}\r\n\t\t\t\tpositionX = positionPointE.x;\r\n\t\t\t\tpositionY = positionPointE.y;\r\n\t\t\t\tposition.x = positionX * this.radius;\r\n\t\t\t\tposition.y = positionY * this.radius;\r\n\t\t\t\tposition.z = 0;\r\n\r\n\t\t\t\tif (this.randomDirection) {\r\n\t\t\t\t\tif (rand) {\r\n\t\t\t\t\t\trand.seed = randomSeeds[17];\r\n\t\t\t\t\t\tShapeUtils._randomPointInsideUnitCircle(ConeShape._tempDirectionPoint, rand);\r\n\t\t\t\t\t\trandomSeeds[17] = rand.seed;\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tShapeUtils._randomPointInsideUnitCircle(ConeShape._tempDirectionPoint);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tdirectionPointE = ConeShape._tempDirectionPoint;\r\n\t\t\t\t\tdirection.x = directionPointE.x * dirSinA;\r\n\t\t\t\t\tdirection.y = directionPointE.y * dirSinA;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tdirection.x = positionX * dirSinA;\r\n\t\t\t\t\tdirection.y = positionY * dirSinA;\r\n\t\t\t\t}\r\n\t\t\t\tdirection.z = dirCosA;\r\n\t\t\t\tbreak;\r\n\t\t\tcase 2:\r\n\t\t\t\tif (rand) {\r\n\t\t\t\t\trand.seed = randomSeeds[16];\r\n\t\t\t\t\tShapeUtils._randomPointInsideUnitCircle(ConeShape._tempPositionPoint, rand);\r\n\r\n\t\t\t\t} else {\r\n\t\t\t\t\tShapeUtils._randomPointInsideUnitCircle(ConeShape._tempPositionPoint);\r\n\t\t\t\t}\r\n\t\t\t\tpositionX = positionPointE.x;\r\n\t\t\t\tpositionY = positionPointE.y;\r\n\t\t\t\tposition.x = positionX * this.radius;\r\n\t\t\t\tposition.y = positionY * this.radius;\r\n\t\t\t\tposition.z = 0;\r\n\r\n\t\t\t\tdirection.x = positionX * dirSinA;\r\n\t\t\t\tdirection.y = positionY * dirSinA;\r\n\t\t\t\tdirection.z = dirCosA;\r\n\r\n\t\t\t\tVector3.normalize(direction, direction);\r\n\t\t\t\tif (rand) {\r\n\t\t\t\t\tVector3.scale(direction, this.length * rand.getFloat(), direction);\r\n\t\t\t\t\trandomSeeds[16] = rand.seed;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tVector3.scale(direction, this.length * Math.random(), direction);\r\n\t\t\t\t}\r\n\t\t\t\tVector3.add(position, direction, position);\r\n\r\n\t\t\t\tif (this.randomDirection) {\r\n\t\t\t\t\tif (rand) {\r\n\t\t\t\t\t\trand.seed = randomSeeds[17];\r\n\t\t\t\t\t\tShapeUtils._randomPointUnitSphere(direction, rand);\r\n\t\t\t\t\t\trandomSeeds[17] = rand.seed;\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tShapeUtils._randomPointUnitSphere(direction);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\tbreak;\r\n\t\t\tcase 3:\r\n\t\t\t\tif (rand) {\r\n\t\t\t\t\trand.seed = randomSeeds[16];\r\n\t\t\t\t\tShapeUtils._randomPointUnitCircle(ConeShape._tempPositionPoint, rand);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tShapeUtils._randomPointUnitCircle(ConeShape._tempPositionPoint);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tpositionX = positionPointE.x;\r\n\t\t\t\tpositionY = positionPointE.y;\r\n\t\t\t\tposition.x = positionX * this.radius;\r\n\t\t\t\tposition.y = positionY * this.radius;\r\n\t\t\t\tposition.z = 0;\r\n\r\n\t\t\t\tdirection.x = positionX * dirSinA;\r\n\t\t\t\tdirection.y = positionY * dirSinA;\r\n\t\t\t\tdirection.z = dirCosA;\r\n\r\n\t\t\t\tVector3.normalize(direction, direction);\r\n\t\t\t\tif (rand) {\r\n\t\t\t\t\tVector3.scale(direction, this.length * rand.getFloat(), direction);\r\n\t\t\t\t\trandomSeeds[16] = rand.seed;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tVector3.scale(direction, this.length * Math.random(), direction);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tVector3.add(position, direction, position);\r\n\r\n\t\t\t\tif (this.randomDirection) {\r\n\t\t\t\t\tif (rand) {\r\n\t\t\t\t\t\trand.seed = randomSeeds[17];\r\n\t\t\t\t\t\tShapeUtils._randomPointUnitSphere(direction, rand);\r\n\t\t\t\t\t\trandomSeeds[17] = rand.seed;\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tShapeUtils._randomPointUnitSphere(direction);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\tbreak;\r\n\t\t\tdefault:\r\n\t\t\t\tthrow new Error(\"ConeShape:emitType is invalid.\");\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @override\r\n\t */\r\n\tcloneTo(destObject: any): void {\r\n\t\tsuper.cloneTo(destObject);\r\n\t\tvar destShape: ConeShape = (<ConeShape>destObject);\r\n\t\tdestShape.angle = this.angle;\r\n\t\tdestShape.radius = this.radius;\r\n\t\tdestShape.length = this.length;\r\n\t\tdestShape.emitType = this.emitType;\r\n\t\tdestShape.randomDirection = this.randomDirection;\r\n\t}\r\n\r\n\t/**\r\n\t * @override\r\n\t * \r\n\t * @return\t \r\n\t */\r\n\tclone(): any {\r\n\t\tvar destShape: ConeShape = new ConeShape();\r\n\t\tthis.cloneTo(destShape);\r\n\t\treturn destShape;\r\n\t}\r\n\r\n}\r\n\r\n\r\n","import { BaseShape, ParticleSystemShapeType } from \"./BaseShape\";\r\nimport { ShapeUtils } from \"./ShapeUtils\";\r\nimport { BoundBox } from \"../../../../math/BoundBox\"\r\nimport { Rand } from \"../../../../math/Rand\"\r\nimport { Vector3 } from \"../../../../../maths/Vector3\";\r\n\r\n\r\n/**\r\n * <code>HemisphereShape</code> \r\n */\r\nexport class HemisphereShape extends BaseShape {\r\n\t/***/\r\n\tradius: number;\r\n\t/***/\r\n\temitFromShell: boolean;\r\n\r\n\t/**\r\n\t *  <code>HemisphereShape</code> \r\n\t */\r\n\tconstructor() {\r\n\t\tsuper();\r\n\t\tthis.shapeType = ParticleSystemShapeType.Hemisphere;\r\n\t\tthis.radius = 1.0;\r\n\t\tthis.emitFromShell = false;\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t * @override\r\n\t * @internal\r\n\t */\r\n\tprotected _getShapeBoundBox(boundBox: BoundBox): void {\r\n\t\tvar min: Vector3 = boundBox.min;\r\n\t\tmin.x = min.y = min.z = -this.radius;\r\n\t\tvar max: Vector3 = boundBox.max;\r\n\t\tmax.x = max.y = this.radius;\r\n\t\tmax.z = 0;\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t * @override\r\n\t * @internal\r\n\t */\r\n\tprotected _getSpeedBoundBox(boundBox: BoundBox): void {\r\n\t\tvar min: Vector3 = boundBox.min;\r\n\t\tmin.x = min.y = -1;\r\n\t\tmin.z = 0;\r\n\t\tvar max: Vector3 = boundBox.max;\r\n\t\tmax.x = max.y = max.z = 1;\r\n\t}\r\n\r\n\t/**\r\n\t *  \r\n\t * @param\tposition \r\n\t * @param\tdirection \r\n\t * @override\r\n\t */\r\n\tgeneratePositionAndDirection(position: Vector3, direction: Vector3, rand: Rand = null, randomSeeds: Uint32Array = null): void {\r\n\t\tif (rand) {\r\n\t\t\trand.seed = randomSeeds[16];\r\n\t\t\tif (this.emitFromShell)\r\n\t\t\t\tShapeUtils._randomPointUnitSphere(position, rand);\r\n\t\t\telse\r\n\t\t\t\tShapeUtils._randomPointInsideUnitSphere(position, rand);\r\n\t\t\trandomSeeds[16] = rand.seed;\r\n\t\t} else {\r\n\t\t\tif (this.emitFromShell)\r\n\t\t\t\tShapeUtils._randomPointUnitSphere(position);\r\n\t\t\telse\r\n\t\t\t\tShapeUtils._randomPointInsideUnitSphere(position);\r\n\t\t}\r\n\r\n\t\tVector3.scale(position, this.radius, position);\r\n\r\n\t\tvar z: number = position.z;\r\n\t\t(z < 0.0) && (position.z = z * -1.0);\r\n\r\n\t\tif (this.randomDirection) {\r\n\t\t\tif (rand) {\r\n\t\t\t\trand.seed = randomSeeds[17];\r\n\t\t\t\tShapeUtils._randomPointUnitSphere(direction, rand);\r\n\t\t\t\trandomSeeds[17] = rand.seed;\r\n\t\t\t} else {\r\n\t\t\t\tShapeUtils._randomPointUnitSphere(direction);\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tposition.cloneTo(direction);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @override\r\n\t */\r\n\tcloneTo(destObject: any): void {\r\n\t\tsuper.cloneTo(destObject);\r\n\t\tvar destShape: HemisphereShape = (<HemisphereShape>destObject);\r\n\t\tdestShape.radius = this.radius;\r\n\t\tdestShape.emitFromShell = this.emitFromShell;\r\n\t\tdestShape.randomDirection = this.randomDirection;\r\n\t}\r\n\r\n\t/**\r\n\t * @override\r\n\t * \r\n\t * @return\t \r\n\t */\r\n\tclone(): any {\r\n\t\tvar destShape: HemisphereShape = new HemisphereShape();\r\n\t\tthis.cloneTo(destShape);\r\n\t\treturn destShape;\r\n\t}\r\n\r\n}\r\n\r\n\r\n","import { BaseShape, ParticleSystemShapeType } from \"./BaseShape\";\r\nimport { ShapeUtils } from \"./ShapeUtils\";\r\nimport { BoundBox } from \"../../../../math/BoundBox\"\r\nimport { Rand } from \"../../../../math/Rand\"\r\nimport { Vector3 } from \"../../../../../maths/Vector3\";\r\n\r\n/**\r\n * <code>SphereShape</code> \r\n */\r\nexport class SphereShape extends BaseShape {\r\n\t/***/\r\n\tradius: number;\r\n\t/***/\r\n\temitFromShell: boolean;\r\n\r\n\t/**\r\n\t *  <code>SphereShape</code> \r\n\t */\r\n\tconstructor() {\r\n\t\tsuper();\r\n\t\tthis.shapeType = ParticleSystemShapeType.Sphere;\r\n\t\tthis.radius = 1.0;\r\n\t\tthis.emitFromShell = false;\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t * @override\r\n\t * @internal\r\n\t */\r\n\tprotected _getShapeBoundBox(boundBox: BoundBox): void {\r\n\t\tvar min: Vector3 = boundBox.min;\r\n\t\tmin.x = min.y = min.z = -this.radius;\r\n\t\tvar max: Vector3 = boundBox.max;\r\n\t\tmax.x = max.y = max.z = this.radius;\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t * @override\r\n\t * @internal\r\n\t */\r\n\tprotected _getSpeedBoundBox(boundBox: BoundBox): void {\r\n\t\tvar min: Vector3 = boundBox.min;\r\n\t\tmin.x = min.y = min.z = -1;\r\n\t\tvar max: Vector3 = boundBox.max;\r\n\t\tmax.x = max.y = max.z = 1;\r\n\t}\r\n\r\n\t/**\r\n\t *  \r\n\t * @param\tposition \r\n\t * @param\tdirection \r\n\t * @override\r\n\t */\r\n\tgeneratePositionAndDirection(position: Vector3, direction: Vector3, rand: Rand = null, randomSeeds: Uint32Array = null): void {\r\n\t\tif (rand) {\r\n\t\t\trand.seed = randomSeeds[16];\r\n\t\t\tif (this.emitFromShell)\r\n\t\t\t\tShapeUtils._randomPointUnitSphere(position, rand);\r\n\t\t\telse\r\n\t\t\t\tShapeUtils._randomPointInsideUnitSphere(position, rand);\r\n\t\t\trandomSeeds[16] = rand.seed;\r\n\t\t} else {\r\n\t\t\tif (this.emitFromShell)\r\n\t\t\t\tShapeUtils._randomPointUnitSphere(position);\r\n\t\t\telse\r\n\t\t\t\tShapeUtils._randomPointInsideUnitSphere(position);\r\n\t\t}\r\n\r\n\t\tVector3.scale(position, this.radius, position);\r\n\r\n\t\tif (this.randomDirection) {\r\n\t\t\tif (rand) {\r\n\t\t\t\trand.seed = randomSeeds[17];\r\n\t\t\t\tShapeUtils._randomPointUnitSphere(direction, rand);\r\n\t\t\t\trandomSeeds[17] = rand.seed;\r\n\t\t\t} else {\r\n\t\t\t\tShapeUtils._randomPointUnitSphere(direction);\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tposition.cloneTo(direction);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @override\r\n\t */\r\n\tcloneTo(destObject: any): void {\r\n\t\tsuper.cloneTo(destObject);\r\n\t\tvar destShape: SphereShape = (<SphereShape>destObject);\r\n\t\tdestShape.radius = this.radius;\r\n\t\tdestShape.emitFromShell = this.emitFromShell;\r\n\t\tdestShape.randomDirection = this.randomDirection;\r\n\t}\r\n\r\n\t/**\r\n\t * @override\r\n\t * \r\n\t * @return\t \r\n\t */\r\n\tclone(): any {\r\n\t\tvar destShape: SphereShape = new SphereShape();\r\n\t\tthis.cloneTo(destShape);\r\n\t\treturn destShape;\r\n\t}\r\n}\r\n\r\n\r\n","import { GradientSize } from \"./GradientSize\";\r\nimport { IClone } from \"../../../../utils/IClone\"\r\n\r\n/**\r\n * <code>SizeOverLifetime</code> \r\n */\r\nexport class SizeOverLifetime implements IClone {\r\n\tprivate _size: GradientSize;\r\n\r\n\t/***/\r\n\tenable: boolean;\r\n\r\n\t/**\r\n\t *\r\n\t */\r\n\tget size(): GradientSize {\r\n\t\treturn this._size;\r\n\t}\r\n\r\n\t/**\r\n\t *  <code>SizeOverLifetime</code> \r\n\t */\r\n\tconstructor(size: GradientSize) {\r\n\t\tthis._size = size;\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t * @param\tdestObject \r\n\t */\r\n\tcloneTo(destObject: any): void {\r\n\t\tvar destSizeOverLifetime: SizeOverLifetime = (<SizeOverLifetime>destObject);\r\n\t\tthis._size.cloneTo(destSizeOverLifetime._size);\r\n\t\tdestSizeOverLifetime.enable = this.enable;\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t * @return\t \r\n\t */\r\n\tclone(): any {\r\n\t\tvar destSize: GradientSize;\r\n\t\tswitch (this._size.type) {\r\n\t\t\tcase 0:\r\n\t\t\t\tif (this._size.separateAxes)\r\n\t\t\t\t\tdestSize = GradientSize.createByGradientSeparate(this._size.gradientX.clone(), this._size.gradientY.clone(), this._size.gradientZ.clone());\r\n\t\t\t\telse\r\n\t\t\t\t\tdestSize = GradientSize.createByGradient(this._size.gradient.clone());\r\n\t\t\t\tbreak;\r\n\t\t\tcase 1:\r\n\t\t\t\tif (this._size.separateAxes)\r\n\t\t\t\t\tdestSize = GradientSize.createByRandomTwoConstantSeparate(this._size.constantMinSeparate.clone(), this._size.constantMaxSeparate.clone());\r\n\t\t\t\telse\r\n\t\t\t\t\tdestSize = GradientSize.createByRandomTwoConstant(this._size.constantMin, this._size.constantMax);\r\n\t\t\t\tbreak;\r\n\t\t\tcase 2:\r\n\t\t\t\tif (this._size.separateAxes)\r\n\t\t\t\t\tdestSize = GradientSize.createByRandomTwoGradientSeparate(this._size.gradientXMin.clone(), this._size.gradientYMin.clone(), this._size.gradientZMin.clone(), this._size.gradientXMax.clone(), this._size.gradientYMax.clone(), this._size.gradientZMax.clone());\r\n\t\t\t\telse\r\n\t\t\t\t\tdestSize = GradientSize.createByRandomTwoGradient(this._size.gradientMin.clone(), this._size.gradientMax.clone());\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\r\n\t\tvar destSizeOverLifetime: SizeOverLifetime = new SizeOverLifetime(destSize);\r\n\t\tdestSizeOverLifetime.enable = this.enable;\r\n\t\treturn destSizeOverLifetime;\r\n\t}\r\n\r\n}\r\n\r\n\r\n","import { IClone } from \"../../../../utils/IClone\"\r\n\r\n/**\r\n * <code>StartFrame</code> \r\n */\r\nexport class StartFrame implements IClone {\r\n\t/**\r\n\t *  <code>StartFrame</code> \r\n\t * @param\tconstant  \r\n\t * @return \r\n\t */\r\n\tstatic createByConstant(constant: number = 0): StartFrame {\r\n\t\tvar rotationOverLifetime: StartFrame = new StartFrame();\r\n\t\trotationOverLifetime._type = 0;\r\n\t\trotationOverLifetime._constant = constant;\r\n\t\treturn rotationOverLifetime;\r\n\t}\r\n\r\n\t/**\r\n\t *   <code>StartFrame</code> \r\n\t * @param\tconstantMin \r\n\t * @param\tconstantMax \r\n\t * @return \r\n\t */\r\n\tstatic createByRandomTwoConstant(constantMin: number = 0, constantMax: number = 0): StartFrame {\r\n\t\tvar rotationOverLifetime: StartFrame = new StartFrame();\r\n\t\trotationOverLifetime._type = 1;\r\n\t\trotationOverLifetime._constantMin = constantMin;\r\n\t\trotationOverLifetime._constantMax = constantMax;\r\n\t\treturn rotationOverLifetime;\r\n\t}\r\n\r\n\r\n\tprivate _type: number = 0;\r\n\tprivate _constant: number = 0;\r\n\tprivate _constantMin: number = 0;\r\n\tprivate _constantMax: number = 0;\r\n\r\n\t/**\r\n\t *,01\r\n\t */\r\n\tget type(): number {\r\n\t\treturn this._type;\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t */\r\n\tget constant(): number {\r\n\t\treturn this._constant;\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t */\r\n\tget constantMin(): number {\r\n\t\treturn this._constantMin;\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t */\r\n\tget constantMax(): number {\r\n\t\treturn this._constantMax;\r\n\t}\r\n\r\n\t/**\r\n\t *  <code>StartFrame,new</code> \r\n\t */\r\n\tconstructor() {\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t * @param\tdestObject \r\n\t */\r\n\tcloneTo(destObject: any): void {\r\n\t\tvar destStartFrame: StartFrame = (<StartFrame>destObject);\r\n\t\tdestStartFrame._type = this._type;\r\n\t\tdestStartFrame._constant = this._constant;\r\n\t\tdestStartFrame._constantMin = this._constantMin;\r\n\t\tdestStartFrame._constantMax = this._constantMax;\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t * @return\t \r\n\t */\r\n\tclone(): any {\r\n\t\tvar destStartFrame: StartFrame = new StartFrame();\r\n\t\tthis.cloneTo(destStartFrame);\r\n\t\treturn destStartFrame;\r\n\t}\r\n\r\n}\r\n\r\n\r\n","import { FrameOverTime } from \"./FrameOverTime\";\r\nimport { StartFrame } from \"./StartFrame\";\r\nimport { IClone } from \"../../../../utils/IClone\"\r\nimport { Vector2 } from \"../../../../maths/Vector2\";\r\n\r\n/**\r\n * <code>TextureSheetAnimation</code> \r\n */\r\nexport class TextureSheetAnimation implements IClone {\r\n\t/**@internal */\r\n\tprivate _frame: FrameOverTime;\r\n\t/**@internal */\r\n\tprivate _startFrame: StartFrame;\r\n\r\n\t/***/\r\n\ttiles: Vector2;\r\n\t/**,0whole sheet1singal row*/\r\n\ttype: number = 0;\r\n\t/**type1*/\r\n\trandomRow: boolean = false;\r\n\t/**,type1*/\r\n\trowIndex: number = 0;\r\n\t/***/\r\n\tcycles: number = 0;\r\n\t/**UV,0Noting,1Everything,,*/\r\n\tenableUVChannels: number = 0;\r\n\t/***/\r\n\tenable: boolean = false;\r\n\r\n\t/***/\r\n\tget frame(): FrameOverTime {\r\n\t\treturn this._frame;\r\n\t}\r\n\r\n\t/***/\r\n\tget startFrame(): StartFrame {\r\n\t\treturn this._startFrame;\r\n\t}\r\n\r\n\t/**\r\n\t *  <code>TextureSheetAnimation</code> \r\n\t * @param frame \r\n\t * @param  startFrame \r\n\t */\r\n\tconstructor(frame: FrameOverTime, startFrame: StartFrame) {\r\n\t\tthis.tiles = new Vector2(1, 1);\r\n\t\tthis.type = 0;\r\n\t\tthis.randomRow = true;\r\n\t\tthis.rowIndex = 0;\r\n\t\tthis.cycles = 1;\r\n\t\tthis.enableUVChannels = 1;//TODO:\r\n\t\tthis._frame = frame;\r\n\t\tthis._startFrame = startFrame;\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t * @param\tdestObject \r\n\t */\r\n\tcloneTo(destObject: any): void {\r\n\t\tvar destTextureSheetAnimation: TextureSheetAnimation = (<TextureSheetAnimation>destObject);\r\n\t\tthis.tiles.cloneTo(destTextureSheetAnimation.tiles);\r\n\t\tdestTextureSheetAnimation.type = this.type;\r\n\t\tdestTextureSheetAnimation.randomRow = this.randomRow;\r\n\t\tdestTextureSheetAnimation.rowIndex = this.rowIndex;\r\n\t\tdestTextureSheetAnimation.cycles = this.cycles;\r\n\t\tdestTextureSheetAnimation.enableUVChannels = this.enableUVChannels;\r\n\t\tdestTextureSheetAnimation.enable = this.enable;\r\n\t\tthis._frame.cloneTo(destTextureSheetAnimation._frame);\r\n\t\tthis._startFrame.cloneTo(destTextureSheetAnimation._startFrame);\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t * @return\t \r\n\t */\r\n\tclone(): any {\r\n\t\tvar destFrame: FrameOverTime;\r\n\t\tswitch (this._frame.type) {\r\n\t\t\tcase 0:\r\n\t\t\t\tdestFrame = FrameOverTime.createByConstant(this._frame.constant);\r\n\t\t\t\tbreak;\r\n\t\t\tcase 1:\r\n\t\t\t\tdestFrame = FrameOverTime.createByOverTime(this._frame.frameOverTimeData.clone());\r\n\t\t\t\tbreak;\r\n\t\t\tcase 2:\r\n\t\t\t\tdestFrame = FrameOverTime.createByRandomTwoConstant(this._frame.constantMin, this._frame.constantMax);\r\n\t\t\t\tbreak;\r\n\t\t\tcase 3:\r\n\t\t\t\tdestFrame = FrameOverTime.createByRandomTwoOverTime(this._frame.frameOverTimeDataMin.clone(), this._frame.frameOverTimeDataMax.clone());\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\r\n\t\tvar destStartFrame: StartFrame;\r\n\t\tswitch (this._startFrame.type) {\r\n\t\t\tcase 0:\r\n\t\t\t\tdestStartFrame = StartFrame.createByConstant(this._startFrame.constant);\r\n\t\t\t\tbreak;\r\n\t\t\tcase 1:\r\n\t\t\t\tdestStartFrame = StartFrame.createByRandomTwoConstant(this._startFrame.constantMin, this._startFrame.constantMax);\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\r\n\t\tvar destTextureSheetAnimation: TextureSheetAnimation = new TextureSheetAnimation(destFrame, destStartFrame);\r\n\t\tthis.cloneTo(destTextureSheetAnimation);\r\n\t\treturn destTextureSheetAnimation;\r\n\t}\r\n\r\n}\r\n\r\n\r\n","import { IClone } from \"../../../../utils/IClone\";\r\nimport { GradientVelocity } from \"./GradientVelocity\";\r\n\r\n/**\r\n * <code>VelocityOverLifetime</code> \r\n */\r\nexport class VelocityOverLifetime implements IClone {\r\n\t/**@internal */\r\n\tprivate _velocity: GradientVelocity;\r\n\r\n\t/***/\r\n\tenable: boolean = false;\r\n\t/**,0local,1world*/\r\n\tspace: number = 0;\r\n\r\n\t/**\r\n\t *\r\n\t */\r\n\tget velocity(): GradientVelocity {\r\n\t\treturn this._velocity;\r\n\t}\r\n\r\n\t/**\r\n\t *  <code>VelocityOverLifetime</code> \r\n\t */\r\n\tconstructor(velocity: GradientVelocity) {\r\n\t\tthis._velocity = velocity;\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t * @param\tdestObject \r\n\t */\r\n\tcloneTo(destObject: any): void {\r\n\t\tvar destVelocityOverLifetime: VelocityOverLifetime = (<VelocityOverLifetime>destObject);\r\n\t\tthis._velocity.cloneTo(destVelocityOverLifetime._velocity);\r\n\t\tdestVelocityOverLifetime.enable = this.enable;\r\n\t\tdestVelocityOverLifetime.space = this.space;\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t * @return\t \r\n\t */\r\n\tclone(): any {\r\n\t\tvar destVelocity: GradientVelocity;\r\n\t\tswitch (this._velocity.type) {\r\n\t\t\tcase 0:\r\n\t\t\t\tdestVelocity = GradientVelocity.createByConstant(this._velocity.constant.clone());\r\n\t\t\t\tbreak;\r\n\t\t\tcase 1:\r\n\t\t\t\tdestVelocity = GradientVelocity.createByGradient(this._velocity.gradientX.clone(), this._velocity.gradientY.clone(), this._velocity.gradientZ.clone());\r\n\t\t\t\tbreak;\r\n\t\t\tcase 2:\r\n\t\t\t\tdestVelocity = GradientVelocity.createByRandomTwoConstant(this._velocity.constantMin.clone(), this._velocity.constantMax.clone());\r\n\t\t\t\tbreak;\r\n\t\t\tcase 3:\r\n\t\t\t\tdestVelocity = GradientVelocity.createByRandomTwoGradient(this._velocity.gradientXMin.clone(), this._velocity.gradientXMax.clone(), this._velocity.gradientYMin.clone(), this._velocity.gradientYMax.clone(), this._velocity.gradientZMin.clone(), this._velocity.gradientZMax.clone());\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\t\tvar destVelocityOverLifetime: VelocityOverLifetime = new VelocityOverLifetime(destVelocity);\r\n\t\tdestVelocityOverLifetime.enable = this.enable;\r\n\t\tdestVelocityOverLifetime.space = this.space;\r\n\t\treturn destVelocityOverLifetime;\r\n\t}\r\n\r\n}\r\n\r\n\r\n","\r\n\r\n/**\r\n * @internal\r\n * @author ...\r\n */\r\nexport class VertexShuriKenParticle {\r\n\t//TODO Attribute\r\n\tstatic PARTICLE_DIRECTIONTIME: number = 0;\r\n\tstatic PARTICLE_POSITION0: number = 1;\r\n\tstatic PARTICLE_COLOR0: number = 2;\r\n\tstatic PARTICLE_TEXTURECOORDINATE0: number = 3;\r\n\tstatic PARTICLE_SHAPEPOSITIONSTARTLIFETIME: number = 4;\r\n\tstatic PARTICLE_CORNERTEXTURECOORDINATE0: number = 5;\r\n\tstatic PARTICLE_STARTCOLOR0: number = 6;\r\n\tstatic PARTICLE_ENDCOLOR0: number = 7;\r\n\tstatic PARTICLE_STARTSIZE: number = 8;\r\n\tstatic PARTICLE_STARTROTATION: number = 9;\r\n\tstatic PARTICLE_STARTSPEED: number = 10;\r\n\tstatic PARTICLE_RANDOM0: number = 11;\r\n\tstatic PARTICLE_RANDOM1: number = 12;\r\n\tstatic PARTICLE_SIMULATIONWORLDPOSTION: number = 13;\r\n\tstatic PARTICLE_SIMULATIONWORLDROTATION: number = 14;\r\n\tstatic PARTICLE_SIMULATIONUV:number = 15;\r\n\r\n\tconstructor() {\r\n\r\n\t}\r\n\r\n}\r\n\r\n\r\n","import { VertexShuriKenParticle } from \"./VertexShuriKenParticle\";\r\nimport { VertexDeclaration } from \"../../../RenderEngine/VertexDeclaration\";\r\nimport { Vector3 } from \"../../../maths/Vector3\";\r\nimport { Vector4 } from \"../../../maths/Vector4\";\r\nimport { VertexElementFormat } from \"../../../renders/VertexElementFormat\";\r\nimport { VertexElement } from \"../../../renders/VertexElement\";\r\n\r\n/**\r\n * @internal\r\n * <code>VertexShurikenParticle</code> \r\n */\r\nexport class VertexShurikenParticleBillboard extends VertexShuriKenParticle {\r\n\t/**@internal */\r\n\tprivate static _vertexDeclaration: VertexDeclaration;\r\n\r\n\tstatic get vertexDeclaration(): VertexDeclaration {\r\n\t\treturn VertexShurikenParticleBillboard._vertexDeclaration;\r\n\t}\r\n\r\n\tprivate static _vertexInstanceMeshDeclaration: VertexDeclaration;\r\n\r\n\tstatic get vertexInstanceMeshDeclaration(): VertexDeclaration {\r\n\t\treturn VertexShurikenParticleBillboard._vertexInstanceMeshDeclaration;\r\n\t}\r\n\r\n\tprivate static _vertexInstanceParticleDeclaration: VertexDeclaration;\r\n\r\n\tstatic get vertexInstanceParticleDeclaration(): VertexDeclaration {\r\n\t\treturn VertexShurikenParticleBillboard._vertexInstanceParticleDeclaration;\r\n\t}\r\n\r\n\tprivate static _billboardVertexArray: Float32Array;\r\n\tstatic get billboardVertexArray(): Float32Array {\r\n\t\treturn VertexShurikenParticleBillboard._billboardVertexArray;\r\n\t}\r\n\r\n\tprivate static _billboardIndexArray: Uint16Array;\r\n\tstatic get billboardIndexArray(): Uint16Array {\r\n\t\treturn VertexShurikenParticleBillboard._billboardIndexArray;\r\n\t}\r\n\tstatic set billboardIndexArray(value: Uint16Array) {\r\n\t\tVertexShurikenParticleBillboard._billboardIndexArray = value;\r\n\t}\r\n\r\n\t/**\r\n\t  * @internal\r\n\t  */\r\n\tstatic __init__(): void {\r\n\t\tVertexShurikenParticleBillboard._vertexDeclaration = new VertexDeclaration(168, [\r\n\t\t\tnew VertexElement(0, VertexElementFormat.Vector4, VertexShuriKenParticle.PARTICLE_CORNERTEXTURECOORDINATE0),\r\n\t\t\tnew VertexElement(16, VertexElementFormat.Vector4, VertexShuriKenParticle.PARTICLE_SHAPEPOSITIONSTARTLIFETIME),\r\n\t\t\tnew VertexElement(32, VertexElementFormat.Vector4, VertexShuriKenParticle.PARTICLE_DIRECTIONTIME),\r\n\t\t\tnew VertexElement(48, VertexElementFormat.Vector4, VertexShuriKenParticle.PARTICLE_STARTCOLOR0),\r\n\t\t\tnew VertexElement(64, VertexElementFormat.Vector3, VertexShuriKenParticle.PARTICLE_STARTSIZE),\r\n\t\t\tnew VertexElement(76, VertexElementFormat.Vector3, VertexShuriKenParticle.PARTICLE_STARTROTATION),\r\n\t\t\tnew VertexElement(88, VertexElementFormat.Single, VertexShuriKenParticle.PARTICLE_STARTSPEED),\r\n\t\t\tnew VertexElement(92, VertexElementFormat.Vector4, VertexShuriKenParticle.PARTICLE_RANDOM0),\r\n\t\t\tnew VertexElement(108, VertexElementFormat.Vector4, VertexShuriKenParticle.PARTICLE_RANDOM1),\r\n\t\t\tnew VertexElement(124, VertexElementFormat.Vector3, VertexShuriKenParticle.PARTICLE_SIMULATIONWORLDPOSTION),//TODO:local\r\n\t\t\tnew VertexElement(136, VertexElementFormat.Vector4, VertexShuriKenParticle.PARTICLE_SIMULATIONWORLDROTATION),\r\n\t\t\tnew VertexElement(152, VertexElementFormat.Vector4,VertexShuriKenParticle.PARTICLE_SIMULATIONUV)\r\n\t\t]);\r\n\r\n\r\n\t\tVertexShurikenParticleBillboard._vertexInstanceMeshDeclaration = new VertexDeclaration(16, [\r\n\t\t\tnew VertexElement(0, VertexElementFormat.Vector4, VertexShuriKenParticle.PARTICLE_CORNERTEXTURECOORDINATE0)\r\n\t\t]);\r\n\r\n\t\tVertexShurikenParticleBillboard._vertexInstanceParticleDeclaration = new VertexDeclaration(152, [\r\n\t\t\tnew VertexElement(0, VertexElementFormat.Vector4, VertexShuriKenParticle.PARTICLE_SHAPEPOSITIONSTARTLIFETIME),\r\n\t\t\tnew VertexElement(16, VertexElementFormat.Vector4, VertexShuriKenParticle.PARTICLE_DIRECTIONTIME),\r\n\t\t\tnew VertexElement(32, VertexElementFormat.Vector4, VertexShuriKenParticle.PARTICLE_STARTCOLOR0),\r\n\t\t\tnew VertexElement(48, VertexElementFormat.Vector3, VertexShuriKenParticle.PARTICLE_STARTSIZE),\r\n\t\t\tnew VertexElement(60, VertexElementFormat.Vector3, VertexShuriKenParticle.PARTICLE_STARTROTATION),\r\n\t\t\tnew VertexElement(72, VertexElementFormat.Single, VertexShuriKenParticle.PARTICLE_STARTSPEED),\r\n\t\t\tnew VertexElement(76, VertexElementFormat.Vector4, VertexShuriKenParticle.PARTICLE_RANDOM0),\r\n\t\t\tnew VertexElement(92, VertexElementFormat.Vector4, VertexShuriKenParticle.PARTICLE_RANDOM1),\r\n\t\t\tnew VertexElement(108, VertexElementFormat.Vector3, VertexShuriKenParticle.PARTICLE_SIMULATIONWORLDPOSTION),//TODO:local\r\n\t\t\tnew VertexElement(120, VertexElementFormat.Vector4, VertexShuriKenParticle.PARTICLE_SIMULATIONWORLDROTATION),\r\n\t\t\tnew VertexElement(136, VertexElementFormat.Vector4,VertexShuriKenParticle.PARTICLE_SIMULATIONUV)\r\n\t\t])\r\n\r\n\t\tVertexShurikenParticleBillboard._billboardIndexArray = new Uint16Array([\r\n\t\t\t0, 2, 1, 0, 3, 2\r\n\t\t]);\r\n\r\n\t\tVertexShurikenParticleBillboard._billboardVertexArray = new Float32Array([\r\n\t\t\t-0.5, -0.5, 0, 1,\r\n\t\t\t0.5, -0.5, 1, 1,\r\n\t\t\t0.5, 0.5, 1, 0,\r\n\t\t\t-0.5, 0.5, 0, 0\r\n\t\t]);\r\n\t}\r\n\r\n\t/**@internal */\r\n\tprivate _cornerTextureCoordinate: Vector4;\r\n\t/**@internal */\r\n\tprivate _positionStartLifeTime: Vector4;\r\n\t/**@internal */\r\n\tprivate _velocity: Vector3;\r\n\t/**@internal */\r\n\tprivate _startColor: Vector4;\r\n\t/**@internal */\r\n\tprivate _startSize: Vector3;\r\n\t/**@internal */\r\n\tprivate _startRotation0: Vector3;\r\n\t/**@internal */\r\n\tprivate _startRotation1: Vector3;\r\n\t/**@internal */\r\n\tprivate _startRotation2: Vector3;\r\n\t/**@internal */\r\n\tprivate _startLifeTime: number;\r\n\t/**@internal */\r\n\tprivate _time: number;\r\n\t/**@internal */\r\n\tprivate _startSpeed: number;\r\n\t/**@internal */\r\n\tprivate _randoms0: Vector4;\r\n\t/**@internal */\r\n\tprivate _randoms1: Vector4;\r\n\t/**@internal */\r\n\tprivate _simulationWorldPostion: Vector3;\r\n\r\n\tget cornerTextureCoordinate(): Vector4 {\r\n\t\treturn this._cornerTextureCoordinate;\r\n\t}\r\n\r\n\tget positionStartLifeTime(): Vector4 {\r\n\t\treturn this._positionStartLifeTime;\r\n\t}\r\n\r\n\tget velocity(): Vector3 {\r\n\t\treturn this._velocity;\r\n\t}\r\n\r\n\tget startColor(): Vector4 {\r\n\t\treturn this._startColor;\r\n\t}\r\n\r\n\tget startSize(): Vector3 {\r\n\t\treturn this._startSize;\r\n\t}\r\n\r\n\tget startRotation0(): Vector3 {\r\n\t\treturn this._startRotation0;\r\n\t}\r\n\r\n\tget startRotation1(): Vector3 {\r\n\t\treturn this._startRotation1;\r\n\t}\r\n\r\n\tget startRotation2(): Vector3 {\r\n\t\treturn this._startRotation2;\r\n\t}\r\n\r\n\tget startLifeTime(): number {\r\n\t\treturn this._startLifeTime;\r\n\t}\r\n\r\n\tget time(): number {\r\n\t\treturn this._time;\r\n\t}\r\n\r\n\tget startSpeed(): number {\r\n\t\treturn this._startSpeed;\r\n\t}\r\n\r\n\tget random0(): Vector4 {\r\n\t\treturn this._randoms0;\r\n\t}\r\n\r\n\tget random1(): Vector4 {\r\n\t\treturn this._randoms1;\r\n\t}\r\n\r\n\tget simulationWorldPostion(): Vector3 {\r\n\t\treturn this._simulationWorldPostion;\r\n\t}\r\n\r\n\tconstructor(cornerTextureCoordinate: Vector4, positionStartLifeTime: Vector4, velocity: Vector3, startColor: Vector4, startSize: Vector3, startRotation0: Vector3, startRotation1: Vector3, startRotation2: Vector3, ageAddScale: number, time: number, startSpeed: number, randoms0: Vector4, randoms1: Vector4, simulationWorldPostion: Vector3) {\r\n\t\tsuper();\r\n\t\tthis._cornerTextureCoordinate = cornerTextureCoordinate;\r\n\t\tthis._positionStartLifeTime = positionStartLifeTime;\r\n\t\tthis._velocity = velocity;\r\n\t\tthis._startColor = startColor;\r\n\t\tthis._startSize = startSize;\r\n\t\tthis._startRotation0 = startRotation0;\r\n\t\tthis._startRotation1 = startRotation1;\r\n\t\tthis._startRotation2 = startRotation2;\r\n\t\tthis._startLifeTime = ageAddScale;\r\n\t\tthis._time = time;\r\n\t\tthis._startSpeed = startSpeed;\r\n\t\tthis._randoms0 = randoms0;\r\n\t\tthis._randoms1 = randoms1;\r\n\t\tthis._simulationWorldPostion = simulationWorldPostion;\r\n\t}\r\n\r\n}\r\n\r\n\r\n","import { VertexShuriKenParticle } from \"./VertexShuriKenParticle\";\r\nimport { VertexDeclaration } from \"../../../RenderEngine/VertexDeclaration\";\r\nimport { Vector3 } from \"../../../maths/Vector3\";\r\nimport { Vector4 } from \"../../../maths/Vector4\";\r\nimport { VertexElementFormat } from \"../../../renders/VertexElementFormat\";\r\nimport { VertexElement } from \"../../../renders/VertexElement\";\r\n\r\n/**\r\n * @internal\r\n * <code>VertexShurikenParticle</code> \r\n */\r\nexport class VertexShurikenParticleMesh extends VertexShuriKenParticle {\r\n\t/**@internal */\r\n\tprivate static _vertexDeclaration: VertexDeclaration;\r\n\r\n\t/**\r\n  * @internal\r\n  */\r\n\tstatic __init__(): void {\r\n\t\tVertexShurikenParticleMesh._vertexDeclaration = new VertexDeclaration(188, [new VertexElement(0, VertexElementFormat.Vector3, VertexShuriKenParticle.PARTICLE_POSITION0),\r\n\t\tnew VertexElement(12, VertexElementFormat.Vector4, VertexShuriKenParticle.PARTICLE_COLOR0),\r\n\t\tnew VertexElement(28, VertexElementFormat.Vector2, VertexShuriKenParticle.PARTICLE_TEXTURECOORDINATE0),\r\n\t\tnew VertexElement(36, VertexElementFormat.Vector4, VertexShuriKenParticle.PARTICLE_SHAPEPOSITIONSTARTLIFETIME),\r\n\t\tnew VertexElement(52, VertexElementFormat.Vector4, VertexShuriKenParticle.PARTICLE_DIRECTIONTIME),\r\n\t\tnew VertexElement(68, VertexElementFormat.Vector4, VertexShuriKenParticle.PARTICLE_STARTCOLOR0),\r\n\t\tnew VertexElement(84, VertexElementFormat.Vector3, VertexShuriKenParticle.PARTICLE_STARTSIZE),\r\n\t\tnew VertexElement(96, VertexElementFormat.Vector3, VertexShuriKenParticle.PARTICLE_STARTROTATION),\r\n\t\tnew VertexElement(108, VertexElementFormat.Single, VertexShuriKenParticle.PARTICLE_STARTSPEED),\r\n\t\tnew VertexElement(112, VertexElementFormat.Vector4, VertexShuriKenParticle.PARTICLE_RANDOM0),\r\n\t\tnew VertexElement(128, VertexElementFormat.Vector4, VertexShuriKenParticle.PARTICLE_RANDOM1),\r\n\t\tnew VertexElement(144, VertexElementFormat.Vector3, VertexShuriKenParticle.PARTICLE_SIMULATIONWORLDPOSTION),//TODO:local\r\n\t\tnew VertexElement(156, VertexElementFormat.Vector4, VertexShuriKenParticle.PARTICLE_SIMULATIONWORLDROTATION),\r\n\t\tnew VertexElement(172,VertexElementFormat.Vector4, VertexShuriKenParticle.PARTICLE_SIMULATIONUV)]);\r\n\t\t\r\n\t\t\r\n\t\tVertexShurikenParticleMesh._vertexInstanceMeshDeclaration = new VertexDeclaration(36, [\r\n\t\t\tnew VertexElement(0, VertexElementFormat.Vector3, VertexShuriKenParticle.PARTICLE_POSITION0),\r\n\t\t\tnew VertexElement(12, VertexElementFormat.Vector4, VertexShuriKenParticle.PARTICLE_COLOR0),\r\n\t\t\tnew VertexElement(28, VertexElementFormat.Vector2, VertexShuriKenParticle.PARTICLE_TEXTURECOORDINATE0)\r\n\t\t]);\r\n\r\n\t\tVertexShurikenParticleMesh._vertexInstanceParticleDeclaration = new VertexDeclaration(152, [\r\n\t\t\tnew VertexElement(0, VertexElementFormat.Vector4, VertexShuriKenParticle.PARTICLE_SHAPEPOSITIONSTARTLIFETIME),\r\n\t\t\tnew VertexElement(16, VertexElementFormat.Vector4, VertexShuriKenParticle.PARTICLE_DIRECTIONTIME),\r\n\t\t\tnew VertexElement(32, VertexElementFormat.Vector4, VertexShuriKenParticle.PARTICLE_STARTCOLOR0),\r\n\t\t\tnew VertexElement(48, VertexElementFormat.Vector3, VertexShuriKenParticle.PARTICLE_STARTSIZE),\r\n\t\t\tnew VertexElement(60, VertexElementFormat.Vector3, VertexShuriKenParticle.PARTICLE_STARTROTATION),\r\n\t\t\tnew VertexElement(72, VertexElementFormat.Single, VertexShuriKenParticle.PARTICLE_STARTSPEED),\r\n\t\t\tnew VertexElement(76, VertexElementFormat.Vector4, VertexShuriKenParticle.PARTICLE_RANDOM0),\r\n\t\t\tnew VertexElement(92, VertexElementFormat.Vector4, VertexShuriKenParticle.PARTICLE_RANDOM1),\r\n\t\t\tnew VertexElement(108, VertexElementFormat.Vector3, VertexShuriKenParticle.PARTICLE_SIMULATIONWORLDPOSTION),//TODO:local\r\n\t\t\tnew VertexElement(120, VertexElementFormat.Vector4, VertexShuriKenParticle.PARTICLE_SIMULATIONWORLDROTATION),\r\n\t\t\tnew VertexElement(136,VertexElementFormat.Vector4, VertexShuriKenParticle.PARTICLE_SIMULATIONUV)\r\n\t\t]);\r\n\t}\r\n\r\n\tstatic get vertexDeclaration(): VertexDeclaration {\r\n\t\treturn VertexShurikenParticleMesh._vertexDeclaration;\r\n\t}\r\n\r\n\tprivate static _vertexInstanceMeshDeclaration: VertexDeclaration;\r\n\tstatic get vertexInstanceMeshDeclaration(): VertexDeclaration {\r\n\t\treturn VertexShurikenParticleMesh._vertexInstanceMeshDeclaration;\r\n\t}\r\n\r\n\tprivate static _vertexInstanceParticleDeclaration: VertexDeclaration;\r\n\tstatic get vertexInstanceParticleDeclaration(): VertexDeclaration {\r\n\t\treturn VertexShurikenParticleMesh._vertexInstanceParticleDeclaration;\r\n\t}\r\n\r\n\t/**@internal */\r\n\tprivate _cornerTextureCoordinate: Vector4;\r\n\t/**@internal */\r\n\tprivate _positionStartLifeTime: Vector4;\r\n\t/**@internal */\r\n\tprivate _velocity: Vector3;\r\n\t/**@internal */\r\n\tprivate _startColor: Vector4;\r\n\t/**@internal */\r\n\tprivate _startSize: Vector3;\r\n\t/**@internal */\r\n\tprivate _startRotation0: Vector3;\r\n\t/**@internal */\r\n\tprivate _startRotation1: Vector3;\r\n\t/**@internal */\r\n\tprivate _startRotation2: Vector3;\r\n\t/**@internal */\r\n\tprivate _startLifeTime: number;\r\n\t/**@internal */\r\n\tprivate _time: number;\r\n\t/**@internal */\r\n\tprivate _startSpeed: number;\r\n\t/**@internal */\r\n\tprivate _randoms0: Vector4;\r\n\t/**@internal */\r\n\tprivate _randoms1: Vector4;\r\n\t/**@internal */\r\n\tprivate _simulationWorldPostion: Vector3;\r\n\r\n\tget cornerTextureCoordinate(): Vector4 {\r\n\t\treturn this._cornerTextureCoordinate;\r\n\t}\r\n\r\n\tget position(): Vector4 {\r\n\t\treturn this._positionStartLifeTime;\r\n\t}\r\n\r\n\tget velocity(): Vector3 {\r\n\t\treturn this._velocity;\r\n\t}\r\n\r\n\tget startColor(): Vector4 {\r\n\t\treturn this._startColor;\r\n\t}\r\n\r\n\tget startSize(): Vector3 {\r\n\t\treturn this._startSize;\r\n\t}\r\n\r\n\tget startRotation0(): Vector3 {\r\n\t\treturn this._startRotation0;\r\n\t}\r\n\r\n\tget startRotation1(): Vector3 {\r\n\t\treturn this._startRotation1;\r\n\t}\r\n\r\n\tget startRotation2(): Vector3 {\r\n\t\treturn this._startRotation2;\r\n\t}\r\n\r\n\tget startLifeTime(): number {\r\n\t\treturn this._startLifeTime;\r\n\t}\r\n\r\n\tget time(): number {\r\n\t\treturn this._time;\r\n\t}\r\n\r\n\tget startSpeed(): number {\r\n\t\treturn this._startSpeed;\r\n\t}\r\n\r\n\tget random0(): Vector4 {\r\n\t\treturn this._randoms0;\r\n\t}\r\n\r\n\tget random1(): Vector4 {\r\n\t\treturn this._randoms1;\r\n\t}\r\n\r\n\tget simulationWorldPostion(): Vector3 {\r\n\t\treturn this._simulationWorldPostion;\r\n\t}\r\n\r\n\tconstructor(cornerTextureCoordinate: Vector4, positionStartLifeTime: Vector4, velocity: Vector3, startColor: Vector4, startSize: Vector3, startRotation0: Vector3, startRotation1: Vector3, startRotation2: Vector3, ageAddScale: number, time: number, startSpeed: number, randoms0: Vector4, randoms1: Vector4, simulationWorldPostion: Vector3) {\r\n\t\tsuper();\r\n\t\tthis._cornerTextureCoordinate = cornerTextureCoordinate;\r\n\t\tthis._positionStartLifeTime = positionStartLifeTime;\r\n\t\tthis._velocity = velocity;\r\n\t\tthis._startColor = startColor;\r\n\t\tthis._startSize = startSize;\r\n\t\tthis._startRotation0 = startRotation0;\r\n\t\tthis._startRotation1 = startRotation1;\r\n\t\tthis._startRotation2 = startRotation2;\r\n\t\tthis._startLifeTime = ageAddScale;\r\n\t\tthis._time = time;\r\n\t\tthis._startSpeed = startSpeed;\r\n\t\tthis._randoms0 = randoms0;\r\n\t\tthis._randoms1 = randoms1;\r\n\t\tthis._simulationWorldPostion = simulationWorldPostion;\r\n\t}\r\n\r\n}\r\n\r\n\r\n","/**\r\n\t * <code>Rand</code> 32\r\n\t */\r\nexport class Rand {\r\n\t/**\r\n\t * 3232\r\n\t * @param 32\r\n\t * @return 32\r\n\t */\r\n\tstatic getFloatFromInt(v: number): number {\r\n\t\t// take 23 bits of integer, and divide by 2^23-1\r\n\t\treturn (v & 0x007FFFFF) * (1.0 / 8388607.0)\r\n\t}\r\n\r\n\t/**\r\n\t * 328\r\n\t * @param 32\r\n\t * @return 8\r\n\t */\r\n\tstatic getByteFromInt(v: number): number {//TODO\r\n\t\t// take the most significant byte from the 23-bit value\r\n\t\treturn (v & 0x007FFFFF) >>> 15/*(23-8)*/;\r\n\t}\r\n\r\n\t/**@internal */\r\n\tprivate _temp: Uint32Array = new Uint32Array(1);\r\n\r\n\t/***/\r\n\tseeds: Uint32Array = new Uint32Array(4);\r\n\r\n\t/**\r\n\t * \r\n\t * @return \r\n\t */\r\n\tget seed(): number {\r\n\t\treturn this.seeds[0];\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t * @param\tseed \r\n\t */\r\n\tset seed(seed: number) {\r\n\t\tthis.seeds[0] = seed;\r\n\t\tthis.seeds[1] = this.seeds[0] * 0x6C078965/*1812433253U*/ + 1;\r\n\t\tthis.seeds[2] = this.seeds[1] * 0x6C078965/*1812433253U*/ + 1;\r\n\t\tthis.seeds[3] = this.seeds[2] * 0x6C078965/*1812433253U*/ + 1;\r\n\t}\r\n\r\n\t/**\r\n\t *  <code>Rand</code> \r\n\t * @param\tseed  32\r\n\t */\r\n\tconstructor(seed: number) {\r\n\t\tthis.seeds[0] = seed;\r\n\t\tthis.seeds[1] = this.seeds[0] * 0x6C078965/*1812433253U*/ + 1;\r\n\t\tthis.seeds[2] = this.seeds[1] * 0x6C078965/*1812433253U*/ + 1;\r\n\t\tthis.seeds[3] = this.seeds[2] * 0x6C078965/*1812433253U*/ + 1;\r\n\t}\r\n\r\n\t/**\r\n\t * 32\r\n\t * @return 32\r\n\t */\r\n\tgetUint(): number {\r\n\t\tthis._temp[0] = this.seeds[0] ^ (this.seeds[0] << 11);\r\n\t\tthis.seeds[0] = this.seeds[1];\r\n\t\tthis.seeds[1] = this.seeds[2];\r\n\t\tthis.seeds[2] = this.seeds[3];\r\n\t\tthis.seeds[3] = (this.seeds[3] ^ (this.seeds[3] >>> 19)) ^ (this._temp[0] ^ (this._temp[0] >>> 8));\r\n\t\treturn this.seeds[3];\r\n\t}\r\n\r\n\t/**\r\n\t * 01\r\n\t * @return 01\r\n\t */\r\n\tgetFloat(): number {\r\n\t\tthis.getUint();\r\n\t\treturn (this.seeds[3] & 0x007FFFFF) * (1.0 / 8388607.0);\r\n\t}\r\n\r\n\t/**\r\n\t * -11\r\n\t * @return -11\r\n\t */\r\n\tgetSignedFloat(): number {\r\n\t\treturn this.getFloat() * 2.0 - 1.0;\r\n\t}\r\n\r\n}\r\n\r\n","import { IClone } from \"../../../../utils/IClone\";\r\nimport { Burst } from \"./Burst\";\r\n\r\n/**\r\n * <code>Emission</code> \r\n */\r\nexport class Emission implements IClone {\r\n\t/** @internal */\r\n\tprivate _destroyed: boolean;\r\n\t/** @internal */\r\n\tprivate _emissionRate: number = 10;\r\n\r\n\tprivate _emissionRateOverDistance: number = 0;\r\n\r\n\t/**@internal ,*/\r\n\t_bursts: Burst[];\r\n\r\n\t/***/\r\n\tenable: boolean;\r\n\r\n\t/**\r\n\t * \r\n\t * @param emissionRate  (/)\r\n\t */\r\n\tset emissionRate(value: number) {\r\n\t\tif (value < 0)\r\n\t\t\tthrow new Error(\"ParticleBaseShape:emissionRate value must large or equal than 0.\");\r\n\t\tthis._emissionRate = value;\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t * @return  (/)\r\n\t */\r\n\tget emissionRate(): number {\r\n\t\treturn this._emissionRate;\r\n\t}\r\n\r\n\tget emissionRateOverDistance(): number {\r\n\t\treturn this._emissionRateOverDistance;\r\n\t}\r\n\r\n\tset emissionRateOverDistance(value: number) {\r\n\t\tvalue = Math.max(0, value);\r\n\t\tthis._emissionRateOverDistance = value;\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t * @return \r\n\t */\r\n\tget destroyed(): boolean {\r\n\t\treturn this._destroyed;\r\n\t}\r\n\r\n\t/**\r\n\t *  <code>Emission</code> \r\n\t */\r\n\tconstructor() {\r\n\t\tthis._destroyed = false;\r\n\t\tthis._bursts = [];\r\n\t}\r\n\r\n\t/**\r\n\t * @private\r\n\t */\r\n\tdestroy(): void {\r\n\t\tthis._bursts = null;\r\n\t\tthis._destroyed = true;\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t * @return \r\n\t */\r\n\tgetBurstsCount(): number {\r\n\t\treturn this._bursts.length;\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t * @param index \r\n\t * @return \r\n\t */\r\n\tgetBurstByIndex(index: number): Burst {\r\n\t\treturn this._bursts[index];\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t * @param burst \r\n\t */\r\n\taddBurst(burst: Burst): void {\r\n\t\tvar burstsCount: number = this._bursts.length;\r\n\t\tif (burstsCount > 0)\r\n\t\t\tfor (var i: number = 0; i < burstsCount; i++) {\r\n\t\t\t\tif (this._bursts[i].time > burst.time)\r\n\t\t\t\t\tthis._bursts.splice(i, 0, burst);\r\n\t\t\t}\r\n\t\tthis._bursts.push(burst);\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t * @param burst \r\n\t */\r\n\tremoveBurst(burst: Burst): void {\r\n\t\tvar index: number = this._bursts.indexOf(burst);\r\n\t\tif (index !== -1) {\r\n\t\t\tthis._bursts.splice(index, 1);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t * @param index \r\n\t */\r\n\tremoveBurstByIndex(index: number): void {\r\n\t\tthis._bursts.splice(index, 1);\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t */\r\n\tclearBurst(): void {\r\n\t\tthis._bursts.length = 0;\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t * @param\tdestObject \r\n\t */\r\n\tcloneTo(destObject: any): void {\r\n\t\tvar destEmission: Emission = (<Emission>destObject);\r\n\r\n\t\tvar destBursts: Burst[] = destEmission._bursts;\r\n\t\tdestBursts.length = this._bursts.length;\r\n\t\tfor (var i: number = 0, n: number = this._bursts.length; i < n; i++) {\r\n\t\t\tvar destBurst: Burst = destBursts[i];\r\n\t\t\tif (destBurst)\r\n\t\t\t\tthis._bursts[i].cloneTo(destBurst);\r\n\t\t\telse\r\n\t\t\t\tdestBursts[i] = this._bursts[i].clone();\r\n\t\t}\r\n\r\n\t\tdestEmission._emissionRate = this._emissionRate;\r\n\t\tdestEmission._emissionRateOverDistance = this._emissionRateOverDistance;\r\n\t\tdestEmission.enable = this.enable;\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t * @return\t \r\n\t */\r\n\tclone(): any {\r\n\t\tvar destEmission: Emission = new Emission();\r\n\t\tthis.cloneTo(destEmission);\r\n\t\treturn destEmission;\r\n\t}\r\n}\r\n\r\n\r\n","import { Shader3D } from \"../../../RenderEngine/RenderShader/Shader3D\";\r\nimport { ShaderDataType } from \"../../../RenderEngine/RenderShader/ShaderData\";\r\nimport { ShaderDefine } from \"../../../RenderEngine/RenderShader/ShaderDefine\";\r\nimport { LayaGL } from \"../../../layagl/LayaGL\";\r\n\r\n/**\r\n * @internal\r\n */\r\nexport class ShuriKenParticle3DShaderDeclaration {\r\n\r\n\t/**@internal */\r\n\tstatic SHADERDEFINE_RENDERMODE_BILLBOARD: ShaderDefine;\r\n\t/**@internal */\r\n\tstatic SHADERDEFINE_RENDERMODE_STRETCHEDBILLBOARD: ShaderDefine;\r\n\t/**@internal */\r\n\tstatic SHADERDEFINE_RENDERMODE_HORIZONTALBILLBOARD: ShaderDefine;\r\n\t/**@internal */\r\n\tstatic SHADERDEFINE_RENDERMODE_VERTICALBILLBOARD: ShaderDefine;\r\n\t/**@internal */\r\n\tstatic SHADERDEFINE_COLORKEYCOUNT_8: ShaderDefine;\r\n\t/**@internal */\r\n\tstatic SHADERDEFINE_COLOROVERLIFETIME: ShaderDefine;\r\n\t/**@internal */\r\n\tstatic SHADERDEFINE_RANDOMCOLOROVERLIFETIME: ShaderDefine;\r\n\t/**@internal */\r\n\tstatic SHADERDEFINE_VELOCITYOVERLIFETIMECONSTANT: ShaderDefine;\r\n\t/**@internal */\r\n\tstatic SHADERDEFINE_VELOCITYOVERLIFETIMECURVE: ShaderDefine;\r\n\t/**@internal */\r\n\tstatic SHADERDEFINE_VELOCITYOVERLIFETIMERANDOMCONSTANT: ShaderDefine;\r\n\t/**@internal */\r\n\tstatic SHADERDEFINE_VELOCITYOVERLIFETIMERANDOMCURVE: ShaderDefine;\r\n\t/**@internal */\r\n\tstatic SHADERDEFINE_TEXTURESHEETANIMATIONCURVE: ShaderDefine;\r\n\t/**@internal */\r\n\tstatic SHADERDEFINE_TEXTURESHEETANIMATIONRANDOMCURVE: ShaderDefine;\r\n\t/**@internal */\r\n\tstatic SHADERDEFINE_ROTATIONOVERLIFETIME: ShaderDefine;\r\n\t/**@internal */\r\n\tstatic SHADERDEFINE_ROTATIONOVERLIFETIMESEPERATE: ShaderDefine;\r\n\t/**@internal */\r\n\tstatic SHADERDEFINE_ROTATIONOVERLIFETIMECONSTANT: ShaderDefine;\r\n\t/**@internal */\r\n\tstatic SHADERDEFINE_ROTATIONOVERLIFETIMECURVE: ShaderDefine;\r\n\t/**@internal */\r\n\tstatic SHADERDEFINE_ROTATIONOVERLIFETIMERANDOMCONSTANTS: ShaderDefine;\r\n\t/**@internal */\r\n\tstatic SHADERDEFINE_ROTATIONOVERLIFETIMERANDOMCURVES: ShaderDefine;\r\n\t/**@internal */\r\n\tstatic SHADERDEFINE_SIZEOVERLIFETIMECURVE: ShaderDefine;\r\n\t/**@internal */\r\n\tstatic SHADERDEFINE_SIZEOVERLIFETIMECURVESEPERATE: ShaderDefine;\r\n\t/**@internal */\r\n\tstatic SHADERDEFINE_SIZEOVERLIFETIMERANDOMCURVES: ShaderDefine;\r\n\t/**@internal */\r\n\tstatic SHADERDEFINE_SIZEOVERLIFETIMERANDOMCURVESSEPERATE: ShaderDefine;\r\n\t/**@internal */\r\n\tstatic SHADERDEFINE_RENDERMODE_MESH: ShaderDefine;\r\n\t/**@internal */\r\n\tstatic SHADERDEFINE_SHAPE: ShaderDefine;\r\n\r\n\r\n\t//Base\r\n\t/**@internal */\r\n\tstatic WORLDPOSITION: number;\r\n\t/**@internal */\r\n\tstatic WORLDROTATION: number;\r\n\t/**@internal */\r\n\tstatic POSITIONSCALE: number;\r\n\t/**@internal */\r\n\tstatic SIZESCALE: number;\r\n\t/**@internal */\r\n\tstatic SCALINGMODE: number;\r\n\t/**@internal */\r\n\tstatic GRAVITY: number;\r\n\t/**@internal */\r\n\tstatic THREEDSTARTROTATION: number;\r\n\t/**@internal */\r\n\tstatic STRETCHEDBILLBOARDLENGTHSCALE: number;\r\n\t/**@internal */\r\n\tstatic STRETCHEDBILLBOARDSPEEDSCALE: number;\r\n\t/**@internal */\r\n\tstatic SIMULATIONSPACE: number;\r\n\t/**@internal */\r\n\tstatic CURRENTTIME: number;\r\n\t/**@internal */\r\n\tstatic DRAG: number;\r\n\r\n\t//VelocityOverLifetime\r\n\t/**@internal */\r\n\tstatic VOLVELOCITYCONST: number;\r\n\t/**@internal */\r\n\tstatic VOLVELOCITYGRADIENTX: number;\r\n\t/**@internal */\r\n\tstatic VOLVELOCITYGRADIENTY: number;\r\n\t/**@internal */\r\n\tstatic VOLVELOCITYGRADIENTZ: number;\r\n\t/**@internal */\r\n\tstatic VOLVELOCITYCONSTMAX: number;\r\n\t/**@internal */\r\n\tstatic VOLVELOCITYGRADIENTXMAX: number;\r\n\t/**@internal */\r\n\tstatic VOLVELOCITYGRADIENTYMAX: number;\r\n\t/**@internal */\r\n\tstatic VOLVELOCITYGRADIENTZMAX: number;\r\n\t/**@internal */\r\n\tstatic VOLSPACETYPE: number;\r\n\r\n\t//ColorOverLifetime\r\n\t/**@internal */\r\n\tstatic COLOROVERLIFEGRADIENTALPHAS: number;\r\n\t/**@internal */\r\n\tstatic COLOROVERLIFEGRADIENTCOLORS: number;\r\n\t/**@internal */\r\n\tstatic COLOROVERLIFEGRADIENTRANGES: number;\r\n\t/**@internal */\r\n\tstatic MAXCOLOROVERLIFEGRADIENTALPHAS: number;\r\n\t/**@internal */\r\n\tstatic MAXCOLOROVERLIFEGRADIENTCOLORS: number;\r\n\t/**@internal */\r\n\tstatic MAXCOLOROVERLIFEGRADIENTRANGES: number;\r\n\r\n\t//SizeOverLifetime\r\n\t/**@internal */\r\n\tstatic SOLSIZEGRADIENT: number;\r\n\t/**@internal */\r\n\tstatic SOLSIZEGRADIENTX: number;\r\n\t/**@internal */\r\n\tstatic SOLSIZEGRADIENTY: number;\r\n\t/**@internal */\r\n\tstatic SOLSizeGradientZ: number;\r\n\t/**@internal */\r\n\tstatic SOLSizeGradientMax: number;\r\n\t/**@internal */\r\n\tstatic SOLSIZEGRADIENTXMAX: number;\r\n\t/**@internal */\r\n\tstatic SOLSIZEGRADIENTYMAX: number;\r\n\t/**@internal */\r\n\tstatic SOLSizeGradientZMAX: number;\r\n\r\n\t//RotationOverLifetime\r\n\t/**@internal */\r\n\tstatic ROLANGULARVELOCITYCONST: number;\r\n\t/**@internal */\r\n\tstatic ROLANGULARVELOCITYCONSTSEPRARATE: number;\r\n\t/**@internal */\r\n\tstatic ROLANGULARVELOCITYGRADIENT: number;\r\n\t/**@internal */\r\n\tstatic ROLANGULARVELOCITYGRADIENTX: number;\r\n\t/**@internal */\r\n\tstatic ROLANGULARVELOCITYGRADIENTY: number;\r\n\t/**@internal */\r\n\tstatic ROLANGULARVELOCITYGRADIENTZ: number;\r\n\t/**@internal */\r\n\tstatic ROLANGULARVELOCITYCONSTMAX: number;\r\n\t/**@internal */\r\n\tstatic ROLANGULARVELOCITYCONSTMAXSEPRARATE: number;\r\n\t/**@internal */\r\n\tstatic ROLANGULARVELOCITYGRADIENTMAX: number;\r\n\t/**@internal */\r\n\tstatic ROLANGULARVELOCITYGRADIENTXMAX: number;\r\n\t/**@internal */\r\n\tstatic ROLANGULARVELOCITYGRADIENTYMAX: number;\r\n\t/**@internal */\r\n\tstatic ROLANGULARVELOCITYGRADIENTZMAX: number;\r\n\t/**@internal */\r\n\tstatic ROLANGULARVELOCITYGRADIENTWMAX: number;\r\n\r\n\t//TextureSheetAnimation\r\n\t/**@internal */\r\n\tstatic TEXTURESHEETANIMATIONCYCLES: number;\r\n\t/**@internal */\r\n\tstatic TEXTURESHEETANIMATIONSUBUVLENGTH: number;\r\n\t/**@internal */\r\n\tstatic TEXTURESHEETANIMATIONGRADIENTUVS: number;\r\n\t/**@internal */\r\n\tstatic TEXTURESHEETANIMATIONGRADIENTMAXUVS: number;\r\n\r\n\r\n\t/**\r\n\t * init\r\n\t */\r\n\tstatic __init__() {\r\n\r\n\t\tShuriKenParticle3DShaderDeclaration.SHADERDEFINE_RENDERMODE_BILLBOARD = Shader3D.getDefineByName(\"SPHERHBILLBOARD\");\r\n\t\tShuriKenParticle3DShaderDeclaration.SHADERDEFINE_RENDERMODE_STRETCHEDBILLBOARD = Shader3D.getDefineByName(\"STRETCHEDBILLBOARD\");\r\n\t\tShuriKenParticle3DShaderDeclaration.SHADERDEFINE_RENDERMODE_HORIZONTALBILLBOARD = Shader3D.getDefineByName(\"HORIZONTALBILLBOARD\");\r\n\t\tShuriKenParticle3DShaderDeclaration.SHADERDEFINE_RENDERMODE_VERTICALBILLBOARD = Shader3D.getDefineByName(\"VERTICALBILLBOARD\");\r\n\r\n\t\tShuriKenParticle3DShaderDeclaration.SHADERDEFINE_COLORKEYCOUNT_8 = Shader3D.getDefineByName(\"COLORKEYCOUNT_8\");\r\n\t\tShuriKenParticle3DShaderDeclaration.SHADERDEFINE_COLOROVERLIFETIME = Shader3D.getDefineByName(\"COLOROVERLIFETIME\");\r\n\t\tShuriKenParticle3DShaderDeclaration.SHADERDEFINE_RANDOMCOLOROVERLIFETIME = Shader3D.getDefineByName(\"RANDOMCOLOROVERLIFETIME\");\r\n\t\tShuriKenParticle3DShaderDeclaration.SHADERDEFINE_VELOCITYOVERLIFETIMECONSTANT = Shader3D.getDefineByName(\"VELOCITYOVERLIFETIMECONSTANT\");\r\n\t\tShuriKenParticle3DShaderDeclaration.SHADERDEFINE_VELOCITYOVERLIFETIMECURVE = Shader3D.getDefineByName(\"VELOCITYOVERLIFETIMECURVE\");\r\n\t\tShuriKenParticle3DShaderDeclaration.SHADERDEFINE_VELOCITYOVERLIFETIMERANDOMCONSTANT = Shader3D.getDefineByName(\"VELOCITYOVERLIFETIMERANDOMCONSTANT\");\r\n\t\tShuriKenParticle3DShaderDeclaration.SHADERDEFINE_VELOCITYOVERLIFETIMERANDOMCURVE = Shader3D.getDefineByName(\"VELOCITYOVERLIFETIMERANDOMCURVE\");\r\n\r\n\t\tShuriKenParticle3DShaderDeclaration.SHADERDEFINE_TEXTURESHEETANIMATIONCURVE = Shader3D.getDefineByName(\"TEXTURESHEETANIMATIONCURVE\");\r\n\t\tShuriKenParticle3DShaderDeclaration.SHADERDEFINE_TEXTURESHEETANIMATIONRANDOMCURVE = Shader3D.getDefineByName(\"TEXTURESHEETANIMATIONRANDOMCURVE\");\r\n\t\tShuriKenParticle3DShaderDeclaration.SHADERDEFINE_ROTATIONOVERLIFETIME = Shader3D.getDefineByName(\"ROTATIONOVERLIFETIME\");\r\n\t\tShuriKenParticle3DShaderDeclaration.SHADERDEFINE_ROTATIONOVERLIFETIMESEPERATE = Shader3D.getDefineByName(\"ROTATIONOVERLIFETIMESEPERATE\");\r\n\t\tShuriKenParticle3DShaderDeclaration.SHADERDEFINE_ROTATIONOVERLIFETIMECONSTANT = Shader3D.getDefineByName(\"ROTATIONOVERLIFETIMECONSTANT\");\r\n\t\tShuriKenParticle3DShaderDeclaration.SHADERDEFINE_ROTATIONOVERLIFETIMECURVE = Shader3D.getDefineByName(\"ROTATIONOVERLIFETIMECURVE\");\r\n\t\tShuriKenParticle3DShaderDeclaration.SHADERDEFINE_ROTATIONOVERLIFETIMERANDOMCONSTANTS = Shader3D.getDefineByName(\"ROTATIONOVERLIFETIMERANDOMCONSTANTS\");\r\n\t\tShuriKenParticle3DShaderDeclaration.SHADERDEFINE_ROTATIONOVERLIFETIMERANDOMCURVES = Shader3D.getDefineByName(\"ROTATIONOVERLIFETIMERANDOMCURVES\");\r\n\t\tShuriKenParticle3DShaderDeclaration.SHADERDEFINE_SIZEOVERLIFETIMECURVE = Shader3D.getDefineByName(\"SIZEOVERLIFETIMECURVE\");\r\n\t\tShuriKenParticle3DShaderDeclaration.SHADERDEFINE_SIZEOVERLIFETIMECURVESEPERATE = Shader3D.getDefineByName(\"SIZEOVERLIFETIMECURVESEPERATE\");\r\n\t\tShuriKenParticle3DShaderDeclaration.SHADERDEFINE_SIZEOVERLIFETIMERANDOMCURVES = Shader3D.getDefineByName(\"SIZEOVERLIFETIMERANDOMCURVES\");\r\n\t\tShuriKenParticle3DShaderDeclaration.SHADERDEFINE_SIZEOVERLIFETIMERANDOMCURVESSEPERATE = Shader3D.getDefineByName(\"SIZEOVERLIFETIMERANDOMCURVESSEPERATE\");\r\n\t\tShuriKenParticle3DShaderDeclaration.SHADERDEFINE_RENDERMODE_MESH = Shader3D.getDefineByName(\"RENDERMODE_MESH\");\r\n\t\tShuriKenParticle3DShaderDeclaration.SHADERDEFINE_SHAPE = Shader3D.getDefineByName(\"SHAPE\");\r\n\r\n\r\n\r\n\t\t//Base\r\n\t\tShuriKenParticle3DShaderDeclaration.WORLDPOSITION = Shader3D.propertyNameToID(\"u_WorldPosition\");\r\n\t\tShuriKenParticle3DShaderDeclaration.WORLDROTATION = Shader3D.propertyNameToID(\"u_WorldRotation\");\r\n\t\tShuriKenParticle3DShaderDeclaration.POSITIONSCALE = Shader3D.propertyNameToID(\"u_PositionScale\");\r\n\t\tShuriKenParticle3DShaderDeclaration.SIZESCALE = Shader3D.propertyNameToID(\"u_SizeScale\");\r\n\t\tShuriKenParticle3DShaderDeclaration.SCALINGMODE = Shader3D.propertyNameToID(\"u_ScalingMode\");\r\n\t\tShuriKenParticle3DShaderDeclaration.GRAVITY = Shader3D.propertyNameToID(\"u_Gravity\");\r\n\t\tShuriKenParticle3DShaderDeclaration.THREEDSTARTROTATION = Shader3D.propertyNameToID(\"u_ThreeDStartRotation\");\r\n\t\tShuriKenParticle3DShaderDeclaration.STRETCHEDBILLBOARDLENGTHSCALE = Shader3D.propertyNameToID(\"u_StretchedBillboardLengthScale\");\r\n\t\tShuriKenParticle3DShaderDeclaration.STRETCHEDBILLBOARDSPEEDSCALE = Shader3D.propertyNameToID(\"u_StretchedBillboardSpeedScale\");\r\n\t\tShuriKenParticle3DShaderDeclaration.SIMULATIONSPACE = Shader3D.propertyNameToID(\"u_SimulationSpace\");\r\n\t\tShuriKenParticle3DShaderDeclaration.CURRENTTIME = Shader3D.propertyNameToID(\"u_CurrentTime\");\r\n\t\tShuriKenParticle3DShaderDeclaration.DRAG = Shader3D.propertyNameToID(\"u_DragConstanct\");\r\n\r\n\t\t//VelocityOverLifetime\r\n\t\tShuriKenParticle3DShaderDeclaration.VOLVELOCITYCONST = Shader3D.propertyNameToID(\"u_VOLVelocityConst\");\r\n\t\tShuriKenParticle3DShaderDeclaration.VOLVELOCITYGRADIENTX = Shader3D.propertyNameToID(\"u_VOLVelocityGradientX\");\r\n\t\tShuriKenParticle3DShaderDeclaration.VOLVELOCITYGRADIENTY = Shader3D.propertyNameToID(\"u_VOLVelocityGradientY\");\r\n\t\tShuriKenParticle3DShaderDeclaration.VOLVELOCITYGRADIENTZ = Shader3D.propertyNameToID(\"u_VOLVelocityGradientZ\");\r\n\t\tShuriKenParticle3DShaderDeclaration.VOLVELOCITYCONSTMAX = Shader3D.propertyNameToID(\"u_VOLVelocityConstMax\");\r\n\t\tShuriKenParticle3DShaderDeclaration.VOLVELOCITYGRADIENTXMAX = Shader3D.propertyNameToID(\"u_VOLVelocityGradientMaxX\");\r\n\t\tShuriKenParticle3DShaderDeclaration.VOLVELOCITYGRADIENTYMAX = Shader3D.propertyNameToID(\"u_VOLVelocityGradientMaxY\");\r\n\t\tShuriKenParticle3DShaderDeclaration.VOLVELOCITYGRADIENTZMAX = Shader3D.propertyNameToID(\"u_VOLVelocityGradientMaxZ\");\r\n\t\tShuriKenParticle3DShaderDeclaration.VOLSPACETYPE = Shader3D.propertyNameToID(\"u_VOLSpaceType\");\r\n\r\n\t\t//ColorOverLifetime\r\n\t\tShuriKenParticle3DShaderDeclaration.COLOROVERLIFEGRADIENTALPHAS = Shader3D.propertyNameToID(\"u_ColorOverLifeGradientAlphas\");\r\n\t\tShuriKenParticle3DShaderDeclaration.COLOROVERLIFEGRADIENTCOLORS = Shader3D.propertyNameToID(\"u_ColorOverLifeGradientColors\");\r\n\t\tShuriKenParticle3DShaderDeclaration.COLOROVERLIFEGRADIENTRANGES = Shader3D.propertyNameToID(\"u_ColorOverLifeGradientRanges\");\r\n\t\tShuriKenParticle3DShaderDeclaration.MAXCOLOROVERLIFEGRADIENTALPHAS = Shader3D.propertyNameToID(\"u_MaxColorOverLifeGradientAlphas\");\r\n\t\tShuriKenParticle3DShaderDeclaration.MAXCOLOROVERLIFEGRADIENTCOLORS = Shader3D.propertyNameToID(\"u_MaxColorOverLifeGradientColors\");\r\n\t\tShuriKenParticle3DShaderDeclaration.MAXCOLOROVERLIFEGRADIENTRANGES = Shader3D.propertyNameToID(\"u_MaxColorOverLifeGradientRanges\");\r\n\r\n\t\t//SizeOverLifetime\r\n\t\tShuriKenParticle3DShaderDeclaration.SOLSIZEGRADIENT = Shader3D.propertyNameToID(\"u_SOLSizeGradient\");\r\n\t\tShuriKenParticle3DShaderDeclaration.SOLSIZEGRADIENTX = Shader3D.propertyNameToID(\"u_SOLSizeGradientX\");\r\n\t\tShuriKenParticle3DShaderDeclaration.SOLSIZEGRADIENTY = Shader3D.propertyNameToID(\"u_SOLSizeGradientY\");\r\n\t\tShuriKenParticle3DShaderDeclaration.SOLSizeGradientZ = Shader3D.propertyNameToID(\"u_SOLSizeGradientZ\");\r\n\t\tShuriKenParticle3DShaderDeclaration.SOLSizeGradientMax = Shader3D.propertyNameToID(\"u_SOLSizeGradientMax\");\r\n\t\tShuriKenParticle3DShaderDeclaration.SOLSIZEGRADIENTXMAX = Shader3D.propertyNameToID(\"u_SOLSizeGradientMaxX\");\r\n\t\tShuriKenParticle3DShaderDeclaration.SOLSIZEGRADIENTYMAX = Shader3D.propertyNameToID(\"u_SOLSizeGradientMaxY\");\r\n\t\tShuriKenParticle3DShaderDeclaration.SOLSizeGradientZMAX = Shader3D.propertyNameToID(\"u_SOLSizeGradientMaxZ\");\r\n\r\n\t\t//RotationOverLifetime\r\n\t\tShuriKenParticle3DShaderDeclaration.ROLANGULARVELOCITYCONST = Shader3D.propertyNameToID(\"u_ROLAngularVelocityConst\");\r\n\t\tShuriKenParticle3DShaderDeclaration.ROLANGULARVELOCITYCONSTSEPRARATE = Shader3D.propertyNameToID(\"u_ROLAngularVelocityConstSeprarate\");\r\n\t\tShuriKenParticle3DShaderDeclaration.ROLANGULARVELOCITYGRADIENT = Shader3D.propertyNameToID(\"u_ROLAngularVelocityGradient\");\r\n\t\tShuriKenParticle3DShaderDeclaration.ROLANGULARVELOCITYGRADIENTX = Shader3D.propertyNameToID(\"u_ROLAngularVelocityGradientX\");\r\n\t\tShuriKenParticle3DShaderDeclaration.ROLANGULARVELOCITYGRADIENTY = Shader3D.propertyNameToID(\"u_ROLAngularVelocityGradientY\");\r\n\t\tShuriKenParticle3DShaderDeclaration.ROLANGULARVELOCITYGRADIENTZ = Shader3D.propertyNameToID(\"u_ROLAngularVelocityGradientZ\");\r\n\t\tShuriKenParticle3DShaderDeclaration.ROLANGULARVELOCITYCONSTMAX = Shader3D.propertyNameToID(\"u_ROLAngularVelocityConstMax\");\r\n\t\tShuriKenParticle3DShaderDeclaration.ROLANGULARVELOCITYCONSTMAXSEPRARATE = Shader3D.propertyNameToID(\"u_ROLAngularVelocityConstMaxSeprarate\");\r\n\t\tShuriKenParticle3DShaderDeclaration.ROLANGULARVELOCITYGRADIENTMAX = Shader3D.propertyNameToID(\"u_ROLAngularVelocityGradientMax\");\r\n\t\tShuriKenParticle3DShaderDeclaration.ROLANGULARVELOCITYGRADIENTXMAX = Shader3D.propertyNameToID(\"u_ROLAngularVelocityGradientMaxX\");\r\n\t\tShuriKenParticle3DShaderDeclaration.ROLANGULARVELOCITYGRADIENTYMAX = Shader3D.propertyNameToID(\"u_ROLAngularVelocityGradientMaxY\");\r\n\t\tShuriKenParticle3DShaderDeclaration.ROLANGULARVELOCITYGRADIENTZMAX = Shader3D.propertyNameToID(\"u_ROLAngularVelocityGradientMaxZ\");\r\n\t\tShuriKenParticle3DShaderDeclaration.ROLANGULARVELOCITYGRADIENTWMAX = Shader3D.propertyNameToID(\"u_ROLAngularVelocityGradientMaxW\");\r\n\r\n\t\t//TextureSheetAnimation\r\n\t\tShuriKenParticle3DShaderDeclaration.TEXTURESHEETANIMATIONCYCLES = Shader3D.propertyNameToID(\"u_TSACycles\");\r\n\t\tShuriKenParticle3DShaderDeclaration.TEXTURESHEETANIMATIONSUBUVLENGTH = Shader3D.propertyNameToID(\"u_TSASubUVLength\");\r\n\t\tShuriKenParticle3DShaderDeclaration.TEXTURESHEETANIMATIONGRADIENTUVS = Shader3D.propertyNameToID(\"u_TSAGradientUVs\");\r\n\t\tShuriKenParticle3DShaderDeclaration.TEXTURESHEETANIMATIONGRADIENTMAXUVS = Shader3D.propertyNameToID(\"u_TSAMaxGradientUVs\");\r\n\r\n\r\n\r\n\r\n\t\tlet uniformMap = LayaGL.renderOBJCreate.createGlobalUniformMap(\"ShurikenSprite3D\");\r\n\t\t//TODO\r\n\t\tuniformMap.addShaderUniform(ShuriKenParticle3DShaderDeclaration.WORLDPOSITION, 'u_WorldPosition',ShaderDataType.Vector3),\r\n\t\tuniformMap.addShaderUniform(ShuriKenParticle3DShaderDeclaration.WORLDROTATION, 'u_WorldRotation',ShaderDataType.Vector4);\r\n\t\tuniformMap.addShaderUniform(ShuriKenParticle3DShaderDeclaration.POSITIONSCALE, 'u_PositionScale',ShaderDataType.Vector3);\r\n\t\tuniformMap.addShaderUniform(ShuriKenParticle3DShaderDeclaration.SIZESCALE, 'u_SizeScale',ShaderDataType.Vector3);\r\n\t\tuniformMap.addShaderUniform(ShuriKenParticle3DShaderDeclaration.SCALINGMODE, 'u_ScalingMode',ShaderDataType.Int);\r\n\t\tuniformMap.addShaderUniform(ShuriKenParticle3DShaderDeclaration.GRAVITY, 'u_Gravity',ShaderDataType.Vector3);\r\n\t\tuniformMap.addShaderUniform(ShuriKenParticle3DShaderDeclaration.THREEDSTARTROTATION, 'u_ThreeDStartRotation',ShaderDataType.Bool);\r\n\t\tuniformMap.addShaderUniform(ShuriKenParticle3DShaderDeclaration.STRETCHEDBILLBOARDLENGTHSCALE, 'u_StretchedBillboardLengthScale',ShaderDataType.Float);\r\n\t\tuniformMap.addShaderUniform(ShuriKenParticle3DShaderDeclaration.STRETCHEDBILLBOARDSPEEDSCALE, 'u_StretchedBillboardSpeedScale',ShaderDataType.Float);\r\n\t\tuniformMap.addShaderUniform(ShuriKenParticle3DShaderDeclaration.SIMULATIONSPACE, 'u_SimulationSpace',ShaderDataType.Int);\r\n\t\tuniformMap.addShaderUniform(ShuriKenParticle3DShaderDeclaration.CURRENTTIME, 'u_CurrentTime',ShaderDataType.Vector2);\r\n\t\tuniformMap.addShaderUniform(ShuriKenParticle3DShaderDeclaration.COLOROVERLIFEGRADIENTALPHAS, 'u_ColorOverLifeGradientAlphas',ShaderDataType.Buffer);\r\n\t\tuniformMap.addShaderUniform(ShuriKenParticle3DShaderDeclaration.COLOROVERLIFEGRADIENTCOLORS, 'u_ColorOverLifeGradientColors',ShaderDataType.Buffer);\r\n\t\tuniformMap.addShaderUniform(ShuriKenParticle3DShaderDeclaration.COLOROVERLIFEGRADIENTRANGES, 'u_ColorOverLifeGradientRanges',ShaderDataType.Vector4);\r\n\t\tuniformMap.addShaderUniform(ShuriKenParticle3DShaderDeclaration.MAXCOLOROVERLIFEGRADIENTALPHAS, 'u_MaxColorOverLifeGradientAlphas',ShaderDataType.Buffer);\r\n\t\tuniformMap.addShaderUniform(ShuriKenParticle3DShaderDeclaration.MAXCOLOROVERLIFEGRADIENTCOLORS, 'u_MaxColorOverLifeGradientColors',ShaderDataType.Buffer);\r\n\t\tuniformMap.addShaderUniform(ShuriKenParticle3DShaderDeclaration.MAXCOLOROVERLIFEGRADIENTRANGES, 'u_MaxColorOverLifeGradientRanges',ShaderDataType.Vector4);\r\n\t\tuniformMap.addShaderUniform(ShuriKenParticle3DShaderDeclaration.VOLVELOCITYCONST, 'u_VOLVelocityConst',ShaderDataType.Vector3);\r\n\t\tuniformMap.addShaderUniform(ShuriKenParticle3DShaderDeclaration.VOLVELOCITYGRADIENTX, 'u_VOLVelocityGradientX',ShaderDataType.Buffer);\r\n\t\tuniformMap.addShaderUniform(ShuriKenParticle3DShaderDeclaration.VOLVELOCITYGRADIENTY, 'u_VOLVelocityGradientY',ShaderDataType.Buffer);\r\n\t\tuniformMap.addShaderUniform(ShuriKenParticle3DShaderDeclaration.VOLVELOCITYGRADIENTZ, 'u_VOLVelocityGradientZ',ShaderDataType.Buffer);\r\n\t\tuniformMap.addShaderUniform(ShuriKenParticle3DShaderDeclaration.VOLVELOCITYCONSTMAX, 'u_VOLVelocityConstMax',ShaderDataType.Vector3);\r\n\t\tuniformMap.addShaderUniform(ShuriKenParticle3DShaderDeclaration.VOLVELOCITYGRADIENTXMAX, 'u_VOLVelocityGradientMaxX',ShaderDataType.Buffer);\r\n\t\tuniformMap.addShaderUniform(ShuriKenParticle3DShaderDeclaration.VOLVELOCITYGRADIENTYMAX, 'u_VOLVelocityGradientMaxY',ShaderDataType.Buffer);\r\n\t\tuniformMap.addShaderUniform(ShuriKenParticle3DShaderDeclaration.VOLVELOCITYGRADIENTZMAX, 'u_VOLVelocityGradientMaxZ',ShaderDataType.Buffer);\r\n\t\tuniformMap.addShaderUniform(ShuriKenParticle3DShaderDeclaration.VOLSPACETYPE, 'u_VOLSpaceType',ShaderDataType.Int);\r\n\t\tuniformMap.addShaderUniform(ShuriKenParticle3DShaderDeclaration.SOLSIZEGRADIENT, 'u_SOLSizeGradient',ShaderDataType.Buffer);\r\n\t\tuniformMap.addShaderUniform(ShuriKenParticle3DShaderDeclaration.SOLSIZEGRADIENTX, 'u_SOLSizeGradientX',ShaderDataType.Buffer);\r\n\t\tuniformMap.addShaderUniform(ShuriKenParticle3DShaderDeclaration.SOLSIZEGRADIENTY, 'u_SOLSizeGradientY',ShaderDataType.Buffer);\r\n\t\tuniformMap.addShaderUniform(ShuriKenParticle3DShaderDeclaration.SOLSizeGradientZ, 'u_SOLSizeGradientZ',ShaderDataType.Buffer);\r\n\t\tuniformMap.addShaderUniform(ShuriKenParticle3DShaderDeclaration.SOLSizeGradientMax, 'u_SOLSizeGradientMax',ShaderDataType.Buffer);\r\n\t\tuniformMap.addShaderUniform(ShuriKenParticle3DShaderDeclaration.SOLSIZEGRADIENTXMAX, 'u_SOLSizeGradientMaxX',ShaderDataType.Buffer);\r\n\t\tuniformMap.addShaderUniform(ShuriKenParticle3DShaderDeclaration.SOLSIZEGRADIENTYMAX, 'u_SOLSizeGradientMaxY',ShaderDataType.Buffer);\r\n\t\tuniformMap.addShaderUniform(ShuriKenParticle3DShaderDeclaration.SOLSizeGradientZMAX, 'u_SOLSizeGradientMaxZ',ShaderDataType.Buffer);\r\n\t\tuniformMap.addShaderUniform(ShuriKenParticle3DShaderDeclaration.ROLANGULARVELOCITYCONST, 'u_ROLAngularVelocityConst',ShaderDataType.Float);\r\n\t\tuniformMap.addShaderUniform(ShuriKenParticle3DShaderDeclaration.ROLANGULARVELOCITYCONSTSEPRARATE, 'u_ROLAngularVelocityConstSeprarate',ShaderDataType.Vector3);\r\n\t\tuniformMap.addShaderUniform(ShuriKenParticle3DShaderDeclaration.ROLANGULARVELOCITYGRADIENT, 'u_ROLAngularVelocityGradient',ShaderDataType.Buffer);\r\n\t\tuniformMap.addShaderUniform(ShuriKenParticle3DShaderDeclaration.ROLANGULARVELOCITYGRADIENTX, 'u_ROLAngularVelocityGradientX',ShaderDataType.Buffer);\r\n\t\tuniformMap.addShaderUniform(ShuriKenParticle3DShaderDeclaration.ROLANGULARVELOCITYGRADIENTY, 'u_ROLAngularVelocityGradientY',ShaderDataType.Buffer);\r\n\t\tuniformMap.addShaderUniform(ShuriKenParticle3DShaderDeclaration.ROLANGULARVELOCITYGRADIENTZ, 'u_ROLAngularVelocityGradientZ',ShaderDataType.Buffer);\r\n\t\tuniformMap.addShaderUniform(ShuriKenParticle3DShaderDeclaration.ROLANGULARVELOCITYCONSTMAX, 'u_ROLAngularVelocityConstMax',ShaderDataType.Float);\r\n\t\tuniformMap.addShaderUniform(ShuriKenParticle3DShaderDeclaration.ROLANGULARVELOCITYCONSTMAXSEPRARATE, 'u_ROLAngularVelocityConstMaxSeprarate',ShaderDataType.Vector3);\r\n\t\tuniformMap.addShaderUniform(ShuriKenParticle3DShaderDeclaration.ROLANGULARVELOCITYGRADIENTMAX, 'u_ROLAngularVelocityGradientMax',ShaderDataType.Buffer);\r\n\t\tuniformMap.addShaderUniform(ShuriKenParticle3DShaderDeclaration.ROLANGULARVELOCITYGRADIENTXMAX, 'u_ROLAngularVelocityGradientMaxX',ShaderDataType.Buffer);\r\n\t\tuniformMap.addShaderUniform(ShuriKenParticle3DShaderDeclaration.ROLANGULARVELOCITYGRADIENTYMAX, 'u_ROLAngularVelocityGradientMaxY',ShaderDataType.Buffer);\r\n\t\tuniformMap.addShaderUniform(ShuriKenParticle3DShaderDeclaration.ROLANGULARVELOCITYGRADIENTZMAX, 'u_ROLAngularVelocityGradientMaxZ',ShaderDataType.Buffer);\r\n\t\tuniformMap.addShaderUniform(ShuriKenParticle3DShaderDeclaration.ROLANGULARVELOCITYGRADIENTWMAX, 'u_ROLAngularVelocityGradientMaxW',ShaderDataType.Buffer);\r\n\t\tuniformMap.addShaderUniform(ShuriKenParticle3DShaderDeclaration.TEXTURESHEETANIMATIONCYCLES, 'u_TSACycles',ShaderDataType.Float);\r\n\t\tuniformMap.addShaderUniform(ShuriKenParticle3DShaderDeclaration.TEXTURESHEETANIMATIONSUBUVLENGTH, 'u_TSASubUVLength',ShaderDataType.Vector2);\r\n\t\tuniformMap.addShaderUniform(ShuriKenParticle3DShaderDeclaration.TEXTURESHEETANIMATIONGRADIENTUVS, 'u_TSAGradientUVs',ShaderDataType.Vector2);\r\n\t\tuniformMap.addShaderUniform(ShuriKenParticle3DShaderDeclaration.TEXTURESHEETANIMATIONGRADIENTMAXUVS, 'u_TSAMaxGradientUVs',ShaderDataType.Vector2);\r\n\t\tuniformMap.addShaderUniform(ShuriKenParticle3DShaderDeclaration.DRAG, 'u_DragConstanct',ShaderDataType.Vector2);\r\n\t}\r\n}","import { MathUtil } from \"../../../maths/MathUtil\";\r\nimport { Vector2 } from \"../../../maths/Vector2\";\r\nimport { Vector3 } from \"../../../maths/Vector3\";\r\nimport { Vector4 } from \"../../../maths/Vector4\";\r\nimport { Rand } from \"../../math/Rand\";\r\nimport { ColorOverLifetime } from \"./module/ColorOverLifetime\";\r\nimport { FrameOverTime } from \"./module/FrameOverTime\";\r\nimport { GradientColor } from \"./module/GradientColor\";\r\nimport { GradientDataNumber } from \"./module/GradientDataNumber\";\r\nimport { GradientSize } from \"./module/GradientSize\";\r\nimport { SizeOverLifetime } from \"./module/SizeOverLifetime\";\r\nimport { StartFrame } from \"./module/StartFrame\";\r\nimport { TextureSheetAnimation } from \"./module/TextureSheetAnimation\";\r\nimport { ShurikenParticleRenderer } from \"./ShurikenParticleRenderer\";\r\nimport { ShurikenParticleSystem } from \"./ShurikenParticleSystem\";\r\n\r\n/**\r\n *  @internal\r\n */\r\nexport class ShurikenParticleData {\r\n\t/**@internal */\r\n\tprivate static _tempVector30: Vector3 = new Vector3();\r\n\r\n\tstatic startLifeTime: number;\r\n\tstatic startColor: Vector4 = new Vector4();\r\n\tstatic startSize: Float32Array = new Float32Array(3);\r\n\tstatic startRotation: Float32Array = new Float32Array(3);\r\n\tstatic startUVInfo: Float32Array = new Float32Array(4);\r\n\r\n\tconstructor() {\r\n\t}\r\n\r\n\t/**\r\n\t * @internal\r\n\t */\r\n\tprivate static _getStartLifetimeFromGradient(startLifeTimeGradient: GradientDataNumber, emissionTime: number): number {\r\n\t\tfor (var i: number = 1, n: number = startLifeTimeGradient.gradientCount; i < n; i++) {\r\n\t\t\tvar key: number = startLifeTimeGradient.getKeyByIndex(i);\r\n\t\t\tif (key >= emissionTime) {\r\n\t\t\t\tvar lastKey: number = startLifeTimeGradient.getKeyByIndex(i - 1);\r\n\t\t\t\tvar age: number = (emissionTime - lastKey) / (key - lastKey);\r\n\t\t\t\treturn MathUtil.lerp(startLifeTimeGradient.getValueByIndex(i - 1), startLifeTimeGradient.getValueByIndex(i), age)\r\n\t\t\t}\r\n\t\t}\r\n\t\tthrow new Error(\"ShurikenParticleData: can't get value foam startLifeTimeGradient.\");\r\n\t}\r\n\r\n\t/**\r\n\t * @internal\r\n\t */\r\n\tprivate static _randomInvertRoationArray(rotatonE: Vector3, outE: Vector3, randomizeRotationDirection: number, rand: Rand, randomSeeds: Uint32Array): void {\r\n\t\tvar randDic: number;\r\n\t\tif (rand) {\r\n\t\t\trand.seed = randomSeeds[6];\r\n\t\t\trandDic = rand.getFloat();\r\n\t\t\trandomSeeds[6] = rand.seed;\r\n\t\t} else {\r\n\t\t\trandDic = Math.random();\r\n\t\t}\r\n\t\tif (randDic < randomizeRotationDirection) {\r\n\t\t\toutE.x = -rotatonE.x;\r\n\t\t\toutE.y = -rotatonE.y;\r\n\t\t\toutE.z = -rotatonE.z;\r\n\t\t} else {\r\n\t\t\toutE.x = rotatonE.x;\r\n\t\t\toutE.y = rotatonE.y;\r\n\t\t\toutE.z = rotatonE.z;\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @internal\r\n\t */\r\n\tprivate static _randomInvertRoation(rotaton: number, randomizeRotationDirection: number, rand: Rand, randomSeeds: Uint32Array): number {\r\n\t\tvar randDic: number;\r\n\t\tif (rand) {\r\n\t\t\trand.seed = randomSeeds[6];\r\n\t\t\trandDic = rand.getFloat();\r\n\t\t\trandomSeeds[6] = rand.seed;\r\n\t\t} else {\r\n\t\t\trandDic = Math.random();\r\n\t\t}\r\n\t\tif (randDic < randomizeRotationDirection)\r\n\t\t\trotaton = -rotaton;\r\n\t\treturn rotaton;\r\n\t}\r\n\r\n\t/**\r\n\t * @internal\r\n\t */\r\n\tstatic create(particleSystem: ShurikenParticleSystem, particleRender: ShurikenParticleRenderer): void {\r\n\t\tvar autoRandomSeed: boolean = particleSystem.autoRandomSeed;\r\n\t\tvar rand: Rand = particleSystem._rand;\r\n\t\tvar randomSeeds: Uint32Array = particleSystem._randomSeeds;\r\n\r\n\t\t//StartColor\r\n\t\tswitch (particleSystem.startColorType) {\r\n\t\t\tcase 0:\r\n\t\t\t\tvar constantStartColor: Vector4 = particleSystem.startColorConstant;\r\n\t\t\t\tShurikenParticleData.startColor.x = constantStartColor.x;\r\n\t\t\t\tShurikenParticleData.startColor.y = constantStartColor.y;\r\n\t\t\t\tShurikenParticleData.startColor.z = constantStartColor.z;\r\n\t\t\t\tShurikenParticleData.startColor.w = constantStartColor.w;\r\n\t\t\t\tbreak;\r\n\t\t\tcase 2:\r\n\t\t\t\tif (autoRandomSeed) {\r\n\t\t\t\t\tVector4.lerp(particleSystem.startColorConstantMin, particleSystem.startColorConstantMax, Math.random(), ShurikenParticleData.startColor);\r\n\t\t\t\t} else {\r\n\t\t\t\t\trand.seed = randomSeeds[3];\r\n\t\t\t\t\tVector4.lerp(particleSystem.startColorConstantMin, particleSystem.startColorConstantMax, rand.getFloat(), ShurikenParticleData.startColor);\r\n\t\t\t\t\trandomSeeds[3] = rand.seed;\r\n\t\t\t\t}\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\t\tvar colorOverLifetime: ColorOverLifetime = particleSystem.colorOverLifetime;\r\n\t\tif (colorOverLifetime && colorOverLifetime.enable) {\r\n\t\t\tvar color: GradientColor = colorOverLifetime.color;\r\n\t\t\tswitch (color.type) {\r\n\t\t\t\tcase 0:\r\n\t\t\t\t\tShurikenParticleData.startColor.x = ShurikenParticleData.startColor.x * color.constant.x;\r\n\t\t\t\t\tShurikenParticleData.startColor.y = ShurikenParticleData.startColor.y * color.constant.y;\r\n\t\t\t\t\tShurikenParticleData.startColor.z = ShurikenParticleData.startColor.z * color.constant.z;\r\n\t\t\t\t\tShurikenParticleData.startColor.w = ShurikenParticleData.startColor.w * color.constant.w;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 2:\r\n\t\t\t\t\tvar colorRandom: number;\r\n\t\t\t\t\tif (autoRandomSeed) {\r\n\t\t\t\t\t\tcolorRandom = Math.random();\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\trand.seed = randomSeeds[10];\r\n\t\t\t\t\t\tcolorRandom = rand.getFloat();\r\n\t\t\t\t\t\trandomSeeds[10] = rand.seed;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tvar minConstantColor: Vector4 = color.constantMin;\r\n\t\t\t\t\tvar maxConstantColor: Vector4 = color.constantMax;\r\n\t\t\t\t\tShurikenParticleData.startColor.x = ShurikenParticleData.startColor.x * MathUtil.lerp(minConstantColor.x, maxConstantColor.x, colorRandom);\r\n\t\t\t\t\tShurikenParticleData.startColor.y = ShurikenParticleData.startColor.y * MathUtil.lerp(minConstantColor.y, maxConstantColor.y, colorRandom);\r\n\t\t\t\t\tShurikenParticleData.startColor.z = ShurikenParticleData.startColor.z * MathUtil.lerp(minConstantColor.z, maxConstantColor.z, colorRandom);\r\n\t\t\t\t\tShurikenParticleData.startColor.w = ShurikenParticleData.startColor.w * MathUtil.lerp(minConstantColor.w, maxConstantColor.w, colorRandom);\r\n\t\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t//StartSize\r\n\t\tvar particleSize: Float32Array = ShurikenParticleData.startSize;\r\n\t\tswitch (particleSystem.startSizeType) {\r\n\t\t\tcase 0:\r\n\t\t\t\tif (particleSystem.threeDStartSize) {\r\n\t\t\t\t\tvar startSizeConstantSeparate: Vector3 = particleSystem.startSizeConstantSeparate;\r\n\t\t\t\t\tparticleSize[0] = startSizeConstantSeparate.x;\r\n\t\t\t\t\tparticleSize[1] = startSizeConstantSeparate.y;\r\n\t\t\t\t\tparticleSize[2] = startSizeConstantSeparate.z;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tparticleSize[0] = particleSize[1] = particleSize[2] = particleSystem.startSizeConstant;\r\n\t\t\t\t}\r\n\t\t\t\tbreak;\r\n\t\t\tcase 2:\r\n\t\t\t\tif (particleSystem.threeDStartSize) {\r\n\t\t\t\t\tvar startSizeConstantMinSeparate: Vector3 = particleSystem.startSizeConstantMinSeparate;\r\n\t\t\t\t\tvar startSizeConstantMaxSeparate: Vector3 = particleSystem.startSizeConstantMaxSeparate;\r\n\t\t\t\t\tif (autoRandomSeed) {\r\n\t\t\t\t\t\tparticleSize[0] = MathUtil.lerp(startSizeConstantMinSeparate.x, startSizeConstantMaxSeparate.x, Math.random());\r\n\t\t\t\t\t\tparticleSize[1] = MathUtil.lerp(startSizeConstantMinSeparate.y, startSizeConstantMaxSeparate.y, Math.random());\r\n\t\t\t\t\t\tparticleSize[2] = MathUtil.lerp(startSizeConstantMinSeparate.z, startSizeConstantMaxSeparate.z, Math.random());\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\trand.seed = randomSeeds[4];\r\n\t\t\t\t\t\tparticleSize[0] = MathUtil.lerp(startSizeConstantMinSeparate.x, startSizeConstantMaxSeparate.x, rand.getFloat());\r\n\t\t\t\t\t\tparticleSize[1] = MathUtil.lerp(startSizeConstantMinSeparate.y, startSizeConstantMaxSeparate.y, rand.getFloat());\r\n\t\t\t\t\t\tparticleSize[2] = MathUtil.lerp(startSizeConstantMinSeparate.z, startSizeConstantMaxSeparate.z, rand.getFloat());\r\n\t\t\t\t\t\trandomSeeds[4] = rand.seed;\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\tif (autoRandomSeed) {\r\n\t\t\t\t\t\tparticleSize[0] = particleSize[1] = particleSize[2] = MathUtil.lerp(particleSystem.startSizeConstantMin, particleSystem.startSizeConstantMax, Math.random());\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\trand.seed = randomSeeds[4];\r\n\t\t\t\t\t\tparticleSize[0] = particleSize[1] = particleSize[2] = MathUtil.lerp(particleSystem.startSizeConstantMin, particleSystem.startSizeConstantMax, rand.getFloat());\r\n\t\t\t\t\t\trandomSeeds[4] = rand.seed;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\r\n\t\tvar sizeOverLifetime: SizeOverLifetime = particleSystem.sizeOverLifetime;\r\n\t\tif (sizeOverLifetime && sizeOverLifetime.enable && sizeOverLifetime.size.type === 1) {\r\n\t\t\tvar size: GradientSize = sizeOverLifetime.size;\r\n\t\t\tif (size.separateAxes) {\r\n\t\t\t\tif (autoRandomSeed) {\r\n\t\t\t\t\tparticleSize[0] = particleSize[0] * MathUtil.lerp(size.constantMinSeparate.x, size.constantMaxSeparate.x, Math.random());\r\n\t\t\t\t\tparticleSize[1] = particleSize[1] * MathUtil.lerp(size.constantMinSeparate.y, size.constantMaxSeparate.y, Math.random());\r\n\t\t\t\t\tparticleSize[2] = particleSize[2] * MathUtil.lerp(size.constantMinSeparate.z, size.constantMaxSeparate.z, Math.random());\r\n\t\t\t\t} else {\r\n\t\t\t\t\trand.seed = randomSeeds[11];\r\n\t\t\t\t\tparticleSize[0] = particleSize[0] * MathUtil.lerp(size.constantMinSeparate.x, size.constantMaxSeparate.x, rand.getFloat());\r\n\t\t\t\t\tparticleSize[1] = particleSize[1] * MathUtil.lerp(size.constantMinSeparate.y, size.constantMaxSeparate.y, rand.getFloat());\r\n\t\t\t\t\tparticleSize[2] = particleSize[2] * MathUtil.lerp(size.constantMinSeparate.z, size.constantMaxSeparate.z, rand.getFloat());\r\n\t\t\t\t\trandomSeeds[11] = rand.seed;\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tvar randomSize: number;\r\n\t\t\t\tif (autoRandomSeed) {\r\n\t\t\t\t\trandomSize = MathUtil.lerp(size.constantMin, size.constantMax, Math.random());\r\n\t\t\t\t} else {\r\n\t\t\t\t\trand.seed = randomSeeds[11];\r\n\t\t\t\t\trandomSize = MathUtil.lerp(size.constantMin, size.constantMax, rand.getFloat());\r\n\t\t\t\t\trandomSeeds[11] = rand.seed;\r\n\t\t\t\t}\r\n\t\t\t\tparticleSize[0] = particleSize[0] * randomSize;\r\n\t\t\t\tparticleSize[1] = particleSize[1] * randomSize;\r\n\t\t\t\tparticleSize[2] = particleSize[2] * randomSize;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t//StartRotation//TODO:renderMode23\r\n\t\tvar renderMode: number = particleRender.renderMode;\r\n\t\tif (renderMode !== 1) {\r\n\t\t\tswitch (particleSystem.startRotationType) {\r\n\t\t\t\tcase 0:\r\n\t\t\t\t\tif (particleSystem.threeDStartRotation) {\r\n\t\t\t\t\t\tvar startRotationConstantSeparate: Vector3 = particleSystem.startRotationConstantSeparate;\r\n\t\t\t\t\t\tvar randomRotationE: Vector3 = ShurikenParticleData._tempVector30;\r\n\t\t\t\t\t\tShurikenParticleData._randomInvertRoationArray(startRotationConstantSeparate, randomRotationE, particleSystem.randomizeRotationDirection, autoRandomSeed ? null : rand, randomSeeds);\r\n\t\t\t\t\t\tShurikenParticleData.startRotation[0] = randomRotationE.x;\r\n\t\t\t\t\t\tShurikenParticleData.startRotation[1] = randomRotationE.y;\r\n\t\t\t\t\t\tif (renderMode !== 4)\r\n\t\t\t\t\t\t\tShurikenParticleData.startRotation[2] = -randomRotationE.z;\r\n\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\tShurikenParticleData.startRotation[2] = randomRotationE.z;\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tShurikenParticleData.startRotation[0] = ShurikenParticleData._randomInvertRoation(particleSystem.startRotationConstant, particleSystem.randomizeRotationDirection, autoRandomSeed ? null : rand, randomSeeds);\r\n\t\t\t\t\t\tShurikenParticleData.startRotation[1] = 0;\r\n\t\t\t\t\t\tShurikenParticleData.startRotation[2] = 0;//0,TODO:meshZ,X\r\n\t\t\t\t\t}\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 2:\r\n\t\t\t\t\tif (particleSystem.threeDStartRotation) {\r\n\t\t\t\t\t\tvar startRotationConstantMinSeparate: Vector3 = particleSystem.startRotationConstantMinSeparate;\r\n\t\t\t\t\t\tvar startRotationConstantMaxSeparate: Vector3 = particleSystem.startRotationConstantMaxSeparate;\r\n\t\t\t\t\t\tvar lerpRoationE: Vector3 = ShurikenParticleData._tempVector30;\r\n\t\t\t\t\t\tif (autoRandomSeed) {\r\n\t\t\t\t\t\t\tlerpRoationE.x = MathUtil.lerp(startRotationConstantMinSeparate.x, startRotationConstantMaxSeparate.x, Math.random());\r\n\t\t\t\t\t\t\tlerpRoationE.y = MathUtil.lerp(startRotationConstantMinSeparate.y, startRotationConstantMaxSeparate.y, Math.random());\r\n\t\t\t\t\t\t\tlerpRoationE.z = MathUtil.lerp(startRotationConstantMinSeparate.z, startRotationConstantMaxSeparate.z, Math.random());\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\trand.seed = randomSeeds[5];\r\n\t\t\t\t\t\t\tlerpRoationE.x = MathUtil.lerp(startRotationConstantMinSeparate.x, startRotationConstantMaxSeparate.x, rand.getFloat());\r\n\t\t\t\t\t\t\tlerpRoationE.y = MathUtil.lerp(startRotationConstantMinSeparate.y, startRotationConstantMaxSeparate.y, rand.getFloat());\r\n\t\t\t\t\t\t\tlerpRoationE.z = MathUtil.lerp(startRotationConstantMinSeparate.z, startRotationConstantMaxSeparate.z, rand.getFloat());\r\n\t\t\t\t\t\t\trandomSeeds[5] = rand.seed;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tShurikenParticleData._randomInvertRoationArray(lerpRoationE, lerpRoationE, particleSystem.randomizeRotationDirection, autoRandomSeed ? null : rand, randomSeeds);\r\n\t\t\t\t\t\tShurikenParticleData.startRotation[0] = lerpRoationE.x;\r\n\t\t\t\t\t\tShurikenParticleData.startRotation[1] = lerpRoationE.y;\r\n\t\t\t\t\t\tif (renderMode !== 4)\r\n\t\t\t\t\t\t\tShurikenParticleData.startRotation[2] = -lerpRoationE.z;\r\n\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\tShurikenParticleData.startRotation[2] = lerpRoationE.z;\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tif (autoRandomSeed) {\r\n\t\t\t\t\t\t\tShurikenParticleData.startRotation[0] = ShurikenParticleData._randomInvertRoation(MathUtil.lerp(particleSystem.startRotationConstantMin, particleSystem.startRotationConstantMax, Math.random()), particleSystem.randomizeRotationDirection, autoRandomSeed ? null : rand, randomSeeds);\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\trand.seed = randomSeeds[5];\r\n\t\t\t\t\t\t\tShurikenParticleData.startRotation[0] = ShurikenParticleData._randomInvertRoation(MathUtil.lerp(particleSystem.startRotationConstantMin, particleSystem.startRotationConstantMax, rand.getFloat()), particleSystem.randomizeRotationDirection, autoRandomSeed ? null : rand, randomSeeds);\r\n\t\t\t\t\t\t\trandomSeeds[5] = rand.seed;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t//StartLifetime\r\n\t\tswitch (particleSystem.startLifetimeType) {\r\n\t\t\tcase 0:\r\n\t\t\t\tShurikenParticleData.startLifeTime = particleSystem.startLifetimeConstant;\r\n\t\t\t\tbreak;\r\n\t\t\tcase 1:\r\n\t\t\t\tShurikenParticleData.startLifeTime = ShurikenParticleData._getStartLifetimeFromGradient(particleSystem.startLifeTimeGradient, particleSystem.emissionTime);\r\n\t\t\t\tbreak;\r\n\t\t\tcase 2:\r\n\t\t\t\tif (autoRandomSeed) {\r\n\t\t\t\t\tShurikenParticleData.startLifeTime = MathUtil.lerp(particleSystem.startLifetimeConstantMin, particleSystem.startLifetimeConstantMax, Math.random());\r\n\t\t\t\t} else {\r\n\t\t\t\t\trand.seed = randomSeeds[7];\r\n\t\t\t\t\tShurikenParticleData.startLifeTime = MathUtil.lerp(particleSystem.startLifetimeConstantMin, particleSystem.startLifetimeConstantMax, rand.getFloat());\r\n\t\t\t\t\trandomSeeds[7] = rand.seed;\r\n\t\t\t\t}\r\n\t\t\t\tbreak;\r\n\t\t\tcase 3:\r\n\t\t\t\tvar emissionTime: number = particleSystem.emissionTime;\r\n\t\t\t\tif (autoRandomSeed) {\r\n\t\t\t\t\tShurikenParticleData.startLifeTime = MathUtil.lerp(ShurikenParticleData._getStartLifetimeFromGradient(particleSystem.startLifeTimeGradientMin, emissionTime), ShurikenParticleData._getStartLifetimeFromGradient(particleSystem.startLifeTimeGradientMax, emissionTime), Math.random());\r\n\t\t\t\t} else {\r\n\t\t\t\t\trand.seed = randomSeeds[7];\r\n\t\t\t\t\tShurikenParticleData.startLifeTime = MathUtil.lerp(ShurikenParticleData._getStartLifetimeFromGradient(particleSystem.startLifeTimeGradientMin, emissionTime), ShurikenParticleData._getStartLifetimeFromGradient(particleSystem.startLifeTimeGradientMax, emissionTime), rand.getFloat());\r\n\t\t\t\t\trandomSeeds[7] = rand.seed;\r\n\t\t\t\t}\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\r\n\r\n\t\t//StartUV\r\n\t\tvar textureSheetAnimation: TextureSheetAnimation = particleSystem.textureSheetAnimation;\r\n\t\tvar enableSheetAnimation: boolean = textureSheetAnimation && textureSheetAnimation.enable;\r\n\t\tif (enableSheetAnimation) {\r\n\t\t\tvar title: Vector2 = textureSheetAnimation.tiles;\r\n\t\t\tvar titleX: number = title.x, titleY: number = title.y;\r\n\t\t\tvar subU: number = 1.0 / titleX, subV: number = 1.0 / titleY;\r\n\r\n\t\t\tvar startFrameCount: number;\r\n\t\t\tvar startFrame: StartFrame = textureSheetAnimation.startFrame;\r\n\t\t\tswitch (startFrame.type) {\r\n\t\t\t\tcase 0://\r\n\t\t\t\t\tstartFrameCount = startFrame.constant;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 1://\r\n\t\t\t\t\tif (autoRandomSeed) {\r\n\t\t\t\t\t\tstartFrameCount = MathUtil.lerp(startFrame.constantMin, startFrame.constantMax, Math.random());\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\trand.seed = randomSeeds[14];\r\n\t\t\t\t\t\tstartFrameCount = MathUtil.lerp(startFrame.constantMin, startFrame.constantMax, rand.getFloat());\r\n\t\t\t\t\t\trandomSeeds[14] = rand.seed;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tbreak;\r\n\t\t\t}\r\n\r\n\t\t\tvar frame: FrameOverTime = textureSheetAnimation.frame;\r\n\t\t\tvar cycles: number = textureSheetAnimation.cycles;\r\n\t\t\tswitch (frame.type) {\r\n\t\t\t\tcase 0:\r\n\t\t\t\t\tstartFrameCount += frame.constant * cycles;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 2:\r\n\t\t\t\t\tif (autoRandomSeed) {\r\n\t\t\t\t\t\tstartFrameCount += MathUtil.lerp(frame.constantMin, frame.constantMax, Math.random()) * cycles;\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\trand.seed = randomSeeds[15];\r\n\t\t\t\t\t\tstartFrameCount += MathUtil.lerp(frame.constantMin, frame.constantMax, rand.getFloat()) * cycles;\r\n\t\t\t\t\t\trandomSeeds[15] = rand.seed;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tbreak;\r\n\t\t\t}\r\n\r\n\t\t\tvar startRow: number = 0;//TODO:case 2 \r\n\t\t\tswitch (textureSheetAnimation.type) {\r\n\t\t\t\tcase 0://Whole Sheet\r\n\t\t\t\t\tstartRow = Math.floor(startFrameCount / titleX);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 1://Singal Row\r\n\t\t\t\t\tif (textureSheetAnimation.randomRow) {\r\n\t\t\t\t\t\tif (autoRandomSeed) {\r\n\t\t\t\t\t\t\tstartRow = Math.floor(Math.random() * titleY);\r\n\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\trand.seed = randomSeeds[13];\r\n\t\t\t\t\t\t\tstartRow = Math.floor(rand.getFloat() * titleY);\r\n\t\t\t\t\t\t\trandomSeeds[13] = rand.seed;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tstartRow = textureSheetAnimation.rowIndex;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tbreak;\r\n\t\t\t}\r\n\r\n\t\t\tvar startCol: number = Math.floor(startFrameCount % titleX);\r\n\t\t\tShurikenParticleData.startUVInfo = ShurikenParticleData.startUVInfo;\r\n\t\t\tShurikenParticleData.startUVInfo[0] = subU;\r\n\t\t\tShurikenParticleData.startUVInfo[1] = subV;\r\n\t\t\tShurikenParticleData.startUVInfo[2] = startCol * subU;\r\n\t\t\tShurikenParticleData.startUVInfo[3] = startRow * subV;\r\n\t\t} else {\r\n\t\t\tShurikenParticleData.startUVInfo = ShurikenParticleData.startUVInfo;\r\n\t\t\tShurikenParticleData.startUVInfo[0] = 1.0;\r\n\t\t\tShurikenParticleData.startUVInfo[1] = 1.0;\r\n\t\t\tShurikenParticleData.startUVInfo[2] = 0.0;\r\n\t\t\tShurikenParticleData.startUVInfo[3] = 0.0;\r\n\t\t}\r\n\r\n\t}\r\n\r\n}\r\n\r\n\r\n","import { MathUtil } from \"../../../maths/MathUtil\";\r\nimport { Resource } from \"../../../resource/Resource\";\r\nimport { Stat } from \"../../../utils/Stat\";\r\nimport { IndexBuffer3D } from \"../../graphics/IndexBuffer3D\";\r\nimport { VertexShurikenParticleBillboard } from \"../../graphics/Vertex/VertexShurikenParticleBillboard\";\r\nimport { VertexShurikenParticleMesh } from \"../../graphics/Vertex/VertexShurikenParticleMesh\";\r\nimport { VertexBuffer3D } from \"../../graphics/VertexBuffer3D\";\r\nimport { Rand } from \"../../math/Rand\";\r\nimport { Mesh } from \"../../resource/models/Mesh\";\r\nimport { GeometryElement } from \"../GeometryElement\";\r\nimport { Gradient } from \"../Gradient\";\r\nimport { IClone } from \"../../../utils/IClone\";\r\nimport { RenderContext3D } from \"../render/RenderContext3D\";\r\nimport { Scene3D } from \"../scene/Scene3D\";\r\nimport { Transform3D } from \"../Transform3D\";\r\nimport { Burst } from \"./module/Burst\";\r\nimport { ColorOverLifetime } from \"./module/ColorOverLifetime\";\r\nimport { Emission } from \"./module/Emission\";\r\nimport { FrameOverTime } from \"./module/FrameOverTime\";\r\nimport { GradientAngularVelocity } from \"./module/GradientAngularVelocity\";\r\nimport { GradientColor } from \"./module/GradientColor\";\r\nimport { GradientDataNumber } from \"./module/GradientDataNumber\";\r\nimport { GradientSize } from \"./module/GradientSize\";\r\nimport { GradientVelocity } from \"./module/GradientVelocity\";\r\nimport { RotationOverLifetime } from \"./module/RotationOverLifetime\";\r\nimport { BaseShape, ParticleSystemShapeType } from \"./module/shape/BaseShape\";\r\nimport { SizeOverLifetime } from \"./module/SizeOverLifetime\";\r\nimport { TextureSheetAnimation } from \"./module/TextureSheetAnimation\";\r\nimport { VelocityOverLifetime } from \"./module/VelocityOverLifetime\";\r\nimport { ShuriKenParticle3DShaderDeclaration } from \"./ShuriKenParticle3DShaderDeclaration\";\r\nimport { ShurikenParticleData } from \"./ShurikenParticleData\";\r\nimport { ShurikenParticleRenderer } from \"./ShurikenParticleRenderer\";\r\nimport { SphereShape } from \"./module/shape/SphereShape\";\r\nimport { HemisphereShape } from \"./module/shape/HemisphereShape\";\r\nimport { ConeShape } from \"./module/shape/ConeShape\";\r\nimport { CircleShape } from \"./module/shape/CircleShape\";\r\nimport { BoxShape } from \"./module/shape/BoxShape\";\r\nimport { VertexShuriKenParticle } from \"../../graphics/Vertex/VertexShuriKenParticle\";\r\nimport { Sprite3D } from \"../Sprite3D\";\r\nimport { BufferUsage } from \"../../../RenderEngine/RenderEnum/BufferTargetType\";\r\nimport { MeshTopology } from \"../../../RenderEngine/RenderEnum/RenderPologyMode\";\r\nimport { ShaderData } from \"../../../RenderEngine/RenderShader/ShaderData\";\r\nimport { VertexDeclaration } from \"../../../RenderEngine/VertexDeclaration\";\r\nimport { DrawType } from \"../../../RenderEngine/RenderEnum/DrawType\";\r\nimport { IndexFormat } from \"../../../RenderEngine/RenderEnum/IndexFormat\";\r\nimport { Bounds } from \"../../math/Bounds\";\r\nimport { Quaternion } from \"../../../maths/Quaternion\";\r\nimport { Vector2 } from \"../../../maths/Vector2\";\r\nimport { Vector3 } from \"../../../maths/Vector3\";\r\nimport { Vector4 } from \"../../../maths/Vector4\";\r\nimport { VertexElement } from \"../../../renders/VertexElement\";\r\nimport { BufferState } from \"../../../webgl/utils/BufferState\";\r\nimport { VertexMesh } from \"../../../RenderEngine/RenderShader/VertexMesh\";\r\nimport { Laya3DRender } from \"../../RenderObjs/Laya3DRender\";\r\n\r\n\r\n/**\r\n * <code>ShurikenParticleSystem</code> 3D\r\n */\r\nexport class ShurikenParticleSystem extends GeometryElement implements IClone {\r\n    /** @internal 0:Burst,1:,2:StartDelay,3:StartColor,4:StartSize,5:StartRotation,6:randomizeRotationDirection,7:StartLifetime,8:StartSpeed,9:VelocityOverLifetime,10:ColorOverLifetime,11:SizeOverLifetime,12:RotationOverLifetime,13-15:TextureSheetAnimation,16-17:Shape*/\r\n    static _RANDOMOFFSET: Uint32Array = new Uint32Array([0x23571a3e, 0xc34f56fe, 0x13371337, 0x12460f3b, 0x6aed452e, 0xdec4aea1, 0x96aa4de3, 0x8d2c8431, 0xf3857f6f, 0xe0fbd834, 0x13740583, 0x591bc05c, 0x40eb95e4, 0xbc524e5f, 0xaf502044, 0xa614b381, 0x1034e524, 0xfc524e5f]);\r\n\r\n    /** @internal */\r\n    protected static halfKSqrtOf2: number = 1.42 * 0.5;\r\n\r\n    /** @internal */\r\n    protected static g: number = 9.8;\r\n\r\n    /** @internal */\r\n    static _maxElapsedTime: number = 1.0 / 3.0;\r\n\r\n    /**@internal */\r\n    protected static _tempVector30: Vector3 = new Vector3();\r\n    /**@internal */\r\n    protected static _tempVector31: Vector3 = new Vector3();\r\n    /**@internal */\r\n    protected static _tempVector32: Vector3 = new Vector3();\r\n    /**@internal */\r\n    protected static _tempVector33: Vector3 = new Vector3();\r\n    /**@internal */\r\n    protected static _tempVector34: Vector3 = new Vector3();\r\n    /**@internal */\r\n    protected static _tempVector35: Vector3 = new Vector3();\r\n    /**@internal */\r\n    protected static _tempVector36: Vector3 = new Vector3();\r\n    /**@internal */\r\n    protected static _tempVector37: Vector3 = new Vector3();\r\n    /** @internal */\r\n    protected static _tempPosition: Vector3 = new Vector3();\r\n    /** @internal */\r\n    protected static _tempDirection: Vector3 = new Vector3();\r\n\r\n    /**@internal */\r\n    protected static _type: number = GeometryElement._typeCounter++;\r\n    /** @internal */\r\n    _bounds: Bounds = null;\r\n    /** @internal ,  */\r\n    _gravityOffset: Vector2 = new Vector2();\r\n\r\n    /** @internal */\r\n    _customBounds: Bounds = null;\r\n\r\n    /** @internal */\r\n    _useCustomBounds: boolean = false;\r\n\r\n    /** @internal */\r\n    protected _owner: Sprite3D = null;\r\n    /** @internal */\r\n    protected _ownerRender: ShurikenParticleRenderer = null;\r\n    /**@internal */\r\n    protected _vertices: Float32Array = null;\r\n    /**@internal */\r\n    protected _floatCountPerVertex: number = 0;\r\n    /**@internal */\r\n    protected _startLifeTimeIndex: number = 0;\r\n    /**@internal */\r\n    protected _timeIndex: number = 0;\r\n    /**@internal */\r\n    protected _simulationUV_Index: number = 0\r\n    /**@internal */\r\n    protected _simulateUpdate: boolean = false;\r\n\r\n\r\n    /**@internal */\r\n    protected _firstActiveElement: number = 0;\r\n    /**@internal */\r\n    protected _firstNewElement: number = 0;\r\n    /**@internal */\r\n    protected _firstFreeElement: number = 0;\r\n    /**@internal */\r\n    protected _firstRetiredElement: number = 0;\r\n    /**@internal */\r\n    protected _drawCounter: number = 0;\r\n    /**@internal */\r\n    protected _bufferMaxParticles: number = 0;\r\n    /**@internal */\r\n    protected _emission: Emission = null;\r\n    /**@internal */\r\n    protected _shape: BaseShape = null;\r\n\r\n    /**@internal */\r\n    protected _isEmitting: boolean = false;\r\n    /**@internal */\r\n    protected _isPlaying: boolean = false;\r\n    /**@internal */\r\n    protected _isPaused: boolean = false;\r\n    /**@internal */\r\n    protected _playStartDelay: number = 0;\r\n    /**@internal */\r\n    protected _frameRateTime: number = 0;\r\n    /**@internal */\r\n    protected _emissionTime: number = 0;\r\n    /**@internal */\r\n    protected _totalDelayTime: number = 0;\r\n    /** @internal  */\r\n    protected _emissionDistance: number = 0;\r\n    protected _emissionLastPosition: Vector3 = new Vector3();\r\n    /**@internal */\r\n    protected _burstsIndex: number = 0;\r\n    ///**@internal */\r\n    //protected var _minEmissionTime:Number;\r\n    /**@internal */\r\n    protected _velocityOverLifetime: VelocityOverLifetime = null;\r\n    /**@internal */\r\n    protected _colorOverLifetime: ColorOverLifetime = null;\r\n    /**@internal */\r\n    protected _sizeOverLifetime: SizeOverLifetime = null;\r\n    /**@internal */\r\n    protected _rotationOverLifetime: RotationOverLifetime = null;\r\n    /**@internal */\r\n    protected _textureSheetAnimation: TextureSheetAnimation = null;\r\n    /**@internal */\r\n    protected _startLifetimeType: number = 0;\r\n    /**@internal */\r\n    protected _startLifetimeConstant: number = 0;\r\n    /**@internal */\r\n    protected _startLifeTimeGradient: GradientDataNumber = null;\r\n    /**@internal */\r\n    protected _startLifetimeConstantMin: number = 0;\r\n    /**@internal */\r\n    protected _startLifetimeConstantMax: number = 0;\r\n    /**@internal */\r\n    protected _startLifeTimeGradientMin: GradientDataNumber = null;\r\n    /**@internal */\r\n    protected _startLifeTimeGradientMax: GradientDataNumber = null;\r\n    /**@internal */\r\n    protected _maxStartLifetime: number = 0;\r\n\r\n    /** @internal */\r\n    protected _uvLength: Vector2 = new Vector2();//TODO:\r\n    /** @internal */\r\n    protected _vertexStride: number = 0;\r\n    /** @internal */\r\n    protected _indexStride: number = 0;\r\n    /**@internal */\r\n    protected _vertexBuffer: VertexBuffer3D = null;\r\n    /**@internal */\r\n    protected _indexBuffer: IndexBuffer3D = null;\r\n    /** @internal */\r\n    protected _bufferState: BufferState = new BufferState();\r\n\r\n    /**@internal */\r\n    protected _updateMask: number = 0;\r\n\r\n    /**@internal */\r\n    _currentTime: number = 0;\r\n    /**@internal */\r\n    _startUpdateLoopCount: number = 0;\r\n    /**@internal */\r\n    _rand: Rand = null;\r\n    /**@internal */\r\n    _randomSeeds: Uint32Array = null;\r\n\r\n    /***/\r\n    duration: number = 0;\r\n    /***/\r\n    looping: boolean = false;\r\n    /***/\r\n    prewarm: boolean = false;\r\n    /**0,1prewarm*/\r\n    startDelayType: number = 0;\r\n    /**prewarm*/\r\n    startDelay: number = 0;\r\n    /**prewarm*/\r\n    startDelayMin: number = 0;\r\n    /**prewarm*/\r\n    startDelayMax: number = 0;\r\n\r\n    /**0213*/\r\n    startSpeedType: number = 0;\r\n    /**,0*/\r\n    startSpeedConstant: number = 0;\r\n    /**,1*/\r\n    startSpeedConstantMin: number = 0;\r\n    /**,1*/\r\n    startSpeedConstantMax: number = 0;\r\n\r\n    /**02*/\r\n    dragType: number = 0;\r\n    /**,0*/\r\n    dragConstant: number = 0;\r\n    /**,1*/\r\n    dragSpeedConstantMin: number = 0;\r\n    /**,1*/\r\n    dragSpeedConstantMax: number = 0;\r\n\r\n\r\n\r\n    /**3D*/\r\n    threeDStartSize: boolean = false;\r\n    /**,02133D*/\r\n    startSizeType: number = 0;\r\n    /**0*/\r\n    startSizeConstant: number = 0;\r\n    /**0*/\r\n    startSizeConstantSeparate: Vector3 = null;\r\n    /**2*/\r\n    startSizeConstantMin: number = 0;\r\n    /**2*/\r\n    startSizeConstantMax: number = 0;\r\n    /**2*/\r\n    startSizeConstantMinSeparate: Vector3 = null;\r\n    /**2*/\r\n    startSizeConstantMaxSeparate: Vector3 = null;\r\n\r\n    /**3D*/\r\n    threeDStartRotation: boolean = false;\r\n    /**,02,2,3D*/\r\n    startRotationType: number = 0;\r\n    /**0*/\r\n    startRotationConstant: number = 0;\r\n    /**0*/\r\n    startRotationConstantSeparate: Vector3 = null;\r\n    /**1*/\r\n    startRotationConstantMin: number = 0;\r\n    /**1*/\r\n    startRotationConstantMax: number = 0;\r\n    /**1*/\r\n    startRotationConstantMinSeparate: Vector3 = null;\r\n    /**1*/\r\n    startRotationConstantMaxSeparate: Vector3 = null;\r\n\r\n    /**0.01.0*/\r\n    randomizeRotationDirection: number = 0;\r\n\r\n    /**02,2*/\r\n    startColorType: number = 0;\r\n    /**0*/\r\n    startColorConstant: Vector4 = new Vector4(1, 1, 1, 1);\r\n    /**1*/\r\n    startColorConstantMin: Vector4 = new Vector4(0, 0, 0, 0);\r\n    /**1*/\r\n    startColorConstantMax: Vector4 = new Vector4(1, 1, 1, 1);\r\n\r\n    /***/\r\n    gravityModifier: number = 0;\r\n    /**,0World,1LocalCustom*/\r\n    simulationSpace: number = 0;\r\n    /** */\r\n    simulationSpeed: number = 1.0;\r\n    /**0Hiercachy,1Local,2World*/\r\n    scaleMode: number = 1;\r\n    /***/\r\n    playOnAwake: boolean = false;\r\n\r\n    /**,:play()*/\r\n    randomSeed: Uint32Array = null;\r\n    /** */\r\n    autoRandomSeed: boolean = false;\r\n\r\n    /**,*/\r\n    isPerformanceMode: boolean = false;\r\n\r\n    /***/\r\n    get maxParticles(): number {\r\n        return this._bufferMaxParticles - 1;\r\n    }\r\n\r\n    set maxParticles(value: number) {//TODO:\r\n        var newMaxParticles: number = value + 1;\r\n        if (newMaxParticles !== this._bufferMaxParticles) {\r\n            this._bufferMaxParticles = newMaxParticles;\r\n            this._initBufferDatas();\r\n        }\r\n\r\n        this._updateParticlesSimulationRestart(0);\r\n    }\r\n\r\n    /**\r\n     * \r\n     */\r\n    get emission(): Emission {\r\n        return this._emission;\r\n    }\r\n\r\n\r\n    /**\r\n     * \r\n     */\r\n    get aliveParticleCount(): number {\r\n        if (this._firstNewElement >= this._firstRetiredElement)\r\n            return this._firstNewElement - this._firstRetiredElement;\r\n        else\r\n            return this._bufferMaxParticles - this._firstRetiredElement + this._firstNewElement;\r\n    }\r\n\r\n    /**\r\n     * \r\n     */\r\n    get emissionTime(): number {\r\n        return this._emissionTime > this.duration ? this.duration : this._emissionTime;\r\n    }\r\n\r\n    /**\r\n     * \r\n     */\r\n    get shape(): BaseShape {\r\n        return this._shape;\r\n    }\r\n\r\n    set shape(value: BaseShape) {\r\n        if (this._shape !== value) {\r\n            if (value && value.enable)\r\n                this._ownerRender._shaderValues.addDefine(ShuriKenParticle3DShaderDeclaration.SHADERDEFINE_SHAPE);\r\n            else\r\n                this._ownerRender._shaderValues.removeDefine(ShuriKenParticle3DShaderDeclaration.SHADERDEFINE_SHAPE);\r\n            this._shape = value;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * \r\n     */\r\n    get isAlive(): boolean {\r\n        if (this._isPlaying || this.aliveParticleCount > 0)//TODO:retired\r\n            return true;\r\n\r\n        return false;\r\n    }\r\n\r\n    /**\r\n     * \r\n     */\r\n    get isEmitting(): boolean {\r\n        return this._isEmitting;\r\n    }\r\n\r\n    /**\r\n     * \r\n     */\r\n    get isPlaying(): boolean {\r\n        return this._isPlaying;\r\n    }\r\n\r\n    /**\r\n     * \r\n     */\r\n    get isPaused(): boolean {\r\n        return this._isPaused;\r\n    }\r\n\r\n    /**\r\n     * ,012,3\r\n     */\r\n    get startLifetimeType(): number {\r\n        return this._startLifetimeType;\r\n    }\r\n\r\n    set startLifetimeType(value: number) {\r\n        //if (value !== _startLifetimeType){\r\n        var i: number, n: number;\r\n        switch (this.startLifetimeType) {\r\n            case 0:\r\n                this._maxStartLifetime = this.startLifetimeConstant;\r\n                break;\r\n            case 1:\r\n                this._maxStartLifetime = -Number.MAX_VALUE;\r\n                var startLifeTimeGradient: GradientDataNumber = startLifeTimeGradient;\r\n                for (i = 0, n = startLifeTimeGradient.gradientCount; i < n; i++)\r\n                    this._maxStartLifetime = Math.max(this._maxStartLifetime, startLifeTimeGradient.getValueByIndex(i));\r\n                break;\r\n            case 2:\r\n                this._maxStartLifetime = Math.max(this.startLifetimeConstantMin, this.startLifetimeConstantMax);\r\n                break;\r\n            case 3:\r\n                this._maxStartLifetime = -Number.MAX_VALUE;\r\n                var startLifeTimeGradientMin: GradientDataNumber = startLifeTimeGradientMin;\r\n                for (i = 0, n = startLifeTimeGradientMin.gradientCount; i < n; i++)\r\n                    this._maxStartLifetime = Math.max(this._maxStartLifetime, startLifeTimeGradientMin.getValueByIndex(i));\r\n                var startLifeTimeGradientMax: GradientDataNumber = startLifeTimeGradientMax;\r\n                for (i = 0, n = startLifeTimeGradientMax.gradientCount; i < n; i++)\r\n                    this._maxStartLifetime = Math.max(this._maxStartLifetime, startLifeTimeGradientMax.getValueByIndex(i));\r\n                break;\r\n        }\r\n        this._startLifetimeType = value;\r\n        //}\r\n    }\r\n\r\n    /**\r\n     * 0,\r\n     */\r\n    get startLifetimeConstant(): number {\r\n        return this._startLifetimeConstant;\r\n    }\r\n\r\n    set startLifetimeConstant(value: number) {\r\n        if (this._startLifetimeType === 0)\r\n            this._maxStartLifetime = value;\r\n        this._startLifetimeConstant = value;\r\n    }\r\n\r\n    /**\r\n     * 1,\r\n     */\r\n    get startLifeTimeGradient(): GradientDataNumber {\r\n        return this._startLifeTimeGradient;\r\n    }\r\n\r\n    set startLifeTimeGradient(value: GradientDataNumber) {//if (_startLifeTimeGradient !== value)GradientDataNumber,startLifeTime\r\n        if (this._startLifetimeType === 1) {\r\n            this._maxStartLifetime = -Number.MAX_VALUE;\r\n            for (var i: number = 0, n: number = value.gradientCount; i < n; i++)\r\n                this._maxStartLifetime = Math.max(this._maxStartLifetime, value.getValueByIndex(i));\r\n        }\r\n        this._startLifeTimeGradient = value;\r\n    }\r\n\r\n    /**\r\n     * 2,\r\n     */\r\n    get startLifetimeConstantMin(): number {\r\n        return this._startLifetimeConstantMin;\r\n    }\r\n\r\n    set startLifetimeConstantMin(value: number) {\r\n        if (this._startLifetimeType === 2)\r\n            this._maxStartLifetime = Math.max(value, this._startLifetimeConstantMax);\r\n        this._startLifetimeConstantMin = value;\r\n    }\r\n\r\n\r\n    /**\r\n     * 2,\r\n     */\r\n    get startLifetimeConstantMax(): number {\r\n        return this._startLifetimeConstantMax;\r\n    }\r\n\r\n    set startLifetimeConstantMax(value: number) {\r\n        if (this._startLifetimeType === 2)\r\n            this._maxStartLifetime = Math.max(this._startLifetimeConstantMin, value);\r\n        this._startLifetimeConstantMax = value;\r\n    }\r\n\r\n\r\n\r\n    /**\r\n     * 3,\r\n     */\r\n    get startLifeTimeGradientMin(): GradientDataNumber {\r\n        return this._startLifeTimeGradientMin;\r\n    }\r\n\r\n    set startLifeTimeGradientMin(value: GradientDataNumber) {\r\n        if (this._startLifetimeType === 3) {\r\n            var i: number, n: number;\r\n            this._maxStartLifetime = -Number.MAX_VALUE;\r\n            for (i = 0, n = value.gradientCount; i < n; i++)\r\n                this._maxStartLifetime = Math.max(this._maxStartLifetime, value.getValueByIndex(i));\r\n            for (i = 0, n = this._startLifeTimeGradientMax.gradientCount; i < n; i++)\r\n                this._maxStartLifetime = Math.max(this._maxStartLifetime, this._startLifeTimeGradientMax.getValueByIndex(i));\r\n        }\r\n        this._startLifeTimeGradientMin = value;\r\n    }\r\n\r\n    /**\r\n     * 3,\r\n     */\r\n    get startLifeTimeGradientMax(): GradientDataNumber {\r\n        return this._startLifeTimeGradientMax;\r\n    }\r\n\r\n    set startLifeTimeGradientMax(value: GradientDataNumber) {\r\n        if (this._startLifetimeType === 3) {\r\n            var i: number, n: number;\r\n            this._maxStartLifetime = -Number.MAX_VALUE;\r\n            for (i = 0, n = this._startLifeTimeGradientMin.gradientCount; i < n; i++)\r\n                this._maxStartLifetime = Math.max(this._maxStartLifetime, this._startLifeTimeGradientMin.getValueByIndex(i));\r\n            for (i = 0, n = value.gradientCount; i < n; i++)\r\n                this._maxStartLifetime = Math.max(this._maxStartLifetime, value.getValueByIndex(i));\r\n        }\r\n        this._startLifeTimeGradientMax = value;\r\n    }\r\n\r\n    /**\r\n     * ,:,\r\n     */\r\n    get velocityOverLifetime(): VelocityOverLifetime {\r\n        return this._velocityOverLifetime;\r\n    }\r\n\r\n    set velocityOverLifetime(value: VelocityOverLifetime) {\r\n        var shaDat: ShaderData = this._ownerRender._shaderValues;\r\n\r\n        shaDat.removeDefine(ShuriKenParticle3DShaderDeclaration.SHADERDEFINE_VELOCITYOVERLIFETIMECONSTANT);\r\n        shaDat.removeDefine(ShuriKenParticle3DShaderDeclaration.SHADERDEFINE_VELOCITYOVERLIFETIMECURVE);\r\n        shaDat.removeDefine(ShuriKenParticle3DShaderDeclaration.SHADERDEFINE_VELOCITYOVERLIFETIMERANDOMCONSTANT);\r\n        shaDat.removeDefine(ShuriKenParticle3DShaderDeclaration.SHADERDEFINE_VELOCITYOVERLIFETIMERANDOMCURVE);\r\n\r\n        this._velocityOverLifetime = value;\r\n\r\n        if (value) {\r\n            var velocity: GradientVelocity = value.velocity;\r\n            var velocityType: number = velocity.type;\r\n\r\n            if (value.enable) {\r\n                switch (velocityType) {\r\n                    case 0:\r\n                        shaDat.addDefine(ShuriKenParticle3DShaderDeclaration.SHADERDEFINE_VELOCITYOVERLIFETIMECONSTANT);\r\n                        shaDat.setVector3(ShuriKenParticle3DShaderDeclaration.VOLVELOCITYCONST, velocity.constant);\r\n                        break;\r\n                    case 1:\r\n                        shaDat.addDefine(ShuriKenParticle3DShaderDeclaration.SHADERDEFINE_VELOCITYOVERLIFETIMECURVE);\r\n                        velocity.gradientX._formatData();\r\n                        velocity.gradientY._formatData();\r\n                        velocity.gradientZ._formatData();\r\n                        shaDat.setBuffer(ShuriKenParticle3DShaderDeclaration.VOLVELOCITYGRADIENTX, velocity.gradientX._elements);\r\n                        shaDat.setBuffer(ShuriKenParticle3DShaderDeclaration.VOLVELOCITYGRADIENTY, velocity.gradientY._elements);\r\n                        shaDat.setBuffer(ShuriKenParticle3DShaderDeclaration.VOLVELOCITYGRADIENTZ, velocity.gradientZ._elements);\r\n                        break;\r\n                    case 2:\r\n                        shaDat.addDefine(ShuriKenParticle3DShaderDeclaration.SHADERDEFINE_VELOCITYOVERLIFETIMERANDOMCONSTANT);\r\n                        shaDat.setVector3(ShuriKenParticle3DShaderDeclaration.VOLVELOCITYCONST, velocity.constantMin);\r\n                        shaDat.setVector3(ShuriKenParticle3DShaderDeclaration.VOLVELOCITYCONSTMAX, velocity.constantMax);\r\n                        break;\r\n                    case 3:\r\n                        velocity.gradientXMin._formatData();\r\n                        velocity.gradientYMin._formatData();\r\n                        velocity.gradientZMin._formatData();\r\n                        velocity.gradientXMax._formatData();\r\n                        velocity.gradientYMax._formatData();\r\n                        velocity.gradientZMax._formatData();\r\n                        shaDat.addDefine(ShuriKenParticle3DShaderDeclaration.SHADERDEFINE_VELOCITYOVERLIFETIMERANDOMCURVE);\r\n                        shaDat.setBuffer(ShuriKenParticle3DShaderDeclaration.VOLVELOCITYGRADIENTX, velocity.gradientXMin._elements);\r\n                        shaDat.setBuffer(ShuriKenParticle3DShaderDeclaration.VOLVELOCITYGRADIENTXMAX, velocity.gradientXMax._elements);\r\n                        shaDat.setBuffer(ShuriKenParticle3DShaderDeclaration.VOLVELOCITYGRADIENTY, velocity.gradientYMin._elements);\r\n                        shaDat.setBuffer(ShuriKenParticle3DShaderDeclaration.VOLVELOCITYGRADIENTYMAX, velocity.gradientYMax._elements);\r\n                        shaDat.setBuffer(ShuriKenParticle3DShaderDeclaration.VOLVELOCITYGRADIENTZ, velocity.gradientZMin._elements);\r\n                        shaDat.setBuffer(ShuriKenParticle3DShaderDeclaration.VOLVELOCITYGRADIENTZMAX, velocity.gradientZMax._elements);\r\n                        break;\r\n                    default:\r\n                        break;\r\n                }\r\n            }\r\n            shaDat.setInt(ShuriKenParticle3DShaderDeclaration.VOLSPACETYPE, value.space);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * ,:,\r\n     */\r\n    get colorOverLifetime(): ColorOverLifetime {\r\n        return this._colorOverLifetime;\r\n    }\r\n\r\n    set colorOverLifetime(value: ColorOverLifetime) {\r\n        var shaDat: ShaderData = this._ownerRender._shaderValues;\r\n\r\n        shaDat.removeDefine(ShuriKenParticle3DShaderDeclaration.SHADERDEFINE_COLOROVERLIFETIME);\r\n        shaDat.removeDefine(ShuriKenParticle3DShaderDeclaration.SHADERDEFINE_RANDOMCOLOROVERLIFETIME);\r\n\r\n        this._colorOverLifetime = value;\r\n\r\n        if (value) {\r\n            var color: GradientColor = value.color;\r\n            if (value.enable) {\r\n                switch (color.type) {\r\n                    case 1:\r\n                        shaDat.addDefine(ShuriKenParticle3DShaderDeclaration.SHADERDEFINE_COLOROVERLIFETIME);\r\n\r\n                        let gradientColor: Gradient = color.gradient;\r\n                        let alphaElements: Float32Array = gradientColor.alphaElements;\r\n                        let rgbElements: Float32Array = gradientColor.rgbElements;\r\n                        shaDat.setBuffer(ShuriKenParticle3DShaderDeclaration.COLOROVERLIFEGRADIENTALPHAS, alphaElements);\r\n                        shaDat.setBuffer(ShuriKenParticle3DShaderDeclaration.COLOROVERLIFEGRADIENTCOLORS, rgbElements);\r\n                        let ranges = gradientColor._keyRanges;\r\n                        ranges.setValue(1, 0, 1, 0);\r\n                        for (let index = 0, n = Math.max(2, gradientColor.colorRGBKeysCount); index < n; index++) {\r\n                            let colorKey = rgbElements[index * 4];\r\n                            ranges.x = Math.min(ranges.x, colorKey);\r\n                            ranges.y = Math.max(ranges.y, colorKey);\r\n                        }\r\n                        for (let index = 0, n = Math.max(2, gradientColor.colorAlphaKeysCount); index < n; index++) {\r\n                            let alphaKey = alphaElements[index * 2];\r\n                            ranges.z = Math.min(ranges.z, alphaKey);\r\n                            ranges.w = Math.max(ranges.w, alphaKey);\r\n                        }\r\n                        shaDat.setVector(ShuriKenParticle3DShaderDeclaration.COLOROVERLIFEGRADIENTRANGES, ranges);\r\n\r\n                        if (gradientColor.maxColorAlphaKeysCount == 8) {\r\n                            shaDat.addDefine(ShuriKenParticle3DShaderDeclaration.SHADERDEFINE_COLORKEYCOUNT_8);\r\n                        }\r\n                        else {\r\n                            shaDat.removeDefine(ShuriKenParticle3DShaderDeclaration.SHADERDEFINE_COLORKEYCOUNT_8);\r\n                        }\r\n                        break;\r\n                    case 3:\r\n                        shaDat.addDefine(ShuriKenParticle3DShaderDeclaration.SHADERDEFINE_RANDOMCOLOROVERLIFETIME);\r\n\r\n                        let minGradientColor: Gradient = color.gradientMin;\r\n                        let maxGradientColor: Gradient = color.gradientMax;\r\n\r\n                        let minalphaElements: Float32Array = minGradientColor.alphaElements;\r\n                        let minrgbElements: Float32Array = minGradientColor.rgbElements;\r\n\r\n                        let maxalphaElements: Float32Array = maxGradientColor.alphaElements;\r\n                        let maxrgbElements: Float32Array = maxGradientColor.rgbElements;\r\n                        shaDat.setBuffer(ShuriKenParticle3DShaderDeclaration.COLOROVERLIFEGRADIENTALPHAS, minalphaElements);\r\n                        shaDat.setBuffer(ShuriKenParticle3DShaderDeclaration.COLOROVERLIFEGRADIENTCOLORS, minrgbElements);\r\n                        shaDat.setBuffer(ShuriKenParticle3DShaderDeclaration.MAXCOLOROVERLIFEGRADIENTALPHAS, maxalphaElements);\r\n                        shaDat.setBuffer(ShuriKenParticle3DShaderDeclaration.MAXCOLOROVERLIFEGRADIENTCOLORS, maxrgbElements);\r\n\r\n                        let minRanges = minGradientColor._keyRanges;\r\n                        minRanges.setValue(1, 0, 1, 0);\r\n                        for (let index = 0, n = Math.max(2, minGradientColor.colorRGBKeysCount); index < n; index++) {\r\n                            let colorKey = minrgbElements[index * 4];\r\n                            minRanges.x = Math.min(minRanges.x, colorKey);\r\n                            minRanges.y = Math.max(minRanges.y, colorKey);\r\n                        }\r\n                        for (let index = 0, n = Math.max(2, minGradientColor.colorAlphaKeysCount); index < n; index++) {\r\n                            let alphaKey = minalphaElements[index * 2];\r\n                            minRanges.z = Math.min(minRanges.z, alphaKey);\r\n                            minRanges.w = Math.max(minRanges.w, alphaKey);\r\n                        }\r\n                        shaDat.setVector(ShuriKenParticle3DShaderDeclaration.COLOROVERLIFEGRADIENTRANGES, minRanges);\r\n                        let maxRanges = maxGradientColor._keyRanges;\r\n                        maxRanges.setValue(1, 0, 1, 0);\r\n                        for (let index = 0, n = Math.max(2, maxGradientColor.colorRGBKeysCount); index < n; index++) {\r\n                            let colorKey = maxrgbElements[index * 4];\r\n                            maxRanges.x = Math.min(maxRanges.x, colorKey);\r\n                            maxRanges.y = Math.max(maxRanges.y, colorKey);\r\n                        }\r\n                        for (let index = 0, n = Math.max(2, maxGradientColor.colorAlphaKeysCount); index < n; index++) {\r\n                            let alphaKey = maxalphaElements[index * 2];\r\n                            maxRanges.z = Math.min(maxRanges.z, alphaKey);\r\n                            maxRanges.w = Math.max(maxRanges.w, alphaKey);\r\n                        }\r\n                        shaDat.setVector(ShuriKenParticle3DShaderDeclaration.MAXCOLOROVERLIFEGRADIENTRANGES, maxRanges);\r\n\r\n                        let maxkeyCount = Math.max(minGradientColor.maxColorAlphaKeysCount, maxGradientColor.maxColorAlphaKeysCount);\r\n                        if (maxkeyCount == 8) {\r\n                            shaDat.addDefine(ShuriKenParticle3DShaderDeclaration.SHADERDEFINE_COLORKEYCOUNT_8);\r\n                        }\r\n                        else {\r\n                            shaDat.removeDefine(ShuriKenParticle3DShaderDeclaration.SHADERDEFINE_COLORKEYCOUNT_8);\r\n                        }\r\n                        break;\r\n                    default:\r\n                        break;\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * ,:,\r\n     */\r\n    get sizeOverLifetime(): SizeOverLifetime {\r\n        return this._sizeOverLifetime;\r\n    }\r\n\r\n    set sizeOverLifetime(value: SizeOverLifetime) {\r\n        var shaDat: ShaderData = this._ownerRender._shaderValues;\r\n\r\n        shaDat.removeDefine(ShuriKenParticle3DShaderDeclaration.SHADERDEFINE_SIZEOVERLIFETIMECURVE);\r\n        shaDat.removeDefine(ShuriKenParticle3DShaderDeclaration.SHADERDEFINE_SIZEOVERLIFETIMECURVESEPERATE);\r\n        shaDat.removeDefine(ShuriKenParticle3DShaderDeclaration.SHADERDEFINE_SIZEOVERLIFETIMERANDOMCURVES);\r\n        shaDat.removeDefine(ShuriKenParticle3DShaderDeclaration.SHADERDEFINE_SIZEOVERLIFETIMERANDOMCURVESSEPERATE);\r\n\r\n        this._sizeOverLifetime = value;\r\n\r\n        if (value) {\r\n            var size: GradientSize = value.size;\r\n            var sizeSeparate: boolean = size.separateAxes;\r\n            var sizeType: number = size.type;\r\n            if (value.enable) {\r\n                switch (sizeType) {\r\n                    case 0:\r\n                        if (sizeSeparate) {\r\n                            shaDat.addDefine(ShuriKenParticle3DShaderDeclaration.SHADERDEFINE_SIZEOVERLIFETIMECURVESEPERATE);\r\n\r\n                            size.gradientX._formatData();\r\n                            size.gradientY._formatData();\r\n                            size.gradientZ._formatData();\r\n                            shaDat.setBuffer(ShuriKenParticle3DShaderDeclaration.SOLSIZEGRADIENTX, size.gradientX._elements);\r\n                            shaDat.setBuffer(ShuriKenParticle3DShaderDeclaration.SOLSIZEGRADIENTY, size.gradientY._elements);\r\n                            shaDat.setBuffer(ShuriKenParticle3DShaderDeclaration.SOLSizeGradientZ, size.gradientZ._elements);\r\n                        }\r\n                        else {\r\n                            shaDat.addDefine(ShuriKenParticle3DShaderDeclaration.SHADERDEFINE_SIZEOVERLIFETIMECURVE);\r\n                            size.gradient._formatData();\r\n                            shaDat.setBuffer(ShuriKenParticle3DShaderDeclaration.SOLSIZEGRADIENT, size.gradient._elements);\r\n                        }\r\n                        break;\r\n                    case 2:\r\n                        if (sizeSeparate) {\r\n                            shaDat.addDefine(ShuriKenParticle3DShaderDeclaration.SHADERDEFINE_SIZEOVERLIFETIMERANDOMCURVESSEPERATE);\r\n                            size.gradientXMin._formatData();\r\n                            size.gradientXMax._formatData();\r\n                            size.gradientYMin._formatData();\r\n                            size.gradientYMax._formatData();\r\n                            size.gradientZMin._formatData();\r\n                            size.gradientZMax._formatData();\r\n                            shaDat.setBuffer(ShuriKenParticle3DShaderDeclaration.SOLSIZEGRADIENTX, size.gradientXMin._elements);\r\n                            shaDat.setBuffer(ShuriKenParticle3DShaderDeclaration.SOLSIZEGRADIENTXMAX, size.gradientXMax._elements);\r\n                            shaDat.setBuffer(ShuriKenParticle3DShaderDeclaration.SOLSIZEGRADIENTY, size.gradientYMin._elements);\r\n                            shaDat.setBuffer(ShuriKenParticle3DShaderDeclaration.SOLSIZEGRADIENTYMAX, size.gradientYMax._elements);\r\n                            shaDat.setBuffer(ShuriKenParticle3DShaderDeclaration.SOLSizeGradientZ, size.gradientZMin._elements);\r\n                            shaDat.setBuffer(ShuriKenParticle3DShaderDeclaration.SOLSizeGradientZMAX, size.gradientZMax._elements);\r\n                        }\r\n                        else {\r\n                            shaDat.addDefine(ShuriKenParticle3DShaderDeclaration.SHADERDEFINE_SIZEOVERLIFETIMERANDOMCURVES);\r\n                            size.gradientMin._formatData();\r\n                            size.gradientMax._formatData();\r\n                            shaDat.setBuffer(ShuriKenParticle3DShaderDeclaration.SOLSIZEGRADIENT, size.gradientMin._elements);\r\n                            shaDat.setBuffer(ShuriKenParticle3DShaderDeclaration.SOLSizeGradientMax, size.gradientMax._elements);\r\n                        }\r\n                        break;\r\n                    default:\r\n                        break;\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * ,:,\r\n     */\r\n    get rotationOverLifetime(): RotationOverLifetime {\r\n        return this._rotationOverLifetime;\r\n    }\r\n\r\n    set rotationOverLifetime(value: RotationOverLifetime) {\r\n        var shaDat: ShaderData = this._ownerRender._shaderValues;\r\n\r\n        shaDat.removeDefine(ShuriKenParticle3DShaderDeclaration.SHADERDEFINE_ROTATIONOVERLIFETIME);\r\n        shaDat.removeDefine(ShuriKenParticle3DShaderDeclaration.SHADERDEFINE_ROTATIONOVERLIFETIMESEPERATE);\r\n        shaDat.removeDefine(ShuriKenParticle3DShaderDeclaration.SHADERDEFINE_ROTATIONOVERLIFETIMECONSTANT);\r\n        shaDat.removeDefine(ShuriKenParticle3DShaderDeclaration.SHADERDEFINE_ROTATIONOVERLIFETIMECURVE);\r\n        shaDat.removeDefine(ShuriKenParticle3DShaderDeclaration.SHADERDEFINE_ROTATIONOVERLIFETIMERANDOMCONSTANTS);\r\n        shaDat.removeDefine(ShuriKenParticle3DShaderDeclaration.SHADERDEFINE_ROTATIONOVERLIFETIMERANDOMCURVES);\r\n\r\n        this._rotationOverLifetime = value;\r\n\r\n        if (value) {\r\n            var rotation: GradientAngularVelocity = value.angularVelocity;\r\n\r\n            if (!rotation)//TODO:RotationOverLifetime\r\n                return\r\n\r\n            var rotationSeparate: boolean = rotation.separateAxes;\r\n            var rotationType: number = rotation.type;\r\n            if (value.enable) {\r\n                if (rotationSeparate) {\r\n                    shaDat.addDefine(ShuriKenParticle3DShaderDeclaration.SHADERDEFINE_ROTATIONOVERLIFETIMESEPERATE);\r\n                }\r\n                else {\r\n                    shaDat.addDefine(ShuriKenParticle3DShaderDeclaration.SHADERDEFINE_ROTATIONOVERLIFETIME);\r\n                }\r\n                switch (rotationType) {\r\n                    case 0:\r\n                        shaDat.addDefine(ShuriKenParticle3DShaderDeclaration.SHADERDEFINE_ROTATIONOVERLIFETIMECONSTANT);\r\n                        if (rotationSeparate) {\r\n                            shaDat.setVector3(ShuriKenParticle3DShaderDeclaration.ROLANGULARVELOCITYCONSTSEPRARATE, rotation.constantSeparate);\r\n                        }\r\n                        else {\r\n                            shaDat.setNumber(ShuriKenParticle3DShaderDeclaration.ROLANGULARVELOCITYCONST, rotation.constant);\r\n                        }\r\n                        break;\r\n                    case 1:\r\n                        shaDat.addDefine(ShuriKenParticle3DShaderDeclaration.SHADERDEFINE_ROTATIONOVERLIFETIMECURVE);\r\n                        if (rotationSeparate) {\r\n                            rotation.gradientX._formatData();\r\n                            rotation.gradientY._formatData();\r\n                            rotation.gradientZ._formatData();\r\n                            shaDat.setBuffer(ShuriKenParticle3DShaderDeclaration.ROLANGULARVELOCITYGRADIENTX, rotation.gradientX._elements);\r\n                            shaDat.setBuffer(ShuriKenParticle3DShaderDeclaration.ROLANGULARVELOCITYGRADIENTY, rotation.gradientY._elements);\r\n                            shaDat.setBuffer(ShuriKenParticle3DShaderDeclaration.ROLANGULARVELOCITYGRADIENTZ, rotation.gradientZ._elements);\r\n                        }\r\n                        else {\r\n                            rotation.gradient._formatData();\r\n                            shaDat.setBuffer(ShuriKenParticle3DShaderDeclaration.ROLANGULARVELOCITYGRADIENT, rotation.gradient._elements);\r\n                        }\r\n                        break;\r\n                    case 2:\r\n                        shaDat.addDefine(ShuriKenParticle3DShaderDeclaration.SHADERDEFINE_ROTATIONOVERLIFETIMERANDOMCONSTANTS);\r\n                        if (rotationSeparate) {\r\n                            shaDat.setVector3(ShuriKenParticle3DShaderDeclaration.ROLANGULARVELOCITYCONSTSEPRARATE, rotation.constantMinSeparate);\r\n                            shaDat.setVector3(ShuriKenParticle3DShaderDeclaration.ROLANGULARVELOCITYCONSTMAXSEPRARATE, rotation.constantMaxSeparate);\r\n                        }\r\n                        else {\r\n                            shaDat.setNumber(ShuriKenParticle3DShaderDeclaration.ROLANGULARVELOCITYCONST, rotation.constantMin);\r\n                            shaDat.setNumber(ShuriKenParticle3DShaderDeclaration.ROLANGULARVELOCITYCONSTMAX, rotation.constantMax);\r\n                        }\r\n                        break;\r\n                    case 3:\r\n                        shaDat.addDefine(ShuriKenParticle3DShaderDeclaration.SHADERDEFINE_ROTATIONOVERLIFETIMERANDOMCURVES);\r\n                        if (rotationSeparate) {\r\n                            rotation.gradientXMin._formatData();\r\n                            rotation.gradientXMax._formatData();\r\n                            rotation.gradientYMin._formatData();\r\n                            rotation.gradientYMax._formatData();\r\n                            rotation.gradientZMin._formatData();\r\n                            rotation.gradientZMax._formatData();\r\n                            shaDat.setBuffer(ShuriKenParticle3DShaderDeclaration.ROLANGULARVELOCITYGRADIENTX, rotation.gradientXMin._elements);\r\n                            shaDat.setBuffer(ShuriKenParticle3DShaderDeclaration.ROLANGULARVELOCITYGRADIENTXMAX, rotation.gradientXMax._elements);\r\n                            shaDat.setBuffer(ShuriKenParticle3DShaderDeclaration.ROLANGULARVELOCITYGRADIENTY, rotation.gradientYMin._elements);\r\n                            shaDat.setBuffer(ShuriKenParticle3DShaderDeclaration.ROLANGULARVELOCITYGRADIENTYMAX, rotation.gradientYMax._elements);\r\n                            shaDat.setBuffer(ShuriKenParticle3DShaderDeclaration.ROLANGULARVELOCITYGRADIENTZ, rotation.gradientZMin._elements);\r\n                            shaDat.setBuffer(ShuriKenParticle3DShaderDeclaration.ROLANGULARVELOCITYGRADIENTZMAX, rotation.gradientZMax._elements);\r\n                            //shaDat.setBuffer(ShuriKenParticle3DShaderDeclaration.ROLANGULARVELOCITYGRADIENTW, rotation.gradientWMin._elements);\r\n                            //shaDat.setBuffer(ShuriKenParticle3DShaderDeclaration.ROLANGULARVELOCITYGRADIENTWMAX, rotation.gradientWMax._elements);\r\n                        }\r\n                        else {\r\n                            rotation.gradientMin._formatData();\r\n                            rotation.gradientMax._formatData();\r\n                            shaDat.setBuffer(ShuriKenParticle3DShaderDeclaration.ROLANGULARVELOCITYGRADIENT, rotation.gradientMin._elements);\r\n                            shaDat.setBuffer(ShuriKenParticle3DShaderDeclaration.ROLANGULARVELOCITYGRADIENTMAX, rotation.gradientMax._elements);\r\n                        }\r\n                        break;\r\n                    default:\r\n                        break;\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * ,:,\r\n     */\r\n    get textureSheetAnimation(): TextureSheetAnimation {\r\n        return this._textureSheetAnimation;\r\n    }\r\n\r\n    set textureSheetAnimation(value: TextureSheetAnimation) {\r\n        var shaDat: ShaderData = this._ownerRender._shaderValues;\r\n\r\n        shaDat.removeDefine(ShuriKenParticle3DShaderDeclaration.SHADERDEFINE_TEXTURESHEETANIMATIONCURVE);\r\n        shaDat.removeDefine(ShuriKenParticle3DShaderDeclaration.SHADERDEFINE_TEXTURESHEETANIMATIONRANDOMCURVE);\r\n\r\n        this._textureSheetAnimation = value;\r\n\r\n        if (value) {\r\n            var frameOverTime: FrameOverTime = value.frame;\r\n            var textureAniType: number = frameOverTime.type;\r\n            if (value.enable) {\r\n                switch (textureAniType) {\r\n                    case 1:\r\n                        shaDat.addDefine(ShuriKenParticle3DShaderDeclaration.SHADERDEFINE_TEXTURESHEETANIMATIONCURVE);\r\n\r\n                        shaDat.setNumber(ShuriKenParticle3DShaderDeclaration.TEXTURESHEETANIMATIONCYCLES, value.cycles);\r\n                        var title: Vector2 = value.tiles;\r\n                        var _uvLengthE: Vector2 = this._uvLength;\r\n                        _uvLengthE.x = 1.0 / title.x;\r\n                        _uvLengthE.y = 1.0 / title.y;\r\n                        shaDat.setVector2(ShuriKenParticle3DShaderDeclaration.TEXTURESHEETANIMATIONSUBUVLENGTH, this._uvLength);\r\n                        frameOverTime.frameOverTimeData._formatData();\r\n                        shaDat.setBuffer(ShuriKenParticle3DShaderDeclaration.TEXTURESHEETANIMATIONGRADIENTUVS, frameOverTime.frameOverTimeData._elements);\r\n                        break;\r\n                    case 3:\r\n                        shaDat.addDefine(ShuriKenParticle3DShaderDeclaration.SHADERDEFINE_TEXTURESHEETANIMATIONRANDOMCURVE);\r\n\r\n                        shaDat.setNumber(ShuriKenParticle3DShaderDeclaration.TEXTURESHEETANIMATIONCYCLES, value.cycles);\r\n                        var title: Vector2 = value.tiles;\r\n                        var _uvLengthE: Vector2 = this._uvLength;\r\n                        _uvLengthE.x = 1.0 / title.x;\r\n                        _uvLengthE.y = 1.0 / title.y;\r\n                        shaDat.setVector2(ShuriKenParticle3DShaderDeclaration.TEXTURESHEETANIMATIONSUBUVLENGTH, this._uvLength);\r\n                        frameOverTime.frameOverTimeDataMin._formatData();\r\n                        frameOverTime.frameOverTimeDataMax._formatData();\r\n                        shaDat.setBuffer(ShuriKenParticle3DShaderDeclaration.TEXTURESHEETANIMATIONGRADIENTUVS, frameOverTime.frameOverTimeDataMin._elements);\r\n                        shaDat.setBuffer(ShuriKenParticle3DShaderDeclaration.TEXTURESHEETANIMATIONGRADIENTMAXUVS, frameOverTime.frameOverTimeDataMax._elements);\r\n                        break;\r\n                    default:\r\n                        break;\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n\r\n\r\n    constructor(render: ShurikenParticleRenderer, meshTopology: MeshTopology = MeshTopology.Triangles, drawType: DrawType = DrawType.DrawElement) {\r\n        super(meshTopology, drawType);\r\n        this.indexFormat = IndexFormat.UInt16;\r\n\r\n        this._firstActiveElement = 0;\r\n        this._firstNewElement = 0;\r\n        this._firstFreeElement = 0;\r\n        this._firstRetiredElement = 0;\r\n\r\n        this._owner = render.owner as Sprite3D;\r\n        this._ownerRender = render;\r\n        this._useCustomBounds = false;\r\n\r\n        this._currentTime = 0;\r\n        this._bounds = new Bounds(new Vector3(-Number.MAX_VALUE, -Number.MAX_VALUE, -Number.MAX_VALUE), new Vector3(Number.MAX_VALUE, Number.MAX_VALUE, Number.MAX_VALUE));\r\n        this.bufferState = this._bufferState = new BufferState();\r\n        this._isEmitting = false;\r\n        this._isPlaying = false;\r\n        this._isPaused = false;\r\n        this._burstsIndex = 0;\r\n        this._frameRateTime = 0;\r\n        this._emissionTime = 0;\r\n        this._totalDelayTime = 0;\r\n        this._simulateUpdate = false;\r\n\r\n        this._bufferMaxParticles = 1;\r\n        this.duration = 5.0;\r\n        this.looping = true;\r\n        this.prewarm = false;\r\n        this.startDelayType = 0;\r\n        this.startDelay = 0.0;\r\n        this.startDelayMin = 0.0;\r\n        this.startDelayMax = 0.0;\r\n\r\n        this._startLifetimeType = 0;\r\n        this._startLifetimeConstant = 5.0;\r\n        this._startLifeTimeGradient = new GradientDataNumber();\r\n        this._startLifetimeConstantMin = 0.0;\r\n        this._startLifetimeConstantMax = 5.0;\r\n        this._startLifeTimeGradientMin = new GradientDataNumber();\r\n        this._startLifeTimeGradientMax = new GradientDataNumber();\r\n        this._maxStartLifetime = 5.0;//_startLifetimeType0_startLifetimeConstant5.0,5.0\r\n\r\n        this.startSpeedType = 0;\r\n        this.startSpeedConstant = 5.0;\r\n        this.startSpeedConstantMin = 0.0;\r\n        this.startSpeedConstantMax = 5.0;\r\n\r\n        //drag\r\n        this.dragType = 0;\r\n        this.dragConstant = 0;\r\n        this.dragSpeedConstantMin = 0;\r\n        this.dragSpeedConstantMax = 0;\r\n\r\n        this.threeDStartSize = false;\r\n        this.startSizeType = 0;\r\n        this.startSizeConstant = 1;\r\n        this.startSizeConstantSeparate = new Vector3(1, 1, 1);\r\n        this.startSizeConstantMin = 0;\r\n        this.startSizeConstantMax = 1;\r\n        this.startSizeConstantMinSeparate = new Vector3(0, 0, 0);\r\n        this.startSizeConstantMaxSeparate = new Vector3(1, 1, 1);\r\n\r\n        this.threeDStartRotation = false;\r\n        this.startRotationType = 0;\r\n        this.startRotationConstant = 0;\r\n        this.startRotationConstantSeparate = new Vector3(0, 0, 0);\r\n        this.startRotationConstantMin = 0.0;\r\n        this.startRotationConstantMax = 0.0;\r\n        this.startRotationConstantMinSeparate = new Vector3(0, 0, 0);\r\n        this.startRotationConstantMaxSeparate = new Vector3(0, 0, 0);\r\n\r\n        this.gravityModifier = 0.0;\r\n        this.simulationSpace = 1;\r\n        this.scaleMode = 1;\r\n        this.playOnAwake = true;\r\n        this._rand = new Rand(0);\r\n        this.autoRandomSeed = true;\r\n        this.randomSeed = new Uint32Array(1);\r\n        this._randomSeeds = new Uint32Array(ShurikenParticleSystem._RANDOMOFFSET.length);\r\n        this.isPerformanceMode = true;\r\n\r\n        this._emission = new Emission();\r\n        this._emission.enable = true;\r\n        //set GeometryElement\r\n\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    _getVertexBuffer(index: number = 0): VertexBuffer3D {\r\n        if (index === 0)\r\n            return this._vertexBuffer;\r\n        else\r\n            return null;\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    _getIndexBuffer(): IndexBuffer3D {\r\n        return this._indexBuffer;\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    _generateBounds(): void {\r\n        var particleRender: ShurikenParticleRenderer = this._ownerRender;\r\n        var boundsMin: Vector3 = this._bounds.getMin();\r\n        var boundsMax: Vector3 = this._bounds.getMax();\r\n\r\n        // lifeTime\r\n        var time: number = 0;\r\n        switch (this.startLifetimeType) {\r\n            case 0: // \r\n                time = this._startLifetimeConstant;\r\n                break;\r\n            case 2: // \r\n                time = this._startLifetimeConstantMax;\r\n                break;\r\n            case 1: // \r\n            case 3: // \r\n            default:\r\n                // todo \r\n                break;\r\n        }\r\n\r\n        // speed\r\n        var speedOrigan: number = 0;\r\n        switch (this.startSpeedType) {\r\n            case 0: // \r\n                speedOrigan = this.startSpeedConstant;\r\n                break;\r\n            case 2: // \r\n                speedOrigan = this.startSpeedConstantMax;\r\n                break;\r\n            case 1:\r\n            case 3:\r\n            default:\r\n                // todo \r\n                break;\r\n        }\r\n\r\n        // size\r\n        var maxSizeScale = 0;\r\n        if (this.threeDStartSize) {\r\n            switch (this.startSizeType) {\r\n                case 0: // \r\n                    maxSizeScale = Math.max(this.startSizeConstantSeparate.x, this.startSizeConstantSeparate.y, this.startSizeConstantSeparate.z);\r\n                    break;\r\n                case 2: // \r\n                    maxSizeScale = Math.max(this.startSizeConstantMaxSeparate.x, this.startSizeConstantMaxSeparate.y, this.startSizeConstantMaxSeparate.z);\r\n                    break;\r\n                case 1:\r\n                case 3:\r\n                default:\r\n                    // todo \r\n                    break;\r\n            }\r\n        }\r\n        else {\r\n            switch (this.startSizeType) {\r\n                case 0: // \r\n                    maxSizeScale = this.startSizeConstant;\r\n                    break;\r\n                case 2: // \r\n                    maxSizeScale = this.startSizeConstantMax;\r\n                    break;\r\n                case 1:\r\n                case 3:\r\n                default:\r\n                    // todo \r\n                    break;\r\n            }\r\n        }\r\n\r\n        // shape\r\n        var zDirectionSpeed: Vector3 = ShurikenParticleSystem._tempVector30;\r\n        var fDirectionSpeed: Vector3 = ShurikenParticleSystem._tempVector31;\r\n        var zEmisionOffsetXYZ: Vector3 = ShurikenParticleSystem._tempVector32;\r\n        var fEmisionOffsetXYZ: Vector3 = ShurikenParticleSystem._tempVector33;\r\n\r\n        zDirectionSpeed.setValue(0, 0, 1);\r\n        fDirectionSpeed.setValue(0, 0, 0);\r\n        zEmisionOffsetXYZ.setValue(0, 0, 0);\r\n        fEmisionOffsetXYZ.setValue(0, 0, 0);\r\n\r\n        if (this.shape && this.shape.enable) {\r\n            switch (this.shape.shapeType) {\r\n                case ParticleSystemShapeType.Sphere:\r\n                    var sphere: SphereShape = <SphereShape>this.shape;\r\n                    zDirectionSpeed.setValue(1, 1, 1);\r\n                    fDirectionSpeed.setValue(1, 1, 1);\r\n                    zEmisionOffsetXYZ.setValue(sphere.radius, sphere.radius, sphere.radius);\r\n                    fEmisionOffsetXYZ.setValue(sphere.radius, sphere.radius, sphere.radius);\r\n                    break;\r\n                case ParticleSystemShapeType.Hemisphere:\r\n                    var hemiShpere: HemisphereShape = <HemisphereShape>this.shape;\r\n                    zDirectionSpeed.setValue(1, 1, 1);\r\n                    fDirectionSpeed.setValue(1, 1, 1);\r\n                    zEmisionOffsetXYZ.setValue(hemiShpere.radius, hemiShpere.radius, hemiShpere.radius);\r\n                    fEmisionOffsetXYZ.setValue(hemiShpere.radius, hemiShpere.radius, 0.0);\r\n                    break;\r\n                case ParticleSystemShapeType.Cone:\r\n                    var cone: ConeShape = <ConeShape>this.shape;\r\n                    // Base || BaseShell\r\n                    if (cone.emitType == 0 || cone.emitType == 1) {\r\n                        // todo angle define\r\n                        // var angle: number = cone.angle * Math.PI / 180;\r\n                        var angle: number = cone.angle;\r\n                        var sinAngle: number = Math.sin(angle);\r\n                        zDirectionSpeed.setValue(sinAngle, sinAngle, 1.0);\r\n                        fDirectionSpeed.setValue(sinAngle, sinAngle, 0.0);\r\n                        zEmisionOffsetXYZ.setValue(cone.radius, cone.radius, 0.0);\r\n                        fEmisionOffsetXYZ.setValue(cone.radius, cone.radius, 0.0);\r\n                        break;\r\n                    }\r\n                    // Volume || VolumeShell\r\n                    else if (cone.emitType == 2 || cone.emitType == 3) {\r\n                        // var angle: number = cone.angle * Math.PI / 180;\r\n                        var angle: number = cone.angle;\r\n                        var sinAngle: number = Math.sin(angle);\r\n                        var coneLength: number = cone.length;\r\n                        zDirectionSpeed.setValue(sinAngle, sinAngle, 1.0);\r\n                        fDirectionSpeed.setValue(sinAngle, sinAngle, 0.0);\r\n                        var tanAngle: number = Math.tan(angle);\r\n                        var rPLCT: number = cone.radius + coneLength * tanAngle;\r\n                        zEmisionOffsetXYZ.setValue(rPLCT, rPLCT, coneLength);\r\n                        fEmisionOffsetXYZ.setValue(rPLCT, rPLCT, 0.0);\r\n                    }\r\n                    break;\r\n                case ParticleSystemShapeType.Box:\r\n                    var box: BoxShape = <BoxShape>this.shape;\r\n                    if (this.shape.randomDirection != 0) {\r\n                        zDirectionSpeed.setValue(1, 1, 1);\r\n                        fDirectionSpeed.setValue(1, 1, 1);\r\n                    }\r\n                    zEmisionOffsetXYZ.setValue(box.x / 2, box.y / 2, box.z / 2);\r\n                    fEmisionOffsetXYZ.setValue(box.x / 2, box.y / 2, box.z / 2);\r\n                    break;\r\n                case ParticleSystemShapeType.Circle:\r\n                    var circle: CircleShape = <CircleShape>this.shape;\r\n                    zDirectionSpeed.setValue(1, 1, 1);\r\n                    fDirectionSpeed.setValue(1, 1, 1);\r\n                    zEmisionOffsetXYZ.setValue(circle.radius, circle.radius, 0);\r\n                    fEmisionOffsetXYZ.setValue(circle.radius, circle.radius, 0);\r\n                    break;\r\n                default:\r\n                    break;\r\n            }\r\n        }\r\n\r\n        // size\r\n        var meshSize: number = 0;\r\n        //  mesh \r\n        var meshMode: boolean = particleRender.renderMode == 4;\r\n        switch (particleRender.renderMode) {\r\n            case 0: // billboard\r\n            case 1:\r\n            case 2:\r\n            case 3:\r\n                meshSize = ShurikenParticleSystem.halfKSqrtOf2;// Math.sqrt(2) / 2.0;\r\n                break;\r\n            case 4: // mesh\r\n                if (particleRender.mesh) {\r\n                    var meshBounds: Bounds = particleRender.mesh.bounds;\r\n                    meshSize = Math.sqrt(Math.pow(meshBounds.getExtent().x, 2.0) + Math.pow(meshBounds.getExtent().y, 2.0) + Math.pow(meshBounds.getExtent().z, 2.0));\r\n                } else {\r\n                    meshSize = ShurikenParticleSystem.halfKSqrtOf2;// Math.sqrt(2) / 2.0;\r\n                }\r\n\r\n                break;\r\n            default:\r\n                break;\r\n        }\r\n\r\n        var endSizeOffset: Vector3 = ShurikenParticleSystem._tempVector36;\r\n        endSizeOffset.setValue(1, 1, 1);\r\n        if (this.sizeOverLifetime && this.sizeOverLifetime.enable) {\r\n            var gradientSize: GradientSize = this.sizeOverLifetime.size;\r\n            var maxSize: number = gradientSize.getMaxSizeInGradient(meshMode);\r\n\r\n            endSizeOffset.setValue(maxSize, maxSize, maxSize);\r\n        }\r\n\r\n        var offsetSize: number = meshSize * maxSizeScale;\r\n        Vector3.scale(endSizeOffset, offsetSize, endSizeOffset);\r\n\r\n        // var distance: number = speedOrigan * time;\r\n        var speedZOffset: Vector3 = ShurikenParticleSystem._tempVector34;\r\n        var speedFOffset: Vector3 = ShurikenParticleSystem._tempVector35;\r\n\r\n        if (speedOrigan > 0) {\r\n            Vector3.scale(zDirectionSpeed, speedOrigan, speedZOffset);\r\n            Vector3.scale(fDirectionSpeed, speedOrigan, speedFOffset);\r\n        }\r\n        else {\r\n            Vector3.scale(zDirectionSpeed, -speedOrigan, speedFOffset);\r\n            Vector3.scale(fDirectionSpeed, -speedOrigan, speedZOffset);\r\n        }\r\n\r\n        if (this.velocityOverLifetime && this.velocityOverLifetime.enable) {\r\n            var gradientVelocity: GradientVelocity = this.velocityOverLifetime.velocity;\r\n            var velocitySpeedOffset: Vector3 = ShurikenParticleSystem._tempVector37;\r\n            velocitySpeedOffset.setValue(0, 0, 0);\r\n            switch (gradientVelocity.type) {\r\n                case 0: // \r\n                    gradientVelocity.constant.cloneTo(velocitySpeedOffset);\r\n                    break;\r\n                case 2: // \r\n                    gradientVelocity.constantMax.cloneTo(velocitySpeedOffset);\r\n                    break;\r\n                case 1: // \r\n                    // todo  \r\n                    var curveX: number = gradientVelocity.gradientX.getAverageValue();\r\n                    var curveY: number = gradientVelocity.gradientY.getAverageValue();\r\n                    var curveZ: number = gradientVelocity.gradientZ.getAverageValue();\r\n                    velocitySpeedOffset.setValue(curveX, curveY, curveZ);\r\n                    break;\r\n                case 3: // \r\n                    var xMax: number = gradientVelocity.gradientXMax.getAverageValue();\r\n                    var yMax: number = gradientVelocity.gradientYMax.getAverageValue();\r\n                    var zMax: number = gradientVelocity.gradientZMax.getAverageValue();\r\n                    velocitySpeedOffset.setValue(xMax, yMax, zMax);\r\n                    break;\r\n                default:\r\n                    break;\r\n            }\r\n\r\n            //  world\r\n            if (this.velocityOverLifetime.space == 1) {\r\n                Vector3.transformV3ToV3(velocitySpeedOffset, this._owner.transform.worldMatrix, velocitySpeedOffset);\r\n            }\r\n\r\n            Vector3.add(speedZOffset, velocitySpeedOffset, speedZOffset);\r\n            Vector3.subtract(speedFOffset, velocitySpeedOffset, speedFOffset);\r\n\r\n            Vector3.max(speedZOffset, Vector3.ZERO, speedZOffset);\r\n            Vector3.max(speedFOffset, Vector3.ZERO, speedFOffset);\r\n        }\r\n\r\n        Vector3.scale(speedZOffset, time, speedZOffset);\r\n        Vector3.scale(speedFOffset, time, speedFOffset);\r\n\r\n        //gravity\r\n        var gravity: number = this.gravityModifier;\r\n        if (gravity != 0) {\r\n            // \r\n            var gravityOffset: number = 0.5 * ShurikenParticleSystem.g * gravity * time * time;\r\n\r\n            var speedZOffsetY = speedZOffset.y - gravityOffset;\r\n            var speedFOffsetY = speedFOffset.y + gravityOffset;\r\n\r\n            speedZOffsetY = speedZOffsetY > 0 ? speedZOffsetY : 0;\r\n            speedFOffsetY = speedFOffsetY > 0 ? speedFOffsetY : 0;\r\n\r\n            this._gravityOffset.setValue(speedZOffset.y - speedZOffsetY, speedFOffsetY - speedFOffset.y);\r\n        }\r\n\r\n        // speedOrigan * directionSpeed * time + directionoffset + size * maxsizeScale\r\n        Vector3.add(speedZOffset, endSizeOffset, boundsMax);\r\n        Vector3.add(boundsMax, zEmisionOffsetXYZ, boundsMax);\r\n\r\n        Vector3.add(speedFOffset, endSizeOffset, boundsMin);\r\n        Vector3.add(boundsMin, fEmisionOffsetXYZ, boundsMin);\r\n        Vector3.scale(boundsMin, -1, boundsMin);\r\n\r\n        this._bounds.setMin(boundsMin);\r\n        this._bounds.setMax(boundsMax);\r\n    }\r\n\r\n    /**\r\n     *   \r\n     */\r\n    get customBounds(): Bounds {\r\n        return this._customBounds;\r\n    }\r\n\r\n    set customBounds(value: Bounds) {\r\n        if (value) {\r\n            this._useCustomBounds = true;\r\n            if (!this._customBounds) {\r\n                this._customBounds = new Bounds(new Vector3(), new Vector3());\r\n                this._ownerRender.geometryBounds = this._customBounds;\r\n            }\r\n            this._customBounds = value;\r\n\r\n        }\r\n        else {\r\n            this._useCustomBounds = false;\r\n            this._customBounds = null;\r\n            this._ownerRender.geometryBounds = null;\r\n        }\r\n\r\n\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    _simulationSupported(): boolean {\r\n\r\n        if (this.simulationSpace == 0 && this.emission.emissionRateOverDistance > 0) {\r\n            return false;\r\n        }\r\n\r\n        // todo other propertys break procedural \r\n\r\n        return true;\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     * \r\n     */\r\n    protected _updateEmission(): void {\r\n        if (!this.isAlive)\r\n            return;\r\n        if (this._simulateUpdate) {\r\n            this._simulateUpdate = false;\r\n        }\r\n        else {\r\n            var elapsedTime: number = ((this._startUpdateLoopCount !== Stat.loopCount && !this._isPaused) && (<Scene3D>this._owner._scene)) ? ((<Scene3D>this._owner._scene)).timer._delta / 1000.0 : 0;\r\n            elapsedTime = Math.min(ShurikenParticleSystem._maxElapsedTime, elapsedTime * this.simulationSpeed);\r\n            this._updateParticles(elapsedTime);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     * \r\n     */\r\n    protected _updateParticles(elapsedTime: number): void {\r\n        if (this._ownerRender.renderMode === 4 && !this._ownerRender.mesh)//renderMode=4mesh\r\n            return;\r\n\r\n        this._currentTime += elapsedTime;//\r\n        this._retireActiveParticles();\r\n        this._freeRetiredParticles();\r\n\r\n        //if (_firstActiveElement === _firstFreeElement){\r\n        //_frameRateTime = 0//TODO:\r\n        //_currentTime = 0;\r\n        //}\r\n        //if (_firstRetiredElement === _firstActiveElement)\r\n        //_drawCounter = 0;\r\n\r\n        this._totalDelayTime += elapsedTime;\r\n        if (this._totalDelayTime < this._playStartDelay) {\r\n            return;\r\n        }\r\n\r\n\r\n        if (this._emission.enable && this._isEmitting && !this._isPaused) {\r\n            this._advanceTime(elapsedTime, this._currentTime);\r\n            if (this.emission.emissionRateOverDistance > 0) {\r\n                this._advanceDistance(this._currentTime);\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    protected _updateParticlesSimulationRestart(time: number): void {\r\n        this._firstActiveElement = 0;\r\n        this._firstNewElement = 0;\r\n        this._firstFreeElement = 0;\r\n        this._firstRetiredElement = 0;\r\n\r\n        this._burstsIndex = 0;\r\n        this._frameRateTime = time;//TOD0:time \r\n        this._emissionTime = 0;\r\n        this._emissionDistance = 0;\r\n        this._totalDelayTime = 0;\r\n        this._currentTime = time;\r\n\r\n\r\n        var delayTime: number = time;\r\n        if (delayTime < this._playStartDelay) {\r\n            this._totalDelayTime = delayTime;\r\n            return;\r\n        }\r\n\r\n        if (this._emission.enable) {\r\n            this._advanceTime(time, time);//TODO:timetimebrust\r\n            if (this.emission.emissionRateOverDistance > 0) {\r\n                this._advanceDistance(this._currentTime);\r\n            }\r\n        }\r\n    }\r\n\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    protected _retireActiveParticles(): void {\r\n        const epsilon: number = 0.0001;\r\n        while (this._firstActiveElement != this._firstNewElement) {\r\n            var index: number = this._firstActiveElement * this._floatCountPerVertex * this._vertexStride;\r\n            var timeIndex: number = index + this._timeIndex;//11Time\r\n\r\n            var particleAge: number = this._currentTime - this._vertices[timeIndex];\r\n            if (particleAge + epsilon < this._vertices[index + this._startLifeTimeIndex]/*_maxLifeTime*/)//7lifeTime,particleAge>0\r\n                break;\r\n\r\n            this._vertices[timeIndex] = this._drawCounter;\r\n            this._firstActiveElement++;\r\n            if (this._firstActiveElement >= this._bufferMaxParticles)\r\n                this._firstActiveElement = 0;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    protected _freeRetiredParticles(): void {\r\n        while (this._firstRetiredElement != this._firstActiveElement) {\r\n            var age: number = this._drawCounter - this._vertices[this._firstRetiredElement * this._floatCountPerVertex * this._vertexStride + this._timeIndex];//11Time\r\n            //TODObug\r\n            if (false)\r\n                if (age < 3)//GPUCPUBUG\r\n                    break;\r\n\r\n            this._firstRetiredElement++;\r\n            if (this._firstRetiredElement >= this._bufferMaxParticles)\r\n                this._firstRetiredElement = 0;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * @internal5\r\n     * \r\n     */\r\n    protected _burst(fromTime: number, toTime: number): number {\r\n        var totalEmitCount: number = 0;\r\n        var bursts: Burst[] = this._emission._bursts;\r\n        for (var n: number = bursts.length; this._burstsIndex < n; this._burstsIndex++) {//TODO:_burstsIndex\r\n            var burst: Burst = bursts[this._burstsIndex];\r\n            var burstTime: number = burst.time;\r\n            if (fromTime <= burstTime && burstTime < toTime) {\r\n                var emitCount: number;\r\n                if (this.autoRandomSeed) {\r\n                    emitCount = MathUtil.lerp(burst.minCount, burst.maxCount, Math.random());\r\n                } else {\r\n                    this._rand.seed = this._randomSeeds[0];\r\n                    emitCount = MathUtil.lerp(burst.minCount, burst.maxCount, this._rand.getFloat());\r\n                    this._randomSeeds[0] = this._rand.seed;\r\n                }\r\n                totalEmitCount += emitCount;\r\n            } else {\r\n                break;\r\n            }\r\n        }\r\n        return totalEmitCount;\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    protected _advanceTime(elapsedTime: number, emitTime: number): void {\r\n        var i: number;\r\n        var lastEmissionTime: number = this._emissionTime;\r\n        this._emissionTime += elapsedTime;\r\n        var totalEmitCount: number = 0;\r\n        if (this._emissionTime > this.duration) {\r\n            if (this.looping) {//TODO:while\r\n                totalEmitCount += this._burst(lastEmissionTime, this._emissionTime);//_emissionTimedurationtimedurationburst ////TODO:_playbackTime//TODO:\r\n                this._emissionTime -= this.duration;\r\n                this._burstsIndex = 0;\r\n                totalEmitCount += this._burst(0, this._emissionTime);\r\n            } else {\r\n                totalEmitCount = Math.min(this.maxParticles - this.aliveParticleCount, totalEmitCount);\r\n                for (i = 0; i < totalEmitCount; i++)\r\n                    this.emit(emitTime);\r\n\r\n                this._isPlaying = false;\r\n                this.stop();\r\n                return;\r\n            }\r\n        } else {\r\n            totalEmitCount += this._burst(lastEmissionTime, this._emissionTime);\r\n        }\r\n        //maxParticles\r\n        totalEmitCount = Math.min(this.maxParticles - this.aliveParticleCount, totalEmitCount);\r\n        for (i = 0; i < totalEmitCount; i++)\r\n            this.emit(emitTime);\r\n        //\r\n        var emissionRate: number = this.emission.emissionRate;\r\n        if (emissionRate > 0) {\r\n            //\r\n            var minEmissionTime: number = 1 / emissionRate;\r\n            this._frameRateTime += minEmissionTime;\r\n            this._frameRateTime = this._currentTime - (this._currentTime - this._frameRateTime) % this._maxStartLifetime;//,TODO:\r\n            while (this._frameRateTime <= emitTime) {\r\n                if (this.emit(this._frameRateTime))\r\n                    this._frameRateTime += minEmissionTime;\r\n                else\r\n                    break;\r\n            }\r\n            this._frameRateTime = Math.floor(emitTime / minEmissionTime) * minEmissionTime;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    protected _advanceDistance(emitTime: number): void {\r\n        let position = this._owner.transform.position;\r\n        let offsetDistance: number = Vector3.distance(position, this._emissionLastPosition);\r\n\r\n        let rateOverDistance = this.emission.emissionRateOverDistance;\r\n\r\n        let distance = this._emissionDistance + offsetDistance;\r\n\r\n        let ed = 1.0 / rateOverDistance;\r\n        if (distance > ed) {\r\n            let emitCount = distance * rateOverDistance;\r\n            emitCount = Math.floor(emitCount);\r\n            emitCount = Math.min(this.maxParticles - this.aliveParticleCount, emitCount);\r\n            for (let index = 0; index < emitCount; index++) {\r\n                this.emit(emitTime);\r\n            }\r\n            // console.log(\"emission distance: \", distance, \", count: \", emitCount);\r\n\r\n            this._emissionDistance = 0;\r\n        }\r\n        else {\r\n            this._emissionDistance = distance;\r\n        }\r\n\r\n        position.cloneTo(this._emissionLastPosition);\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    _initBufferDatas(): void {\r\n        if (this._vertexBuffer) {//maxCountrenderModeMesh\r\n            var memorySize: number = this._vertexBuffer._byteLength + this._indexBuffer.indexCount * 2;\r\n            this._vertexBuffer.destroy();\r\n            this._indexBuffer.destroy();\r\n            Resource._addMemory(-memorySize, -memorySize);\r\n            //TODO:some time use clone will cause this call twice(from 'maxParticleCount' and 'renderMode'),this should optimization rewrite with special clone fun.\r\n        }\r\n        var render: ShurikenParticleRenderer = this._ownerRender;\r\n        var renderMode: number = render.renderMode;\r\n\r\n        if (renderMode !== -1 && this.maxParticles > 0) {\r\n            var indices: Uint16Array, i: number, j: number, m: number, indexOffset: number, perPartOffset: number, vertexDeclaration: VertexDeclaration;\r\n            var vbMemorySize: number = 0, memorySize: number = 0;\r\n            var mesh: Mesh = render.mesh;\r\n            if (renderMode === 4) {\r\n                if (mesh) {\r\n                    // var vertexBufferCount: number = mesh._vertexBuffers.length;\r\n                    // if (vertexBufferCount > 1) {\r\n                    // \tthrow new Error(\"ShurikenParticleSystem: submesh Count mesh be One or all subMeshes have the same vertexDeclaration.\");\r\n                    // } else {\r\n                    vertexDeclaration = VertexShurikenParticleMesh.vertexDeclaration;\r\n                    this._floatCountPerVertex = vertexDeclaration.vertexStride / 4;\r\n                    this._simulationUV_Index = vertexDeclaration.getVertexElementByUsage(VertexShuriKenParticle.PARTICLE_SIMULATIONUV).offset / 4;\r\n                    this._startLifeTimeIndex = 12;\r\n                    this._timeIndex = 16;\r\n                    this._vertexStride = mesh._vertexCount;\r\n                    var totalVertexCount: number = this._bufferMaxParticles * this._vertexStride;\r\n                    var vbCount: number = Math.floor(totalVertexCount / 65535) + 1;\r\n                    var lastVBVertexCount: number = totalVertexCount % 65535;\r\n                    if (vbCount > 1) {//TODO:\r\n                        throw new Error(\"ShurikenParticleSystem:the maxParticleCount multiply mesh vertexCount is large than 65535.\");\r\n                    }\r\n\r\n                    vbMemorySize = vertexDeclaration.vertexStride * lastVBVertexCount;\r\n                    this._vertexBuffer = Laya3DRender.renderOBJCreate.createVertexBuffer3D(vbMemorySize, BufferUsage.Dynamic, false);\r\n                    this._vertexBuffer.vertexDeclaration = vertexDeclaration;\r\n                    this._vertices = new Float32Array(this._floatCountPerVertex * lastVBVertexCount);\r\n\r\n                    // if (render.renderMode == 4) {\r\n                    // \tthis.initVertexWithMesh(this._vertices, mesh);\r\n                    // }\r\n\r\n                    this._indexStride = mesh._indexBuffer.indexCount;\r\n                    var indexDatas: Uint16Array = mesh._indexBuffer.getData();\r\n                    var indexCount: number = this._bufferMaxParticles * this._indexStride;\r\n                    this._indexBuffer = Laya3DRender.renderOBJCreate.createIndexBuffer3D(IndexFormat.UInt16, indexCount, BufferUsage.Static, false);\r\n                    indices = new Uint16Array(indexCount);\r\n\r\n                    memorySize = vbMemorySize + indexCount * 2;\r\n\r\n                    indexOffset = 0;\r\n                    for (i = 0; i < this._bufferMaxParticles; i++) {\r\n                        var indexValueOffset: number = i * this._vertexStride;\r\n                        for (j = 0, m = indexDatas.length; j < m; j++)\r\n                            indices[indexOffset++] = indexValueOffset + indexDatas[j];\r\n                    }\r\n                    this._indexBuffer.setData(indices);\r\n                    this._bufferState.applyState([this._vertexBuffer], this._indexBuffer);\r\n                    this.bufferState = this._bufferState;\r\n                }\r\n            } else {\r\n                vertexDeclaration = VertexShurikenParticleBillboard.vertexDeclaration;\r\n                this._floatCountPerVertex = vertexDeclaration.vertexStride / 4;\r\n                this._startLifeTimeIndex = 7;\r\n                this._simulationUV_Index = vertexDeclaration.getVertexElementByUsage(VertexShuriKenParticle.PARTICLE_SIMULATIONUV).offset / 4;\r\n                this._timeIndex = 11;\r\n                this._vertexStride = 4;\r\n                vbMemorySize = vertexDeclaration.vertexStride * this._bufferMaxParticles * this._vertexStride;\r\n                this._vertexBuffer = Laya3DRender.renderOBJCreate.createVertexBuffer3D(vbMemorySize, BufferUsage.Dynamic, false);\r\n                this._vertexBuffer.vertexDeclaration = vertexDeclaration;\r\n                this._vertices = new Float32Array(this._floatCountPerVertex * this._bufferMaxParticles * this._vertexStride);\r\n\r\n\r\n                for (i = 0; i < this._bufferMaxParticles; i++) {\r\n                    perPartOffset = i * this._floatCountPerVertex * this._vertexStride;\r\n                    this._vertices[perPartOffset] = -0.5;\r\n                    this._vertices[perPartOffset + 1] = -0.5;\r\n                    this._vertices[perPartOffset + 2] = 0;\r\n                    this._vertices[perPartOffset + 3] = 1;\r\n\r\n                    perPartOffset += this._floatCountPerVertex;\r\n                    this._vertices[perPartOffset] = 0.5;\r\n                    this._vertices[perPartOffset + 1] = -0.5;\r\n                    this._vertices[perPartOffset + 2] = 1;\r\n                    this._vertices[perPartOffset + 3] = 1;\r\n\r\n                    perPartOffset += this._floatCountPerVertex\r\n                    this._vertices[perPartOffset] = 0.5;\r\n                    this._vertices[perPartOffset + 1] = 0.5;\r\n                    this._vertices[perPartOffset + 2] = 1;\r\n                    this._vertices[perPartOffset + 3] = 0;\r\n\r\n                    perPartOffset += this._floatCountPerVertex\r\n                    this._vertices[perPartOffset] = -0.5;\r\n                    this._vertices[perPartOffset + 1] = 0.5;\r\n                    this._vertices[perPartOffset + 2] = 0;\r\n                    this._vertices[perPartOffset + 3] = 0;\r\n                }\r\n\r\n                this._indexStride = 6;\r\n                this._indexBuffer = Laya3DRender.renderOBJCreate.createIndexBuffer3D(IndexFormat.UInt16, this._bufferMaxParticles * 6, BufferUsage.Static, false);\r\n                indices = new Uint16Array(this._bufferMaxParticles * 6);\r\n                for (i = 0; i < this._bufferMaxParticles; i++) {\r\n                    indexOffset = i * 6;\r\n                    var firstVertex: number = i * this._vertexStride, secondVertex: number = firstVertex + 2;\r\n                    indices[indexOffset++] = firstVertex;\r\n                    indices[indexOffset++] = secondVertex;\r\n                    indices[indexOffset++] = firstVertex + 1;\r\n                    indices[indexOffset++] = firstVertex;\r\n                    indices[indexOffset++] = firstVertex + 3;\r\n                    indices[indexOffset++] = secondVertex;\r\n                }\r\n                this._indexBuffer.setData(indices);\r\n\r\n                memorySize = vbMemorySize + this._bufferMaxParticles * 6 * 2;\r\n                this._bufferState.applyState([this._vertexBuffer], this._indexBuffer);\r\n                this.bufferState = this._bufferState;\r\n            }\r\n\r\n            Resource._addMemory(memorySize, memorySize);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     * @override\r\n     */\r\n    destroy(): void {\r\n        super.destroy();\r\n        if (this._vertexBuffer) {\r\n            var memorySize: number = this._vertexBuffer._byteLength;\r\n            Resource._addMemory(-memorySize, -memorySize);\r\n            this._vertexBuffer.destroy();\r\n            this._vertexBuffer = null;\r\n        }\r\n        if (this._indexBuffer) {\r\n            var memorySize: number = this._indexBuffer._byteLength;\r\n            Resource._addMemory(-memorySize, -memorySize);\r\n            this._indexBuffer.destroy();\r\n            this._indexBuffer = null;\r\n        }\r\n        this._emission.destroy();\r\n        this._bounds = null;\r\n        this._customBounds = null;\r\n        this._bufferState = null;\r\n        this._owner = null;\r\n        this._vertices = null;\r\n        this._indexBuffer = null;\r\n        this._emission = null;\r\n        this._shape = null;\r\n        this.startLifeTimeGradient = null;\r\n        this.startLifeTimeGradientMin = null;\r\n        this.startLifeTimeGradientMax = null;\r\n        this.startSizeConstantSeparate = null;\r\n        this.startSizeConstantMinSeparate = null;\r\n        this.startSizeConstantMaxSeparate = null;\r\n        this.startRotationConstantSeparate = null;\r\n        this.startRotationConstantMinSeparate = null;\r\n        this.startRotationConstantMaxSeparate = null;\r\n        this.startColorConstant = null;\r\n        this.startColorConstantMin = null;\r\n        this.startColorConstantMax = null;\r\n        this._velocityOverLifetime = null;\r\n        this._colorOverLifetime = null;\r\n        this._sizeOverLifetime = null;\r\n        this._rotationOverLifetime = null;\r\n        this._textureSheetAnimation = null;\r\n    }\r\n\r\n    /**\r\n     * \r\n     */\r\n    emit(time: number): boolean {\r\n        var position: Vector3 = ShurikenParticleSystem._tempPosition;\r\n        var direction: Vector3 = ShurikenParticleSystem._tempDirection;\r\n        if (this._shape && this._shape.enable) {\r\n            if (this.autoRandomSeed)\r\n                this._shape.generatePositionAndDirection(position, direction);\r\n            else\r\n                this._shape.generatePositionAndDirection(position, direction, this._rand, this._randomSeeds);\r\n        } else {\r\n            position.x = position.y = position.z = 0;\r\n            direction.x = direction.y = 0;\r\n            direction.z = 1;\r\n        }\r\n\r\n        return this.addParticle(position, direction, time);//TODO:\r\n    }\r\n\r\n    //\r\n    addParticle(position: Vector3, direction: Vector3, time: number): boolean {//TODO:\r\n        Vector3.normalize(direction, direction);\r\n        //\r\n        var nextFreeParticle: number = this._firstFreeElement + 1;\r\n        if (nextFreeParticle >= this._bufferMaxParticles)\r\n            nextFreeParticle = 0;\r\n\r\n        if (nextFreeParticle === this._firstRetiredElement)\r\n            return false;\r\n\r\n        var transform: Transform3D = this._owner.transform;\r\n        ShurikenParticleData.create(this, this._ownerRender);\r\n\r\n        var particleAge: number = this._currentTime - time;\r\n        if (particleAge >= ShurikenParticleData.startLifeTime)//,TODO:\r\n            return true;\r\n\r\n        var pos: Vector3, rot: Quaternion;\r\n        if (this.simulationSpace == 0) {\r\n            pos = transform.position;\r\n            rot = transform.rotation;\r\n        }\r\n\r\n        //StartSpeed\r\n        var startSpeed: number;\r\n        switch (this.startSpeedType) {\r\n            case 0:\r\n                startSpeed = this.startSpeedConstant;\r\n                break;\r\n            case 2:\r\n                if (this.autoRandomSeed) {\r\n                    startSpeed = MathUtil.lerp(this.startSpeedConstantMin, this.startSpeedConstantMax, Math.random());\r\n                } else {\r\n                    this._rand.seed = this._randomSeeds[8];\r\n                    startSpeed = MathUtil.lerp(this.startSpeedConstantMin, this.startSpeedConstantMax, this._rand.getFloat());\r\n                    this._randomSeeds[8] = this._rand.seed;\r\n                }\r\n                break;\r\n        }\r\n\r\n\r\n        var randomVelocityX: number, randomVelocityY: number, randomVelocityZ: number, randomColor: number, randomSize: number, randomRotation: number, randomTextureAnimation: number;\r\n        var needRandomVelocity: boolean = this._velocityOverLifetime && this._velocityOverLifetime.enable;\r\n        if (needRandomVelocity) {\r\n            var velocityType: number = this._velocityOverLifetime.velocity.type;\r\n            if (velocityType === 2 || velocityType === 3) {\r\n                if (this.autoRandomSeed) {\r\n                    randomVelocityX = Math.random();\r\n                    randomVelocityY = Math.random();\r\n                    randomVelocityZ = Math.random();\r\n                } else {\r\n                    this._rand.seed = this._randomSeeds[9];\r\n                    randomVelocityX = this._rand.getFloat();\r\n                    randomVelocityY = this._rand.getFloat();\r\n                    randomVelocityZ = this._rand.getFloat();\r\n                    this._randomSeeds[9] = this._rand.seed;\r\n                }\r\n            } else {\r\n                needRandomVelocity = false;\r\n            }\r\n        } else {\r\n            needRandomVelocity = false;\r\n        }\r\n        var needRandomColor: boolean = this._colorOverLifetime && this._colorOverLifetime.enable;\r\n        if (needRandomColor) {\r\n            var colorType: number = this._colorOverLifetime.color.type;\r\n            if (colorType === 3) {\r\n                if (this.autoRandomSeed) {\r\n                    randomColor = Math.random();\r\n                } else {\r\n                    this._rand.seed = this._randomSeeds[10];\r\n                    randomColor = this._rand.getFloat();\r\n                    this._randomSeeds[10] = this._rand.seed;\r\n                }\r\n            } else {\r\n                needRandomColor = false;\r\n            }\r\n        } else {\r\n            needRandomColor = false;\r\n        }\r\n        var needRandomSize: boolean = this._sizeOverLifetime && this._sizeOverLifetime.enable;\r\n        if (needRandomSize) {\r\n            var sizeType: number = this._sizeOverLifetime.size.type;\r\n            if (sizeType === 3) {\r\n                if (this.autoRandomSeed) {\r\n                    randomSize = Math.random();\r\n                } else {\r\n                    this._rand.seed = this._randomSeeds[11];\r\n                    randomSize = this._rand.getFloat();\r\n                    this._randomSeeds[11] = this._rand.seed;\r\n                }\r\n            } else {\r\n                needRandomSize = false;\r\n            }\r\n        } else {\r\n            needRandomSize = false;\r\n        }\r\n        var needRandomRotation: boolean = this._rotationOverLifetime && this._rotationOverLifetime.enable;\r\n        if (needRandomRotation) {\r\n            var rotationType: number = this._rotationOverLifetime.angularVelocity.type;\r\n            if (rotationType === 2 || rotationType === 3) {\r\n                if (this.autoRandomSeed) {\r\n                    randomRotation = Math.random();\r\n                } else {\r\n                    this._rand.seed = this._randomSeeds[12];\r\n                    randomRotation = this._rand.getFloat();\r\n                    this._randomSeeds[12] = this._rand.seed;\r\n                }\r\n            } else {\r\n                needRandomRotation = false;\r\n            }\r\n        } else {\r\n            needRandomRotation = false;\r\n        }\r\n        var needRandomTextureAnimation: boolean = this._textureSheetAnimation && this._textureSheetAnimation.enable;\r\n        if (needRandomTextureAnimation) {\r\n            var textureAnimationType: number = this._textureSheetAnimation.frame.type;\r\n            if (textureAnimationType === 3) {\r\n                if (this.autoRandomSeed) {\r\n                    randomTextureAnimation = Math.random();\r\n                } else {\r\n                    this._rand.seed = this._randomSeeds[15];\r\n                    randomTextureAnimation = this._rand.getFloat();\r\n                    this._randomSeeds[15] = this._rand.seed;\r\n                }\r\n            } else {\r\n                needRandomTextureAnimation = false;\r\n            }\r\n        } else {\r\n            needRandomTextureAnimation = false;\r\n        }\r\n\r\n        var startIndex: number = this._firstFreeElement * this._floatCountPerVertex * this._vertexStride;\r\n        var subU: number = ShurikenParticleData.startUVInfo[0];\r\n        var subV: number = ShurikenParticleData.startUVInfo[1];\r\n        var startU: number = ShurikenParticleData.startUVInfo[2];\r\n        var startV: number = ShurikenParticleData.startUVInfo[3];\r\n\r\n        var meshVertices: Float32Array, meshVertexStride: number, meshPosOffset: number, meshCorOffset: number, meshUVOffset: number, meshVertexIndex: number;\r\n        var render: ShurikenParticleRenderer = this._ownerRender;\r\n        if (render.renderMode === 4) {\r\n            var meshVB: VertexBuffer3D = render.mesh._vertexBuffer;\r\n            meshVertices = meshVB.getFloat32Data();\r\n            var meshVertexDeclaration: VertexDeclaration = meshVB.vertexDeclaration;\r\n            meshPosOffset = meshVertexDeclaration.getVertexElementByUsage(VertexMesh.MESH_POSITION0)._offset / 4;\r\n            var colorElement: VertexElement = meshVertexDeclaration.getVertexElementByUsage(VertexMesh.MESH_COLOR0);\r\n            meshCorOffset = colorElement ? colorElement._offset / 4 : -1;\r\n            var uvElement: VertexElement = meshVertexDeclaration.getVertexElementByUsage(VertexMesh.MESH_TEXTURECOORDINATE0);\r\n            meshUVOffset = uvElement ? uvElement._offset / 4 : -1;\r\n            meshVertexStride = meshVertexDeclaration.vertexStride / 4;\r\n            meshVertexIndex = 0;\r\n        }\r\n\r\n        for (var i: number = startIndex, n: number = startIndex + this._floatCountPerVertex * this._vertexStride; i < n; i += this._floatCountPerVertex) {\r\n            var offset: number;\r\n            if (render.renderMode === 4) {\r\n                offset = i;\r\n                var vertexOffset: number = meshVertexStride * (meshVertexIndex++);\r\n                var meshOffset: number = vertexOffset + meshPosOffset;\r\n                this._vertices[offset++] = meshVertices[meshOffset++];\r\n                this._vertices[offset++] = meshVertices[meshOffset++];\r\n                this._vertices[offset++] = meshVertices[meshOffset];\r\n                if (meshCorOffset === -1) {\r\n                    this._vertices[offset++] = 1.0;\r\n                    this._vertices[offset++] = 1.0;\r\n                    this._vertices[offset++] = 1.0;\r\n                    this._vertices[offset++] = 1.0;\r\n                }\r\n                else {\r\n                    meshOffset = vertexOffset + meshCorOffset;\r\n                    this._vertices[offset++] = meshVertices[meshOffset++];\r\n                    this._vertices[offset++] = meshVertices[meshOffset++];\r\n                    this._vertices[offset++] = meshVertices[meshOffset++];\r\n                    this._vertices[offset++] = meshVertices[meshOffset];\r\n                }\r\n                if (meshUVOffset === -1) {\r\n                    this._vertices[offset++] = 0.0;\r\n                    this._vertices[offset++] = 0.0;\r\n                }\r\n                else {\r\n                    meshOffset = vertexOffset + meshUVOffset;\r\n                    this._vertices[offset++] = meshVertices[meshOffset++];\r\n                    this._vertices[offset++] = meshVertices[meshOffset];\r\n                }\r\n            } else {\r\n                offset = i + 4;\r\n            }\r\n\r\n            this._vertices[offset++] = position.x;\r\n            this._vertices[offset++] = position.y;\r\n            this._vertices[offset++] = position.z;\r\n\r\n            this._vertices[offset++] = ShurikenParticleData.startLifeTime;\r\n\r\n            this._vertices[offset++] = direction.x;\r\n            this._vertices[offset++] = direction.y;\r\n            this._vertices[offset++] = direction.z;\r\n            this._vertices[offset++] = time;\r\n\r\n            this._vertices[offset++] = ShurikenParticleData.startColor.x;\r\n            this._vertices[offset++] = ShurikenParticleData.startColor.y;\r\n            this._vertices[offset++] = ShurikenParticleData.startColor.z;\r\n            this._vertices[offset++] = ShurikenParticleData.startColor.w;\r\n\r\n            this._vertices[offset++] = ShurikenParticleData.startSize[0];\r\n            this._vertices[offset++] = ShurikenParticleData.startSize[1];\r\n            this._vertices[offset++] = ShurikenParticleData.startSize[2];\r\n\r\n            this._vertices[offset++] = ShurikenParticleData.startRotation[0];\r\n            this._vertices[offset++] = ShurikenParticleData.startRotation[1];\r\n            this._vertices[offset++] = ShurikenParticleData.startRotation[2];\r\n\r\n            //StartSpeed\r\n            this._vertices[offset++] = startSpeed;\r\n\r\n            //this._vertices[offset] = Math.random();\r\n\r\n\r\n            needRandomColor && (this._vertices[offset + 1] = randomColor);\r\n            needRandomSize && (this._vertices[offset + 2] = randomSize);\r\n            needRandomRotation && (this._vertices[offset + 3] = randomRotation);\r\n            needRandomTextureAnimation && (this._vertices[offset + 4] = randomTextureAnimation);\r\n            if (needRandomVelocity) {\r\n                this._vertices[offset + 5] = randomVelocityX;\r\n                this._vertices[offset + 6] = randomVelocityY;\r\n                this._vertices[offset + 7] = randomVelocityZ;\r\n            }\r\n\r\n            switch (this.simulationSpace) {\r\n                case 0:\r\n                    offset += 8;\r\n                    this._vertices[offset++] = pos.x;\r\n                    this._vertices[offset++] = pos.y;\r\n                    this._vertices[offset++] = pos.z;\r\n                    this._vertices[offset++] = rot.x;\r\n                    this._vertices[offset++] = rot.y;\r\n                    this._vertices[offset++] = rot.z;\r\n                    this._vertices[offset++] = rot.w;\r\n                    break;\r\n                case 1:\r\n                    break;\r\n                default:\r\n                    throw new Error(\"ShurikenParticleMaterial: SimulationSpace value is invalid.\");\r\n            }\r\n            offset = i + this._simulationUV_Index;\r\n            this._vertices[offset++] = startU;\r\n            this._vertices[offset++] = startV;\r\n            this._vertices[offset++] = subU;\r\n            this._vertices[offset] = subV;\r\n        }\r\n\r\n        this._firstFreeElement = nextFreeParticle;\r\n        return true;\r\n    }\r\n\r\n    addNewParticlesToVertexBuffer(): void {\r\n        var start: number;\r\n        var byteStride: number = this._vertexStride * this._floatCountPerVertex * 4;\r\n        if (this._firstNewElement < this._firstFreeElement) {\r\n            start = this._firstNewElement * byteStride;\r\n            this._vertexBuffer.setData(this._vertices.buffer, start, start, (this._firstFreeElement - this._firstNewElement) * byteStride);\r\n\r\n        } else {\r\n            start = this._firstNewElement * byteStride;\r\n            this._vertexBuffer.setData(this._vertices.buffer, start, start, (this._bufferMaxParticles - this._firstNewElement) * byteStride);\r\n\r\n            if (this._firstFreeElement > 0) {\r\n                this._vertexBuffer.setData(this._vertices.buffer, 0, 0, this._firstFreeElement * byteStride);\r\n\r\n            }\r\n        }\r\n        this._firstNewElement = this._firstFreeElement;\r\n    }\r\n\r\n    /**\r\n     * @inheritDoc\r\n     * @override\r\n     */\r\n    _getType(): number {\r\n        return ShurikenParticleSystem._type;\r\n    }\r\n\r\n    /**\r\n     * @inheritDoc\r\n     * @override\r\n     * @internal\r\n     */\r\n    _prepareRender(state: RenderContext3D): boolean {\r\n        if (this._updateMask != Stat.loopCount) {\r\n            this._updateMask = Stat.loopCount;\r\n            this._updateEmission();\r\n            //, setData  here\r\n            if (this._firstNewElement != this._firstFreeElement)\r\n                this.addNewParticlesToVertexBuffer();\r\n            this._drawCounter++;\r\n        }\r\n\r\n\r\n        if (this._firstActiveElement != this._firstFreeElement)\r\n            return true;\r\n        else\r\n            return false;\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     * @override\r\n     */\r\n    _updateRenderParams(state: RenderContext3D): void {\r\n        //this._bufferState.bind();\r\n        var indexCount: number;\r\n        this.clearRenderParams();\r\n        if (this._firstActiveElement < this._firstFreeElement) {\r\n            indexCount = (this._firstFreeElement - this._firstActiveElement) * this._indexStride;\r\n            this.setDrawElemenParams(indexCount, 2 * this._firstActiveElement * this._indexStride);\r\n            // LayaGL.renderDrawConatext.drawElements(MeshTopology.Triangles, indexCount, IndexFormat.UInt16, 2 * this._firstActiveElement * this._indexStride);\r\n            // Stat.trianglesFaces += indexCount / 3;\r\n            // Stat.renderBatches++;\r\n        } else {\r\n            indexCount = (this._bufferMaxParticles - this._firstActiveElement) * this._indexStride;\r\n            this.setDrawElemenParams(indexCount, 2 * this._firstActiveElement * this._indexStride);\r\n            // LayaGL.renderDrawConatext.drawElements(MeshTopology.Triangles, indexCount, IndexFormat.UInt16, 2 * this._firstActiveElement * this._indexStride);\r\n            // Stat.trianglesFaces += indexCount / 3;\r\n            // Stat.renderBatches++;\r\n            if (this._firstFreeElement > 0) {\r\n                indexCount = this._firstFreeElement * this._indexStride;\r\n                this.setDrawElemenParams(indexCount, 0);\r\n                // LayaGL.renderDrawConatext.drawElements(MeshTopology.Triangles, indexCount, IndexFormat.UInt16, 0);\r\n                // Stat.trianglesFaces += indexCount / 3;\r\n                // Stat.renderBatches++;\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * \r\n     */\r\n    play(): void {\r\n        this._burstsIndex = 0;\r\n        this._isEmitting = true;\r\n        this._isPlaying = true;\r\n        this._isPaused = false;\r\n        this._emissionTime = 0;\r\n        this._emissionDistance = 0;\r\n        this._owner.transform.position.cloneTo(this._emissionLastPosition);\r\n        this._totalDelayTime = 0;\r\n\r\n        if (!this.autoRandomSeed) {\r\n            for (var i: number = 0, n: number = this._randomSeeds.length; i < n; i++)\r\n                this._randomSeeds[i] = this.randomSeed[0] + ShurikenParticleSystem._RANDOMOFFSET[i];\r\n        }\r\n\r\n        switch (this.startDelayType) {\r\n            case 0:\r\n                this._playStartDelay = this.startDelay;\r\n                break;\r\n            case 1:\r\n                if (this.autoRandomSeed) {\r\n                    this._playStartDelay = MathUtil.lerp(this.startDelayMin, this.startDelayMax, Math.random());\r\n                } else {\r\n                    this._rand.seed = this._randomSeeds[2];\r\n                    this._playStartDelay = MathUtil.lerp(this.startDelayMin, this.startDelayMax, this._rand.getFloat());\r\n                    this._randomSeeds[2] = this._rand.seed;\r\n                }\r\n                break;\r\n            default:\r\n                throw new Error(\"Utils3D: startDelayType is invalid.\");\r\n        }\r\n        this._frameRateTime = this._currentTime + this._playStartDelay;//,\r\n\r\n        this._startUpdateLoopCount = Stat.loopCount;\r\n    }\r\n\r\n    /**\r\n     * \r\n     */\r\n    pause(): void {\r\n        this._isPaused = true;\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @param time .restarttrue,\r\n     * @param restart \r\n     */\r\n    simulate(time: number, restart: boolean = true): void {\r\n        this._simulateUpdate = true;\r\n\r\n        if (restart) {\r\n            this._updateParticlesSimulationRestart(time);\r\n        }\r\n        else {\r\n            this._isPaused = false;//\r\n            this._updateParticles(time);\r\n        }\r\n\r\n        this.pause();\r\n    }\r\n\r\n    /**\r\n     * \r\n     */\r\n    stop(): void {\r\n        this._burstsIndex = 0;\r\n        this._isEmitting = false;\r\n        this._emissionTime = 0;\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @param\tdestObject \r\n     */\r\n    cloneTo(destObject: any): void {\r\n        var dest: ShurikenParticleSystem = (<ShurikenParticleSystem>destObject);\r\n\r\n        dest._useCustomBounds = this._useCustomBounds;\r\n        (this._customBounds) && (this._customBounds.cloneTo(dest._customBounds));\r\n\r\n        dest.duration = this.duration;\r\n        dest.looping = this.looping;\r\n        dest.prewarm = this.prewarm;\r\n        dest.startDelayType = this.startDelayType;\r\n        dest.startDelay = this.startDelay;\r\n        dest.startDelayMin = this.startDelayMin;\r\n        dest.startDelayMax = this.startDelayMax;\r\n\r\n        dest._maxStartLifetime = this._maxStartLifetime;\r\n        dest.startLifetimeType = this.startLifetimeType;\r\n        dest.startLifetimeConstant = this.startLifetimeConstant;\r\n        this.startLifeTimeGradient.cloneTo(dest.startLifeTimeGradient);\r\n        dest.startLifetimeConstantMin = this.startLifetimeConstantMin;\r\n        dest.startLifetimeConstantMax = this.startLifetimeConstantMax;\r\n        this.startLifeTimeGradientMin.cloneTo(dest.startLifeTimeGradientMin);\r\n        this.startLifeTimeGradientMax.cloneTo(dest.startLifeTimeGradientMax);\r\n\r\n        dest.startSpeedType = this.startSpeedType;\r\n        dest.startSpeedConstant = this.startSpeedConstant;\r\n        dest.startSpeedConstantMin = this.startSpeedConstantMin;\r\n        dest.startSpeedConstantMax = this.startSpeedConstantMax;\r\n\r\n        dest.dragType = this.dragType;\r\n        dest.dragConstant = this.dragConstant;\r\n        dest.dragSpeedConstantMax = this.dragSpeedConstantMax;\r\n        dest.dragSpeedConstantMin = this.dragSpeedConstantMin;\r\n\r\n        dest.threeDStartSize = this.threeDStartSize;\r\n        dest.startSizeType = this.startSizeType;\r\n        dest.startSizeConstant = this.startSizeConstant;\r\n        this.startSizeConstantSeparate.cloneTo(dest.startSizeConstantSeparate);\r\n        dest.startSizeConstantMin = this.startSizeConstantMin;\r\n        dest.startSizeConstantMax = this.startSizeConstantMax;\r\n        this.startSizeConstantMinSeparate.cloneTo(dest.startSizeConstantMinSeparate);\r\n        this.startSizeConstantMaxSeparate.cloneTo(dest.startSizeConstantMaxSeparate);\r\n\r\n        dest.threeDStartRotation = this.threeDStartRotation;\r\n        dest.startRotationType = this.startRotationType;\r\n        dest.startRotationConstant = this.startRotationConstant;\r\n        this.startRotationConstantSeparate.cloneTo(dest.startRotationConstantSeparate);\r\n        dest.startRotationConstantMin = this.startRotationConstantMin;\r\n        dest.startRotationConstantMax = this.startRotationConstantMax;\r\n        this.startRotationConstantMinSeparate.cloneTo(dest.startRotationConstantMinSeparate);\r\n        this.startRotationConstantMaxSeparate.cloneTo(dest.startRotationConstantMaxSeparate);\r\n\r\n        dest.randomizeRotationDirection = this.randomizeRotationDirection;\r\n\r\n        dest.startColorType = this.startColorType;\r\n        this.startColorConstant.cloneTo(dest.startColorConstant);\r\n        this.startColorConstantMin.cloneTo(dest.startColorConstantMin);\r\n        this.startColorConstantMax.cloneTo(dest.startColorConstantMax);\r\n\r\n        dest.gravityModifier = this.gravityModifier;\r\n        dest.simulationSpace = this.simulationSpace;\r\n        dest.simulationSpeed = this.simulationSpeed;\r\n        dest.scaleMode = this.scaleMode;\r\n        dest.playOnAwake = this.playOnAwake;\r\n        dest.autoRandomSeed = this.autoRandomSeed;\r\n        dest.randomSeed[0] = this.randomSeed[0];\r\n\r\n        dest.maxParticles = this.maxParticles;\r\n\r\n        //TODO:\r\n        (this._emission) && (dest._emission = this._emission.clone());\r\n        (this.shape) && (dest.shape = this.shape.clone());\r\n        (this.velocityOverLifetime) && (dest.velocityOverLifetime = this.velocityOverLifetime.clone());\r\n        (this.colorOverLifetime) && (dest.colorOverLifetime = this.colorOverLifetime.clone());\r\n        (this.sizeOverLifetime) && (dest.sizeOverLifetime = this.sizeOverLifetime.clone());\r\n        (this.rotationOverLifetime) && (dest.rotationOverLifetime = this.rotationOverLifetime.clone());\r\n        (this.textureSheetAnimation) && (dest.textureSheetAnimation = this.textureSheetAnimation.clone());\r\n        //\r\n\r\n        dest.isPerformanceMode = this.isPerformanceMode;\r\n\r\n        dest._isEmitting = this._isEmitting;\r\n        dest._isPlaying = this._isPlaying;\r\n        dest._isPaused = this._isPaused;\r\n        dest._playStartDelay = this._playStartDelay;\r\n        dest._frameRateTime = this._frameRateTime;\r\n        dest._emissionTime = this._emissionTime;\r\n        dest._totalDelayTime = this._totalDelayTime;\r\n        dest._burstsIndex = this._burstsIndex;\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @return\t \r\n     */\r\n    clone(): any {\r\n        var dest: ShurikenParticleSystem = new ShurikenParticleSystem(null);\r\n        this.cloneTo(dest);\r\n        return dest;\r\n    }\r\n}\r\n\r\n\r\n","import { MathUtil } from \"../../../maths/MathUtil\";\r\nimport { Quaternion } from \"../../../maths/Quaternion\";\r\nimport { Vector3 } from \"../../../maths/Vector3\";\r\nimport { BufferUsage } from \"../../../RenderEngine/RenderEnum/BufferTargetType\";\r\nimport { DrawType } from \"../../../RenderEngine/RenderEnum/DrawType\";\r\nimport { IndexFormat } from \"../../../RenderEngine/RenderEnum/IndexFormat\";\r\nimport { MeshTopology } from \"../../../RenderEngine/RenderEnum/RenderPologyMode\";\r\nimport { VertexMesh } from \"../../../RenderEngine/RenderShader/VertexMesh\";\r\nimport { VertexElement } from \"../../../renders/VertexElement\";\r\nimport { VertexShuriKenParticle } from \"../../graphics/Vertex/VertexShuriKenParticle\";\r\nimport { VertexShurikenParticleBillboard } from \"../../graphics/Vertex/VertexShurikenParticleBillboard\";\r\nimport { VertexShurikenParticleMesh } from \"../../graphics/Vertex/VertexShurikenParticleMesh\";\r\nimport { VertexBuffer3D } from \"../../graphics/VertexBuffer3D\";\r\nimport { Laya3DRender } from \"../../RenderObjs/Laya3DRender\";\r\nimport { Mesh } from \"../../resource/models/Mesh\";\r\nimport { RenderContext3D } from \"../render/RenderContext3D\";\r\nimport { ShurikenParticleData } from \"./ShurikenParticleData\";\r\nimport { ShurikenParticleRenderer } from \"./ShurikenParticleRenderer\";\r\nimport { ShurikenParticleSystem } from \"./ShurikenParticleSystem\";\r\n\r\nexport class ShurikenParticleInstanceSystem extends ShurikenParticleSystem {\r\n\r\n    private _instanceParticleVertexBuffer: VertexBuffer3D = null;\r\n    private _instanceVertex: Float32Array = null;\r\n\r\n\r\n    private _meshIndexCount: number;\r\n    private _meshFloatCountPreVertex: number;\r\n\r\n    /**\r\n     *  float \r\n     */\r\n    private _floatCountPerParticleData: number;\r\n\r\n    constructor(render: ShurikenParticleRenderer) {\r\n        super(render,MeshTopology.Triangles,DrawType.DrawElementInstance);\r\n    }\r\n\r\n    /***\r\n     *  mesh vb\r\n     */\r\n    private _initMeshVertex(vertex: Float32Array, mesh: Mesh) {\r\n        let meshVertexBuffer = mesh._vertexBuffer;\r\n        let meshVertices = meshVertexBuffer.getFloat32Data();\r\n        let meshVertexDeclaration = meshVertexBuffer.vertexDeclaration;\r\n\r\n        let meshPosOffset = meshVertexDeclaration.getVertexElementByUsage(VertexMesh.MESH_POSITION0)._offset / 4;\r\n\r\n        let colorElement: VertexElement = meshVertexDeclaration.getVertexElementByUsage(VertexMesh.MESH_COLOR0);\r\n        let meshColorOffset = colorElement ? colorElement._offset / 4 : -1;\r\n\r\n        let uvElement: VertexElement = meshVertexDeclaration.getVertexElementByUsage(VertexMesh.MESH_TEXTURECOORDINATE0);\r\n        let meshUVOffset = uvElement ? uvElement._offset / 4 : -1;\r\n\r\n        let meshVertexStride = meshVertexDeclaration.vertexStride / 4;\r\n        let meshVertexIndex = 0;\r\n\r\n        let vertexCount = mesh.vertexCount;\r\n\r\n        let perParticleDataCount = this._vertexBuffer.vertexDeclaration.vertexStride / 4;\r\n        for (let index = 0; index < vertexCount; index++) {\r\n            let startIndex = index * perParticleDataCount;\r\n            let indexOffset = startIndex;\r\n            let vertexOffset = meshVertexStride * meshVertexIndex++;\r\n\r\n            // position\r\n            let positionOffset = vertexOffset + meshPosOffset;\r\n            vertex[indexOffset++] = meshVertices[positionOffset++];\r\n            vertex[indexOffset++] = meshVertices[positionOffset++];\r\n            vertex[indexOffset++] = meshVertices[positionOffset++];\r\n\r\n            // color\r\n            if (meshColorOffset == -1) {\r\n                vertex[indexOffset++] = 1;\r\n                vertex[indexOffset++] = 1;\r\n                vertex[indexOffset++] = 1;\r\n                vertex[indexOffset++] = 1;\r\n            }\r\n            else {\r\n                let colorOffset = vertexOffset + meshColorOffset;\r\n                vertex[indexOffset++] = meshVertices[colorOffset++];\r\n                vertex[indexOffset++] = meshVertices[colorOffset++];\r\n                vertex[indexOffset++] = meshVertices[colorOffset++];\r\n                vertex[indexOffset++] = meshVertices[colorOffset++];\r\n            }\r\n\r\n            // uv\r\n            if (meshUVOffset == -1) {\r\n                vertex[indexOffset++] = 0;\r\n                vertex[indexOffset++] = 0;\r\n            }\r\n            else {\r\n                let uvOffset = vertexOffset + meshUVOffset;\r\n                vertex[indexOffset++] = meshVertices[uvOffset++];\r\n                vertex[indexOffset++] = meshVertices[uvOffset++];\r\n            }\r\n\r\n        }\r\n    }\r\n\r\n    /**\r\n     *  buffer\r\n     * @returns \r\n     */\r\n    _initBufferDatas(): void {\r\n        // todo  Resource._addMemory\r\n        if (this._vertexBuffer) {\r\n            // this._instanceBufferState.destroy();\r\n            this._vertexBuffer.destroy();\r\n            this._instanceParticleVertexBuffer.destroy();\r\n            this._indexBuffer.destroy();\r\n            this._vertexBuffer = null;\r\n            this._instanceParticleVertexBuffer = null;\r\n            this._indexBuffer = null;\r\n        }\r\n        let render: ShurikenParticleRenderer = this._ownerRender;\r\n        let renderMode: number = render.renderMode;\r\n\r\n        if (renderMode == -1 || this.maxParticles <= 0) {\r\n            return;\r\n        }\r\n\r\n        if (renderMode == 4) {\r\n            let mesh = render.mesh;\r\n            if (mesh) {\r\n                let meshDeclaration = VertexShurikenParticleMesh.vertexInstanceMeshDeclaration;\r\n                let particleDeclaration = VertexShurikenParticleMesh.vertexInstanceParticleDeclaration;\r\n\r\n                this._meshIndexCount = mesh.indexCount;\r\n                this._simulationUV_Index = particleDeclaration.getVertexElementByUsage(VertexShuriKenParticle.PARTICLE_SIMULATIONUV).offset / 4;\r\n                this._floatCountPerParticleData = particleDeclaration.vertexStride / 4;\r\n                this._startLifeTimeIndex = particleDeclaration.getVertexElementByUsage(VertexShuriKenParticle.PARTICLE_SHAPEPOSITIONSTARTLIFETIME)._offset / 4 + 3;\r\n                this._timeIndex = particleDeclaration.getVertexElementByUsage(VertexShuriKenParticle.PARTICLE_DIRECTIONTIME)._offset / 4 + 3;\r\n\r\n                let indexCount = mesh.indexCount;\r\n                this._indexBuffer = Laya3DRender.renderOBJCreate.createIndexBuffer3D(mesh.indexFormat, indexCount, BufferUsage.Static,false);\r\n                this._indexBuffer.setData(mesh._indexBuffer.getData());\r\n\r\n                let meshVertexCount = mesh.vertexCount;\r\n                let vbSize = meshDeclaration.vertexStride * meshVertexCount;\r\n                this._vertexBuffer = Laya3DRender.renderOBJCreate.createVertexBuffer3D(vbSize, BufferUsage.Static,false);\r\n                this._vertexBuffer.vertexDeclaration = meshDeclaration;\r\n                //  mesh  ?\r\n                //  vertexElement  \r\n                let meshVertex = new Float32Array(vbSize / 4);\r\n                this._initMeshVertex(meshVertex, mesh);\r\n\r\n                this._vertexBuffer.setData(meshVertex.buffer);\r\n\r\n                let particleCount = this._bufferMaxParticles;\r\n                let particleVbSize = particleCount * particleDeclaration.vertexStride;\r\n                this._instanceVertex = new Float32Array(particleVbSize / 4);\r\n                this._instanceParticleVertexBuffer = Laya3DRender.renderOBJCreate.createVertexBuffer3D(particleVbSize, BufferUsage.Dynamic,false);\r\n                this._instanceParticleVertexBuffer.vertexDeclaration = particleDeclaration;\r\n                this._instanceParticleVertexBuffer.setData(this._instanceVertex.buffer);\r\n                this._instanceParticleVertexBuffer.instanceBuffer = true;\r\n                this._bufferState.applyState([this._vertexBuffer,this._instanceParticleVertexBuffer],this._indexBuffer)\r\n            }\r\n\r\n        }\r\n        else {\r\n            let billboardDeclaration = VertexShurikenParticleBillboard.vertexInstanceMeshDeclaration;\r\n            let particleDeclaration = VertexShurikenParticleBillboard.vertexInstanceParticleDeclaration;\r\n\r\n            this._meshIndexCount = 6;\r\n            this._simulationUV_Index = particleDeclaration.getVertexElementByUsage(VertexShuriKenParticle.PARTICLE_SIMULATIONUV).offset / 4;\r\n            this._floatCountPerParticleData = particleDeclaration.vertexStride / 4;\r\n            this._startLifeTimeIndex = particleDeclaration.getVertexElementByUsage(VertexShuriKenParticle.PARTICLE_SHAPEPOSITIONSTARTLIFETIME)._offset / 4 + 3;\r\n            this._timeIndex = particleDeclaration.getVertexElementByUsage(VertexShuriKenParticle.PARTICLE_DIRECTIONTIME)._offset / 4 + 3;\r\n\r\n            let indexArray = VertexShurikenParticleBillboard.billboardIndexArray;\r\n            let indexCount = indexArray.length;\r\n            this._indexBuffer = Laya3DRender.renderOBJCreate.createIndexBuffer3D(IndexFormat.UInt16, indexCount, BufferUsage.Static,false);\r\n            this._indexBuffer.setData(indexArray);\r\n\r\n            let meshVBSize = this._meshIndexCount * billboardDeclaration.vertexStride;\r\n            this._vertexBuffer =Laya3DRender.renderOBJCreate.createVertexBuffer3D(meshVBSize,BufferUsage.Static,false);\r\n            this._vertexBuffer.vertexDeclaration = billboardDeclaration;\r\n            this._vertexBuffer.setData(VertexShurikenParticleBillboard.billboardVertexArray.buffer);\r\n            let particleCount = this._bufferMaxParticles;\r\n            let particleVbSize = particleCount * particleDeclaration.vertexStride;\r\n            this._instanceVertex = new Float32Array(particleVbSize / 4);\r\n            this._instanceParticleVertexBuffer = Laya3DRender.renderOBJCreate.createVertexBuffer3D(particleVbSize, BufferUsage.Dynamic,false);\r\n            this._instanceParticleVertexBuffer.vertexDeclaration = particleDeclaration;\r\n            this._instanceParticleVertexBuffer.setData(this._instanceVertex.buffer);\r\n            this._instanceParticleVertexBuffer.instanceBuffer = true;\r\n            // this._instanceBufferState.bind();\r\n            // this._instanceBufferState.applyIndexBuffer(this._indexBuffer);\r\n            // this._instanceBufferState.applyVertexBuffer(this._vertexBuffer);\r\n            // this._instanceBufferState.applyInstanceVertexBuffer(this._instanceParticleVertexBuffer);\r\n            // this._instanceBufferState.unBind();\r\n            this._bufferState.applyState([this._vertexBuffer,this._instanceParticleVertexBuffer],this._indexBuffer);\r\n        }\r\n\r\n        // let memorySize = this._instanceParticleVertexBuffer._byteLength + this._indexBuffer._byteLength + this._vertexBuffer._byteLength;\r\n\r\n        // Resource._addMemory(memorySize, memorySize);\r\n    }\r\n\r\n    protected _retireActiveParticles(): void {\r\n        if(this._instanceParticleVertexBuffer == null) return;\r\n        const epsilon: number = 0.0001;\r\n        let firstActive = this._firstActiveElement;\r\n        while (this._firstActiveElement != this._firstNewElement) {\r\n            let index = this._firstActiveElement * this._floatCountPerParticleData;\r\n            let timeIndex = index + this._timeIndex;\r\n\r\n            let particleAge = this._currentTime - this._instanceVertex[timeIndex];\r\n            if (particleAge + epsilon < this._instanceVertex[index + this._startLifeTimeIndex]) {\r\n                break;\r\n            }\r\n\r\n            this._instanceVertex[timeIndex] = this._drawCounter;\r\n            this._firstActiveElement++;\r\n            if (this._firstActiveElement >= this._bufferMaxParticles) {\r\n                this._firstActiveElement = 0;\r\n            }\r\n        }\r\n        \r\n        if (this._firstActiveElement != firstActive) {\r\n            let byteStride = this._floatCountPerParticleData * 4;\r\n            if (this._firstActiveElement < this._firstFreeElement) {\r\n                let activeStart = this._firstActiveElement * byteStride;\r\n                this._instanceParticleVertexBuffer.setData(this._instanceVertex.buffer, 0, activeStart, (this._firstFreeElement - this._firstActiveElement) * byteStride);\r\n            }\r\n            else {\r\n                let start = this._firstActiveElement * byteStride;\r\n                let a = this._bufferMaxParticles - this._firstActiveElement;\r\n                this._instanceParticleVertexBuffer.setData(this._instanceVertex.buffer, 0, start, a * byteStride);\r\n\r\n                if (this._firstFreeElement > 0) {\r\n                    this._instanceParticleVertexBuffer.setData(this._instanceVertex.buffer, a * byteStride, 0, this._firstFreeElement * byteStride);\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    protected _freeRetiredParticles(): void {\r\n        while (this._firstRetiredElement != this._firstActiveElement) {\r\n            let age = this._drawCounter - this._instanceVertex[this._firstRetiredElement * this._floatCountPerParticleData + this._timeIndex];\r\n\r\n            //TODObug\r\n            if (false)\r\n                if (age < 3)//GPUCPUBUG\r\n                    break;\r\n            this._firstRetiredElement++;\r\n            if (this._firstRetiredElement >= this._bufferMaxParticles)\r\n                this._firstRetiredElement = 0;\r\n        }\r\n    }\r\n\r\n    addParticle(position: Vector3, direction: Vector3, time: number): boolean {\r\n        Vector3.normalize(direction, direction);\r\n\r\n        //\r\n        let nextFreeParticle = this._firstFreeElement + 1;\r\n        if (nextFreeParticle >= this._bufferMaxParticles) {\r\n            nextFreeParticle = 0;\r\n        }\r\n\r\n        if (nextFreeParticle == this._firstRetiredElement) {\r\n            return false;\r\n        }\r\n\r\n        let transform = this._owner.transform;\r\n        ShurikenParticleData.create(this, this._ownerRender);\r\n\r\n        let particleAge = this._currentTime - time;\r\n\r\n        if (particleAge >= ShurikenParticleData.startLifeTime) {\r\n            return true;\r\n        }\r\n\r\n        let pos: Vector3, rot: Quaternion;\r\n        if (this.simulationSpace == 0) {\r\n            pos = transform.position;\r\n            rot = transform.rotation;\r\n        }\r\n\r\n        //StartSpeed\r\n        let startSpeed = 0;\r\n        switch (this.startSpeedType) {\r\n            case 0:\r\n                startSpeed = this.startSpeedConstant;\r\n                break;\r\n            case 2:\r\n                if (this.autoRandomSeed) {\r\n                    startSpeed = MathUtil.lerp(this.startSpeedConstantMin, this.startSpeedConstantMax, Math.random());\r\n                } else {\r\n                    this._rand.seed = this._randomSeeds[8];\r\n                    startSpeed = MathUtil.lerp(this.startSpeedConstantMin, this.startSpeedConstantMax, this._rand.getFloat());\r\n                    this._randomSeeds[8] = this._rand.seed;\r\n                }\r\n                break;\r\n        }\r\n\r\n        let randomVelocityX: number, randomVelocityY: number, randomVelocityZ: number;\r\n        let needRandomVelocity = this._velocityOverLifetime && this._velocityOverLifetime.enable;\r\n        if (needRandomVelocity) {\r\n            let velocityType = this._velocityOverLifetime.velocity.type;\r\n            if (velocityType == 2 || velocityType == 3) {\r\n                if (this.autoRandomSeed) {\r\n                    randomVelocityX = Math.random();\r\n                    randomVelocityY = Math.random();\r\n                    randomVelocityZ = Math.random();\r\n                }\r\n                else {\r\n                    this._rand.seed = this._randomSeeds[9];\r\n                    randomVelocityX = this._rand.getFloat();\r\n                    randomVelocityY = this._rand.getFloat();\r\n                    randomVelocityZ = this._rand.getFloat();\r\n                    this._randomSeeds[9] = this._rand.seed;\r\n                }\r\n            }\r\n            else {\r\n                needRandomVelocity = false;\r\n            }\r\n        }\r\n        else {\r\n            needRandomVelocity = false;\r\n        }\r\n\r\n        let randomColor: number;\r\n        let needRandomColor = this._colorOverLifetime && this._colorOverLifetime.enable;\r\n        if (needRandomColor) {\r\n            let colorType = this._colorOverLifetime.color.type;\r\n            if (colorType == 3) {\r\n                if (this.autoRandomSeed) {\r\n                    randomColor = Math.random();\r\n                }\r\n                else {\r\n                    this._rand.seed = this._randomSeeds[10];\r\n                    randomColor = this._rand.getFloat();\r\n                    this._randomSeeds[10] = this._rand.seed;\r\n                }\r\n            }\r\n            else {\r\n                needRandomColor = false;\r\n            }\r\n        }\r\n        else {\r\n            needRandomColor = false;\r\n        }\r\n\r\n        let randomSize: number;\r\n        let needRandomSize = this._sizeOverLifetime && this._sizeOverLifetime.enable;\r\n        if (needRandomSize) {\r\n            let sizeType = this._sizeOverLifetime.size.type;\r\n            if (sizeType == 3) {\r\n                if (this.autoRandomSeed) {\r\n                    randomSize = Math.random();\r\n                }\r\n                else {\r\n                    this._rand.seed = this._randomSeeds[11];\r\n                    randomSize = this._rand.getFloat();\r\n                    this.randomSeed[11] = this._rand.seed;\r\n                }\r\n            }\r\n            else {\r\n                needRandomSize = false;\r\n            }\r\n        }\r\n        else {\r\n            needRandomSize = false;\r\n        }\r\n\r\n        let randomRotation: number;\r\n        let needRandomRotation = this._rotationOverLifetime && this._rotationOverLifetime.enable;\r\n        if (needRandomRotation) {\r\n            let rotationType = this._rotationOverLifetime.angularVelocity.type;\r\n            if (rotationType == 2 || rotationType == 3) {\r\n                if (this.autoRandomSeed) {\r\n\r\n                    randomRotation = Math.random();\r\n                }\r\n                else {\r\n                    this._rand.seed = this._randomSeeds[12];\r\n                    randomRotation = this._rand.getFloat();\r\n                    this._randomSeeds[12] = this._rand.seed;\r\n                }\r\n            }\r\n            else {\r\n                needRandomRotation = false;\r\n            }\r\n        }\r\n        else {\r\n            needRandomRotation = false;\r\n        }\r\n\r\n        let randomTextureAnimation: number;\r\n        let needRandomTextureAnimation = this._textureSheetAnimation && this._textureSheetAnimation.enable;\r\n        if (needRandomTextureAnimation) {\r\n            let textureAnimationType = this._textureSheetAnimation.frame.type;\r\n            if (textureAnimationType == 3) {\r\n                if (this.autoRandomSeed) {\r\n                    randomTextureAnimation = Math.random();\r\n                }\r\n                else {\r\n                    this._rand.seed = this._randomSeeds[15];\r\n                    randomTextureAnimation = this._rand.getFloat();\r\n                    this._randomSeeds[15] = this._rand.seed;\r\n                }\r\n            }\r\n            else {\r\n                needRandomTextureAnimation = false;\r\n            }\r\n        }\r\n        else {\r\n            needRandomTextureAnimation = false;\r\n        }\r\n\r\n        // todo uv \r\n        let subU: number = ShurikenParticleData.startUVInfo[0];\r\n        let subV: number = ShurikenParticleData.startUVInfo[1];\r\n        let startU: number = ShurikenParticleData.startUVInfo[2];\r\n        let startV: number = ShurikenParticleData.startUVInfo[3];\r\n\r\n        let render: ShurikenParticleRenderer = this._ownerRender;\r\n        if (render.renderMode == 4) {\r\n\r\n        }\r\n        else {\r\n            // todo, quad  uv ?\r\n        }\r\n\r\n        //  , \r\n        let startIndex = this._firstFreeElement * this._floatCountPerParticleData;\r\n\r\n        let offset = startIndex;\r\n        this._instanceVertex[offset++] = position.x;\r\n        this._instanceVertex[offset++] = position.y;\r\n        this._instanceVertex[offset++] = position.z;\r\n\r\n        this._instanceVertex[offset++] = ShurikenParticleData.startLifeTime;\r\n\r\n        this._instanceVertex[offset++] = direction.x;\r\n        this._instanceVertex[offset++] = direction.y;\r\n        this._instanceVertex[offset++] = direction.z;\r\n        this._instanceVertex[offset++] = time;\r\n\r\n        this._instanceVertex[offset++] = ShurikenParticleData.startColor.x;\r\n        this._instanceVertex[offset++] = ShurikenParticleData.startColor.y;\r\n        this._instanceVertex[offset++] = ShurikenParticleData.startColor.z;\r\n        this._instanceVertex[offset++] = ShurikenParticleData.startColor.w;\r\n\r\n        this._instanceVertex[offset++] = ShurikenParticleData.startSize[0];\r\n        this._instanceVertex[offset++] = ShurikenParticleData.startSize[1];\r\n        this._instanceVertex[offset++] = ShurikenParticleData.startSize[2];\r\n\r\n        this._instanceVertex[offset++] = ShurikenParticleData.startRotation[0];\r\n        this._instanceVertex[offset++] = ShurikenParticleData.startRotation[1];\r\n        this._instanceVertex[offset++] = ShurikenParticleData.startRotation[2];\r\n\r\n        //StartSpeed\r\n        this._instanceVertex[offset++] = startSpeed;\r\n        needRandomColor && (this._instanceVertex[offset + 1] = randomColor);\r\n        needRandomSize && (this._instanceVertex[offset + 2] = randomSize);\r\n        needRandomRotation && (this._instanceVertex[offset + 3] = randomRotation);\r\n        needRandomTextureAnimation && (this._instanceVertex[offset + 4] = randomTextureAnimation);\r\n        if (needRandomVelocity) {\r\n            this._instanceVertex[offset + 5] = randomVelocityX;\r\n            this._instanceVertex[offset + 6] = randomVelocityY;\r\n            this._instanceVertex[offset + 7] = randomVelocityZ;\r\n        }\r\n\r\n        switch (this.simulationSpace) {\r\n            case 0:\r\n                offset += 8;\r\n                this._instanceVertex[offset++] = pos.x;\r\n                this._instanceVertex[offset++] = pos.y;\r\n                this._instanceVertex[offset++] = pos.z;\r\n                this._instanceVertex[offset++] = rot.x;\r\n                this._instanceVertex[offset++] = rot.y;\r\n                this._instanceVertex[offset++] = rot.z;\r\n                this._instanceVertex[offset++] = rot.w;\r\n                break;\r\n            case 1:\r\n                break;\r\n            default:\r\n                throw new Error(\"ShurikenParticleMaterial: SimulationSpace value is invalid.\");\r\n        }\r\n        offset = startIndex + this._simulationUV_Index;\r\n        this._instanceVertex[offset++] = startU;\r\n        this._instanceVertex[offset++] = startV;\r\n        this._instanceVertex[offset++] = subU;\r\n        this._instanceVertex[offset++] = subV;\r\n\r\n        this._firstFreeElement = nextFreeParticle;\r\n        return true;\r\n    }\r\n\r\n    addNewParticlesToVertexBuffer(): void {\r\n        let byteStride = this._floatCountPerParticleData * 4;\r\n        // instance buffer ,   0  buffer\r\n        if (this._firstActiveElement < this._firstFreeElement) {\r\n            let start = this._firstActiveElement * byteStride;\r\n            this._instanceParticleVertexBuffer.setData(this._instanceVertex.buffer, 0, start, (this._firstFreeElement - this._firstActiveElement) * byteStride);\r\n        }\r\n        else {\r\n            let start = this._firstActiveElement * byteStride;\r\n            let a = this._bufferMaxParticles - this._firstActiveElement;\r\n            this._instanceParticleVertexBuffer.setData(this._instanceVertex.buffer, 0, start, a * byteStride);\r\n\r\n            if (this._firstFreeElement > 0) {\r\n                this._instanceParticleVertexBuffer.setData(this._instanceVertex.buffer, a * byteStride, 0, this._firstFreeElement * byteStride);\r\n            }\r\n        }\r\n\r\n        this._firstNewElement = this._firstFreeElement;\r\n    }\r\n\r\n    _updateRenderParams(stage: RenderContext3D) {\r\n        //this._instanceBufferState.bind();\r\n        // instance buffer  0 \r\n        this.clearRenderParams();\r\n        if (this._firstActiveElement < this._firstFreeElement) {\r\n            let indexCount = this._firstFreeElement - this._firstActiveElement;\r\n            this.setDrawElemenParams(this._meshIndexCount,0);\r\n            this.instanceCount = indexCount;\r\n          //  LayaGL.renderDrawConatext.drawElementsInstanced(MeshTopology.Triangles, this._meshIndexCount, IndexFormat.UInt16, 0, indexCount);\r\n          //  Stat.trianglesFaces += this._meshIndexCount / 3 * indexCount;\r\n          //  Stat.renderBatches++;\r\n        }\r\n        else {\r\n            let indexCount = this._bufferMaxParticles - this._firstActiveElement;\r\n            if (this._firstFreeElement > 0) {\r\n                indexCount += this._firstFreeElement;\r\n            }\r\n            this.setDrawElemenParams(this._meshIndexCount,0);\r\n            this.instanceCount = indexCount;\r\n            //LayaGL.renderEngine.getDrawContext().drawElementsInstanced(MeshTopology.Triangles, this._meshIndexCount, IndexFormat.UInt16, 0, indexCount);\r\n            //Stat.trianglesFaces += this._meshIndexCount / 3 * indexCount;\r\n            //Stat.renderBatches++;\r\n        }\r\n    }\r\n\r\n    destroy(): void {\r\n        // todo\r\n        super.destroy();\r\n\r\n        if (this._indexBuffer) {\r\n            this._indexBuffer.destroy();\r\n        }\r\n        if (this._vertexBuffer) {\r\n            this._vertexBuffer.destroy();\r\n        }\r\n        if (this._instanceParticleVertexBuffer) {\r\n            this._instanceParticleVertexBuffer.destroy();\r\n        }\r\n\r\n        this._instanceVertex = null;\r\n        this._meshIndexCount = null;\r\n        this._meshFloatCountPreVertex = null;\r\n    }\r\n}\r\n","import { BoundFrustum } from \"../../math/BoundFrustum\";\r\nimport { Mesh } from \"../../resource/models/Mesh\";\r\nimport { BaseRender } from \"../render/BaseRender\";\r\nimport { RenderContext3D } from \"../render/RenderContext3D\";\r\nimport { Transform3D } from \"../Transform3D\";\r\nimport { ShurikenParticleSystem } from \"./ShurikenParticleSystem\";\r\nimport { ShuriKenParticle3DShaderDeclaration } from \"./ShuriKenParticle3DShaderDeclaration\";\r\nimport { ShurikenParticleInstanceSystem } from \"./ShurikenParticleInstanceSystem\";\r\nimport { RenderElement } from \"../render/RenderElement\";\r\nimport { Sprite3D } from \"../Sprite3D\";\r\nimport { ShurikenParticleMaterial } from \"./ShurikenParticleMaterial\";\r\nimport { Component } from \"../../../components/Component\";\r\nimport { RenderCapable } from \"../../../RenderEngine/RenderEnum/RenderCapable\";\r\nimport { ShaderData, ShaderDataType } from \"../../../RenderEngine/RenderShader/ShaderData\";\r\nimport { Stat } from \"../../../utils/Stat\";\r\nimport { Bounds } from \"../../math/Bounds\";\r\nimport { LayaEnv } from \"../../../../LayaEnv\";\r\nimport { Vector2 } from \"../../../maths/Vector2\";\r\nimport { Vector3 } from \"../../../maths/Vector3\";\r\nimport { LayaGL } from \"../../../layagl/LayaGL\";\r\n\r\n\r\n/**\r\n * <code>ShurikenParticleRender</code> 3D\r\n */\r\nexport class ShurikenParticleRenderer extends BaseRender {\r\n    /***/\r\n    static gravity: Vector3 = new Vector3(0, -9.81, 0);\r\n    /** @internal */\r\n    private _finalGravity: Vector3 = new Vector3();\r\n    private _dragConstant: Vector2 = new Vector2();\r\n\r\n\r\n    /**@internal */\r\n    private _renderMode: number;\r\n    /**@internal */\r\n    private _mesh: Mesh = null;\r\n\r\n    /**@interanl */\r\n    _particleSystem: ShurikenParticleSystem;\r\n    /**,*/\r\n    stretchedBillboardCameraSpeedScale: number = 0;\r\n    /***/\r\n    stretchedBillboardSpeedScale: number = 0;\r\n    /***/\r\n    stretchedBillboardLengthScale: number = 2;\r\n\r\n    get particleSystem(): ShurikenParticleSystem {\r\n        return this._particleSystem;\r\n    }\r\n\r\n    ///***/\r\n    //public var sortingMode:int;\r\n\r\n    /**\r\n     * ,0BILLBOARD1STRETCHEDBILLBOARD2HORIZONTALBILLBOARD3VERTICALBILLBOARD4MESH\r\n     */\r\n    get renderMode(): number {\r\n        return this._renderMode;\r\n    }\r\n\r\n    set renderMode(value: number) {\r\n        if (this._renderMode !== value) {\r\n            var defineDatas: ShaderData = this._shaderValues;\r\n            switch (this._renderMode) {\r\n                case 0:\r\n                    defineDatas.removeDefine(ShuriKenParticle3DShaderDeclaration.SHADERDEFINE_RENDERMODE_BILLBOARD);\r\n                    break;\r\n                case 1:\r\n                    defineDatas.removeDefine(ShuriKenParticle3DShaderDeclaration.SHADERDEFINE_RENDERMODE_STRETCHEDBILLBOARD);\r\n                    break;\r\n                case 2:\r\n                    defineDatas.removeDefine(ShuriKenParticle3DShaderDeclaration.SHADERDEFINE_RENDERMODE_HORIZONTALBILLBOARD);\r\n                    break;\r\n                case 3:\r\n                    defineDatas.removeDefine(ShuriKenParticle3DShaderDeclaration.SHADERDEFINE_RENDERMODE_VERTICALBILLBOARD);\r\n                    break;\r\n                case 4:\r\n                    defineDatas.removeDefine(ShuriKenParticle3DShaderDeclaration.SHADERDEFINE_RENDERMODE_MESH);\r\n                    break;\r\n            }\r\n            this._renderMode = value;\r\n            switch (value) {\r\n                case 0:\r\n                    defineDatas.addDefine(ShuriKenParticle3DShaderDeclaration.SHADERDEFINE_RENDERMODE_BILLBOARD);\r\n                    break;\r\n                case 1:\r\n                    defineDatas.addDefine(ShuriKenParticle3DShaderDeclaration.SHADERDEFINE_RENDERMODE_STRETCHEDBILLBOARD);\r\n                    break;\r\n                case 2:\r\n                    defineDatas.addDefine(ShuriKenParticle3DShaderDeclaration.SHADERDEFINE_RENDERMODE_HORIZONTALBILLBOARD);\r\n                    break;\r\n                case 3:\r\n                    defineDatas.addDefine(ShuriKenParticle3DShaderDeclaration.SHADERDEFINE_RENDERMODE_VERTICALBILLBOARD);\r\n                    break;\r\n                case 4:\r\n                    defineDatas.addDefine(ShuriKenParticle3DShaderDeclaration.SHADERDEFINE_RENDERMODE_MESH);\r\n                    break;\r\n                default:\r\n                    throw new Error(\"ShurikenParticleRender: unknown renderMode Value.\");\r\n            }\r\n            var parSys: ShurikenParticleSystem = this._particleSystem;\r\n            (parSys) && (parSys._initBufferDatas());\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Mesh,rendderMode4\r\n     */\r\n    get mesh(): Mesh {\r\n        return this._mesh;\r\n    }\r\n\r\n    set mesh(value: Mesh) {\r\n        if (this._mesh !== value) {\r\n            (this._mesh) && (this._mesh._removeReference());\r\n            this._mesh = value;\r\n            (value) && (value._addReference());\r\n            this._particleSystem._initBufferDatas();\r\n        }\r\n    }\r\n\r\n    /**\r\n     *  <code>ShurikenParticleRender</code> \r\n     */\r\n    constructor() {\r\n        super();\r\n        this.renderMode = 0;\r\n        this._supportOctree = false;\r\n    }\r\n\r\n    protected _getcommonUniformMap(): Array<string> {\r\n        return [\"Sprite3D\", \"ShurikenSprite3D\"];\r\n    }\r\n\r\n\r\n    protected _onAdded(): void {\r\n        super._onAdded();\r\n        if (!LayaGL.renderEngine.getCapable(RenderCapable.DrawElement_Instance)) {\r\n            this._particleSystem = new ShurikenParticleSystem(this);\r\n        } else\r\n            this._particleSystem = new ShurikenParticleInstanceSystem(this);\r\n\r\n        var elements: RenderElement[] = this._renderElements;\r\n        var element: RenderElement = elements[0] = new RenderElement();\r\n        element.setTransform((this.owner as Sprite3D)._transform);\r\n        element.render = this;\r\n        element.setGeometry(this._particleSystem);\r\n\r\n        this.sharedMaterial = this.sharedMaterial;\r\n    }\r\n\r\n    protected _onEnable(): void {\r\n        super._onEnable();\r\n\r\n        Stat.particleRenderNode++;\r\n        (this._particleSystem.playOnAwake && LayaEnv.isPlaying) && (this._particleSystem.play());\r\n    }\r\n\r\n    protected _onDisable(): void {\r\n        super._onDisable();\r\n\r\n        Stat.particleRenderNode--;\r\n        (this._particleSystem.isAlive) && (this._particleSystem.simulate(0, true));\r\n    }\r\n\r\n    /**\r\n     * @inheritDoc\r\n     * @internal\r\n     * @override\r\n     */\r\n    protected _calculateBoundingBox(): void {\r\n        var particleSystem: ShurikenParticleSystem = this._particleSystem;\r\n        var bounds: Bounds;\r\n        if (particleSystem._useCustomBounds) {\r\n            bounds = particleSystem.customBounds;\r\n            bounds._tranform((this.owner as Sprite3D).transform.worldMatrix, this._bounds);\r\n        }\r\n        else if (particleSystem._simulationSupported()) {\r\n            // todo need update Bounds\r\n            particleSystem._generateBounds();\r\n            bounds = particleSystem._bounds;\r\n            bounds._tranform((this.owner as Sprite3D).transform.worldMatrix, this._bounds);\r\n            // \r\n            if (particleSystem.gravityModifier != 0) {\r\n                var max: Vector3 = this._bounds.getMax();\r\n                var min: Vector3 = this._bounds.getMin();\r\n                var gravityOffset: Vector2 = particleSystem._gravityOffset;\r\n                max.y -= gravityOffset.x;\r\n                min.y -= gravityOffset.y;\r\n                this._bounds.setMax(max);\r\n                this._bounds.setMin(min);\r\n            }\r\n        }\r\n        else {\r\n            var min: Vector3 = this._bounds.getMin();\r\n            min.setValue(-Number.MAX_VALUE, -Number.MAX_VALUE, -Number.MAX_VALUE);\r\n            this._bounds.setMin(min);\r\n            var max: Vector3 = this._bounds.getMax();\r\n            max.setValue(Number.MAX_VALUE, Number.MAX_VALUE, Number.MAX_VALUE);\r\n            this._bounds.setMax(max);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * @inheritDoc\r\n     * @internal\r\n     * @override\r\n     */\r\n    _needRender(boundFrustum: BoundFrustum, context: RenderContext3D): boolean {\r\n        if (!Stat.enableParticle)\r\n            return false;\r\n        if (boundFrustum) {\r\n            if (boundFrustum.intersects(this.bounds)) {\r\n                if (this._particleSystem.isAlive)\r\n                    return true;\r\n                else\r\n                    return false;\r\n            } else {\r\n                return false;\r\n            }\r\n        } else {\r\n            return true;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * @inheritDoc\r\n     * @internal\r\n     * @override\r\n     */\r\n    _renderUpdate(context: RenderContext3D, transfrom: Transform3D): void {\r\n        var particleSystem: ShurikenParticleSystem = this._particleSystem;\r\n        var sv: ShaderData = this._shaderValues;\r\n        var transform: Transform3D = (this.owner as Sprite3D).transform;\r\n        switch (particleSystem.simulationSpace) {\r\n            case 0: //World\r\n                break;\r\n            case 1: //Local\r\n                sv.setVector3(ShuriKenParticle3DShaderDeclaration.WORLDPOSITION, transform.position);\r\n                sv.setShaderData(ShuriKenParticle3DShaderDeclaration.WORLDROTATION, ShaderDataType.Vector4, transform.rotation);\r\n                break;\r\n            default:\r\n                throw new Error(\"ShurikenParticleMaterial: SimulationSpace value is invalid.\");\r\n        }\r\n\r\n        switch (particleSystem.scaleMode) {\r\n            case 0:\r\n                var scale: Vector3 = transform.getWorldLossyScale();\r\n                sv.setVector3(ShuriKenParticle3DShaderDeclaration.POSITIONSCALE, scale);\r\n                sv.setVector3(ShuriKenParticle3DShaderDeclaration.SIZESCALE, scale);\r\n                break;\r\n            case 1:\r\n                var localScale: Vector3 = transform.localScale;\r\n                sv.setVector3(ShuriKenParticle3DShaderDeclaration.POSITIONSCALE, localScale);\r\n                sv.setVector3(ShuriKenParticle3DShaderDeclaration.SIZESCALE, localScale);\r\n                break;\r\n            case 2:\r\n                sv.setVector3(ShuriKenParticle3DShaderDeclaration.POSITIONSCALE, transform.getWorldLossyScale());\r\n                sv.setVector3(ShuriKenParticle3DShaderDeclaration.SIZESCALE, Vector3.ONE);\r\n                break;\r\n        }\r\n\r\n        switch (particleSystem.dragType) {\r\n            case 0:\r\n                this._dragConstant.setValue(particleSystem.dragSpeedConstantMin, particleSystem.dragSpeedConstantMin);\r\n                sv.setVector2(ShuriKenParticle3DShaderDeclaration.DRAG, this._dragConstant);\r\n                break;\r\n            case 2:\r\n                this._dragConstant.setValue(particleSystem.dragSpeedConstantMin, particleSystem.dragSpeedConstantMax);\r\n                sv.setVector2(ShuriKenParticle3DShaderDeclaration.DRAG, this._dragConstant);\r\n                break;\r\n            default:\r\n                this._dragConstant.setValue(0, 0);\r\n                break;\r\n        }\r\n\r\n        Vector3.scale(ShurikenParticleRenderer.gravity, particleSystem.gravityModifier, this._finalGravity);\r\n        sv.setVector3(ShuriKenParticle3DShaderDeclaration.GRAVITY, this._finalGravity);\r\n        sv.setInt(ShuriKenParticle3DShaderDeclaration.SIMULATIONSPACE, particleSystem.simulationSpace);\r\n        sv.setBool(ShuriKenParticle3DShaderDeclaration.THREEDSTARTROTATION, particleSystem.threeDStartRotation);\r\n        sv.setInt(ShuriKenParticle3DShaderDeclaration.SCALINGMODE, particleSystem.scaleMode);\r\n        sv.setNumber(ShuriKenParticle3DShaderDeclaration.STRETCHEDBILLBOARDLENGTHSCALE, this.stretchedBillboardLengthScale);\r\n        sv.setNumber(ShuriKenParticle3DShaderDeclaration.STRETCHEDBILLBOARDSPEEDSCALE, this.stretchedBillboardSpeedScale);\r\n        sv.setNumber(ShuriKenParticle3DShaderDeclaration.CURRENTTIME, particleSystem._currentTime);\r\n    }\r\n\r\n    /**\r\n     * @inheritDoc\r\n     * @override\r\n     */\r\n    get bounds(): Bounds {\r\n        if (this.boundsChange) {\r\n            this._calculateBoundingBox();\r\n            this.boundsChange = false;\r\n        }\r\n        return this._bounds;\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     * @override\r\n     */\r\n    _cloneTo(dest: Component): void {\r\n        let parRender = dest as ShurikenParticleRenderer;\r\n        this._particleSystem.cloneTo(parRender._particleSystem);\r\n        parRender.sharedMaterial = this.sharedMaterial;\r\n        parRender.renderMode = this.renderMode;\r\n        parRender.mesh = this.mesh;\r\n        parRender.stretchedBillboardCameraSpeedScale = this.stretchedBillboardCameraSpeedScale;\r\n        parRender.stretchedBillboardSpeedScale = this.stretchedBillboardSpeedScale;\r\n        parRender.stretchedBillboardLengthScale = this.stretchedBillboardLengthScale;\r\n        parRender.sortingFudge = this.sortingFudge;\r\n    }\r\n\r\n    protected _onDestroy() {\r\n        (this._mesh) && (this._mesh._removeReference(), this._mesh = null);\r\n        this._particleSystem.destroy();\r\n        this._particleSystem = null;\r\n        super._onDestroy();\r\n    }\r\n\r\n}\r\n\r\n\r\n","import { Node } from \"../../../display/Node\";\r\nimport { Color } from \"../../../maths/Color\";\r\nimport { Vector2 } from \"../../../maths/Vector2\";\r\nimport { Vector3 } from \"../../../maths/Vector3\";\r\nimport { Vector4 } from \"../../../maths/Vector4\";\r\nimport { Loader } from \"../../../net/Loader\";\r\nimport { Texture } from \"../../../resource/Texture\";\r\nimport { Gradient } from \"../Gradient\";\r\nimport { RenderableSprite3D } from \"../RenderableSprite3D\";\r\nimport { Sprite3D } from \"../Sprite3D\";\r\nimport { Burst } from \"./module/Burst\";\r\nimport { ColorOverLifetime } from \"./module/ColorOverLifetime\";\r\nimport { Emission } from \"./module/Emission\";\r\nimport { FrameOverTime } from \"./module/FrameOverTime\";\r\nimport { GradientAngularVelocity } from \"./module/GradientAngularVelocity\";\r\nimport { GradientColor } from \"./module/GradientColor\";\r\nimport { GradientDataInt } from \"./module/GradientDataInt\";\r\nimport { GradientDataNumber } from \"./module/GradientDataNumber\";\r\nimport { GradientSize } from \"./module/GradientSize\";\r\nimport { GradientVelocity } from \"./module/GradientVelocity\";\r\nimport { RotationOverLifetime } from \"./module/RotationOverLifetime\";\r\nimport { BaseShape } from \"./module/shape/BaseShape\";\r\nimport { BoxShape } from \"./module/shape/BoxShape\";\r\nimport { CircleShape } from \"./module/shape/CircleShape\";\r\nimport { ConeShape } from \"./module/shape/ConeShape\";\r\nimport { HemisphereShape } from \"./module/shape/HemisphereShape\";\r\nimport { SphereShape } from \"./module/shape/SphereShape\";\r\nimport { SizeOverLifetime } from \"./module/SizeOverLifetime\";\r\nimport { StartFrame } from \"./module/StartFrame\";\r\nimport { TextureSheetAnimation } from \"./module/TextureSheetAnimation\";\r\nimport { VelocityOverLifetime } from \"./module/VelocityOverLifetime\";\r\nimport { ShurikenParticleMaterial } from \"./ShurikenParticleMaterial\";\r\nimport { ShurikenParticleRenderer } from \"./ShurikenParticleRenderer\";\r\nimport { ShurikenParticleSystem } from \"./ShurikenParticleSystem\";\r\n\r\n/**\r\n * <code>ShuriKenParticle3D</code> 3D\r\n */\r\nexport class ShuriKenParticle3D extends RenderableSprite3D {\r\n\r\n\t/** @internal */\r\n\tprivate _particleSystem: ShurikenParticleSystem;\r\n\r\n\t/**\r\n\t * \r\n\t */\r\n\tget particleSystem(): ShurikenParticleSystem {\r\n\t\treturn this._particleSystem;\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t */\r\n\tget particleRenderer(): ShurikenParticleRenderer {\r\n\t\treturn <ShurikenParticleRenderer>this._render;\r\n\t}\r\n\r\n\t/**\r\n\t *  <code>Particle3D</code> \r\n\t */\r\n\tconstructor() {\r\n\t\tsuper(null);\r\n\t\tthis._render = this.addComponent(ShurikenParticleRenderer) as ShurikenParticleRenderer;\r\n\t\tthis._particleSystem = (this._render as ShurikenParticleRenderer)._particleSystem;\r\n\t}\r\n\r\n\t/**\r\n\t * @internal\r\n\t */\r\n\t_parseModule(module: any, moduleData: any): void {\r\n\t\tfor (var t in moduleData) {\r\n\t\t\tswitch (t) {\r\n\t\t\t\tcase \"bases\":\r\n\t\t\t\t\tvar bases = moduleData.bases;\r\n\t\t\t\t\tfor (var k in bases)\r\n\t\t\t\t\t\tmodule[k] = bases[k];\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase \"vector2s\":\r\n\t\t\t\t\tvar vector2s = moduleData.vector2s;\r\n\t\t\t\t\tfor (var k in vector2s) {\r\n\t\t\t\t\t\tvar vec2: Vector2 = module[k];\r\n\t\t\t\t\t\tvar vec2Data: number[] = vector2s[k];\r\n\t\t\t\t\t\tvec2.setValue(vec2Data[0], vec2Data[1]);\r\n\t\t\t\t\t\tmodule[k] = vec2;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase \"vector3s\":\r\n\t\t\t\t\tvar vector3s = moduleData.vector3s;\r\n\t\t\t\t\tfor (var k in vector3s) {\r\n\t\t\t\t\t\tvar vec3: Vector3 = module[k];\r\n\t\t\t\t\t\tvar vec3Data: number[] = vector3s[k];\r\n\t\t\t\t\t\tvec3.setValue(vec3Data[0], vec3Data[1], vec3Data[2]);\r\n\t\t\t\t\t\tmodule[k] = vec3;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase \"vector4s\":\r\n\t\t\t\t\tvar vector4s = moduleData.vector4s;\r\n\t\t\t\t\tfor (var k in vector4s) {\r\n\t\t\t\t\t\tvar vec4: Vector4 = module[k];\r\n\t\t\t\t\t\tvar vec4Data: number[] = vector4s[k];\r\n\t\t\t\t\t\tvec4.setValue(vec4Data[0], vec4Data[1], vec4Data[2], vec4Data[3]);\r\n\t\t\t\t\t\tmodule[k] = vec4;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase \"gradientDataNumbers\":\r\n\t\t\t\t\tvar gradientDataNumbers: object = moduleData.gradientDataNumbers;\r\n\t\t\t\t\tfor (var k in gradientDataNumbers) {\r\n\t\t\t\t\t\tvar gradientNumber: GradientDataNumber = module[k];\r\n\t\t\t\t\t\tvar gradientNumberData: any[] = moduleData[k];\r\n\t\t\t\t\t\tfor (var i: number = 0, n: number = gradientNumberData.length; i < n; i++) {\r\n\t\t\t\t\t\t\tvar valueData: any = gradientNumberData[i];\r\n\t\t\t\t\t\t\tgradientNumber.add(valueData.key, valueData.value);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tmodule[k] = gradientNumber;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase \"resources\":\r\n\t\t\t\t\tvar resources: any = moduleData.resources;\r\n\t\t\t\t\tfor (var k in resources) {\r\n\t\t\t\t\t\tlet res = Loader.getRes(resources[k]);\r\n\t\t\t\t\t\tif (res && (res instanceof Texture)) {\r\n\t\t\t\t\t\t\tres = res.bitmap;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tmodule[k] = res;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase \"bursts\":\r\n\t\t\t\t\tvar burstsData: any[] = moduleData.bursts;\r\n\t\t\t\t\tfor (var i: number = 0, n: number = burstsData.length; i < n; i++) {\r\n\t\t\t\t\t\tvar brust: any = burstsData[i];\r\n\t\t\t\t\t\tmodule.addBurst(new Burst(brust.time, brust.min, brust.max));\r\n\t\t\t\t\t}\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase \"randomSeed\":\r\n\t\t\t\t\tmodule.randomSeed[0] = moduleData.randomSeed;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase \"shapeType\"://TODO:remove in the fulther\r\n\t\t\t\tcase \"type\":\r\n\t\t\t\tcase \"color\":\r\n\t\t\t\tcase \"size\":\r\n\t\t\t\tcase \"frame\":\r\n\t\t\t\tcase \"startFrame\":\r\n\t\t\t\tcase \"angularVelocity\":\r\n\t\t\t\tcase \"velocity\":\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tdefault:\r\n\t\t\t\t\tthrow \"ShurikenParticle3D:unknown type.\";\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t * @override\r\n\t * @internal\r\n\t */\r\n\t_parse(data: any, spriteMap: any): void {\r\n\t\tsuper._parse(data, spriteMap);\r\n\t\tif (data.main) {\r\n\t\t\tvar particleSystem: ShurikenParticleSystem = this.particleSystem;\r\n\t\t\tvar particleRender: ShurikenParticleRenderer = this.particleRenderer;\r\n\t\t\tthis._parseModule(particleRender, data.renderer);//Renderer\r\n\t\t\tthis._parseModule(particleSystem, data.main);//particleSystem\r\n\t\t\tthis._parseModule(particleSystem.emission, data.emission);//Emission\r\n\r\n\t\t\t//Shape\r\n\t\t\tvar shapeData: any = data.shape;\r\n\t\t\tif (shapeData) {\r\n\t\t\t\tvar shape: BaseShape;\r\n\t\t\t\tswitch (shapeData.shapeType) {\r\n\t\t\t\t\tcase 0:\r\n\t\t\t\t\t\tshape = new SphereShape();\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase 1:\r\n\t\t\t\t\t\tshape = new HemisphereShape();\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase 2:\r\n\t\t\t\t\t\tshape = new ConeShape();\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase 3:\r\n\t\t\t\t\t\tshape = new BoxShape();\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase 7:\r\n\t\t\t\t\t\tshape = new CircleShape();\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tdefault:\r\n\t\t\t\t\t\tthrow \"ShuriKenParticle3D:unknown shape type.\";\r\n\t\t\t\t}\r\n\t\t\t\tthis._parseModule(shape, shapeData);\r\n\t\t\t\tparticleSystem.shape = shape;\r\n\t\t\t}\r\n\r\n\t\t\t//VelocityOverLifetime\r\n\t\t\tvar velocityOverLifetimeData: any = data.velocityOverLifetime;\r\n\t\t\tif (velocityOverLifetimeData) {\r\n\t\t\t\tvar velocityData: any = velocityOverLifetimeData.velocity;\r\n\t\t\t\tvar velocity: GradientVelocity;\r\n\t\t\t\tswitch (velocityData.type) {\r\n\t\t\t\t\tcase 0:\r\n\t\t\t\t\t\tvar constantData: any[] = velocityData.constant;\r\n\t\t\t\t\t\tvelocity = GradientVelocity.createByConstant(constantData ? new Vector3(constantData[0], constantData[1], constantData[2]) : new Vector3(0, 0, 0));\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase 1:\r\n\t\t\t\t\t\tvelocity = GradientVelocity.createByGradient(this._initParticleVelocity(velocityData.gradientX), this._initParticleVelocity(velocityData.gradientY), this._initParticleVelocity(velocityData.gradientZ));\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase 2:\r\n\t\t\t\t\t\tvar constantMinData: any[] = velocityData.constantMin;\r\n\t\t\t\t\t\tvar constantMaxData: any[] = velocityData.constantMax;\r\n\t\t\t\t\t\tvelocity = GradientVelocity.createByRandomTwoConstant(constantMinData ? new Vector3(constantMinData[0], constantMinData[1], constantMinData[2]) : new Vector3(0, 0, 0), constantMaxData ? new Vector3(constantMaxData[0], constantMaxData[1], constantMaxData[2]) : new Vector3(0, 0, 0));\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase 3:\r\n\t\t\t\t\t\tvelocity = GradientVelocity.createByRandomTwoGradient(this._initParticleVelocity(velocityData.gradientXMin), this._initParticleVelocity(velocityData.gradientXMax), this._initParticleVelocity(velocityData.gradientYMin), this._initParticleVelocity(velocityData.gradientYMax), this._initParticleVelocity(velocityData.gradientZMin), this._initParticleVelocity(velocityData.gradientZMax));\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t\tvar velocityOverLifetime: VelocityOverLifetime = new VelocityOverLifetime(velocity);\r\n\t\t\t\tthis._parseModule(velocityOverLifetime, velocityOverLifetimeData);\r\n\t\t\t\tparticleSystem.velocityOverLifetime = velocityOverLifetime;\r\n\t\t\t}\r\n\r\n\t\t\t//ColorOverLifetime\r\n\t\t\tvar colorOverLifetimeData: any = data.colorOverLifetime;\r\n\r\n\t\t\tif (colorOverLifetimeData) {\r\n\t\t\t\tvar colorData: any = colorOverLifetimeData.color;\r\n\t\t\t\tlet maxKeyCount = colorData.maxKeyCount;\r\n\t\t\t\tvar color: GradientColor;\r\n\t\t\t\tswitch (colorData.type) {\r\n\t\t\t\t\tcase 0:\r\n\t\t\t\t\t\tvar constColorData: any[] = colorData.constant;\r\n\t\t\t\t\t\tcolor = GradientColor.createByConstant(constColorData ? new Vector4(constColorData[0], constColorData[1], constColorData[2], constColorData[3]) : new Vector4(0, 0, 0, 0));\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase 1:\r\n\t\t\t\t\t\tcolor = GradientColor.createByGradient(this._initParticleColor(colorData.gradient, maxKeyCount));\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase 2:\r\n\t\t\t\t\t\tvar minConstColorData: any[] = colorData.constantMin;\r\n\t\t\t\t\t\tvar maxConstColorData: any[] = colorData.constantMax;\r\n\t\t\t\t\t\tcolor = GradientColor.createByRandomTwoConstant(minConstColorData ? new Vector4(minConstColorData[0], minConstColorData[1], minConstColorData[2], minConstColorData[3]) : new Vector4(0, 0, 0, 0), minConstColorData ? new Vector4(maxConstColorData[0], maxConstColorData[1], maxConstColorData[2], maxConstColorData[3]) : new Vector4(0, 0, 0, 0));\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase 3:\r\n\t\t\t\t\t\tcolor = GradientColor.createByRandomTwoGradient(this._initParticleColor(colorData.gradientMin, maxKeyCount), this._initParticleColor(colorData.gradientMax, maxKeyCount));\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t\tvar colorOverLifetime: ColorOverLifetime = new ColorOverLifetime(color);\r\n\t\t\t\tthis._parseModule(colorOverLifetime, colorOverLifetimeData);\r\n\t\t\t\tparticleSystem.colorOverLifetime = colorOverLifetime;\r\n\t\t\t}\r\n\r\n\t\t\t//SizeOverLifetime\r\n\t\t\tvar sizeOverLifetimeData: any = data.sizeOverLifetime;\r\n\t\t\tif (sizeOverLifetimeData) {\r\n\t\t\t\tvar sizeData: any = sizeOverLifetimeData.size;\r\n\t\t\t\tvar size: GradientSize;\r\n\t\t\t\tswitch (sizeData.type) {\r\n\t\t\t\t\tcase 0:\r\n\t\t\t\t\t\tif (sizeData.separateAxes) {\r\n\t\t\t\t\t\t\tsize = GradientSize.createByGradientSeparate(this._initParticleSize(sizeData.gradientX), this._initParticleSize(sizeData.gradientY), this._initParticleSize(sizeData.gradientZ));\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tsize = GradientSize.createByGradient(this._initParticleSize(sizeData.gradient));\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase 1:\r\n\t\t\t\t\t\tif (sizeData.separateAxes) {\r\n\t\t\t\t\t\t\tvar constantMinSeparateData: any[] = sizeData.constantMinSeparate;\r\n\t\t\t\t\t\t\tvar constantMaxSeparateData: any[] = sizeData.constantMaxSeparate;\r\n\t\t\t\t\t\t\tsize = GradientSize.createByRandomTwoConstantSeparate(constantMinSeparateData ? new Vector3(constantMinSeparateData[0], constantMinSeparateData[1], constantMinSeparateData[2]) : new Vector3(0, 0, 0), constantMaxSeparateData ? new Vector3(constantMaxSeparateData[0], constantMaxSeparateData[1], constantMaxSeparateData[2]) : new Vector3(0, 0, 0));\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tsize = GradientSize.createByRandomTwoConstant(sizeData.constantMin || 0, sizeData.constantMax || 0);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase 2:\r\n\t\t\t\t\t\tif (sizeData.separateAxes) {\r\n\t\t\t\t\t\t\tsize = GradientSize.createByRandomTwoGradientSeparate(this._initParticleSize(sizeData.gradientXMin), this._initParticleSize(sizeData.gradientYMin), this._initParticleSize(sizeData.gradientZMin), this._initParticleSize(sizeData.gradientXMax), this._initParticleSize(sizeData.gradientYMax), this._initParticleSize(sizeData.gradientZMax));\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tsize = GradientSize.createByRandomTwoGradient(this._initParticleSize(sizeData.gradientMin), this._initParticleSize(sizeData.gradientMax));\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t\tvar sizeOverLifetime: SizeOverLifetime = new SizeOverLifetime(size);\r\n\t\t\t\tthis._parseModule(sizeOverLifetime, sizeOverLifetimeData);\r\n\t\t\t\tparticleSystem.sizeOverLifetime = sizeOverLifetime;\r\n\t\t\t}\r\n\r\n\t\t\t//RotationOverLifetime\r\n\t\t\tvar rotationOverLifetimeData: any = data.rotationOverLifetime;\r\n\t\t\tif (rotationOverLifetimeData) {\r\n\t\t\t\tvar angularVelocityData: any = rotationOverLifetimeData.angularVelocity;\r\n\t\t\t\tvar angularVelocity: GradientAngularVelocity;\r\n\t\t\t\tswitch (angularVelocityData.type) {\r\n\t\t\t\t\tcase 0:\r\n\t\t\t\t\t\tif (angularVelocityData.separateAxes) {\r\n\t\t\t\t\t\t\tvar conSep: any[] = angularVelocityData.constantSeparate;\r\n\t\t\t\t\t\t\tangularVelocity = GradientAngularVelocity.createByConstantSeparate(conSep ? new Vector3(conSep[0], conSep[1], conSep[2]) : new Vector3(0, 0, Math.PI / 4));\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tangularVelocity = GradientAngularVelocity.createByConstant(angularVelocityData.constant || Math.PI / 4);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase 1:\r\n\t\t\t\t\t\tif (angularVelocityData.separateAxes) {\r\n\t\t\t\t\t\t\tangularVelocity = GradientAngularVelocity.createByGradientSeparate(this._initParticleRotation(angularVelocityData.gradientX), this._initParticleRotation(angularVelocityData.gradientY), this._initParticleRotation(angularVelocityData.gradientZ));\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tangularVelocity = GradientAngularVelocity.createByGradient(this._initParticleRotation(angularVelocityData.gradient));\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase 2:\r\n\t\t\t\t\t\tif (angularVelocityData.separateAxes) {\r\n\t\t\t\t\t\t\tvar minSep: any[] = angularVelocityData.constantMinSeparate;//TODO:Y\r\n\t\t\t\t\t\t\tvar maxSep: any[] = angularVelocityData.constantMaxSeparate;//TODO:Y\r\n\t\t\t\t\t\t\tangularVelocity = GradientAngularVelocity.createByRandomTwoConstantSeparate(minSep ? new Vector3(minSep[0], minSep[1], minSep[2]) : new Vector3(0, 0, 0), maxSep ? new Vector3(maxSep[0], maxSep[1], maxSep[2]) : new Vector3(0, 0, Math.PI / 4));\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tangularVelocity = GradientAngularVelocity.createByRandomTwoConstant(angularVelocityData.constantMin || 0, angularVelocityData.constantMax || Math.PI / 4);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase 3:\r\n\t\t\t\t\t\tif (angularVelocityData.separateAxes) {\r\n\t\t\t\t\t\t\t//TODO:\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tangularVelocity = GradientAngularVelocity.createByRandomTwoGradient(this._initParticleRotation(angularVelocityData.gradientMin), this._initParticleRotation(angularVelocityData.gradientMax));\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t\tvar rotationOverLifetime: RotationOverLifetime = new RotationOverLifetime(angularVelocity);\r\n\t\t\t\tthis._parseModule(rotationOverLifetime, rotationOverLifetimeData);\r\n\t\t\t\tparticleSystem.rotationOverLifetime = rotationOverLifetime;\r\n\t\t\t}\r\n\r\n\t\t\t//TextureSheetAnimation\r\n\t\t\tvar textureSheetAnimationData: any = data.textureSheetAnimation;\r\n\t\t\tif (textureSheetAnimationData) {\r\n\t\t\t\tvar frameData: any = textureSheetAnimationData.frame;\r\n\t\t\t\tvar frameOverTime: FrameOverTime;\r\n\t\t\t\tswitch (frameData.type) {\r\n\t\t\t\t\tcase 0:\r\n\t\t\t\t\t\tframeOverTime = FrameOverTime.createByConstant(frameData.constant);\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase 1:\r\n\t\t\t\t\t\tframeOverTime = FrameOverTime.createByOverTime(this._initParticleFrame(frameData.overTime));\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase 2:\r\n\t\t\t\t\t\tframeOverTime = FrameOverTime.createByRandomTwoConstant(frameData.constantMin, frameData.constantMax);\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase 3:\r\n\t\t\t\t\t\tframeOverTime = FrameOverTime.createByRandomTwoOverTime(this._initParticleFrame(frameData.overTimeMin), this._initParticleFrame(frameData.overTimeMax));\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t\tvar startFrameData: any = textureSheetAnimationData.startFrame;\r\n\t\t\t\tvar startFrame: StartFrame;\r\n\t\t\t\tswitch (startFrameData.type) {\r\n\t\t\t\t\tcase 0:\r\n\t\t\t\t\t\tstartFrame = StartFrame.createByConstant(startFrameData.constant);\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase 1:\r\n\t\t\t\t\t\tstartFrame = StartFrame.createByRandomTwoConstant(startFrameData.constantMin, startFrameData.constantMax);\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t\tvar textureSheetAnimation: TextureSheetAnimation = new TextureSheetAnimation(frameOverTime, startFrame);\r\n\t\t\t\tthis._parseModule(textureSheetAnimation, textureSheetAnimationData);\r\n\t\t\t\tparticleSystem.textureSheetAnimation = textureSheetAnimation;\r\n\t\t\t}\r\n\t\t}\r\n\t\telse {//legacy\r\n\t\t\tthis._parseOld(data);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * <p></p>\r\n\t * @param\tdestroyChild true,\r\n\t * @override\r\n\t */\r\n\tdestroy(destroyChild: boolean = true): void {\r\n\t\tif (this._destroyed)\r\n\t\t\treturn;\r\n\t\tsuper.destroy(destroyChild);\r\n\t}\r\n\r\n\t/**\r\n\t * @internal\r\n\t */\r\n\tprotected _create(): Node {\r\n\t\treturn new Sprite3D();\r\n\t}\r\n\r\n\r\n\t/**\r\n\t * @deprecated\r\n\t * @internal\r\n\t */\r\n\tprivate _parseOld(data: any): void {\r\n\t\tconst anglelToRad: number = Math.PI / 180.0;\r\n\t\tvar i: number, n: number;\r\n\r\n\t\t//Render\r\n\t\tvar particleRender: ShurikenParticleRenderer = this.particleRenderer;\r\n\t\tvar material: ShurikenParticleMaterial;\r\n\r\n\t\tvar materialData: any = data.material;\r\n\t\t(materialData) && (material = Loader.getRes(materialData.path));\r\n\r\n\t\tparticleRender.sharedMaterial = material;\r\n\t\tvar meshPath: string = data.meshPath;\r\n\t\t(meshPath) && (particleRender.mesh = Loader.getRes(meshPath));\r\n\r\n\t\tparticleRender.renderMode = data.renderMode;\r\n\t\tparticleRender.stretchedBillboardCameraSpeedScale = data.stretchedBillboardCameraSpeedScale;\r\n\t\tparticleRender.stretchedBillboardSpeedScale = data.stretchedBillboardSpeedScale;\r\n\t\tparticleRender.stretchedBillboardLengthScale = data.stretchedBillboardLengthScale;\r\n\t\tparticleRender.sortingFudge = data.sortingFudge ? data.sortingFudge : 0.0;\r\n\r\n\t\t//particleSystem\r\n\t\tvar particleSystem: ShurikenParticleSystem = this.particleSystem;\r\n\t\tparticleSystem.isPerformanceMode = data.isPerformanceMode;\r\n\r\n\t\tparticleSystem.duration = data.duration;\r\n\t\tparticleSystem.looping = data.looping;\r\n\t\tparticleSystem.prewarm = data.prewarm;\r\n\r\n\t\tparticleSystem.startDelayType = data.startDelayType;\r\n\t\tparticleSystem.startDelay = data.startDelay;\r\n\t\tparticleSystem.startDelayMin = data.startDelayMin;\r\n\t\tparticleSystem.startDelayMax = data.startDelayMax;\r\n\r\n\t\tparticleSystem.startLifetimeType = data.startLifetimeType;\r\n\t\tparticleSystem.startLifetimeConstant = data.startLifetimeConstant;\r\n\t\tparticleSystem.startLifeTimeGradient = ShuriKenParticle3D._initStartLife(data.startLifetimeGradient);\r\n\t\tparticleSystem.startLifetimeConstantMin = data.startLifetimeConstantMin;\r\n\t\tparticleSystem.startLifetimeConstantMax = data.startLifetimeConstantMax;\r\n\t\tparticleSystem.startLifeTimeGradientMin = ShuriKenParticle3D._initStartLife(data.startLifetimeGradientMin);\r\n\t\tparticleSystem.startLifeTimeGradientMax = ShuriKenParticle3D._initStartLife(data.startLifetimeGradientMax);\r\n\r\n\t\tparticleSystem.startSpeedType = data.startSpeedType;\r\n\t\tparticleSystem.startSpeedConstant = data.startSpeedConstant;\r\n\t\tparticleSystem.startSpeedConstantMin = data.startSpeedConstantMin;\r\n\t\tparticleSystem.startSpeedConstantMax = data.startSpeedConstantMax;\r\n\r\n\t\t//parse Drag TODO:\r\n\r\n\t\tparticleSystem.threeDStartSize = data.threeDStartSize;\r\n\t\tparticleSystem.startSizeType = data.startSizeType;\r\n\t\tparticleSystem.startSizeConstant = data.startSizeConstant;\r\n\t\tvar startSizeConstantSeparateArray: any[] = data.startSizeConstantSeparate;\r\n\t\tvar startSizeConstantSeparateElement: Vector3 = particleSystem.startSizeConstantSeparate;\r\n\t\tstartSizeConstantSeparateElement.x = startSizeConstantSeparateArray[0];\r\n\t\tstartSizeConstantSeparateElement.y = startSizeConstantSeparateArray[1];\r\n\t\tstartSizeConstantSeparateElement.z = startSizeConstantSeparateArray[2];\r\n\t\tparticleSystem.startSizeConstantMin = data.startSizeConstantMin;\r\n\t\tparticleSystem.startSizeConstantMax = data.startSizeConstantMax;\r\n\t\tvar startSizeConstantMinSeparateArray: any[] = data.startSizeConstantMinSeparate;\r\n\t\tvar startSizeConstantMinSeparateElement: Vector3 = particleSystem.startSizeConstantMinSeparate;\r\n\t\tstartSizeConstantMinSeparateElement.x = startSizeConstantMinSeparateArray[0];\r\n\t\tstartSizeConstantMinSeparateElement.y = startSizeConstantMinSeparateArray[1];\r\n\t\tstartSizeConstantMinSeparateElement.z = startSizeConstantMinSeparateArray[2];\r\n\t\tvar startSizeConstantMaxSeparateArray: any[] = data.startSizeConstantMaxSeparate;\r\n\t\tvar startSizeConstantMaxSeparateElement: Vector3 = particleSystem.startSizeConstantMaxSeparate;\r\n\t\tstartSizeConstantMaxSeparateElement.x = startSizeConstantMaxSeparateArray[0];\r\n\t\tstartSizeConstantMaxSeparateElement.y = startSizeConstantMaxSeparateArray[1];\r\n\t\tstartSizeConstantMaxSeparateElement.z = startSizeConstantMaxSeparateArray[2];\r\n\r\n\t\tparticleSystem.threeDStartRotation = data.threeDStartRotation;\r\n\t\tparticleSystem.startRotationType = data.startRotationType;\r\n\t\tparticleSystem.startRotationConstant = data.startRotationConstant * anglelToRad;\r\n\t\tvar startRotationConstantSeparateArray: any[] = data.startRotationConstantSeparate;\r\n\t\tvar startRotationConstantSeparateElement: Vector3 = particleSystem.startRotationConstantSeparate;\r\n\t\tstartRotationConstantSeparateElement.x = startRotationConstantSeparateArray[0] * anglelToRad;\r\n\t\tstartRotationConstantSeparateElement.y = startRotationConstantSeparateArray[1] * anglelToRad;\r\n\t\tstartRotationConstantSeparateElement.z = startRotationConstantSeparateArray[2] * anglelToRad;\r\n\t\tparticleSystem.startRotationConstantMin = data.startRotationConstantMin * anglelToRad;\r\n\t\tparticleSystem.startRotationConstantMax = data.startRotationConstantMax * anglelToRad;\r\n\t\tvar startRotationConstantMinSeparateArray: any[] = data.startRotationConstantMinSeparate;\r\n\t\tvar startRotationConstantMinSeparateElement: Vector3 = particleSystem.startRotationConstantMinSeparate;\r\n\t\tstartRotationConstantMinSeparateElement.x = startRotationConstantMinSeparateArray[0] * anglelToRad;\r\n\t\tstartRotationConstantMinSeparateElement.y = startRotationConstantMinSeparateArray[1] * anglelToRad;\r\n\t\tstartRotationConstantMinSeparateElement.z = startRotationConstantMinSeparateArray[2] * anglelToRad;\r\n\t\tvar startRotationConstantMaxSeparateArray: any[] = data.startRotationConstantMaxSeparate;\r\n\t\tvar startRotationConstantMaxSeparateElement: Vector3 = particleSystem.startRotationConstantMaxSeparate;\r\n\t\tstartRotationConstantMaxSeparateElement.x = startRotationConstantMaxSeparateArray[0] * anglelToRad;\r\n\t\tstartRotationConstantMaxSeparateElement.y = startRotationConstantMaxSeparateArray[1] * anglelToRad;\r\n\t\tstartRotationConstantMaxSeparateElement.z = startRotationConstantMaxSeparateArray[2] * anglelToRad;\r\n\r\n\t\tparticleSystem.randomizeRotationDirection = data.randomizeRotationDirection;\r\n\r\n\t\tparticleSystem.startColorType = data.startColorType;\r\n\t\tvar startColorConstantArray: any[] = data.startColorConstant;\r\n\t\tvar startColorConstantElement: Vector4 = particleSystem.startColorConstant;\r\n\t\tstartColorConstantElement.x = startColorConstantArray[0];\r\n\t\tstartColorConstantElement.y = startColorConstantArray[1];\r\n\t\tstartColorConstantElement.z = startColorConstantArray[2];\r\n\t\tstartColorConstantElement.w = startColorConstantArray[3];\r\n\t\tvar startColorConstantMinArray: any[] = data.startColorConstantMin;\r\n\t\tvar startColorConstantMinElement: Vector4 = particleSystem.startColorConstantMin;\r\n\t\tstartColorConstantMinElement.x = startColorConstantMinArray[0];\r\n\t\tstartColorConstantMinElement.y = startColorConstantMinArray[1];\r\n\t\tstartColorConstantMinElement.z = startColorConstantMinArray[2];\r\n\t\tstartColorConstantMinElement.w = startColorConstantMinArray[3];\r\n\t\tvar startColorConstantMaxArray: any[] = data.startColorConstantMax;\r\n\t\tvar startColorConstantMaxElement: Vector4 = particleSystem.startColorConstantMax;\r\n\t\tstartColorConstantMaxElement.x = startColorConstantMaxArray[0];\r\n\t\tstartColorConstantMaxElement.y = startColorConstantMaxArray[1];\r\n\t\tstartColorConstantMaxElement.z = startColorConstantMaxArray[2];\r\n\t\tstartColorConstantMaxElement.w = startColorConstantMaxArray[3];\r\n\r\n\t\tparticleSystem.gravityModifier = data.gravityModifier;\r\n\r\n\t\tparticleSystem.simulationSpace = data.simulationSpace;\r\n\t\t(data.simulationSpeed !== undefined) && (particleSystem.simulationSpeed = data.simulationSpeed);\r\n\r\n\t\tparticleSystem.scaleMode = data.scaleMode;\r\n\r\n\t\tparticleSystem.playOnAwake = data.playOnAwake;\r\n\t\tparticleSystem.maxParticles = data.maxParticles;\r\n\r\n\t\tvar autoRandomSeed: any = data.autoRandomSeed;\r\n\t\t(autoRandomSeed != null) && (particleSystem.autoRandomSeed = autoRandomSeed);\r\n\t\tvar randomSeed: any = data.randomSeed;\r\n\t\t(randomSeed != null) && (particleSystem.randomSeed[0] = randomSeed);\r\n\r\n\t\t//Emission\r\n\t\tvar emissionData: any = data.emission;\r\n\t\tvar emission: Emission = particleSystem.emission;\r\n\t\tif (emissionData) {\r\n\t\t\temission.emissionRate = emissionData.emissionRate;\r\n\t\t\tvar burstsData: any[] = emissionData.bursts;\r\n\t\t\tif (burstsData)\r\n\t\t\t\tfor (i = 0, n = burstsData.length; i < n; i++) {\r\n\t\t\t\t\tvar brust: any = burstsData[i];\r\n\t\t\t\t\temission.addBurst(new Burst(brust.time, brust.min, brust.max));\r\n\t\t\t\t}\r\n\t\t\temission.enable = emissionData.enable;\r\n\t\t} else {\r\n\t\t\temission.enable = false;\r\n\t\t}\r\n\r\n\t\t//Shape\r\n\t\tvar shapeData: any = data.shape;\r\n\t\tif (shapeData) {\r\n\t\t\tvar shape: BaseShape;\r\n\t\t\tswitch (shapeData.shapeType) {\r\n\t\t\t\tcase 0:\r\n\t\t\t\t\tvar sphereShape: SphereShape;\r\n\t\t\t\t\tshape = sphereShape = new SphereShape();\r\n\t\t\t\t\tsphereShape.radius = shapeData.sphereRadius;\r\n\t\t\t\t\tsphereShape.emitFromShell = shapeData.sphereEmitFromShell;\r\n\t\t\t\t\tsphereShape.randomDirection = shapeData.sphereRandomDirection;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 1:\r\n\t\t\t\t\tvar hemiSphereShape: HemisphereShape;\r\n\t\t\t\t\tshape = hemiSphereShape = new HemisphereShape();\r\n\t\t\t\t\themiSphereShape.radius = shapeData.hemiSphereRadius;\r\n\t\t\t\t\themiSphereShape.emitFromShell = shapeData.hemiSphereEmitFromShell;\r\n\t\t\t\t\themiSphereShape.randomDirection = shapeData.hemiSphereRandomDirection;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 2:\r\n\t\t\t\t\tvar coneShape: ConeShape;\r\n\t\t\t\t\tshape = coneShape = new ConeShape();\r\n\t\t\t\t\tconeShape.angle = shapeData.coneAngle * anglelToRad;\r\n\t\t\t\t\tconeShape.radius = shapeData.coneRadius;\r\n\t\t\t\t\tconeShape.length = shapeData.coneLength;\r\n\t\t\t\t\tconeShape.emitType = shapeData.coneEmitType;\r\n\t\t\t\t\tconeShape.randomDirection = shapeData.coneRandomDirection;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 3:\r\n\t\t\t\t\tvar boxShape: BoxShape;\r\n\t\t\t\t\tshape = boxShape = new BoxShape();\r\n\t\t\t\t\tboxShape.x = shapeData.boxX;\r\n\t\t\t\t\tboxShape.y = shapeData.boxY;\r\n\t\t\t\t\tboxShape.z = shapeData.boxZ;\r\n\t\t\t\t\tboxShape.randomDirection = shapeData.boxRandomDirection;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 7:\r\n\t\t\t\t\tvar circleShape: CircleShape;\r\n\t\t\t\t\tshape = circleShape = new CircleShape();\r\n\t\t\t\t\tcircleShape.radius = shapeData.circleRadius;\r\n\t\t\t\t\tcircleShape.arc = shapeData.circleArc * anglelToRad;\r\n\t\t\t\t\tcircleShape.emitFromEdge = shapeData.circleEmitFromEdge;\r\n\t\t\t\t\tcircleShape.randomDirection = shapeData.circleRandomDirection;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t/**\r\n\t\t\t\t * -------------------------------------------------------------\r\n\t\t\t\t */\r\n\t\t\t\tdefault:\r\n\t\t\t\t\tvar tempShape: CircleShape;\r\n\t\t\t\t\tshape = tempShape = new CircleShape();\r\n\t\t\t\t\ttempShape.radius = shapeData.circleRadius;\r\n\t\t\t\t\ttempShape.arc = shapeData.circleArc * anglelToRad;\r\n\t\t\t\t\ttempShape.emitFromEdge = shapeData.circleEmitFromEdge;\r\n\t\t\t\t\ttempShape.randomDirection = shapeData.circleRandomDirection;\r\n\t\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t\tshape.enable = shapeData.enable;\r\n\t\t\tparticleSystem.shape = shape;\r\n\t\t}\r\n\r\n\t\t//VelocityOverLifetime\r\n\t\tvar velocityOverLifetimeData: any = data.velocityOverLifetime;\r\n\t\tif (velocityOverLifetimeData) {\r\n\t\t\tvar velocityData: any = velocityOverLifetimeData.velocity;\r\n\t\t\tvar velocity: GradientVelocity;\r\n\t\t\tswitch (velocityData.type) {\r\n\t\t\t\tcase 0:\r\n\t\t\t\t\tvar constantData: any[] = velocityData.constant;\r\n\t\t\t\t\tvelocity = GradientVelocity.createByConstant(new Vector3(constantData[0], constantData[1], constantData[2]));\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 1:\r\n\t\t\t\t\tvelocity = GradientVelocity.createByGradient(this._initParticleVelocity(velocityData.gradientX), this._initParticleVelocity(velocityData.gradientY), this._initParticleVelocity(velocityData.gradientZ));\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 2:\r\n\t\t\t\t\tvar constantMinData: any[] = velocityData.constantMin;\r\n\t\t\t\t\tvar constantMaxData: any[] = velocityData.constantMax;\r\n\t\t\t\t\tvelocity = GradientVelocity.createByRandomTwoConstant(new Vector3(constantMinData[0], constantMinData[1], constantMinData[2]), new Vector3(constantMaxData[0], constantMaxData[1], constantMaxData[2]));\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 3:\r\n\t\t\t\t\tvelocity = GradientVelocity.createByRandomTwoGradient(this._initParticleVelocity(velocityData.gradientXMin), this._initParticleVelocity(velocityData.gradientXMax), this._initParticleVelocity(velocityData.gradientYMin), this._initParticleVelocity(velocityData.gradientYMax), this._initParticleVelocity(velocityData.gradientZMin), this._initParticleVelocity(velocityData.gradientZMax));\r\n\t\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t\tvar velocityOverLifetime: VelocityOverLifetime = new VelocityOverLifetime(velocity);\r\n\t\t\tvelocityOverLifetime.space = velocityOverLifetimeData.space;\r\n\t\t\tvelocityOverLifetime.enable = velocityOverLifetimeData.enable;\r\n\t\t\tparticleSystem.velocityOverLifetime = velocityOverLifetime;\r\n\t\t}\r\n\r\n\t\t//ColorOverLifetime\r\n\t\tvar colorOverLifetimeData: any = data.colorOverLifetime;\r\n\t\tif (colorOverLifetimeData) {\r\n\t\t\tvar colorData: any = colorOverLifetimeData.color;\r\n\t\t\tvar color: GradientColor;\r\n\t\t\tswitch (colorData.type) {\r\n\t\t\t\tcase 0:\r\n\t\t\t\t\tvar constColorData: any[] = colorData.constant;\r\n\t\t\t\t\tcolor = GradientColor.createByConstant(new Vector4(constColorData[0], constColorData[1], constColorData[2], constColorData[3]));\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 1:\r\n\t\t\t\t\tcolor = GradientColor.createByGradient(this._initParticleColor(colorData.gradient));\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 2:\r\n\t\t\t\t\tvar minConstColorData: any[] = colorData.constantMin;\r\n\t\t\t\t\tvar maxConstColorData: any[] = colorData.constantMax;\r\n\t\t\t\t\tcolor = GradientColor.createByRandomTwoConstant(new Vector4(minConstColorData[0], minConstColorData[1], minConstColorData[2], minConstColorData[3]), new Vector4(maxConstColorData[0], maxConstColorData[1], maxConstColorData[2], maxConstColorData[3]));\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 3:\r\n\t\t\t\t\tcolor = GradientColor.createByRandomTwoGradient(this._initParticleColor(colorData.gradientMin), this._initParticleColor(colorData.gradientMax));\r\n\t\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t\tvar colorOverLifetime: ColorOverLifetime = new ColorOverLifetime(color);\r\n\t\t\tcolorOverLifetime.enable = colorOverLifetimeData.enable;\r\n\t\t\tparticleSystem.colorOverLifetime = colorOverLifetime;\r\n\t\t}\r\n\r\n\t\t//SizeOverLifetime\r\n\t\tvar sizeOverLifetimeData: any = data.sizeOverLifetime;\r\n\t\tif (sizeOverLifetimeData) {\r\n\t\t\tvar sizeData: any = sizeOverLifetimeData.size;\r\n\t\t\tvar size: GradientSize;\r\n\t\t\tswitch (sizeData.type) {\r\n\t\t\t\tcase 0:\r\n\t\t\t\t\tif (sizeData.separateAxes) {\r\n\t\t\t\t\t\tsize = GradientSize.createByGradientSeparate(this._initParticleSize(sizeData.gradientX), this._initParticleSize(sizeData.gradientY), this._initParticleSize(sizeData.gradientZ));\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tsize = GradientSize.createByGradient(this._initParticleSize(sizeData.gradient));\r\n\t\t\t\t\t}\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 1:\r\n\t\t\t\t\tif (sizeData.separateAxes) {\r\n\t\t\t\t\t\tvar constantMinSeparateData: any[] = sizeData.constantMinSeparate;\r\n\t\t\t\t\t\tvar constantMaxSeparateData: any[] = sizeData.constantMaxSeparate;\r\n\t\t\t\t\t\tsize = GradientSize.createByRandomTwoConstantSeparate(new Vector3(constantMinSeparateData[0], constantMinSeparateData[1], constantMinSeparateData[2]), new Vector3(constantMaxSeparateData[0], constantMaxSeparateData[1], constantMaxSeparateData[2]));\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tsize = GradientSize.createByRandomTwoConstant(sizeData.constantMin, sizeData.constantMax);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 2:\r\n\t\t\t\t\tif (sizeData.separateAxes) {\r\n\t\t\t\t\t\tsize = GradientSize.createByRandomTwoGradientSeparate(this._initParticleSize(sizeData.gradientXMin), this._initParticleSize(sizeData.gradientYMin), this._initParticleSize(sizeData.gradientZMin), this._initParticleSize(sizeData.gradientXMax), this._initParticleSize(sizeData.gradientYMax), this._initParticleSize(sizeData.gradientZMax));\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tsize = GradientSize.createByRandomTwoGradient(this._initParticleSize(sizeData.gradientMin), this._initParticleSize(sizeData.gradientMax));\r\n\t\t\t\t\t}\r\n\t\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t\tvar sizeOverLifetime: SizeOverLifetime = new SizeOverLifetime(size);\r\n\t\t\tsizeOverLifetime.enable = sizeOverLifetimeData.enable;\r\n\t\t\tparticleSystem.sizeOverLifetime = sizeOverLifetime;\r\n\t\t}\r\n\r\n\t\t//RotationOverLifetime\r\n\t\tvar rotationOverLifetimeData: any = data.rotationOverLifetime;\r\n\t\tif (rotationOverLifetimeData) {\r\n\t\t\tvar angularVelocityData: any = rotationOverLifetimeData.angularVelocity;\r\n\t\t\tvar angularVelocity: GradientAngularVelocity;\r\n\t\t\tswitch (angularVelocityData.type) {\r\n\t\t\t\tcase 0:\r\n\t\t\t\t\tif (angularVelocityData.separateAxes) {\r\n\t\t\t\t\t\tvar conSep: any[] = angularVelocityData.constantSeparate;\r\n\t\t\t\t\t\tangularVelocity = GradientAngularVelocity.createByConstantSeparate(new Vector3(conSep[0] * anglelToRad, conSep[1] * anglelToRad, conSep[2] * anglelToRad));\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tangularVelocity = GradientAngularVelocity.createByConstant(angularVelocityData.constant * anglelToRad);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 1:\r\n\t\t\t\t\tif (angularVelocityData.separateAxes) {\r\n\t\t\t\t\t\tangularVelocity = GradientAngularVelocity.createByGradientSeparate(this._initParticleRotation(angularVelocityData.gradientX), this._initParticleRotation(angularVelocityData.gradientY), this._initParticleRotation(angularVelocityData.gradientZ));\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tangularVelocity = GradientAngularVelocity.createByGradient(this._initParticleRotation(angularVelocityData.gradient));\r\n\t\t\t\t\t}\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 2:\r\n\t\t\t\t\tif (angularVelocityData.separateAxes) {\r\n\t\t\t\t\t\tvar minSep: any[] = angularVelocityData.constantMinSeparate;//TODO:Y\r\n\t\t\t\t\t\tvar maxSep: any[] = angularVelocityData.constantMaxSeparate;//TODO:Y\r\n\t\t\t\t\t\tangularVelocity = GradientAngularVelocity.createByRandomTwoConstantSeparate(new Vector3(minSep[0] * anglelToRad, minSep[1] * anglelToRad, minSep[2] * anglelToRad), new Vector3(maxSep[0] * anglelToRad, maxSep[1] * anglelToRad, maxSep[2] * anglelToRad));\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tangularVelocity = GradientAngularVelocity.createByRandomTwoConstant(angularVelocityData.constantMin * anglelToRad, angularVelocityData.constantMax * anglelToRad);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 3:\r\n\t\t\t\t\tif (angularVelocityData.separateAxes) {\r\n\t\t\t\t\t\t//TODO:\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tangularVelocity = GradientAngularVelocity.createByRandomTwoGradient(this._initParticleRotation(angularVelocityData.gradientMin), this._initParticleRotation(angularVelocityData.gradientMax));\r\n\t\t\t\t\t}\r\n\t\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t\tvar rotationOverLifetime: RotationOverLifetime = new RotationOverLifetime(angularVelocity);\r\n\t\t\trotationOverLifetime.enable = rotationOverLifetimeData.enable;\r\n\t\t\tparticleSystem.rotationOverLifetime = rotationOverLifetime;\r\n\t\t}\r\n\r\n\t\t//TextureSheetAnimation\r\n\t\tvar textureSheetAnimationData: any = data.textureSheetAnimation;\r\n\t\tif (textureSheetAnimationData) {\r\n\t\t\tvar frameData: any = textureSheetAnimationData.frame;\r\n\t\t\tvar frameOverTime: FrameOverTime;\r\n\t\t\tswitch (frameData.type) {\r\n\t\t\t\tcase 0:\r\n\t\t\t\t\tframeOverTime = FrameOverTime.createByConstant(frameData.constant);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 1:\r\n\t\t\t\t\tframeOverTime = FrameOverTime.createByOverTime(this._initParticleFrame(frameData.overTime));\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 2:\r\n\t\t\t\t\tframeOverTime = FrameOverTime.createByRandomTwoConstant(frameData.constantMin, frameData.constantMax);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 3:\r\n\t\t\t\t\tframeOverTime = FrameOverTime.createByRandomTwoOverTime(this._initParticleFrame(frameData.overTimeMin), this._initParticleFrame(frameData.overTimeMax));\r\n\t\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t\tvar startFrameData: any = textureSheetAnimationData.startFrame;\r\n\t\t\tvar startFrame: StartFrame;\r\n\t\t\tswitch (startFrameData.type) {\r\n\t\t\t\tcase 0:\r\n\t\t\t\t\tstartFrame = StartFrame.createByConstant(startFrameData.constant);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 1:\r\n\t\t\t\t\tstartFrame = StartFrame.createByRandomTwoConstant(startFrameData.constantMin, startFrameData.constantMax);\r\n\t\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t\tvar textureSheetAnimation: TextureSheetAnimation = new TextureSheetAnimation(frameOverTime, startFrame);\r\n\t\t\ttextureSheetAnimation.enable = textureSheetAnimationData.enable;\r\n\t\t\tvar tilesData: any[] = textureSheetAnimationData.tiles;\r\n\t\t\ttextureSheetAnimation.tiles = new Vector2(tilesData[0], tilesData[1]);\r\n\t\t\ttextureSheetAnimation.type = textureSheetAnimationData.type;\r\n\t\t\ttextureSheetAnimation.randomRow = textureSheetAnimationData.randomRow;\r\n\t\t\tvar rowIndex: any = textureSheetAnimationData.rowIndex;\r\n\t\t\t(rowIndex !== undefined) && (textureSheetAnimation.rowIndex = rowIndex);\r\n\t\t\ttextureSheetAnimation.cycles = textureSheetAnimationData.cycles;\r\n\t\t\tparticleSystem.textureSheetAnimation = textureSheetAnimation;\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @deprecated\r\n\t * @internal\r\n\t */\r\n\tprivate _initParticleColor(gradientColorData: any, maxkeyCount: number = 4): Gradient {\r\n\t\tvar gradientColor: Gradient = new Gradient(maxkeyCount, maxkeyCount);\r\n\t\tif (!gradientColorData) {\r\n\t\t\tgradientColor.addColorAlpha(0, 1);\r\n\t\t\tgradientColor.addColorAlpha(1, 1);\r\n\t\t\tgradientColor.addColorRGB(0, new Color(1.0, 1.0, 1.0, 1.0));\r\n\t\t\tgradientColor.addColorRGB(1, new Color(1.0, 1.0, 1.0, 1.0));\r\n\t\t}\r\n\t\telse {\r\n\t\t\tvar alphasData: any[] = gradientColorData.alphas;\r\n\t\t\tvar i: number, n: number;\r\n\t\t\tif (!alphasData) {//\r\n\t\t\t\tgradientColor.addColorAlpha(0, 1);\r\n\t\t\t\tgradientColor.addColorAlpha(1, 1);\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tfor (i = 0, n = alphasData.length; i < n; i++) {\r\n\t\t\t\t\tif (i == maxkeyCount - 1 && n > maxkeyCount) {\r\n\t\t\t\t\t\ti = n - 1;\r\n\t\t\t\t\t\tconsole.warn(`GradientDataColor warning:alpha data length is large than ${maxkeyCount}, will ignore the middle data.`);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tvar alphaData: any = alphasData[i];\r\n\t\t\t\t\tgradientColor.addColorAlpha(alphaData.key, alphaData.value);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tvar rgbsData: any[] = gradientColorData.rgbs;\r\n\t\t\tif (!rgbsData) {//\r\n\t\t\t\tgradientColor.addColorRGB(0, new Color(1.0, 1.0, 1.0, 1.0));\r\n\t\t\t\tgradientColor.addColorRGB(1, new Color(1.0, 1.0, 1.0, 1.0));\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tfor (i = 0, n = rgbsData.length; i < n; i++) {\r\n\t\t\t\t\tif (i == maxkeyCount - 1 && n > maxkeyCount) {\r\n\t\t\t\t\t\ti = n - 1;\r\n\t\t\t\t\t\tconsole.warn(`GradientDataColor warning:rgb data length is large than ${maxkeyCount}, will ignore the middle data.`);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tvar rgbData: any = rgbsData[i];\r\n\t\t\t\t\tvar rgbValue: any[] = rgbData.value;\r\n\t\t\t\t\tgradientColor.addColorRGB(rgbData.key, new Color(rgbValue[0], rgbValue[1], rgbValue[2], 1.0));\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn gradientColor;\r\n\t}\r\n\r\n\t/**\r\n\t * @deprecated\r\n\t * @internal\r\n\t */\r\n\tprivate _initParticleFrame(overTimeFramesData: any): GradientDataInt {\r\n\t\tvar overTimeFrame: GradientDataInt = new GradientDataInt();\r\n\t\tif (overTimeFramesData) {\r\n\t\t\tvar framesData: any[] = overTimeFramesData.frames;\r\n\t\t\tfor (var i: number = 0, n: number = framesData.length; i < n; i++) {\r\n\t\t\t\tvar frameData: any = framesData[i];\r\n\t\t\t\toverTimeFrame.add(frameData.key, frameData.value);\r\n\t\t\t}\r\n\t\t}\r\n\t\telse {\r\n\t\t\toverTimeFrame.add(0, 0);\r\n\t\t\toverTimeFrame.add(1, 1);\r\n\t\t}\r\n\r\n\t\treturn overTimeFrame;\r\n\t}\r\n\r\n\t/**\r\n\t * @deprecated\r\n\t * @internal\r\n\t */\r\n\tprivate static _initStartLife(gradientData: any): GradientDataNumber {\r\n\t\tvar gradient: GradientDataNumber = new GradientDataNumber();\r\n\t\tvar startLifetimesData: any[] = gradientData.startLifetimes;\r\n\t\tfor (var i: number = 0, n: number = startLifetimesData.length; i < n; i++) {\r\n\t\t\tvar valueData: any = startLifetimesData[i];\r\n\t\t\tgradient.add(valueData.key, valueData.value);\r\n\t\t}\r\n\t\treturn gradient\r\n\t}\r\n\r\n\t/**\r\n\t * @deprecated\r\n\t * @internal\r\n\t */\r\n\tprivate _initParticleVelocity(gradientData: any): GradientDataNumber {\r\n\t\tvar gradient: GradientDataNumber = new GradientDataNumber();\r\n\t\tvar velocitysData: any[] = gradientData.velocitys;\r\n\t\tfor (var i: number = 0, n: number = velocitysData.length; i < n; i++) {\r\n\t\t\tvar valueData: any = velocitysData[i];\r\n\t\t\tgradient.add(valueData.key, valueData.value);\r\n\t\t}\r\n\t\treturn gradient;\r\n\t}\r\n\r\n\t/**\r\n\t * @deprecated\r\n\t * @internal\r\n\t */\r\n\tprivate _initParticleSize(gradientSizeData: any): GradientDataNumber {\r\n\t\tvar gradientSize: GradientDataNumber = new GradientDataNumber();\r\n\t\tif (gradientSizeData) {\r\n\t\t\tvar sizesData: any[] = gradientSizeData.sizes;\r\n\t\t\tfor (var i: number = 0, n: number = sizesData.length; i < n; i++) {\r\n\t\t\t\tvar valueData: any = sizesData[i];\r\n\t\t\t\tgradientSize.add(valueData.key, valueData.value);\r\n\t\t\t}\r\n\t\t}\r\n\t\telse {\r\n\t\t\tgradientSize.add(0, 0);\r\n\t\t\tgradientSize.add(1, 1);\r\n\t\t}\r\n\t\treturn gradientSize;\r\n\t}\r\n\r\n\t/**\r\n\t * @deprecated\r\n\t * @internal\r\n\t */\r\n\tprivate _initParticleRotation(gradientData: any): GradientDataNumber {\r\n\t\tvar gradient: GradientDataNumber = new GradientDataNumber();\r\n\t\tvar angularVelocitysData: any[] = gradientData.angularVelocitys;\r\n\t\tfor (var i: number = 0, n: number = angularVelocitysData.length; i < n; i++) {\r\n\t\t\tvar valueData: any = angularVelocitysData[i];\r\n\t\t\tgradient.add(valueData.key, valueData.value / 180.0 * Math.PI);\r\n\t\t}\r\n\t\treturn gradient;\r\n\t}\r\n\r\n}\r\n\r\n\r\n","import { Material } from \"../../../resource/Material\";\r\nimport { BaseTexture } from \"../../../resource/BaseTexture\"\r\nimport { Shader3D } from \"../../../RenderEngine/RenderShader/Shader3D\";\r\nimport { ShaderDefine } from \"../../../RenderEngine/RenderShader/ShaderDefine\";\r\nimport { Color } from \"../../../maths/Color\";\r\nimport { Vector4 } from \"../../../maths/Vector4\";\r\nimport { RenderState } from \"../../../RenderEngine/RenderShader/RenderState\";\r\n\r\n\r\n/**\r\n * <code>ShurikenParticleMaterial</code> \r\n */\r\nexport class ShurikenParticleMaterial extends Material {\r\n\t/**_*/\r\n\tstatic RENDERMODE_ALPHABLENDED: number = 0;\r\n\t/**_*/\r\n\tstatic RENDERMODE_ADDTIVE: number = 1;\r\n\r\n\t/**@internal */\r\n\tstatic SHADERDEFINE_DIFFUSEMAP: ShaderDefine;\r\n\t/**@internal */\r\n\tstatic SHADERDEFINE_TINTCOLOR: ShaderDefine;\r\n\t/**@interanl */\r\n\tstatic SHADERDEFINE_ADDTIVEFOG: ShaderDefine;\r\n\r\n\t/**@internal */\r\n\tstatic DIFFUSETEXTURE: number;\r\n\t/**@internal */\r\n\tstatic TINTCOLOR: number;\r\n\t/**@internal */\r\n\tstatic TILINGOFFSET: number;\r\n\r\n\t/** */\r\n\tstatic defaultMaterial: ShurikenParticleMaterial;\r\n\r\n\t/**\r\n\t * @internal\r\n\t */\r\n\tstatic __initDefine__(): void {\r\n\t\tShurikenParticleMaterial.SHADERDEFINE_DIFFUSEMAP = Shader3D.getDefineByName(\"DIFFUSEMAP\");\r\n\t\tShurikenParticleMaterial.SHADERDEFINE_TINTCOLOR = Shader3D.getDefineByName(\"TINTCOLOR\");\r\n\t\tShurikenParticleMaterial.SHADERDEFINE_ADDTIVEFOG = Shader3D.getDefineByName(\"ADDTIVEFOG\");\r\n\t\tShurikenParticleMaterial.DIFFUSETEXTURE = Shader3D.propertyNameToID(\"u_texture\");\r\n\t\tShurikenParticleMaterial.TINTCOLOR = Shader3D.propertyNameToID(\"u_Tintcolor\");\r\n\t\tShurikenParticleMaterial.TILINGOFFSET = Shader3D.propertyNameToID(\"u_TilingOffset\");\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t */\r\n\tget color(): Color {\r\n\t\treturn this._shaderValues.getColor(ShurikenParticleMaterial.TINTCOLOR);\r\n\t}\r\n\r\n\tset color(value: Color) {\r\n\t\tif (value)\r\n\t\t\tthis._shaderValues.addDefine(ShurikenParticleMaterial.SHADERDEFINE_TINTCOLOR);\r\n\t\telse\r\n\t\t\tthis._shaderValues.removeDefine(ShurikenParticleMaterial.SHADERDEFINE_TINTCOLOR);\r\n\r\n\t\tthis._shaderValues.setColor(ShurikenParticleMaterial.TINTCOLOR, value);\r\n\t}\r\n\r\n\r\n\r\n\t/**\r\n\t * \r\n\t */\r\n\tget tilingOffset(): Vector4 {\r\n\t\treturn (<Vector4>this._shaderValues.getVector(ShurikenParticleMaterial.TILINGOFFSET));\r\n\t}\r\n\r\n\tset tilingOffset(value: Vector4) {\r\n\t\tif (value) {\r\n\t\t\tthis._shaderValues.setVector(ShurikenParticleMaterial.TILINGOFFSET, value);\r\n\t\t}\r\n\t\telse {\r\n\t\t\tthis._shaderValues.getVector(ShurikenParticleMaterial.TILINGOFFSET).setValue(1.0, 1.0, 0.0, 0.0);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t */\r\n\tget texture(): BaseTexture {\r\n\t\treturn this._shaderValues.getTexture(ShurikenParticleMaterial.DIFFUSETEXTURE);\r\n\t}\r\n\r\n\tset texture(value: BaseTexture) {\r\n\t\tif (value)\r\n\t\t\tthis._shaderValues.addDefine(ShurikenParticleMaterial.SHADERDEFINE_DIFFUSEMAP);\r\n\t\telse\r\n\t\t\tthis._shaderValues.removeDefine(ShurikenParticleMaterial.SHADERDEFINE_DIFFUSEMAP);\r\n\r\n\t\tthis._shaderValues.setTexture(ShurikenParticleMaterial.DIFFUSETEXTURE, value);\r\n\t}\r\n\r\n\r\n\t/**\r\n\t *  <code>ShurikenParticleMaterial</code> \r\n\t */\r\n\tconstructor() {\r\n\t\tsuper();\r\n\t\tthis.setShaderName(\"PARTICLESHURIKEN\");\r\n\t\t// this._shaderValues.setColor(ShurikenParticleMaterial.TINTCOLOR, new Color(0.5, 0.5, 0.5, 0.5));\r\n\t\t// this._shaderValues.setVector(ShurikenParticleMaterial.TILINGOFFSET, new Vector4(1.0, 1.0, 0.0, 0.0));\r\n\t\tthis.renderMode = ShurikenParticleMaterial.RENDERMODE_ALPHABLENDED;//\r\n\t}\r\n\r\n\t/**\r\n\t* \r\n\t* @return\t \r\n\t* @override\r\n\t*/\r\n\tclone(): any {\r\n\t\tvar dest: ShurikenParticleMaterial = new ShurikenParticleMaterial();\r\n\t\tthis.cloneTo(dest);\r\n\t\treturn dest;\r\n\t}\r\n\r\n\r\n\t//----------------deprecated----------------\r\n\t/**\r\n\t * @deprecated\r\n\t * \r\n\t */\r\n\tset renderMode(value: number) {\r\n\t\tswitch (value) {\r\n\t\t\tcase ShurikenParticleMaterial.RENDERMODE_ADDTIVE:\r\n\t\t\t\tthis.renderQueue = Material.RENDERQUEUE_TRANSPARENT;\r\n\t\t\t\tthis.depthWrite = false;\r\n\t\t\t\tthis.cull = RenderState.CULL_NONE;\r\n\t\t\t\tthis.blend = RenderState.BLEND_ENABLE_ALL;\r\n\t\t\t\tthis.blendSrc = RenderState.BLENDPARAM_SRC_ALPHA;\r\n\t\t\t\tthis.blendDst = RenderState.BLENDPARAM_ONE;\r\n\t\t\t\tthis.alphaTest = false;\r\n\t\t\t\tthis._shaderValues.addDefine(ShurikenParticleMaterial.SHADERDEFINE_ADDTIVEFOG);\r\n\t\t\t\tbreak;\r\n\t\t\tcase ShurikenParticleMaterial.RENDERMODE_ALPHABLENDED:\r\n\t\t\t\tthis.renderQueue = Material.RENDERQUEUE_TRANSPARENT;\r\n\t\t\t\tthis.depthWrite = false;\r\n\t\t\t\tthis.cull = RenderState.CULL_NONE;\r\n\t\t\t\tthis.blend = RenderState.BLEND_ENABLE_ALL;\r\n\t\t\t\tthis.blendSrc = RenderState.BLENDPARAM_SRC_ALPHA;\r\n\t\t\t\tthis.blendDst = RenderState.BLENDPARAM_ONE_MINUS_SRC_ALPHA;\r\n\t\t\t\tthis.alphaTest = false;\r\n\t\t\t\tthis._shaderValues.removeDefine(ShurikenParticleMaterial.SHADERDEFINE_ADDTIVEFOG);\r\n\t\t\t\tbreak;\r\n\t\t\tdefault:\r\n\t\t\t\tthrow new Error(\"ShurikenParticleMaterial : renderMode value error.\");\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @deprecated\r\n\t * X\r\n\t */\r\n\tget tilingOffsetX(): number {\r\n\t\treturn this._MainTex_STX;\r\n\t}\r\n\r\n\tset tilingOffsetX(x: number) {\r\n\t\tthis._MainTex_STX = x;\r\n\t}\r\n\r\n\t/**\r\n\t * @deprecated\r\n\t * Y\r\n\t */\r\n\tget tilingOffsetY(): number {\r\n\t\treturn this._MainTex_STY;\r\n\t}\r\n\r\n\tset tilingOffsetY(y: number) {\r\n\t\tthis._MainTex_STY = y;\r\n\t}\r\n\r\n\t/**\r\n\t * @deprecated\r\n\t * Z\r\n\t */\r\n\tget tilingOffsetZ(): number {\r\n\t\treturn this._MainTex_STZ;\r\n\t}\r\n\r\n\tset tilingOffsetZ(z: number) {\r\n\t\tthis._MainTex_STZ = z;\r\n\t}\r\n\r\n\t/**\r\n\t * @deprecated\r\n\t * W\r\n\t */\r\n\tget tilingOffsetW(): number {\r\n\t\treturn this._MainTex_STW;\r\n\t}\r\n\r\n\tset tilingOffsetW(w: number) {\r\n\t\tthis._MainTex_STW = w;\r\n\t}\r\n\r\n\t/**\r\n\t * @deprecated\r\n\t * @internal\r\n\t */\r\n\tget _TintColor(): Color {\r\n\t\treturn this.color;\r\n\t}\r\n\r\n\t/**\r\n\t * @deprecated\r\n\t * @internal\r\n\t */\r\n\tset _TintColor(value: Color) {\r\n\t\tthis.color = value;\r\n\t}\r\n\r\n\r\n\t/**\r\n\t * @deprecated\r\n\t * @internal\r\n\t */\r\n\tget _TintColorR(): number {\r\n\t\treturn this.color.r;\r\n\t}\r\n\r\n\t/**\r\n\t * @deprecated\r\n\t * @internal\r\n\t */\r\n\tset _TintColorR(value: number) {\r\n\t\tthis.color.r = value;\r\n\t}\r\n\r\n\t/**\r\n\t * @deprecated\r\n\t * @internal\r\n\t */\r\n\tget _TintColorG(): number {\r\n\t\treturn this.color.g;\r\n\t}\r\n\r\n\t/**\r\n\t * @deprecated\r\n\t * @internal\r\n\t */\r\n\tset _TintColorG(value: number) {\r\n\t\tthis.color.g = value;\r\n\t}\r\n\r\n\t/**\r\n\t * @deprecated\r\n\t * @internal\r\n\t */\r\n\tget _TintColorB(): number {\r\n\t\treturn this.color.b;\r\n\t}\r\n\r\n\t/**\r\n\t * @deprecated\r\n\t * @internal\r\n\t */\r\n\tset _TintColorB(value: number) {\r\n\t\tthis.color.b = value;\r\n\t}\r\n\r\n\t/**\r\n\t * @deprecated\r\n\t * @internal \r\n\t */\r\n\tget _TintColorA(): number {\r\n\t\treturn this.color.a;\r\n\t}\r\n\r\n\t/**\r\n\t * @deprecated\r\n\t * @internal\r\n\t */\r\n\tset _TintColorA(value: number) {\r\n\t\tthis.color.a = value;\r\n\t}\r\n\r\n\t/**\r\n\t * @deprecated\r\n\t * @internal\r\n\t */\r\n\tget _MainTex_ST(): Vector4 {\r\n\t\treturn this._shaderValues.getVector(ShurikenParticleMaterial.TILINGOFFSET)\r\n\t}\r\n\r\n\t/**\r\n\t * @deprecated\r\n\t * @internal\r\n\t */\r\n\tset _MainTex_ST(value: Vector4) {\r\n\t\tvar tilOff: Vector4 = (<Vector4>this._shaderValues.getVector(ShurikenParticleMaterial.TILINGOFFSET));\r\n\t\ttilOff.setValue(value.x, value.y, value.z, value.w);\r\n\t\tthis.tilingOffset = tilOff;\r\n\t}\r\n\r\n\r\n\t/**\r\n\t * @deprecated\r\n\t * @internal\r\n\t */\r\n\tget _MainTex_STX(): number {\r\n\t\treturn this._shaderValues.getVector(ShurikenParticleMaterial.TILINGOFFSET).x;\r\n\t}\r\n\r\n\t/**\r\n\t * @deprecated\r\n\t * @internal\r\n\t */\r\n\tset _MainTex_STX(x: number) {\r\n\t\tvar tilOff: Vector4 = (<Vector4>this._shaderValues.getVector(ShurikenParticleMaterial.TILINGOFFSET));\r\n\t\ttilOff.x = x;\r\n\t\tthis.tilingOffset = tilOff;\r\n\t}\r\n\r\n\t/**\r\n\t * @deprecated\r\n\t * @internal\r\n\t */\r\n\tget _MainTex_STY(): number {\r\n\t\treturn this._shaderValues.getVector(ShurikenParticleMaterial.TILINGOFFSET).y;\r\n\t}\r\n\r\n\t/**\r\n\t * @deprecated\r\n\t * @internal\r\n\t */\r\n\tset _MainTex_STY(y: number) {\r\n\t\tvar tilOff: Vector4 = (<Vector4>this._shaderValues.getVector(ShurikenParticleMaterial.TILINGOFFSET));\r\n\t\ttilOff.y = y;\r\n\t\tthis.tilingOffset = tilOff;\r\n\t}\r\n\r\n\t/**\r\n\t * @deprecated\r\n\t * @internal\r\n\t */\r\n\tget _MainTex_STZ(): number {\r\n\t\treturn this._shaderValues.getVector(ShurikenParticleMaterial.TILINGOFFSET).z;\r\n\t}\r\n\r\n\t/**\r\n\t * @deprecated\r\n\t * @internal\r\n\t */\r\n\tset _MainTex_STZ(z: number) {\r\n\t\tvar tilOff: Vector4 = (<Vector4>this._shaderValues.getVector(ShurikenParticleMaterial.TILINGOFFSET));\r\n\t\ttilOff.z = z;\r\n\t\tthis.tilingOffset = tilOff;\r\n\t}\r\n\r\n\t/**\r\n\t * @deprecated\r\n\t * @internal\r\n\t */\r\n\tget _MainTex_STW(): number {\r\n\t\treturn this._shaderValues.getVector(ShurikenParticleMaterial.TILINGOFFSET).w;\r\n\t}\r\n\r\n\t/**\r\n\t * @deprecated\r\n\t * @internal\r\n\t */\r\n\tset _MainTex_STW(w: number) {\r\n\t\tvar tilOff: Vector4 = (<Vector4>this._shaderValues.getVector(ShurikenParticleMaterial.TILINGOFFSET));\r\n\t\ttilOff.w = w;\r\n\t\tthis.tilingOffset = tilOff;\r\n\t}\r\n\r\n\r\n\r\n\t/**\r\n\t * @deprecated\r\n\t * R\r\n\t */\r\n\tget colorR(): number {\r\n\t\treturn this._TintColorR;\r\n\t}\r\n\r\n\tset colorR(value: number) {\r\n\t\tthis._TintColorR = value;\r\n\t}\r\n\r\n\t/**\r\n\t * @deprecated\r\n\t * G\r\n\t */\r\n\tget colorG(): number {\r\n\t\treturn this._TintColorG;\r\n\t}\r\n\r\n\tset colorG(value: number) {\r\n\t\tthis._TintColorG = value;\r\n\t}\r\n\r\n\t/**\r\n\t * @deprecated\r\n\t * B\r\n\t */\r\n\tget colorB(): number {\r\n\t\treturn this._TintColorB;\r\n\t}\r\n\r\n\tset colorB(value: number) {\r\n\t\tthis._TintColorB = value;\r\n\t}\r\n\r\n\t/**\r\n\t * @deprecated\r\n\t * Z\r\n\t */\r\n\tget colorA(): number {\r\n\t\treturn this._TintColorA;\r\n\t}\r\n\r\n\tset colorA(value: number) {\r\n\t\tthis._TintColorA = value;\r\n\t}\r\n}\r\n\r\n\r\n","import { VertexMesh } from \"../../../RenderEngine/RenderShader/VertexMesh\";\r\nimport { VertexDeclaration } from \"../../../RenderEngine/VertexDeclaration\";\r\nimport { VertexElement } from \"../../../renders/VertexElement\";\r\nimport { VertexElementFormat } from \"../../../renders/VertexElementFormat\";\r\n/**\r\n * @internal\r\n * @author \r\n */\r\nexport class PixelLineVertex {\r\n\tprivate static _vertexDeclaration: VertexDeclaration;\r\n\r\n\tstatic get vertexDeclaration(): VertexDeclaration {\r\n\t\treturn PixelLineVertex._vertexDeclaration;\r\n\t}\r\n\r\n\t/**\r\n\t * @internal\r\n\t */\r\n\tstatic __init__(): void {\r\n\t\tPixelLineVertex._vertexDeclaration = new VertexDeclaration(28,\r\n\t\t\t[new VertexElement(0, VertexElementFormat.Vector3, VertexMesh.MESH_POSITION0),\r\n\t\t\tnew VertexElement(12, VertexElementFormat.Vector4, VertexMesh.MESH_COLOR0)]);\r\n\t}\r\n\r\n\tget vertexDeclaration(): VertexDeclaration {\r\n\t\treturn PixelLineVertex._vertexDeclaration;\r\n\t}\r\n\r\n\tconstructor() {\r\n\r\n\t}\r\n\r\n}\r\n\r\n\r\n","import { Event } from \"../../events/Event\";\r\nimport { EventDispatcher } from \"../../events/EventDispatcher\";\r\nimport { MathUtils3D } from \"../../maths/MathUtils3D\";\r\nimport { Matrix3x3 } from \"../../maths/Matrix3x3\";\r\nimport { Matrix4x4 } from \"../../maths/Matrix4x4\";\r\nimport { Quaternion } from \"../../maths/Quaternion\";\r\nimport { Vector3 } from \"../../maths/Vector3\";\r\nimport { Sprite3D } from \"./Sprite3D\";\r\n\r\n/**\r\n * <code>Transform3D</code> 3D\r\n */\r\nexport class Transform3D extends EventDispatcher {\r\n\t/** @internal */\r\n\tprotected static _tempVector30: Vector3 = new Vector3();\r\n\t/** @internal */\r\n\tprotected static _tempQuaternion0: Quaternion = new Quaternion();\r\n\t/** @internal */\r\n\tprotected static _tempMatrix0: Matrix4x4 = new Matrix4x4();\r\n\t/** @internal */\r\n\tprotected static _tempMatrix3x30: Matrix3x3 = new Matrix3x3();\r\n\t/** @internal */\r\n\tprotected static _tempMatrix3x31: Matrix3x3 = new Matrix3x3();\r\n\t/** @internal */\r\n\tprotected static _tempMatrix3x32: Matrix3x3 = new Matrix3x3();\r\n\t/** @internal */\r\n\tprotected static _tempMatrix3x33: Matrix3x3 = new Matrix3x3();\r\n\r\n\t/**@internal */\r\n\tstatic TRANSFORM_LOCALQUATERNION: number = 0x01;\r\n\t/**@internal */\r\n\tstatic TRANSFORM_LOCALEULER: number = 0x02;\r\n\t/**@internal */\r\n\tstatic TRANSFORM_LOCALMATRIX: number = 0x04;\r\n\t/**@internal */\r\n\tstatic TRANSFORM_WORLDPOSITION: number = 0x08;\r\n\t/**@internal */\r\n\tstatic TRANSFORM_WORLDQUATERNION: number = 0x10;\r\n\t/**@internal */\r\n\tstatic TRANSFORM_WORLDSCALE: number = 0x20;\r\n\t/**@internal */\r\n\tstatic TRANSFORM_WORLDMATRIX: number = 0x40;\r\n\t/**@internal */\r\n\tstatic TRANSFORM_WORLDEULER: number = 0x80;\r\n\r\n\t/**@internal */\r\n\tstatic _angleToRandin: number = 180 / Math.PI;\r\n\r\n\t/** @internal */\r\n\tprotected _owner: Sprite3D;\r\n\t/** @internal */\r\n\tprotected _localPosition: Vector3 = new Vector3(0, 0, 0);\r\n\t/** @internal */\r\n\tprotected _localRotation: Quaternion = new Quaternion(0, 0, 0, 1);\r\n\t/** @internal */\r\n\tprotected _localScale: Vector3 = new Vector3(1, 1, 1);\r\n\t/**@internal */\r\n\tprotected _localRotationEuler: Vector3 = new Vector3(0, 0, 0);\r\n\t/** @internal */\r\n\tprotected _localMatrix: Matrix4x4 = new Matrix4x4();\r\n\r\n\t/** @internal */\r\n\tprotected _position: Vector3 = new Vector3(0, 0, 0);\r\n\t/** @internal */\r\n\tprotected _rotation: Quaternion = new Quaternion(0, 0, 0, 1);\r\n\t/** @internal */\r\n\tprotected _scale: Vector3 = new Vector3(1, 1, 1);\r\n\t/**@internal */\r\n\tprotected _rotationEuler: Vector3 = new Vector3(0, 0, 0);\r\n\t/** @internal */\r\n\tprotected _worldMatrix: Matrix4x4 = new Matrix4x4();\r\n\r\n\t/** @internal */\r\n\t_children: Transform3D[] | null = null;\r\n\t/**@internal true */\r\n\tprotected _isDefaultMatrix: boolean = false;\r\n\tprotected _faceInvert: boolean = false;\r\n\tprotected _frontFaceValue: number = 1;\r\n\r\n\t/** @internal */\r\n\t_parent: Transform3D | null = null;\r\n\t/**@internal */\r\n\t_transformFlag: number = 0;\r\n\r\n\r\n\t/**@internal */\r\n\tget isDefaultMatrix(): boolean {\r\n\t\tif (this._getTransformFlag(Transform3D.TRANSFORM_LOCALMATRIX)) {\r\n\t\t\tlet localMat = this.localMatrix;\r\n\t\t}\r\n\t\treturn this._isDefaultMatrix;\r\n\t}\r\n\t/**\r\n\t * @internal\r\n\t */\r\n\tget _isFrontFaceInvert(): boolean {\r\n\t\tif (this._getTransformFlag(Transform3D.TRANSFORM_WORLDSCALE)) {\r\n\t\t\tvar scale: Vector3 = this.getWorldLossyScale();\r\n\t\t\tvar isInvert: boolean = scale.x < 0;\r\n\t\t\t(scale.y < 0) && (isInvert = !isInvert);\r\n\t\t\t(scale.z < 0) && (isInvert = !isInvert);\r\n\t\t\tthis._faceInvert = isInvert;\r\n\t\t\tthis._frontFaceValue = this._faceInvert ? -1 : 1;\r\n\t\t}\r\n\t\treturn this._faceInvert;\r\n\t}\r\n\r\n\tgetFrontFaceValue(): number {\r\n\t\tif (this._getTransformFlag(Transform3D.TRANSFORM_WORLDSCALE)) {\r\n\t\t\tlet value = this._isFrontFaceInvert;\r\n\t\t}\r\n\t\treturn this._frontFaceValue;\r\n\t}\r\n\r\n\r\n\t/**\r\n\t * \r\n\t */\r\n\tget owner(): Sprite3D {\r\n\t\treturn this._owner;\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t */\r\n\tget worldNeedUpdate(): boolean {\r\n\t\treturn this._getTransformFlag(Transform3D.TRANSFORM_WORLDMATRIX);\r\n\t}\r\n\r\n\t/**\r\n\t * X\r\n\t */\r\n\tget localPositionX(): number {\r\n\t\treturn this._localPosition.x;\r\n\t}\r\n\r\n\tset localPositionX(x: number) {\r\n\t\tthis._localPosition.x = x;\r\n\t\tthis.localPosition = this._localPosition;\r\n\t}\r\n\r\n\t/**\r\n\t * Y\r\n\t */\r\n\tget localPositionY(): number {\r\n\t\treturn this._localPosition.y;\r\n\t}\r\n\r\n\tset localPositionY(y: number) {\r\n\t\tthis._localPosition.y = y;\r\n\t\tthis.localPosition = this._localPosition;\r\n\t}\r\n\r\n\t/**\r\n\t * Z\r\n\t */\r\n\tget localPositionZ(): number {\r\n\t\treturn this._localPosition.z;\r\n\t}\r\n\r\n\tset localPositionZ(z: number) {\r\n\t\tthis._localPosition.z = z;\r\n\t\tthis.localPosition = this._localPosition;\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t */\r\n\tget localPosition(): Vector3 {\r\n\t\treturn this._localPosition;\r\n\t}\r\n\r\n\tset localPosition(value: Vector3) {\r\n\t\tif (this._localPosition !== value)\r\n\t\t\tvalue.cloneTo(this._localPosition);\r\n\r\n\t\tthis._setTransformFlag(Transform3D.TRANSFORM_LOCALMATRIX, true);\r\n\t\tthis._onWorldPositionTransform();\r\n\t}\r\n\r\n\t/**\r\n\t * X\r\n\t */\r\n\tget localRotationX(): number {\r\n\t\treturn this.localRotation.x;\r\n\t}\r\n\r\n\tset localRotationX(x: number) {\r\n\t\tlet rot = this.localRotation;\r\n\t\trot.x = x;\r\n\t\tthis.localRotation = rot;\r\n\t}\r\n\r\n\t/**\r\n\t * Y\r\n\t */\r\n\tget localRotationY(): number {\r\n\t\treturn this.localRotation.y;\r\n\t}\r\n\r\n\tset localRotationY(y: number) {\r\n\t\tlet rot = this.localRotation;\r\n\t\trot.y = y;\r\n\t\tthis.localRotation = rot;\r\n\t}\r\n\r\n\t/**\r\n\t * Z\r\n\t */\r\n\tget localRotationZ(): number {\r\n\t\treturn this.localRotation.z;\r\n\t}\r\n\r\n\tset localRotationZ(z: number) {\r\n\t\tlet rot = this.localRotation;\r\n\t\trot.z = z;\r\n\t\tthis.localRotation = rot;\r\n\t}\r\n\r\n\t/**\r\n\t * W\r\n\t */\r\n\tget localRotationW(): number {\r\n\t\treturn this.localRotation.w;\r\n\t}\r\n\r\n\tset localRotationW(w: number) {\r\n\t\tlet rot = this.localRotation;\r\n\t\trot.w = w;\r\n\t\tthis.localRotation = rot;\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t */\r\n\tget localRotation(): Quaternion {\r\n\t\tif (this._getTransformFlag(Transform3D.TRANSFORM_LOCALQUATERNION)) {\r\n\t\t\tvar eulerE: Vector3 = this._localRotationEuler;\r\n\t\t\tQuaternion.createFromYawPitchRoll(eulerE.y / Transform3D._angleToRandin, eulerE.x / Transform3D._angleToRandin, eulerE.z / Transform3D._angleToRandin, this._localRotation);\r\n\t\t\tthis._setTransformFlag(Transform3D.TRANSFORM_LOCALQUATERNION, false);\r\n\t\t}\r\n\t\treturn this._localRotation;\r\n\t}\r\n\r\n\tset localRotation(value: Quaternion) {\r\n\t\tif (this._localRotation !== value)\r\n\t\t\tvalue.cloneTo(this._localRotation);\r\n\t\tthis._localRotation.normalize(this._localRotation);\r\n\t\tthis._setTransformFlag(Transform3D.TRANSFORM_LOCALEULER | Transform3D.TRANSFORM_LOCALMATRIX, true);\r\n\t\tthis._setTransformFlag(Transform3D.TRANSFORM_LOCALQUATERNION, false);\r\n\t\tthis._onWorldRotationTransform();\r\n\t}\r\n\r\n\t/**\r\n\t * X\r\n\t */\r\n\tget localScaleX(): number {\r\n\t\treturn this._localScale.x;\r\n\t}\r\n\r\n\tset localScaleX(value: number) {\r\n\t\tthis._localScale.x = value;\r\n\t\tthis.localScale = this._localScale;\r\n\t}\r\n\r\n\t/**\r\n\t * Y\r\n\t */\r\n\tget localScaleY(): number {\r\n\t\treturn this._localScale.y;\r\n\t}\r\n\r\n\tset localScaleY(value: number) {\r\n\t\tthis._localScale.y = value;\r\n\t\tthis.localScale = this._localScale;\r\n\t}\r\n\r\n\t/**\r\n\t * Z\r\n\t */\r\n\tget localScaleZ(): number {\r\n\t\treturn this._localScale.z;\r\n\t}\r\n\r\n\tset localScaleZ(value: number) {\r\n\t\tthis._localScale.z = value;\r\n\t\tthis.localScale = this._localScale;\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t */\r\n\tget localScale(): Vector3 {\r\n\t\treturn this._localScale;\r\n\t}\r\n\r\n\tset localScale(value: Vector3) {\r\n\t\tif (this._localScale !== value)\r\n\t\t\tvalue.cloneTo(this._localScale);\r\n\t\tthis._setTransformFlag(Transform3D.TRANSFORM_LOCALMATRIX, true);\r\n\t\tthis._onWorldScaleTransform();\r\n\t}\r\n\r\n\t/**\r\n\t * X\r\n\t */\r\n\tget localRotationEulerX(): number {\r\n\t\treturn this.localRotationEuler.x;\r\n\t}\r\n\r\n\tset localRotationEulerX(value: number) {\r\n\t\tlet rot = this.localRotationEuler;\r\n\t\trot.x = value;\r\n\t\tthis.localRotationEuler = rot;\r\n\t}\r\n\r\n\t/**\r\n\t * Y\r\n\t */\r\n\tget localRotationEulerY(): number {\r\n\t\treturn this.localRotationEuler.y;\r\n\t}\r\n\r\n\tset localRotationEulerY(value: number) {\r\n\t\tlet rot = this.localRotationEuler;\r\n\t\trot.y = value;\r\n\t\tthis.localRotationEuler = rot;\r\n\t}\r\n\r\n\t/**\r\n\t * Z\r\n\t */\r\n\tget localRotationEulerZ(): number {\r\n\t\treturn this.localRotationEuler.z;\r\n\t}\r\n\r\n\tset localRotationEulerZ(value: number) {\r\n\t\tlet rot = this.localRotationEuler;\r\n\t\trot.z = value;\r\n\t\tthis.localRotationEuler = rot;\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t */\r\n\tget localRotationEuler(): Vector3 {\r\n\t\tif (this._getTransformFlag(Transform3D.TRANSFORM_LOCALEULER)) {\r\n\t\t\tthis._localRotation.getYawPitchRoll(Transform3D._tempVector30);\r\n\t\t\tvar euler: Vector3 = Transform3D._tempVector30;\r\n\t\t\tvar localRotationEuler: Vector3 = this._localRotationEuler;\r\n\t\t\tlocalRotationEuler.x = euler.y * Transform3D._angleToRandin;\r\n\t\t\tlocalRotationEuler.y = euler.x * Transform3D._angleToRandin;\r\n\t\t\tlocalRotationEuler.z = euler.z * Transform3D._angleToRandin;\r\n\t\t\tthis._setTransformFlag(Transform3D.TRANSFORM_LOCALEULER, false);\r\n\t\t}\r\n\t\treturn this._localRotationEuler;\r\n\t}\r\n\r\n\tset localRotationEuler(value: Vector3) {\r\n\t\tif (this._localRotationEuler !== value)\r\n\t\t\tvalue.cloneTo(this._localRotationEuler);\r\n\t\tthis._setTransformFlag(Transform3D.TRANSFORM_LOCALEULER, false);\r\n\t\tthis._setTransformFlag(Transform3D.TRANSFORM_LOCALQUATERNION | Transform3D.TRANSFORM_LOCALMATRIX, true);\r\n\t\tthis._onWorldRotationTransform();\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t */\r\n\tget localMatrix(): Matrix4x4 {\r\n\t\tif (this._getTransformFlag(Transform3D.TRANSFORM_LOCALMATRIX)) {\r\n\t\t\tMatrix4x4.createAffineTransformation(this._localPosition, this.localRotation, this._localScale, this._localMatrix);\r\n\t\t\tthis._isDefaultMatrix = this._localMatrix.isIdentity();\r\n\t\t\tthis._setTransformFlag(Transform3D.TRANSFORM_LOCALMATRIX, false);\r\n\t\t}\r\n\t\treturn this._localMatrix;\r\n\t}\r\n\r\n\tset localMatrix(value: Matrix4x4) {\r\n\t\tif (this._localMatrix !== value)\r\n\t\t\tvalue.cloneTo(this._localMatrix);\r\n\t\tthis._isDefaultMatrix = this._localMatrix.isIdentity();\r\n\t\tthis._localMatrix.decomposeTransRotScale(this._localPosition, this._localRotation, this._localScale);\r\n\t\tthis._setTransformFlag(Transform3D.TRANSFORM_LOCALEULER, true);\r\n\t\tthis._setTransformFlag(Transform3D.TRANSFORM_LOCALMATRIX, false);\r\n\t\tthis._onWorldTransform();\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t */\r\n\tget position(): Vector3 {\r\n\t\tif (this._getTransformFlag(Transform3D.TRANSFORM_WORLDPOSITION)) {\r\n\t\t\tif (this._parent != null) {\r\n\t\t\t\tvar worldMatE = this.worldMatrix.elements;\r\n\t\t\t\tthis._position.x = worldMatE[12];\r\n\t\t\t\tthis._position.y = worldMatE[13];\r\n\t\t\t\tthis._position.z = worldMatE[14];\r\n\t\t\t} else {\r\n\t\t\t\tthis._localPosition.cloneTo(this._position);\r\n\t\t\t}\r\n\t\t\tthis._setTransformFlag(Transform3D.TRANSFORM_WORLDPOSITION, false);\r\n\t\t}\r\n\t\treturn this._position;\r\n\t}\r\n\r\n\tset position(value: Vector3) {\r\n\t\tif (this._parent != null) {\r\n\t\t\tvar parentInvMat: Matrix4x4 = Transform3D._tempMatrix0;\r\n\t\t\tthis._parent.worldMatrix.invert(parentInvMat);\r\n\t\t\tVector3.transformCoordinate(value, parentInvMat, this._localPosition);\r\n\t\t}\r\n\t\telse {\r\n\t\t\tvalue.cloneTo(this._localPosition);\r\n\t\t}\r\n\t\tthis.localPosition = this._localPosition;\r\n\t\tif (this._position !== value)\r\n\t\t\tvalue.cloneTo(this._position);\r\n\t\tthis._setTransformFlag(Transform3D.TRANSFORM_WORLDPOSITION, false);\r\n\t}\r\n\r\n\r\n\r\n\t/**\r\n\t * \r\n\t */\r\n\tget rotation(): Quaternion {\r\n\t\tif (this._getTransformFlag(Transform3D.TRANSFORM_WORLDQUATERNION)) {\r\n\t\t\tif (this._parent != null)\r\n\t\t\t\tQuaternion.multiply(this._parent.rotation, this.localRotation, this._rotation);//localRotation_localRotation,\r\n\t\t\telse\r\n\t\t\t\tthis.localRotation.cloneTo(this._rotation);\r\n\t\t\tthis._setTransformFlag(Transform3D.TRANSFORM_WORLDQUATERNION, false);\r\n\t\t}\r\n\t\treturn this._rotation;\r\n\t}\r\n\r\n\tset rotation(value: Quaternion) {\r\n\t\tif (this._parent != null) {\r\n\t\t\tthis._parent.rotation.invert(Transform3D._tempQuaternion0);\r\n\t\t\tQuaternion.multiply(Transform3D._tempQuaternion0, value, this._localRotation);\r\n\t\t} else {\r\n\t\t\tvalue.cloneTo(this._localRotation);\r\n\t\t}\r\n\t\tthis.localRotation = this._localRotation;\r\n\t\tif (value !== this._rotation)\r\n\t\t\tvalue.cloneTo(this._rotation);\r\n\r\n\t\tthis._setTransformFlag(Transform3D.TRANSFORM_WORLDQUATERNION, false);\r\n\t}\r\n\r\n\r\n\t/**\r\n\t * xyz\r\n\t */\r\n\tget rotationEuler(): Vector3 {\r\n\t\tif (this._getTransformFlag(Transform3D.TRANSFORM_WORLDEULER)) {\r\n\t\t\tthis.rotation.getYawPitchRoll(Transform3D._tempVector30);//rotation,\r\n\t\t\tvar eulerE: Vector3 = Transform3D._tempVector30;\r\n\t\t\tvar rotationEulerE: Vector3 = this._rotationEuler;\r\n\t\t\trotationEulerE.x = eulerE.y * Transform3D._angleToRandin;\r\n\t\t\trotationEulerE.y = eulerE.x * Transform3D._angleToRandin;\r\n\t\t\trotationEulerE.z = eulerE.z * Transform3D._angleToRandin;\r\n\t\t\tthis._setTransformFlag(Transform3D.TRANSFORM_WORLDEULER, false);\r\n\t\t}\r\n\t\treturn this._rotationEuler;\r\n\t}\r\n\r\n\tset rotationEuler(value: Vector3) {\r\n\t\tQuaternion.createFromYawPitchRoll(value.y / Transform3D._angleToRandin, value.x / Transform3D._angleToRandin, value.z / Transform3D._angleToRandin, this._rotation);\r\n\t\tthis.rotation = this._rotation;\r\n\t\tif (this._rotationEuler !== value)\r\n\t\t\tvalue.cloneTo(this._rotationEuler);\r\n\r\n\t\tthis._setTransformFlag(Transform3D.TRANSFORM_WORLDEULER, false);\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t */\r\n\tget worldMatrix(): Matrix4x4 {\r\n\t\tif (this._getTransformFlag(Transform3D.TRANSFORM_WORLDMATRIX)) {\r\n\t\t\tif (this._parent != null) {\r\n\t\t\t\t//\r\n\t\t\t\tlet effectiveTrans = this._parent;\r\n\r\n\t\t\t\twhile (effectiveTrans._parent && effectiveTrans.isDefaultMatrix) {\r\n\t\t\t\t\teffectiveTrans = effectiveTrans._parent;\r\n\t\t\t\t}\r\n\t\t\t\tMatrix4x4.multiply(effectiveTrans.worldMatrix, this.localMatrix, this._worldMatrix);\r\n\t\t\t}\r\n\t\t\telse\r\n\t\t\t\tthis.localMatrix.cloneTo(this._worldMatrix);\r\n\r\n\t\t\tthis._setTransformFlag(Transform3D.TRANSFORM_WORLDMATRIX, false);\r\n\t\t}\r\n\t\treturn this._worldMatrix;\r\n\t}\r\n\r\n\tset worldMatrix(value: Matrix4x4) {\r\n\t\tif (this._parent === null) {\r\n\t\t\tvalue.cloneTo(this._localMatrix);\r\n\t\t} else {\r\n\t\t\tthis._parent.worldMatrix.invert(this._localMatrix);\r\n\t\t\tMatrix4x4.multiply(this._localMatrix, value, this._localMatrix);\r\n\t\t}\r\n\t\tthis.localMatrix = this._localMatrix;\r\n\t\tif (this._worldMatrix !== value)\r\n\t\t\tvalue.cloneTo(this._worldMatrix);\r\n\r\n\t\tthis._setTransformFlag(Transform3D.TRANSFORM_WORLDMATRIX, false);\r\n\t}\r\n\r\n\t/**\r\n\t *  <code>Transform3D</code> \r\n\t * @internal\r\n\t * @param owner \r\n\t */\r\n\tconstructor(owner: Sprite3D) {\r\n\t\tsuper();\r\n\t\tthis._owner = owner;\r\n\t\tthis._children = [];\r\n\t\tthis._setTransformFlag(Transform3D.TRANSFORM_LOCALQUATERNION | Transform3D.TRANSFORM_LOCALEULER | Transform3D.TRANSFORM_LOCALMATRIX, false);\r\n\t\tthis._setTransformFlag(Transform3D.TRANSFORM_WORLDPOSITION | Transform3D.TRANSFORM_WORLDQUATERNION | Transform3D.TRANSFORM_WORLDEULER | Transform3D.TRANSFORM_WORLDSCALE | Transform3D.TRANSFORM_WORLDMATRIX, true);\r\n\t}\r\n\r\n\t/**\r\n\t * @internal\r\n\t */\r\n\t_getScaleMatrix(): Matrix3x3 {\r\n\t\tvar invRotation: Quaternion = Transform3D._tempQuaternion0;\r\n\t\tvar invRotationMat: Matrix3x3 = Transform3D._tempMatrix3x30;\r\n\t\tvar worldRotScaMat: Matrix3x3 = Transform3D._tempMatrix3x31;\r\n\t\tvar scaMat: Matrix3x3 = Transform3D._tempMatrix3x32;\r\n\t\tMatrix3x3.createFromMatrix4x4(this.worldMatrix, worldRotScaMat)\r\n\t\tthis.rotation.invert(invRotation);\r\n\t\tMatrix3x3.createRotationQuaternion(invRotation, invRotationMat);\r\n\t\tMatrix3x3.multiply(invRotationMat, worldRotScaMat, scaMat);\r\n\t\treturn scaMat;\r\n\t}\r\n\r\n\t/**\r\n\t * @internal\r\n\t */\r\n\t_setTransformFlag(type: number, value: boolean): void {\r\n\t\tif (value)\r\n\t\t\tthis._transformFlag |= type;\r\n\t\telse\r\n\t\t\tthis._transformFlag &= ~type;\r\n\t}\r\n\r\n\t/**\r\n\t * @internal\r\n\t */\r\n\t_getTransformFlag(type: number): boolean {\r\n\t\treturn (this._transformFlag & type) != 0;\r\n\t}\r\n\r\n\t/**\r\n\t * @internal\r\n\t */\r\n\t_setParent(value: Transform3D): void {\r\n\t\tif (this._parent !== value) {\r\n\t\t\tif (this._parent) {\r\n\t\t\t\tvar parentChilds: Transform3D[] = this._parent._children!;\r\n\t\t\t\tvar index: number = parentChilds.indexOf(this);\r\n\t\t\t\tparentChilds.splice(index, 1);\r\n\t\t\t}\r\n\t\t\tif (value) {\r\n\t\t\t\tvalue._children!.push(this);\r\n\t\t\t\t(value) && (this._onWorldTransform());\r\n\t\t\t}\r\n\t\t\tthis._parent = value;\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @internal\r\n\t */\r\n\t_onWorldPositionRotationTransform(): void {\r\n\t\tif (!this._getTransformFlag(Transform3D.TRANSFORM_WORLDMATRIX) || !this._getTransformFlag(Transform3D.TRANSFORM_WORLDPOSITION) || !this._getTransformFlag(Transform3D.TRANSFORM_WORLDQUATERNION) || !this._getTransformFlag(Transform3D.TRANSFORM_WORLDEULER)) {\r\n\t\t\tthis._setTransformFlag(Transform3D.TRANSFORM_WORLDMATRIX | Transform3D.TRANSFORM_WORLDPOSITION | Transform3D.TRANSFORM_WORLDQUATERNION | Transform3D.TRANSFORM_WORLDEULER, true);\r\n\t\t\tthis.event(Event.TRANSFORM_CHANGED, this._transformFlag);\r\n\t\t}\r\n\t\tfor (var i: number = 0, n: number = this._children!.length; i < n; i++)\r\n\t\t\tthis._children![i]._onWorldPositionRotationTransform();\r\n\t}\r\n\r\n\t/**\r\n\t * @internal\r\n\t */\r\n\t_onWorldPositionScaleTransform(): void {\r\n\t\tif (!this._getTransformFlag(Transform3D.TRANSFORM_WORLDMATRIX) || !this._getTransformFlag(Transform3D.TRANSFORM_WORLDPOSITION) || !this._getTransformFlag(Transform3D.TRANSFORM_WORLDSCALE)) {\r\n\t\t\tthis._setTransformFlag(Transform3D.TRANSFORM_WORLDMATRIX | Transform3D.TRANSFORM_WORLDPOSITION | Transform3D.TRANSFORM_WORLDSCALE, true);\r\n\t\t\tthis.event(Event.TRANSFORM_CHANGED, this._transformFlag);\r\n\t\t}\r\n\t\tfor (var i: number = 0, n: number = this._children!.length; i < n; i++)\r\n\t\t\tthis._children![i]._onWorldPositionScaleTransform();\r\n\t}\r\n\r\n\t/**\r\n\t * @internal\r\n\t */\r\n\t_onWorldPositionTransform(): void {\r\n\t\tif (!this._getTransformFlag(Transform3D.TRANSFORM_WORLDMATRIX) || !this._getTransformFlag(Transform3D.TRANSFORM_WORLDPOSITION)) {\r\n\t\t\tthis._setTransformFlag(Transform3D.TRANSFORM_WORLDMATRIX | Transform3D.TRANSFORM_WORLDPOSITION, true);\r\n\t\t\tthis.event(Event.TRANSFORM_CHANGED, this._transformFlag);\r\n\t\t}\r\n\t\tfor (var i: number = 0, n: number = this._children!.length; i < n; i++)\r\n\t\t\tthis._children![i]._onWorldPositionTransform();\r\n\t}\r\n\r\n\t/**\r\n\t * @internal\r\n\t */\r\n\tprotected _onWorldRotationTransform(): void {\r\n\t\tif (!this._getTransformFlag(Transform3D.TRANSFORM_WORLDMATRIX) || !this._getTransformFlag(Transform3D.TRANSFORM_WORLDQUATERNION) || !this._getTransformFlag(Transform3D.TRANSFORM_WORLDEULER)) {\r\n\t\t\tthis._setTransformFlag(Transform3D.TRANSFORM_WORLDMATRIX | Transform3D.TRANSFORM_WORLDQUATERNION | Transform3D.TRANSFORM_WORLDEULER, true);\r\n\t\t\tthis.event(Event.TRANSFORM_CHANGED, this._transformFlag);\r\n\t\t}\r\n\t\tfor (var i: number = 0, n: number = this._children!.length; i < n; i++)\r\n\t\t\tthis._children![i]._onWorldPositionRotationTransform();//\r\n\t}\r\n\r\n\t/**\r\n\t * @internal\r\n\t */\r\n\t_onWorldScaleTransform(): void {\r\n\t\tif (!this._getTransformFlag(Transform3D.TRANSFORM_WORLDMATRIX) || !this._getTransformFlag(Transform3D.TRANSFORM_WORLDSCALE)) {\r\n\t\t\tthis._setTransformFlag(Transform3D.TRANSFORM_WORLDMATRIX | Transform3D.TRANSFORM_WORLDSCALE, true);\r\n\t\t\tthis.event(Event.TRANSFORM_CHANGED, this._transformFlag);\r\n\t\t}\r\n\t\tfor (var i: number = 0, n: number = this._children!.length; i < n; i++)\r\n\t\t\tthis._children![i]._onWorldPositionScaleTransform();//\r\n\t}\r\n\r\n\t/**\r\n\t * @internal\r\n\t */\r\n\t_onWorldTransform(): void {\r\n\t\tif (!this._getTransformFlag(Transform3D.TRANSFORM_WORLDMATRIX) || !this._getTransformFlag(Transform3D.TRANSFORM_WORLDPOSITION) || !this._getTransformFlag(Transform3D.TRANSFORM_WORLDQUATERNION) || !this._getTransformFlag(Transform3D.TRANSFORM_WORLDEULER) || !this._getTransformFlag(Transform3D.TRANSFORM_WORLDSCALE)) {\r\n\t\t\tthis._setTransformFlag(Transform3D.TRANSFORM_WORLDMATRIX | Transform3D.TRANSFORM_WORLDPOSITION | Transform3D.TRANSFORM_WORLDQUATERNION | Transform3D.TRANSFORM_WORLDEULER | Transform3D.TRANSFORM_WORLDSCALE, true);\r\n\t\t\tthis.event(Event.TRANSFORM_CHANGED, this._transformFlag);\r\n\t\t}\r\n\t\tfor (var i: number = 0, n: number = this._children!.length; i < n; i++)\r\n\t\t\tthis._children![i]._onWorldTransform();\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t * @param \ttranslation \r\n\t * @param \tisLocal \r\n\t */\r\n\ttranslate(translation: Vector3, isLocal: boolean = true): void {\r\n\t\tif (isLocal) {\r\n\t\t\tMatrix4x4.createFromQuaternion(this.localRotation, Transform3D._tempMatrix0);\r\n\t\t\tVector3.transformCoordinate(translation, Transform3D._tempMatrix0, Transform3D._tempVector30);\r\n\t\t\tVector3.add(this.localPosition, Transform3D._tempVector30, this._localPosition);\r\n\t\t\tthis.localPosition = this._localPosition;\r\n\t\t} else {\r\n\t\t\tVector3.add(this.position, translation, this._position);\r\n\t\t\tthis.position = this._position;\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t * @param \trotations \r\n\t * @param \tisLocal \r\n\t * @param \tisRadian \r\n\t */\r\n\trotate(rotation: Vector3, isLocal: boolean = true, isRadian: boolean = true): void {\r\n\t\tvar rot: Vector3;\r\n\t\tif (isRadian) {\r\n\t\t\trot = rotation;\r\n\t\t} else {\r\n\t\t\tVector3.scale(rotation, Math.PI / 180.0, Transform3D._tempVector30);\r\n\t\t\trot = Transform3D._tempVector30;\r\n\t\t}\r\n\r\n\t\tQuaternion.createFromYawPitchRoll(rot.y, rot.x, rot.z, Transform3D._tempQuaternion0);\r\n\t\tif (isLocal) {\r\n\t\t\tQuaternion.multiply(this._localRotation, Transform3D._tempQuaternion0, this._localRotation);\r\n\t\t\tthis.localRotation = this._localRotation;\r\n\t\t} else {\r\n\t\t\tQuaternion.multiply(Transform3D._tempQuaternion0, this.rotation, this._rotation);\r\n\t\t\tthis.rotation = this._rotation;\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t * @param forward \r\n\t */\r\n\tgetForward(forward: Vector3): void {\r\n\t\tvar worldMatElem: Float32Array = this.worldMatrix.elements;\r\n\t\tforward.x = -worldMatElem[8];\r\n\t\tforward.y = -worldMatElem[9];\r\n\t\tforward.z = -worldMatElem[10];\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t * @param up \r\n\t */\r\n\tgetUp(up: Vector3): void {\r\n\t\tvar worldMatElem: Float32Array = this.worldMatrix.elements;\r\n\t\tup.x = worldMatElem[4];\r\n\t\tup.y = worldMatElem[5];\r\n\t\tup.z = worldMatElem[6];\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t * @param \r\n\t */\r\n\tgetRight(right: Vector3): void {\r\n\t\tvar worldMatElem: Float32Array = this.worldMatrix.elements;\r\n\t\tright.x = worldMatElem[0];\r\n\t\tright.y = worldMatElem[1];\r\n\t\tright.z = worldMatElem[2];\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t * @param\ttarget \r\n\t * @param\tup \r\n\t * @param\tisLocal \r\n\t */\r\n\tlookAt(target: Vector3, up: Vector3, isLocal: boolean = false, isCamera: boolean = true): void {\r\n\t\tvar eye: Vector3;\r\n\t\tif (isLocal) {\r\n\t\t\teye = this._localPosition;\r\n\t\t\tif (Math.abs(eye.x - target.x) < MathUtils3D.zeroTolerance && Math.abs(eye.y - target.y) < MathUtils3D.zeroTolerance && Math.abs(eye.z - target.z) < MathUtils3D.zeroTolerance)\r\n\t\t\t\treturn;\r\n\t\t\tif (isCamera) {\r\n\t\t\t\tQuaternion.lookAt(this._localPosition, target, up, this._localRotation);\r\n\t\t\t\tthis._localRotation.invert(this._localRotation);\r\n\t\t\t} else {\r\n\t\t\t\tVector3.subtract(this.localPosition, target, Transform3D._tempVector30);\r\n\t\t\t\tQuaternion.rotationLookAt(Transform3D._tempVector30, up, this.localRotation);\r\n\t\t\t\tthis._localRotation.invert(this._localRotation);\r\n\t\t\t}\r\n\r\n\t\t\tthis.localRotation = this._localRotation;\r\n\t\t} else {\r\n\t\t\tvar worldPosition: Vector3 = this.position;\r\n\t\t\teye = worldPosition;\r\n\t\t\tif (Math.abs(eye.x - target.x) < MathUtils3D.zeroTolerance && Math.abs(eye.y - target.y) < MathUtils3D.zeroTolerance && Math.abs(eye.z - target.z) < MathUtils3D.zeroTolerance)\r\n\t\t\t\treturn;\r\n\t\t\tif (isCamera) {\r\n\t\t\t\tQuaternion.lookAt(worldPosition, target, up, this._rotation);\r\n\t\t\t\tthis._rotation.invert(this._rotation);\r\n\t\t\t} else {\r\n\t\t\t\tVector3.subtract(this.position, target, Transform3D._tempVector30);\r\n\t\t\t\tQuaternion.rotationLookAt(Transform3D._tempVector30, up, this._rotation);\r\n\t\t\t\tthis._rotation.invert(this._rotation);\r\n\t\t\t}\r\n\t\t\tthis.rotation = this._rotation;\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t * @param target \r\n\t * @param up \r\n\t * @param isLocal \r\n\t */\r\n\tobjLookat(target: Vector3, up: Vector3, isLocal: boolean = false): void {\r\n\r\n\t}\r\n\r\n\r\n\r\n\t/**\r\n\t * \r\n\t * Vector3,Matrix3x3\r\n\t * @return\t\r\n\t */\r\n\tgetWorldLossyScale(): Vector3 {\r\n\t\tif (this._getTransformFlag(Transform3D.TRANSFORM_WORLDSCALE)) {\r\n\t\t\tif (this._parent !== null) {\r\n\t\t\t\tvar scaMatE = this._getScaleMatrix().elements;\r\n\t\t\t\tthis._scale.x = scaMatE[0];\r\n\t\t\t\tthis._scale.y = scaMatE[4];\r\n\t\t\t\tthis._scale.z = scaMatE[8];\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tthis._localScale.cloneTo(this._scale);\r\n\t\t\t}\r\n\t\t\tthis._setTransformFlag(Transform3D.TRANSFORM_WORLDSCALE, false);\r\n\t\t}\r\n\t\treturn this._scale;\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t * Vector3,Matrix3x3\r\n\t * @return\t\r\n\t */\r\n\tsetWorldLossyScale(value: Vector3) {\r\n\t\tif (this._parent !== null) {\r\n\t\t\tvar scaleMat: Matrix3x3 = Transform3D._tempMatrix3x33;\r\n\t\t\tvar localScaleMat: Matrix3x3 = Transform3D._tempMatrix3x33;\r\n\t\t\tvar localScaleMatE: Float32Array = localScaleMat.elements;\r\n\t\t\tvar parInvScaleMat: Matrix3x3 = this._parent._getScaleMatrix();\r\n\t\t\tparInvScaleMat.invert(parInvScaleMat);\r\n\t\t\tMatrix3x3.createFromScaling(value, scaleMat);\r\n\t\t\tMatrix3x3.multiply(parInvScaleMat, scaleMat, localScaleMat);\r\n\t\t\tthis._localScale.x = localScaleMatE[0];\r\n\t\t\tthis._localScale.y = localScaleMatE[4];\r\n\t\t\tthis._localScale.z = localScaleMatE[8];\r\n\t\t} else {\r\n\t\t\tvalue.cloneTo(this._localScale);\r\n\t\t}\r\n\t\tthis.localScale = this._localScale;\r\n\t\tif (this._scale !== value)\r\n\t\t\tvalue.cloneTo(this._scale);\r\n\t\tthis._setTransformFlag(Transform3D.TRANSFORM_WORLDSCALE, false);\r\n\t}\r\n\r\n\t//----------------------------------------Discard-------------------------------------------------\r\n\t/**\r\n\t * @deprecated\r\n\t */\r\n\tget scale(): Vector3 {\r\n\t\tconsole.warn(\"Transfrm3D: discard function,please use getWorldLossyScale instead.\");\r\n\t\treturn this.getWorldLossyScale();\r\n\t}\r\n\r\n\t/**\r\n\t * @deprecated\r\n\t */\r\n\tset scale(value: Vector3) {\r\n\t\tconsole.warn(\"Transfrm3D: discard function,please use setWorldLossyScale instead.\");\r\n\t\tthis.setWorldLossyScale(value);\r\n\t}\r\n\r\n\tlocalToGlobal(value: Vector3, out: Vector3): void {\r\n\t\tVector3.transformV3ToV3(value, this.worldMatrix, out);\r\n\t}\r\n\r\n\t/**\r\n\t *\r\n\t\t* @param pos\r\n\t\t* @param out\r\n\t\t* \r\n\t\t*/\r\n\tglobalToLocal(pos: Vector3, out: Vector3): void {\r\n\t\tthis.worldMatrix.invert(Transform3D._tempMatrix0);\r\n\t\tVector3.transformV3ToV3(pos, Transform3D._tempMatrix0, out);\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t * @param pos\r\n\t * @param out\r\n\t * \r\n\t */\r\n\ttoLocalNormal(pos: Vector3, out: Vector3): void {\r\n\t\tthis.worldMatrix.invert(Transform3D._tempMatrix0);\r\n\t\tVector3.TransformNormal(pos, Transform3D._tempMatrix0, out);\r\n\t}\r\n\r\n\ttoDir(forward: Vector3, dir: Vector3) {\r\n\t\t//TODO \r\n\t\tvar wmat: Matrix4x4 = this.worldMatrix;\r\n\t\t//var newForward:Vector3 = new Vector3();\r\n\t\t//var newRot:Quaternion = new Quaternion();\r\n\r\n\t\t//Vector3.TransformNormal(forward,wmat,newForward);\r\n\t\t//Vector3.normalize(newForward,newForward);\r\n\t\t//rotationTo(newRot,newForward,dir);\r\n\t\tthis.rotationTo(this.rotation, forward, dir);\r\n\t\t//Quaternion.multiply(rotation,newRot,rotation)\r\n\t\t//DEBUG\r\n\t\t//Quaternion.createFromAxisAngle(new Vector3(0,1,0),75*Math.PI/180,newRot)\r\n\t\t//DEBUG\r\n\t\tthis.rotation = this.rotation;\r\n\t}\r\n\r\n\tstatic tmpVec3: Vector3 = new Vector3();\r\n\t/**\r\n\t *  glmatrix\r\n\t * a,b\r\n\t * Sets a quaternion to represent the shortest rotation from one\r\n\t * vector to another.\r\n\t *\r\n\t * Both vectors are assumed to be unit length.\r\n\t *\r\n\t * @param {quat} out the receiving quaternion.\r\n\t * @param {vec3} a the initial vector\r\n\t * @param {vec3} b the destination vector\r\n\t * @returns {quat} out\r\n\t */\r\n\trotationTo(out: Quaternion, a: Vector3, b: Vector3): boolean {\r\n\t\tvar dot: number = Vector3.dot(a, b);\r\n\t\tVector3.Up\r\n\t\tif (dot < -0.999999) {// 180\r\n\t\t\tVector3.cross(Vector3.UnitX, a, Transform3D.tmpVec3);\r\n\t\t\tif (Vector3.scalarLength(Transform3D.tmpVec3) < 0.000001)\r\n\t\t\t\tVector3.cross(Vector3.UnitY, a, Transform3D.tmpVec3);\r\n\t\t\tVector3.normalize(Transform3D.tmpVec3, Transform3D.tmpVec3);\r\n\t\t\tQuaternion.createFromAxisAngle(Transform3D.tmpVec3, Math.PI, out);\r\n\t\t\treturn true\r\n\t\t} else if (dot > 0.999999) {// \r\n\t\t\tout.x = 0;\r\n\t\t\tout.y = 0;\r\n\t\t\tout.z = 0;\r\n\t\t\tout.w = 1;\r\n\t\t\treturn false;\r\n\t\t} else {\r\n\t\t\t// cos(a/2)=((1+dot)/2), cos(a/2)sin(a/2)=sin(a)/2 \r\n\t\t\tVector3.cross(a, b, Transform3D.tmpVec3);\r\n\t\t\tout.x = Transform3D.tmpVec3.x;\r\n\t\t\tout.y = Transform3D.tmpVec3.y;\r\n\t\t\tout.z = Transform3D.tmpVec3.z;\r\n\t\t\tout.w = 1 + dot;\r\n\t\t\tout.normalize(out);\r\n\t\t\treturn true;\r\n\t\t}\r\n\t\treturn false;\r\n\t}\r\n\r\n}\r\n\r\n\r\n","import { ShaderDefine } from \"../../RenderEngine/RenderShader/ShaderDefine\";\r\n\r\nexport class SkinnedMeshSprite3DShaderDeclaration {\r\n\t/**,*/\r\n\tstatic SHADERDEFINE_BONE: ShaderDefine;\r\n\tstatic SHADERDEFINE_SIMPLEBONE:ShaderDefine;\r\n}","import { IRenderContext3D } from \"../../../RenderEngine/RenderInterface/RenderPipelineInterface/IRenderContext3D\";\r\nimport { Laya3DRender } from \"../../RenderObjs/Laya3DRender\";\r\nimport { SkinRenderElementOBJ } from \"../../RenderObjs/RenderObj/SkinRenderElementOBJ\";\r\nimport { SkinnedMeshRenderer } from \"../SkinnedMeshRenderer\";\r\nimport { RenderElement } from \"./RenderElement\"\r\n/**\r\n * @internal\r\n */\r\nexport class SkinRenderElement extends RenderElement{\r\n\t/**\r\n\t * \r\n\t */\r\n\t_renderElementOBJ:SkinRenderElementOBJ;\r\n\r\n\r\n    /**@internal */\r\n\tset render(value:SkinnedMeshRenderer){\r\n\t\tthis._baseRender = value;\r\n\t\tthis._renderElementOBJ._renderShaderData = value._shaderValues;\r\n\t}\r\n\r\n    get render():SkinnedMeshRenderer{\r\n\t\treturn this._baseRender as SkinnedMeshRenderer;\r\n\t}\r\n\r\n    setSkinData(value:Float32Array[]){\r\n        this._renderElementOBJ.skinnedData = value;\r\n    }\r\n\r\n    constructor(){\r\n        super();\r\n    }\r\n\r\n    protected _createRenderElementOBJ(){\r\n\t\tthis._renderElementOBJ = Laya3DRender.renderOBJCreate.createSkinRenderElement() as SkinRenderElementOBJ;\r\n\t}\r\n\r\n    _render(context:IRenderContext3D): void {\r\n\t\tthis._renderElementOBJ._render(context);\r\n    }\r\n}","import { Event } from \"../../events/Event\";\r\nimport { Stat } from \"../../utils/Stat\";\r\nimport { Mesh, skinnedMatrixCache } from \"../resource/models/Mesh\";\r\nimport { SubMesh } from \"../resource/models/SubMesh\";\r\nimport { Utils3D } from \"../utils/Utils3D\";\r\nimport { MeshRenderer } from \"./MeshRenderer\";\r\nimport { Sprite3D } from \"./Sprite3D\";\r\nimport { Transform3D } from \"./Transform3D\";\r\nimport { RenderContext3D } from \"./render/RenderContext3D\";\r\nimport { SkinnedMeshSprite3DShaderDeclaration } from \"./SkinnedMeshSprite3DShaderDeclaration\";\r\nimport { Component } from \"../../components/Component\";\r\nimport { SkinRenderElement } from \"./render/SkinRenderElement\";\r\nimport { Material } from \"../../resource/Material\";\r\nimport { BlinnPhongMaterial } from \"./material/BlinnPhongMaterial\";\r\nimport { Scene3D } from \"./scene/Scene3D\";\r\nimport { Bounds } from \"../math/Bounds\";\r\nimport { Matrix4x4 } from \"../../maths/Matrix4x4\";\r\nimport { Vector3 } from \"../../maths/Vector3\";\r\nimport { BoundFrustum } from \"../math/BoundFrustum\";\r\n/**\r\n * <code>SkinMeshRenderer</code> \r\n */\r\nexport class SkinnedMeshRenderer extends MeshRenderer {\r\n\r\n    /**@internal */\r\n    protected _cacheMesh: Mesh;\r\n\r\n    _bones: Sprite3D[] = [];\r\n\r\n    /**@internal */\r\n    _renderElements: SkinRenderElement[];\r\n    /** @internal */\r\n    _skinnedData: any[];\r\n    /** @internal */\r\n    private _skinnedDataLoopMarks: Uint32Array;\r\n    /**@internal */\r\n    protected _localBounds: Bounds;\r\n    // /**@internal */\r\n    // protected _cacheAnimator: Animator;\r\n    /**@internal */\r\n    protected _cacheRootBone: Sprite3D;\r\n\r\n    /**@internal */\r\n    protected _inverseBindPosesBufferForNative: Float32Array = null;\r\n\r\n    /**@internal */\r\n    protected _skinnedMatrixCachesBufferForNative: Int32Array = null;\r\n    /**@internal */\r\n    protected _bonesTransformForNative: Transform3D[] = null;\r\n    /**\r\n     * \r\n     */\r\n    get localBounds(): Bounds {\r\n        return this._localBounds;\r\n    }\r\n\r\n    set localBounds(value: Bounds) {\r\n        this._localBounds = value;\r\n        this.geometryBounds = this._localBounds;\r\n    }\r\n\r\n    /**\r\n     * \r\n     */\r\n    get rootBone(): Sprite3D {\r\n        return this._cacheRootBone;\r\n    }\r\n\r\n    set rootBone(value: Sprite3D) {\r\n        if (this._cacheRootBone != value) {\r\n            if (this._cacheRootBone)\r\n                this._cacheRootBone.transform.off(Event.TRANSFORM_CHANGED, this, this._onWorldMatNeedChange);\r\n            else\r\n                (this.owner as Sprite3D).transform.off(Event.TRANSFORM_CHANGED, this, this._onWorldMatNeedChange);\r\n\r\n            if (value)\r\n                value.transform.on(Event.TRANSFORM_CHANGED, this, this._onWorldMatNeedChange);\r\n            else\r\n                (this.owner as Sprite3D).transform.on(Event.TRANSFORM_CHANGED, this, this._onWorldMatNeedChange);\r\n\r\n            this._cacheRootBone = value;\r\n            this._onWorldMatNeedChange(Transform3D.TRANSFORM_WORLDPOSITION | Transform3D.TRANSFORM_WORLDQUATERNION | Transform3D.TRANSFORM_WORLDSCALE);\r\n\r\n            let count = this._renderElements.length;\r\n            for (var i: number = 0; i < count; i++) {\r\n                var renderElement: SkinRenderElement = this._renderElements[i];\r\n                renderElement.setTransform(value.transform);\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * \r\n     */\r\n    get bones(): Sprite3D[] {\r\n        return this._bones;\r\n    }\r\n\r\n    /**\r\n     *  <code>SkinnedMeshRender</code> \r\n     */\r\n    constructor() {\r\n        super();\r\n        this._localBounds = new Bounds(Vector3.ZERO, Vector3.ZERO);\r\n        this._shaderValues.addDefine(SkinnedMeshSprite3DShaderDeclaration.SHADERDEFINE_BONE);\r\n    }\r\n\r\n\r\n\r\n\r\n    protected _computeSkinnedData(): void {\r\n        if (this._cacheMesh) {\r\n            var bindPoses: Matrix4x4[] = this._cacheMesh._inverseBindPoses;\r\n            var pathMarks: skinnedMatrixCache[] = this._cacheMesh._skinnedMatrixCaches;\r\n            for (var i: number = 0, n: number = this._cacheMesh.subMeshCount; i < n; i++) {\r\n                var subMeshBoneIndices: Uint16Array[] = ((<SubMesh>this._cacheMesh.getSubMesh(i)))._boneIndicesList;\r\n                var subData: Float32Array[] = this._skinnedData[i];\r\n                for (var j: number = 0, m: number = subMeshBoneIndices.length; j < m; j++) {\r\n                    var boneIndices: Uint16Array = subMeshBoneIndices[j];\r\n                    this._computeSubSkinnedData(bindPoses, boneIndices, subData[j], pathMarks);\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    private _computeSubSkinnedData(bindPoses: Matrix4x4[], boneIndices: Uint16Array, data: Float32Array, matrixCaches: skinnedMatrixCache[]): void {\r\n        for (let k: number = 0, q: number = boneIndices.length; k < q; k++) {\r\n            let index: number = boneIndices[k];\r\n            if (this._skinnedDataLoopMarks[index] === Stat.loopCount) {\r\n                let c: skinnedMatrixCache = matrixCaches[index];\r\n                let preData: Float32Array = this._skinnedData[c.subMeshIndex][c.batchIndex];\r\n                let srcIndex: number = c.batchBoneIndex * 16;\r\n                let dstIndex: number = k * 16;\r\n                for (let d: number = 0; d < 16; d++)\r\n                    data[dstIndex + d] = preData[srcIndex + d];\r\n            } else {\r\n                let bone = this._bones[index];\r\n                if (bone)\r\n                    Utils3D._mulMatrixArray(bone.transform.worldMatrix.elements, bindPoses[index].elements, 0, data, k * 16);\r\n                this._skinnedDataLoopMarks[index] = Stat.loopCount;\r\n            }\r\n        }\r\n    }\r\n\r\n    protected _computeSkinnedDataForNative(): void {\r\n        if (this._cacheMesh) {\r\n            var bindPoses: Matrix4x4[] = this._cacheMesh._inverseBindPoses;\r\n            var pathMarks: skinnedMatrixCache[] = this._cacheMesh._skinnedMatrixCaches;\r\n            if (this._inverseBindPosesBufferForNative == null) {\r\n                this._inverseBindPosesBufferForNative = new Float32Array(bindPoses.length * 16);\r\n                var offset: number = 0;\r\n                for (var i: number = 0, n: number = bindPoses.length; i < n; i++) {\r\n                    this._inverseBindPosesBufferForNative.set(bindPoses[i].elements, offset);\r\n                    offset += 16;\r\n                }\r\n            }\r\n            if (this._skinnedMatrixCachesBufferForNative == null) {\r\n                this._skinnedMatrixCachesBufferForNative = new Int32Array(pathMarks.length * 3);\r\n                var j: number = 0;\r\n                for (var i: number = 0, n: number = pathMarks.length; i < n; i++) {\r\n                    if (!pathMarks[i]) {\r\n                        break;\r\n                    }\r\n                    this._skinnedMatrixCachesBufferForNative[j] = pathMarks[i].subMeshIndex;\r\n                    this._skinnedMatrixCachesBufferForNative[j + 1] = pathMarks[i].batchIndex;\r\n                    this._skinnedMatrixCachesBufferForNative[j + 2] = pathMarks[i].batchBoneIndex;\r\n                    j += 3;\r\n                }\r\n            }\r\n            if (this._bonesTransformForNative == null) {\r\n                this._bonesTransformForNative = [];\r\n                for (var i: number = 0, n: number = this._bones.length; i < n; i++) {\r\n                    let bone = this._bones[i];\r\n                    if (bone) {\r\n                        this._bonesTransformForNative[i] = (bone.transform as any)._nativeObj;\r\n                    }\r\n                    else {\r\n                        this._bonesTransformForNative[i] = null;\r\n                    }\r\n                }\r\n            }\r\n\r\n            for (var i: number = 0, n: number = this._cacheMesh.subMeshCount; i < n; i++) {\r\n                var subMeshBoneIndices: Uint16Array[] = ((<SubMesh>this._cacheMesh.getSubMesh(i)))._boneIndicesList;\r\n                var subData: Float32Array[] = this._skinnedData[i];\r\n                for (var j: number = 0, m: number = subMeshBoneIndices.length; j < m; j++) {\r\n                    var boneIndices: Uint16Array = subMeshBoneIndices[j];\r\n                    (window as any).conch.computeSubSkinnedDataForNative(this._inverseBindPosesBufferForNative, boneIndices, subData[j], this._skinnedMatrixCachesBufferForNative, this._bonesTransformForNative, this._skinnedDataLoopMarks, this._skinnedData);\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n    * @inheritDoc\r\n    * @internal\r\n    * @override\r\n    */\r\n    _needRender(boundFrustum: BoundFrustum, context: RenderContext3D): boolean {\r\n        if (!Stat.enableSkin)\r\n            return false;\r\n        return super._needRender(boundFrustum, context);\r\n    }\r\n\r\n    /**\r\n     *@inheritDoc\r\n     *@override\r\n     *@internal\r\n     */\r\n    _createRenderElement(): SkinRenderElement {\r\n        let renderelement = new SkinRenderElement();\r\n        return renderelement;\r\n    }\r\n    /**\r\n     * @internal\r\n     */\r\n    _onSkinMeshChange(mesh: Mesh): void {\r\n        if (mesh && this._mesh != mesh) {\r\n            this._changeVertexDefine(mesh);\r\n            this._changeMorphData(mesh);\r\n            this._mesh = mesh;\r\n            var count: number = mesh.subMeshCount;\r\n            this._renderElements.length = count;\r\n            let materials = this.sharedMaterials;\r\n            materials.length = count;\r\n            for (var i: number = 0; i < count; i++) {\r\n                var renderElement: SkinRenderElement = this._renderElements[i];\r\n                if (!renderElement) {\r\n                    renderElement = this._renderElements[i] = this._renderElements[i] ? this._renderElements[i] : this._createRenderElement();\r\n                    if (this._cacheRootBone) {\r\n                        renderElement.setTransform(this._cacheRootBone._transform);\r\n                    } else {\r\n                        renderElement.setTransform((this.owner as Sprite3D)._transform);\r\n                    }\r\n                    renderElement.render = this;\r\n                    materials[i] = materials[i] || BlinnPhongMaterial.defaultMaterial;\r\n                }\r\n                renderElement.setGeometry(mesh.getSubMesh(i));\r\n            }\r\n            this.sharedMaterials = materials;\r\n        } else if (!mesh) {\r\n            this._renderElements.length = 0;\r\n            this._mesh = null;\r\n            this._changeVertexDefine(null);\r\n            this._changeMorphData(null);\r\n        }\r\n        this.boundsChange = true;\r\n        // if (this._octreeNode && this._indexInOctreeMotionList === -1) {\r\n        // \tthis._octreeNode.getManagerNode().addMotionObject(this);\r\n        // }\r\n    }\r\n    /**\r\n    *@inheritDoc\r\n    *@override\r\n    *@internal\r\n    */\r\n    _onMeshChange(value: Mesh): void {\r\n        this._onSkinMeshChange(value);\r\n        if (!value)\r\n            return;\r\n        this._cacheMesh = (<Mesh>value);\r\n\r\n        var subMeshCount: number = value.subMeshCount;\r\n        this._skinnedData = [];\r\n        this._skinnedDataLoopMarks = new Uint32Array(value._inverseBindPoses.length);\r\n        for (var i: number = 0; i < subMeshCount; i++) {\r\n            var subBoneIndices: Uint16Array[] = ((<SubMesh>value.getSubMesh(i)))._boneIndicesList;\r\n            var subCount: number = subBoneIndices.length;\r\n            var subData: Float32Array[] = this._skinnedData[i] = [];\r\n            for (var j: number = 0; j < subCount; j++)\r\n                subData[j] = new Float32Array(subBoneIndices[j].length * 16);\r\n            this._renderElements[i].setSkinData(subData);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * @inheritDoc\r\n     * @override\r\n     * @internal\r\n     */\r\n    protected _calculateBoundingBox(): void {//TODO:boundingSphere\r\n        if (this._cacheRootBone)\r\n            this._localBounds._tranform(this._cacheRootBone.transform.worldMatrix, this._bounds);\r\n        else\r\n            this._localBounds._tranform((this.owner as Sprite3D).transform.worldMatrix, this._bounds);\r\n    }\r\n\r\n    _setBelongScene(scene: Scene3D): void {\r\n        super._setBelongScene(scene);\r\n        Stat.skinRenderNode++;\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    _setUnBelongScene() {\r\n        super._setUnBelongScene();\r\n        Stat.skinRenderNode--;\r\n    }\r\n\r\n    /**\r\n     * @inheritDoc\r\n     * @override\r\n     * @internal\r\n     */\r\n    _renderUpdate(context: RenderContext3D, transform: Transform3D): void {\r\n        this._applyReflection();\r\n        if (this.bones.length > 0) {\r\n            this._computeSkinnedData();\r\n            this._shaderValues.setMatrix4x4(Sprite3D.WORLDMATRIX, Matrix4x4.DEFAULT);\r\n            this._worldParams.x = 1;\r\n            this._shaderValues.setVector(Sprite3D.WORLDINVERTFRONT, this._worldParams);\r\n        } else {\r\n            this._shaderValues.setMatrix4x4(Sprite3D.WORLDMATRIX, transform.worldMatrix);\r\n            this._worldParams.x = transform.getFrontFaceValue();\r\n            this._shaderValues.setVector(Sprite3D.WORLDINVERTFRONT, this._worldParams);\r\n        }\r\n\r\n        this._mesh.morphTargetData && this._applyMorphdata();\r\n    }\r\n\r\n    // /**\r\n    //  * @inheritDoc\r\n    //  * @override\r\n    //  * @internal\r\n    //  */\r\n    // _renderUpdateWithCamera(context: RenderContext3D, transform: Transform3D): void {\r\n    // \tvar projectionView: Matrix4x4 = context.projectionViewMatrix;\r\n    // \tthis._shaderValues.setMatrix4x4(Sprite3D.MVPMATRIX, projectionView);\r\n    // }\r\n\r\n    /**\r\n     * @override\r\n     * @param dest \r\n     */\r\n    _cloneTo(dest: Component): void {\r\n        let render = (dest as SkinnedMeshRenderer);\r\n\r\n        render._inverseBindPosesBufferForNative = null;\r\n        render._skinnedMatrixCachesBufferForNative = null;\r\n        render._bonesTransformForNative = null;\r\n\r\n        //get common parent\r\n        let getCommomParent = (rootNode: Sprite3D, rootCheckNode: Sprite3D): Sprite3D => {\r\n            let nodeArray: Sprite3D[] = [];\r\n            let node = rootNode;\r\n            while (!!node) {\r\n                if (node instanceof Sprite3D)\r\n                    nodeArray.push(node);\r\n                node = node.parent as Sprite3D;\r\n            }\r\n            let checkNode: Sprite3D = rootCheckNode;\r\n            while (!!checkNode && nodeArray.indexOf(checkNode) == -1) {\r\n                checkNode = checkNode.parent as Sprite3D;\r\n            }\r\n            return checkNode;\r\n        }\r\n        let cloneHierachFun = (rootNode: Sprite3D, rootCheckNode: Sprite3D, destNode: Sprite3D): Sprite3D => {\r\n            let rootparent: Sprite3D = getCommomParent(rootNode, rootCheckNode);\r\n            if (!rootparent)\r\n                return null;\r\n            let path: number[] = [];\r\n            Utils3D._getHierarchyPath(rootparent, rootNode, path);\r\n            let pathcheck: number[] = [];\r\n            Utils3D._getHierarchyPath(rootparent, rootCheckNode, pathcheck);\r\n            let destParent = Utils3D._getParentNodeByHierarchyPath(destNode, path);\r\n            if (!destParent)\r\n                return null;\r\n            return Utils3D._getNodeByHierarchyPath(destParent, pathcheck) as Sprite3D;\r\n        }\r\n        //rootBone Clone\r\n        var rootBone: Sprite3D = this.rootBone;\r\n        if (rootBone) {\r\n            let node = cloneHierachFun(this.owner as Sprite3D, this.rootBone as Sprite3D, render.owner as Sprite3D);\r\n            if (node)\r\n                render.rootBone = node;\r\n            else\r\n                render.rootBone = rootBone;\r\n        }\r\n        //BonesClone\r\n        var bones: Sprite3D[] = this.bones;\r\n        var destBone: Sprite3D[] = render.bones;\r\n        let n = destBone.length = bones.length;\r\n        for (var i = 0; i < n; i++) {\r\n            let ceckNode = bones[i];\r\n            destBone[i] = cloneHierachFun(this.owner as Sprite3D, ceckNode, render.owner as Sprite3D);\r\n        }\r\n        //bounds\r\n        var lbb: Bounds = this.localBounds;\r\n        (lbb) && (lbb.cloneTo(render.localBounds));\r\n        (render.localBounds) && (render.localBounds = render.localBounds);\r\n        super._cloneTo(dest);\r\n    }\r\n\r\n    protected _onDestroy() {\r\n        if (this._cacheRootBone)\r\n            (!this._cacheRootBone._destroyed) && (this._cacheRootBone.transform.off(Event.TRANSFORM_CHANGED, this, this._onWorldMatNeedChange));\r\n        else\r\n            (this.owner && !this.owner._destroyed) && ((this.owner as Sprite3D).transform.off(Event.TRANSFORM_CHANGED, this, this._onWorldMatNeedChange));\r\n        super._onDestroy();\r\n    }\r\n}\r\n\r\n","import { Node } from \"../../display/Node\";\r\nimport { Loader } from \"../../net/Loader\";\r\nimport { Mesh } from \"../resource/models/Mesh\";\r\nimport { MeshFilter } from \"./MeshFilter\";\r\nimport { RenderableSprite3D } from \"./RenderableSprite3D\";\r\nimport { SkinnedMeshRenderer } from \"./SkinnedMeshRenderer\";\r\nimport { Sprite3D } from \"./Sprite3D\";\r\nimport { Material } from \"../../resource/Material\";\r\nimport { SkinnedMeshSprite3DShaderDeclaration } from \"./SkinnedMeshSprite3DShaderDeclaration\";\r\nimport { Shader3D } from \"../../RenderEngine/RenderShader/Shader3D\";\r\nimport { Vector3 } from \"../../maths/Vector3\";\r\nimport { Vector4 } from \"../../maths/Vector4\";\r\nimport { ShaderDataType } from \"../../RenderEngine/RenderShader/ShaderData\";\r\nimport { LayaGL } from \"../../layagl/LayaGL\";\r\n\r\n/**\r\n * <code>SkinnedMeshSprite3D</code> \r\n */\r\nexport class SkinnedMeshSprite3D extends RenderableSprite3D {\r\n    /**@internal */\r\n    static _tempArray0: any[] = [];\r\n\r\n    /***/\r\n    static BONES: number;\r\n    /**\r\n     * @internal\r\n     */\r\n    static __init__(): void {\r\n        SkinnedMeshSprite3DShaderDeclaration.SHADERDEFINE_BONE = Shader3D.getDefineByName(\"BONE\");\r\n        SkinnedMeshSprite3DShaderDeclaration.SHADERDEFINE_SIMPLEBONE = Shader3D.getDefineByName(\"SIMPLEBONE\");\r\n        const commandUniform = LayaGL.renderOBJCreate.createGlobalUniformMap(\"Custom\");\r\n        SkinnedMeshSprite3D.BONES = Shader3D.propertyNameToID(\"u_Bones\");\r\n        commandUniform.addShaderUniform(SkinnedMeshSprite3D.BONES, \"u_Bones\", ShaderDataType.Buffer);\r\n    }\r\n\r\n    /** @internal */\r\n    private _meshFilter: MeshFilter;\r\n\r\n    /**\r\n     * \r\n     */\r\n    get meshFilter(): MeshFilter {\r\n        return this._meshFilter;\r\n    }\r\n\r\n    /**\r\n     * \r\n     */\r\n    get skinnedMeshRenderer(): SkinnedMeshRenderer {\r\n        return (<SkinnedMeshRenderer>this._render);\r\n    }\r\n\r\n    /**\r\n     *  <code>MeshSprite3D</code> \r\n     * @param mesh ,\r\n     * @param name \r\n     */\r\n    constructor(mesh: Mesh = null, name: string = null) {\r\n        super(name);\r\n        this._meshFilter = this.addComponent(MeshFilter);\r\n        this._render = this.addComponent(SkinnedMeshRenderer);\r\n        (mesh) && (this._meshFilter.sharedMesh = mesh);\r\n    }\r\n\r\n    /**\r\n     * @inheritDoc\r\n     * @override\r\n     * @internal\r\n     */\r\n    _parse(data: any, spriteMap: any): void {\r\n        super._parse(data, spriteMap);\r\n        var render: SkinnedMeshRenderer = this.skinnedMeshRenderer;\r\n        var lightmapIndex: any = data.lightmapIndex;\r\n        (lightmapIndex != null) && (render.lightmapIndex = lightmapIndex);\r\n        var lightmapScaleOffsetArray: any[] = data.lightmapScaleOffset;\r\n        (lightmapScaleOffsetArray) && (render.lightmapScaleOffset = new Vector4(lightmapScaleOffsetArray[0], lightmapScaleOffsetArray[1], lightmapScaleOffsetArray[2], lightmapScaleOffsetArray[3]));\r\n        (data.enableRender != undefined) && (render.enabled = data.enableRender);\r\n        (data.receiveShadows != undefined) && (render.receiveShadow = data.receiveShadows);\r\n        (data.castShadow != undefined) && (render.castShadow = data.castShadow);\r\n        var meshPath: string;\r\n        meshPath = data.meshPath;\r\n        if (meshPath) {\r\n            var mesh: Mesh = Loader.getRes(meshPath);//mesh\r\n            (mesh) && (this.meshFilter.sharedMesh = mesh);\r\n        }\r\n\r\n        var materials: any[] = data.materials;\r\n        if (materials) {\r\n            var sharedMaterials: Material[] = render.sharedMaterials;\r\n            var materialCount: number = materials.length;\r\n            sharedMaterials.length = materialCount;\r\n            for (var i: number = 0; i < materialCount; i++) {\r\n                sharedMaterials[i] = Loader.getRes(materials[i].path);\r\n            }\r\n            render.sharedMaterials = sharedMaterials;\r\n        }\r\n\r\n        var boundBox: any = data.boundBox;\r\n        var min: any[] = boundBox.min;\r\n        var max: any[] = boundBox.max;\r\n        render.localBounds.setMin(new Vector3(min[0], min[1], min[2]));\r\n        render.localBounds.setMax(new Vector3(max[0], max[1], max[2]));\r\n        render.localBounds = render.localBounds;\r\n        if (spriteMap) {\r\n            var rootBoneData: number = data.rootBone;\r\n            render.rootBone = spriteMap[rootBoneData];\r\n            var bonesData: any[] = data.bones;\r\n            var n: number;\r\n            for (i = 0, n = bonesData.length; i < n; i++)\r\n                (render as SkinnedMeshRenderer).bones.push(spriteMap[bonesData[i]]);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * @inheritDoc\r\n     * @override\r\n     * @internal\r\n     */\r\n    _cloneTo(destObject: any, srcRoot: Node, dstRoot: Node): void {\r\n        super._cloneTo(destObject, srcRoot, dstRoot);//,\r\n    }\r\n\r\n    /**\r\n     * @inheritDoc\r\n     * @override\r\n     */\r\n    destroy(destroyChild: boolean = true): void {\r\n        if (this._destroyed)\r\n            return;\r\n        super.destroy(destroyChild);\r\n        this._meshFilter.destroy();\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    protected _create(): Node {\r\n        return new Sprite3D();\r\n    }\r\n\r\n}\r\n\r\n","import { Color } from \"../../../maths/Color\";\r\nimport { Vector4 } from \"../../../maths/Vector4\";\r\nimport { RenderState } from \"../../../RenderEngine/RenderShader/RenderState\";\r\nimport { Shader3D } from \"../../../RenderEngine/RenderShader/Shader3D\";\r\nimport { BaseTexture } from \"../../../resource/BaseTexture\";\r\nimport { Material, MaterialRenderMode } from \"../../../resource/Material\";\r\n\r\n/**\r\n * <code>TrailMaterial</code> \r\n */\r\nexport class TrailMaterial extends Material {\r\n\r\n\r\n\t/** */\r\n\tstatic defaultMaterial: TrailMaterial;\r\n\t/**@internal */\r\n\tstatic MAINTEXTURE: number;\r\n\t/**@internal */\r\n\tstatic TINTCOLOR: number;\r\n\t/**@internal */\r\n\tstatic TILINGOFFSET: number;\r\n\r\n\t/**\r\n\t * @internal\r\n\t */\r\n\tstatic __initDefine__(): void {\r\n\t\tTrailMaterial.MAINTEXTURE = Shader3D.propertyNameToID(\"u_MainTexture\");\r\n\t\tTrailMaterial.TINTCOLOR = Shader3D.propertyNameToID(\"u_MainColor\");\r\n\t\tTrailMaterial.TILINGOFFSET = Shader3D.propertyNameToID(\"u_TilingOffset\");\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t * @return \r\n\t */\r\n\tget color(): Color {\r\n\t\treturn (<Color>this._shaderValues.getColor(TrailMaterial.TINTCOLOR));\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t * @param value \r\n\t */\r\n\tset color(value: Color) {\r\n\t\tthis._shaderValues.setColor(TrailMaterial.TINTCOLOR, value);\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t * @return \r\n\t */\r\n\tget texture(): BaseTexture {\r\n\t\treturn this._shaderValues.getTexture(TrailMaterial.MAINTEXTURE);\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t * @param value \r\n\t */\r\n\tset texture(value: BaseTexture) {\r\n\t\tif (value)\r\n\t\t\tthis._shaderValues.addDefine(TrailMaterial.SHADERDEFINE_MAINTEXTURE);\r\n\t\telse\r\n\t\t\tthis._shaderValues.removeDefine(TrailMaterial.SHADERDEFINE_MAINTEXTURE);\r\n\t\tthis._shaderValues.setTexture(TrailMaterial.MAINTEXTURE, value);\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t * @return \r\n\t */\r\n\tget tilingOffset(): Vector4 {\r\n\t\treturn (<Vector4>this._shaderValues.getVector(TrailMaterial.TILINGOFFSET));\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t * @param value \r\n\t */\r\n\tset tilingOffset(value: Vector4) {\r\n\t\tif (value) {\r\n\t\t\tthis._shaderValues.setVector(TrailMaterial.TILINGOFFSET, value);\r\n\t\t}\r\n\t\telse {\r\n\t\t\tthis._shaderValues.getVector(TrailMaterial.TILINGOFFSET).setValue(1.0, 1.0, 0.0, 0.0);\r\n\t\t}\r\n\t}\r\n\r\n\tconstructor() {\r\n\t\tsuper();\r\n\t\tthis.setShaderName(\"Trail\");\r\n\t\tthis.materialRenderMode = MaterialRenderMode.RENDERMODE_ALPHABLENDED;\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritdoc\r\n\t * @override\r\n\t */\r\n\tclone(): any {\r\n\t\tvar dest: TrailMaterial = new TrailMaterial();\r\n\t\tthis.cloneTo(dest);\r\n\t\treturn dest;\r\n\t}\r\n\r\n\t//----------------deprecated----------------\r\n\t/**\r\n\t * @deprecated\r\n\t * _\r\n\t */\r\n\tstatic RENDERMODE_ALPHABLENDED: number = 0;\r\n\r\n\t/**\r\n\t* @deprecated\r\n\t* _\r\n\t*/\r\n\tstatic RENDERMODE_ADDTIVE: number = 1;\r\n\r\n\t/**\r\n\t * @deprecated\r\n\t * materialRenderMode\r\n\t */\r\n\tset renderMode(value: number) {\r\n\t\tswitch (value) {\r\n\t\t\tcase TrailMaterial.RENDERMODE_ADDTIVE:\r\n\t\t\t\tthis.renderQueue = Material.RENDERQUEUE_TRANSPARENT;\r\n\t\t\t\tthis.depthWrite = false;\r\n\t\t\t\tthis.cull = RenderState.CULL_NONE;\r\n\t\t\t\tthis.blend = RenderState.BLEND_ENABLE_ALL;\r\n\t\t\t\tthis.blendSrc = RenderState.BLENDPARAM_SRC_ALPHA;\r\n\t\t\t\tthis.blendDst = RenderState.BLENDPARAM_ONE;\r\n\t\t\t\tthis.alphaTest = false;\r\n\t\t\t\tthis._shaderValues.addDefine(TrailMaterial.SHADERDEFINE_ADDTIVEFOG);\r\n\t\t\t\tbreak;\r\n\t\t\tcase TrailMaterial.RENDERMODE_ALPHABLENDED:\r\n\t\t\t\tthis.renderQueue = Material.RENDERQUEUE_TRANSPARENT;\r\n\t\t\t\tthis.depthWrite = false;\r\n\t\t\t\tthis.cull = RenderState.CULL_NONE;\r\n\t\t\t\tthis.blend = RenderState.BLEND_ENABLE_ALL;\r\n\t\t\t\tthis.blendSrc = RenderState.BLENDPARAM_SRC_ALPHA;\r\n\t\t\t\tthis.blendDst = RenderState.BLENDPARAM_ONE_MINUS_SRC_ALPHA;\r\n\t\t\t\tthis.alphaTest = false;\r\n\t\t\t\tthis._shaderValues.removeDefine(TrailMaterial.SHADERDEFINE_ADDTIVEFOG);\r\n\t\t\t\tbreak;\r\n\t\t\tdefault:\r\n\t\t\t\tthrow new Error(\"ShurikenParticleMaterial : renderMode value error.\");\r\n\t\t}\r\n\t}\r\n}\r\n\r\n","\r\nexport class TrailTextureMode {\r\n\t/**\r\n\t * \r\n\t */\r\n\tstatic Stretch: number = 0;\r\n\r\n\t/**\r\n\t * \r\n\t */\r\n\tstatic Tile: number = 1;\r\n\r\n}\r\n\r\n\r\n","import { VertexDeclaration } from \"../../../RenderEngine/VertexDeclaration\";\r\nimport { VertexElement } from \"../../../renders/VertexElement\";\r\nimport { VertexElementFormat } from \"../../../renders/VertexElementFormat\";\r\nimport { IVertex } from \"../../graphics/IVertex\"\r\n/**\r\n * <code>VertexTrail</code> \r\n * @internal\r\n */\r\nexport class VertexTrail implements IVertex {\r\n\t/**@internal */\r\n\tstatic TRAIL_POSITION0: number = 0;\r\n\t/**@internal */\r\n\tstatic TRAIL_OFFSETVECTOR: number = 1;\r\n\t/**@internal */\r\n\tstatic TRAIL_TIME0: number = 2;\r\n\t/**@internal */\r\n\tstatic TRAIL_TEXTURECOORDINATE0Y: number = 3;\r\n\t/**@internal */\r\n\tstatic TRAIL_TEXTURECOORDINATE0X: number = 4;\r\n\t/**@internal */\r\n\tstatic TRAIL_COLOR: number = 5;\r\n\r\n\t/**@internal */\r\n\tprivate static _vertexDeclaration1: VertexDeclaration;\r\n\t/**@internal */\r\n\tprivate static _vertexDeclaration2: VertexDeclaration;\r\n\r\n\t/**\r\n\t * @internal\r\n\t */\r\n\tstatic get vertexDeclaration1(): VertexDeclaration {\r\n\t\treturn VertexTrail._vertexDeclaration1;\r\n\t}\r\n\r\n\t/**\r\n\t * @internal\r\n\t */\r\n\tstatic get vertexDeclaration2(): VertexDeclaration {\r\n\t\treturn VertexTrail._vertexDeclaration2;\r\n\t}\r\n\r\n\tget vertexDeclaration(): VertexDeclaration {\r\n\t\treturn VertexTrail._vertexDeclaration1;\r\n\t}\r\n\r\n\t/**\r\n\t * @internal\r\n\t */\r\n\tstatic __init__(): void {\r\n\t\tVertexTrail._vertexDeclaration1 = new VertexDeclaration(32,\r\n\t\t\t[new VertexElement(0, VertexElementFormat.Vector3, VertexTrail.TRAIL_POSITION0),\r\n\t\t\tnew VertexElement(12, VertexElementFormat.Vector3, VertexTrail.TRAIL_OFFSETVECTOR),\r\n\t\t\tnew VertexElement(24, VertexElementFormat.Single, VertexTrail.TRAIL_TIME0),\r\n\t\t\tnew VertexElement(28, VertexElementFormat.Single, VertexTrail.TRAIL_TEXTURECOORDINATE0Y)]);\r\n\t\tVertexTrail._vertexDeclaration2 = new VertexDeclaration(20,\r\n\t\t\t[new VertexElement(0, VertexElementFormat.Single, VertexTrail.TRAIL_TEXTURECOORDINATE0X),\r\n\t\t\tnew VertexElement(4, VertexElementFormat.Color, VertexTrail.TRAIL_COLOR)]);\r\n\t}\r\n}\r\n\r\n","import { Color } from \"../../../maths/Color\";\r\nimport { MathUtils3D } from \"../../../maths/MathUtils3D\";\r\nimport { Matrix4x4 } from \"../../../maths/Matrix4x4\";\r\nimport { Vector3 } from \"../../../maths/Vector3\";\r\nimport { BufferUsage } from \"../../../RenderEngine/RenderEnum/BufferTargetType\";\r\nimport { DrawType } from \"../../../RenderEngine/RenderEnum/DrawType\";\r\nimport { MeshTopology } from \"../../../RenderEngine/RenderEnum/RenderPologyMode\";\r\nimport { VertexDeclaration } from \"../../../RenderEngine/VertexDeclaration\";\r\nimport { Resource } from \"../../../resource/Resource\";\r\nimport { BufferState } from \"../../../webgl/utils/BufferState\";\r\nimport { VertexBuffer3D } from \"../../graphics/VertexBuffer3D\";\r\nimport { Bounds } from \"../../math/Bounds\";\r\nimport { Laya3DRender } from \"../../RenderObjs/Laya3DRender\";\r\nimport { Camera } from \"../Camera\";\r\nimport { GeometryElement } from \"../GeometryElement\";\r\nimport { Gradient } from \"../Gradient\";\r\nimport { RenderContext3D } from \"../render/RenderContext3D\";\r\nimport { Sprite3D } from \"../Sprite3D\";\r\nimport { TrailTextureMode } from \"../TrailTextureMode\";\r\nimport { TrailAlignment } from \"./TrailAlignment\";\r\nimport { TrailFilter } from \"./TrailFilter\";\r\nimport { VertexTrail } from \"./VertexTrail\";\r\n\r\n/**\r\n * <code>TrailGeometry</code> \r\n */\r\nexport class TrailGeometry extends GeometryElement {\r\n\t/** _*/\r\n\tstatic ALIGNMENT_VIEW: number = 0;\r\n\t/** _*/\r\n\tstatic ALIGNMENT_TRANSFORM_Z: number = 1;\r\n\r\n\t/**@internal */\r\n\tprivate static _tempVector30: Vector3 = new Vector3();\r\n\t/**@internal */\r\n\tprivate static _tempVector31: Vector3 = new Vector3();\r\n\t/**@internal */\r\n\tprivate static _tempVector32: Vector3 = new Vector3();\r\n\t/**@internal */\r\n\tprivate static _tempVector33: Vector3 = new Vector3();\r\n\t/**@internal */\r\n\tprivate static _tempVector34: Vector3 = new Vector3();\r\n\t/**@internal */\r\n\tprivate static _tempVector35: Vector3 = new Vector3();\r\n\t/**@internal */\r\n\tprivate static _tempVector36: Vector3 = new Vector3();\r\n\r\n\t/**@internal */\r\n\tprivate static _type: number = GeometryElement._typeCounter++;\r\n\r\n\t/**@internal */\r\n\tprivate _floatCountPerVertices1: number = 8;\r\n\t/**@internal */\r\n\tprivate _floatCountPerVertices2: number = 5;\r\n\t/**@internal */\r\n\tprivate _increaseSegementCount: number = 16;\r\n\t/**@internal */\r\n\tprivate _activeIndex: number = 0;\r\n\t/**@internal */\r\n\tprivate _endIndex: number = 0;\r\n\t/**@internal */\r\n\tprivate _needAddFirstVertex: boolean = false;\r\n\t/**@internal */\r\n\tprivate _isTempEndVertex: boolean = false;\r\n\t/**@internal */\r\n\tprivate _subBirthTime: Float32Array;\r\n\t/**@internal */\r\n\tprivate _subDistance: Float64Array;\r\n\t/**@internal */\r\n\tprivate _segementCount: number;\r\n\t/**@internal */\r\n\tprivate _vertices1: Float32Array = null;\r\n\t/**@internal */\r\n\tprivate _vertices2: Float32Array = null;\r\n\t/**@internal */\r\n\tprivate _vertexBuffer1: VertexBuffer3D;\r\n\t/**@internal */\r\n\tprivate _vertexBuffer2: VertexBuffer3D;\r\n\t/**@internal */\r\n\tprivate _lastFixedVertexPosition: Vector3 = new Vector3();\r\n\t/**@internal */\r\n\tprotected _owner: TrailFilter;\r\n\r\n\tprivate tmpColor: Color = new Color();\r\n\t/** @private */\r\n\tprivate _disappearBoundsMode: Boolean = false;\r\n\r\n\tconstructor(owner: TrailFilter) {\r\n\t\tsuper(MeshTopology.TriangleStrip, DrawType.DrawArray);\r\n\t\tthis._owner = owner;\r\n\t\t//_segementCount\r\n\t\tthis.bufferState = new BufferState();\r\n\t\tthis._segementCount = this._increaseSegementCount;\r\n\r\n\t\tthis._resizeData(this._segementCount, this.bufferState);\r\n\t\t// var bounds: Bounds = this._owner._owner.trailRenderer.bounds;\r\n\t\t// var sprite3dPosition: Vector3 = this._owner._owner.transform.position;\r\n\t\t// bounds.setMin(sprite3dPosition);\r\n\t\t// bounds.setMax(sprite3dPosition);\r\n\t}\r\n\r\n\t/**\r\n\t * @internal\r\n\t */\r\n\tprivate _resizeData(segementCount: number, bufferState: BufferState): void {\r\n\t\tthis._subBirthTime = new Float32Array(segementCount);\r\n\t\tthis._subDistance = new Float64Array(segementCount);\r\n\r\n\t\tvar vertexCount: number = segementCount * 2;\r\n\t\tvar vertexDeclaration1: VertexDeclaration = VertexTrail.vertexDeclaration1;\r\n\t\tvar vertexDeclaration2: VertexDeclaration = VertexTrail.vertexDeclaration2;\r\n\t\tvar vertexBuffers: VertexBuffer3D[] = [];\r\n\t\tvar vertexbuffer1Size: number = vertexCount * vertexDeclaration1.vertexStride;\r\n\t\tvar vertexbuffer2Size: number = vertexCount * vertexDeclaration2.vertexStride;\r\n\t\tvar memorySize: number = vertexbuffer1Size + vertexbuffer2Size;\r\n\t\tthis._vertices1 = new Float32Array(vertexCount * this._floatCountPerVertices1);\r\n\t\tthis._vertices2 = new Float32Array(vertexCount * this._floatCountPerVertices2);\r\n\t\tthis._vertexBuffer1 = Laya3DRender.renderOBJCreate.createVertexBuffer3D(vertexbuffer1Size, BufferUsage.Dynamic, false);\r\n\t\tthis._vertexBuffer1.vertexDeclaration = vertexDeclaration1;\r\n\t\tthis._vertexBuffer2 = Laya3DRender.renderOBJCreate.createVertexBuffer3D(vertexbuffer2Size, BufferUsage.Dynamic, false);\r\n\t\tthis._vertexBuffer2.vertexDeclaration = vertexDeclaration2;\r\n\r\n\t\tvertexBuffers.push(this._vertexBuffer1);\r\n\t\tvertexBuffers.push(this._vertexBuffer2);\r\n\t\t// bufferState.bind();\r\n\t\t// bufferState.applyVertexBuffers(vertexBuffers);\r\n\t\t// bufferState.unBind();\r\n\t\tbufferState.applyState(vertexBuffers, null);\r\n\t\tResource._addMemory(memorySize, memorySize);\r\n\t}\r\n\r\n\t/**\r\n\t * @internal\r\n\t */\r\n\tprivate _resetData(): void {\r\n\t\tvar count: number = this._endIndex - this._activeIndex;\r\n\t\t//_resizeData\r\n\t\tvar oldVertices1: Float32Array = new Float32Array(this._vertices1.buffer, this._floatCountPerVertices1 * 2 * this._activeIndex * 4, this._floatCountPerVertices1 * 2 * count);\r\n\t\tvar oldVertices2: Float32Array = new Float32Array(this._vertices2.buffer, this._floatCountPerVertices2 * 2 * this._activeIndex * 4, this._floatCountPerVertices2 * 2 * count);\r\n\t\tvar oldSubDistance: Float64Array = new Float64Array(this._subDistance.buffer, this._activeIndex * 8, count);//\r\n\t\tvar oldSubBirthTime: Float32Array = new Float32Array(this._subBirthTime.buffer, this._activeIndex * 4, count);//\r\n\r\n\t\tif (count === this._segementCount) {//count=_segementCount,\r\n\t\t\tvar memorySize: number = this._vertexBuffer1._byteLength + this._vertexBuffer2._byteLength;\r\n\t\t\tResource._addMemory(-memorySize, -memorySize);\r\n\t\t\tthis._vertexBuffer1.destroy();\r\n\t\t\tthis._vertexBuffer2.destroy();\r\n\t\t\tthis._segementCount += this._increaseSegementCount;\r\n\t\t\tthis._resizeData(this._segementCount, this.bufferState);\r\n\t\t}\r\n\r\n\t\tthis._vertices1.set(oldVertices1, 0);\r\n\t\tthis._vertices2.set(oldVertices2, 0);\r\n\t\tthis._subDistance.set(oldSubDistance, 0);\r\n\t\tthis._subBirthTime.set(oldSubBirthTime, 0);\r\n\r\n\t\tthis._endIndex = count;\r\n\t\tthis._activeIndex = 0;\r\n\t\tthis._vertexBuffer1.setData(this._vertices1.buffer, 0, this._floatCountPerVertices1 * 2 * this._activeIndex * 4, this._floatCountPerVertices1 * 2 * count * 4);\r\n\t\tthis._vertexBuffer2.setData(this._vertices2.buffer, 0, this._floatCountPerVertices2 * 2 * this._activeIndex * 4, this._floatCountPerVertices2 * 2 * count * 4);\r\n\t}\r\n\r\n\t/**\r\n\t * @internal\r\n\t * Trail\r\n\t */\r\n\t_updateTrail(camera: Camera, lastPosition: Vector3, position: Vector3): void {\r\n\t\tif (!Vector3.equals(lastPosition, position)) {//\r\n\t\t\tif ((this._endIndex - this._activeIndex) === 0)\r\n\t\t\t\tthis._addTrailByFirstPosition(camera, position);//,\r\n\t\t\telse\r\n\t\t\t\tthis._addTrailByNextPosition(camera, position);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @internal\r\n\t * TrailRenderElement\r\n\t */\r\n\tprivate _addTrailByFirstPosition(camera: Camera, position: Vector3): void {\r\n\t\t(this._endIndex === this._segementCount) && (this._resetData());\r\n\t\tthis._subDistance[this._endIndex] = 0;\r\n\t\tthis._subBirthTime[this._endIndex] = this._owner._curtime;\r\n\t\tthis._endIndex++;\r\n\t\tposition.cloneTo(this._lastFixedVertexPosition);\r\n\t\tthis._needAddFirstVertex = true;\r\n\t}\r\n\r\n\t/**\r\n\t * @internal\r\n\t * TrailRenderElement\r\n\t */\r\n\tprivate _addTrailByNextPosition(camera: Camera, position: Vector3): void {\r\n\t\tvar delVector3: Vector3 = TrailGeometry._tempVector30;\r\n\t\tvar pointAtoBVector3: Vector3 = TrailGeometry._tempVector31;\r\n\t\tswitch (this._owner.alignment) {\r\n\t\t\tcase TrailAlignment.View:\r\n\t\t\t\tvar cameraMatrix: Matrix4x4 = camera.viewMatrix;\r\n\t\t\t\tVector3.transformCoordinate(position, cameraMatrix, TrailGeometry._tempVector33);\r\n\t\t\t\tVector3.transformCoordinate(this._lastFixedVertexPosition, cameraMatrix, TrailGeometry._tempVector34);\r\n\t\t\t\tVector3.subtract(TrailGeometry._tempVector33, TrailGeometry._tempVector34, delVector3);\r\n\t\t\t\tVector3.cross(TrailGeometry._tempVector33, delVector3, pointAtoBVector3);\r\n\t\t\t\tbreak;\r\n\t\t\tcase TrailAlignment.TransformZ:\r\n\t\t\t\tVector3.subtract(position, this._lastFixedVertexPosition, delVector3);\r\n\t\t\t\tvar forward: Vector3 = TrailGeometry._tempVector32;\r\n\t\t\t\t(this._owner._ownerRender.owner as Sprite3D).transform.getForward(forward);\r\n\t\t\t\tVector3.cross(delVector3, forward, pointAtoBVector3);//viewforward\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\r\n\t\tVector3.normalize(pointAtoBVector3, pointAtoBVector3);\r\n\t\tVector3.scale(pointAtoBVector3, this._owner.widthMultiplier / 2, pointAtoBVector3);\r\n\r\n\t\tvar delLength: number = Vector3.scalarLength(delVector3);\r\n\t\tvar tempEndIndex: number;\r\n\t\tvar offset: number;\r\n\r\n\t\tif (this._needAddFirstVertex) {\r\n\t\t\tthis._updateVerticesByPositionData(position, pointAtoBVector3, this._endIndex - 1);//\r\n\t\t\tthis._needAddFirstVertex = false;\r\n\t\t}\r\n\r\n\t\tif (delLength - this._owner.minVertexDistance >= MathUtils3D.zeroTolerance) {//\r\n\t\t\tif (this._isTempEndVertex) {\r\n\t\t\t\ttempEndIndex = this._endIndex - 1;\r\n\t\t\t\toffset = delLength - this._subDistance[tempEndIndex];\r\n\t\t\t\tthis._updateVerticesByPosition(position, pointAtoBVector3, delLength, tempEndIndex);\r\n\t\t\t\tthis._owner._totalLength += offset;//\r\n\t\t\t} else {\r\n\t\t\t\t(this._endIndex === this._segementCount) && (this._resetData());\r\n\t\t\t\tthis._updateVerticesByPosition(position, pointAtoBVector3, delLength, this._endIndex);\r\n\t\t\t\tthis._owner._totalLength += delLength;\r\n\t\t\t\tthis._endIndex++;\r\n\t\t\t}\r\n\t\t\tposition.cloneTo(this._lastFixedVertexPosition);\r\n\t\t\tthis._isTempEndVertex = false;\r\n\t\t} else {\r\n\t\t\tif (this._isTempEndVertex) {\r\n\t\t\t\ttempEndIndex = this._endIndex - 1;\r\n\t\t\t\toffset = delLength - this._subDistance[tempEndIndex];\r\n\t\t\t\tthis._updateVerticesByPosition(position, pointAtoBVector3, delLength, tempEndIndex);\r\n\t\t\t\tthis._owner._totalLength += offset;//\r\n\t\t\t} else {\r\n\t\t\t\t(this._endIndex === this._segementCount) && (this._resetData());\r\n\t\t\t\tthis._updateVerticesByPosition(position, pointAtoBVector3, delLength, this._endIndex);\r\n\t\t\t\tthis._owner._totalLength += delLength;\r\n\t\t\t\tthis._endIndex++;\r\n\t\t\t}\r\n\t\t\tthis._isTempEndVertex = true;\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @internal\r\n\t * \r\n\t */\r\n\tprivate _updateVerticesByPositionData(position: Vector3, pointAtoBVector3: Vector3, index: number): void {\r\n\t\tvar vertexOffset: number = this._floatCountPerVertices1 * 2 * index;\r\n\t\tvar curtime: number = this._owner._curtime;\r\n\t\tthis._vertices1[vertexOffset] = position.x;\r\n\t\tthis._vertices1[vertexOffset + 1] = position.y;\r\n\t\tthis._vertices1[vertexOffset + 2] = position.z;\r\n\t\tthis._vertices1[vertexOffset + 3] = -pointAtoBVector3.x;\r\n\t\tthis._vertices1[vertexOffset + 4] = -pointAtoBVector3.y;\r\n\t\tthis._vertices1[vertexOffset + 5] = -pointAtoBVector3.z;\r\n\t\tthis._vertices1[vertexOffset + 6] = curtime;\r\n\t\tthis._vertices1[vertexOffset + 7] = 1.0;\r\n\r\n\t\tthis._vertices1[vertexOffset + 8] = position.x;\r\n\t\tthis._vertices1[vertexOffset + 9] = position.y;\r\n\t\tthis._vertices1[vertexOffset + 10] = position.z;\r\n\t\tthis._vertices1[vertexOffset + 11] = pointAtoBVector3.x;\r\n\t\tthis._vertices1[vertexOffset + 12] = pointAtoBVector3.y;\r\n\t\tthis._vertices1[vertexOffset + 13] = pointAtoBVector3.z;\r\n\t\tthis._vertices1[vertexOffset + 14] = curtime;\r\n\t\tthis._vertices1[vertexOffset + 15] = 0.0;\r\n\r\n\t\t//\r\n\t\tvar bounds: Bounds = this._owner._ownerRender.bounds;\r\n\t\tvar min: Vector3 = bounds.getMin();\r\n\t\tvar max: Vector3 = bounds.getMax();\r\n\t\tvar up: Vector3 = TrailGeometry._tempVector35;\r\n\t\tvar down: Vector3 = TrailGeometry._tempVector36;\r\n\t\tvar out: Vector3 = TrailGeometry._tempVector32;\r\n\t\tVector3.add(position, pointAtoBVector3, up);\r\n\t\tVector3.subtract(position, pointAtoBVector3, down);\r\n\r\n\t\tVector3.min(down, up, out);\r\n\t\tVector3.min(min, out, min);\r\n\t\tbounds.setMin(min);\r\n\r\n\t\tVector3.max(up, down, out);\r\n\t\tVector3.max(max, out, max);\r\n\t\tbounds.setMax(max);\r\n\r\n\r\n\t\tvar floatCount: number = this._floatCountPerVertices1 * 2;\r\n\t\tthis._vertexBuffer1.setData(this._vertices1.buffer, vertexOffset * 4, vertexOffset * 4, floatCount * 4);\r\n\t}\r\n\r\n\t/**\r\n\t * @internal\r\n\t * \r\n\t */\r\n\tprivate _updateVerticesByPosition(position: Vector3, pointAtoBVector3: Vector3, delDistance: number, index: number): void {\r\n\t\tthis._updateVerticesByPositionData(position, pointAtoBVector3, index);\r\n\t\tthis._subDistance[index] = delDistance;\r\n\t\tthis._subBirthTime[index] = this._owner._curtime;\r\n\t}\r\n\r\n\t/**\r\n\t * @internal\r\n\t * VertexBuffer2\r\n\t */\r\n\t_updateVertexBufferUV(): void {\r\n\t\tvar bounds: Bounds;\r\n\t\tvar min: Vector3, max: Vector3;\r\n\t\tif (this._disappearBoundsMode) {//\r\n\t\t\tbounds = this._owner._ownerRender.bounds;\r\n\t\t\tvar sprite3dPosition: Vector3 = (this._owner._ownerRender.owner as Sprite3D).transform.position;\r\n\t\t\tbounds.setMin(sprite3dPosition);\r\n\t\t\tbounds.setMax(sprite3dPosition);\r\n\t\t\tmin = bounds.getMin();\r\n\t\t\tmax = bounds.getMax();\r\n\t\t}\r\n\t\tvar vertexCount: number = this._endIndex;\r\n\t\tvar curLength: number = 0;\r\n\r\n\t\tvar gradient: Gradient = this._owner.colorGradient;\r\n\t\tvar startAlphaIndex: number = gradient.colorAlphaKeysCount - 1;\r\n\t\tvar startColorIndex: number = gradient.colorRGBKeysCount - 1;\r\n\r\n\t\tvar totalLength: number = this._owner._totalLength;\r\n\t\tvar stride: number = this._floatCountPerVertices2 * 2;\r\n\t\tfor (var i: number = this._activeIndex; i < vertexCount; i++) {\r\n\t\t\t(i !== this._activeIndex) && (curLength += this._subDistance[i]);\r\n\t\t\tvar uvX: number;\r\n\t\t\tvar lerpFactor: number;\r\n\t\t\tif (this._owner.textureMode == TrailTextureMode.Stretch) {\r\n\t\t\t\tuvX = 1.0 - curLength / totalLength;\r\n\t\t\t\tlerpFactor = uvX;\r\n\t\t\t} else {\r\n\t\t\t\tlerpFactor = 1.0 - curLength / totalLength;\r\n\t\t\t\tuvX = 1.0 - (totalLength - curLength);\r\n\t\t\t}\r\n\r\n\t\t\tstartColorIndex = gradient.evaluateColorRGB(lerpFactor, this.tmpColor, startColorIndex, true);\r\n\t\t\tstartAlphaIndex = gradient.evaluateColorAlpha(lerpFactor, this.tmpColor, startAlphaIndex, true);\r\n\r\n\t\t\tvar index: number = i * stride;\r\n\t\t\tthis._vertices2[index + 0] = uvX;\r\n\t\t\tthis._vertices2[index + 1] = this.tmpColor.r;\r\n\t\t\tthis._vertices2[index + 2] = this.tmpColor.g;\r\n\t\t\tthis._vertices2[index + 3] = this.tmpColor.b;\r\n\t\t\tthis._vertices2[index + 4] = this.tmpColor.a;\r\n\r\n\t\t\tthis._vertices2[index + 5] = uvX;\r\n\t\t\tthis._vertices2[index + 6] = this.tmpColor.r;\r\n\t\t\tthis._vertices2[index + 7] = this.tmpColor.g;\r\n\t\t\tthis._vertices2[index + 8] = this.tmpColor.b;\r\n\t\t\tthis._vertices2[index + 9] = this.tmpColor.a;\r\n\r\n\t\t\tif (this._disappearBoundsMode) {\r\n\t\t\t\tvar posOffset = this._floatCountPerVertices1 * 2 * i;\r\n\t\t\t\tvar pos: Vector3 = TrailGeometry._tempVector32;\r\n\t\t\t\tvar up: Vector3 = TrailGeometry._tempVector33;\r\n\t\t\t\tvar side: Vector3 = TrailGeometry._tempVector34;\r\n\r\n\t\t\t\tpos.setValue(this._vertices1[posOffset + 0], this._vertices1[posOffset + 1], this._vertices1[posOffset + 2]);\r\n\t\t\t\tup.setValue(this._vertices1[posOffset + 3], this._vertices1[posOffset + 4], this._vertices1[posOffset + 5]);\r\n\r\n\t\t\t\tVector3.add(pos, up, side);\r\n\t\t\t\tVector3.min(side, min, min);\r\n\t\t\t\tVector3.max(side, max, max);\r\n\t\t\t\tVector3.subtract(pos, up, side);\r\n\t\t\t\tVector3.min(side, min, min);\r\n\t\t\t\tVector3.max(side, max, max);\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (this._disappearBoundsMode) {\r\n\t\t\tbounds.setMin(min);\r\n\t\t\tbounds.setMax(max);\r\n\t\t\tthis._disappearBoundsMode = false;\r\n\t\t}\r\n\t\tvar offset: number = this._activeIndex * stride;\r\n\t\tthis._vertexBuffer2.setData(this._vertices2.buffer, offset * 4, offset * 4, (vertexCount * stride - offset) * 4);\r\n\t}\r\n\r\n\t/**\r\n\t * @internal\r\n\t */\r\n\t_updateDisappear(): void {\r\n\t\tvar count: number = this._endIndex;\r\n\t\tfor (var i: number = this._activeIndex; i < count; i++) {\r\n\t\t\tif (this._owner._curtime - this._subBirthTime[i] >= this._owner.time + MathUtils3D.zeroTolerance) {\r\n\t\t\t\tvar nextIndex: number = i + 1;\r\n\t\t\t\tif (nextIndex !== count)\r\n\t\t\t\t\tthis._owner._totalLength -= this._subDistance[nextIndex];//\r\n\r\n\t\t\t\tif (this._isTempEndVertex && (nextIndex === count - 1)) {//\r\n\t\t\t\t\tvar fixedPos: Vector3 = this._lastFixedVertexPosition;\r\n\t\t\t\t\tfixedPos.x = this._vertices1[0];\r\n\t\t\t\t\tfixedPos.y = this._vertices1[1];\r\n\t\t\t\t\tfixedPos.z = this._vertices1[2];\r\n\t\t\t\t\tthis._isTempEndVertex = false;\r\n\t\t\t\t}\r\n\t\t\t\tthis._activeIndex++;\r\n\t\t\t\tthis._disappearBoundsMode = true;\r\n\t\t\t} else {\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t * @override\r\n\t */\r\n\t_getType(): number {\r\n\t\treturn TrailGeometry._type;\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t * @internal\r\n\t * @override\r\n\t */\r\n\t_prepareRender(state: RenderContext3D): boolean {\r\n\t\treturn this._endIndex - this._activeIndex > 1;//01\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t * @internal\r\n\t * @override\r\n\t */\r\n\t_updateRenderParams(state: RenderContext3D): void {\r\n\t\t//this._bufferState.bind();\r\n\t\tthis.clearRenderParams();\r\n\t\tvar start: number = this._activeIndex * 2;\r\n\t\tvar count: number = this._endIndex * 2 - start;\r\n\t\tthis.setDrawArrayParams(start, count);\r\n\t\t// LayaGL.renderDrawConatext.drawArrays(MeshTopology.TriangleStrip,start,count);\r\n\t\t// Stat.trianglesFaces += count - 2;\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t * @override\r\n\t */\r\n\tdestroy(): void {\r\n\t\tsuper.destroy();\r\n\t\tvar memorySize: number = this._vertexBuffer1._byteLength + this._vertexBuffer2._byteLength;\r\n\t\tResource._addMemory(-memorySize, -memorySize);\r\n\t\tthis.bufferState.destroy();\r\n\t\tthis._vertexBuffer1.destroy();\r\n\t\tthis._vertexBuffer2.destroy();\r\n\r\n\t\tthis.bufferState = null;\r\n\t\tthis._vertices1 = null;\r\n\t\tthis._vertexBuffer1 = null;\r\n\t\tthis._vertices2 = null;\r\n\t\tthis._vertexBuffer2 = null;\r\n\t\tthis._subBirthTime = null;\r\n\t\tthis._subDistance = null;\r\n\t\tthis._lastFixedVertexPosition = null;\r\n\t\tthis._disappearBoundsMode = false;\r\n\t}\r\n\r\n\tclear(): void {\r\n\t\tthis._activeIndex = 0;\r\n\t\tthis._endIndex = 0;\r\n\t\tthis._disappearBoundsMode = false;\r\n\t\tthis._subBirthTime.fill(0);\r\n\t\tthis._subDistance.fill(0);\r\n\t\tthis._segementCount = 0;\r\n\t\tthis._isTempEndVertex = false;\r\n\t\tthis._needAddFirstVertex = false;\r\n\t\tthis._lastFixedVertexPosition.setValue(0, 0, 0);\r\n\t}\r\n}\r\n\r\n","import { Camera } from \"../Camera\";\r\nimport { FloatKeyframe } from \"../FloatKeyframe\";\r\nimport { GeometryElement } from \"../GeometryElement\";\r\nimport { GradientMode } from \"../GradientMode\";\r\nimport { BaseRender } from \"../render/BaseRender\";\r\nimport { RenderContext3D } from \"../render/RenderContext3D\";\r\nimport { RenderElement } from \"../render/RenderElement\";\r\nimport { TrailGeometry } from \"./TrailGeometry\";\r\nimport { TrailMaterial } from \"./TrailMaterial\";\r\nimport { TrailRenderer } from \"./TrailRenderer\";\r\nimport { Sprite3D } from \"../Sprite3D\";\r\nimport { Shader3D } from \"../../../RenderEngine/RenderShader/Shader3D\";\r\nimport { TrailAlignment } from \"./TrailAlignment\";\r\nimport { TrailTextureMode } from \"../TrailTextureMode\";\r\nimport { Color } from \"../../../maths/Color\";\r\nimport { Vector3 } from \"../../../maths/Vector3\";\r\nimport { ShaderDataType } from \"../../../RenderEngine/RenderShader/ShaderData\";\r\nimport { Gradient } from \"../Gradient\";\r\nimport { LayaGL } from \"../../../layagl/LayaGL\";\r\n\r\n\r\n/**\r\n * <code>TrailFilter</code> \r\n */\r\nexport class TrailFilter {\r\n\tstatic CURTIME: number;\r\n\tstatic LIFETIME: number;\r\n\tstatic WIDTHCURVE: number;\r\n\tstatic WIDTHCURVEKEYLENGTH: number;\r\n\r\n\tstatic __init__() {\r\n\t\tTrailFilter.CURTIME = Shader3D.propertyNameToID(\"u_CurTime\");\r\n\t\tTrailFilter.LIFETIME = Shader3D.propertyNameToID(\"u_LifeTime\");\r\n\t\tTrailFilter.WIDTHCURVE = Shader3D.propertyNameToID(\"u_WidthCurve\");\r\n\t\tTrailFilter.WIDTHCURVEKEYLENGTH = Shader3D.propertyNameToID(\"u_WidthCurveKeyLength\");\r\n\r\n\t\tconst spriteParms = LayaGL.renderOBJCreate.createGlobalUniformMap(\"TrailRender\");\r\n\t\tspriteParms.addShaderUniform(TrailFilter.CURTIME, \"u_CurTime\", ShaderDataType.Float);\r\n\t\tspriteParms.addShaderUniform(TrailFilter.LIFETIME, \"u_LifeTime\", ShaderDataType.Float);\r\n\t\tspriteParms.addShaderUniform(TrailFilter.WIDTHCURVE, \"u_WidthCurve\", ShaderDataType.Buffer);\r\n\t\tspriteParms.addShaderUniform(TrailFilter.WIDTHCURVEKEYLENGTH, \"u_WidthCurveKeyLength\", ShaderDataType.Int);\r\n\t}\r\n\r\n\t/**@internal */\r\n\tprivate _minVertexDistance: number;\r\n\t/**@internal */\r\n\tprivate _widthMultiplier: number;\r\n\t/**@internal */\r\n\tprivate _time: number;\r\n\t/**@internal */\r\n\tprivate _widthCurve: FloatKeyframe[];\r\n\t/**@internal */\r\n\tprivate _colorGradient: Gradient;\r\n\t/**@internal */\r\n\tprivate _textureMode: TrailTextureMode = TrailTextureMode.Stretch;\r\n\t/**@internal */\r\n\tprivate _trialGeometry: GeometryElement;\r\n\t/**@internal */\r\n\t_totalLength: number = 0;\r\n\r\n\t_ownerRender: TrailRenderer;\r\n\t_lastPosition: Vector3 = new Vector3();\r\n\r\n\t_curtime: number = 0;\r\n\r\n\t/***/\r\n\talignment: TrailAlignment = TrailAlignment.View;\r\n\r\n\t/**\r\n\t * \r\n\t * @return  \r\n\t */\r\n\tget time(): number {\r\n\t\treturn this._time;\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t * @param value \r\n\t */\r\n\tset time(value: number) {\r\n\t\tthis._time = value;\r\n\t\tthis._ownerRender._shaderValues.setNumber(TrailFilter.LIFETIME, value);\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t * @return  \r\n\t */\r\n\tget minVertexDistance(): number {\r\n\t\treturn this._minVertexDistance;\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t * @param value \r\n\t */\r\n\tset minVertexDistance(value: number) {\r\n\t\tthis._minVertexDistance = value;\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t * @return  \r\n\t */\r\n\tget widthMultiplier(): number {\r\n\t\treturn this._widthMultiplier;\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t * @param value \r\n\t */\r\n\tset widthMultiplier(value: number) {\r\n\t\tthis._widthMultiplier = value;\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t * @return  \r\n\t */\r\n\tget widthCurve(): FloatKeyframe[] {\r\n\t\treturn this._widthCurve;\r\n\t}\r\n\r\n\t/**\r\n\t * 10\r\n\t * @param value \r\n\t */\r\n\tset widthCurve(value: FloatKeyframe[]) {\r\n\t\tthis._widthCurve = value;\r\n\t\tvar widthCurveFloatArray: Float32Array = new Float32Array(value.length * 4);\r\n\t\tvar i: number, j: number, index: number = 0;\r\n\t\tfor (i = 0, j = value.length; i < j; i++) {\r\n\t\t\twidthCurveFloatArray[index++] = value[i].time;\r\n\t\t\twidthCurveFloatArray[index++] = value[i].inTangent;\r\n\t\t\twidthCurveFloatArray[index++] = value[i].outTangent;\r\n\t\t\twidthCurveFloatArray[index++] = value[i].value;\r\n\t\t}\r\n\t\tthis._ownerRender._shaderValues.setBuffer(TrailFilter.WIDTHCURVE, widthCurveFloatArray);\r\n\t\tthis._ownerRender._shaderValues.setInt(TrailFilter.WIDTHCURVEKEYLENGTH, value.length);\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t * @return  \r\n\t */\r\n\tget colorGradient(): Gradient {\r\n\t\treturn this._colorGradient;\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t * @param value \r\n\t */\r\n\tset colorGradient(value: Gradient) {\r\n\t\tthis._colorGradient = value;\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t * @return  \r\n\t */\r\n\tget textureMode(): TrailTextureMode {\r\n\t\treturn this._textureMode;\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t * @param value \r\n\t */\r\n\tset textureMode(value: TrailTextureMode) {\r\n\t\tthis._textureMode = value;\r\n\t}\r\n\r\n\tconstructor(owner: TrailRenderer) {\r\n\t\tthis._ownerRender = owner;\r\n\t\tthis._initDefaultData();\r\n\t\tthis.addRenderElement();\r\n\t}\r\n\r\n\r\n\r\n\t/**\r\n\t * @internal\r\n\t */\r\n\taddRenderElement(): void {\r\n\t\tvar render: TrailRenderer = (<TrailRenderer>this._ownerRender);\r\n\t\tvar elements: RenderElement[] = render._renderElements;\r\n\r\n\t\tvar element: RenderElement = new RenderElement();\r\n\t\telement.setTransform((this._ownerRender.owner as Sprite3D)._transform);\r\n\t\telement.render = render;\r\n\t\tthis._trialGeometry = new TrailGeometry(this);\r\n\t\telement.setGeometry(this._trialGeometry);\r\n\t\telements.push(element);\r\n\r\n\t\trender.sharedMaterial = render.sharedMaterial;\r\n\t}\r\n\r\n\t/**\r\n\t * @internal\r\n\t */\r\n\t_update(state: RenderContext3D): void {\r\n\t\tvar render: BaseRender = this._ownerRender;\r\n\t\tconst scene = this._ownerRender.owner.scene\r\n\t\tif (!scene)\r\n\t\t\treturn;\r\n\t\tthis._curtime += scene.timer._delta / 1000;\r\n\t\t//\r\n\t\trender._shaderValues.setNumber(TrailFilter.CURTIME, this._curtime);\r\n\t\t//\r\n\t\tvar curPos: Vector3 = (this._ownerRender.owner as Sprite3D).transform.position;\r\n\t\tvar element: TrailGeometry = (<TrailGeometry>render._renderElements[0]._geometry);\r\n\t\telement._updateDisappear();\r\n\t\telement._updateTrail((<Camera>state.camera), this._lastPosition, curPos);\r\n\t\telement._updateVertexBufferUV();\r\n\t\t//lastPosition\r\n\t\tcurPos.cloneTo(this._lastPosition);\r\n\t}\r\n\r\n\t/**\r\n\t * @internal\r\n\t */\r\n\t_initDefaultData(): void {\r\n\t\tthis.time = 5.0;\r\n\t\tthis.minVertexDistance = 0.1;\r\n\t\tthis.widthMultiplier = 1;\r\n\t\tthis.textureMode = TrailTextureMode.Stretch;\r\n\r\n\t\tvar widthKeyFrames: FloatKeyframe[] = [];\r\n\t\tvar widthKeyFrame1: FloatKeyframe = new FloatKeyframe();\r\n\t\twidthKeyFrame1.time = 0;\r\n\t\twidthKeyFrame1.inTangent = 0;\r\n\t\twidthKeyFrame1.outTangent = 0;\r\n\t\twidthKeyFrame1.value = 1;\r\n\t\twidthKeyFrames.push(widthKeyFrame1);\r\n\t\tvar widthKeyFrame2: FloatKeyframe = new FloatKeyframe();\r\n\t\twidthKeyFrame2.time = 1;\r\n\t\twidthKeyFrame2.inTangent = 0;\r\n\t\twidthKeyFrame2.outTangent = 0;\r\n\t\twidthKeyFrame2.value = 1;\r\n\t\twidthKeyFrames.push(widthKeyFrame2);\r\n\t\tthis.widthCurve = widthKeyFrames;\r\n\r\n\t\tvar gradient: Gradient = new Gradient(2, 2);\r\n\t\tgradient.mode = GradientMode.Blend;\r\n\t\tgradient.addColorRGB(0, Color.WHITE);\r\n\t\tgradient.addColorRGB(1, Color.WHITE);\r\n\t\tgradient.addColorAlpha(0, 1);\r\n\t\tgradient.addColorAlpha(1, 1);\r\n\t\tthis.colorGradient = gradient;\r\n\t}\r\n\r\n\t/**\r\n\t * @internal\r\n\t */\r\n\tdestroy(): void {\r\n\t\tthis._trialGeometry.destroy();\r\n\t\tthis._trialGeometry = null;\r\n\t\tthis._widthCurve = null;\r\n\t\tthis._colorGradient = null;\r\n\t}\r\n\r\n\tclear(): void {\r\n\t\t(<TrailGeometry>this._trialGeometry).clear();\r\n\t\tthis._lastPosition.setValue(0, 0, 0);\r\n\t\tthis._curtime = 0;\r\n\t\tthis._totalLength = 0;\r\n\t}\r\n}\r\n\r\n","import { Sprite3D } from \"../Sprite3D\"\r\nimport { Transform3D } from \"../Transform3D\"\r\nimport { BaseRender } from \"../render/BaseRender\"\r\nimport { RenderContext3D } from \"../render/RenderContext3D\"\r\nimport { TrailFilter } from \"./TrailFilter\";\r\nimport { FloatKeyframe } from \"../FloatKeyframe\";\r\nimport { Gradient } from \"../Gradient\";\r\nimport { Component } from \"../../../components/Component\";\r\nimport { Bounds } from \"../../math/Bounds\";\r\nimport { TrailTextureMode } from \"../TrailTextureMode\"\r\nimport { TrailAlignment } from \"./TrailAlignment\"\r\nimport { Matrix4x4 } from \"../../../maths/Matrix4x4\";\r\n\r\n/**\r\n * <code>TrailRenderer</code> \r\n */\r\nexport class TrailRenderer extends BaseRender {\r\n\r\n    /**@internal */\r\n    _trailFilter: TrailFilter;\r\n\r\n    protected _projectionViewWorldMatrix: Matrix4x4 = new Matrix4x4();\r\n\r\n    /**\r\n     * \r\n     */\r\n    constructor() {\r\n        super();\r\n        this._supportOctree = false;\r\n\r\n    }\r\n\r\n    protected _getcommonUniformMap():Array<string>{\r\n        return [\"Sprite3D\",\"TrailRender\"];\r\n    }\r\n\r\n\r\n    protected _onAdded(): void {\r\n        this._trailFilter = new TrailFilter(this);\r\n    }\r\n\r\n    /**\r\n     * s\r\n     * @return  \r\n     */\r\n    get time(): number {\r\n        return this._trailFilter.time;\r\n    }\r\n\r\n    /**\r\n     * s\r\n     * @param value \r\n     */\r\n    set time(value: number) {\r\n        this._trailFilter.time = value;\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @return  \r\n     */\r\n    get minVertexDistance(): number {\r\n        return this._trailFilter.minVertexDistance;\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @param value \r\n     */\r\n    set minVertexDistance(value: number) {\r\n        this._trailFilter.minVertexDistance = value;\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @return  \r\n     */\r\n    get widthMultiplier(): number {\r\n        return this._trailFilter.widthMultiplier;\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @param value \r\n     */\r\n    set widthMultiplier(value: number) {\r\n        this._trailFilter.widthMultiplier = value;\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @return  \r\n     */\r\n    get widthCurve(): FloatKeyframe[] {\r\n        return this._trailFilter.widthCurve;\r\n    }\r\n\r\n    /**\r\n     * 10\r\n     * @param value \r\n     */\r\n    set widthCurve(value: FloatKeyframe[]) {\r\n        this._trailFilter.widthCurve = value;\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @return  \r\n     */\r\n    get colorGradient(): Gradient {\r\n        return this._trailFilter.colorGradient;\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @param value \r\n     */\r\n    set colorGradient(value: Gradient) {\r\n        this._trailFilter.colorGradient = value;\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @return  \r\n     */\r\n    get textureMode(): TrailTextureMode {\r\n        return this._trailFilter.textureMode;\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @param value \r\n     */\r\n    set textureMode(value: TrailTextureMode) {\r\n        this._trailFilter.textureMode = value;\r\n    }\r\n\r\n    get alignment(): TrailAlignment {\r\n        return this._trailFilter.alignment;\r\n    }\r\n\r\n    set alignment(value: TrailAlignment) {\r\n        this._trailFilter.alignment = value;\r\n    }\r\n\r\n    protected _onEnable(): void {\r\n        super._onEnable();\r\n\r\n        (this.owner as Sprite3D)._transform.position.cloneTo(this._trailFilter._lastPosition);//\r\n    }\r\n\r\n    onUpdate(): void {\r\n        this._calculateBoundingBox();\r\n    }\r\n\r\n    /**\r\n     * ,,\r\n     */\r\n    get bounds(): Bounds {\r\n        return this._bounds;\r\n    }\r\n\r\n    /**\r\n     * @inheritDoc\r\n     * @internal\r\n     * @override\r\n     */\r\n    protected _calculateBoundingBox(): void {\r\n        let context = RenderContext3D._instance;\r\n        this.boundsChange = false;\r\n        this._trailFilter._update(context);\r\n    }\r\n\r\n    /**\r\n     * @inheritDoc\r\n     * @internal\r\n     * @override\r\n     */\r\n    _renderUpdate(state: RenderContext3D, transform: Transform3D): void {\r\n        super._renderUpdate(state, transform);\r\n    }\r\n\r\n    clear(): void {\r\n        this._trailFilter.clear();\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    protected _onDestroy() {\r\n        this._trailFilter.destroy();\r\n        super._onDestroy();\r\n    }\r\n\r\n    _cloneTo(dest: Component): void {\r\n        super._cloneTo(dest);\r\n        let render = dest as TrailRenderer;\r\n        render.time = this.time;\r\n        render.minVertexDistance = this.minVertexDistance;\r\n        //render.widthCurve = this.widthCurve;\r\n        var widthCurve: FloatKeyframe[] = [];\r\n        var widthCurveData: any[] = this.widthCurve;\r\n        for (let i = 0, n = this.widthCurve.length; i < n; i++) {\r\n            widthCurve.push(widthCurveData[i].clone());\r\n        }\r\n        render.widthCurve = widthCurve;\r\n        render.colorGradient = this.colorGradient.clone();\r\n        render.textureMode = this.textureMode;\r\n        render.alignment = this.alignment;\r\n    }\r\n\r\n}\r\n\r\n","import { TrailFilter } from \"./TrailFilter\";\r\nimport { TrailRenderer } from \"./TrailRenderer\";\r\nimport { FloatKeyframe } from \"../FloatKeyframe\"\r\nimport { Gradient } from \"../Gradient\"\r\nimport { RenderableSprite3D } from \"../RenderableSprite3D\"\r\nimport { Material } from \"../../../resource/Material\";\r\nimport { Node } from \"../../../display/Node\"\r\nimport { Loader } from \"../../../net/Loader\"\r\nimport { Sprite3D } from \"../Sprite3D\";\r\nimport { Color } from \"../../../maths/Color\";\r\n\r\n/**\r\n * <code>TrailSprite3D</code> \r\n */\r\nexport class TrailSprite3D extends RenderableSprite3D {\r\n\t/**\r\n\t * @internal\r\n\t */\r\n\tstatic __init__(): void { }\r\n\r\n\t/** @internal */\r\n\tprivate _geometryFilter: TrailFilter;\r\n\r\n\t/**\r\n\t * Trail\r\n\t */\r\n\tget trailFilter(): TrailFilter {\r\n\t\treturn (<TrailFilter>this._geometryFilter);\r\n\t}\r\n\r\n\t/**\r\n\t * Trail\r\n\t */\r\n\tget trailRenderer(): TrailRenderer {\r\n\t\treturn (<TrailRenderer>this._render);\r\n\t}\r\n\r\n\tconstructor(name: string = null) {\r\n\t\tsuper(name);\r\n\t\tthis._render = this.addComponent(TrailRenderer);\r\n\t\tthis._geometryFilter = (this._render as TrailRenderer)._trailFilter;\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t * @override\r\n\t * @internal\r\n\t */\r\n\t_parse(data: any, spriteMap: any): void {\r\n\t\tsuper._parse(data, spriteMap);\r\n\t\tvar render: TrailRenderer = (<TrailRenderer>this._render);\r\n\t\tvar filter: TrailFilter = (<TrailFilter>this._geometryFilter);\r\n\t\tvar i: number, j: number;\r\n\t\tvar materials: any[] = data.materials;\r\n\t\tif (materials) {\r\n\t\t\tvar sharedMaterials: Material[] = render.sharedMaterials;\r\n\t\t\tvar materialCount: number = materials.length;\r\n\t\t\tsharedMaterials.length = materialCount;\r\n\t\t\tfor (i = 0; i < materialCount; i++)\r\n\t\t\t\tsharedMaterials[i] = Loader.getRes(materials[i].path);\r\n\t\t\trender.sharedMaterials = sharedMaterials;\r\n\t\t}\r\n\t\t//\r\n\t\tfilter.time = data.time;\r\n\t\t//\r\n\t\tfilter.minVertexDistance = data.minVertexDistance;\r\n\t\tfilter.widthMultiplier = data.widthMultiplier;\r\n\t\tfilter.textureMode = data.textureMode;\r\n\t\t(data.alignment != null) && (filter.alignment = data.alignment);\r\n\t\t//widthCurve\r\n\t\tvar widthCurve: FloatKeyframe[] = [];\r\n\t\tvar widthCurveData: any[] = data.widthCurve;\r\n\t\tfor (i = 0, j = widthCurveData.length; i < j; i++) {\r\n\t\t\tvar trailkeyframe: FloatKeyframe = new FloatKeyframe();\r\n\t\t\ttrailkeyframe.time = widthCurveData[i].time;\r\n\t\t\ttrailkeyframe.inTangent = widthCurveData[i].inTangent;\r\n\t\t\ttrailkeyframe.outTangent = widthCurveData[i].outTangent;\r\n\t\t\ttrailkeyframe.value = widthCurveData[i].value;\r\n\t\t\twidthCurve.push(trailkeyframe);\r\n\t\t}\r\n\t\tfilter.widthCurve = widthCurve;\r\n\t\t//colorGradient\r\n\t\tvar colorGradientData: any = data.colorGradient;\r\n\t\tvar colorKeys: any[] = colorGradientData.colorKeys;\r\n\t\tvar alphaKeys: any[] = colorGradientData.alphaKeys;\r\n\t\tvar colorGradient: Gradient = new Gradient(colorKeys.length, alphaKeys.length);\r\n\t\tcolorGradient.mode = colorGradientData.mode;\r\n\r\n\t\tfor (i = 0, j = colorKeys.length; i < j; i++) {\r\n\t\t\tvar colorKey: any = colorKeys[i];\r\n\t\t\tcolorGradient.addColorRGB(colorKey.time, new Color(colorKey.value[0], colorKey.value[1], colorKey.value[2], 1.0));\r\n\t\t}\r\n\r\n\t\tfor (i = 0, j = alphaKeys.length; i < j; i++) {\r\n\t\t\tvar alphaKey: any = alphaKeys[i];\r\n\t\t\tcolorGradient.addColorAlpha(alphaKey.time, alphaKey.value);\r\n\t\t}\r\n\t\tfilter.colorGradient = colorGradient;\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t * @override\r\n\t * @internal\r\n\t */\r\n\t_cloneTo(destObject: any, srcSprite: Node, dstSprite: Node): void {\r\n\t\tsuper._cloneTo(destObject, srcSprite, dstSprite);\r\n\t}\r\n\r\n\tclear(): void {\r\n\t\t(this._render as TrailRenderer).clear();\r\n\t}\r\n\r\n\t/**\r\n\t * @internal\r\n\t */\r\n\tprotected _create(): Node {\r\n\t\treturn new Sprite3D();\r\n\t}\r\n}\r\n\r\n","import { GeometryElement } from \"../core/GeometryElement\";\r\nimport { RenderContext3D } from \"../core/render/RenderContext3D\";\r\nimport { SubMeshRenderElement } from \"../core/render/SubMeshRenderElement\";\r\nimport { SubMesh } from \"../resource/models/SubMesh\";\r\nimport { VertexBuffer3D } from \"./VertexBuffer3D\";\r\nimport { BufferUsage } from \"../../RenderEngine/RenderEnum/BufferTargetType\";\r\nimport { MeshTopology } from \"../../RenderEngine/RenderEnum/RenderPologyMode\";\r\nimport { DrawType } from \"../../RenderEngine/RenderEnum/DrawType\";\r\nimport { IndexFormat } from \"../../RenderEngine/RenderEnum/IndexFormat\";\r\nimport { VertexMesh } from \"../../RenderEngine/RenderShader/VertexMesh\";\r\nimport { Laya3DRender } from \"../RenderObjs/Laya3DRender\";\r\n\r\n/**\r\n * \r\n * @internal\r\n */\r\nexport class SubMeshInstanceBatch extends GeometryElement {\r\n\t/** @internal */\r\n\tstatic instance: SubMeshInstanceBatch;\r\n\t/** @internal */\r\n\tstatic maxInstanceCount: number = 1024;\r\n\r\n\t/**\r\n\t * @internal\r\n\t */\r\n\tstatic __init__(): void {\r\n\t\tSubMeshInstanceBatch.instance = new SubMeshInstanceBatch();\r\n\t}\r\n\r\n\t/** @internal */\r\n\tinstanceWorldMatrixData: Float32Array = new Float32Array(SubMeshInstanceBatch.maxInstanceCount * 16);\r\n\t/** @internal */\r\n\tinstanceWorldMatrixBuffer: VertexBuffer3D;\r\n\t/**SimpleAnimator */\r\n\t/** @internal */\r\n\tinstanceSimpleAnimatorData: Float32Array = new Float32Array(SubMeshInstanceBatch.maxInstanceCount * 4);\r\n\t/** @internal */\r\n\tinstanceSimpleAnimatorBuffer: VertexBuffer3D;\r\n\r\n\t/**\r\n\t *  <code>InstanceSubMesh</code> \r\n\t */\r\n\tconstructor() {\r\n\t\tsuper(MeshTopology.Triangles, DrawType.DrawElementInstance);\r\n\t\tthis.indexFormat = IndexFormat.UInt16;\r\n\t\tthis.instanceWorldMatrixBuffer = Laya3DRender.renderOBJCreate.createVertexBuffer3D(this.instanceWorldMatrixData.length * 4, BufferUsage.Dynamic, false);\r\n\t\tthis.instanceWorldMatrixBuffer.vertexDeclaration = VertexMesh.instanceWorldMatrixDeclaration;\r\n\t\tthis.instanceWorldMatrixBuffer.instanceBuffer = true;\r\n\t\t//SImpleAnimator\r\n\t\tthis.instanceSimpleAnimatorBuffer = Laya3DRender.renderOBJCreate.createVertexBuffer3D(this.instanceSimpleAnimatorData.length * 4, BufferUsage.Dynamic, false);\r\n\t\tthis.instanceSimpleAnimatorBuffer.vertexDeclaration = VertexMesh.instanceSimpleAnimatorDeclaration;\r\n\t\tthis.instanceSimpleAnimatorBuffer.instanceBuffer = true;\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t * @override\r\n\t */\r\n\t_updateRenderParams(state: RenderContext3D): void {\r\n\t\tvar element: SubMeshRenderElement = (<SubMeshRenderElement>state.renderElement);\r\n\t\tvar subMesh: SubMesh = element.instanceSubMesh;\r\n\t\tvar count: number = element.instanceBatchElementList.length;\r\n\t\tvar indexCount: number = subMesh._indexCount;\r\n\t\t//subMesh._mesh._instanceBufferState.bind();\r\n\t\tthis.clearRenderParams();\r\n\t\tthis.bufferState = subMesh._mesh._instanceBufferState;\r\n\t\tthis.instanceCount = count;\r\n\t\tthis.setDrawElemenParams(indexCount, subMesh._indexStart * 2);\r\n\t\t//LayaGL.renderDrawConatext.drawElementsInstanced(MeshTopology.Triangles, indexCount, IndexFormat.UInt16, subMesh._indexStart * 2, count);\r\n\t\t//Stat.renderBatches++;\r\n\t\t//Stat.savedRenderBatches += count - 1;\r\n\t\t//Stat.trianglesFaces += indexCount * count / 3;\r\n\t}\r\n\r\n\r\n}\r\n\r\n","import { IVertex } from \"../IVertex\"\r\nimport { VertexDeclaration } from \"../../../RenderEngine/VertexDeclaration\"\r\nimport { Vector2 } from \"../../../maths/Vector2\";\r\nimport { Vector3 } from \"../../../maths/Vector3\";\r\nimport { VertexElementFormat } from \"../../../renders/VertexElementFormat\";\r\nimport { VertexElement } from \"../../../renders/VertexElement\";\r\n\r\n/**\r\n * @internal\r\n * <code>VertexPositionTerrain</code> 12\r\n */\r\nexport class VertexPositionTerrain implements IVertex {\r\n\tstatic TERRAIN_POSITION0: number = 0;\r\n\tstatic TERRAIN_NORMAL0: number = 1;\r\n\tstatic TERRAIN_TEXTURECOORDINATE0: number = 2;\r\n\tstatic TERRAIN_TEXTURECOORDINATE1: number = 3;\r\n\r\n\tprivate static _vertexDeclaration: VertexDeclaration;\r\n\r\n\t/**\r\n\t * @internal\r\n\t */\r\n\tstatic __init__(): void {\r\n\t\tVertexPositionTerrain._vertexDeclaration = new VertexDeclaration(40, [new VertexElement(0, VertexElementFormat.Vector3, VertexPositionTerrain.TERRAIN_POSITION0),\r\n\t\tnew VertexElement(12, VertexElementFormat.Vector3, VertexPositionTerrain.TERRAIN_NORMAL0),\r\n\t\tnew VertexElement(24, VertexElementFormat.Vector2, VertexPositionTerrain.TERRAIN_TEXTURECOORDINATE0),\r\n\t\tnew VertexElement(32, VertexElementFormat.Vector2, VertexPositionTerrain.TERRAIN_TEXTURECOORDINATE1)]);\r\n\t}\r\n\r\n\tstatic get vertexDeclaration(): VertexDeclaration {\r\n\t\treturn VertexPositionTerrain._vertexDeclaration;\r\n\t}\r\n\r\n\tprivate _position: Vector3;\r\n\tprivate _normal: Vector3;\r\n\tprivate _textureCoord0: Vector2;\r\n\tprivate _textureCoord1: Vector2;\r\n\r\n\tget position(): Vector3 {\r\n\t\treturn this._position;\r\n\t}\r\n\r\n\tget normal(): Vector3 {\r\n\t\treturn this._normal;\r\n\t}\r\n\r\n\tget textureCoord0(): Vector2 {\r\n\t\treturn this._textureCoord0;\r\n\t}\r\n\r\n\tget textureCoord1(): Vector2 {\r\n\t\treturn this._textureCoord1;\r\n\t}\r\n\r\n\tget vertexDeclaration(): VertexDeclaration {\r\n\t\treturn VertexPositionTerrain._vertexDeclaration;\r\n\t}\r\n\r\n\tconstructor(position: Vector3, normal: Vector3, textureCoord0: Vector2, textureCoord1: Vector2) {\r\n\t\tthis._position = position;\r\n\t\tthis._normal = normal;\r\n\t\tthis._textureCoord0 = textureCoord0;\r\n\t\tthis._textureCoord1 = textureCoord1;\r\n\t}\r\n\r\n}\r\n\r\n\r\n","import { ILaya3D } from \"../../../../ILaya3D\";\r\nimport { Matrix4x4 } from \"../../../maths/Matrix4x4\";\r\nimport { Vector4 } from \"../../../maths/Vector4\";\r\nimport { IRenderContext3D } from \"../../../RenderEngine/RenderInterface/RenderPipelineInterface/IRenderContext3D\";\r\nimport { DefineDatas } from \"../../../RenderEngine/RenderShader/DefineDatas\";\r\nimport { ShaderInstance } from \"../../../RenderEngine/RenderShader/ShaderInstance\";\r\nimport { ShaderPass } from \"../../../RenderEngine/RenderShader/ShaderPass\";\r\nimport { FastSinglelist } from \"../../../utils/SingletonList\";\r\nimport { MeshInstanceGeometry } from \"../../graphics/MeshInstanceGeometry\";\r\nimport { Laya3DRender } from \"../../RenderObjs/Laya3DRender\";\r\nimport { InstanceRenderElementOBJ } from \"../../RenderObjs/RenderObj/InstanceRenderElementOBJ\";\r\nimport { Mesh } from \"../../resource/models/Mesh\";\r\nimport { Camera } from \"../Camera\";\r\nimport { MeshSprite3DShaderDeclaration } from \"../MeshSprite3DShaderDeclaration\";\r\nimport { RenderableSprite3D } from \"../RenderableSprite3D\";\r\nimport { SimpleSkinnedMeshRenderer } from \"../SimpleSkinnedMeshRenderer\";\r\nimport { Sprite3D } from \"../Sprite3D\";\r\nimport { Transform3D } from \"../Transform3D\";\r\nimport { BaseRender } from \"./BaseRender\";\r\nimport { RenderContext3D } from \"./RenderContext3D\";\r\nimport { RenderElement } from \"./RenderElement\";\r\n\r\nexport class InstanceRenderElement extends RenderElement {\r\n    /** @internal */\r\n    static maxInstanceCount: number = 1024;\r\n    /**@internal */\r\n    private static _pool: InstanceRenderElement[] = [];\r\n\r\n    static create(): InstanceRenderElement {\r\n        let elemet = InstanceRenderElement._pool.length > 0 ? InstanceRenderElement._pool.pop() : new InstanceRenderElement();\r\n        elemet._isInPool = false;\r\n        elemet.clear();\r\n        return elemet;\r\n    }\r\n    /**@internal */\r\n    _instanceBatchElementList: FastSinglelist<RenderElement>\r\n    /**@internal */\r\n    _isInPool: boolean;\r\n    /**\r\n     * @internal\r\n     *  \r\n     * */\r\n    _isUpdataData: boolean;\r\n    /** @internal */\r\n    _invertFrontFace: boolean;\r\n    /**@internal recover renderData*/\r\n    private oriRendertype: number;\r\n    /**@internal */\r\n    private _InvertFront: boolean = false;\r\n\r\n    constructor() {\r\n        super();\r\n        this.setGeometry(new MeshInstanceGeometry(null));\r\n        this._instanceBatchElementList = new FastSinglelist();\r\n        this._isUpdataData = true;\r\n        this._invertFrontFace = false;\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    getInvertFront(): boolean {\r\n        return this._invertFrontFace;\r\n    }\r\n\r\n    set InvertFront(value: boolean) {\r\n        this._InvertFront = value;\r\n\r\n    }\r\n\r\n    protected _createRenderElementOBJ() {\r\n        this._renderElementOBJ = Laya3DRender.renderOBJCreate.createInstanceRenderElement();\r\n    }\r\n\r\n    compileShader(context: IRenderContext3D) {\r\n        var passes: ShaderPass[] = this._subShader._passes;\r\n        this._renderElementOBJ._clearShaderInstance();\r\n        for (var j: number = 0, m: number = passes.length; j < m; j++) {\r\n            var pass: ShaderPass = passes[j];\r\n            //NOTE:this will cause maybe a shader not render but do prepare beforebut the developer can avoide this manual,for example shaderCaster=false.\r\n            if (pass._pipelineMode !== context.pipelineMode)\r\n                continue;\r\n            var comDef: DefineDatas = RenderElement._compileDefine;\r\n\r\n            // todo\r\n            context.sceneShaderData._defineDatas.cloneTo(comDef);\r\n            if (this.render) {\r\n                comDef.addDefineDatas(this.render._shaderValues._defineDatas);\r\n                pass.nodeCommonMap = this.render._commonUniformMap;\r\n            } else {\r\n                pass.nodeCommonMap = null;\r\n            }\r\n\r\n\r\n            comDef.addDefineDatas(this._renderElementOBJ._materialShaderData._defineDatas);\r\n            //add Instance Define\r\n            comDef.add(MeshSprite3DShaderDeclaration.SHADERDEFINE_GPU_INSTANCE);\r\n\r\n            var shaderIns: ShaderInstance = pass.withCompile(comDef);\r\n            this._renderElementOBJ._addShaderInstance(shaderIns);\r\n        }\r\n    }\r\n\r\n\r\n    _renderUpdatePre(context: RenderContext3D) {\r\n        var sceneMark: number = ILaya3D.Scene3D._updateMark;\r\n        var transform: Transform3D = this.transform;\r\n        context.renderElement = this;\r\n        //model local\r\n        var modelDataRender: boolean = (!!this.render) ? (sceneMark !== this.render._sceneUpdateMark || this.renderType !== this.render._updateRenderType) : false;\r\n        if (modelDataRender) {\r\n            this.render._renderUpdate(context, transform);\r\n            this.render._sceneUpdateMark = sceneMark;\r\n        }\r\n        //camera\r\n        var updateMark: number = Camera._updateMark;\r\n        if (true) {//\r\n            this.render._renderUpdateWithCamera(context, transform);\r\n            this.oriRendertype = this.render._updateRenderType\r\n            this.render._updateMark = updateMark;\r\n            this.render._updateRenderType = this.renderType;\r\n            if (this._isUpdataData) {\r\n                let mesh = (this._geometry as MeshInstanceGeometry).subMesh._mesh;\r\n                this.updateInstanceData(mesh);\r\n                this._isUpdataData = false;\r\n            }\r\n        }\r\n\r\n        const subUbo = (!!this.render) ? this.render._subUniformBufferData : false;\r\n        if (subUbo) {\r\n            subUbo._needUpdate && BaseRender._transLargeUbO.updateSubData(subUbo);\r\n        }\r\n        this._renderElementOBJ._isRender = this._geometry._prepareRender(context);\r\n        this._geometry._updateRenderParams(context);\r\n        this.compileShader(context._contextOBJ);\r\n        this._geometry.instanceCount = this._instanceBatchElementList.length;\r\n        this._renderElementOBJ._invertFront = this.getInvertFront();\r\n    }\r\n\r\n    updateInstanceData(mesh: Mesh) {\r\n        mesh._setInstanceBuffer();\r\n        (this._renderElementOBJ as InstanceRenderElementOBJ).clear();\r\n        this._geometry.bufferState = mesh._instanceBufferState;\r\n        switch (mesh._instanceBufferStateType) {\r\n            case Mesh.MESH_INSTANCEBUFFER_TYPE_SIMPLEANIMATOR:\r\n                //worldMatrix\r\n                var worldMatrixData: Float32Array = (this._renderElementOBJ as InstanceRenderElementOBJ).getUpdateData(0, 16 * InstanceRenderElement.maxInstanceCount);\r\n                (this._renderElementOBJ as InstanceRenderElementOBJ).addUpdateBuffer(mesh._instanceWorldVertexBuffer, 16);\r\n                var insBatches = this._instanceBatchElementList;\r\n                var elements = insBatches.elements;\r\n                var count: number = insBatches.length;\r\n                (this._renderElementOBJ as InstanceRenderElementOBJ).drawCount = count;\r\n                let bone = (elements[0].render as SimpleSkinnedMeshRenderer).rootBone;\r\n                if (bone) {\r\n                    for (var i: number = 0; i < count; i++) {\r\n                        var mat: Matrix4x4 = (((elements[i].render) as SimpleSkinnedMeshRenderer).rootBone as Sprite3D)._transform.worldMatrix;\r\n                        worldMatrixData.set(mat.elements, i * 16);\r\n                    }\r\n                }\r\n                else {\r\n                    for (var i: number = 0; i < count; i++)\r\n                        worldMatrixData.set(elements[i].transform.worldMatrix.elements, i * 16);\r\n                }\r\n                //simpleAnimationData\r\n                var simpleAnimatorData: Float32Array = (this._renderElementOBJ as InstanceRenderElementOBJ).getUpdateData(1, 4 * InstanceRenderElement.maxInstanceCount);\r\n                if (bone) {\r\n                    for (var i: number = 0; i < count; i++) {\r\n                        var render: SimpleSkinnedMeshRenderer = (elements[i].render) as SimpleSkinnedMeshRenderer;\r\n                        render._computeAnimatorParamsData();\r\n                        var simpleAnimatorParams: Vector4 = render._simpleAnimatorParams;\r\n                        var offset: number = i * 4;\r\n                        simpleAnimatorData[offset] = simpleAnimatorParams.x;\r\n                        simpleAnimatorData[offset + 1] = simpleAnimatorParams.y;\r\n                        simpleAnimatorData[offset + 2] = simpleAnimatorParams.z;\r\n                        simpleAnimatorData[offset + 3] = simpleAnimatorParams.w;\r\n                    }\r\n                }\r\n                else {\r\n                    for (var i: number = 0; i < count; i++) {\r\n                        simpleAnimatorData[offset] = 0;\r\n                        simpleAnimatorData[offset + 1] = 0;\r\n                        simpleAnimatorData[offset + 2] = 0;\r\n                        simpleAnimatorData[offset + 3] = 0;\r\n                    }\r\n                }\r\n                (this._renderElementOBJ as InstanceRenderElementOBJ).addUpdateBuffer(mesh._instanceSimpleAniVertexBuffer, 4)\r\n                break;\r\n            case Mesh.MESH_INSTANCEBUFFER_TYPE_NORMAL:\r\n\r\n                var worldMatrixData: Float32Array = (this._renderElementOBJ as InstanceRenderElementOBJ).getUpdateData(0, 16 * InstanceRenderElement.maxInstanceCount);\r\n                (this._renderElementOBJ as InstanceRenderElementOBJ).addUpdateBuffer(mesh._instanceWorldVertexBuffer, 16);\r\n                var insBatches = this._instanceBatchElementList;\r\n                var elements: RenderElement[] = insBatches.elements;\r\n                var count: number = insBatches.length;\r\n                (this._renderElementOBJ as InstanceRenderElementOBJ).drawCount = count;\r\n                for (var i: number = 0; i < count; i++)\r\n                    worldMatrixData.set(elements[i].transform.worldMatrix.elements, i * 16);\r\n\r\n                let haveLightMap: boolean = this.render._shaderValues.hasDefine(RenderableSprite3D.SAHDERDEFINE_LIGHTMAP);\r\n                if (haveLightMap && mesh._instanceLightMapVertexBuffer) {\r\n                    var lightMapData: Float32Array = (this._renderElementOBJ as InstanceRenderElementOBJ).getUpdateData(1, 4 * InstanceRenderElement.maxInstanceCount);\r\n                    for (var i: number = 0; i < count; i++) {\r\n                        let lightmapScaleOffset = elements[i]._baseRender.lightmapScaleOffset;\r\n                        var offset: number = i * 4;\r\n                        lightMapData[offset] = lightmapScaleOffset.x;\r\n                        lightMapData[offset + 1] = lightmapScaleOffset.y;\r\n                        lightMapData[offset + 2] = lightmapScaleOffset.z;\r\n                        lightMapData[offset + 3] = lightmapScaleOffset.w;\r\n                    }\r\n                    (this._renderElementOBJ as InstanceRenderElementOBJ).addUpdateBuffer(mesh._instanceLightMapVertexBuffer, 4)\r\n                }\r\n                break;\r\n        }\r\n    }\r\n\r\n    clear() {\r\n        this._instanceBatchElementList.length = 0;\r\n    }\r\n    recover(): void {\r\n        InstanceRenderElement._pool.push(this);\r\n        this._isInPool = true;\r\n    }\r\n}","import { GeometryElement } from \"../../core/GeometryElement\";\r\nimport { RenderContext3D } from \"../../core/render/RenderContext3D\";\r\nimport { IndexBuffer3D } from \"../../graphics/IndexBuffer3D\";\r\nimport { VertexBuffer3D } from \"../../graphics/VertexBuffer3D\";\r\nimport { Mesh } from \"./Mesh\";\r\nimport { RenderCapable } from \"../../../RenderEngine/RenderEnum/RenderCapable\";\r\nimport { MeshTopology } from \"../../../RenderEngine/RenderEnum/RenderPologyMode\";\r\nimport { DrawType } from \"../../../RenderEngine/RenderEnum/DrawType\";\r\nimport { IndexFormat } from \"../../../RenderEngine/RenderEnum/IndexFormat\";\r\nimport { SkinnedMeshRenderer } from \"../../core/SkinnedMeshRenderer\";\r\nimport { LayaGL } from \"../../../layagl/LayaGL\";\r\n\r\n\r\n/**\r\n * <code>SubMesh</code> \r\n */\r\nexport class SubMesh extends GeometryElement {\r\n\r\n\t/**@internal */\r\n\tprivate static _type: number = GeometryElement._typeCounter++;\r\n\r\n\t/** @internal */\r\n\t_mesh: Mesh;\r\n\r\n\t/** @internal */\r\n\t_boneIndicesList: Uint16Array[];\r\n\t/** @internal */\r\n\t_subIndexBufferStart: number[];\r\n\t/** @internal */\r\n\t_subIndexBufferCount: number[];\r\n\r\n\t/** @internal */\r\n\t_indexInMesh: number;\r\n\t/** @internal */\r\n\t_indexStart: number;\r\n\t/** @internal */\r\n\t_indexCount: number;\r\n\t/** @internal */\r\n\t_indices: Uint16Array | Uint32Array;\r\n\t/**@internal []*/\r\n\t_vertexBuffer: VertexBuffer3D;\r\n\t/**@internal []*/\r\n\t_indexBuffer: IndexBuffer3D;\r\n\r\n\t/**\r\n\t * \r\n\t */\r\n\tget indexCount(): number {\r\n\t\treturn this._indexCount;\r\n\t}\r\n\r\n\t/**\r\n\t *  <code>SubMesh</code> \r\n\t * @param\tmesh  \r\n\t */\r\n\tconstructor(mesh: Mesh) {\r\n\t\tsuper(MeshTopology.Triangles, DrawType.DrawElement);\r\n\t\tthis.indexFormat = mesh.indexFormat;\r\n\t\tif (mesh.indexFormat === IndexFormat.UInt32 && !LayaGL.renderEngine.getCapable(RenderCapable.Element_Index_Uint32)) {\r\n\t\t\tconsole.warn(\"SubMesh:this device do not support IndexFormat.UInt32.\");\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tthis._mesh = mesh;\r\n\t\tthis._boneIndicesList = [];\r\n\t\tthis._subIndexBufferStart = [];\r\n\t\tthis._subIndexBufferCount = [];\r\n\t}\r\n\r\n\t/**\r\n\t * @internal\r\n\t */\r\n\t_setIndexRange(indexStart: number, indexCount: number, indexFormat: IndexFormat = IndexFormat.UInt16): void {\r\n\t\tthis._indexStart = indexStart;\r\n\t\tthis._indexCount = indexCount;\r\n\t\tif (this._indexBuffer.canRead) {\r\n\t\t\tif (indexFormat == IndexFormat.UInt16) {\r\n\t\t\t\tthis._indices = new Uint16Array(this._indexBuffer.getData().buffer, indexStart * 2, indexCount);\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tthis._indices = new Uint32Array(this._indexBuffer.getData().buffer, indexStart * 4, indexCount);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @internal\r\n\t * @override\r\n\t */\r\n\t_getType(): number {\r\n\t\treturn SubMesh._type;\r\n\t}\r\n\r\n\r\n\t/**\r\n\t * @internal\r\n\t * @override\r\n\t */\r\n\t_prepareRender(state: RenderContext3D): boolean {\r\n\t\tthis._mesh._uploadVerticesData();\r\n\t\treturn true;\r\n\t}\r\n\r\n\t/**\r\n\t * @internal\r\n\t * @override\r\n\t */\r\n\t_updateRenderParams(state: RenderContext3D): void {\r\n\t\tvar mesh: Mesh = this._mesh;\r\n\r\n\t\tvar skinnedDatas: any[] = (state.renderElement && !!(state.renderElement.render)) ? (<SkinnedMeshRenderer>state.renderElement.render)._skinnedData : null;\r\n\t\tvar byteCount: number;\r\n\t\tswitch (mesh._indexFormat) {\r\n\t\t\tcase IndexFormat.UInt32:\r\n\t\t\t\tbyteCount = 4;\r\n\t\t\t\tbreak;\r\n\t\t\tcase IndexFormat.UInt16:\r\n\t\t\t\tbyteCount = 2;\r\n\t\t\t\tbreak;\r\n\t\t\tcase IndexFormat.UInt8:\r\n\t\t\t\tbyteCount = 1;\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\t\tthis.clearRenderParams();\r\n\t\tthis.bufferState = mesh._bufferState;\r\n\t\tif (skinnedDatas) {\r\n\t\t\tfor (var i: number = 0, n: number = this._boneIndicesList.length; i < n; i++) {\r\n\t\t\t\tthis.setDrawElemenParams(this._subIndexBufferCount[i], this._subIndexBufferStart[i] * byteCount);\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tthis.setDrawElemenParams(this._indexCount, this._indexStart * byteCount);\r\n\t\t}\r\n\t}\r\n\r\n\r\n\t/**\r\n\t * \r\n\t */\r\n\tgetIndices(): Uint16Array | Uint32Array {\r\n\t\tif (this._mesh._isReadable)\r\n\t\t\treturn this._indices.slice();\r\n\t\telse\r\n\t\t\tthrow \"SubMesh:can't get indices on subMesh,mesh's isReadable must be true.\";\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t * @param indices \r\n\t */\r\n\tsetIndices(indices: Uint16Array): void {\r\n\t\tthis._indexBuffer.setData(indices, this._indexStart, 0, this._indexCount);\r\n\t}\r\n\r\n\t/**\r\n\t * {@inheritDoc GeometryElement.destroy}\r\n\t * @override\r\n\t */\r\n\tdestroy(): void {\r\n\t\tif (this._destroyed)\r\n\t\t\treturn;\r\n\t\tsuper.destroy();\r\n\t\tthis._indexBuffer.destroy();\r\n\t\tthis._indexBuffer = null;\r\n\t\tthis._mesh = null;\r\n\t\tthis._boneIndicesList = null;\r\n\t\tthis._subIndexBufferStart = null;\r\n\t\tthis._subIndexBufferCount = null;\r\n\t}\r\n}\r\n\r\n","import { ILaya } from \"../../../../ILaya\";\r\nimport { Loader } from \"../../../net/Loader\";\r\nimport { BufferUsage } from \"../../../RenderEngine/RenderEnum/BufferTargetType\";\r\nimport { IndexFormat } from \"../../../RenderEngine/RenderEnum/IndexFormat\";\r\nimport { VertexDeclaration } from \"../../../RenderEngine/VertexDeclaration\";\r\nimport { Resource } from \"../../../resource/Resource\";\r\nimport { Handler } from \"../../../utils/Handler\";\r\nimport { IClone } from \"../../../utils/IClone\";\r\nimport { InstanceRenderElement } from \"../../core/render/InstanceRenderElement\";\r\nimport { IndexBuffer3D } from \"../../graphics/IndexBuffer3D\";\r\nimport { VertexBuffer3D } from \"../../graphics/VertexBuffer3D\";\r\nimport { Bounds } from \"../../math/Bounds\";\r\nimport { SubMesh } from \"./SubMesh\";\r\nimport { Color } from \"../../../maths/Color\";\r\nimport { Matrix4x4 } from \"../../../maths/Matrix4x4\";\r\nimport { Vector2 } from \"../../../maths/Vector2\";\r\nimport { Vector3 } from \"../../../maths/Vector3\";\r\nimport { Vector4 } from \"../../../maths/Vector4\";\r\nimport { VertexElementFormat } from \"../../../renders/VertexElementFormat\";\r\nimport { VertexElement } from \"../../../renders/VertexElement\";\r\nimport { BufferState } from \"../../../webgl/utils/BufferState\";\r\nimport { VertexMesh } from \"../../../RenderEngine/RenderShader/VertexMesh\";\r\nimport { MorphTargetData } from \"./MorphTargetData\";\r\nimport { Config } from \"../../../../Config\";\r\nimport { Laya3D } from \"../../../../Laya3D\";\r\nimport { EPhysicsCapable } from \"../../../Physics3D/physicsEnum/EPhycisCapable\";\r\nimport { Laya3DRender } from \"../../RenderObjs/Laya3DRender\";\r\n/**\r\n * @internal\r\n */\r\nexport class skinnedMatrixCache {\r\n    readonly subMeshIndex: number;\r\n    readonly batchIndex: number;\r\n    readonly batchBoneIndex: number;\r\n    constructor(subMeshIndex: number, batchIndex: number, batchBoneIndex: number) {\r\n        this.subMeshIndex = subMeshIndex;\r\n        this.batchIndex = batchIndex;\r\n        this.batchBoneIndex = batchBoneIndex;\r\n    }\r\n}\r\n\r\n/**\r\n * <code>Mesh</code> \r\n */\r\nexport class Mesh extends Resource implements IClone {\r\n\r\n    static MESH_INSTANCEBUFFER_TYPE_NORMAL: number = 0;\r\n\r\n    static MESH_INSTANCEBUFFER_TYPE_SIMPLEANIMATOR: number = 1;\r\n\r\n    /** @internal */\r\n    private _tempVector30: Vector3 = new Vector3()\r\n    /** @internal */\r\n    private _tempVector31: Vector3 = new Vector3();\r\n    // /** @internal */\r\n    // private _tempVector32: Vector3 = new Vector3();\r\n    // /** @internal */\r\n    // private static _nativeTempVector30: number;\r\n    // /** @internal */\r\n    // private static _nativeTempVector31: number;\r\n    // /** @internal */\r\n    // private static _nativeTempVector32: number;\r\n    /**@internal */\r\n    _convexMesh: any;\r\n    /**@interanl */\r\n    _triangleMesh: any;\r\n    /**@internal */\r\n    __convexMesh: Mesh;\r\n    /**\r\n      * @internal\r\n      */\r\n    static __init__(): void {\r\n        // var physics3D: any = Physics3D._bullet;\r\n        // if (physics3D) {\r\n        //     Mesh._nativeTempVector30 = physics3D.btVector3_create(0, 0, 0);\r\n        //     Mesh._nativeTempVector31 = physics3D.btVector3_create(0, 0, 0);\r\n        //     Mesh._nativeTempVector32 = physics3D.btVector3_create(0, 0, 0);\r\n        // }\r\n    }\r\n\r\n\r\n    /**\r\n     * \r\n     * @param url \r\n     * @param complete \r\n     */\r\n    static load(url: string, complete: Handler): void {\r\n        ILaya.loader.load(url, complete, null, Loader.MESH);\r\n    }\r\n\r\n    /** @internal */\r\n    private _btTriangleMesh: number;\r\n    /** @internal */\r\n    private _minVerticesUpdate: number = -1;\r\n    /** @internal */\r\n    private _maxVerticesUpdate: number = -1;\r\n    /** @internal */\r\n    private _needUpdateBounds: boolean = true;\r\n    /** @internal */\r\n    private _bounds: Bounds;\r\n\r\n    /** @internal */\r\n    _isReadable: boolean;\r\n    /** @internal */\r\n    _bufferState: BufferState = new BufferState();\r\n    /** @internal */\r\n    _instanceBufferState: BufferState;\r\n    /** @internal */\r\n    _instanceBufferStateType: number = 0;\r\n    /**@internal */\r\n    _instanceWorldVertexBuffer: VertexBuffer3D\r\n    /**@internal */\r\n    _instanceSimpleAniVertexBuffer: VertexBuffer3D\r\n    /**@internal */\r\n    _instanceLightMapVertexBuffer: VertexBuffer3D\r\n    /** @internal */\r\n    _subMeshes: SubMesh[];\r\n    /** @internal */\r\n    _vertexBuffer: VertexBuffer3D = null;\r\n    /** @internal */\r\n    _indexBuffer: IndexBuffer3D = null;\r\n\r\n    /** @internal */\r\n    _boneNames: string[];\r\n    /** @internal */\r\n    _inverseBindPoses: Matrix4x4[];\r\n    /** @internal */\r\n    _skinnedMatrixCaches: skinnedMatrixCache[] = [];\r\n    /** @internal */\r\n    _vertexCount: number = 0;\r\n    /** @internal */\r\n    _indexFormat: IndexFormat = IndexFormat.UInt16;\r\n\r\n    /** @internal */\r\n    instanceWorldMatrixData: Float32Array;\r\n    /** @internal */\r\n    instanceSimpleAnimatorData: Float32Array;\r\n    /** @internal */\r\n    instanceLightMapScaleOffsetData: Float32Array;\r\n\r\n    morphTargetData: MorphTargetData;\r\n\r\n    /** @internal */\r\n    _width: number;\r\n\r\n    /** @internal */\r\n    _height: number;\r\n\r\n    /**\r\n     * \r\n     */\r\n    get inverseAbsoluteBindPoses(): Matrix4x4[] {\r\n        return this._inverseBindPoses;\r\n    }\r\n\r\n    /**\r\n     * \r\n     */\r\n    get vertexCount(): number {\r\n        return this._vertexCount;\r\n    }\r\n\r\n    /**\r\n     * \r\n     */\r\n    get indexCount(): number {\r\n        return this._indexBuffer.indexCount;\r\n    }\r\n\r\n    /**\r\n     * SubMesh\r\n     */\r\n    get subMeshCount(): number {\r\n        return this._subMeshes.length;\r\n    }\r\n\r\n    /**\r\n     * \r\n     */\r\n    get bounds(): Bounds {\r\n        return this._bounds;\r\n    }\r\n\r\n    set bounds(value: Bounds) {\r\n        if (this._bounds !== value)\r\n            value.cloneTo(this._bounds);\r\n    }\r\n\r\n    /**\r\n     * \r\n     */\r\n    get indexFormat(): IndexFormat {\r\n        return this._indexFormat;\r\n    }\r\n\r\n\r\n    /**\r\n     * indexformat\r\n     */\r\n    set indexFormat(value: IndexFormat) {\r\n        this._indexFormat = value\r\n        this._subMeshes.forEach(element => {\r\n            element.indexFormat = value;\r\n        });\r\n    }\r\n\r\n    /**\r\n     *  <code>Mesh</code> ,\r\n     * @param isReadable \r\n     */\r\n    constructor(isReadable: boolean = true) {\r\n        super();\r\n        this._bounds = new Bounds(new Vector3(), new Vector3());\r\n        this._isReadable = isReadable;\r\n        this._subMeshes = [];\r\n        this.destroyedImmediately = Config.destroyResourceImmediatelyDefault;\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    private _getPositionElement(vertexBuffer: VertexBuffer3D): VertexElement {\r\n        var vertexElements: any[] = vertexBuffer.vertexDeclaration._vertexElements;\r\n        for (var i: number = 0, n: number = vertexElements.length; i < n; i++) {\r\n            var vertexElement: VertexElement = vertexElements[i];\r\n            if (vertexElement._elementFormat === VertexElementFormat.Vector3 && vertexElement._elementUsage === VertexMesh.MESH_POSITION0)\r\n                return vertexElement;\r\n        }\r\n        return null;\r\n    }\r\n\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    private _getVerticeElementData(data: Array<Vector2 | Vector3 | Vector4 | Color>, elementUsage: number): void {\r\n        data.length = this._vertexCount;\r\n        var verDec: VertexDeclaration = this._vertexBuffer.vertexDeclaration;\r\n        var element: VertexElement = verDec.getVertexElementByUsage(elementUsage);\r\n        if (element) {\r\n            var uint8Vertices: Uint8Array = this._vertexBuffer.getUint8Data();\r\n            var floatVertices: Float32Array = this._vertexBuffer.getFloat32Data();\r\n            var uint8VerStr: number = verDec.vertexStride;\r\n            var floatVerStr: number = uint8VerStr / 4;\r\n            var uint8EleOffset: number = element._offset;\r\n            var floatEleOffset: number = uint8EleOffset / 4;\r\n\r\n            switch (elementUsage) {\r\n                case VertexMesh.MESH_TEXTURECOORDINATE0:\r\n                case VertexMesh.MESH_TEXTURECOORDINATE1:\r\n                    for (var i: number = 0; i < this._vertexCount; i++) {\r\n                        var offset: number = floatVerStr * i + floatEleOffset;\r\n                        data[i] = new Vector2(floatVertices[offset], floatVertices[offset + 1]);\r\n                    }\r\n                    break;\r\n                case VertexMesh.MESH_POSITION0:\r\n                case VertexMesh.MESH_NORMAL0:\r\n                    for (var i: number = 0; i < this._vertexCount; i++) {\r\n                        var offset: number = floatVerStr * i + floatEleOffset;\r\n                        data[i] = new Vector3(floatVertices[offset], floatVertices[offset + 1], floatVertices[offset + 2]);\r\n                    }\r\n                    break;\r\n                case VertexMesh.MESH_TANGENT0:\r\n                case VertexMesh.MESH_BLENDWEIGHT0:\r\n                    for (var i: number = 0; i < this._vertexCount; i++) {\r\n                        var offset: number = floatVerStr * i + floatEleOffset;\r\n                        data[i] = new Vector4(floatVertices[offset], floatVertices[offset + 1], floatVertices[offset + 2], floatVertices[offset + 3]);\r\n                    }\r\n                    break;\r\n                case VertexMesh.MESH_COLOR0:\r\n                    for (var i: number = 0; i < this._vertexCount; i++) {\r\n                        var offset: number = floatVerStr * i + floatEleOffset;\r\n                        data[i] = new Color(floatVertices[offset], floatVertices[offset + 1], floatVertices[offset + 2], floatVertices[offset + 3]);\r\n                    }\r\n                    break;\r\n                case VertexMesh.MESH_BLENDINDICES0:\r\n                    for (var i: number = 0; i < this._vertexCount; i++) {\r\n                        var offset: number = uint8VerStr * i + uint8EleOffset;\r\n                        data[i] = new Vector4(uint8Vertices[offset], uint8Vertices[offset + 1], uint8Vertices[offset + 2], uint8Vertices[offset + 3]);\r\n                    }\r\n                    break;\r\n                default:\r\n                    throw \"Mesh:Unknown elementUsage.\";\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    private _setVerticeElementData(data: Array<Vector2 | Vector3 | Vector4 | Color>, elementUsage: number): void {\r\n        var verDec: VertexDeclaration = this._vertexBuffer.vertexDeclaration;\r\n        var element: VertexElement = verDec.getVertexElementByUsage(elementUsage);\r\n        if (element) {\r\n            var uint8Vertices: Uint8Array = this._vertexBuffer.getUint8Data();\r\n            var floatVertices: Float32Array = this._vertexBuffer.getFloat32Data();\r\n            var uint8VerStr: number = verDec.vertexStride;\r\n            var float8VerStr: number = uint8VerStr / 4;\r\n            var uint8EleOffset: number = element._offset;\r\n            var floatEleOffset: number = uint8EleOffset / 4;\r\n            switch (elementUsage) {\r\n                case VertexMesh.MESH_TEXTURECOORDINATE0:\r\n                case VertexMesh.MESH_TEXTURECOORDINATE1:\r\n                    for (var i: number = 0, n: number = data.length; i < n; i++) {\r\n                        var offset: number = float8VerStr * i + floatEleOffset;\r\n                        var vec2: Vector2 = <Vector2>data[i];\r\n                        floatVertices[offset] = vec2.x;\r\n                        floatVertices[offset + 1] = vec2.y;\r\n                    }\r\n                    break;\r\n                case VertexMesh.MESH_POSITION0:\r\n                case VertexMesh.MESH_NORMAL0:\r\n                    for (var i: number = 0, n: number = data.length; i < n; i++) {\r\n                        var offset: number = float8VerStr * i + floatEleOffset;\r\n                        var vec3: Vector3 = <Vector3>data[i];\r\n                        floatVertices[offset] = vec3.x;\r\n                        floatVertices[offset + 1] = vec3.y;\r\n                        floatVertices[offset + 2] = vec3.z;\r\n                    }\r\n                    break;\r\n                case VertexMesh.MESH_TANGENT0:\r\n                case VertexMesh.MESH_BLENDWEIGHT0:\r\n                    for (var i: number = 0, n: number = data.length; i < n; i++) {\r\n                        var offset: number = float8VerStr * i + floatEleOffset;\r\n                        var vec4: Vector4 = <Vector4>data[i];\r\n                        floatVertices[offset] = vec4.x;\r\n                        floatVertices[offset + 1] = vec4.y;\r\n                        floatVertices[offset + 2] = vec4.z;\r\n                        floatVertices[offset + 3] = vec4.w;\r\n                    }\r\n                    break;\r\n                case VertexMesh.MESH_COLOR0:\r\n                    for (var i: number = 0, n: number = data.length; i < n; i++) {\r\n                        var offset: number = float8VerStr * i + floatEleOffset;\r\n                        var cor: Color = <Color>data[i];\r\n                        floatVertices[offset] = cor.r;\r\n                        floatVertices[offset + 1] = cor.g;\r\n                        floatVertices[offset + 2] = cor.b;\r\n                        floatVertices[offset + 3] = cor.a;\r\n                    }\r\n                    break;\r\n                case VertexMesh.MESH_BLENDINDICES0:\r\n                    for (var i: number = 0, n: number = data.length; i < n; i++) {\r\n                        var offset: number = uint8VerStr * i + uint8EleOffset;\r\n                        var vec4: Vector4 = <Vector4>data[i];\r\n                        uint8Vertices[offset] = vec4.x;\r\n                        uint8Vertices[offset + 1] = vec4.y;\r\n                        uint8Vertices[offset + 2] = vec4.z;\r\n                        uint8Vertices[offset + 3] = vec4.w;\r\n                    }\r\n                    break;\r\n                default:\r\n                    throw \"Mesh:Unknown elementUsage.\";\r\n            }\r\n            this._minVerticesUpdate = 0;\r\n            this._maxVerticesUpdate = Number.MAX_SAFE_INTEGER;\r\n        }\r\n        else {\r\n            console.warn(\"Mesh: the mesh don't have  this VertexElement.\");\r\n            //TODO:vertexBuffer\r\n        }\r\n    }\r\n\r\n    /**\r\n     * @inheritDoc\r\n     * @override\r\n     */\r\n    protected _disposeResource(): void {\r\n        for (var i: number = 0, n: number = this._subMeshes.length; i < n; i++)\r\n            this._subMeshes[i].destroy();\r\n        //this._btTriangleMesh && Physics3D._bullet.btStridingMeshInterface_destroy(this._btTriangleMesh);\r\n        this._vertexBuffer && this._vertexBuffer.destroy();\r\n        this._indexBuffer && this._indexBuffer.destroy();\r\n        this._bufferState.destroy();\r\n        this._instanceBufferState && this._instanceBufferState.destroy();\r\n        this._instanceWorldVertexBuffer && this._instanceWorldVertexBuffer.destroy();\r\n        this._instanceSimpleAniVertexBuffer && this._instanceSimpleAniVertexBuffer.destroy();\r\n        this._instanceLightMapVertexBuffer && this._instanceLightMapVertexBuffer.destroy();\r\n        this.instanceWorldMatrixData && (this.instanceWorldMatrixData = null);\r\n        this.instanceSimpleAnimatorData && (this.instanceSimpleAnimatorData = null);\r\n        this.instanceLightMapScaleOffsetData && (this.instanceLightMapScaleOffsetData = null);\r\n        this._setCPUMemory(0);\r\n        this._setGPUMemory(0);\r\n        this._bufferState = null;\r\n        this._instanceBufferState = null;\r\n        this._vertexBuffer = null;\r\n        this._indexBuffer = null;\r\n        this._subMeshes = null;\r\n        this._btTriangleMesh = null;\r\n        this._indexBuffer = null;\r\n        this._boneNames = null;\r\n        this._inverseBindPoses = null;\r\n        this.morphTargetData && (this.morphTargetData.destroy());\r\n        this.__convexMesh && this.__convexMesh.destroy();\r\n    }\r\n\r\n    /**\r\n     *@internal\r\n     */\r\n    _setSubMeshes(subMeshes: SubMesh[]): void {\r\n        this._subMeshes = subMeshes\r\n        for (var i: number = 0, n: number = subMeshes.length; i < n; i++)\r\n            subMeshes[i]._indexInMesh = i;\r\n    }\r\n\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    _setBuffer(vertexBuffer: VertexBuffer3D, indexBuffer: IndexBuffer3D): void {\r\n        var bufferState: BufferState = this._bufferState;\r\n        bufferState.applyState([vertexBuffer], indexBuffer);\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    _setInstanceBuffer() {\r\n        if (this._instanceBufferState)\r\n            return;\r\n        var instanceBufferState: BufferState = this._instanceBufferState = new BufferState();\r\n        var instanceBufferStateType = this._instanceBufferStateType;\r\n        let vertexArray = [];\r\n        vertexArray.push(this._vertexBuffer);\r\n        //new Instance VertexBuffer3D\r\n        let instanceBuffer3D: VertexBuffer3D = this._instanceWorldVertexBuffer = Laya3DRender.renderOBJCreate.createVertexBuffer3D(InstanceRenderElement.maxInstanceCount * 16 * 4, BufferUsage.Dynamic, false);;\r\n        instanceBuffer3D.vertexDeclaration = VertexMesh.instanceWorldMatrixDeclaration;\r\n        instanceBuffer3D.instanceBuffer = true;\r\n        vertexArray.push(instanceBuffer3D);\r\n        this.instanceWorldMatrixData = new Float32Array(InstanceRenderElement.maxInstanceCount * 16);\r\n        switch (instanceBufferStateType) {\r\n            case Mesh.MESH_INSTANCEBUFFER_TYPE_SIMPLEANIMATOR:\r\n                //new SimpleVertexBuffer3D\r\n                let instanceSimpleAnimatorBuffer = this._instanceSimpleAniVertexBuffer = Laya3DRender.renderOBJCreate.createVertexBuffer3D(InstanceRenderElement.maxInstanceCount * 4 * 4, BufferUsage.Dynamic, false);\r\n                instanceSimpleAnimatorBuffer.vertexDeclaration = VertexMesh.instanceSimpleAnimatorDeclaration;\r\n                instanceSimpleAnimatorBuffer.instanceBuffer = true;\r\n                this.instanceSimpleAnimatorData = new Float32Array(InstanceRenderElement.maxInstanceCount * 4);\r\n                vertexArray.push(instanceSimpleAnimatorBuffer);\r\n                break;\r\n            case Mesh.MESH_INSTANCEBUFFER_TYPE_NORMAL:\r\n                //have uv1\r\n                if (this.getVertexDeclaration().getVertexElementByUsage(VertexMesh.MESH_TEXTURECOORDINATE1)) {\r\n                    let instanceLightMapVertexBuffer = this._instanceLightMapVertexBuffer = Laya3DRender.renderOBJCreate.createVertexBuffer3D(InstanceRenderElement.maxInstanceCount * 4 * 4, BufferUsage.Dynamic, false);\r\n                    instanceLightMapVertexBuffer.vertexDeclaration = VertexMesh.instanceLightMapScaleOffsetDeclaration;\r\n                    instanceLightMapVertexBuffer.instanceBuffer = true;\r\n                    this.instanceLightMapScaleOffsetData = new Float32Array(InstanceRenderElement.maxInstanceCount * 4);\r\n                    vertexArray.push(instanceLightMapVertexBuffer);\r\n                }\r\n                break;\r\n        }\r\n        instanceBufferState.applyState(vertexArray, this._indexBuffer);\r\n    }\r\n\r\n    // /**\r\n    //  * @internal\r\n    //  */\r\n    // _getPhysicMesh(): any {\r\n    //     //if (!this._btTriangleMesh) {//TODO Mesh\r\n    //     var bt: any = Physics3D._bullet;\r\n    //     var triangleMesh: number = bt.btTriangleMesh_create();//TODO:btTriangleMesh,\r\n    //     var nativePositio0: number = Mesh._nativeTempVector30;\r\n    //     var nativePositio1: number = Mesh._nativeTempVector31;\r\n    //     var nativePositio2: number = Mesh._nativeTempVector32;\r\n    //     var position0: Vector3 = this._tempVector30;\r\n    //     var position1: Vector3 = this._tempVector31;\r\n    //     var position2: Vector3 = this._tempVector32;\r\n\r\n    //     var vertexBuffer: VertexBuffer3D = this._vertexBuffer;\r\n    //     var positionElement: VertexElement = this._getPositionElement(vertexBuffer);\r\n    //     var verticesData: Float32Array = vertexBuffer.getFloat32Data();\r\n    //     var floatCount: number = vertexBuffer.vertexDeclaration.vertexStride / 4;\r\n    //     var posOffset: number = positionElement._offset / 4;\r\n\r\n    //     var indices: Uint16Array = this._indexBuffer.getData();//TODO:API\r\n    //     for (var i: number = 0, n: number = indices.length; i < n; i += 3) {\r\n    //         var p0Index: number = indices[i] * floatCount + posOffset;\r\n    //         var p1Index: number = indices[i + 1] * floatCount + posOffset;\r\n    //         var p2Index: number = indices[i + 2] * floatCount + posOffset;\r\n    //         position0.setValue(verticesData[p0Index], verticesData[p0Index + 1], verticesData[p0Index + 2]);\r\n    //         position1.setValue(verticesData[p1Index], verticesData[p1Index + 1], verticesData[p1Index + 2]);\r\n    //         position2.setValue(verticesData[p2Index], verticesData[p2Index + 1], verticesData[p2Index + 2]);\r\n\r\n    //         Utils3D._convertToBulletVec3(position0, nativePositio0);\r\n    //         Utils3D._convertToBulletVec3(position1, nativePositio1);\r\n    //         Utils3D._convertToBulletVec3(position2, nativePositio2);\r\n    //         bt.btTriangleMesh_addTriangle(triangleMesh, nativePositio0, nativePositio1, nativePositio2, false);\r\n    //     }\r\n    //     this._btTriangleMesh = triangleMesh;\r\n    //     //}\r\n    //     return this._btTriangleMesh;\r\n    // }\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    _uploadVerticesData(): void {\r\n        var min: number = this._minVerticesUpdate;\r\n        var max: number = this._maxVerticesUpdate;\r\n        if (min !== -1 && max !== -1) {\r\n            var offset: number = min;\r\n            this._vertexBuffer.setData(this._vertexBuffer.getUint8Data().buffer, offset, offset, max - min);\r\n            this._minVerticesUpdate = -1;\r\n            this._maxVerticesUpdate = -1;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @param index \r\n     */\r\n    getSubMesh(index: number): SubMesh {\r\n        return this._subMeshes[index];\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @param positions \r\n     * @remark \r\n     */\r\n    getPositions(positions: Vector3[]): void {\r\n        if (this._isReadable)\r\n            this._getVerticeElementData(positions, VertexMesh.MESH_POSITION0);\r\n        else\r\n            throw \"Mesh:can't get positions on mesh,isReadable must be true.\";\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @param positions \r\n     */\r\n    setPositions(positions: Vector3[]): void {\r\n        if (this._isReadable) {\r\n            this._setVerticeElementData(positions, VertexMesh.MESH_POSITION0);\r\n            this._needUpdateBounds = true;\r\n        }\r\n        else {\r\n            throw \"Mesh:setPosition() need isReadable must be true or use setVertices().\";\r\n        }\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @param colors \r\n     * @remark \r\n     */\r\n    getColors(colors: Color[]): void {\r\n        if (this._isReadable)\r\n            this._getVerticeElementData(colors, VertexMesh.MESH_COLOR0);\r\n        else\r\n            throw \"Mesh:can't get colors on mesh,isReadable must be true.\";\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @param colors  \r\n     */\r\n    setColors(colors: Color[]): void {\r\n        if (this._isReadable)\r\n            this._setVerticeElementData(colors, VertexMesh.MESH_COLOR0);\r\n        else\r\n            throw \"Mesh:setColors() need isReadable must be true or use setVertices().\";\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @param uvs \r\n     * @param channel \r\n     * @remark \r\n     */\r\n    getUVs(uvs: Vector2[], channel: number = 0): void {\r\n        if (this._isReadable) {\r\n            switch (channel) {\r\n                case 0:\r\n                    this._getVerticeElementData(uvs, VertexMesh.MESH_TEXTURECOORDINATE0);\r\n                    break;\r\n                case 1:\r\n                    this._getVerticeElementData(uvs, VertexMesh.MESH_TEXTURECOORDINATE1);\r\n                    break;\r\n                default:\r\n                    throw \"Mesh:Invalid channel.\";\r\n            }\r\n        }\r\n        else {\r\n            throw \"Mesh:can't get uvs on mesh,isReadable must be true.\";\r\n        }\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @param uvs \r\n     * @param channel \r\n     */\r\n    setUVs(uvs: Vector2[], channel: number = 0): void {\r\n        if (this._isReadable) {\r\n            switch (channel) {\r\n                case 0:\r\n                    this._setVerticeElementData(uvs, VertexMesh.MESH_TEXTURECOORDINATE0);\r\n                    break;\r\n                case 1:\r\n                    this._setVerticeElementData(uvs, VertexMesh.MESH_TEXTURECOORDINATE1);\r\n                    break;\r\n                default:\r\n                    throw \"Mesh:Invalid channel.\";\r\n            }\r\n        }\r\n        else {\r\n            throw \"Mesh:setUVs() need isReadable must be true or use setVertices().\";\r\n        }\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @param normals \r\n     * @remark \r\n     */\r\n    getNormals(normals: Vector3[]): void {\r\n        if (this._isReadable)\r\n            this._getVerticeElementData(normals, VertexMesh.MESH_NORMAL0);\r\n        else\r\n            throw \"Mesh:can't get colors on mesh,isReadable must be true.\";\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @param normals  \r\n     */\r\n    setNormals(normals: Vector3[]): void {\r\n        if (this._isReadable)\r\n            this._setVerticeElementData(normals, VertexMesh.MESH_NORMAL0);\r\n        else\r\n            throw \"Mesh:setNormals() need must be true or use setVertices().\";\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @param tangents \r\n     */\r\n    getTangents(tangents: Vector4[]): void {\r\n        if (this._isReadable)\r\n            this._getVerticeElementData(tangents, VertexMesh.MESH_TANGENT0);\r\n        else\r\n            throw \"Mesh:can't get colors on mesh,isReadable must be true.\";\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @param tangents \r\n     */\r\n    setTangents(tangents: Vector4[]): void {\r\n        if (this._isReadable)\r\n            this._setVerticeElementData(tangents, VertexMesh.MESH_TANGENT0);\r\n        else\r\n            throw \"Mesh:setTangents() need isReadable must be true or use setVertices().\";\r\n    }\r\n\r\n    /**\r\n    * \r\n    * @param boneWeights \r\n    */\r\n    getBoneWeights(boneWeights: Vector4[]): void {\r\n        if (this._isReadable)\r\n            this._getVerticeElementData(boneWeights, VertexMesh.MESH_BLENDWEIGHT0);\r\n        else\r\n            throw \"Mesh:can't get boneWeights on mesh,isReadable must be true.\";\r\n    }\r\n\r\n    /**\r\n    * \r\n    * @param boneWeights \r\n    */\r\n    setBoneWeights(boneWeights: Vector4[]): void {\r\n        if (this._isReadable)\r\n            this._setVerticeElementData(boneWeights, VertexMesh.MESH_BLENDWEIGHT0);\r\n        else\r\n            throw \"Mesh:setBoneWeights() need isReadable must be true or use setVertices().\";\r\n    }\r\n\r\n    /**\r\n    * \r\n    * @param boneIndices \r\n    */\r\n    getBoneIndices(boneIndices: Vector4[]): void {\r\n        if (this._isReadable)\r\n            this._getVerticeElementData(boneIndices, VertexMesh.MESH_BLENDINDICES0);\r\n        else\r\n            throw \"Mesh:can't get boneIndices on mesh,isReadable must be true.\";\r\n    }\r\n\r\n    /**\r\n    * \r\n    * @param boneWeights \r\n    */\r\n    setBoneIndices(boneIndices: Vector4[]): void {\r\n        if (this._isReadable)\r\n            this._setVerticeElementData(boneIndices, VertexMesh.MESH_BLENDINDICES0);\r\n        else\r\n            throw \"Mesh:setBoneIndices() need isReadable must be true or use setVertices().\";\r\n    }\r\n\r\n\r\n    /**\r\n     * Mesh,\r\n     */\r\n    markAsUnreadbale(): void {\r\n        this._uploadVerticesData();\r\n        this._vertexBuffer.markAsUnreadbale();\r\n        this._isReadable = false;\r\n    }\r\n\r\n    /**\r\n     * \r\n     */\r\n    getVertexDeclaration(): VertexDeclaration {\r\n        return this._vertexBuffer._vertexDeclaration;\r\n    }\r\n\r\n    /**\r\n    * \r\n    * @return \r\n    */\r\n    getVertices(): ArrayBuffer {\r\n        if (this._isReadable)\r\n            return this._vertexBuffer.getUint8Data().buffer.slice(0);\r\n        else\r\n            throw \"Mesh:can't get vertices on mesh,isReadable must be true.\";\r\n    }\r\n\r\n    /**\r\n    * \r\n    * @param vertices \r\n    */\r\n    setVertices(vertices: ArrayBuffer): void {\r\n        this._vertexBuffer.setData(vertices);\r\n        this._needUpdateBounds = true;\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @return \r\n     */\r\n    getIndices(): Uint8Array | Uint16Array | Uint32Array {\r\n        if (this._isReadable)\r\n            return this._indexBuffer.getData().slice();\r\n        else\r\n            throw \"Mesh:can't get indices on subMesh,mesh's isReadable must be true.\";\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @param indices \r\n     */\r\n    setIndices(indices: Uint8Array | Uint16Array | Uint32Array): void {\r\n        var format: IndexFormat;\r\n        if (indices instanceof Uint32Array)\r\n            format = IndexFormat.UInt32;\r\n        else if (indices instanceof Uint16Array)\r\n            format = IndexFormat.UInt16;\r\n        else if (indices instanceof Uint8Array)\r\n            format = IndexFormat.UInt8;\r\n\r\n        var indexBuffer: IndexBuffer3D = this._indexBuffer;\r\n        if (this._indexFormat !== format || indexBuffer.indexCount !== indices.length) {//format chang and length chang will recreate the indexBuffer\r\n            indexBuffer.destroy();\r\n            this._indexBuffer = indexBuffer = Laya3DRender.renderOBJCreate.createIndexBuffer3D(format, indices.length, BufferUsage.Static, this._isReadable);\r\n        }\r\n        indexBuffer.setData(indices);\r\n        this.indexFormat = format;\r\n\r\n    }\r\n\r\n\r\n    /**\r\n     * \r\n     */\r\n    calculateBounds(): void {\r\n        if (this._isReadable) {\r\n            if (this._needUpdateBounds) {\r\n                var min: Vector3 = this._tempVector30;\r\n                var max: Vector3 = this._tempVector31;\r\n                min.x = min.y = min.z = Number.MAX_VALUE;\r\n                max.x = max.y = max.z = -Number.MAX_VALUE;\r\n\r\n                var vertexBuffer: VertexBuffer3D = this._vertexBuffer;\r\n                var positionElement: VertexElement = this._getPositionElement(vertexBuffer);\r\n                var verticesData: Float32Array = vertexBuffer.getFloat32Data();\r\n                var floatCount: number = vertexBuffer.vertexDeclaration.vertexStride / 4;\r\n                var posOffset: number = positionElement._offset / 4;\r\n                for (var j: number = 0, m: number = verticesData.length; j < m; j += floatCount) {\r\n                    var ofset: number = j + posOffset;\r\n                    var pX: number = verticesData[ofset];\r\n                    var pY: number = verticesData[ofset + 1];\r\n                    var pZ: number = verticesData[ofset + 2];\r\n                    min.x = Math.min(min.x, pX);\r\n                    min.y = Math.min(min.y, pY);\r\n                    min.z = Math.min(min.z, pZ);\r\n                    max.x = Math.max(max.x, pX);\r\n                    max.y = Math.max(max.y, pY);\r\n                    max.z = Math.max(max.z, pZ);\r\n                }\r\n                this._bounds.setMin(min);\r\n                this._bounds.setMax(max);\r\n                this._needUpdateBounds = false;\r\n            }\r\n        }\r\n        else {\r\n            throw \"Mesh:can't calculate bounds on subMesh,mesh's isReadable must be true.\";\r\n        }\r\n    }\r\n\r\n\r\n    /**\r\n     * Corve\r\n     */\r\n    getCorveMesh(): Mesh {\r\n        if (this._convexMesh == null) {\r\n            return null;\r\n        }\r\n        if (this.__convexMesh == null && Laya3D._PhysicsCreateUtil && Laya3D._PhysicsCreateUtil.getPhysicsCapable(EPhysicsCapable.Physics_CreateCorveMesh)) {\r\n            this.__convexMesh = Laya3D._PhysicsCreateUtil.createCorveMesh(this);\r\n        }\r\n        return this.__convexMesh;\r\n    }\r\n\r\n\r\n    /**\r\n     * \r\n     * @param\tdestObject \r\n     */\r\n    cloneTo(destObject: any): void {//[IClone]\r\n        var destMesh: Mesh = <Mesh>destObject;\r\n        var vb: VertexBuffer3D = this._vertexBuffer;\r\n        var destVB: VertexBuffer3D = Laya3DRender.renderOBJCreate.createVertexBuffer3D(vb._byteLength, vb.bufferUsage, vb.canRead);\r\n        destVB.vertexDeclaration = vb.vertexDeclaration;\r\n        destVB.setData(vb.getUint8Data().slice().buffer);\r\n        destMesh._vertexBuffer = destVB;\r\n        destMesh._vertexCount = this._vertexCount;\r\n        var ib: IndexBuffer3D = this._indexBuffer;\r\n        var destIB: IndexBuffer3D = Laya3DRender.renderOBJCreate.createIndexBuffer3D(IndexFormat.UInt16, ib.indexCount, ib.bufferUsage, ib.canRead);\r\n        destIB.setData(ib.getData().slice());\r\n        destMesh._indexBuffer = destIB;\r\n\r\n        destMesh._setBuffer(destMesh._vertexBuffer, destIB);\r\n        destMesh._instanceBufferStateType = this._instanceBufferStateType;\r\n\r\n        destMesh._setCPUMemory(this.cpuMemory);\r\n        destMesh._setGPUMemory(this.gpuMemory);\r\n\r\n        var i: number;\r\n        var boneNames: string[] = this._boneNames;\r\n        if (boneNames) {\r\n            var destBoneNames: string[] = destMesh._boneNames = [];\r\n            for (i = 0; i < boneNames.length; i++)\r\n                destBoneNames[i] = boneNames[i];\r\n        }\r\n\r\n        var inverseBindPoses: Matrix4x4[] = this._inverseBindPoses;\r\n        if (inverseBindPoses) {\r\n            var destInverseBindPoses: Matrix4x4[] = destMesh._inverseBindPoses = [];\r\n            for (i = 0; i < inverseBindPoses.length; i++)\r\n                destInverseBindPoses[i] = inverseBindPoses[i];\r\n        }\r\n        if (this._inverseBindPosesBuffer) {\r\n            let length = this._inverseBindPosesBuffer.byteLength;\r\n            destMesh._inverseBindPosesBuffer = new ArrayBuffer(length);\r\n            new Uint8Array(destMesh._inverseBindPosesBuffer).set(new Uint8Array(this._inverseBindPosesBuffer));\r\n        }\r\n\r\n        var cacheLength: number = this._skinnedMatrixCaches.length;\r\n        destMesh._skinnedMatrixCaches.length = cacheLength;\r\n        for (i = 0; i < cacheLength; i++) {\r\n            var skinnedCache: skinnedMatrixCache = this._skinnedMatrixCaches[i];\r\n            if (skinnedCache)\r\n                destMesh._skinnedMatrixCaches[i] = new skinnedMatrixCache(skinnedCache.subMeshIndex, skinnedCache.batchIndex, skinnedCache.batchBoneIndex);\r\n        }\r\n\r\n        for (i = 0; i < this.subMeshCount; i++) {\r\n            var subMesh: SubMesh = this._subMeshes[i];\r\n            var subIndexBufferStart: number[] = subMesh._subIndexBufferStart;\r\n            var subIndexBufferCount: number[] = subMesh._subIndexBufferCount;\r\n            var boneIndicesList: Uint16Array[] = subMesh._boneIndicesList;\r\n            var destSubmesh: SubMesh = new SubMesh(destMesh);\r\n\r\n            destSubmesh._subIndexBufferStart.length = subIndexBufferStart.length;\r\n            destSubmesh._subIndexBufferCount.length = subIndexBufferCount.length;\r\n            destSubmesh._boneIndicesList.length = boneIndicesList.length;\r\n\r\n            for (var j: number = 0; j < subIndexBufferStart.length; j++)\r\n                destSubmesh._subIndexBufferStart[j] = subIndexBufferStart[j];\r\n            for (j = 0; j < subIndexBufferCount.length; j++)\r\n                destSubmesh._subIndexBufferCount[j] = subIndexBufferCount[j];\r\n            for (j = 0; j < boneIndicesList.length; j++)\r\n                destSubmesh._boneIndicesList[j] = new Uint16Array(boneIndicesList[j]);\r\n\r\n            destSubmesh._indexBuffer = destIB;\r\n            destSubmesh._indexStart = subMesh._indexStart;\r\n            destSubmesh._indexCount = subMesh._indexCount;\r\n            destSubmesh._indices = new Uint16Array(destIB.getData().buffer, subMesh._indexStart * 2, subMesh._indexCount);\r\n            var vertexBuffer: VertexBuffer3D = destMesh._vertexBuffer;\r\n            destSubmesh._vertexBuffer = vertexBuffer;\r\n            destMesh._subMeshes.push(destSubmesh);\r\n        }\r\n        destMesh._setSubMeshes(destMesh._subMeshes);\r\n\r\n        if (this.morphTargetData) {\r\n            destMesh.morphTargetData = this.morphTargetData.clone();\r\n        }\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @return\t \r\n     */\r\n    clone(): any {//[IClone]\r\n        var dest: Mesh = new Mesh();\r\n        this.cloneTo(dest);\r\n        return dest;\r\n    }\r\n\r\n\r\n\r\n    //------------------------------------------NATIVE----------------------------------------------------\r\n    /** @internal */\r\n    _inverseBindPosesBuffer: ArrayBuffer;\r\n}\r\n\r\n\r\n\r\n","import { IndexBuffer3D } from \"../../graphics/IndexBuffer3D\";\r\nimport { VertexBuffer3D } from \"../../graphics/VertexBuffer3D\";\r\nimport { Mesh } from \"./Mesh\";\r\nimport { SubMesh } from \"./SubMesh\";\r\nimport { BufferUsage } from \"../../../RenderEngine/RenderEnum/BufferTargetType\";\r\nimport { VertexDeclaration } from \"../../../RenderEngine/VertexDeclaration\";\r\nimport { IndexFormat } from \"../../../RenderEngine/RenderEnum/IndexFormat\";\r\nimport { Quaternion } from \"../../../maths/Quaternion\";\r\nimport { Vector3 } from \"../../../maths/Vector3\";\r\nimport { VertexMesh } from \"../../../RenderEngine/RenderShader/VertexMesh\";\r\nimport { Laya3DRender } from \"../../RenderObjs/Laya3DRender\";\r\n\r\n/**\r\n * <code>PrimitiveMesh</code> \r\n */\r\nexport class PrimitiveMesh {\r\n\r\n\tstatic __init__(): void {\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * @internal\r\n\t */\r\n\tstatic _createMesh(vertexDeclaration: VertexDeclaration, vertices: Float32Array, indices: Uint16Array): Mesh {\r\n\t\tvar mesh: Mesh = new Mesh();\r\n\t\tvar subMesh: SubMesh = new SubMesh(mesh);\r\n\t\tvar vertexBuffer: VertexBuffer3D = Laya3DRender.renderOBJCreate.createVertexBuffer3D(vertices.length * 4, BufferUsage.Static, true);\r\n\t\tvertexBuffer.vertexDeclaration = vertexDeclaration;\r\n\t\tvertexBuffer.setData(vertices.buffer);\r\n\t\tmesh._vertexBuffer = vertexBuffer;\r\n\t\tmesh._vertexCount = vertexBuffer._byteLength / vertexDeclaration.vertexStride;\r\n\t\tvar indexBuffer: IndexBuffer3D = Laya3DRender.renderOBJCreate.createIndexBuffer3D(IndexFormat.UInt16, indices.length, BufferUsage.Static, true);\r\n\t\tindexBuffer.setData(indices);\r\n\t\tmesh._indexBuffer = indexBuffer;\r\n\r\n\t\tmesh._setBuffer(vertexBuffer, indexBuffer);\r\n\t\t//mesh._setInstanceBuffer(mesh._instanceBufferStateType);\r\n\t\tsubMesh._vertexBuffer = vertexBuffer;\r\n\t\tsubMesh._indexBuffer = indexBuffer;\r\n\t\tsubMesh._setIndexRange(0, indexBuffer.indexCount);\r\n\r\n\t\tvar subIndexBufferStart: number[] = subMesh._subIndexBufferStart;\r\n\t\tvar subIndexBufferCount: number[] = subMesh._subIndexBufferCount;\r\n\t\tvar boneIndicesList: Uint16Array[] = subMesh._boneIndicesList;\r\n\t\tsubIndexBufferStart.length = 1;\r\n\t\tsubIndexBufferCount.length = 1;\r\n\t\tboneIndicesList.length = 1;\r\n\t\tsubIndexBufferStart[0] = 0;\r\n\t\tsubIndexBufferCount[0] = indexBuffer.indexCount;\r\n\r\n\t\tvar subMeshes: SubMesh[] = [];\r\n\t\tsubMeshes.push(subMesh);\r\n\t\tmesh._setSubMeshes(subMeshes);\r\n\t\tmesh.calculateBounds();\r\n\t\tvar memorySize: number = vertexBuffer._byteLength + indexBuffer._byteLength;\r\n\t\tmesh._setCPUMemory(memorySize);\r\n\t\tmesh._setGPUMemory(memorySize);\r\n\t\treturn mesh;\r\n\t}\r\n\r\n\t/**\r\n\t * Box\r\n\t * @param long \r\n\t * @param height \r\n\t * @param width \r\n\t * @return\r\n\t */\r\n\tstatic createBox(long: number = 1, height: number = 1, width: number = 1): Mesh {\r\n\t\tvar vertexDeclaration: VertexDeclaration = VertexMesh.getVertexDeclaration(\"POSITION,NORMAL,UV\");\r\n\r\n\t\tvar halfLong: number = long / 2;\r\n\t\tvar halfHeight: number = height / 2;\r\n\t\tvar halfWidth: number = width / 2;\r\n\r\n\t\tvar vertices: Float32Array = new Float32Array([\r\n\t\t\t//\r\n\t\t\t-halfLong, halfHeight, -halfWidth, 0, 1, 0, 0, 0, halfLong, halfHeight, -halfWidth, 0, 1, 0, 1, 0, halfLong, halfHeight, halfWidth, 0, 1, 0, 1, 1, -halfLong, halfHeight, halfWidth, 0, 1, 0, 0, 1,\r\n\t\t\t//\r\n\t\t\t-halfLong, -halfHeight, -halfWidth, 0, -1, 0, 0, 1, halfLong, -halfHeight, -halfWidth, 0, -1, 0, 1, 1, halfLong, -halfHeight, halfWidth, 0, -1, 0, 1, 0, -halfLong, -halfHeight, halfWidth, 0, -1, 0, 0, 0,\r\n\t\t\t//\r\n\t\t\t-halfLong, halfHeight, -halfWidth, -1, 0, 0, 0, 0, -halfLong, halfHeight, halfWidth, -1, 0, 0, 1, 0, -halfLong, -halfHeight, halfWidth, -1, 0, 0, 1, 1, -halfLong, -halfHeight, -halfWidth, -1, 0, 0, 0, 1,\r\n\t\t\t//\r\n\t\t\thalfLong, halfHeight, -halfWidth, 1, 0, 0, 1, 0, halfLong, halfHeight, halfWidth, 1, 0, 0, 0, 0, halfLong, -halfHeight, halfWidth, 1, 0, 0, 0, 1, halfLong, -halfHeight, -halfWidth, 1, 0, 0, 1, 1,\r\n\t\t\t//\r\n\t\t\t-halfLong, halfHeight, halfWidth, 0, 0, 1, 0, 0, halfLong, halfHeight, halfWidth, 0, 0, 1, 1, 0, halfLong, -halfHeight, halfWidth, 0, 0, 1, 1, 1, -halfLong, -halfHeight, halfWidth, 0, 0, 1, 0, 1,\r\n\t\t\t//\r\n\t\t\t-halfLong, halfHeight, -halfWidth, 0, 0, -1, 1, 0, halfLong, halfHeight, -halfWidth, 0, 0, -1, 0, 0, halfLong, -halfHeight, -halfWidth, 0, 0, -1, 0, 1, -halfLong, -halfHeight, -halfWidth, 0, 0, -1, 1, 1]);\r\n\r\n\t\tvar indices: Uint16Array = new Uint16Array([\r\n\t\t\t//\r\n\t\t\t0, 1, 2, 2, 3, 0,\r\n\t\t\t//\r\n\t\t\t4, 7, 6, 6, 5, 4,\r\n\t\t\t//\r\n\t\t\t8, 9, 10, 10, 11, 8,\r\n\t\t\t//\r\n\t\t\t12, 15, 14, 14, 13, 12,\r\n\t\t\t//\r\n\t\t\t16, 17, 18, 18, 19, 16,\r\n\t\t\t//\r\n\t\t\t20, 23, 22, 22, 21, 20]);\r\n\t\treturn PrimitiveMesh._createMesh(vertexDeclaration, vertices, indices);\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t * @param radius \r\n\t * @param height \r\n\t * @param stacks ,\r\n\t * @param slices \r\n\t */\r\n\tstatic createCapsule(radius: number = 0.5, height: number = 2, stacks: number = 16, slices: number = 32): Mesh {\r\n\t\tvar vertexCount: number = (stacks + 1) * (slices + 1) * 2 + (slices + 1) * 2;\r\n\t\tvar indexCount: number = (3 * stacks * (slices + 1)) * 2 * 2 + 2 * slices * 3;\r\n\r\n\t\t//\r\n\t\tvar vertexDeclaration: VertexDeclaration = VertexMesh.getVertexDeclaration(\"POSITION,NORMAL,UV\");\r\n\t\t//,/\r\n\t\tvar vertexFloatStride: number = vertexDeclaration.vertexStride / 4;\r\n\t\t//\r\n\t\tvar vertices: Float32Array = new Float32Array(vertexCount * vertexFloatStride);\r\n\t\t//\r\n\t\tvar indices: Uint16Array = new Uint16Array(indexCount);\r\n\r\n\t\tvar stackAngle: number = (Math.PI / 2.0) / stacks;\r\n\t\tvar sliceAngle: number = (Math.PI * 2.0) / slices;\r\n\r\n\t\t//\r\n\t\tvar hcHeight: number = height / 2 - radius;\r\n\r\n\t\tvar posX: number = 0;\r\n\t\tvar posY: number = 0;\r\n\t\tvar posZ: number = 0;\r\n\r\n\t\tvar vc: number = 0;\r\n\t\tvar ic: number = 0;\r\n\r\n\t\tvar verticeCount: number = 0;\r\n\r\n\t\tvar stack: number, slice: number;\r\n\r\n\t\t//\r\n\t\tfor (stack = 0; stack <= stacks; stack++) {\r\n\r\n\t\t\tfor (slice = 0; slice <= slices; slice++) {\r\n\r\n\t\t\t\tposX = radius * Math.cos(stack * stackAngle) * Math.cos(slice * sliceAngle + Math.PI);\r\n\t\t\t\tposY = radius * Math.sin(stack * stackAngle);\r\n\t\t\t\tposZ = radius * Math.cos(stack * stackAngle) * Math.sin(slice * sliceAngle + Math.PI);\r\n\r\n\t\t\t\t//pos\r\n\t\t\t\tvertices[vc++] = posX;\r\n\t\t\t\tvertices[vc++] = posY + hcHeight;\r\n\t\t\t\tvertices[vc++] = posZ;\r\n\r\n\t\t\t\t//normal\r\n\t\t\t\tvertices[vc++] = posX;\r\n\t\t\t\tvertices[vc++] = posY;\r\n\t\t\t\tvertices[vc++] = posZ;\r\n\r\n\t\t\t\t//uv\r\n\t\t\t\tvertices[vc++] = 1 - slice / slices;\r\n\t\t\t\tvertices[vc++] = (1 - stack / stacks) * ((Math.PI * radius / 2) / (height + Math.PI * radius));\r\n\r\n\t\t\t\tif (stack < stacks) {\r\n\r\n\t\t\t\t\t// First\r\n\t\t\t\t\tindices[ic++] = (stack * (slices + 1)) + slice + (slices + 1);\r\n\t\t\t\t\tindices[ic++] = (stack * (slices + 1)) + slice;\r\n\t\t\t\t\tindices[ic++] = (stack * (slices + 1)) + slice + 1;\r\n\t\t\t\t\t// Second\r\n\t\t\t\t\tindices[ic++] = (stack * (slices + 1)) + slice + (slices);\r\n\t\t\t\t\tindices[ic++] = (stack * (slices + 1)) + slice;\r\n\t\t\t\t\tindices[ic++] = (stack * (slices + 1)) + slice + (slices + 1);\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tverticeCount += (stacks + 1) * (slices + 1);\r\n\r\n\t\t//\r\n\t\tfor (stack = 0; stack <= stacks; stack++) {\r\n\r\n\t\t\tfor (slice = 0; slice <= slices; slice++) {\r\n\r\n\t\t\t\tposX = radius * Math.cos(stack * stackAngle) * Math.cos(slice * sliceAngle + Math.PI);\r\n\t\t\t\tposY = radius * Math.sin(-stack * stackAngle);\r\n\t\t\t\tposZ = radius * Math.cos(stack * stackAngle) * Math.sin(slice * sliceAngle + Math.PI);\r\n\r\n\t\t\t\t//pos\r\n\t\t\t\tvertices[vc++] = posX;\r\n\t\t\t\tvertices[vc++] = posY - hcHeight;\r\n\t\t\t\tvertices[vc++] = posZ;\r\n\r\n\t\t\t\t//normal\r\n\t\t\t\tvertices[vc++] = posX;\r\n\t\t\t\tvertices[vc++] = posY;\r\n\t\t\t\tvertices[vc++] = posZ;\r\n\r\n\t\t\t\t//uv\r\n\t\t\t\tvertices[vc++] = 1 - slice / slices;\r\n\t\t\t\tvertices[vc++] = ((stack / stacks) * (Math.PI * radius / 2) + (height + Math.PI * radius / 2)) / (height + Math.PI * radius);\r\n\r\n\t\t\t\tif (stack < stacks) {\r\n\r\n\t\t\t\t\t// First\r\n\t\t\t\t\tindices[ic++] = verticeCount + (stack * (slices + 1)) + slice;\r\n\t\t\t\t\tindices[ic++] = verticeCount + (stack * (slices + 1)) + slice + (slices + 1);\r\n\t\t\t\t\tindices[ic++] = verticeCount + (stack * (slices + 1)) + slice + 1;\r\n\t\t\t\t\t// Second\r\n\t\t\t\t\tindices[ic++] = verticeCount + (stack * (slices + 1)) + slice;\r\n\t\t\t\t\tindices[ic++] = verticeCount + (stack * (slices + 1)) + slice + (slices);\r\n\t\t\t\t\tindices[ic++] = verticeCount + (stack * (slices + 1)) + slice + (slices + 1);\r\n\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tverticeCount += (stacks + 1) * (slices + 1);\r\n\r\n\t\t//\r\n\t\tfor (slice = 0; slice <= slices; slice++) {\r\n\t\t\tposX = radius * Math.cos(slice * sliceAngle + Math.PI);\r\n\t\t\tposY = hcHeight;\r\n\t\t\tposZ = radius * Math.sin(slice * sliceAngle + Math.PI);\r\n\r\n\t\t\t//pos\r\n\t\t\tvertices[vc++] = posX;\r\n\t\t\tvertices[vc + (slices + 1) * 8 - 1] = posX;\r\n\t\t\tvertices[vc++] = posY;\r\n\t\t\tvertices[vc + (slices + 1) * 8 - 1] = -posY;\r\n\t\t\tvertices[vc++] = posZ;\r\n\t\t\tvertices[vc + (slices + 1) * 8 - 1] = posZ;\r\n\t\t\t//normal\r\n\t\t\tvertices[vc++] = posX;\r\n\t\t\tvertices[vc + (slices + 1) * 8 - 1] = posX;\r\n\t\t\tvertices[vc++] = 0;\r\n\t\t\tvertices[vc + (slices + 1) * 8 - 1] = 0;\r\n\t\t\tvertices[vc++] = posZ;\r\n\t\t\tvertices[vc + (slices + 1) * 8 - 1] = posZ;\r\n\t\t\t//uv    \r\n\t\t\tvertices[vc++] = 1 - slice * 1 / slices;\r\n\t\t\tvertices[vc + (slices + 1) * 8 - 1] = 1 - slice * 1 / slices;\r\n\t\t\tvertices[vc++] = (Math.PI * radius / 2) / (height + Math.PI * radius);\r\n\t\t\tvertices[vc + (slices + 1) * 8 - 1] = (Math.PI * radius / 2 + height) / (height + Math.PI * radius);\r\n\t\t}\r\n\r\n\t\tfor (slice = 0; slice < slices; slice++) {\r\n\r\n\t\t\tindices[ic++] = slice + verticeCount + (slices + 1);\r\n\t\t\tindices[ic++] = slice + verticeCount + 1;\r\n\t\t\tindices[ic++] = slice + verticeCount;\r\n\r\n\t\t\tindices[ic++] = slice + verticeCount + (slices + 1);\r\n\t\t\tindices[ic++] = slice + verticeCount + (slices + 1) + 1;\r\n\t\t\tindices[ic++] = slice + verticeCount + 1;\r\n\t\t}\r\n\r\n\t\tverticeCount += 2 * (slices + 1);\r\n\t\treturn PrimitiveMesh._createMesh(vertexDeclaration, vertices, indices);\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t * @param radius \r\n\t * @param height \r\n\t * @param slices \r\n\t */\r\n\tstatic createCone(radius: number = 0.5, height: number = 1, slices: number = 32): Mesh {\r\n\t\t//(this._released) || (dispose());//\r\n\t\tvar vertexCount: number = (slices + 1 + 1) + (slices + 1) * 2;\r\n\t\tvar indexCount: number = 6 * slices + 3 * slices;\r\n\r\n\t\t//\r\n\t\tvar vertexDeclaration: VertexDeclaration = VertexMesh.getVertexDeclaration(\"POSITION,NORMAL,UV\");\r\n\t\t//,/\r\n\t\tvar vertexFloatStride: number = vertexDeclaration.vertexStride / 4;\r\n\t\t//\r\n\t\tvar vertices: Float32Array = new Float32Array(vertexCount * vertexFloatStride);\r\n\t\t//\r\n\t\tvar indices: Uint16Array = new Uint16Array(indexCount);\r\n\r\n\t\tvar sliceAngle: number = (Math.PI * 2.0) / slices;\r\n\r\n\t\tvar halfHeight: number = height / 2;\r\n\t\tvar curAngle: number = 0;\r\n\t\tvar verticeCount: number = 0;\r\n\r\n\t\tvar posX: number = 0;\r\n\t\tvar posY: number = 0;\r\n\t\tvar posZ: number = 0;\r\n\r\n\t\tvar normal: Vector3 = new Vector3();\r\n\t\tvar downV3: Vector3 = new Vector3(0, -1, 0);\r\n\t\tvar upPoint: Vector3 = new Vector3(0, halfHeight, 0);\r\n\t\tvar downPoint: Vector3 = new Vector3();\r\n\t\tvar v3: Vector3 = new Vector3();\r\n\t\tvar q4: Quaternion = new Quaternion();\r\n\t\tvar rotateAxis: Vector3 = new Vector3();\r\n\t\tvar rotateRadius: number;\r\n\r\n\t\tvar vc: number = 0;\r\n\t\tvar ic: number = 0;\r\n\r\n\t\t//\r\n\t\tfor (var rv: number = 0; rv <= slices; rv++) {\r\n\t\t\tcurAngle = rv * sliceAngle;\r\n\t\t\tposX = Math.cos(curAngle + Math.PI) * radius;\r\n\t\t\tposY = halfHeight;\r\n\t\t\tposZ = Math.sin(curAngle + Math.PI) * radius;\r\n\r\n\t\t\t//pos\r\n\t\t\tvertices[vc++] = 0;\r\n\t\t\tvertices[vc + (slices + 1) * 8 - 1] = posX;\r\n\t\t\tvertices[vc++] = posY;\r\n\t\t\tvertices[vc + (slices + 1) * 8 - 1] = -posY;\r\n\t\t\tvertices[vc++] = 0;\r\n\t\t\tvertices[vc + (slices + 1) * 8 - 1] = posZ;\r\n\r\n\t\t\tnormal.x = posX;\r\n\t\t\tnormal.y = 0;\r\n\t\t\tnormal.z = posZ;\r\n\t\t\tdownPoint.x = posX;\r\n\t\t\tdownPoint.y = -posY;\r\n\t\t\tdownPoint.z = posZ;\r\n\t\t\tVector3.subtract(downPoint, upPoint, v3);\r\n\t\t\tVector3.normalize(v3, v3);\r\n\t\t\trotateRadius = Math.acos(Vector3.dot(downV3, v3));\r\n\t\t\tVector3.cross(downV3, v3, rotateAxis);\r\n\t\t\tVector3.normalize(rotateAxis, rotateAxis);\r\n\t\t\tQuaternion.createFromAxisAngle(rotateAxis, rotateRadius, q4);\r\n\t\t\tVector3.normalize(normal, normal);\r\n\t\t\tVector3.transformQuat(normal, q4, normal);\r\n\t\t\tVector3.normalize(normal, normal);\r\n\t\t\t//normal\r\n\t\t\tvertices[vc++] = normal.x;\r\n\t\t\tvertices[vc + (slices + 1) * 8 - 1] = normal.x;\r\n\t\t\tvertices[vc++] = normal.y;\r\n\t\t\tvertices[vc + (slices + 1) * 8 - 1] = normal.y;\r\n\t\t\tvertices[vc++] = normal.z;\r\n\t\t\tvertices[vc + (slices + 1) * 8 - 1] = normal.z;\r\n\t\t\t//uv    \r\n\t\t\tvertices[vc++] = 1 - rv * 1 / slices;\r\n\t\t\tvertices[vc + (slices + 1) * 8 - 1] = 1 - rv * 1 / slices;\r\n\t\t\tvertices[vc++] = 0;\r\n\t\t\tvertices[vc + (slices + 1) * 8 - 1] = 1;\r\n\r\n\t\t}\r\n\r\n\t\tvc += (slices + 1) * 8;\r\n\r\n\t\tfor (var ri: number = 0; ri < slices; ri++) {\r\n\t\t\tindices[ic++] = ri + verticeCount + (slices + 1);\r\n\t\t\tindices[ic++] = ri + verticeCount + 1;\r\n\t\t\tindices[ic++] = ri + verticeCount;\r\n\r\n\t\t\tindices[ic++] = ri + verticeCount + (slices + 1);\r\n\t\t\tindices[ic++] = ri + verticeCount + (slices + 1) + 1;\r\n\t\t\tindices[ic++] = ri + verticeCount + 1;\r\n\r\n\t\t}\r\n\r\n\t\tverticeCount += 2 * (slices + 1);\r\n\r\n\t\t//\r\n\t\tfor (var bv: number = 0; bv <= slices; bv++) {\r\n\t\t\tif (bv === 0) {\r\n\t\t\t\t//pos\r\n\t\t\t\tvertices[vc++] = 0;\r\n\t\t\t\tvertices[vc++] = -halfHeight;\r\n\t\t\t\tvertices[vc++] = 0;\r\n\t\t\t\t//normal\r\n\t\t\t\tvertices[vc++] = 0;\r\n\t\t\t\tvertices[vc++] = -1;\r\n\t\t\t\tvertices[vc++] = 0;\r\n\t\t\t\t//uv\r\n\t\t\t\tvertices[vc++] = 0.5;\r\n\t\t\t\tvertices[vc++] = 0.5;\r\n\t\t\t}\r\n\r\n\t\t\tcurAngle = bv * sliceAngle;\r\n\t\t\tposX = Math.cos(curAngle + Math.PI) * radius;\r\n\t\t\tposY = -halfHeight;\r\n\t\t\tposZ = Math.sin(curAngle + Math.PI) * radius;\r\n\r\n\t\t\t//pos\r\n\t\t\tvertices[vc++] = posX;\r\n\t\t\tvertices[vc++] = posY;\r\n\t\t\tvertices[vc++] = posZ;\r\n\t\t\t//normal\r\n\t\t\tvertices[vc++] = 0;\r\n\t\t\tvertices[vc++] = -1;\r\n\t\t\tvertices[vc++] = 0;\r\n\t\t\t//uv\r\n\t\t\tvertices[vc++] = 0.5 + Math.cos(curAngle) * 0.5;\r\n\t\t\tvertices[vc++] = 0.5 + Math.sin(curAngle) * 0.5;\r\n\r\n\t\t}\r\n\r\n\t\tfor (var bi: number = 0; bi < slices; bi++) {\r\n\t\t\tindices[ic++] = 0 + verticeCount;\r\n\t\t\tindices[ic++] = bi + 2 + verticeCount;\r\n\t\t\tindices[ic++] = bi + 1 + verticeCount;\r\n\t\t}\r\n\r\n\t\tverticeCount += slices + 1 + 1;\r\n\t\treturn PrimitiveMesh._createMesh(vertexDeclaration, vertices, indices);\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t * @param radius \r\n\t * @param height \r\n\t * @param slices \r\n\t */\r\n\tstatic createCylinder(radius: number = 0.5, height: number = 2, slices: number = 32): Mesh {\r\n\t\t//(this._released) || (dispose());//\r\n\t\tvar vertexCount: number = (slices + 1 + 1) + (slices + 1) * 2 + (slices + 1 + 1);\r\n\t\tvar indexCount: number = 3 * slices + 6 * slices + 3 * slices;\r\n\r\n\t\t//\r\n\t\tvar vertexDeclaration: VertexDeclaration = VertexMesh.getVertexDeclaration(\"POSITION,NORMAL,UV\");\r\n\t\t//,/\r\n\t\tvar vertexFloatStride: number = vertexDeclaration.vertexStride / 4;\r\n\t\t//\r\n\t\tvar vertices: Float32Array = new Float32Array(vertexCount * vertexFloatStride);\r\n\t\t//\r\n\t\tvar indices: Uint16Array = new Uint16Array(indexCount);\r\n\r\n\t\tvar sliceAngle: number = (Math.PI * 2.0) / slices;\r\n\r\n\t\tvar halfHeight: number = height / 2;\r\n\t\tvar curAngle: number = 0;\r\n\t\tvar verticeCount: number = 0;\r\n\t\tvar posX: number = 0;\r\n\t\tvar posY: number = 0;\r\n\t\tvar posZ: number = 0;\r\n\r\n\t\tvar vc: number = 0;\r\n\t\tvar ic: number = 0;\r\n\r\n\t\t//\r\n\t\tfor (var tv: number = 0; tv <= slices; tv++) {\r\n\r\n\t\t\tif (tv === 0) {\r\n\t\t\t\t//pos\r\n\t\t\t\tvertices[vc++] = 0;\r\n\t\t\t\tvertices[vc++] = halfHeight;\r\n\t\t\t\tvertices[vc++] = 0;\r\n\t\t\t\t//normal\r\n\t\t\t\tvertices[vc++] = 0;\r\n\t\t\t\tvertices[vc++] = 1;\r\n\t\t\t\tvertices[vc++] = 0;\r\n\t\t\t\t//uv\r\n\t\t\t\tvertices[vc++] = 0.5;\r\n\t\t\t\tvertices[vc++] = 0.5;\r\n\r\n\t\t\t}\r\n\r\n\t\t\tcurAngle = tv * sliceAngle;\r\n\t\t\tposX = Math.cos(curAngle) * radius;\r\n\t\t\tposY = halfHeight;\r\n\t\t\tposZ = Math.sin(curAngle) * radius;\r\n\r\n\t\t\t//pos\r\n\t\t\tvertices[vc++] = posX;\r\n\t\t\tvertices[vc++] = posY;\r\n\t\t\tvertices[vc++] = posZ;\r\n\t\t\t//normal\r\n\t\t\tvertices[vc++] = 0;\r\n\t\t\tvertices[vc++] = 1;\r\n\t\t\tvertices[vc++] = 0;\r\n\r\n\t\t\t//uv\r\n\t\t\tvertices[vc++] = 0.5 + Math.cos(curAngle) * 0.5;\r\n\t\t\tvertices[vc++] = 0.5 + Math.sin(curAngle) * 0.5;\r\n\t\t}\r\n\r\n\t\tfor (var ti: number = 0; ti < slices; ti++) {\r\n\t\t\tindices[ic++] = 0;\r\n\t\t\tindices[ic++] = ti + 1;\r\n\t\t\tindices[ic++] = ti + 2;\r\n\t\t}\r\n\t\tverticeCount += slices + 1 + 1;\r\n\r\n\t\t//\r\n\t\tfor (var rv: number = 0; rv <= slices; rv++) {\r\n\t\t\tcurAngle = rv * sliceAngle;\r\n\t\t\tposX = Math.cos(curAngle + Math.PI) * radius;\r\n\t\t\tposY = halfHeight;\r\n\t\t\tposZ = Math.sin(curAngle + Math.PI) * radius;\r\n\r\n\t\t\t//pos\r\n\t\t\tvertices[vc++] = posX;\r\n\t\t\tvertices[vc + (slices + 1) * 8 - 1] = posX;\r\n\t\t\tvertices[vc++] = posY;\r\n\t\t\tvertices[vc + (slices + 1) * 8 - 1] = -posY;\r\n\t\t\tvertices[vc++] = posZ;\r\n\t\t\tvertices[vc + (slices + 1) * 8 - 1] = posZ;\r\n\t\t\t//normal\r\n\t\t\tvertices[vc++] = posX;\r\n\t\t\tvertices[vc + (slices + 1) * 8 - 1] = posX;\r\n\t\t\tvertices[vc++] = 0;\r\n\t\t\tvertices[vc + (slices + 1) * 8 - 1] = 0;\r\n\t\t\tvertices[vc++] = posZ;\r\n\t\t\tvertices[vc + (slices + 1) * 8 - 1] = posZ;\r\n\t\t\t//uv    \r\n\t\t\tvertices[vc++] = 1 - rv * 1 / slices;\r\n\t\t\tvertices[vc + (slices + 1) * 8 - 1] = 1 - rv * 1 / slices;\r\n\t\t\tvertices[vc++] = 0;\r\n\t\t\tvertices[vc + (slices + 1) * 8 - 1] = 1;\r\n\r\n\t\t}\r\n\r\n\t\tvc += (slices + 1) * 8;\r\n\r\n\t\tfor (var ri: number = 0; ri < slices; ri++) {\r\n\t\t\tindices[ic++] = ri + verticeCount + (slices + 1);\r\n\t\t\tindices[ic++] = ri + verticeCount + 1;\r\n\t\t\tindices[ic++] = ri + verticeCount;\r\n\r\n\t\t\tindices[ic++] = ri + verticeCount + (slices + 1);\r\n\t\t\tindices[ic++] = ri + verticeCount + (slices + 1) + 1;\r\n\t\t\tindices[ic++] = ri + verticeCount + 1;\r\n\r\n\t\t}\r\n\r\n\t\tverticeCount += 2 * (slices + 1);\r\n\r\n\t\t//\r\n\t\tfor (var bv: number = 0; bv <= slices; bv++) {\r\n\t\t\tif (bv === 0) {\r\n\t\t\t\t//pos\r\n\t\t\t\tvertices[vc++] = 0;\r\n\t\t\t\tvertices[vc++] = -halfHeight;\r\n\t\t\t\tvertices[vc++] = 0;\r\n\t\t\t\t//normal\r\n\t\t\t\tvertices[vc++] = 0;\r\n\t\t\t\tvertices[vc++] = -1;\r\n\t\t\t\tvertices[vc++] = 0;\r\n\t\t\t\t//uv\r\n\t\t\t\tvertices[vc++] = 0.5;\r\n\t\t\t\tvertices[vc++] = 0.5;\r\n\r\n\t\t\t}\r\n\r\n\t\t\tcurAngle = bv * sliceAngle;\r\n\t\t\tposX = Math.cos(curAngle + Math.PI) * radius;\r\n\t\t\tposY = -halfHeight;\r\n\t\t\tposZ = Math.sin(curAngle + Math.PI) * radius;\r\n\r\n\t\t\t//pos\r\n\t\t\tvertices[vc++] = posX;\r\n\t\t\tvertices[vc++] = posY;\r\n\t\t\tvertices[vc++] = posZ;\r\n\t\t\t//normal\r\n\t\t\tvertices[vc++] = 0;\r\n\t\t\tvertices[vc++] = -1;\r\n\t\t\tvertices[vc++] = 0;\r\n\t\t\t//uv\r\n\t\t\tvertices[vc++] = 0.5 + Math.cos(curAngle) * 0.5;\r\n\t\t\tvertices[vc++] = 0.5 + Math.sin(curAngle) * 0.5;\r\n\r\n\t\t}\r\n\r\n\t\tfor (var bi: number = 0; bi < slices; bi++) {\r\n\t\t\tindices[ic++] = 0 + verticeCount;\r\n\t\t\tindices[ic++] = bi + 2 + verticeCount;\r\n\t\t\tindices[ic++] = bi + 1 + verticeCount;\r\n\t\t}\r\n\r\n\t\tverticeCount += slices + 1 + 1;\r\n\t\treturn PrimitiveMesh._createMesh(vertexDeclaration, vertices, indices);\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t * @param long  \r\n\t * @param width \r\n\t */\r\n\tstatic createPlane(long: number = 10, width: number = 10, stacks: number = 10, slices: number = 10): Mesh {\r\n\t\tvar vertexCount: number = (stacks + 1) * (slices + 1);\r\n\t\tvar indexCount: number = stacks * slices * 2 * 3;\r\n\t\tvar indices: Uint16Array = new Uint16Array(indexCount);\r\n\t\t//\r\n\t\tvar vertexDeclaration: VertexDeclaration = VertexMesh.getVertexDeclaration(\"POSITION,NORMAL,UV\");\r\n\t\t//,/\r\n\t\tvar vertexFloatStride: number = vertexDeclaration.vertexStride / 4;\r\n\t\t//\r\n\t\tvar vertices: Float32Array = new Float32Array(vertexCount * vertexFloatStride);\r\n\r\n\t\tvar halfLong: number = long / 2;\r\n\t\tvar halfWidth: number = width / 2;\r\n\t\tvar stacksLong: number = long / stacks;\r\n\t\tvar slicesWidth: number = width / slices;\r\n\r\n\t\tvar verticeCount: number = 0;\r\n\r\n\t\tfor (var i: number = 0; i <= slices; i++) {\r\n\r\n\t\t\tfor (var j: number = 0; j <= stacks; j++) {\r\n\r\n\t\t\t\tvertices[verticeCount++] = j * stacksLong - halfLong;\r\n\t\t\t\tvertices[verticeCount++] = 0;\r\n\t\t\t\tvertices[verticeCount++] = i * slicesWidth - halfWidth;\r\n\t\t\t\tvertices[verticeCount++] = 0;\r\n\t\t\t\tvertices[verticeCount++] = 1;\r\n\t\t\t\tvertices[verticeCount++] = 0;\r\n\t\t\t\tvertices[verticeCount++] = j * 1 / stacks;\r\n\t\t\t\tvertices[verticeCount++] = i * 1 / slices;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tvar indiceIndex: number = 0;\r\n\r\n\t\tfor (i = 0; i < slices; i++) {\r\n\r\n\t\t\tfor (j = 0; j < stacks; j++) {\r\n\r\n\t\t\t\tindices[indiceIndex++] = (i + 1) * (stacks + 1) + j;\r\n\t\t\t\tindices[indiceIndex++] = i * (stacks + 1) + j;\r\n\t\t\t\tindices[indiceIndex++] = (i + 1) * (stacks + 1) + j + 1;\r\n\r\n\t\t\t\tindices[indiceIndex++] = i * (stacks + 1) + j;\r\n\t\t\t\tindices[indiceIndex++] = i * (stacks + 1) + j + 1;\r\n\t\t\t\tindices[indiceIndex++] = (i + 1) * (stacks + 1) + j + 1;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn PrimitiveMesh._createMesh(vertexDeclaration, vertices, indices);\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t * @param long  \r\n\t * @param width \r\n\t */\r\n\tstatic createQuad(long: number = 1, width: number = 1): Mesh {\r\n\t\t//\r\n\t\tvar vertexDeclaration: VertexDeclaration = VertexMesh.getVertexDeclaration(\"POSITION,NORMAL,UV\");\r\n\t\tvar halfLong: number = long / 2;\r\n\t\tvar halfWidth: number = width / 2;\r\n\r\n\t\tvar vertices: Float32Array = new Float32Array([-halfLong, halfWidth, 0, 0, 0, 1, 0, 0, halfLong, halfWidth, 0, 0, 0, 1, 1, 0, -halfLong, -halfWidth, 0, 0, 0, 1, 0, 1, halfLong, -halfWidth, 0, 0, 0, 1, 1, 1]);\r\n\t\tvar indices: Uint16Array = new Uint16Array([0, 1, 2, 3, 2, 1]);\r\n\r\n\t\treturn PrimitiveMesh._createMesh(vertexDeclaration, vertices, indices);\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t * @param radius \r\n\t * @param stacks \r\n\t * @param slices \r\n\t */\r\n\tstatic createSphere(radius: number = 0.5, stacks: number = 32, slices: number = 32): Mesh {\r\n\t\tvar vertexCount: number = (stacks + 1) * (slices + 1);\r\n\t\tvar indexCount: number = (3 * stacks * (slices + 1)) * 2;\r\n\r\n\t\tvar indices: Uint16Array = new Uint16Array(indexCount);\r\n\t\tvar vertexDeclaration: VertexDeclaration = VertexMesh.getVertexDeclaration(\"POSITION,NORMAL,UV\");\r\n\t\tvar vertexFloatStride: number = vertexDeclaration.vertexStride / 4;\r\n\t\tvar vertices: Float32Array = new Float32Array(vertexCount * vertexFloatStride);\r\n\r\n\t\tvar stackAngle: number = Math.PI / stacks;\r\n\t\tvar sliceAngle: number = (Math.PI * 2.0) / slices;\r\n\r\n\t\t// Generate the group of Stacks for the sphere  \r\n\t\tvar vertexIndex: number = 0;\r\n\t\tvertexCount = 0;\r\n\t\tindexCount = 0;\r\n\r\n\t\tfor (var stack: number = 0; stack < (stacks + 1); stack++) {\r\n\t\t\tvar r: number = Math.sin(stack * stackAngle);\r\n\t\t\tvar y: number = Math.cos(stack * stackAngle);\r\n\r\n\t\t\t// Generate the group of segments for the current Stack  \r\n\t\t\tfor (var slice: number = 0; slice < (slices + 1); slice++) {\r\n\t\t\t\tvar x: number = r * Math.sin(slice * sliceAngle + Math.PI * 1 / 2);\r\n\t\t\t\tvar z: number = r * Math.cos(slice * sliceAngle + Math.PI * 1 / 2);\r\n\t\t\t\tvertices[vertexCount + 0] = x * radius;\r\n\t\t\t\tvertices[vertexCount + 1] = y * radius;\r\n\t\t\t\tvertices[vertexCount + 2] = z * radius;\r\n\r\n\t\t\t\tvertices[vertexCount + 3] = x;\r\n\t\t\t\tvertices[vertexCount + 4] = y;\r\n\t\t\t\tvertices[vertexCount + 5] = z;\r\n\r\n\t\t\t\tvertices[vertexCount + 6] = slice / slices;\r\n\t\t\t\tvertices[vertexCount + 7] = stack / stacks;\r\n\t\t\t\tvertexCount += vertexFloatStride;\r\n\t\t\t\tif (stack != (stacks - 1)) {\r\n\t\t\t\t\t// First Face\r\n\t\t\t\t\tindices[indexCount++] = vertexIndex + (slices + 1);\r\n\t\t\t\t\tindices[indexCount++] = vertexIndex;\r\n\t\t\t\t\tindices[indexCount++] = vertexIndex + 1;\r\n\t\t\t\t\t// Second \r\n\t\t\t\t\tindices[indexCount++] = vertexIndex + (slices);\r\n\t\t\t\t\tindices[indexCount++] = vertexIndex;\r\n\t\t\t\t\tindices[indexCount++] = vertexIndex + (slices + 1);\r\n\t\t\t\t\tvertexIndex++;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn PrimitiveMesh._createMesh(vertexDeclaration, vertices, indices);\r\n\t}\r\n}\r\n\r\n","#if !defined(Utils_lib)\r\n    #define Utils_lib\r\n\r\n#endif // Utils_lib","#define SHADER_NAME BlitFS\r\n\r\n#include \"Color.glsl\";\r\n#include \"FastApproximateAntiAliasing.glsl\";\r\n\r\nvarying vec2 v_Texcoord0;\r\n\r\nvoid main()\r\n{\r\n#ifdef FXAA\r\n    gl_FragColor = FXAAMain(u_MainTex, v_Texcoord0, u_MainTex_TexelSize.zw);\r\n#else\r\n    vec4 mainColor = texture2D(u_MainTex, v_Texcoord0);\r\n    #ifdef Gamma_u_MainTex\r\n    mainColor = gammaToLinear(mainColor);\r\n    #endif // Gamma_u_AlbedoTexture\r\n    gl_FragColor = mainColor;\r\n#endif\r\n\r\n    gl_FragColor = outputTransform(gl_FragColor);\r\n}\r\n","import { Shader3D, ShaderFeatureType } from \"../../../RenderEngine/RenderShader/Shader3D\";\r\nimport { ShaderDataType } from \"../../../RenderEngine/RenderShader/ShaderData\";\r\nimport BlitVS from \"./BlitScreen.vs\";\r\nimport BlitFS from \"./BlitScreen.fs\";\r\nimport FXAA from \"./FastApproximateAntiAliasing.glsl\";\r\nimport { SubShader } from \"../../../RenderEngine/RenderShader/SubShader\";\r\nimport { RenderState } from \"../../../RenderEngine/RenderShader/RenderState\";\r\nimport { VertexMesh } from \"../../../RenderEngine/RenderShader/VertexMesh\";\r\n\r\nimport ColorGradingGLSL from \"./ColorGrading.glsl\";\r\nimport TonemappingGLSL from \"./Tonemapping.glsl\";\r\nimport LUTGLSL from \"./LUT.glsl\";\r\n\r\nimport LUTBuilderFS from \"./LUTBuilder.fs\";\r\n\r\nexport class BlitScreenShaderInit {\r\n\r\n    static init() {\r\n        Shader3D.addInclude(\"FastApproximateAntiAliasing.glsl\", FXAA);\r\n\r\n        Shader3D.addInclude(\"ColorGrading.glsl\", ColorGradingGLSL);\r\n        Shader3D.addInclude(\"Tonemapping.glsl\", TonemappingGLSL);\r\n        Shader3D.addInclude(\"LUT.glsl\", LUTGLSL);\r\n\r\n        let attributeMap: { [name: string]: [number, ShaderDataType] } = {\r\n            \"a_PositionTexcoord\": [VertexMesh.MESH_POSITION0, ShaderDataType.Vector4]\r\n        };\r\n\r\n        let uniformMap = {\r\n            \"u_OffsetScale\": ShaderDataType.Vector4,\r\n            \"u_MainTex\": ShaderDataType.Texture2D,\r\n            \"u_MainTex_TexelSize\": ShaderDataType.Vector4, //x:width,y:height,z:1/width,w:1/height\r\n        };\r\n\r\n        let shader = Shader3D.add(\"BlitScreen\");\r\n        shader.shaderType = ShaderFeatureType.PostProcess;\r\n        let subShader = new SubShader(attributeMap, uniformMap);\r\n        shader.addSubShader(subShader);\r\n        let blitPass = subShader.addShaderPass(BlitVS, BlitFS);\r\n        blitPass.statefirst = true;\r\n        let blitState = blitPass.renderState;\r\n        blitState.depthTest = RenderState.DEPTHTEST_ALWAYS;\r\n        blitState.depthWrite = false;\r\n        blitState.cull = RenderState.CULL_NONE;\r\n        blitState.blend = RenderState.BLEND_DISABLE;\r\n\r\n        let transparentShader = Shader3D.add(\"BlitScreen_Transparnet\");\r\n        shader.shaderType = ShaderFeatureType.PostProcess;\r\n        let transparentSubShader = new SubShader(attributeMap, uniformMap);\r\n        transparentShader.addSubShader(transparentSubShader);\r\n        let blitPassTrans = transparentSubShader.addShaderPass(BlitVS, BlitFS);\r\n        blitPass.statefirst = true;\r\n        blitState = blitPassTrans.renderState;\r\n        blitState.depthTest = RenderState.DEPTHTEST_ALWAYS;\r\n        blitState.depthWrite = false;\r\n        blitState.cull = RenderState.CULL_NONE;\r\n        blitState.blend = RenderState.BLEND_ENABLE_ALL;\r\n        blitState.srcBlend = RenderState.BLENDPARAM_SRC_ALPHA;\r\n        blitState.dstBlend = RenderState.BLENDPARAM_ONE_MINUS_SRC_ALPHA;\r\n\r\n        this.lutBuilderInit();\r\n    }\r\n\r\n    private static lutBuilderInit() {\r\n\r\n        let attributeMap: { [name: string]: [number, ShaderDataType] } = {\r\n            \"a_PositionTexcoord\": [VertexMesh.MESH_POSITION0, ShaderDataType.Vector4]\r\n        };\r\n\r\n        let uniformMap = {\r\n            \"u_OffsetScale\": ShaderDataType.Vector4,\r\n            \"u_MainTex\": ShaderDataType.Texture2D,\r\n            \"u_MainTex_TexelSize\": ShaderDataType.Vector4, //x:width,y:height,z:1/width,w:1/height\r\n            \"u_LutParams\": ShaderDataType.Vector4\r\n        };\r\n\r\n        let shader = Shader3D.add(\"LUTBuilder\");\r\n        shader.shaderType = ShaderFeatureType.PostProcess;\r\n        let subShader = new SubShader(attributeMap, uniformMap);\r\n        shader.addSubShader(subShader);\r\n        let pass = subShader.addShaderPass(BlitVS, LUTBuilderFS);\r\n        pass.renderState.depthTest = RenderState.DEPTHTEST_ALWAYS;\r\n        pass.renderState.depthWrite = false;\r\n        pass.renderState.cull = RenderState.CULL_NONE;\r\n        pass.renderState.blend = RenderState.BLEND_DISABLE;\r\n        pass.statefirst = true;\r\n    }\r\n\r\n}","#if !defined(FXAA_lib)\r\n    #define FXAA_lib\r\n#ifdef FXAA\r\n    #define EDGE_THRESHOLD_MIN 0.0312\r\n    #define EDGE_THRESHOLD_MAX 0.125\r\n    #define QUALITY(q)\t       ((q) < 5 ? 1.0 : ((q) > 5 ? ((q) < 10 ? 2.0 : ((q) < 11 ? 4.0 : 8.0)) : 1.5))\r\n    #define ITERATIONS\t       12\r\n    #define SUBPIXEL_QUALITY   0.75\r\n\r\nfloat rgb2luma(in vec3 rgb)\r\n{\r\n    return dot(rgb, vec3(0.299, 0.587, 0.114));\r\n}\r\n\r\nvec3 textureOffsetbyScreenSize(in sampler2D mainTex, in vec2 uv, in vec2 offset, in vec2 inverseScreenSize)\r\n{\r\n    vec2 sampleruv = uv + inverseScreenSize * offset; // u_texturesize\r\n    return texture2D(mainTex, sampleruv).rgb;\r\n}\r\n\r\nvec4 FXAAMain(in sampler2D mainTex, in vec2 texuv, in vec2 inverseScreenSize)\r\n{\r\n\r\n    vec4 mainColor = texture2D(mainTex, texuv);\r\n    vec3 colorCenter = mainColor.rgb;\r\n    // Luma at the current fragment\r\n    float lumaCenter = rgb2luma(colorCenter);\r\n\r\n    // Luma at the four direct neighbours of the current fragment.\r\n    float lumaDown = rgb2luma(textureOffsetbyScreenSize(mainTex, texuv, vec2(0, -1), inverseScreenSize));\r\n    float lumaUp = rgb2luma(textureOffsetbyScreenSize(mainTex, texuv, vec2(0, 1), inverseScreenSize));\r\n    float lumaLeft = rgb2luma(textureOffsetbyScreenSize(mainTex, texuv, vec2(-1, 0), inverseScreenSize));\r\n    float lumaRight = rgb2luma(textureOffsetbyScreenSize(mainTex, texuv, vec2(1, 0), inverseScreenSize));\r\n\r\n    // Find the maximum and minimum luma around the current fragment.\r\n    float lumaMin = min(lumaCenter, min(min(lumaDown, lumaUp), min(lumaLeft, lumaRight)));\r\n    float lumaMax = max(lumaCenter, max(max(lumaDown, lumaUp), max(lumaLeft, lumaRight)));\r\n\r\n    // Compute the delta.\r\n    float lumaRange = lumaMax - lumaMin;\r\n\r\n    // If the luma variation is lower that a threshold (or if we are in a really dark area), we are not on an edge, don't perform any AA.\r\n    if (lumaRange < max(EDGE_THRESHOLD_MIN, lumaMax * EDGE_THRESHOLD_MAX))\r\n\t{\r\n\t    return mainColor;\r\n\t}\r\n\r\n    // Query the 4 remaining corners lumas.\r\n    float lumaDownLeft = rgb2luma(textureOffsetbyScreenSize(mainTex, texuv, vec2(-1, -1), inverseScreenSize));\r\n    float lumaUpRight = rgb2luma(textureOffsetbyScreenSize(mainTex, texuv, vec2(1, 1), inverseScreenSize));\r\n    float lumaUpLeft = rgb2luma(textureOffsetbyScreenSize(mainTex, texuv, vec2(-1, 1), inverseScreenSize));\r\n    float lumaDownRight = rgb2luma(textureOffsetbyScreenSize(mainTex, texuv, vec2(1, -1), inverseScreenSize));\r\n\r\n    // Combine the four edges lumas (using intermediary variables for future computations with the same values).\r\n    float lumaDownUp = lumaDown + lumaUp;\r\n    float lumaLeftRight = lumaLeft + lumaRight;\r\n\r\n    // Same for corners\r\n    float lumaLeftCorners = lumaDownLeft + lumaUpLeft;\r\n    float lumaDownCorners = lumaDownLeft + lumaDownRight;\r\n    float lumaRightCorners = lumaDownRight + lumaUpRight;\r\n    float lumaUpCorners = lumaUpRight + lumaUpLeft;\r\n\r\n    // Compute an estimation of the gradient along the horizontal and vertical axis.\r\n    float edgeHorizontal = abs(-2.0 * lumaLeft + lumaLeftCorners) + abs(-2.0 * lumaCenter + lumaDownUp) * 2.0 + abs(-2.0 * lumaRight + lumaRightCorners);\r\n    float edgeVertical = abs(-2.0 * lumaUp + lumaUpCorners) + abs(-2.0 * lumaCenter + lumaLeftRight) * 2.0 + abs(-2.0 * lumaDown + lumaDownCorners);\r\n\r\n    // Is the local edge horizontal or vertical ?\r\n    bool isHorizontal = (edgeHorizontal >= edgeVertical);\r\n\r\n    // Choose the step size (one pixel) accordingly.\r\n    float stepLength = isHorizontal ? inverseScreenSize.y : inverseScreenSize.x;\r\n\r\n    // Select the two neighboring texels lumas in the opposite direction to the local edge.\r\n    float luma1 = isHorizontal ? lumaDown : lumaLeft;\r\n    float luma2 = isHorizontal ? lumaUp : lumaRight;\r\n    // Compute gradients in this direction.\r\n    float gradient1 = luma1 - lumaCenter;\r\n    float gradient2 = luma2 - lumaCenter;\r\n\r\n    // Which direction is the steepest ?\r\n    bool is1Steepest = abs(gradient1) >= abs(gradient2);\r\n\r\n    // Gradient in the corresponding direction, normalized.\r\n    float gradientScaled = 0.25 * max(abs(gradient1), abs(gradient2));\r\n\r\n    // Average luma in the correct direction.\r\n    float lumaLocalAverage = 0.0;\r\n    if (is1Steepest)\r\n\t{\r\n\t    // Switch the direction\r\n\t    stepLength = -stepLength;\r\n\t    lumaLocalAverage = 0.5 * (luma1 + lumaCenter);\r\n\t}\r\n    else\r\n\t{\r\n\t    lumaLocalAverage = 0.5 * (luma2 + lumaCenter);\r\n\t}\r\n\r\n    // Shift UV in the correct direction by half a pixel.\r\n    vec2 currentUv = texuv;\r\n    if (isHorizontal)\r\n\t{\r\n\t    currentUv.y += stepLength * 0.5;\r\n\t}\r\n    else\r\n\t{\r\n\t    currentUv.x += stepLength * 0.5;\r\n\t}\r\n\r\n    // Compute offset (for each iteration step) in the right direction.\r\n    vec2 offset = isHorizontal ? vec2(inverseScreenSize.x, 0.0) : vec2(0.0, inverseScreenSize.y);\r\n    // Compute UVs to explore on each side of the edge, orthogonally. The QUALITY allows us to step faster.\r\n    vec2 uv1 = currentUv - offset * QUALITY(0);\r\n    vec2 uv2 = currentUv + offset * QUALITY(0);\r\n\r\n    // Read the lumas at both current extremities of the exploration segment, and compute the delta wrt to the local average luma.\r\n    float lumaEnd1 = rgb2luma(textureOffsetbyScreenSize(mainTex, uv1, vec2(0.0, 0.0), inverseScreenSize));\r\n    float lumaEnd2 = rgb2luma(textureOffsetbyScreenSize(mainTex, uv2, vec2(0.0, 0.0), inverseScreenSize));\r\n    lumaEnd1 -= lumaLocalAverage;\r\n    lumaEnd2 -= lumaLocalAverage;\r\n\r\n    // If the luma deltas at the current extremities is larger than the local gradient, we have reached the side of the edge.\r\n    bool reached1 = abs(lumaEnd1) >= gradientScaled;\r\n    bool reached2 = abs(lumaEnd2) >= gradientScaled;\r\n    bool reachedBoth = reached1 && reached2;\r\n\r\n    // If the side is not reached, we continue to explore in this direction.\r\n    if (!reached1)\r\n\t{\r\n\t    uv1 -= offset * QUALITY(1);\r\n\t}\r\n    if (!reached2)\r\n\t{\r\n\t    uv2 += offset * QUALITY(1);\r\n\t}\r\n\r\n    // If both sides have not been reached, continue to explore.\r\n    if (!reachedBoth)\r\n\t{\r\n\r\n\t    for (int i = 2; i < ITERATIONS; i++)\r\n\t\t{\r\n\t\t    // If needed, read luma in 1st direction, compute delta.\r\n\t\t    if (!reached1)\r\n\t\t\t{\r\n\t\t\t    lumaEnd1 = rgb2luma(textureOffsetbyScreenSize(mainTex, uv1, vec2(0.0, 0.0), inverseScreenSize));\r\n\t\t\t    lumaEnd1 = lumaEnd1 - lumaLocalAverage;\r\n\t\t\t}\r\n\t\t    // If needed, read luma in opposite direction, compute delta.\r\n\t\t    if (!reached2)\r\n\t\t\t{\r\n\t\t\t    lumaEnd2 = rgb2luma(textureOffsetbyScreenSize(mainTex, uv2, vec2(0.0, 0.0), inverseScreenSize));\r\n\t\t\t    lumaEnd2 = lumaEnd2 - lumaLocalAverage;\r\n\t\t\t}\r\n\t\t    // If the luma deltas at the current extremities is larger than the local gradient, we have reached the side of the edge.\r\n\t\t    reached1 = abs(lumaEnd1) >= gradientScaled;\r\n\t\t    reached2 = abs(lumaEnd2) >= gradientScaled;\r\n\t\t    reachedBoth = reached1 && reached2;\r\n\r\n\t\t    // If the side is not reached, we continue to explore in this direction, with a variable quality.\r\n\t\t    if (!reached1)\r\n\t\t\t{\r\n\t\t\t    uv1 -= offset * QUALITY(i);\r\n\t\t\t}\r\n\t\t    if (!reached2)\r\n\t\t\t{\r\n\t\t\t    uv2 += offset * QUALITY(i);\r\n\t\t\t}\r\n\r\n\t\t    // If both sides have been reached, stop the exploration.\r\n\t\t    if (reachedBoth)\r\n\t\t\t{\r\n\t\t\t    break;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n    // Compute the distances to each side edge of the edge (!).\r\n    float distance1 = isHorizontal ? (texuv.x - uv1.x) : (texuv.y - uv1.y);\r\n    float distance2 = isHorizontal ? (uv2.x - texuv.x) : (uv2.y - texuv.y);\r\n\r\n    // In which direction is the side of the edge closer ?\r\n    bool isDirection1 = distance1 < distance2;\r\n    float distanceFinal = min(distance1, distance2);\r\n\r\n    // Thickness of the edge.\r\n    float edgeThickness = (distance1 + distance2);\r\n\r\n    // Is the luma at center smaller than the local average ?\r\n    bool isLumaCenterSmaller = lumaCenter < lumaLocalAverage;\r\n\r\n    // If the luma at center is smaller than at its neighbour, the delta luma at each end should be positive (same variation).\r\n    bool correctVariation1 = (lumaEnd1 < 0.0) != isLumaCenterSmaller;\r\n    bool correctVariation2 = (lumaEnd2 < 0.0) != isLumaCenterSmaller;\r\n\r\n    // Only keep the result in the direction of the closer side of the edge.\r\n    bool correctVariation = isDirection1 ? correctVariation1 : correctVariation2;\r\n\r\n    // UV offset: read in the direction of the closest side of the edge.\r\n    float pixelOffset = -distanceFinal / edgeThickness + 0.5;\r\n\r\n    // If the luma variation is incorrect, do not offset.\r\n    float finalOffset = correctVariation ? pixelOffset : 0.0;\r\n\r\n    // Sub-pixel shifting\r\n    // Full weighted average of the luma over the 3x3 neighborhood.\r\n    float lumaAverage = (1.0 / 12.0) * (2.0 * (lumaDownUp + lumaLeftRight) + lumaLeftCorners + lumaRightCorners);\r\n    // Ratio of the delta between the global average and the center luma, over the luma range in the 3x3 neighborhood.\r\n    float subPixelOffset1 = clamp(abs(lumaAverage - lumaCenter) / lumaRange, 0.0, 1.0);\r\n    float subPixelOffset2 = (-2.0 * subPixelOffset1 + 3.0) * subPixelOffset1 * subPixelOffset1;\r\n    // Compute a sub-pixel offset based on this delta.\r\n    float subPixelOffsetFinal = subPixelOffset2 * subPixelOffset2 * SUBPIXEL_QUALITY;\r\n\r\n    // Pick the biggest of the two offsets.\r\n    finalOffset = max(finalOffset, subPixelOffsetFinal);\r\n\r\n    // Compute the final UV coordinates.\r\n    vec2 finalUv = texuv;\r\n    if (isHorizontal)\r\n\t{\r\n\t    finalUv.y += finalOffset * stepLength;\r\n\t}\r\n    else\r\n\t{\r\n\t    finalUv.x += finalOffset * stepLength;\r\n\t}\r\n\r\n    // Read the color at the new UV coordinates, and use it.\r\n    return texture2D(mainTex, finalUv);\r\n}\r\n#endif//FXAA\r\n#endif // Color_lib\r\n","#if !defined(ColorGrading_lib)\r\n    #define ColorGrading_lib\r\n\r\nconst float ACEScc_MAX = 1.4679964;\r\nconst float ACEScc_MIDGRAY = 0.4135884;\r\n\r\nconst float LogC_cut = 0.011361;\r\nconst float LogC_a = 5.555556;\r\nconst float LogC_b = 0.047996;\r\nconst float LogC_c = 0.244161;\r\nconst float LogC_d = 0.386036;\r\nconst float LogC_e = 5.301883;\r\nconst float LogC_f = 0.092819;\r\n\r\nfloat linearToLogC(float x)\r\n{\r\n    float o;\r\n    if (x > LogC_cut)\r\n\t{\r\n\t    o = LogC_c * log10(max(LogC_a * x + LogC_b, 0.0)) + LogC_d;\r\n\t}\r\n    else\r\n\t{\r\n\t    o = LogC_e * x + LogC_f;\r\n\t}\r\n    return o;\r\n}\r\n\r\nvec3 linearToLogC(vec3 x)\r\n{\r\n    vec3 logc;\r\n    logc.x = linearToLogC(x.x);\r\n    logc.y = linearToLogC(x.y);\r\n    logc.z = linearToLogC(x.z);\r\n    return logc;\r\n}\r\n\r\nfloat logCToLinear(float x)\r\n{\r\n    float o;\r\n    if (x > LogC_e * LogC_cut + LogC_f)\r\n\to = (pow(10.0, (x - LogC_d) / LogC_c) - LogC_b) / LogC_a;\r\n    else\r\n\to = (x - LogC_f) / LogC_e;\r\n    return o;\r\n}\r\n\r\nvec3 logCToLinear(vec3 x)\r\n{\r\n    vec3 linear;\r\n    linear.x = logCToLinear(x.x);\r\n    linear.y = logCToLinear(x.y);\r\n    linear.z = logCToLinear(x.z);\r\n    return linear;\r\n}\r\n\r\n// Hue, Saturation, Value\r\n// Ranges:\r\n//  Hue [0.0, 1.0]\r\n//  Sat [0.0, 1.0]\r\n//  Lum [0.0, HALF_MAX]\r\nvec3 RgbToHsv(vec3 c)\r\n{\r\n    const vec4 K = vec4(0.0, -1.0 / 3.0, 2.0 / 3.0, -1.0);\r\n    vec4 p = mix(vec4(c.bg, K.wz), vec4(c.gb, K.xy), step(c.b, c.g));\r\n    vec4 q = mix(vec4(p.xyw, c.r), vec4(c.r, p.yzx), step(p.x, c.r));\r\n    float d = q.x - min(q.w, q.y);\r\n    const float e = 1.0e-4;\r\n    return vec3(abs(q.z + (q.w - q.y) / (6.0 * d + e)), d / (q.x + e), q.x);\r\n}\r\n\r\nvec3 HsvToRgb(vec3 c)\r\n{\r\n    const vec4 K = vec4(1.0, 2.0 / 3.0, 1.0 / 3.0, 3.0);\r\n    vec3 p = abs(fract(vec3(c.x) + K.xyz) * 6.0 - K.www);\r\n    return c.z * mix(vec3(K.x) , saturate(p - vec3(K.x)), c.y);\r\n}\r\n\r\nfloat RotateHue(float value, float low, float hi)\r\n{\r\n    return (value < low)\r\n            ? value + hi\r\n            : (value > hi)\r\n                ? value - hi\r\n                : value;\r\n}\r\n\r\n\r\nconst mat3 Linear_to_LMS_MAT = mat3(\r\n    vec3(3.90405e-1, 7.08416e-2, 2.31082e-2),\r\n    vec3(5.49941e-1, 9.63172e-1, 1.28021e-1),\r\n    vec3(8.92632e-3, 1.35775e-3, 9.36245e-1));\r\n\r\nconst mat3 LMS_to_Linear_MAT = mat3(\r\n    vec3(2.85847e+0, -2.10182e-1, -4.18120e-2),\r\n    vec3(-1.62879e+0, 1.15820e+0, -1.18169e-1),\r\n    vec3(-2.48910e-2, 3.24281e-4, 1.06867e+0));\r\n\r\n// white balance\r\nuniform vec3 u_ColorBalance;\r\n\r\n// split toning\r\nuniform vec4 u_SplitShadows;\r\nuniform vec3 u_Splithighlights;\r\n\r\n// shadows, midtones, highlights\r\nuniform vec3 u_Shadows;\r\nuniform vec3 u_Midtones;\r\nuniform vec3 u_Highlights;\r\nuniform vec4 u_Limits;\r\n\r\n// lift, gamma, gain\r\nuniform vec3 u_Lift;\r\nuniform vec3 u_Gamma;\r\nuniform vec3 u_Gain;\r\n\r\n//color adjusted\r\nuniform vec4 u_ColorFilter;\r\nuniform vec4 u_HueSatCon;\r\n\r\nfloat luminance(in vec3 color)\r\n{\r\n    #ifdef ACES\r\n    float luma = dot(color, AP1_RGB2Y);\r\n    #else\r\n    float luma = dot(color, vec3(0.2126729, 0.7151522, 0.0721750));\r\n    #endif // ACES\r\n    return luma;\r\n}\r\n\r\nvec3 softlight(vec3 base, vec3 blend)\r\n{\r\n    vec3 r1 = 2.0 * base * blend + base * base * (1.0 - 2.0 * blend);\r\n    vec3 r2 = sqrt(base) * (2.0 * blend - 1.0) + 2.0 * base * (1.0 - blend);\r\n    vec3 t = step(0.5, blend);\r\n    return r2 * t + (1.0 - t) * r1;\r\n}\r\n\r\n// input linear sRGB\r\n// if ACES tonemap, calculate in ACEScg, return ACEScg\r\n// else calculate in logC, return linear sRGB\r\nvec3 colorGrade(in vec3 color)\r\n{\r\n    // White balance in LMS space\r\n    vec3 colorLMS = Linear_to_LMS_MAT * color;\r\n    colorLMS *= u_ColorBalance.xyz;\r\n    color = LMS_to_Linear_MAT * colorLMS;\r\n\r\n    // Do contrast in log after white balance\r\n    #ifdef ACES\r\n        vec3 colorLog = ACES_to_ACEScc(sRGB_to_AP0_MAT * color);\r\n    #else\r\n        vec3 colorLog = linearToLogC(color);\r\n    #endif\r\n    \r\n    colorLog = (colorLog - vec3(ACEScc_MIDGRAY)) * u_HueSatCon.z + vec3(ACEScc_MIDGRAY);\r\n\r\n\r\n    #ifdef ACES\r\n        //colorLinear = ACES_to_ACEScg(ACEScc_to_ACES(colorLog));\r\n        color = AP0_to_AP1_MAT * ACEScc_to_ACES(colorLog);\r\n    #else\r\n        color = logCToLinear(colorLog);\r\n    #endif // ACES\r\n\r\n    // Color filter is just an unclipped multiplier\r\n    color = color * u_ColorFilter.rgb;\r\n\r\n    color = max(vec3(0.0), color);\r\n\r\n    // split toning\r\n    float balance = u_SplitShadows.w;\r\n    vec3 gamma = linearToGamma(color);\r\n    float splitLuma = saturate(luminance(color)) + balance;\r\n    vec3 splitShadows = mix(vec3(0.5, 0.5, 0.5), u_SplitShadows.xyz, 1.0 - splitLuma);\r\n    vec3 splitHeighlights = mix(vec3(0.5, 0.5, 0.5), u_Splithighlights.xyz, splitLuma);\r\n    gamma = softlight(gamma, splitShadows);\r\n    gamma = softlight(gamma, splitHeighlights);\r\n    color = gammaToLinear(gamma);\r\n\r\n    // shadows, midtones, highlights\r\n    float luma = luminance(color);\r\n    float shadowFactor = 1.0 - smoothstep(u_Limits.x, u_Limits.y, luma);\r\n    float highlightsFactor = smoothstep(u_Limits.z, u_Limits.w, luma);\r\n    float midtonesFactor = 1.0 - shadowFactor - highlightsFactor;\r\n    color = color * u_Shadows.xyz * shadowFactor + color * u_Midtones.xyz * midtonesFactor + color * u_Highlights.xyz * highlightsFactor;\r\n\r\n    // Lift, gamma, gain\r\n    color = color * u_Gain.xyz + u_Lift.xyz;\r\n    color = sign(color) * pow(abs(color), u_Gamma.xyz);\r\n    \r\n    // HSV operations\r\n    vec3 hsv = RgbToHsv(color);\r\n    // Hue Shift & Hue Vs Hue\r\n    float hue = hsv.x + u_HueSatCon.x;\r\n    hsv.x = RotateHue(hsv.x, 0.0, 1.0);\r\n    color = HsvToRgb(hsv);\r\n\r\n    // Global saturation\r\n    luma = luminance(color);\r\n    color = vec3(luma) + (vec3(u_HueSatCon.y)) * (color - vec3(luma));\r\n    \r\n    return color;\r\n}\r\n\r\n#endif // ColorGrading_lib","#if !defined(Tonemapping_lib)\r\n    #define Tonemapping_lib\r\n\r\n// ACES Tonemapping color grading in ACEScg space\r\nvec3 tonemap(in vec3 ap1)\r\n{\r\n    vec3 color = ap1;\r\n\r\n    #ifdef ACES\r\n    vec3 aces = AP1_to_AP0_MAT * color;\r\n    vec3 oces = RRT(aces);\r\n    color = ODT_sRGB_100nits(oces);\r\n    #endif // ACES\r\n\r\n    // todo other tonemap\r\n\r\n    return color;\r\n}\r\n\r\n#endif // Tonemapping_lib","#if !defined(LUT_lib)\r\n    #define LUT_lib\r\n\r\n// scaleOffset = (1 / lut_width, 1 / lut_height, lut_height - 1)\r\nvec3 applyLut(sampler2D lut, vec3 uvw, vec3 scaleOffset)\r\n{\r\n    uvw.z *= scaleOffset.z;\r\n\r\n    float shift = floor(uvw.z);\r\n    uvw.xy = uvw.xy * scaleOffset.z * scaleOffset.xy + scaleOffset.xy * 0.5;\r\n    uvw.x += shift * scaleOffset.y;\r\n\r\n    uvw.xyz = mix(\r\n\ttexture2DLodEXT(lut, uvw.xy, 0.0).rgb,\r\n\ttexture2DLodEXT(lut, uvw.xy + vec2(scaleOffset.y, 0.0), 0.0).rgb,\r\n\tuvw.z - shift);\r\n    return uvw;\r\n}\r\n\r\n#endif // LUT_lib","#define SHADER_NAME LutBuilder\r\n\r\n#include \"Color.glsl\";\r\n\r\n#ifdef ACES\r\n    #include \"ACES.glsl\";\r\n#endif // ACES\r\n\r\n#include \"ColorGrading.glsl\";\r\n\r\n#include \"Tonemapping.glsl\";\r\n\r\nvarying vec2 v_Texcoord0;\r\n\r\n// lut params: (lutHeight, 0.5 / lutWidth, 0.5 / lutHeight, lutHeidht / (lutHeight - 1))\r\nvec3 lutValue(vec2 uv, vec4 params)\r\n{\r\n    vec3 color;\r\n    uv -= params.yz;\r\n    color.r = fract(uv.x * params.x);\r\n    color.b = uv.x - color.r / params.x;\r\n    color.g = uv.y;\r\n    return color * params.w;\r\n}\r\n\r\n// internal lut logC space\r\nvoid main()\r\n{\r\n    vec2 uv = v_Texcoord0;\r\n    vec3 color = lutValue(uv, u_LutParams);\r\n    color = logCToLinear(color);\r\n    vec3 grade = colorGrade(color);\r\n    vec3 tone = tonemap(grade);\r\n\r\n    gl_FragColor = vec4(tone, 1.0);\r\n}","\r\n#define SHADER_NAME UnlitVS\r\n\r\n#include \"Math.glsl\";\r\n\r\n#include \"Scene.glsl\";\r\n#include \"SceneFogInput.glsl\";\r\n\r\n#include \"Camera.glsl\";\r\n#include \"Sprite3DVertex.glsl\";\r\n\r\n#include \"VertexCommon.glsl\";\r\n\r\n#ifdef UV\r\nvarying vec2 v_Texcoord0;\r\n#endif // UV\r\n\r\n#ifdef COLOR\r\nvarying vec4 v_VertexColor;\r\n#endif // COLOR\r\n\r\nvoid main()\r\n{\r\n    Vertex vertex;\r\n    getVertexParams(vertex);\r\n\r\n#ifdef UV\r\n    v_Texcoord0 = transformUV(vertex.texCoord0, u_TilingOffset);\r\n#endif // UV\r\n\r\n#ifdef COLOR\r\n    v_VertexColor = vertex.vertexColor;\r\n#endif // COLOR\r\n\r\n    mat4 worldMat = getWorldMatrix();\r\n    vec4 pos = (worldMat * vec4(vertex.positionOS, 1.0));\r\n    vec3 positionWS = pos.xyz / pos.w;\r\n\r\n    gl_Position = getPositionCS(positionWS);\r\n\r\n    gl_Position = remapPositionZ(gl_Position);\r\n\r\n#ifdef FOG\r\n    FogHandle(gl_Position.z);\r\n#endif\r\n}\r\n","#define SHADER_NAME DepthVS\r\n\r\n#include \"DepthVertex.glsl\";\r\n\r\nvoid main()\r\n{\r\n    Vertex vertex;\r\n    getVertexParams(vertex);\r\n\r\n    mat4 worldMat = getWorldMatrix();\r\n    vec4 pos = (worldMat * vec4(vertex.positionOS, 1.0));\r\n    vec3 positionWS = pos.xyz / pos.w;\r\n\r\n    mat4 normalMat = transpose(inverse(worldMat));\r\n    vec3 normalWS = normalize((normalMat * vec4(vertex.normalOS, 0.0)).xyz);\r\n\r\n    vec4 positionCS = DepthPositionCS(positionWS, normalWS);\r\n    gl_Position = remapPositionZ(positionCS);\r\n}","#define SHADER_NAME DepthFS\r\n\r\n#include \"DepthFrag.glsl\";\r\n\r\nvoid main()\r\n{\r\n    gl_FragColor = getDepthColor();\r\n}","import UnlitVS from \"./Unlit.vs\";\r\nimport UnlitFS from \"./Unlit.fs\";\r\nimport DepthVS from \"../depth/Depth.vs\";\r\nimport DepthFS from \"../depth/Depth.fs\";\r\nimport { Shader3D, ShaderFeatureType } from \"../../../RenderEngine/RenderShader/Shader3D\";\r\nimport { ShaderDataType } from \"../../../RenderEngine/RenderShader/ShaderData\";\r\nimport { Color } from \"../../../maths/Color\";\r\nimport { Vector4 } from \"../../../maths/Vector4\";\r\nimport { SubShader } from \"../../../RenderEngine/RenderShader/SubShader\";\r\n\r\n\r\nexport class UnlitShaderInit {\r\n\r\n    static init() {\r\n\r\n        let uniformMap = {\r\n            \"UnlitBlock\": {\r\n                \"u_AlbedoColor\": ShaderDataType.Color,\r\n                \"u_TilingOffset\": ShaderDataType.Vector4,\r\n            },\r\n            \"u_AlbedoTexture\": ShaderDataType.Texture2D,\r\n            \"u_AlphaTestValue\": ShaderDataType.Float,\r\n        };\r\n\r\n        let defaultValue = {\r\n            \"u_AlbedoColor\": Color.WHITE,\r\n            \"u_TilingOffset\": new Vector4(1, 1, 0, 0),\r\n            \"u_AlphaTestValue\": 0.5\r\n        }\r\n\r\n        let shader = Shader3D.add(\"Unlit\", true, false);\r\n        shader.shaderType = ShaderFeatureType.D3;\r\n        let subShader = new SubShader(SubShader.DefaultAttributeMap, uniformMap, defaultValue);\r\n        shader.addSubShader(subShader);\r\n        let forwardPass = subShader.addShaderPass(UnlitVS, UnlitFS);\r\n        let shadowPass = subShader.addShaderPass(DepthVS, DepthFS, \"ShadowCaster\");\r\n    }\r\n}","\r\n#define SHADER_NAME UNLITFS\r\n\r\n#include \"Color.glsl\";\r\n\r\n#include \"Scene.glsl\";\r\n#include \"SceneFog.glsl\";\r\n\r\n#include \"Camera.glsl\";\r\n#include \"Sprite3DFrag.glsl\";\r\n\r\n#ifdef UV\r\nvarying vec2 v_Texcoord0;\r\n#endif // UV\r\n\r\n#ifdef COLOR\r\nvarying vec4 v_VertexColor;\r\n#endif // COLOR\r\n\r\nvoid main()\r\n{\r\n    vec3 color = u_AlbedoColor.rgb;\r\n    float alpha = u_AlbedoColor.a;\r\n\r\n#ifdef COLOR\r\n    #ifdef ENABLEVERTEXCOLOR\r\n    vec4 vertexColor = v_VertexColor;\r\n    color *= vertexColor.rgb;\r\n    alpha *= vertexColor.a;\r\n    #endif // ENABLEVERTEXCOLOR\r\n#endif // COLOR\r\n\r\n#ifdef UV\r\n    vec2 uv = v_Texcoord0;\r\n\r\n    #ifdef ALBEDOTEXTURE\r\n    vec4 albedoSampler = texture2D(u_AlbedoTexture, uv);\r\n\r\n\t#ifdef Gamma_u_AlbedoTexture\r\n    albedoSampler = gammaToLinear(albedoSampler);\r\n\t#endif // Gamma_u_AlbedoTexture\r\n\r\n    color *= albedoSampler.rgb;\r\n    alpha *= albedoSampler.a;\r\n    #endif // ALBEDOTEXTURE\r\n#endif // UV\r\n\r\n#ifdef ALPHATEST\r\n    if (alpha < u_AlphaTestValue)\r\n\tdiscard;\r\n#endif // ALPHATEST\r\n\r\n#ifdef FOG\r\n    color = scenUnlitFog(color);\r\n#endif // FOG\r\n\r\n    gl_FragColor = vec4(color, alpha);\r\n\r\n    gl_FragColor = outputTransform(gl_FragColor);\r\n}","import { Shader3D, ShaderFeatureType } from \"../../../RenderEngine/RenderShader/Shader3D\";\r\nimport { ShaderDataType } from \"../../../RenderEngine/RenderShader/ShaderData\";\r\nimport BlinnPhongCommonGLSL from \"./BlinnPhongCommon.glsl\";\r\nimport BlinnPhongVertexGLSL from \"./BlinnPhongVertex.glsl\";\r\nimport BlinnPhongFragGLSL from \"./BlinnPhongFrag.glsl\";\r\nimport BlinnPhongVS from \"./BlinnPhong.vs\";\r\nimport BlinnPhongFS from \"./BlinnPhong.fs\";\r\nimport DepthVS from \"../depth/Depth.vs\";\r\nimport DepthFS from \"../depth/Depth.fs\";\r\nimport DepthNormalVS from \"./BlinnPhongDepthNormal.vs\";\r\nimport DepthNormalFS from \"./BlinnPhongDepthNormal.fs\";\r\nimport { Color } from \"../../../maths/Color\";\r\nimport { Vector4 } from \"../../../maths/Vector4\";\r\nimport { SubShader } from \"../../../RenderEngine/RenderShader/SubShader\";\r\n\r\nexport class BlinnPhongShaderInit {\r\n\r\n    static init() {\r\n\r\n        Shader3D.addInclude(\"BlinnPhongCommon.glsl\", BlinnPhongCommonGLSL);\r\n        Shader3D.addInclude(\"BlinnPhongVertex.glsl\", BlinnPhongVertexGLSL);\r\n        Shader3D.addInclude(\"BlinnPhongFrag.glsl\", BlinnPhongFragGLSL);\r\n\r\n        let uniformMap = {\r\n            \"u_AlphaTestValue\": ShaderDataType.Float,\r\n            \"u_TilingOffset\": ShaderDataType.Vector4,\r\n\r\n            \"u_DiffuseColor\": ShaderDataType.Color,\r\n            \"u_DiffuseTexture\": ShaderDataType.Texture2D,\r\n            \"u_AlbedoIntensity\": ShaderDataType.Float,\r\n\r\n            \"u_MaterialSpecular\": ShaderDataType.Color,\r\n            \"u_SpecularTexture\": ShaderDataType.Texture2D,\r\n\r\n            \"u_Shininess\": ShaderDataType.Float,\r\n\r\n            \"u_NormalTexture\": ShaderDataType.Texture2D,\r\n        };\r\n\r\n        let defaultValue = {\r\n            \"u_AlbedoIntensity\": 1.0,\r\n            \"u_DiffuseColor\": Color.WHITE,\r\n            \"u_MaterialSpecular\": Color.WHITE,\r\n            \"u_Shininess\": 0.078125,\r\n            \"u_AlphaTestValue\": 0.5,\r\n            \"u_TilingOffset\": new Vector4(1, 1, 0, 0),\r\n        };\r\n\r\n        let shader = Shader3D.add(\"BLINNPHONG\", true, true);\r\n        shader.shaderType = ShaderFeatureType.D3;\r\n        let subShader = new SubShader(SubShader.DefaultAttributeMap, uniformMap, defaultValue);\r\n        shader.addSubShader(subShader);\r\n        let shadingPass = subShader.addShaderPass(BlinnPhongVS, BlinnPhongFS);\r\n        let shadowPass = subShader.addShaderPass(DepthVS, DepthFS, \"ShadowCaster\");\r\n        let depthNormal = subShader.addShaderPass(DepthNormalVS, DepthNormalFS, \"DepthNormal\");\r\n    }\r\n\r\n}","#if !defined(BlinnPhongCommon_lib)\r\n    #define BlinnPhongCommon_lib\r\n\r\n// varying\r\nvarying vec3 v_PositionWS;\r\n// todo\r\nvarying vec3 v_NormalWS;\r\nvarying vec3 v_TangentWS;\r\nvarying vec3 v_BiNormalWS;\r\n\r\n    #ifdef UV\r\nvarying vec2 v_Texcoord0;\r\n    #endif // UV\r\n\r\n    #ifdef UV1\r\n\t#ifdef LIGHTMAP\r\nvarying vec2 v_Texcoord1;\r\n\t#endif // LIGHTMAP\r\n    #endif // UV1\r\n\r\n    #ifdef COLOR\r\nvarying vec4 v_VertexColor;\r\n    #endif // COLOR\r\n\r\n// , vsfs\r\nstruct PixelParams {\r\n    vec3 positionWS;\r\n\r\n    vec3 normalWS;\r\n    vec3 tangentWS;\r\n    vec3 biNormalWS;\r\n    mat3 TBN;\r\n\r\n    #ifdef UV\r\n    vec2 uv0;\r\n    #endif // UV\r\n\r\n    #ifdef UV1\r\n\t#ifdef LIGHTMAP\r\n    vec2 uv1;\r\n\t#endif // LIGHTMAP\r\n    #endif // UV1\r\n\r\n    #ifdef COLOR\r\n    vec4 vertexColor;\r\n    #endif // COLOR\r\n};\r\n\r\n#endif // BlinnPhongCommon_lib","#if !defined(BlinnPhongVertex_lib)\r\n    #define BlinnPhongVertex_lib\r\n\r\n    #include \"ShadingVertex.glsl\";\r\n\r\nvoid initPixelParams(inout PixelParams params, in Vertex vertex)\r\n{\r\n    shadingPixelParams(params, vertex);\r\n    sharePixelParams(params);\r\n}\r\n\r\n#endif // BlinnPhongVertex_lib","#if !defined(BlinnPhongFrag_lib)\r\n    #define BlinnPhongFrag_lib\r\n\r\n    #include \"BlinnPhongLighting.glsl\";\r\n\r\n    #include \"ShadingFrag.glsl\";\r\n\r\nvoid getPixelInfo(inout PixelInfo info, const in PixelParams pixel, const in Surface surface)\r\n{\r\n    info.positionWS = pixel.positionWS;\r\n\r\n    info.vertexNormalWS = pixel.normalWS;\r\n\r\n    #ifdef TANGENT\r\n    info.normalWS = normalize(pixel.TBN * surface.normalTS);\r\n    #else // TANGENT\r\n    info.normalWS = pixel.normalWS;\r\n    #endif // TANGENT\r\n\r\n    info.viewDir = normalize(u_CameraPos - info.positionWS);\r\n\r\n    #ifdef LIGHTMAP\r\n\t#ifdef UV1\r\n    info.lightmapUV = pixel.uv1;\r\n\t#endif // UV1\r\n    #endif // LIGHTMAP\r\n}\r\n\r\nvec3 BlinnPhongLighting(const in Surface surface, const in PixelParams pixel)\r\n{\r\n    PixelInfo info;\r\n    getPixelInfo(info, pixel, surface);\r\n\r\n    vec3 positionWS = info.positionWS;\r\n    vec3 normalWS = info.normalWS;\r\n    vec3 v = info.viewDir;\r\n\r\n    vec3 lightColor = vec3(0.0, 0.0, 0.0);\r\n\r\n    #ifdef DIRECTIONLIGHT\r\n    for (int i = 0; i < CalculateLightCount; i++)\r\n\t{\r\n\t    if (i >= DirectionCount)\r\n\t\tbreak;\r\n\t    DirectionLight directionLight = getDirectionLight(i, positionWS);\r\n\t    if (directionLight.lightMode == LightMode_Mix)\r\n\t\t{\r\n\t\t    continue;\r\n\t\t}\r\n\t    Light light = getLight(directionLight);\r\n\t    lightColor += BlinnPhongLighting(surface, light, info) * light.attenuation;\r\n\t}\r\n    #endif // DIRECTIONLIGHT\r\n\r\n    #if defined(POINTLIGHT) || defined(SPOTLIGHT)\r\n    ivec4 clusterInfo = getClusterInfo(u_View, u_Viewport, positionWS, gl_FragCoord, u_ProjectionParams);\r\n    #endif // POINTLIGHT || SPOTLIGHT\r\n\r\n    #ifdef POINTLIGHT\r\n    for (int i = 0; i < CalculateLightCount; i++)\r\n\t{\r\n\t    if (i >= clusterInfo.x)\r\n\t\tbreak;\r\n\t    PointLight pointLight = getPointLight(i, clusterInfo, positionWS);\r\n\t    if (pointLight.lightMode == LightMode_Mix)\r\n\t\t{\r\n\t\t    continue;\r\n\t\t}\r\n\t    Light light = getLight(pointLight, normalWS, positionWS);\r\n\t    lightColor += BlinnPhongLighting(surface, light, info) * light.attenuation;\r\n\t}\r\n    #endif // POINTLIGHT\r\n\r\n    #ifdef SPOTLIGHT\r\n    for (int i = 0; i < CalculateLightCount; i++)\r\n\t{\r\n\t    if (i >= clusterInfo.y)\r\n\t\tbreak;\r\n\t    SpotLight spotLight = getSpotLight(i, clusterInfo, positionWS);\r\n\t    if (spotLight.lightMode == LightMode_Mix)\r\n\t\t{\r\n\t\t    continue;\r\n\t\t}\r\n\t    Light light = getLight(spotLight, normalWS, positionWS);\r\n\t    lightColor += BlinnPhongLighting(surface, light, info) * light.attenuation;\r\n\t}\r\n    #endif // SPOTLIGHT\r\n\r\n    vec3 giColor = BlinnPhongGI(surface, info);\r\n\r\n    return lightColor + giColor;\r\n}\r\n\r\n#endif // BlinnPhongFrag_lib","#define SHADER_NAME BlinnPhongVS\r\n\r\n#include \"Math.glsl\";\r\n\r\n#include \"Scene.glsl\";\r\n#include \"SceneFogInput.glsl\";\r\n\r\n#include \"Camera.glsl\";\r\n#include \"Sprite3DVertex.glsl\";\r\n\r\n#include \"VertexCommon.glsl\";\r\n\r\n#include \"BlinnPhongVertex.glsl\";\r\n\r\nvoid main()\r\n{\r\n    Vertex vertex;\r\n    getVertexParams(vertex);\r\n\r\n    PixelParams pixel;\r\n    initPixelParams(pixel, vertex);\r\n\r\n    gl_Position = getPositionCS(pixel.positionWS);\r\n\r\n    gl_Position = remapPositionZ(gl_Position);\r\n\r\n#ifdef FOG\r\n    FogHandle(gl_Position.z);\r\n#endif\r\n}\r\n","#define SHADER_NAME BlinnPhongFS\r\n\r\n#include \"Color.glsl\";\r\n\r\n#include \"Scene.glsl\";\r\n#include \"SceneFog.glsl\";\r\n\r\n#include \"Camera.glsl\";\r\n#include \"Sprite3DFrag.glsl\";\r\n\r\n#include \"BlinnPhongFrag.glsl\";\r\n\r\nvoid getBinnPhongSurfaceParams(inout Surface surface, in PixelParams pixel)\r\n{\r\n#ifdef UV\r\n    vec2 uv = transformUV(pixel.uv0, u_TilingOffset);\r\n#else // UV\r\n    vec2 uv = vec2(0.0);\r\n#endif // UV\r\n\r\n    surface.diffuseColor = u_DiffuseColor.rgb;\r\n    surface.alpha = u_DiffuseColor.a;\r\n\r\n#ifdef COLOR\r\n    #ifdef ENABLEVERTEXCOLOR\r\n    surface.diffuseColor *= pixel.vertexColor.xyz;\r\n    surface.alpha *= pixel.vertexColor.a;\r\n    #endif // ENABLEVERTEXCOLOR\r\n#endif // COLOR\r\n\r\n#ifdef DIFFUSEMAP\r\n    vec4 diffuseSampler = texture2D(u_DiffuseTexture, uv);\r\n    #ifdef Gamma_u_DiffuseTexture\r\n    diffuseSampler = gammaToLinear(diffuseSampler);\r\n    #endif // Gamma_u_DiffuseTexture\r\n    surface.diffuseColor *= u_DiffuseColor.rgb * diffuseSampler.rgb * u_AlbedoIntensity;\r\n    surface.alpha *= diffuseSampler.a;\r\n#endif // DIFFUSEMAP\r\n\r\n    surface.diffuseColor *= u_AlbedoIntensity;\r\n\r\n    surface.normalTS = vec3(0.0, 0.0, 1.0);\r\n#ifdef NORMALMAP\r\n    vec3 normalSampler = texture2D(u_NormalTexture, uv).rgb;\r\n    normalSampler = normalize(normalSampler * 2.0 - 1.0);\r\n    normalSampler.y *= -1.0;\r\n    surface.normalTS = normalSampler;\r\n#endif // NORMALMAP\r\n\r\n#ifdef SPECULARMAP\r\n    vec4 specularSampler = texture2D(u_SpecularTexture, uv);\r\n    #ifdef Gamma_u_SpecularTexture\r\n    specularSampler = gammaToLinear(specularSampler);\r\n    #endif // Gamma_u_SpecularTexture\r\n    surface.gloss = specularSampler.rgb;\r\n#else // SPECULARMAP\r\n    #ifdef DIFFUSEMAP\r\n    surface.gloss = vec3(diffuseSampler.a);\r\n    #else // DIFFUSEMAP\r\n    surface.gloss = vec3(1.0, 1.0, 1.0);\r\n    #endif // DIFFUSEMAP\r\n#endif // SPECULARMAP\r\n    surface.specularColor = u_MaterialSpecular.rgb;\r\n    surface.shininess = u_Shininess;\r\n}\r\n\r\nvoid main()\r\n{\r\n    PixelParams pixel;\r\n    getPixelParams(pixel);\r\n\r\n    Surface surface;\r\n    getBinnPhongSurfaceParams(surface, pixel);\r\n\r\n#ifdef ALPHATEST\r\n    if (surface.alpha < u_AlphaTestValue)\r\n\t{\r\n\t    discard;\r\n\t}\r\n#endif // ALPHATEST\r\n\r\n    vec3 surfaceColor = vec3(0.0);\r\n\r\n    surfaceColor = BlinnPhongLighting(surface, pixel);\r\n\r\n#ifdef FOG\r\n    surfaceColor = sceneLitFog(surfaceColor);\r\n#endif // FOG\r\n\r\n    gl_FragColor = vec4(surfaceColor, surface.alpha);\r\n\r\n    gl_FragColor = outputTransform(gl_FragColor);\r\n}\r\n","#define SHADER_NAME BlinnPhongDephtNormalVS\r\n\r\n#include \"Math.glsl\";\r\n\r\n#include \"Camera.glsl\";\r\n\r\n#include \"Sprite3DVertex.glsl\";\r\n\r\n#include \"VertexCommon.glsl\";\r\n\r\n#include \"BlinnPhongVertex.glsl\";\r\n\r\nvarying vec4 v_PositionCS;\r\n\r\nvoid main()\r\n{\r\n    Vertex vertex;\r\n    getVertexParams(vertex);\r\n\r\n    PixelParams pixel;\r\n    initPixelParams(pixel, vertex);\r\n\r\n    vec4 positionCS = getPositionCS(pixel.positionWS);\r\n    v_PositionCS = positionCS;\r\n    gl_Position = positionCS;\r\n    gl_Position = remapPositionZ(gl_Position);\r\n}","#define SHADER_NAME BlinnPhongDephtNormalFS\r\n\r\n#include \"Color.glsl\";\r\n\r\n#include \"Scene.glsl\";\r\n\r\n#include \"Camera.glsl\";\r\n#include \"Sprite3DFrag.glsl\";\r\n\r\n#include \"ShadingFrag.glsl\";\r\n\r\n#include \"DepthNormalFrag.glsl\";\r\n\r\nvarying vec4 v_PositionCS;\r\n\r\nvoid main()\r\n{\r\n    PixelParams pixel;\r\n    getPixelParams(pixel);\r\n\r\n    vec3 normalWS = pixel.normalWS;\r\n\r\n#ifdef NORMALMAP\r\n    #ifdef UV\r\n\r\n    vec2 uv = transformUV(pixel.uv0, u_TilingOffset);\r\n    vec3 normalSampler = texture2D(u_NormalTexture, uv).rgb;\r\n    normalSampler = normalize(normalSampler * 2.0 - 1.0);\r\n    normalSampler.y *= -1.0;\r\n    vec3 normalTS = normalSampler;\r\n    normalWS = normalize(pixel.TBN * normalTS);\r\n\r\n    #endif // UV\r\n#endif // NORMALMAP\r\n\r\n    vec4 positionCS = v_PositionCS;\r\n\r\n    vec4 dephtNormal = encodeDepthNormal(positionCS, normalWS);\r\n\r\n    gl_FragColor = dephtNormal;\r\n}","import { Shader3D, ShaderFeatureType } from \"../../../RenderEngine/RenderShader/Shader3D\"\r\nimport { ShaderDataType } from \"../../../RenderEngine/RenderShader/ShaderData\"\r\nimport { VertexTrail } from \"../../core/trail/VertexTrail\";\r\nimport TrailVS from \"./Trail.vs\";\r\nimport TrailFS from \"./Trail.fs\";\r\nimport { Color } from \"../../../maths/Color\";\r\nimport { Vector4 } from \"../../../maths/Vector4\";\r\nimport { SubShader } from \"../../../RenderEngine/RenderShader/SubShader\";\r\nexport class TrailShaderInit {\r\n    static init() {\r\n        let attributeMap: { [name: string]: [number, ShaderDataType] } = {\r\n            'a_Position': [VertexTrail.TRAIL_POSITION0, ShaderDataType.Vector4],\r\n            'a_OffsetVector': [VertexTrail.TRAIL_OFFSETVECTOR, ShaderDataType.Vector3],\r\n            'a_Texcoord0X': [VertexTrail.TRAIL_TEXTURECOORDINATE0X, ShaderDataType.Float],\r\n            'a_Texcoord0Y': [VertexTrail.TRAIL_TEXTURECOORDINATE0Y, ShaderDataType.Float],\r\n            'a_BirthTime': [VertexTrail.TRAIL_TIME0, ShaderDataType.Float],\r\n            'a_Color': [VertexTrail.TRAIL_COLOR, ShaderDataType.Vector4],\r\n        };\r\n\r\n        let uniformMap = {\r\n            \"u_TilingOffset\": ShaderDataType.Vector4,\r\n            \"u_MainTexture\": ShaderDataType.Texture2D,\r\n            \"u_MainColor\": ShaderDataType.Color,\r\n        };\r\n\r\n        let defaultValue = {\r\n            \"u_MainColor\": Color.WHITE,\r\n            \"u_TilingOffset\": new Vector4(1, 1, 0, 0),\r\n        };\r\n\r\n        let shader = Shader3D.add(\"Trail\", false, false);\r\n        shader.shaderType = ShaderFeatureType.Effect;\r\n        let subShader = new SubShader(attributeMap, uniformMap, defaultValue);\r\n        shader.addSubShader(subShader);\r\n        let forwardPass = subShader.addShaderPass(TrailVS, TrailFS);\r\n    }\r\n}","#define SHADER_NAME TrailVS\r\n\r\n#include \"Camera.glsl\";\r\n#include \"Scene.glsl\"\r\n#include \"SceneFogInput.glsl\"\r\n\r\n// Sprite uniform\r\nuniform float u_CurTime;\r\nuniform float u_LifeTime;\r\nuniform vec4 u_WidthCurve[10];\r\nuniform int u_WidthCurveKeyLength;\r\n\r\nvarying vec2 v_Texcoord0;\r\nvarying vec4 v_Color;\r\n\r\nfloat hermiteInterpolate(float t, float outTangent, float inTangent, float duration, float value1, float value2)\r\n{\r\n    float t2 = t * t;\r\n    float t3 = t2 * t;\r\n    float a = 2.0 * t3 - 3.0 * t2 + 1.0;\r\n    float b = t3 - 2.0 * t2 + t;\r\n    float c = t3 - t2;\r\n    float d = -2.0 * t3 + 3.0 * t2;\r\n    return a * value1 + b * outTangent * duration + c * inTangent * duration + d * value2;\r\n}\r\n\r\nfloat getCurWidth(in float normalizeTime)\r\n{\r\n    float width;\r\n    if (normalizeTime == 0.0)\r\n\t{\r\n\t    width = u_WidthCurve[0].w;\r\n\t}\r\n    else if (normalizeTime >= 1.0)\r\n\t{\r\n\t    width = u_WidthCurve[u_WidthCurveKeyLength - 1].w;\r\n\t}\r\n    else\r\n\t{\r\n\t    for (int i = 0; i < 10; i++)\r\n\t\t{\r\n\t\t    if (normalizeTime == u_WidthCurve[i].x)\r\n\t\t\t{\r\n\t\t\t    width = u_WidthCurve[i].w;\r\n\t\t\t    break;\r\n\t\t\t}\r\n\r\n\t\t    vec4 lastFrame = u_WidthCurve[i];\r\n\t\t    vec4 nextFrame = u_WidthCurve[i + 1];\r\n\t\t    if (normalizeTime > lastFrame.x && normalizeTime < nextFrame.x)\r\n\t\t\t{\r\n\t\t\t    float duration = nextFrame.x - lastFrame.x;\r\n\t\t\t    float t = (normalizeTime - lastFrame.x) / duration;\r\n\t\t\t    float outTangent = lastFrame.z;\r\n\t\t\t    float inTangent = nextFrame.y;\r\n\t\t\t    float value1 = lastFrame.w;\r\n\t\t\t    float value2 = nextFrame.w;\r\n\t\t\t    width = hermiteInterpolate(t, outTangent, inTangent, duration, value1, value2);\r\n\t\t\t    break;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n    return width;\r\n}\r\n\r\nvoid main()\r\n{\r\n    float normalizeTime = (u_CurTime - a_BirthTime) / u_LifeTime;\r\n\r\n    v_Texcoord0 = vec2(a_Texcoord0X, 1.0 - a_Texcoord0Y) * u_TilingOffset.xy + u_TilingOffset.zw;\r\n\r\n    v_Color = a_Color;\r\n\r\n    vec3 cameraPos = (u_View * a_Position).rgb;\r\n    gl_Position = u_Projection * vec4(cameraPos + a_OffsetVector * getCurWidth(normalizeTime), 1.0);\r\n\r\n    gl_Position = remapPositionZ(gl_Position);\r\n\t#ifdef FOG\r\n        FogHandle(gl_Position.z);\r\n    #endif\r\n}","#define SHADER_NAME TrailFS\r\n\r\n#include \"Color.glsl\";\r\n#include \"Scene.glsl\";\r\n#include \"SceneFog.glsl\";\r\n\r\nvarying vec2 v_Texcoord0;\r\nvarying vec4 v_Color;\r\n\r\nvoid main()\r\n{\r\n    vec4 color = 2.0 * u_MainColor * v_Color;\r\n#ifdef MAINTEXTURE\r\n    vec4 mainTextureColor = texture2D(u_MainTexture, v_Texcoord0);\r\n    #ifdef Gamma_u_MainTexture\r\n    mainTextureColor = gammaToLinear(mainTextureColor);\r\n    #endif // Gamma_u_MainTexture\r\n\r\n    color *= mainTextureColor;\r\n#endif\r\n\r\n#ifdef FOG\r\n    color.xyz = scenUnlitFog(color.xyz);\r\n#endif // FOG\r\n    gl_FragColor = color;\r\n\r\n    gl_FragColor = outputTransform(gl_FragColor);\r\n}\r\n","import { Shader3D, ShaderFeatureType } from \"../../../RenderEngine/RenderShader/Shader3D\";\r\nimport { ShaderDataType } from \"../../../RenderEngine/RenderShader/ShaderData\";\r\n\r\nimport PBRStandardVS from \"./pbrStandard.vs\";\r\nimport PBRStandardFS from \"./pbrStandard.fs\";\r\n\r\nimport PBRDepthVS from \"../depth/Depth.vs\";\r\nimport PBRDepthFS from \"../depth/Depth.fs\";\r\n\r\nimport DepthNormalVS from \"./PBRStandardDepthNormal.vs\";\r\nimport DepthNormalFS from \"./PBRStandardDepthNormal.fs\";\r\n\r\nimport { Color } from \"../../../maths/Color\";\r\nimport { Vector4 } from \"../../../maths/Vector4\";\r\nimport { SubShader } from \"../../../RenderEngine/RenderShader/SubShader\";\r\n\r\n\r\nexport class PBRStandardShaderInit {\r\n\r\n    static init() {\r\n\r\n        let uniformMap = {\r\n            \"u_AlbedoColor\": ShaderDataType.Color,\r\n            \"u_TilingOffset\": ShaderDataType.Vector4,\r\n            \"u_NormalScale\": ShaderDataType.Float,\r\n            \"u_Metallic\": ShaderDataType.Float,\r\n            \"u_Smoothness\": ShaderDataType.Float,\r\n            \"u_OcclusionStrength\": ShaderDataType.Float,\r\n            \"u_AlphaTestValue\": ShaderDataType.Float,\r\n            \"u_EmissionColor\": ShaderDataType.Color,\r\n            \"u_EmissionIntensity\": ShaderDataType.Float,\r\n            \"u_AlbedoTexture\": ShaderDataType.Texture2D,\r\n            \"u_NormalTexture\": ShaderDataType.Texture2D,\r\n            \"u_OcclusionTexture\": ShaderDataType.Texture2D,\r\n            \"u_EmissionTexture\": ShaderDataType.Texture2D,\r\n            \"u_MetallicGlossTexture\": ShaderDataType.Texture2D,\r\n            // anisotrioy\r\n            \"u_AnisotropyStrength\": ShaderDataType.Float,\r\n            \"u_AnisotropyTexture\": ShaderDataType.Texture2D,\r\n            \"u_AnisotropyRotation\": ShaderDataType.Float,\r\n            // clear coat\r\n            \"u_ClearCoatFactor\": ShaderDataType.Float,\r\n            \"u_ClearCoatTexture\": ShaderDataType.Texture2D,\r\n            \"u_ClearCoatRoughness\": ShaderDataType.Float,\r\n            \"u_ClearCoatRoughnessTexture\": ShaderDataType.Texture2D,\r\n            \"u_ClearCoatNormalTexture\": ShaderDataType.Texture2D,\r\n            //detail \r\n            \"u_DetailAlbedoTexture\": ShaderDataType.Texture2D,\r\n            \"u_DetailNormalTexture\": ShaderDataType.Texture2D,\r\n            \"u_DetailNormalScale\": ShaderDataType.Float,\r\n            \"u_DetailTillingOffset\": ShaderDataType.Vector4\r\n        };\r\n\r\n        let defaultValue = {\r\n            \"u_AlbedoColor\": Color.WHITE,\r\n            \"u_TilingOffset\": new Vector4(1, 1, 0, 0),\r\n            \"u_DetailTillingOffset\": new Vector4(1, 1, 0, 0),\r\n            \"u_NormalScale\": 1,\r\n            \"u_DetailNormalScale\": 1,\r\n            \"u_Metallic\": 0,\r\n            \"u_Smoothness\": 0.5,\r\n            \"u_OcclusionStrength\": 1,\r\n            \"u_EmissionColor\": Color.WHITE,\r\n            \"u_EmissionIntensity\": 1,\r\n            \"u_AlphaTestValue\": 0.5,\r\n            // anisotrioy\r\n            \"u_AnisotropyStrength\": 0,\r\n            \"u_AnisotropyRotation\": 0,\r\n            // clear coat\r\n            \"u_ClearCoatFactor\": 0,\r\n            \"u_ClearCoatRoughness\": 0,\r\n        };\r\n\r\n        let shader = Shader3D.add(\"PBR\", true, true);\r\n        shader.shaderType = ShaderFeatureType.D3;\r\n        shader._surportVolumetricGI = true;\r\n        let subShader = new SubShader(SubShader.DefaultAttributeMap, uniformMap, defaultValue);\r\n        shader.addSubShader(subShader);\r\n        let shadingPass = subShader.addShaderPass(PBRStandardVS, PBRStandardFS);\r\n        let shadowPass = subShader.addShaderPass(PBRDepthVS, PBRDepthFS, \"ShadowCaster\");\r\n        let depthNormal = subShader.addShaderPass(DepthNormalVS, DepthNormalFS, \"DepthNormal\");\r\n    }\r\n\r\n}","#define SHADER_NAME PBRStandardVS\r\n\r\n#include \"Math.glsl\";\r\n\r\n#include \"Scene.glsl\";\r\n#include \"SceneFogInput.glsl\";\r\n\r\n#include \"Camera.glsl\";\r\n#include \"Sprite3DVertex.glsl\";\r\n\r\n#include \"VertexCommon.glsl\";\r\n\r\n#include \"PBRVertex.glsl\";\r\n\r\n#if defined(DETAILTEXTURE) || defined(DETAILNORMAL)\r\nvarying vec2 v_DetailUV;\r\n#endif\r\n\r\nvoid main()\r\n{\r\n    Vertex vertex;\r\n    getVertexParams(vertex);\r\n\r\n    PixelParams pixel;\r\n    initPixelParams(pixel, vertex);\r\n\r\n#if defined(DETAILTEXTURE) || defined(DETAILNORMAL)\r\n    #ifdef UV\r\n    v_DetailUV = transformUV(vertex.texCoord0, u_DetailTillingOffset);\r\n    #else // UV\r\n    v_DetailUV = vec2(0.0);\r\n    #endif\r\n#endif\r\n\r\n    gl_Position = getPositionCS(pixel.positionWS);\r\n\r\n    gl_Position = remapPositionZ(gl_Position);\r\n\r\n#ifdef FOG\r\n    FogHandle(gl_Position.z);\r\n#endif\r\n}","#define SHADER_NAME PBRStandardFS\r\n\r\n#include \"Color.glsl\";\r\n\r\n#include \"Scene.glsl\";\r\n#include \"SceneFog.glsl\";\r\n\r\n#include \"Camera.glsl\";\r\n#include \"Sprite3DFrag.glsl\";\r\n\r\n#include \"PBRMetallicFrag.glsl\";\r\n\r\n#if defined(DETAILTEXTURE) || defined(DETAILNORMAL)\r\nvarying vec2 v_DetailUV;\r\n    #define ColorSpaceDouble vec3(4.59479380, 4.59479380, 4.59479380);\r\nvec3 BlendNormals(vec3 n1, vec3 n2)\r\n{\r\n    return normalize(vec3(n1.xy + n2.xy, n1.z * n2.z));\r\n}\r\n#endif // DETAILTEXTURE || DETAILNORMAL\r\n\r\nvoid initSurfaceInputs(inout SurfaceInputs inputs, const in PixelParams pixel)\r\n{\r\n#ifdef UV\r\n    vec2 uv = transformUV(pixel.uv0, u_TilingOffset);\r\n#else // UV\r\n    vec2 uv = vec2(0.0);\r\n#endif // UV\r\n\r\n    inputs.diffuseColor = u_AlbedoColor.rgb;\r\n    inputs.alpha = u_AlbedoColor.a;\r\n\r\n#ifdef COLOR\r\n    #ifdef ENABLEVERTEXCOLOR\r\n    inputs.diffuseColor *= pixel.vertexColor.xyz;\r\n    inputs.alpha *= pixel.vertexColor.a;\r\n    #endif // ENABLEVERTEXCOLOR\r\n#endif // COLOR\r\n\r\n    inputs.alphaTest = u_AlphaTestValue;\r\n\r\n#ifdef ALBEDOTEXTURE\r\n    vec4 albedoSampler = texture2D(u_AlbedoTexture, uv);\r\n    #ifdef Gamma_u_AlbedoTexture\r\n    albedoSampler = gammaToLinear(albedoSampler);\r\n    #endif // Gamma_u_AlbedoTexture\r\n    inputs.diffuseColor *= albedoSampler.rgb;\r\n    inputs.alpha *= albedoSampler.a;\r\n#endif // ALBEDOTEXTURE\r\n\r\n// Detail Albedo\r\n#ifdef DETAILTEXTURE\r\n    vec3 detailSampler = texture2D(u_DetailAlbedoTexture, v_DetailUV).rgb;\r\n    #ifdef Gamma_u_DetailAlbedoTexture\r\n    detailSampler = gammaToLinear(detailSampler);\r\n    #endif // Gamma_u_DetailAlbedoTexture\r\n    detailSampler *= ColorSpaceDouble;\r\n    inputs.diffuseColor *= detailSampler;\r\n#endif\r\n\r\n    inputs.normalTS = vec3(0.0, 0.0, 1.0);\r\n#ifdef NORMALTEXTURE\r\n    vec3 normalSampler = texture2D(u_NormalTexture, uv).rgb;\r\n    normalSampler = normalize(normalSampler * 2.0 - 1.0);\r\n    normalSampler.y *= -1.0;\r\n    inputs.normalTS = normalScale(normalSampler, u_NormalScale);\r\n#endif\r\n\r\n#ifdef DETAILNORMAL\r\n    vec3 detailnormalSampler = texture2D(u_DetailNormalTexture, v_DetailUV).rgb;\r\n    detailnormalSampler = normalize(detailnormalSampler * 2.0 - 1.0);\r\n    detailnormalSampler.y *= -1.0;\r\n    detailnormalSampler = normalScale(detailnormalSampler, u_DetailNormalScale);\r\n    inputs.normalTS = BlendNormals(inputs.normalTS, detailnormalSampler);\r\n#endif\r\n\r\n    inputs.metallic = u_Metallic;\r\n    inputs.smoothness = u_Smoothness;\r\n\r\n#ifdef METALLICGLOSSTEXTURE\r\n\r\n    vec4 metallicSampler = texture2D(u_MetallicGlossTexture, uv);\r\n    #ifdef Gamma_u_MetallicGlossTexture\r\n    metallicSampler = gammaToLinear(metallicSampler);\r\n    #endif // Gamma_u_MetallicGlossTexture\r\n\r\n    inputs.metallic = metallicSampler.x;\r\n\r\n    #ifdef SMOOTHNESSSOURCE_ALBEDOTEXTURE_ALPHA\r\n\t#ifdef ALBEDOTEXTURE\r\n    inputs.smoothness = (albedoSampler.a * u_Smoothness);\r\n\t#endif // ALBEDOTEXTURE\r\n    #else // SMOOTHNESSSOURCE_METALLICTEXTURE_ALPHA\r\n    inputs.smoothness = (metallicSampler.a * u_Smoothness);\r\n    #endif // SMOOTHNESSSOURCE_ALBEDOTEXTURE_ALPHA\r\n\r\n#endif // METALLICGLOSSTEXTURE\r\n\r\n    inputs.occlusion = 1.0;\r\n#ifdef OCCLUSIONTEXTURE\r\n    vec4 occlusionSampler = texture2D(u_OcclusionTexture, uv);\r\n    #ifdef Gamma_u_OcclusionTexture\r\n    occlusionSampler = gammaToLinear(occlusionSampler);\r\n    #endif // Gamma_u_OcclusionTexture\r\n\r\n    float occlusion = occlusionSampler.g;\r\n    inputs.occlusion = (1.0 - u_OcclusionStrength) + occlusion * u_OcclusionStrength;\r\n#endif // OCCLUSIONTEXTURE\r\n\r\n    inputs.emissionColor = vec3(0.0);\r\n#ifdef EMISSION\r\n    inputs.emissionColor = u_EmissionColor.rgb * u_EmissionIntensity;\r\n    #ifdef EMISSIONTEXTURE\r\n    vec4 emissionSampler = texture2D(u_EmissionTexture, uv);\r\n\t#ifdef Gamma_u_EmissionTexture\r\n    emissionSampler = gammaToLinear(emissionSampler);\r\n\t#endif // Gamma_u_EmissionTexture\r\n    inputs.emissionColor *= emissionSampler.rgb;\r\n    #endif // EMISSIONTEXTURE\r\n#endif // EMISSION\r\n\r\n#ifdef CLEARCOAT\r\n    inputs.clearCoat = u_ClearCoatFactor;\r\n    inputs.clearCoatRoughness = u_ClearCoatRoughness;\r\n\r\n    #ifdef CLEARCOATMAP\r\n    // todo\r\n    // linear tex no need gamma\r\n    vec4 clearCoatSampler = texture2D(u_ClearCoatTexture, uv);\r\n    inputs.clearCoat *= clearCoatSampler.r;\r\n    #endif // CLEARCOATMAP\r\n\r\n    #ifdef CLEARCOAT_ROUGHNESSMAP\r\n    // todo\r\n    // linear tex no need gamma\r\n    vec4 clearcoatSampleRoughness = texture2D(u_ClearCoatRoughnessTexture, uv);\r\n    inputs.clearCoatRoughness *= clearcoatSampleRoughness.g;\r\n    #endif // CLEARCOAT_ROUGHNESSMAP\r\n\r\n    #ifdef CLEARCOAT_NORMAL\r\n    vec3 clearCoatNormalSampler = texture2D(u_ClearCoatNormalTexture, uv).rgb;\r\n    clearCoatNormalSampler = normalize(clearCoatNormalSampler * 2.0 - 1.0);\r\n    clearCoatNormalSampler.y *= -1.0;\r\n    inputs.clearCoatNormalTS = clearCoatNormalSampler;\r\n    #endif // CLEARCOAT_NORMAL\r\n#endif // CLEARCOAT\r\n\r\n#ifdef ANISOTROPIC\r\n    inputs.anisotropy = u_AnisotropyStrength;\r\n    vec2 direction = vec2(1.0, 0.0);\r\n\r\n    #ifdef ANISOTROPYMAP\r\n    vec3 anisotropySampler = texture2D(u_AnisotropyTexture, uv).rgb;\r\n\r\n    inputs.anisotropy *= anisotropySampler.b;\r\n    direction = anisotropySampler.xy * 2.0 - 1.0;\r\n    #endif // ANISOTROPYMAP\r\n\r\n    vec2 anisotropyRotation = vec2(cos(u_AnisotropyRotation), sin(u_AnisotropyRotation));\r\n    mat2 rotationMatrix = mat2(anisotropyRotation.x, anisotropyRotation.y, -anisotropyRotation.y, anisotropyRotation.x);\r\n    inputs.anisotropyDirection = rotationMatrix * direction;\r\n\r\n#endif // ANISOTROPIC\r\n}\r\n\r\nvoid main()\r\n{\r\n    PixelParams pixel;\r\n    getPixelParams(pixel);\r\n\r\n    SurfaceInputs inputs;\r\n    initSurfaceInputs(inputs, pixel);\r\n\r\n    vec4 surfaceColor = PBR_Metallic_Flow(inputs, pixel);\r\n\r\n#ifdef FOG\r\n    surfaceColor.rgb = sceneLitFog(surfaceColor.rgb);\r\n#endif // FOG\r\n\r\n    gl_FragColor = surfaceColor;\r\n\r\n    gl_FragColor = outputTransform(gl_FragColor);\r\n}","#define SHADER_NAME PBRStandardDepthNormalVS\r\n\r\n#include \"Math.glsl\";\r\n\r\n#include \"Camera.glsl\";\r\n\r\n#include \"Sprite3DVertex.glsl\";\r\n\r\n#include \"VertexCommon.glsl\";\r\n\r\n#include \"PBRVertex.glsl\";\r\n\r\nvarying vec4 v_PositionCS;\r\n\r\nvoid main()\r\n{\r\n    Vertex vertex;\r\n    getVertexParams(vertex);\r\n\r\n    PixelParams pixel;\r\n    initPixelParams(pixel, vertex);\r\n\r\n    sharePixelParams(pixel);\r\n\r\n    vec4 positionCS = getPositionCS(pixel.positionWS);\r\n    v_PositionCS = positionCS;\r\n    gl_Position = positionCS;\r\n    gl_Position = remapPositionZ(gl_Position);\r\n}","#define SHADER_NAME PBRStandardDepthNormalFS\r\n\r\n#include \"Color.glsl\";\r\n\r\n#include \"Scene.glsl\";\r\n\r\n#include \"Camera.glsl\";\r\n#include \"Sprite3DFrag.glsl\";\r\n\r\n#include \"ShadingFrag.glsl\";\r\n\r\n#include \"DepthNormalFrag.glsl\";\r\n\r\nvarying vec4 v_PositionCS;\r\n\r\nvoid main()\r\n{\r\n    PixelParams pixel;\r\n    getPixelParams(pixel);\r\n\r\n    vec3 normalWS = pixel.normalWS;\r\n\r\n#ifdef NORMALTEXTURE\r\n    #ifdef UV\r\n\r\n    vec2 uv = transformUV(pixel.uv0, u_TilingOffset);\r\n    vec3 normalSampler = texture2D(u_NormalTexture, uv).rgb;\r\n    normalSampler = normalize(normalSampler * 2.0 - 1.0);\r\n    normalSampler.y *= -1.0;\r\n    vec3 normalTS = normalScale(normalSampler, u_NormalScale);\r\n    normalWS = normalize(pixel.TBN * normalTS);\r\n\r\n    #endif // UV\r\n#endif // NORMALTEXTURE\r\n\r\n    vec4 positionCS = v_PositionCS;\r\n\r\n    vec4 dephtNormal = encodeDepthNormal(positionCS, normalWS);\r\n\r\n    gl_FragColor = dephtNormal;\r\n}","import { Shader3D, ShaderFeatureType } from \"../../../RenderEngine/RenderShader/Shader3D\";\r\nimport { ShaderDataType } from \"../../../RenderEngine/RenderShader/ShaderData\";\r\nimport SkyboxVS from \"./SkyBox.vs\";\r\nimport SkyboxFS from \"./SkyBox.fs\";\r\nimport { Color } from \"../../../maths/Color\";\r\nimport { AttributeMapType, SubShader } from \"../../../RenderEngine/RenderShader/SubShader\";\r\nimport { RenderState } from \"../../../RenderEngine/RenderShader/RenderState\";\r\nimport { VertexMesh } from \"../../../RenderEngine/RenderShader/VertexMesh\";\r\nimport { CullMode } from \"../../../RenderEngine/RenderEnum/CullMode\";\r\n\r\nexport class SkyBoxShaderInit {\r\n\r\n    static init() {\r\n\r\n        let attributeMap: AttributeMapType = {\r\n            \"a_Position\": [VertexMesh.MESH_POSITION0, ShaderDataType.Vector4]\r\n        };\r\n\r\n        let uniformMap = {\r\n            \"u_TintColor\": ShaderDataType.Color,\r\n            \"u_Exposure\": ShaderDataType.Float,\r\n            \"u_Rotation\": ShaderDataType.Float,\r\n            \"u_CubeTexture\": ShaderDataType.TextureCube\r\n        };\r\n\r\n        let defaultValue = {\r\n            \"u_TintColor\": new Color(0.5, 0.5, 0.5, 0.5),\r\n            \"u_Exposure\": 1,\r\n            \"u_Rotation\": 0\r\n        };\r\n\r\n        let shader = Shader3D.add(\"SkyBox\");\r\n        shader.shaderType = ShaderFeatureType.Sky;\r\n        let subShader = new SubShader(attributeMap, uniformMap, defaultValue);\r\n        shader.addSubShader(subShader);\r\n        let pass = subShader.addShaderPass(SkyboxVS, SkyboxFS);\r\n        pass.renderState.depthTest = RenderState.DEPTHTEST_LEQUAL;\r\n        pass.renderState.cull = CullMode.Back;\r\n        pass.renderState.depthWrite = false;\r\n        pass.renderState.stencilWrite = false;\r\n        pass.statefirst = true;\r\n\r\n\r\n    }\r\n\r\n}","#define SHADER_NAME SkyBoxVS\r\n\r\n#include \"Camera.glsl\";\r\n\r\nconst float c_deg2ang = 3.141593 / 180.0;\r\n\r\nvec4 rotateAroundYInDegrees(vec4 vertex, float deg)\r\n{\r\n    float angle = deg * c_deg2ang;\r\n    float sina = sin(angle);\r\n    float cosa = cos(angle);\r\n    mat2 m = mat2(cosa, -sina, sina, cosa);\r\n    return vec4(m * vertex.xz, vertex.yw).xzyw;\r\n}\r\n\r\nvec4 remapSkyPositionZ(in vec4 position)\r\n{\r\n    position.z = position.w;\r\n    return position;\r\n}\r\n\r\nvarying vec3 v_Texcoord;\r\n\r\nvoid main()\r\n{\r\n    // todo  \r\n    v_Texcoord = vec3(-a_Position.x, a_Position.yz); //\r\n\r\n    vec4 position = rotateAroundYInDegrees(a_Position, u_Rotation);\r\n    // gl_Position = getPositionCS(position.xyz);\r\n\r\n    gl_Position = u_ViewProjection * position;\r\n\r\n    gl_Position = remapSkyPositionZ(gl_Position);\r\n}","#define SHADER_NAME SkyBoxFS\r\n\r\n#include \"Color.glsl\";\r\n\r\nvarying vec3 v_Texcoord;\r\n\r\nconst vec4 c_ColorSpace = vec4(4.59479380, 4.59479380, 4.59479380, 2.0);\r\n\r\nvoid main()\r\n{\r\n    vec3 uv = v_Texcoord;\r\n    vec4 cubeSampler = textureCube(u_CubeTexture, uv);\r\n#ifdef Gamma_u_CubeTexture\r\n    cubeSampler = gammaToLinear(cubeSampler);\r\n#endif // Gamma_u_CubeTexture\r\n\r\n    vec3 color = cubeSampler.rgb * u_TintColor.rgb * pow(u_Exposure, 2.2) * c_ColorSpace.rgb;\r\n\r\n    gl_FragColor = vec4(color, 1.0);\r\n\r\n    gl_FragColor = outputTransform(gl_FragColor);\r\n}","import { Shader3D, ShaderFeatureType } from \"../../../RenderEngine/RenderShader/Shader3D\";\r\nimport { ShaderDataType } from \"../../../RenderEngine/RenderShader/ShaderData\";\r\nimport { VertexShuriKenParticle } from \"../../graphics/Vertex/VertexShuriKenParticle\";\r\nimport ShurikenVS from \"./particleShuriKen.vs\";\r\nimport ShurikenFS from \"./particleShuriKen.fs\";\r\nimport MathGradient from \"./MathGradient.glsl\";\r\nimport ParticleSpriteVS from \"./particleShuriKenSpriteVS.glsl\";\r\nimport { Color } from \"../../../maths/Color\";\r\nimport { Vector4 } from \"../../../maths/Vector4\";\r\nimport { SubShader } from \"../../../RenderEngine/RenderShader/SubShader\";\r\n/**\r\n * ParticleShuriKen Shader init\r\n */\r\nexport class ParticleShuriKenShaderInit{\r\n    static init(){\r\n        \r\n        Shader3D.addInclude(\"MathGradient.glsl\", MathGradient);\r\n        Shader3D.addInclude(\"particleShuriKenSpriteVS.glsl\", ParticleSpriteVS);\r\n\r\n        let attributeMap: { [name: string]: [number, ShaderDataType] } = {\r\n            'a_CornerTextureCoordinate': [VertexShuriKenParticle.PARTICLE_CORNERTEXTURECOORDINATE0, ShaderDataType.Vector4],\r\n\t\t \t'a_MeshPosition': [VertexShuriKenParticle.PARTICLE_POSITION0,ShaderDataType.Vector3],\r\n            'a_MeshColor':[VertexShuriKenParticle.PARTICLE_COLOR0,ShaderDataType.Vector4],\r\n\t\t \t'a_MeshTextureCoordinate': [VertexShuriKenParticle.PARTICLE_TEXTURECOORDINATE0,ShaderDataType.Vector2],\r\n\t\t \t'a_ShapePositionStartLifeTime': [VertexShuriKenParticle.PARTICLE_SHAPEPOSITIONSTARTLIFETIME,ShaderDataType.Vector4],\r\n\t\t    'a_DirectionTime': [VertexShuriKenParticle.PARTICLE_DIRECTIONTIME,ShaderDataType.Vector4],\r\n\t\t \t'a_StartColor': [VertexShuriKenParticle.PARTICLE_STARTCOLOR0,ShaderDataType.Vector4],\r\n\t\t \t'a_StartSize': [VertexShuriKenParticle.PARTICLE_STARTSIZE,ShaderDataType.Vector3],\r\n\t\t \t'a_StartRotation0': [VertexShuriKenParticle.PARTICLE_STARTROTATION,ShaderDataType.Vector3],\r\n\t\t \t'a_StartSpeed': [VertexShuriKenParticle.PARTICLE_STARTSPEED,ShaderDataType.Float],\r\n\t\t \t'a_Random0': [VertexShuriKenParticle.PARTICLE_RANDOM0,ShaderDataType.Vector4],\r\n\t\t \t'a_Random1': [VertexShuriKenParticle.PARTICLE_RANDOM1,ShaderDataType.Vector4],\r\n\t\t \t'a_SimulationWorldPostion': [VertexShuriKenParticle.PARTICLE_SIMULATIONWORLDPOSTION,ShaderDataType.Vector3],\r\n\t\t \t'a_SimulationWorldRotation': [VertexShuriKenParticle.PARTICLE_SIMULATIONWORLDROTATION,ShaderDataType.Vector4],\r\n\t\t \t'a_SimulationUV': [VertexShuriKenParticle.PARTICLE_SIMULATIONUV,ShaderDataType.Vector4]\r\n        };\r\n\r\n        let uniformMap = {\r\n            \"u_Tintcolor\": ShaderDataType.Color,\r\n            \"u_texture\": ShaderDataType.Texture2D,\r\n            \"u_TilingOffset\": ShaderDataType.Vector4,\r\n            \"u_AlphaTestValue\": ShaderDataType.Float,\r\n        };\r\n\r\n        let defaultValue = {\r\n            \"u_Tintcolor\": new Color(0.5, 0.5, 0.5, 0.5),\r\n            \"u_TilingOffset\": new Vector4(1, 1, 0, 0),\r\n            \"u_AlphaTestValue\": 0.5\r\n        };\r\n\r\n        let shader = Shader3D.add(\"PARTICLESHURIKEN\", false, false);\r\n        let subShader = new SubShader(attributeMap, uniformMap, defaultValue);\r\n        shader.addSubShader(subShader);\r\n        shader.shaderType = ShaderFeatureType.Effect;\r\n        let forwardPass = subShader.addShaderPass(ShurikenVS, ShurikenFS);\r\n\r\n    }\r\n}","float getCurValueFromGradientFloat(in vec2 gradientNumbers[4], in float normalizedAge)\r\n{\r\n    float curValue;\r\n    for (int i = 1; i < 4; i++)\r\n\t{\r\n\t    vec2 gradientNumber = gradientNumbers[i];\r\n\t    float key = gradientNumber.x;\r\n\t\tcurValue = gradientNumber.y;\r\n\t    if (key >= normalizedAge)\r\n\t\t{\r\n\t\t    vec2 lastGradientNumber = gradientNumbers[i - 1];\r\n\t\t    float lastKey = lastGradientNumber.x;\r\n\t\t    float age = max((normalizedAge - lastKey), 0.0) / (key - lastKey);\r\n\t\t    curValue = mix(lastGradientNumber.y, gradientNumber.y, age);\r\n\t\t    break;\r\n\t\t}\r\n\t}\r\n    return curValue;\r\n}\r\n\r\nfloat getTotalValueFromGradientFloat(in vec2 gradientNumbers[4],\r\n    in float normalizedAge)\r\n{\r\n\tfloat keyTime = min(normalizedAge, gradientNumbers[0].x);\r\n    float totalValue = keyTime * gradientNumbers[0].y;\r\n\tfloat lastSpeed = 0.;\r\n    for (int i = 1; i < 4; i++)\r\n\t{\r\n\t    vec2 gradientNumber = gradientNumbers[i];\r\n\t    float key = gradientNumber.x;\r\n\t    vec2 lastGradientNumber = gradientNumbers[i - 1];\r\n\t    float lastValue = lastGradientNumber.y;\r\n\r\n\t    if (key >= normalizedAge)\r\n\t\t{\r\n\t\t    float lastKey = lastGradientNumber.x;\r\n\t\t\tfloat time =  max((normalizedAge - lastKey), 0.);\r\n\t\t\tfloat age = time / (key-lastKey);\r\n\t\t\tlastSpeed = mix(lastValue, gradientNumber.y,age);\r\n\t\t    totalValue += (lastValue + mix(lastValue, gradientNumber.y, age)) / 2.0 * a_ShapePositionStartLifeTime.w * time;\r\n\t\t    keyTime = normalizedAge;\r\n\t\t\tbreak;\r\n\t\t}\r\n\t    else if(key > keyTime)\r\n\t\t{\r\n\t\t    totalValue += (lastValue + gradientNumber.y) / 2.0 * a_ShapePositionStartLifeTime.w * (key - lastGradientNumber.x);\r\n\t\t\tkeyTime = key;\r\n\t\t\tlastSpeed = gradientNumber.y;\r\n\t\t}\r\n\t}\r\n    return totalValue + max(normalizedAge-keyTime, 0.) * lastSpeed * a_ShapePositionStartLifeTime.w;\r\n}\r\n\r\nvec4 getColorFromGradient(in vec2 gradientAlphas[COLORCOUNT],\r\n    in vec4 gradientColors[COLORCOUNT],\r\n    in float normalizedAge, in vec4 keyRanges)\r\n{\r\n    float alphaAge = clamp(normalizedAge, keyRanges.z, keyRanges.w);\r\n    vec4 overTimeColor;\r\n    for (int i = 1; i < COLORCOUNT; i++)\r\n\t{\r\n\t    vec2 gradientAlpha = gradientAlphas[i];\r\n\t    float alphaKey = gradientAlpha.x;\r\n\t    if (alphaKey >= alphaAge)\r\n\t\t{\r\n\t\t    vec2 lastGradientAlpha = gradientAlphas[i - 1];\r\n\t\t    float lastAlphaKey = lastGradientAlpha.x;\r\n\t\t    float age = clamp((alphaAge - lastAlphaKey) / (alphaKey - lastAlphaKey), 0.0, 1.0);\r\n\t\t    overTimeColor.a = mix(lastGradientAlpha.y, gradientAlpha.y, age);\r\n\t\t    break;\r\n\t\t}\r\n\t}\r\n\r\n    float colorAge = clamp(normalizedAge, keyRanges.x, keyRanges.y);\r\n    for (int i = 1; i < COLORCOUNT; i++)\r\n\t{\r\n\t    vec4 gradientColor = gradientColors[i];\r\n\t    float colorKey = gradientColor.x;\r\n\t    if (colorKey >= colorAge)\r\n\t\t{\r\n\t\t    vec4 lastGradientColor = gradientColors[i - 1];\r\n\t\t    float lastColorKey = lastGradientColor.x;\r\n\t\t    float age = (colorAge - lastColorKey) / (colorKey - lastColorKey);\r\n\t\t    overTimeColor.rgb = mix(gradientColors[i - 1].yzw, gradientColor.yzw, age);\r\n\t\t    break;\r\n\t\t}\r\n\t}\r\n    return overTimeColor;\r\n}\r\n\r\nfloat getFrameFromGradient(in vec2 gradientFrames[4], in float normalizedAge)\r\n{\r\n    float overTimeFrame;\r\n    for (int i = 1; i < 4; i++)\r\n\t{\r\n\t    vec2 gradientFrame = gradientFrames[i];\r\n\t    float key = gradientFrame.x;\r\n\t\toverTimeFrame = gradientFrame.y;\r\n\t    if (key >= normalizedAge)\r\n\t\t{\r\n\t\t    vec2 lastGradientFrame = gradientFrames[i - 1];\r\n\t\t    float lastKey = lastGradientFrame.x;\r\n\t\t\tfloat age = max((normalizedAge-lastKey), 0.)/(key-lastKey);\r\n\t\t    overTimeFrame = mix(lastGradientFrame.y, gradientFrame.y, age);\r\n\t\t    break;\r\n\t\t}\r\n\t}\r\n    return floor(overTimeFrame);\r\n}\r\n","// sprite Uniform\r\nuniform float u_CurrentTime;\r\nuniform vec3 u_Gravity;\r\nuniform vec2 u_DragConstanct;\r\nuniform vec3 u_WorldPosition;\r\nuniform vec4 u_WorldRotation;\r\nuniform bool u_ThreeDStartRotation;\r\nuniform int u_ScalingMode;\r\nuniform vec3 u_PositionScale;\r\nuniform vec3 u_SizeScale;\r\n\r\nuniform float u_StretchedBillboardLengthScale;\r\nuniform float u_StretchedBillboardSpeedScale;\r\nuniform int u_SimulationSpace;\r\n\r\n#if defined(VELOCITYOVERLIFETIMECONSTANT) || defined(VELOCITYOVERLIFETIMECURVE) || defined(VELOCITYOVERLIFETIMERANDOMCONSTANT) || defined(VELOCITYOVERLIFETIMERANDOMCURVE)\r\nuniform int u_VOLSpaceType;\r\n#endif\r\n#if defined(VELOCITYOVERLIFETIMECONSTANT) || defined(VELOCITYOVERLIFETIMERANDOMCONSTANT)\r\nuniform vec3 u_VOLVelocityConst;\r\n#endif\r\n#if defined(VELOCITYOVERLIFETIMECURVE) || defined(VELOCITYOVERLIFETIMERANDOMCURVE)\r\nuniform vec2 u_VOLVelocityGradientX[4]; // xkey,y\r\nuniform vec2 u_VOLVelocityGradientY[4]; // xkey,y\r\nuniform vec2 u_VOLVelocityGradientZ[4]; // xkey,y\r\n#endif\r\n#ifdef VELOCITYOVERLIFETIMERANDOMCONSTANT\r\nuniform vec3 u_VOLVelocityConstMax;\r\n#endif\r\n#ifdef VELOCITYOVERLIFETIMERANDOMCURVE\r\nuniform vec2 u_VOLVelocityGradientMaxX[4]; // xkey,y\r\nuniform vec2 u_VOLVelocityGradientMaxY[4]; // xkey,y\r\nuniform vec2 u_VOLVelocityGradientMaxZ[4]; // xkey,y\r\n#endif\r\n\r\n#ifdef COLORKEYCOUNT_8\r\n    #define COLORCOUNT 8\r\n#else\r\n    #define COLORCOUNT 4\r\n#endif\r\n\r\n#ifdef COLOROVERLIFETIME\r\nuniform vec4 u_ColorOverLifeGradientColors[COLORCOUNT]; // xkey,yzwColor\r\nuniform vec2 u_ColorOverLifeGradientAlphas[COLORCOUNT]; // xkey,yAlpha\r\nuniform vec4 u_ColorOverLifeGradientRanges;\r\n#endif\r\n#ifdef RANDOMCOLOROVERLIFETIME\r\nuniform vec4 u_ColorOverLifeGradientColors[COLORCOUNT]; // xkey,yzwColor\r\nuniform vec2 u_ColorOverLifeGradientAlphas[COLORCOUNT]; // xkey,yAlpha\r\nuniform vec4 u_ColorOverLifeGradientRanges;\r\nuniform vec4 u_MaxColorOverLifeGradientColors[COLORCOUNT]; // xkey,yzwColor\r\nuniform vec2 u_MaxColorOverLifeGradientAlphas[COLORCOUNT]; // xkey,yAlpha\r\nuniform vec4 u_MaxColorOverLifeGradientRanges;\r\n#endif\r\n\r\n#if defined(SIZEOVERLIFETIMECURVE) || defined(SIZEOVERLIFETIMERANDOMCURVES)\r\nuniform vec2 u_SOLSizeGradient[4]; // xkey,y\r\n#endif\r\n#ifdef SIZEOVERLIFETIMERANDOMCURVES\r\nuniform vec2 u_SOLSizeGradientMax[4]; // xkey,y\r\n#endif\r\n#if defined(SIZEOVERLIFETIMECURVESEPERATE) || defined(SIZEOVERLIFETIMERANDOMCURVESSEPERATE)\r\nuniform vec2 u_SOLSizeGradientX[4]; // xkey,y\r\nuniform vec2 u_SOLSizeGradientY[4]; // xkey,y\r\nuniform vec2 u_SOLSizeGradientZ[4]; // xkey,y\r\n#endif\r\n#ifdef SIZEOVERLIFETIMERANDOMCURVESSEPERATE\r\nuniform vec2 u_SOLSizeGradientMaxX[4]; // xkey,y\r\nuniform vec2 u_SOLSizeGradientMaxY[4]; // xkey,y\r\nuniform vec2 u_SOLSizeGradientMaxZ[4]; // xkey,y\r\n#endif\r\n\r\n#ifdef ROTATIONOVERLIFETIME\r\n    #if defined(ROTATIONOVERLIFETIMECONSTANT) || defined(ROTATIONOVERLIFETIMERANDOMCONSTANTS)\r\nuniform float u_ROLAngularVelocityConst;\r\n    #endif\r\n    #ifdef ROTATIONOVERLIFETIMERANDOMCONSTANTS\r\nuniform float u_ROLAngularVelocityConstMax;\r\n    #endif\r\n    #if defined(ROTATIONOVERLIFETIMECURVE) || defined(ROTATIONOVERLIFETIMERANDOMCURVES)\r\nuniform vec2 u_ROLAngularVelocityGradient[4]; // xkey,y\r\n    #endif\r\n    #ifdef ROTATIONOVERLIFETIMERANDOMCURVES\r\nuniform vec2 u_ROLAngularVelocityGradientMax[4]; // xkey,y\r\n    #endif\r\n#endif\r\n#ifdef ROTATIONOVERLIFETIMESEPERATE\r\n    #if defined(ROTATIONOVERLIFETIMECONSTANT) || defined(ROTATIONOVERLIFETIMERANDOMCONSTANTS)\r\nuniform vec3 u_ROLAngularVelocityConstSeprarate;\r\n    #endif\r\n    #ifdef ROTATIONOVERLIFETIMERANDOMCONSTANTS\r\nuniform vec3 u_ROLAngularVelocityConstMaxSeprarate;\r\n    #endif\r\n    #if defined(ROTATIONOVERLIFETIMECURVE) || defined(ROTATIONOVERLIFETIMERANDOMCURVES)\r\nuniform vec2 u_ROLAngularVelocityGradientX[4];\r\nuniform vec2 u_ROLAngularVelocityGradientY[4];\r\nuniform vec2 u_ROLAngularVelocityGradientZ[4];\r\n    #endif\r\n    #ifdef ROTATIONOVERLIFETIMERANDOMCURVES\r\nuniform vec2 u_ROLAngularVelocityGradientMaxX[4];\r\nuniform vec2 u_ROLAngularVelocityGradientMaxY[4];\r\nuniform vec2 u_ROLAngularVelocityGradientMaxZ[4];\r\nuniform vec2 u_ROLAngularVelocityGradientMaxW[4];\r\n    #endif\r\n#endif\r\n\r\n#if defined(TEXTURESHEETANIMATIONCURVE) || defined(TEXTURESHEETANIMATIONRANDOMCURVE)\r\nuniform float u_TSACycles;\r\nuniform vec2 u_TSASubUVLength;\r\nuniform vec2 u_TSAGradientUVs[4]; // xkey,yframe\r\n#endif\r\n#ifdef TEXTURESHEETANIMATIONRANDOMCURVE\r\nuniform vec2 u_TSAMaxGradientUVs[4]; // xkey,yframe\r\n#endif","#define SHADER_NAME ParticleVS\r\n\r\n#include \"Camera.glsl\";\r\n#include \"particleShuriKenSpriteVS.glsl\";\r\n#include \"Math.glsl\";\r\n#include \"MathGradient.glsl\";\r\n#include \"Color.glsl\";\r\n#include \"Scene.glsl\"\r\n#include \"SceneFogInput.glsl\"\r\n\r\n\r\n#ifdef RENDERMODE_MESH\r\nvarying vec4 v_MeshColor;\r\n#endif\r\n\r\nvarying vec4 v_Color;\r\nvarying vec2 v_TextureCoordinate;\r\n\r\n//\r\nvec2 TransformUV(vec2 texcoord, vec4 tilingOffset)\r\n{\r\n    vec2 transTexcoord = vec2(texcoord.x, texcoord.y - 1.0) * tilingOffset.xy + vec2(tilingOffset.z, -tilingOffset.w);\r\n    transTexcoord.y += 1.0;\r\n    return transTexcoord;\r\n}\r\n\r\n#if defined(VELOCITYOVERLIFETIMECONSTANT) || defined(VELOCITYOVERLIFETIMECURVE) || defined(VELOCITYOVERLIFETIMERANDOMCONSTANT) || defined(VELOCITYOVERLIFETIMERANDOMCURVE)\r\nvec3 computeParticleLifeVelocity(in float normalizedAge)\r\n{\r\n    vec3 outLifeVelocity;\r\n    #ifdef VELOCITYOVERLIFETIMECONSTANT\r\n    outLifeVelocity = u_VOLVelocityConst;\r\n    #endif\r\n    #ifdef VELOCITYOVERLIFETIMECURVE\r\n    outLifeVelocity = vec3(getCurValueFromGradientFloat(u_VOLVelocityGradientX, normalizedAge),\r\n\tgetCurValueFromGradientFloat(u_VOLVelocityGradientY, normalizedAge),\r\n\tgetCurValueFromGradientFloat(u_VOLVelocityGradientZ, normalizedAge));\r\n    #endif\r\n    #ifdef VELOCITYOVERLIFETIMERANDOMCONSTANT\r\n    outLifeVelocity = mix(u_VOLVelocityConst,\r\n\tu_VOLVelocityConstMax,\r\n\tvec3(a_Random1.y, a_Random1.z, a_Random1.w));\r\n    #endif\r\n    #ifdef VELOCITYOVERLIFETIMERANDOMCURVE\r\n    outLifeVelocity = vec3(\r\n\tmix(getCurValueFromGradientFloat(u_VOLVelocityGradientX, normalizedAge),\r\n\t    getCurValueFromGradientFloat(u_VOLVelocityGradientMaxX, normalizedAge),\r\n\t    a_Random1.y),\r\n\tmix(getCurValueFromGradientFloat(u_VOLVelocityGradientY, normalizedAge),\r\n\t    getCurValueFromGradientFloat(u_VOLVelocityGradientMaxY, normalizedAge),\r\n\t    a_Random1.z),\r\n\tmix(getCurValueFromGradientFloat(u_VOLVelocityGradientZ, normalizedAge),\r\n\t    getCurValueFromGradientFloat(u_VOLVelocityGradientMaxZ, normalizedAge),\r\n\t    a_Random1.w));\r\n    #endif\r\n\r\n    return outLifeVelocity;\r\n}\r\n#endif\r\n\r\n// drag\r\nvec3 getStartPosition(vec3 startVelocity, float age, vec3 dragData)\r\n{\r\n    vec3 startPosition;\r\n    float lasttime = min(startVelocity.x / dragData.x, age);\r\n    startPosition = lasttime * (startVelocity - 0.5 * dragData * lasttime);\r\n    return startPosition;\r\n}\r\n\r\nvec3 computeParticlePosition(in vec3 startVelocity, in vec3 lifeVelocity, in float age, in float normalizedAge, vec3 gravityVelocity, vec4 worldRotation, vec3 dragData)\r\n{\r\n    vec3 startPosition = getStartPosition(startVelocity, age, dragData);\r\n    vec3 lifePosition;\r\n#if defined(VELOCITYOVERLIFETIMECONSTANT) || defined(VELOCITYOVERLIFETIMECURVE) || defined(VELOCITYOVERLIFETIMERANDOMCONSTANT) || defined(VELOCITYOVERLIFETIMERANDOMCURVE)\r\n    #ifdef VELOCITYOVERLIFETIMECONSTANT\r\n    // startPosition = startVelocity * age;\r\n    lifePosition = lifeVelocity * age;\r\n    #endif\r\n    #ifdef VELOCITYOVERLIFETIMECURVE\r\n    // startPosition = startVelocity * age;\r\n    lifePosition = vec3(getTotalValueFromGradientFloat(u_VOLVelocityGradientX, normalizedAge),\r\n\tgetTotalValueFromGradientFloat(u_VOLVelocityGradientY, normalizedAge),\r\n\tgetTotalValueFromGradientFloat(u_VOLVelocityGradientZ, normalizedAge));\r\n    #endif\r\n    #ifdef VELOCITYOVERLIFETIMERANDOMCONSTANT\r\n    // startPosition = startVelocity * age;\r\n    lifePosition = lifeVelocity * age;\r\n    #endif\r\n    #ifdef VELOCITYOVERLIFETIMERANDOMCURVE\r\n    // startPosition = startVelocity * age;\r\n    lifePosition = vec3(\r\n\tmix(\r\n\t    getTotalValueFromGradientFloat(u_VOLVelocityGradientX, normalizedAge),\r\n\t    getTotalValueFromGradientFloat(u_VOLVelocityGradientMaxX, normalizedAge),\r\n\t    a_Random1.y),\r\n\tmix(\r\n\t    getTotalValueFromGradientFloat(u_VOLVelocityGradientY, normalizedAge),\r\n\t    getTotalValueFromGradientFloat(u_VOLVelocityGradientMaxY, normalizedAge),\r\n\t    a_Random1.z),\r\n\tmix(\r\n\t    getTotalValueFromGradientFloat(u_VOLVelocityGradientZ, normalizedAge),\r\n\t    getTotalValueFromGradientFloat(u_VOLVelocityGradientMaxZ, normalizedAge),\r\n\t    a_Random1.w));\r\n    #endif\r\n\r\n    vec3 finalPosition;\r\n    if (u_VOLSpaceType == 0)\r\n\t{\r\n\t    if (u_ScalingMode != 2)\r\n\t\tfinalPosition = rotationByQuaternions(\r\n\t\t    u_PositionScale * (a_ShapePositionStartLifeTime.xyz + startPosition + lifePosition),\r\n\t\t    worldRotation);\r\n\t    else\r\n\t\tfinalPosition = rotationByQuaternions(\r\n\t\t    u_PositionScale * a_ShapePositionStartLifeTime.xyz + startPosition + lifePosition,\r\n\t\t    worldRotation);\r\n\t}\r\n    else\r\n\t{\r\n\t    if (u_ScalingMode != 2)\r\n\t\tfinalPosition = rotationByQuaternions(\r\n\t\t\t\t    u_PositionScale * (a_ShapePositionStartLifeTime.xyz + startPosition),\r\n\t\t\t\t    worldRotation)\r\n\t\t    + lifePosition;\r\n\t    else\r\n\t\tfinalPosition = rotationByQuaternions(\r\n\t\t\t\t    u_PositionScale * a_ShapePositionStartLifeTime.xyz + startPosition,\r\n\t\t\t\t    worldRotation)\r\n\t\t    + lifePosition;\r\n\t}\r\n#else\r\n    // startPosition = startVelocity * age;\r\n    vec3 finalPosition;\r\n    if (u_ScalingMode != 2)\r\n\tfinalPosition = rotationByQuaternions(\r\n\t    u_PositionScale * (a_ShapePositionStartLifeTime.xyz + startPosition),\r\n\t    worldRotation);\r\n    else\r\n\tfinalPosition = rotationByQuaternions(\r\n\t    u_PositionScale * a_ShapePositionStartLifeTime.xyz + startPosition,\r\n\t    worldRotation);\r\n#endif\r\n\r\n    if (u_SimulationSpace == 0)\r\n\tfinalPosition = finalPosition + a_SimulationWorldPostion;\r\n    else if (u_SimulationSpace == 1)\r\n\tfinalPosition = finalPosition + u_WorldPosition;\r\n\r\n    finalPosition += 0.5 * gravityVelocity * age;\r\n\r\n    return finalPosition;\r\n}\r\n\r\nvec4 computeParticleColor(in vec4 color, in float normalizedAge)\r\n{\r\n#ifdef COLOROVERLIFETIME\r\n    color *= getColorFromGradient(u_ColorOverLifeGradientAlphas,\r\n\tu_ColorOverLifeGradientColors,\r\n\tnormalizedAge, u_ColorOverLifeGradientRanges);\r\n#endif\r\n\r\n#ifdef RANDOMCOLOROVERLIFETIME\r\n    color *= mix(getColorFromGradient(u_ColorOverLifeGradientAlphas,\r\n\t\t     u_ColorOverLifeGradientColors,\r\n\t\t     normalizedAge, u_ColorOverLifeGradientRanges),\r\n\tgetColorFromGradient(u_MaxColorOverLifeGradientAlphas,\r\n\t    u_MaxColorOverLifeGradientColors,\r\n\t    normalizedAge, u_MaxColorOverLifeGradientRanges),\r\n\ta_Random0.y);\r\n#endif\r\n\r\n    return color;\r\n}\r\n\r\nvec2 computeParticleSizeBillbard(in vec2 size, in float normalizedAge)\r\n{\r\n#ifdef SIZEOVERLIFETIMECURVE\r\n    size *= getCurValueFromGradientFloat(u_SOLSizeGradient, normalizedAge);\r\n#endif\r\n#ifdef SIZEOVERLIFETIMERANDOMCURVES\r\n    size *= mix(getCurValueFromGradientFloat(u_SOLSizeGradient, normalizedAge),\r\n\tgetCurValueFromGradientFloat(u_SOLSizeGradientMax, normalizedAge),\r\n\ta_Random0.z);\r\n#endif\r\n#ifdef SIZEOVERLIFETIMECURVESEPERATE\r\n    size *= vec2(getCurValueFromGradientFloat(u_SOLSizeGradientX, normalizedAge),\r\n\tgetCurValueFromGradientFloat(u_SOLSizeGradientY, normalizedAge));\r\n#endif\r\n#ifdef SIZEOVERLIFETIMERANDOMCURVESSEPERATE\r\n    size *= vec2(mix(getCurValueFromGradientFloat(u_SOLSizeGradientX, normalizedAge),\r\n\t\t     getCurValueFromGradientFloat(u_SOLSizeGradientMaxX, normalizedAge),\r\n\t\t     a_Random0.z),\r\n\tmix(getCurValueFromGradientFloat(u_SOLSizeGradientY, normalizedAge),\r\n\t    getCurValueFromGradientFloat(u_SOLSizeGradientMaxY, normalizedAge),\r\n\t    a_Random0.z));\r\n#endif\r\n    return size;\r\n}\r\n\r\n#ifdef RENDERMODE_MESH\r\nvec3 computeParticleSizeMesh(in vec3 size, in float normalizedAge)\r\n{\r\n    #ifdef SIZEOVERLIFETIMECURVE\r\n    size *= getCurValueFromGradientFloat(u_SOLSizeGradient, normalizedAge);\r\n    #endif\r\n    #ifdef SIZEOVERLIFETIMERANDOMCURVES\r\n    size *= mix(getCurValueFromGradientFloat(u_SOLSizeGradient, normalizedAge),\r\n\tgetCurValueFromGradientFloat(u_SOLSizeGradientMax, normalizedAge),\r\n\ta_Random0.z);\r\n    #endif\r\n    #ifdef SIZEOVERLIFETIMECURVESEPERATE\r\n    size *= vec3(getCurValueFromGradientFloat(u_SOLSizeGradientX, normalizedAge),\r\n\tgetCurValueFromGradientFloat(u_SOLSizeGradientY, normalizedAge),\r\n\tgetCurValueFromGradientFloat(u_SOLSizeGradientZ, normalizedAge));\r\n    #endif\r\n    #ifdef SIZEOVERLIFETIMERANDOMCURVESSEPERATE\r\n    size *= vec3(mix(getCurValueFromGradientFloat(u_SOLSizeGradientX, normalizedAge),\r\n\t\t     getCurValueFromGradientFloat(u_SOLSizeGradientMaxX, normalizedAge),\r\n\t\t     a_Random0.z),\r\n\tmix(getCurValueFromGradientFloat(u_SOLSizeGradientY, normalizedAge),\r\n\t    getCurValueFromGradientFloat(u_SOLSizeGradientMaxY, normalizedAge),\r\n\t    a_Random0.z),\r\n\tmix(getCurValueFromGradientFloat(u_SOLSizeGradientZ, normalizedAge),\r\n\t    getCurValueFromGradientFloat(u_SOLSizeGradientMaxZ, normalizedAge),\r\n\t    a_Random0.z));\r\n    #endif\r\n    return size;\r\n}\r\n#endif\r\n\r\nfloat computeParticleRotationFloat(in float rotation,\r\n    in float age,\r\n    in float normalizedAge)\r\n{\r\n#ifdef ROTATIONOVERLIFETIME\r\n    #ifdef ROTATIONOVERLIFETIMECONSTANT\r\n    float ageRot = u_ROLAngularVelocityConst * age;\r\n    rotation += ageRot;\r\n    #endif\r\n    #ifdef ROTATIONOVERLIFETIMECURVE\r\n    rotation += getTotalValueFromGradientFloat(u_ROLAngularVelocityGradient, normalizedAge);\r\n    #endif\r\n    #ifdef ROTATIONOVERLIFETIMERANDOMCONSTANTS\r\n    float ageRot = mix(u_ROLAngularVelocityConst, u_ROLAngularVelocityConstMax, a_Random0.w) * age;\r\n    rotation += ageRot;\r\n    #endif\r\n    #ifdef ROTATIONOVERLIFETIMERANDOMCURVES\r\n    rotation += mix(\r\n\tgetTotalValueFromGradientFloat(u_ROLAngularVelocityGradient, normalizedAge),\r\n\tgetTotalValueFromGradientFloat(u_ROLAngularVelocityGradientMax,\r\n\t    normalizedAge),\r\n\ta_Random0.w);\r\n    #endif\r\n#endif\r\n#ifdef ROTATIONOVERLIFETIMESEPERATE\r\n    #ifdef ROTATIONOVERLIFETIMECONSTANT\r\n    float ageRot = u_ROLAngularVelocityConstSeprarate.z * age;\r\n    rotation += ageRot;\r\n    #endif\r\n    #ifdef ROTATIONOVERLIFETIMECURVE\r\n    rotation += getTotalValueFromGradientFloat(u_ROLAngularVelocityGradientZ,\r\n\tnormalizedAge);\r\n    #endif\r\n    #ifdef ROTATIONOVERLIFETIMERANDOMCONSTANTS\r\n    float ageRot = mix(u_ROLAngularVelocityConstSeprarate.z,\r\n\t\t       u_ROLAngularVelocityConstMaxSeprarate.z,\r\n\t\t       a_Random0.w)\r\n\t* age;\r\n    rotation += ageRot;\r\n    #endif\r\n    #ifdef ROTATIONOVERLIFETIMERANDOMCURVES\r\n    rotation += mix(getTotalValueFromGradientFloat(u_ROLAngularVelocityGradientZ,\r\n\t\t\tnormalizedAge),\r\n\tgetTotalValueFromGradientFloat(\r\n\t    u_ROLAngularVelocityGradientMaxZ, normalizedAge),\r\n\ta_Random0.w);\r\n    #endif\r\n#endif\r\n    return rotation;\r\n}\r\n\r\n#if defined(RENDERMODE_MESH) && (defined(ROTATIONOVERLIFETIME) || defined(ROTATIONOVERLIFETIMESEPERATE))\r\nvec3 computeParticleRotationVec3(in vec3 rotation,\r\n    in float age,\r\n    in float normalizedAge)\r\n{\r\n    #ifdef ROTATIONOVERLIFETIME\r\n\t#ifdef ROTATIONOVERLIFETIMECONSTANT\r\n    float ageRot = u_ROLAngularVelocityConst * age;\r\n    rotation += ageRot;\r\n\t#endif\r\n\t#ifdef ROTATIONOVERLIFETIMECURVE\r\n    rotation += getTotalValueFromGradientFloat(u_ROLAngularVelocityGradient, normalizedAge);\r\n\t#endif\r\n\t#ifdef ROTATIONOVERLIFETIMERANDOMCONSTANTS\r\n    float ageRot = mix(u_ROLAngularVelocityConst, u_ROLAngularVelocityConstMax, a_Random0.w) * age;\r\n    rotation += ageRot;\r\n\t#endif\r\n\t#ifdef ROTATIONOVERLIFETIMERANDOMCURVES\r\n    rotation += mix(\r\n\tgetTotalValueFromGradientFloat(u_ROLAngularVelocityGradient, normalizedAge),\r\n\tgetTotalValueFromGradientFloat(u_ROLAngularVelocityGradientMax,\r\n\t    normalizedAge),\r\n\ta_Random0.w);\r\n\t#endif\r\n    #endif\r\n    #ifdef ROTATIONOVERLIFETIMESEPERATE\r\n\t#ifdef ROTATIONOVERLIFETIMECONSTANT\r\n    vec3 ageRot = u_ROLAngularVelocityConstSeprarate * age;\r\n    rotation += ageRot;\r\n\t#endif\r\n\t#ifdef ROTATIONOVERLIFETIMECURVE\r\n    rotation += vec3(getTotalValueFromGradientFloat(u_ROLAngularVelocityGradientX,\r\n\t\t\t normalizedAge),\r\n\tgetTotalValueFromGradientFloat(u_ROLAngularVelocityGradientY,\r\n\t    normalizedAge),\r\n\tgetTotalValueFromGradientFloat(u_ROLAngularVelocityGradientZ,\r\n\t    normalizedAge));\r\n\t#endif\r\n\t#ifdef ROTATIONOVERLIFETIMERANDOMCONSTANTS\r\n    vec3 ageRot = mix(u_ROLAngularVelocityConstSeprarate,\r\n\t\t      u_ROLAngularVelocityConstMaxSeprarate,\r\n\t\t      a_Random0.w)\r\n\t* age;\r\n    rotation += ageRot;\r\n\t#endif\r\n\t#ifdef ROTATIONOVERLIFETIMERANDOMCURVES\r\n    rotation += vec3(mix(getTotalValueFromGradientFloat(u_ROLAngularVelocityGradientX,\r\n\t\t\t     normalizedAge),\r\n\t\t\t getTotalValueFromGradientFloat(u_ROLAngularVelocityGradientMaxX,\r\n\t\t\t     normalizedAge),\r\n\t\t\t a_Random0.w),\r\n\tmix(getTotalValueFromGradientFloat(u_ROLAngularVelocityGradientY,\r\n\t\tnormalizedAge),\r\n\t    getTotalValueFromGradientFloat(u_ROLAngularVelocityGradientMaxY,\r\n\t\tnormalizedAge),\r\n\t    a_Random0.w),\r\n\tmix(getTotalValueFromGradientFloat(u_ROLAngularVelocityGradientZ,\r\n\t\tnormalizedAge),\r\n\t    getTotalValueFromGradientFloat(u_ROLAngularVelocityGradientMaxZ,\r\n\t\tnormalizedAge),\r\n\t    a_Random0.w));\r\n\t#endif\r\n    #endif\r\n    return rotation;\r\n}\r\n#endif\r\n\r\nvec2 computeParticleUV(in vec2 uv, in float normalizedAge)\r\n{\r\n#ifdef TEXTURESHEETANIMATIONCURVE\r\n    float cycleNormalizedAge = normalizedAge * u_TSACycles;\r\n    float frame = getFrameFromGradient(\r\n\tu_TSAGradientUVs, cycleNormalizedAge - floor(cycleNormalizedAge));\r\n    float totalULength = frame * u_TSASubUVLength.x;\r\n    float floorTotalULength = floor(totalULength);\r\n    uv.x += totalULength - floorTotalULength;\r\n    uv.y += floorTotalULength * u_TSASubUVLength.y;\r\n#endif\r\n#ifdef TEXTURESHEETANIMATIONRANDOMCURVE\r\n    float cycleNormalizedAge = normalizedAge * u_TSACycles;\r\n    float uvNormalizedAge = cycleNormalizedAge - floor(cycleNormalizedAge);\r\n    float frame = floor(mix(getFrameFromGradient(u_TSAGradientUVs, uvNormalizedAge),\r\n\tgetFrameFromGradient(u_TSAMaxGradientUVs, uvNormalizedAge),\r\n\ta_Random1.x));\r\n    float totalULength = frame * u_TSASubUVLength.x;\r\n    float floorTotalULength = floor(totalULength);\r\n    uv.x += totalULength - floorTotalULength;\r\n    uv.y += floorTotalULength * u_TSASubUVLength.y;\r\n#endif\r\n    return uv;\r\n}\r\n\r\nvoid main()\r\n{\r\n    float age = u_CurrentTime - a_DirectionTime.w;\r\n    float normalizedAge = age / a_ShapePositionStartLifeTime.w;\r\n    vec3 lifeVelocity;\r\n    if (normalizedAge < 1.0)\r\n\t{\r\n\t    vec3 startVelocity = a_DirectionTime.xyz * a_StartSpeed;\r\n#if defined(VELOCITYOVERLIFETIMECONSTANT) || defined(VELOCITYOVERLIFETIMECURVE) || defined(VELOCITYOVERLIFETIMERANDOMCONSTANT) || defined(VELOCITYOVERLIFETIMERANDOMCURVE)\r\n\t    lifeVelocity = computeParticleLifeVelocity(normalizedAge); //\r\n#endif\r\n\t    vec3 gravityVelocity = u_Gravity * age;\r\n\r\n\t    vec4 worldRotation;\r\n\t    if (u_SimulationSpace == 0)\r\n\t\tworldRotation = a_SimulationWorldRotation;\r\n\t    else\r\n\t\tworldRotation = u_WorldRotation;\r\n\r\n\t    // drag\r\n\t    vec3 dragData = a_DirectionTime.xyz * mix(u_DragConstanct.x, u_DragConstanct.y, a_Random0.x);\r\n\t    vec3 center = computeParticlePosition(startVelocity, lifeVelocity, age, normalizedAge, gravityVelocity, worldRotation, dragData); //\r\n\r\n#ifdef SPHERHBILLBOARD\r\n\t    vec2 corner = a_CornerTextureCoordinate.xy; // Billboardz\r\n\t    vec3 cameraUpVector = normalize(u_CameraUp); // TODO:\r\n\t    vec3 sideVector = normalize(cross(u_CameraDirection, cameraUpVector));\r\n\t    vec3 upVector = normalize(cross(sideVector, u_CameraDirection));\r\n\t    corner *= computeParticleSizeBillbard(a_StartSize.xy, normalizedAge);\r\n    #if defined(ROTATIONOVERLIFETIME) || defined(ROTATIONOVERLIFETIMESEPERATE)\r\n\t    if (u_ThreeDStartRotation)\r\n\t\t{\r\n\t\t    vec3 rotation = vec3(\r\n\t\t\ta_StartRotation0.xy,\r\n\t\t\tcomputeParticleRotationFloat(a_StartRotation0.z, age, normalizedAge));\r\n\t\t    center += u_SizeScale.xzy * rotationByEuler(corner.x * sideVector + corner.y * upVector, rotation);\r\n\t\t}\r\n\t    else\r\n\t\t{\r\n\t\t    float rot = computeParticleRotationFloat(a_StartRotation0.x, age, normalizedAge);\r\n\t\t    float c = cos(rot);\r\n\t\t    float s = sin(rot);\r\n\t\t    mat2 rotation = mat2(c, -s, s, c);\r\n\t\t    corner = rotation * corner;\r\n\t\t    center += u_SizeScale.xzy * (corner.x * sideVector + corner.y * upVector);\r\n\t\t}\r\n    #else\r\n\t    if (u_ThreeDStartRotation)\r\n\t\t{\r\n\t\t    center += u_SizeScale.xzy * rotationByEuler(corner.x * sideVector + corner.y * upVector, a_StartRotation0);\r\n\t\t}\r\n\t    else\r\n\t\t{\r\n\t\t    float c = cos(a_StartRotation0.x);\r\n\t\t    float s = sin(a_StartRotation0.x);\r\n\t\t    mat2 rotation = mat2(c, -s, s, c);\r\n\t\t    corner = rotation * corner;\r\n\t\t    center += u_SizeScale.xzy * (corner.x * sideVector + corner.y * upVector);\r\n\t\t}\r\n    #endif\r\n#endif\r\n\r\n#ifdef STRETCHEDBILLBOARD\r\n\t    vec2 corner = a_CornerTextureCoordinate.xy; // Billboardz\r\n\t    vec3 velocity;\r\n    #if defined(VELOCITYOVERLIFETIMECONSTANT) || defined(VELOCITYOVERLIFETIMECURVE) || defined(VELOCITYOVERLIFETIMERANDOMCONSTANT) || defined(VELOCITYOVERLIFETIMERANDOMCURVE)\r\n\t    if (u_VOLSpaceType == 0)\r\n\t\tvelocity = rotationByQuaternions(u_SizeScale * (startVelocity + lifeVelocity),\r\n\t\t\t       worldRotation)\r\n\t\t    + gravityVelocity;\r\n\t    else\r\n\t\tvelocity = rotationByQuaternions(u_SizeScale * startVelocity, worldRotation) + lifeVelocity + gravityVelocity;\r\n    #else\r\n\t    velocity = rotationByQuaternions(u_SizeScale * startVelocity, worldRotation) + gravityVelocity;\r\n    #endif\r\n\t    vec3 cameraUpVector = normalize(velocity);\r\n\t    vec3 direction = normalize(center - u_CameraPos);\r\n\t    vec3 sideVector = normalize(cross(direction, normalize(velocity)));\r\n\r\n\t    sideVector = u_SizeScale.xzy * sideVector;\r\n\t    cameraUpVector = length(vec3(u_SizeScale.x, 0.0, 0.0)) * cameraUpVector;\r\n\r\n\t    vec2 size = computeParticleSizeBillbard(a_StartSize.xy, normalizedAge);\r\n\r\n\t    const mat2 rotaionZHalfPI = mat2(0.0, -1.0, 1.0, 0.0);\r\n\t    corner = rotaionZHalfPI * corner;\r\n\t    corner.y = corner.y - abs(corner.y);\r\n\r\n\t    float speed = length(velocity); // TODO:\r\n\t    center += sign(u_SizeScale.x) * (sign(u_StretchedBillboardLengthScale) * size.x * corner.x * sideVector + (speed * u_StretchedBillboardSpeedScale + size.y * u_StretchedBillboardLengthScale) * corner.y * cameraUpVector);\r\n#endif\r\n\r\n#ifdef HORIZONTALBILLBOARD\r\n\t    vec2 corner = a_CornerTextureCoordinate.xy; // Billboardz\r\n\t    const vec3 cameraUpVector = vec3(0.0, 0.0, 1.0);\r\n\t    const vec3 sideVector = vec3(-1.0, 0.0, 0.0);\r\n\r\n\t    float rot = computeParticleRotationFloat(a_StartRotation0.x, age, normalizedAge);\r\n\t    float c = cos(rot);\r\n\t    float s = sin(rot);\r\n\t    mat2 rotation = mat2(c, -s, s, c);\r\n\t    corner = rotation * corner * cos(0.78539816339744830961566084581988); // TODO:cos45,U3D\r\n\t    corner *= computeParticleSizeBillbard(a_StartSize.xy, normalizedAge);\r\n\t    center += u_SizeScale.xzy * (corner.x * sideVector + corner.y * cameraUpVector);\r\n#endif\r\n\r\n#ifdef VERTICALBILLBOARD\r\n\t    vec2 corner = a_CornerTextureCoordinate.xy; // Billboardz\r\n\t    const vec3 cameraUpVector = vec3(0.0, 1.0, 0.0);\r\n\t    vec3 sideVector = normalize(cross(u_CameraDirection, cameraUpVector));\r\n\r\n\t    float rot = computeParticleRotationFloat(a_StartRotation0.x, age, normalizedAge);\r\n\t    float c = cos(rot);\r\n\t    float s = sin(rot);\r\n\t    mat2 rotation = mat2(c, -s, s, c);\r\n\t    corner = rotation * corner * cos(0.78539816339744830961566084581988); // TODO:cos45,U3D\r\n\t    corner *= computeParticleSizeBillbard(a_StartSize.xy, normalizedAge);\r\n\t    center += u_SizeScale.xzy * (corner.x * sideVector + corner.y * cameraUpVector);\r\n#endif\r\n\r\n#ifdef RENDERMODE_MESH\r\n\t    vec3 size = computeParticleSizeMesh(a_StartSize, normalizedAge);\r\n    #if defined(ROTATIONOVERLIFETIME) || defined(ROTATIONOVERLIFETIMESEPERATE)\r\n\t    if (u_ThreeDStartRotation)\r\n\t\t{\r\n\t\t    vec3 rotation = vec3(\r\n\t\t\ta_StartRotation0.xy,\r\n\t\t\tcomputeParticleRotationFloat(a_StartRotation0.z, age, normalizedAge));\r\n\t\t    center += rotationByQuaternions(\r\n\t\t\tu_SizeScale * rotationByEuler(a_MeshPosition * size, rotation),\r\n\t\t\tworldRotation);\r\n\t\t}\r\n\t    else\r\n\t\t{\r\n\t#ifdef ROTATIONOVERLIFETIME\r\n\t\t    float angle = computeParticleRotationFloat(a_StartRotation0.x, age, normalizedAge);\r\n\t\t    if (a_ShapePositionStartLifeTime.x != 0.0 || a_ShapePositionStartLifeTime.y != 0.0)\r\n\t\t\t{\r\n\t\t\t    center += (rotationByQuaternions(\r\n\t\t\t\trotationByAxis(\r\n\t\t\t\t    u_SizeScale * a_MeshPosition * size,\r\n\t\t\t\t    normalize(cross(vec3(0.0, 0.0, 1.0),\r\n\t\t\t\t\tvec3(a_ShapePositionStartLifeTime.xy, 0.0))),\r\n\t\t\t\t    angle),\r\n\t\t\t\tworldRotation)); //\r\n\t\t\t}\r\n\t\t    else\r\n\t\t\t{\r\n\t    #ifdef SHAPE\r\n\t\t\t    center += u_SizeScale.xzy * (rotationByQuaternions(rotationByAxis(a_MeshPosition * size, vec3(0.0, -1.0, 0.0), angle), worldRotation));\r\n\t    #else\r\n\t\t\t    if (u_SimulationSpace == 0)\r\n\t\t\t\tcenter += rotationByAxis(u_SizeScale * a_MeshPosition * size,\r\n\t\t\t\t    vec3(0.0, 0.0, -1.0),\r\n\t\t\t\t    angle); //\r\n\t\t\t    else if (u_SimulationSpace == 1)\r\n\t\t\t\tcenter += rotationByQuaternions(\r\n\t\t\t\t    u_SizeScale * rotationByAxis(a_MeshPosition * size, vec3(0.0, 0.0, -1.0), angle),\r\n\t\t\t\t    worldRotation); //\r\n\t    #endif\r\n\t\t\t}\r\n\t#endif\r\n\t#ifdef ROTATIONOVERLIFETIMESEPERATE\r\n\t\t    // TODO:if(u_ThreeDStartRotation),\r\n\t\t    vec3 angle = computeParticleRotationVec3(\r\n\t\t\tvec3(0.0, 0.0, -a_StartRotation0.x), age, normalizedAge);\r\n\t\t    center += (rotationByQuaternions(\r\n\t\t\trotationByEuler(u_SizeScale * a_MeshPosition * size,\r\n\t\t\t    vec3(angle.x, angle.y, angle.z)),\r\n\t\t\tworldRotation)); //\r\n\t#endif\r\n\t\t}\r\n    #else\r\n\t    if (u_ThreeDStartRotation)\r\n\t\t{\r\n\t\t    center += rotationByQuaternions(\r\n\t\t\tu_SizeScale * rotationByEuler(a_MeshPosition * size, a_StartRotation0),\r\n\t\t\tworldRotation); //\r\n\t\t}\r\n\t    else\r\n\t\t{\r\n\t\t    if (a_ShapePositionStartLifeTime.x != 0.0 || a_ShapePositionStartLifeTime.y != 0.0)\r\n\t\t\t{\r\n\t\t\t    if (u_SimulationSpace == 0)\r\n\t\t\t\tcenter += rotationByAxis(\r\n\t\t\t\t    u_SizeScale * a_MeshPosition * size,\r\n\t\t\t\t    normalize(cross(vec3(0.0, 0.0, 1.0),\r\n\t\t\t\t\tvec3(a_ShapePositionStartLifeTime.xy, 0.0))),\r\n\t\t\t\t    a_StartRotation0.x);\r\n\t\t\t    else if (u_SimulationSpace == 1)\r\n\t\t\t\tcenter += (rotationByQuaternions(\r\n\t\t\t\t    u_SizeScale * rotationByAxis(a_MeshPosition * size, normalize(cross(vec3(0.0, 0.0, 1.0), vec3(a_ShapePositionStartLifeTime.xy, 0.0))), a_StartRotation0.x),\r\n\t\t\t\t    worldRotation)); //\r\n\t\t\t}\r\n\t\t    else\r\n\t\t\t{\r\n\t#ifdef SHAPE\r\n\t\t\t    if (u_SimulationSpace == 0)\r\n\t\t\t\tcenter += u_SizeScale * rotationByAxis(a_MeshPosition * size, vec3(0.0, -1.0, 0.0), a_StartRotation0.x);\r\n\t\t\t    else if (u_SimulationSpace == 1)\r\n\t\t\t\tcenter += rotationByQuaternions(\r\n\t\t\t\t    u_SizeScale * rotationByAxis(a_MeshPosition * size, vec3(0.0, -1.0, 0.0), a_StartRotation0.x),\r\n\t\t\t\t    worldRotation);\r\n\t#else\r\n\t\t\t    if (u_SimulationSpace == 0)\r\n\t\t\t\tcenter += rotationByAxis(u_SizeScale * a_MeshPosition * size,\r\n\t\t\t\t    vec3(0.0, 0.0, -1.0),\r\n\t\t\t\t    a_StartRotation0.x);\r\n\t\t\t    else if (u_SimulationSpace == 1)\r\n\t\t\t\tcenter += rotationByQuaternions(\r\n\t\t\t\t    u_SizeScale * rotationByAxis(a_MeshPosition * size, vec3(0.0, 0.0, -1.0), a_StartRotation0.x),\r\n\t\t\t\t    worldRotation); //\r\n\t#endif\r\n\t\t\t}\r\n\t\t}\r\n    #endif\r\n\t    v_MeshColor = a_MeshColor;\r\n#endif\r\n\t    gl_Position = u_Projection * u_View * vec4(center, 1.0);\r\n\t\tvec4 startcolor = gammaToLinear(a_StartColor);\r\n\t    v_Color = computeParticleColor(startcolor, normalizedAge);\r\n#ifdef DIFFUSEMAP\r\n\t    vec2 simulateUV;\r\n    #if defined(SPHERHBILLBOARD) || defined(STRETCHEDBILLBOARD) || defined(HORIZONTALBILLBOARD) || defined(VERTICALBILLBOARD)\r\n\t    simulateUV = a_SimulationUV.xy + a_CornerTextureCoordinate.zw * a_SimulationUV.zw;\r\n\t    v_TextureCoordinate = computeParticleUV(simulateUV, normalizedAge);\r\n    #endif\r\n    #ifdef RENDERMODE_MESH\r\n\t    simulateUV = a_SimulationUV.xy + a_MeshTextureCoordinate * a_SimulationUV.zw;\r\n\t    v_TextureCoordinate = computeParticleUV(simulateUV, normalizedAge);\r\n    #endif\r\n\t    v_TextureCoordinate = TransformUV(v_TextureCoordinate, u_TilingOffset);\r\n#endif\r\n\t}\r\n    else\r\n\t{\r\n\t    gl_Position = vec4(2.0, 2.0, 2.0, 1.0); // Discard use out of X(-1,1),Y(-1,1),Z(0,1)\r\n\t}\r\n    gl_Position = remapPositionZ(gl_Position);\r\n\t#ifdef FOG\r\n        FogHandle(gl_Position.z);\r\n    #endif\r\n}\r\n","#define SHADER_NAME ParticleFS\r\n\r\n#include \"Scene.glsl\";\r\n#include \"SceneFog.glsl\";\r\n#include \"Color.glsl\";\r\n\r\nconst vec4 c_ColorSpace = vec4(4.59479380, 4.59479380, 4.59479380, 2.0);\r\n\r\nvarying vec4 v_Color;\r\nvarying vec2 v_TextureCoordinate;\r\n// uniform sampler2D u_texture;\r\n// uniform vec4 u_Tintcolor;\r\n\r\n#ifdef RENDERMODE_MESH\r\nvarying vec4 v_MeshColor;\r\n#endif\r\n\r\nvoid main()\r\n{\r\n    vec4 color;\r\n#ifdef RENDERMODE_MESH\r\n    color = v_MeshColor;\r\n#else\r\n    color = vec4(1.0);\r\n#endif\r\n\r\n#ifdef DIFFUSEMAP\r\n    vec4 colorT = texture2D(u_texture, v_TextureCoordinate);\r\n    #ifdef Gamma_u_texture\r\n    colorT = gammaToLinear(colorT);\r\n    #endif // Gamma_u_SpecularTexture\r\n    #ifdef TINTCOLOR\r\n    color *= colorT * u_Tintcolor * c_ColorSpace * v_Color;\r\n    #else\r\n    color *= colorT * v_Color;\r\n    #endif // TINTCOLORd\r\n#else\r\n    #ifdef TINTCOLOR\r\n    color *= u_Tintcolor * c_ColorSpace * v_Color;\r\n    #else\r\n    color *= v_Color;\r\n    #endif // TINTCOLOR\r\n#endif\r\n\r\n#ifdef ALPHATEST\r\n    if (color.a < u_AlphaTestValue)\r\n\t{\r\n\t    discard;\r\n\t}\r\n#endif // ALPHATEST\r\n\r\n\r\n#ifdef FOG\r\n    color.rgb = scenUnlitFog(color.rgb);\r\n#endif // FOG\r\n    gl_FragColor = color;\r\n\r\n    gl_FragColor = outputTransform(gl_FragColor);\r\n}","import { Shader3D, ShaderFeatureType } from \"../../../RenderEngine/RenderShader/Shader3D\";\r\nimport { ShaderDataType } from \"../../../RenderEngine/RenderShader/ShaderData\";\r\nimport SkyProceduralVS from \"./SkyProceduralShader.vs\";\r\nimport SkyProceduralFS from \"./SkyProceduralShader.fs\";\r\nimport { Color } from \"../../../maths/Color\";\r\nimport { RenderState } from \"../../../RenderEngine/RenderShader/RenderState\";\r\nimport { AttributeMapType, SubShader } from \"../../../RenderEngine/RenderShader/SubShader\";\r\nimport { VertexMesh } from \"../../../RenderEngine/RenderShader/VertexMesh\";\r\nimport { CullMode } from \"../../../RenderEngine/RenderEnum/CullMode\";\r\n\r\nexport class SkyProceduralShaderInit {\r\n    static init() {\r\n        let attributeMap: AttributeMapType = {\r\n            \"a_Position\": [VertexMesh.MESH_POSITION0, ShaderDataType.Vector4]\r\n        };\r\n\r\n        let uniformMap = {\r\n            \"u_SunSize\": ShaderDataType.Float,\r\n            \"u_SunSizeConvergence\": ShaderDataType.Float,\r\n            \"u_AtmosphereThickness\": ShaderDataType.Float,\r\n            \"u_SkyTint\": ShaderDataType.Color,\r\n            \"u_GroundTint\": ShaderDataType.Color,\r\n            \"u_Exposure\": ShaderDataType.Float,\r\n        };\r\n\r\n        let defaultValue = {\r\n            \"u_SunSize\": 0.04,\r\n            \"u_SunSizeConvergence\": 5,\r\n            \"u_AtmosphereThickness\": 1.0,\r\n            \"u_SkyTint\": new Color(0.5, 0.5, 0.5, 1.0),\r\n            \"u_GroundTint\": new Color(0.369, 0.349, 0.341, 1.0),\r\n            \"u_Exposure\": 1.3,\r\n        };\r\n        let shader = Shader3D.add(\"SkyProcedural\");\r\n        shader.shaderType = ShaderFeatureType.Sky;\r\n        let subShader = new SubShader(attributeMap, uniformMap, defaultValue);\r\n        shader.addSubShader(subShader);\r\n        let pass = subShader.addShaderPass(SkyProceduralVS, SkyProceduralFS);\r\n        pass.renderState.depthTest = RenderState.DEPTHTEST_LEQUAL;\r\n        pass.renderState.cull = CullMode.Back;\r\n        pass.renderState.depthWrite = false;\r\n        pass.renderState.stencilWrite = false;\r\n        pass.statefirst = true;\r\n    }\r\n}","#define SHADER_NAME SkyProceduralVS\r\n\r\n#include \"Camera.glsl\";\r\n\r\nconst float c_deg2ang = 3.141593 / 180.0;\r\n\r\n#define OUTER_RADIUS 1.025\r\n#define RAYLEIGH (mix(0.0, 0.0025, pow(u_AtmosphereThickness,2.5)))// Rayleigh constant Rayleigh\r\n#define MIE 0.0010             // Mie constant \r\n#define SUN_BRIGHTNESS 20.0    // Sun brightness\r\n#define MAX_SCATTER 50.0 // Maximum scattering value, to prevent math overflows on Adrenos\r\n\r\nconst float SKY_GROUND_THRESHOLD = 0.02;\r\nconst float outerRadius = OUTER_RADIUS;\r\nconst float outerRadius2 = OUTER_RADIUS*OUTER_RADIUS;\r\nconst float innerRadius = 1.0;\r\nconst float innerRadius2 = 1.0;\r\nconst float cameraHeight = 0.0001;\r\n\r\nconst float HDSundiskIntensityFactor = 15.0;\r\nconst float simpleSundiskIntensityFactor = 27.0;\r\n\r\nconst float sunScale = 400.0 * SUN_BRIGHTNESS;\r\nconst float kmESun = MIE * SUN_BRIGHTNESS;\r\nconst float km4PI = MIE * 4.0 * 3.14159265;\r\nconst float scale = 1.0 / (OUTER_RADIUS - 1.0);\r\nconst float scaleDepth = 0.25;\r\nconst float scaleOverScaleDepth = (1.0 / (OUTER_RADIUS - 1.0)) / 0.25;\r\nconst float samples = 2.0; // THIS IS UNROLLED MANUALLY, DON'T TOUCH\r\n\r\n// RGB wavelengths        .35 (.62=158), .43 (.68=174), .525 (.75=190)\r\nconst vec3 c_DefaultScatteringWavelength = vec3(0.65, 0.57, 0.475);//\r\nconst vec3 c_VariableRangeForScatteringWavelength = vec3(0.15, 0.15, 0.15);//\r\n\r\n// uniform vec4 u_SkyTint;\r\n// uniform vec4 u_GroundTint;\r\n// uniform float u_Exposure;\r\n// uniform float u_AtmosphereThickness;\r\nvec4 skyRemapGLPositionZ(vec4 position){\r\n\tposition.z = position.w;\r\n\treturn position;\r\n}\r\n//sprite\r\nuniform vec3 u_SunLight_direction;\r\nuniform vec4 u_SunLight_color;\r\n\r\nvarying vec3 v_GroundColor;\r\nvarying vec3 v_SkyColor;\r\n\r\n#ifdef SUN_HIGH_QUALITY\r\n\tvarying vec3 v_Vertex;\r\n#elif defined(SUN_SIMPLE)\r\n\tvarying vec3 v_RayDir;\r\n#else\r\n\tvarying float v_SkyGroundFactor;\r\n#endif\r\n\r\n#if defined(SUN_HIGH_QUALITY)||defined(SUN_SIMPLE)\r\n\tvarying vec3 v_SunColor;\r\n#endif\r\n\r\n// Calculates the Rayleigh phase function\r\nfloat getRayleighPhase(vec3 light, vec3 ray) \r\n{\r\n\tfloat eyeCos = dot(light, ray);\r\n\treturn 0.75 + 0.75*eyeCos*eyeCos;\r\n}\r\n\r\nfloat scaleAngle(float inCos)\r\n{\r\n\tfloat x = 1.0 - inCos;\r\n\treturn 0.25 * exp(-0.00287 + x*(0.459 + x*(3.83 + x*(-6.80 + x*5.25))));\r\n}\r\n\r\n\r\nvoid main(){\r\n    gl_Position = u_ViewProjection*a_Position;\r\n\r\n    vec3 skyTintInGammaSpace = pow(u_SkyTint.xyz,vec3(0.45));//u_SkyTint.xyz;//GAMMA\r\n\tvec3 scatteringWavelength = mix(c_DefaultScatteringWavelength-c_VariableRangeForScatteringWavelength,c_DefaultScatteringWavelength+c_VariableRangeForScatteringWavelength,vec3(1.0) - skyTintInGammaSpace); // using Tint in sRGB+ gamma allows for more visually linear interpolation and to keep (0.5) at (128, gray in sRGB) point\r\n\tvec3 invWavelength = 1.0 / pow(scatteringWavelength, vec3(4.0));\r\n\r\n\tfloat krESun = RAYLEIGH * SUN_BRIGHTNESS;\r\n\tfloat kr4PI = RAYLEIGH * 4.0 * 3.14159265;\r\n\r\n\tvec3 cameraPos = vec3(0.0,innerRadius + cameraHeight,0.0); // The camera's current position\r\n\r\n\t// Get the ray from the camera to the vertex and its length (which is the far point of the ray passing through the atmosphere)\r\n\tvec3 eyeRay = normalize(a_Position.xyz);\r\n\r\n\tfloat far = 0.0;\r\n\tvec3 cIn, cOut;\r\n\tif (eyeRay.y >= 0.0) {// Sky\r\n\t\t// Calculate the length of the \"atmosphere\"\r\n\t\tfar = sqrt(outerRadius2 + innerRadius2 * eyeRay.y * eyeRay.y - innerRadius2) - innerRadius * eyeRay.y;\r\n\r\n\t\t// Calculate the ray's starting position, then calculate its scattering offset\r\n\t\tfloat height = innerRadius + cameraHeight;\r\n\t\tfloat depth = exp(scaleOverScaleDepth * -cameraHeight);\r\n\t\tfloat startAngle = dot(eyeRay, cameraPos) / height;\r\n\t\tfloat startOffset = depth*scaleAngle(startAngle);\r\n\r\n\t\t// Initialize the scattering loop variables\r\n\t\tfloat sampleLength = far / samples;\r\n\t\tfloat scaledLength = sampleLength * scale;\r\n\t\tvec3 sampleRay = eyeRay * sampleLength;\r\n\t\tvec3 samplePoint = cameraPos + sampleRay * 0.5;\r\n\r\n\t\tvec3 frontColor = vec3(0.0);\r\n\t\t//unrolling this manually to avoid some platform for loop slow\r\n\t\t{\r\n\t\t\tfloat height = length(samplePoint);\r\n\t\t\tfloat depth = exp(scaleOverScaleDepth * (innerRadius - height));\r\n\t\t\tfloat lightAngle = dot(-u_SunLight_direction, samplePoint) / height;\r\n\t\t\tfloat cameraAngle = dot(eyeRay, samplePoint) / height;\r\n\t\t\tfloat scatter = (startOffset + depth*(scaleAngle(lightAngle) - scaleAngle(cameraAngle)));\r\n\t\t\tvec3 attenuate = exp(-clamp(scatter, 0.0, MAX_SCATTER) * (invWavelength * kr4PI + km4PI));\r\n\r\n\t\t\tfrontColor += attenuate * (depth * scaledLength);\r\n\t\t\tsamplePoint += sampleRay;\r\n\t\t}\r\n\t\t{\r\n\t\t\tfloat height = length(samplePoint);\r\n\t\t\tfloat depth = exp(scaleOverScaleDepth * (innerRadius - height));\r\n\t\t\tfloat lightAngle = dot(-u_SunLight_direction, samplePoint) / height;\r\n\t\t\tfloat cameraAngle = dot(eyeRay, samplePoint) / height;\r\n\t\t\tfloat scatter = (startOffset + depth*(scaleAngle(lightAngle) - scaleAngle(cameraAngle)));\r\n\t\t\tvec3 attenuate = exp(-clamp(scatter, 0.0, MAX_SCATTER) * (invWavelength * kr4PI + km4PI));\r\n\r\n\t\t\tfrontColor += attenuate * (depth * scaledLength);\r\n\t\t\tsamplePoint += sampleRay;\r\n\t\t}\r\n\r\n\t\t// Finally, scale the Mie and Rayleigh colors and set up the varying variables for the pixel shader\r\n\t\tcIn = frontColor * (invWavelength * krESun);\r\n\t\tcOut = frontColor * kmESun;\r\n\t} else {// Ground\r\n\t\tfar = (-cameraHeight) / (min(-0.001, eyeRay.y));\r\n\t\tvec3 pos = cameraPos + far * eyeRay;\r\n\r\n\t\t// Calculate the ray's starting position, then calculate its scattering offset\r\n\t\tfloat depth = exp((-cameraHeight) * (1.0/scaleDepth));\r\n\t\tfloat cameraAngle = dot(-eyeRay, pos);\r\n\t\tfloat lightAngle = dot(-u_SunLight_direction, pos);\r\n\t\tfloat cameraScale = scaleAngle(cameraAngle);\r\n\t\tfloat lightScale = scaleAngle(lightAngle);\r\n\t\tfloat cameraOffset = depth*cameraScale;\r\n\t\tfloat temp = lightScale + cameraScale;\r\n\r\n\t\t// Initialize the scattering loop variables\r\n\t\tfloat sampleLength = far / samples;\r\n\t\tfloat scaledLength = sampleLength * scale;\r\n\t\tvec3 sampleRay = eyeRay * sampleLength;\r\n\t\tvec3 samplePoint = cameraPos + sampleRay * 0.5;\r\n\r\n\t\t// Now loop through the sample rays\r\n\t\tvec3 frontColor = vec3(0.0, 0.0, 0.0);\r\n\t\tvec3 attenuate;\r\n\r\n\t\t// Loop removed because we kept hitting SM2.0 temp variable limits. Doesn't affect the image too much.\r\n\t\t{\r\n\t\t\tfloat height = length(samplePoint);\r\n\t\t\tfloat depth = exp(scaleOverScaleDepth * (innerRadius - height));\r\n\t\t\tfloat scatter = depth*temp - cameraOffset;\r\n\t\t\tattenuate = exp(-clamp(scatter, 0.0, MAX_SCATTER) * (invWavelength * kr4PI + km4PI));\r\n\t\t\tfrontColor += attenuate * (depth * scaledLength);\r\n\t\t\tsamplePoint += sampleRay;\r\n\t\t}\r\n\r\n\t\tcIn = frontColor * (invWavelength * krESun + kmESun);\r\n\t\tcOut = clamp(attenuate, 0.0, 1.0);\r\n\t}\r\n\r\n\t#ifdef SUN_HIGH_QUALITY\r\n\t\tv_Vertex = -a_Position.xyz;\r\n\t#elif defined(SUN_SIMPLE) \r\n\t\tv_RayDir = -eyeRay;\r\n\t#else\r\n\t\tv_SkyGroundFactor = -eyeRay.y / SKY_GROUND_THRESHOLD;\r\n\t#endif\r\n\r\n\t// if we want to calculate color in vprog:\r\n\t// in case of linear: multiply by _Exposure in here (even in case of lerp it will be common multiplier, so we can skip mul in fshader)\r\n\tv_GroundColor = u_Exposure * (cIn + u_GroundTint.xyz * cOut);//u_GroundColor*u_GroundColor is gamma space convert to linear space\r\n\tv_SkyColor    = u_Exposure * (cIn * getRayleighPhase(-u_SunLight_direction, -eyeRay));\r\n\r\n\t\r\n\t// The sun should have a stable intensity in its course in the sky. Moreover it should match the highlight of a purely specular material.\r\n\t// This matching was done using the Unity3D standard shader BRDF1 on the 5/31/2017\r\n\t// Finally we want the sun to be always bright even in LDR thus the normalization of the lightColor for low intensity.\r\n\tfloat lightColorIntensity = clamp(length(u_SunLight_color.xyz), 0.25, 1.0);\r\n\r\n\t#ifdef SUN_HIGH_QUALITY \r\n\t\tv_SunColor = HDSundiskIntensityFactor * clamp(cOut,0.0,1.0) * u_SunLight_color.xyz / lightColorIntensity;\r\n\t#elif defined(SUN_SIMPLE) \r\n\t\tv_SunColor = simpleSundiskIntensityFactor * clamp(cOut * sunScale,0.0,1.0) * u_SunLight_color.xyz / lightColorIntensity;\r\n\t#endif\r\n\tgl_Position=skyRemapGLPositionZ(gl_Position);\r\n}","#define SHADER_NAME SkyProceduralFS\r\n\r\n#include \"Color.glsl\";\r\n\r\nconst float MIE_G = -0.990;\r\nconst float MIE_G2 = 0.9801;\r\nconst float SKY_GROUND_THRESHOLD = 0.02;\r\n\r\n// uniform float u_SunSize;\r\n// uniform float u_SunSizeConvergence;\r\n\r\nuniform vec3 u_SunLight_direction;\r\n\r\nvarying vec3 v_GroundColor;\r\nvarying vec3 v_SkyColor;\r\n\r\n#ifdef SUN_HIGH_QUALITY\r\nvarying vec3 v_Vertex;\r\n#elif defined(SUN_SIMPLE)\r\nvarying vec3 v_RayDir;\r\n#else\r\nvarying float v_SkyGroundFactor;\r\n#endif\r\n\r\n#if defined(SUN_HIGH_QUALITY) || defined(SUN_SIMPLE)\r\nvarying vec3 v_SunColor;\r\n#endif\r\n\r\n// Calculates the Mie phase function\r\nfloat getMiePhase(float eyeCos, float eyeCos2)\r\n{\r\n    float temp = 1.0 + MIE_G2 - 2.0 * MIE_G * eyeCos;\r\n    temp = pow(temp, pow(u_SunSize, 0.65) * 10.0);\r\n    temp = max(temp, 1.0e-4); // prevent division by zero, esp. in half precision\r\n    temp = 1.5 * ((1.0 - MIE_G2) / (2.0 + MIE_G2)) * (1.0 + eyeCos2) / temp;\r\n    return temp;\r\n}\r\n\r\n// Calculates the sun shape\r\nfloat calcSunAttenuation(vec3 lightPos, vec3 ray)\r\n{\r\n#ifdef SUN_HIGH_QUALITY\r\n    float focusedEyeCos = pow(clamp(dot(lightPos, ray), 0.0, 1.0), u_SunSizeConvergence);\r\n    return getMiePhase(-focusedEyeCos, focusedEyeCos * focusedEyeCos);\r\n#else // SUN_SIMPLE\r\n    vec3 delta = lightPos - ray;\r\n    float dist = length(delta);\r\n    float spot = 1.0 - smoothstep(0.0, u_SunSize, dist);\r\n    return spot * spot;\r\n#endif\r\n}\r\n\r\nvoid main()\r\n{\r\n    // if y > 1 [eyeRay.y < -SKY_GROUND_THRESHOLD] - ground\r\n    // if y >= 0 and < 1 [eyeRay.y <= 0 and > -SKY_GROUND_THRESHOLD] - horizon\r\n    // if y < 0 [eyeRay.y > 0] - sky\r\n    vec3 col = vec3(0.0, 0.0, 0.0);\r\n\r\n#ifdef SUN_HIGH_QUALITY\r\n    vec3 ray = normalize(v_Vertex);\r\n    float y = ray.y / SKY_GROUND_THRESHOLD;\r\n#elif defined(SUN_SIMPLE)\r\n    vec3 ray = v_RayDir;\r\n    float y = ray.y / SKY_GROUND_THRESHOLD;\r\n#else\r\n    float y = v_SkyGroundFactor;\r\n#endif\r\n\r\n    // if we did precalculate color in vprog: just do lerp between them\r\n    col = mix(v_SkyColor, v_GroundColor, clamp(y, 0.0, 1.0));\r\n\r\n#if defined(SUN_HIGH_QUALITY) || defined(SUN_SIMPLE)\r\n    if (y < 0.0)\r\n\tcol += v_SunColor * calcSunAttenuation(-u_SunLight_direction, -ray);\r\n#endif\r\n\r\n    // col = sqrt(col);//linear space convert to gamma space\r\n    gl_FragColor = vec4(col, 1.0);\r\n\r\n    gl_FragColor = outputTransform(gl_FragColor);\r\n}\r\n","import { Shader3D, ShaderFeatureType } from \"../../../RenderEngine/RenderShader/Shader3D\";\r\nimport { ShaderDataType } from \"../../../RenderEngine/RenderShader/ShaderData\";\r\nimport SkyPanoramicVS from \"./SkyPanoramic.vs\";\r\nimport SkyPanoramicFS from \"./SkyPanoramic.fs\";\r\nimport { Texture2D } from \"../../../resource/Texture2D\";\r\nimport { Color } from \"../../../maths/Color\";\r\nimport { Vector4 } from \"../../../maths/Vector4\";\r\nimport { RenderState } from \"../../../RenderEngine/RenderShader/RenderState\";\r\nimport { AttributeMapType, SubShader } from \"../../../RenderEngine/RenderShader/SubShader\";\r\nimport { VertexMesh } from \"../../../RenderEngine/RenderShader/VertexMesh\";\r\nimport { CullMode } from \"../../../RenderEngine/RenderEnum/CullMode\";\r\n\r\nexport class SkyPanoramicShaderInit {\r\n    static init() {\r\n        let attributeMap: AttributeMapType = {\r\n            \"a_Position\": [VertexMesh.MESH_POSITION0, ShaderDataType.Vector4]\r\n        };\r\n\r\n        let uniformMap = {\r\n            'u_TintColor': ShaderDataType.Color,\r\n            'u_Rotation': ShaderDataType.Float,\r\n            'u_Texture': ShaderDataType.Texture2D,\r\n            'u_Exposure':ShaderDataType.Float,\r\n        };\r\n\r\n        let defaultValue = {\r\n            'u_TintColor': new Color(0.5,0.5,0.5,1.0),\r\n            'u_Exposure': 1.3,\r\n            'u_Rotation': 0,\r\n            'u_Texture': Texture2D.grayTexture,\r\n        };\r\n        let shader = Shader3D.add(\"SkyPanoramic\");\r\n        shader.shaderType = ShaderFeatureType.Sky;\r\n        let subShader = new SubShader(attributeMap, uniformMap, defaultValue);\r\n        shader.addSubShader(subShader);\r\n        let pass = subShader.addShaderPass(SkyPanoramicVS, SkyPanoramicFS);\r\n        pass.renderState.depthTest = RenderState.DEPTHTEST_LEQUAL;\r\n        pass.renderState.cull = CullMode.Back;\r\n        pass.renderState.depthWrite = false;\r\n        pass.renderState.stencilWrite = false;\r\n        pass.statefirst = true;\r\n    }\r\n}","#define SHADER_NAME SkyPanoramicVS\r\n\r\n#include \"Camera.glsl\";\r\n#define PI 3.14159265359\r\n\r\n//attribute vec4 a_Position;\r\n\r\n//uniform float u_Rotation;\r\n\r\nvarying vec3 v_Texcoord;\r\nvarying vec2 v_Image180ScaleAndCutoff;\r\nvarying vec4 v_Layout3DScaleAndOffset;\r\n\r\nvec4 skyRemapGLPositionZ(vec4 position){\r\n\tposition.z = position.w;\r\n\treturn position;\r\n}\r\n\r\nvec4 rotateAroundYInDegrees (vec4 vertex, float degrees)\r\n{\r\n\tfloat angle = degrees * PI / 180.0;\r\n\tfloat sina=sin(angle);\r\n\tfloat cosa=cos(angle);\r\n\tmat2 m = mat2(cosa, -sina, sina, cosa);\r\n\treturn vec4(m*vertex.xz, vertex.yw).xzyw;\r\n}\r\n\t\r\nvoid main()\r\n{\r\n\tvec4 position = rotateAroundYInDegrees(a_Position, u_Rotation);\r\n\t\r\n\r\n\tv_Texcoord=vec3(-a_Position.x,-a_Position.y,a_Position.z);// NOTE: -a_Position.x convert coords system\r\n\r\n\t// Calculate constant horizontal scale and cutoff for 180 (vs 360) image type\r\n\tv_Image180ScaleAndCutoff = vec2(1.0, 1.0);// 360 degree mode\r\n\r\n\t// Calculate constant scale and offset for 3D layouts\r\n\tv_Layout3DScaleAndOffset = vec4(0,0,1,1);\r\n\tgl_Position = u_ViewProjection*position;\r\n\tgl_Position=skyRemapGLPositionZ(gl_Position);\r\n\r\n}\r\n","#define SHADER_NAME SkyPanoramicVS\r\n\r\n#include \"Color.glsl\";\r\n\r\nvarying vec3 v_Texcoord;\r\nvarying vec2 v_Image180ScaleAndCutoff;\r\nvarying vec4 v_Layout3DScaleAndOffset;\r\nconst vec4 c_ColorSpace = vec4(4.59479380, 4.59479380, 4.59479380, 2.0);\r\n\r\nvec2 ToRadialCoords(vec3 coords)\r\n{\r\n    vec3 normalizedCoords = normalize(coords);\r\n    float latitude = acos(normalizedCoords.y);\r\n    float longitude = atan(normalizedCoords.z, normalizedCoords.x);\r\n    vec2 sphereCoords = vec2(longitude, latitude) * vec2(0.5 / PI, 1.0 / PI);\r\n    return vec2(0.5, 1.0) - sphereCoords;\r\n}\r\n\r\nvoid main()\r\n{\r\n    vec2 tc = ToRadialCoords(v_Texcoord);\r\n    if (tc.x > v_Image180ScaleAndCutoff.y)\r\n\tgl_FragColor = vec4(0, 0, 0, 1);\r\n    tc.x = mod(tc.x * v_Image180ScaleAndCutoff.x, 1.0);\r\n    tc = (tc + v_Layout3DScaleAndOffset.xy) * v_Layout3DScaleAndOffset.zw;\r\n\r\n    mediump vec4 tex = texture2D(u_Texture, tc);\r\n#ifdef Gamma_u_Texture\r\n    tex = gammaToLinear(tex);\r\n#endif // Gamma_u_Texture\r\n    mediump vec3 c = tex.xyz;\r\n    c = c * u_TintColor.rgb * c_ColorSpace.rgb;\r\n    c *= pow(u_Exposure, 2.2);\r\n    gl_FragColor = vec4(c, 1.0);\r\n\r\n    gl_FragColor = outputTransform(gl_FragColor);\r\n}\r\n","import { Shader3D } from \"../../../../RenderEngine/RenderShader/Shader3D\";\r\n\r\nimport UtillitiesColorGLSL from \"./lib/UtillitiesColor.glsl\";\r\nimport TransformCommonGLSL from \"./lib/TransformCommon.glsl\";\r\nimport RRTCommonGLSL from \"./lib/RRTCommon.glsl\";\r\nimport ODTCommonGLSL from \"./lib/ODTCommon.glsl\";\r\nimport TonescalesGLSL from \"./lib/Tonescales.glsl\";\r\n\r\nimport RRTGLSL from \"./rrt/RRT.glsl\";\r\nimport ODT_sRGB_100nits_GLSL from \"./odt/ODT_sRGB_100nits.glsl\";\r\n\r\nimport ACESGLSL from \"./ACES.glsl\";\r\n\r\nexport class ACESShaderLib {\r\n\r\n    static init() {\r\n        Shader3D.addInclude(\"ACES_UtillitiesColor.glsl\", UtillitiesColorGLSL);\r\n        Shader3D.addInclude(\"ACES_TransformCommon.glsl\", TransformCommonGLSL);\r\n        Shader3D.addInclude(\"ACES_Tonescales.glsl\", TonescalesGLSL);\r\n        Shader3D.addInclude(\"ACES_RRTCommon.glsl\", RRTCommonGLSL);\r\n        Shader3D.addInclude(\"ACES_ODTCommon.glsl\", ODTCommonGLSL);\r\n\r\n        Shader3D.addInclude(\"ACES_RRT.glsl\", RRTGLSL);\r\n        Shader3D.addInclude(\"ACES_ODT_sRGB_100nits.glsl\", ODT_sRGB_100nits_GLSL);\r\n\r\n        Shader3D.addInclude(\"ACES.glsl\", ACESGLSL);\r\n    }\r\n\r\n}","#if !defined(UtillitiesColor_lib)\r\n#define UtillitiesColor_lib\r\n\r\n// Transformations between CIE XYZ tristimulus values and CIE x,y\r\n// chromaticity coordinates\r\nvec3 XYZ_2_xyY(vec3 XYZ)\r\n{\r\n    vec3 xyY;\r\n    float divisor = max(XYZ.x + XYZ.y + XYZ.z, 1e-10);\r\n    xyY.x = XYZ.x / divisor;\r\n    xyY.y = XYZ.y / divisor;\r\n    xyY.z = XYZ.y;\r\n    return xyY;\r\n}\r\n\r\nvec3 xyY_2_XYZ(vec3 xyY)\r\n{\r\n    vec3 XYZ;\r\n    XYZ.x = xyY.x * xyY.z / max(xyY.y, 1e-10);\r\n    XYZ.y = xyY.z;\r\n    XYZ.z = (1.0 - xyY.x - xyY.y) * xyY.z / max(xyY.y, 1e-10);\r\n    return XYZ;\r\n}\r\n\r\nfloat rgb_2_yc(vec3 rgb, float ycRadiusWeight)\r\n{\r\n    float r = rgb.r;\r\n    float g = rgb.g;\r\n    float b = rgb.b;\r\n    float k = b * (b - g) + g * (g - r) + r * (r - b);\r\n    k = max(MEDIUMP_FLT_MIN, k);\r\n    float chroma = sqrt(k);\r\n    return (b + g + r + ycRadiusWeight * chroma) / 3.0;\r\n}\r\n\r\nfloat rgb_2_yc(vec3 rgb)\r\n{\r\n    return rgb_2_yc(rgb, 1.75);\r\n}\r\n\r\n// Transformations from RGB to other color representations\r\n\r\n// Returns a geometric hue angle in degrees (0-360) based on RGB values.\r\nfloat rgb_2_hue(vec3 rgb)\r\n{\r\n    float hue;\r\n    // For neutral colors, hue is undefined and the function will return a quiet NaN value.\r\n    // if (rgb.r == rgb.g && rgb.g == rgb.b) {\r\n    //     // hue = FLT_NAN;\r\n    //     // todo FLT_NAN\r\n    //     hue = 0.0;\r\n    // } else {\r\n    //     hue = (180.0 * INVERT_PI) * atan2(sqrt(3.0) * (rgb.g - rgb.b), 2.0 * rgb.r - rgb.g - rgb.b);\r\n    // }\r\n    if (rgb.x == rgb.y && rgb.y == rgb.z)\r\n        hue = 0.0; // RGB triplets where RGB are equal have an undefined hue\r\n    else\r\n        hue = (180.0 * INVERT_PI) * atan(sqrt(3.0) * (rgb.y - rgb.z), 2.0 * rgb.x - rgb.y - rgb.z);\r\n\r\n    if (hue < 0.0) {\r\n        hue = hue + 360.0;\r\n    }\r\n\r\n    return hue;\r\n}\r\n\r\n#endif // UtillitiesColor_lib","#if !defined(TransformCommon_lib)\r\n    #define TransformCommon_lib\r\n\r\nconst float TINY = 1e-10;\r\n\r\n// sRGB D65 to AP0 D60\r\n// https://www.colour-science.org:8010/apps/rgb_colourspace_transformation_matrix CAT 02\r\nconst mat3 sRGB_to_AP0_MAT = mat3(\r\n    vec3(0.4395856442, 0.0895395735, 0.0173871832),\r\n    vec3(0.3839294030, 0.8147498351, 0.1087391143),\r\n    vec3(0.1765327364, 0.0956836061, 0.8738205876));\r\n\r\n// sRGB D65 to AP1 D60\r\n// https://www.colour-science.org:8010/apps/rgb_colourspace_transformation_matrix CAT 02\r\nconst mat3 sRGB_to_AP1_MAT = mat3(\r\n    vec3(0.6131178129, 0.0699340823, 0.0204629926),\r\n    vec3(0.3411819959, 0.9181030375, 0.1067686634),\r\n    vec3(0.0457873443, 0.0119327755, 0.8727159106));\r\n\r\nconst mat3 AP1_to_XYZ_MAT = mat3(\r\n    vec3(0.6624541811, 0.2722287168, -0.0055746495),\r\n    vec3(0.1340042065, 0.6740817658, 0.0040607335),\r\n    vec3(0.1561876870, 0.0536895174, 1.0103391003));\r\n\r\nconst mat3 AP0_to_AP1_MAT = mat3(\r\n    vec3(1.4514393161, -0.0765537734, 0.0083161484),\r\n    vec3(-0.2365107469, 1.1762296998, -0.0060324498),\r\n    vec3(-0.2149285693, -0.0996759264, 0.9977163014));\r\n\r\nconst mat3 AP1_to_AP0_MAT = mat3(\r\n    vec3(0.6954522414, 0.0447945634, -0.0055258826),\r\n    vec3(0.1406786965, 0.8596711185, 0.0040252103),\r\n    vec3(0.1638690622, 0.0955343182, 1.0015006723));\r\n\r\nconst mat3 XYZ_to_AP1_MAT = mat3(\r\n    vec3(1.6410233797, -0.6636628587, 0.0117218943),\r\n    vec3(-0.3248032942, 1.6153315917, -0.0082844420),\r\n    vec3(-0.2364246952, 0.0167563477, 0.9883948585));\r\n\r\nconst vec3 AP1_RGB2Y = vec3(0.2722287168, 0.6740817658, 0.0536895174);\r\n\r\nfloat ACES_to_ACEScc(float x)\r\n{\r\n    // if (x <= 0.0)\r\n    // return -0.35828683;\r\n    // else if (x < pow(2.0, -15.0))\r\n    // return (log2(pow(2.0, -16.0) + x * 0.5) + 9.72) / 17.52;\r\n    // else\r\n    // return (log2(x) + 9.72) / 17.52;\r\n\r\n    return (x < 0.00003051757) ? (log2(0.00001525878 + x * 0.5) + 9.72) / 17.52 : (log2(x) + 9.72) / 17.52;\r\n}\r\n\r\nvec3 ACES_to_ACEScc(vec3 x)\r\n{\r\n    x = clamp(x, vec3(0.0), vec3(MEDIUMP_FLT_MAX));\r\n    x.x = ACES_to_ACEScc(x.x);\r\n    x.y = ACES_to_ACEScc(x.y);\r\n    x.z = ACES_to_ACEScc(x.z);\r\n\r\n    return x;\r\n}\r\n\r\nfloat ACEScc_to_ACES(float x)\r\n{\r\n    if (x < -0.3013698630)\r\n\treturn (pow(2.0, x * 17.52 - 9.72) - pow(2.0, -16.0)) * 2.0;\r\n    else if (x < (log2(MEDIUMP_FLT_MAX) + 9.72) / 17.52)\r\n\treturn pow(2.0, x * 17.52 - 9.72);\r\n    else\r\n\treturn MEDIUMP_FLT_MAX;\r\n}\r\n\r\nvec3 ACEScc_to_ACES(vec3 x)\r\n{\r\n    x.x = ACEScc_to_ACES(x.x);\r\n    x.y = ACEScc_to_ACES(x.y);\r\n    x.z = ACEScc_to_ACES(x.z);\r\n    return x;\r\n}\r\n\r\nfloat rgb_2_saturation(vec3 rgb)\r\n{\r\n    float rgbmax = vecmax(rgb);\r\n    float rgbmin = vecmin(rgb);\r\n    return (max(rgbmax, TINY) - max(rgbmin, TINY)) / max(rgbmax, 1e-2);\r\n}\r\n\r\n#endif // TransformCommon_lib","#if !defined(Tonescales_lib)\r\n#define Tonescales_lib\r\n\r\nconst mat3 M = mat3(\r\n    vec3(0.5, -1.0, 0.5),\r\n    vec3(-1.0, 1.0, 0.5),\r\n    vec3(0.5, 0.0, 0.0));\r\n\r\nfloat segmented_spline_c5_fwd(float x)\r\n{\r\n#ifdef GRAPHICS_API_GLES3\r\n    const float coefsLow[6] = float[6](-4.0000000000, -4.0000000000, -3.1573765773, -0.4852499958, 1.8477324706, 1.8477324706);\r\n    const float coefsHigh[6] = float[6](-0.7185482425, 2.0810307172, 3.6681241237, 4.0000000000, 4.0000000000, 4.0000000000);\r\n#else\r\n    const float coefsLow_0 = -4.0000000000;\r\n    const float coefsLow_1 = -4.0000000000;\r\n    const float coefsLow_2 = -3.1573765773;\r\n    const float coefsLow_3 = -0.4852499958;\r\n    const float coefsLow_4 = 1.8477324706;\r\n    const float coefsLow_5 = 1.8477324706;\r\n\r\n    const float coefsHigh_0 = -0.7185482425;\r\n    const float coefsHigh_1 = 2.0810307172;\r\n    const float coefsHigh_2 = 3.6681241237;\r\n    const float coefsHigh_3 = 4.0000000000;\r\n    const float coefsHigh_4 = 4.0000000000;\r\n    const float coefsHigh_5 = 4.0000000000;\r\n#endif // GRAPHICS_API_GLES3\r\n\r\n    const vec2 minPoint = vec2(0.0000054931640625, 0.0001);\r\n    const vec2 midPoint = vec2(0.18, 4.8);\r\n    const vec2 maxPoint = vec2(47185.92, 10000.);\r\n    const float slopeLow = 0.0;\r\n    const float slopeHigh = 0.0;\r\n\r\n    const int N_KNOTS_LOW = 4;\r\n    const int N_KNOTS_HIGH = 4;\r\n\r\n    float logx = log10(max(x, MEDIUMP_FLT_MIN));\r\n    float logy;\r\n\r\n    if (logx <= log10(minPoint.x)) {\r\n        logy = logx * slopeLow + (log10(minPoint.y) - slopeLow * log10(minPoint.x));\r\n    } else if ((logx > log10(minPoint.x)) && (logx < log10(midPoint.x))) {\r\n        float knot_coord = float(N_KNOTS_LOW - 1) * (logx - log10(minPoint.x)) / (log10(midPoint.x) - log10(minPoint.x));\r\n        int j = int(knot_coord);\r\n        float t = knot_coord - float(j);\r\n        vec3 cf;\r\n#ifdef GRAPHICS_API_GLES3\r\n        cf = vec3(coefsLow[j], coefsLow[j + 1], coefsLow[j + 2]);\r\n#else\r\n        if (j <= 0) {\r\n            cf = vec3(coefsLow_0, coefsLow_1, coefsLow_2);\r\n        } else if (j == 1) {\r\n            cf = vec3(coefsLow_1, coefsLow_2, coefsLow_3);\r\n        } else if (j == 2) {\r\n            cf = vec3(coefsLow_2, coefsLow_3, coefsLow_4);\r\n        } else { // if (j == 3)\r\n            cf = vec3(coefsLow_3, coefsLow_4, coefsLow_5);\r\n        }\r\n#endif // GRAPHICS_API_GLES3\r\n\r\n        vec3 monomials = vec3(t * t, t, 1.);\r\n        logy = dot(monomials, M * cf);\r\n    } else if ((logx >= log10(midPoint.x)) && (logx < log10(maxPoint.x))) {\r\n        float knot_coord = float(N_KNOTS_HIGH - 1) * (logx - log10(midPoint.x)) / (log10(maxPoint.x) - log10(midPoint.x));\r\n        int j = int(knot_coord);\r\n        float t = knot_coord - float(j);\r\n        vec3 cf;\r\n#ifdef GRAPHICS_API_GLES3\r\n        cf = vec3(coefsHigh[j], coefsHigh[j + 1], coefsHigh[j + 2]);\r\n#else\r\n        if (j <= 0) {\r\n            cf = vec3(coefsHigh_0, coefsHigh_1, coefsHigh_2);\r\n        } else if (j == 1) {\r\n            cf = vec3(coefsHigh_1, coefsHigh_2, coefsHigh_3);\r\n        } else if (j == 2) {\r\n            cf = vec3(coefsHigh_2, coefsHigh_3, coefsHigh_4);\r\n        } else { // if (j == 3)\r\n            cf = vec3(coefsHigh_3, coefsHigh_4, coefsHigh_5);\r\n        }\r\n#endif // #ifdef GRAPHICS_API_GLES3\r\n        vec3 monomials = vec3(t * t, t, 1.);\r\n        logy = dot(monomials, M * cf);\r\n    } else {\r\n        logy = logx * slopeHigh + (log10(maxPoint.y) - slopeHigh * log10(maxPoint.x));\r\n    }\r\n    return pow(10.0, logy);\r\n}\r\n\r\nfloat segmented_spline_c9_fwd(float x)\r\n{\r\n// ODT_48nits\r\n#ifdef GRAPHICS_API_GLES3\r\n    const float coefsLow[10] = float[10](-1.6989700043, -1.6989700043, -1.4779000000, -1.2291000000, -0.8648000000, -0.4480000000, 0.0051800000, 0.4511080334, 0.9113744414, 0.9113744414);\r\n    const float coefsHigh[10] = float[10](0.5154386965, 0.8470437783, 1.1358000000, 1.3802000000, 1.5197000000, 1.5985000000, 1.6467000000, 1.6746091357, 1.6878733390, 1.6878733390);\r\n#else\r\n    const float coefsLow_0 = -1.6989700043;\r\n    const float coefsLow_1 = -1.6989700043;\r\n    const float coefsLow_2 = -1.4779000000;\r\n    const float coefsLow_3 = -1.2291000000;\r\n    const float coefsLow_4 = -0.8648000000;\r\n    const float coefsLow_5 = -0.4480000000;\r\n    const float coefsLow_6 = 0.0051800000;\r\n    const float coefsLow_7 = 0.4511080334;\r\n    const float coefsLow_8 = 0.9113744414;\r\n    const float coefsLow_9 = 0.9113744414;\r\n\r\n    const float coefsHigh_0 = 0.5154386965;\r\n    const float coefsHigh_1 = 0.8470437783;\r\n    const float coefsHigh_2 = 1.1358000000;\r\n    const float coefsHigh_3 = 1.3802000000;\r\n    const float coefsHigh_4 = 1.5197000000;\r\n    const float coefsHigh_5 = 1.5985000000;\r\n    const float coefsHigh_6 = 1.6467000000;\r\n    const float coefsHigh_7 = 1.6746091357;\r\n    const float coefsHigh_8 = 1.6878733390;\r\n    const float coefsHigh_9 = 1.6878733390;\r\n#endif // GRAPHICS_API_GLES3\r\n\r\n    // todo const\r\n    vec2 minPoint = vec2(segmented_spline_c5_fwd(0.18 * pow(2.0, -6.5)), 0.02);\r\n    vec2 midPoint = vec2(segmented_spline_c5_fwd(0.18), 4.8);\r\n    vec2 maxPoint = vec2(segmented_spline_c5_fwd(0.18 * pow(2., 6.5)), 48.0);\r\n\r\n    const float slopeLow = 0.0;\r\n    const float slopeHigh = 0.04;\r\n\r\n    const int N_KNOTS_LOW = 8;\r\n    const int N_KNOTS_HIGH = 8;\r\n\r\n    float logx = log10(max(x, MEDIUMP_FLT_MIN));\r\n    float logy;\r\n\r\n    if (logx <= log10(minPoint.x)) {\r\n        logy = logx * slopeLow + (log10(minPoint.y) - slopeLow * log10(minPoint.x));\r\n    } else if ((logx > log10(minPoint.x)) && (logx < log10(midPoint.x))) {\r\n        float knot_coord = float(N_KNOTS_LOW - 1) * (logx - log10(minPoint.x)) / (log10(midPoint.x) - log10(minPoint.x));\r\n        int j = int(knot_coord);\r\n        float t = knot_coord - float(j);\r\n        vec3 cf;\r\n#ifdef GRAPHICS_API_GLES3\r\n        cf = vec3(coefsLow[j], coefsLow[j + 1], coefsLow[j + 2]);\r\n#else\r\n        if (j <= 0) {\r\n            cf = vec3(coefsLow_0, coefsLow_1, coefsLow_2);\r\n        } else if (j == 1) {\r\n            cf = vec3(coefsLow_1, coefsLow_2, coefsLow_3);\r\n        } else if (j == 2) {\r\n            cf = vec3(coefsLow_2, coefsLow_3, coefsLow_4);\r\n        } else if (j == 3) {\r\n            cf = vec3(coefsLow_3, coefsLow_4, coefsLow_5);\r\n        } else if (j == 4) {\r\n            cf = vec3(coefsLow_4, coefsLow_5, coefsLow_6);\r\n        } else if (j == 5) {\r\n            cf = vec3(coefsLow_5, coefsLow_6, coefsLow_7);\r\n        } else if (j == 6) {\r\n            cf = vec3(coefsLow_6, coefsLow_7, coefsLow_8);\r\n        } else { // if (j == 7)\r\n            cf = vec3(coefsLow_7, coefsLow_8, coefsLow_9);\r\n        }\r\n#endif // GRAPHICS_API_GLES3\r\n        vec3 monomials = vec3(t * t, t, 1.0);\r\n        logy = dot(monomials, M * cf);\r\n    } else if ((logx >= log10(midPoint.x)) && (logx < log10(maxPoint.x))) {\r\n        float knot_coord = float(N_KNOTS_HIGH - 1) * (logx - log10(midPoint.x)) / (log10(maxPoint.x) - log10(midPoint.x));\r\n        int j = int(knot_coord);\r\n        float t = knot_coord - float(j);\r\n        vec3 cf;\r\n#ifdef GRAPHICS_API_GLES3\r\n        cf = vec3(coefsHigh[j], coefsHigh[j + 1], coefsHigh[j + 2]);\r\n#else\r\n        if (j <= 0) {\r\n            cf = vec3(coefsHigh_0, coefsHigh_1, coefsHigh_2);\r\n        } else if (j == 1) {\r\n            cf = vec3(coefsHigh_1, coefsHigh_2, coefsHigh_3);\r\n        } else if (j == 2) {\r\n            cf = vec3(coefsHigh_2, coefsHigh_3, coefsHigh_4);\r\n        } else if (j == 3) {\r\n            cf = vec3(coefsHigh_3, coefsHigh_4, coefsHigh_5);\r\n        } else if (j == 4) {\r\n            cf = vec3(coefsHigh_4, coefsHigh_5, coefsHigh_6);\r\n        } else if (j == 5) {\r\n            cf = vec3(coefsHigh_5, coefsHigh_6, coefsHigh_7);\r\n        } else if (j == 6) {\r\n            cf = vec3(coefsHigh_6, coefsHigh_7, coefsHigh_8);\r\n        } else { // if (j == 7)\r\n            cf = vec3(coefsHigh_7, coefsHigh_8, coefsHigh_9);\r\n        }\r\n#endif // GRAPHICS_API_GLES3\r\n        vec3 monomials = vec3(t * t, t, 1.0);\r\n        logy = dot(monomials, M * cf);\r\n    } else {\r\n        logy = logx * slopeHigh + (log10(maxPoint.y) - slopeHigh * log10(maxPoint.x));\r\n    }\r\n\r\n    return pow(10.0, logy);\r\n}\r\n\r\n#endif // Tonescales_lib","#if !defined(RRTCommon_lib)\r\n#define RRTCommon_lib\r\n\r\n// \"Glow\" module constants\r\nconst float RRT_GLOW_GAIN = 0.05;\r\nconst float RRT_GLOW_MID = 0.08;\r\n\r\n// Red modifier constants\r\nconst float RRT_RED_SCALE = 0.82;\r\nconst float RRT_RED_PIVOT = 0.03;\r\nconst float RRT_RED_HUE = 0.;\r\nconst float RRT_RED_WIDTH = 135.;\r\n\r\n// Desaturation contants\r\nconst float RRT_SAT_FACTOR = 0.96;\r\n\r\n// ------- Glow module functions\r\n\r\nfloat glow_fwd(float ycIn, float glowGainIn, float glowMid)\r\n{\r\n    float glowGainOut;\r\n    if (ycIn <= 2.0 / 3.0 * glowMid) {\r\n        glowGainOut = glowGainIn;\r\n    } else if (ycIn >= 2.0 * glowMid) {\r\n        glowGainOut = 0.0;\r\n    } else {\r\n        glowGainOut = glowGainIn * (glowMid / ycIn - 0.5);\r\n    }\r\n    return glowGainOut;\r\n}\r\n\r\n// Sigmoid function in the range 0 to 1 spanning -2 to +2.\r\nfloat sigmoid_shaper(float x)\r\n{\r\n    float t = max(1.0 - abs(x * 0.5), 0.0);\r\n    float y = 1.0 + sign(x) * (1.0 - t * t);\r\n\r\n    return y * 0.5;\r\n}\r\n\r\n// ------- Red modifier functions\r\nfloat center_hue(float hue, float centerH)\r\n{\r\n    float hueCentered = hue - centerH;\r\n    if (hueCentered < -180.0) {\r\n        hueCentered = hueCentered + 360.0;\r\n    } else if (hueCentered > 180.0) {\r\n        hueCentered -= 360.0;\r\n    }\r\n    return hueCentered;\r\n}\r\n\r\n#endif // RRTCommon_lib","#if !defined(ODTCommon_lib)\r\n#define ODTCommon_lib\r\n\r\nconst float CINEMA_WHITE = 48.0;\r\nconst float CINEMA_BLACK = 0.02; // CINEMA_WHITE / 2400.\r\n\r\n// Gamma compensation factor\r\nconst float DIM_SURROUND_GAMMA = 0.9811;\r\n\r\n// Saturation compensation factor\r\nconst float ODT_SAT_FACTOR = 0.93;\r\n\r\n// white point D60 to D65\r\n// ACES white point D60\r\nconst mat3 D60_to_D65_MAT = mat3(\r\n    vec3(0.987224, -0.00759836, 0.00307257),\r\n    vec3(-0.00611327, 1.00186, -0.00509595),\r\n    vec3(0.0159533, 0.00533002, 1.08168));\r\n\r\nfloat Y_2_linCV(float Y, float Ymax, float Ymin)\r\n{\r\n    return (Y - Ymin) / (Ymax - Ymin);\r\n}\r\n\r\nvec3 darkSurround_to_dimSurround(vec3 linearCV)\r\n{\r\n    vec3 XYZ = linearCV * AP1_to_XYZ_MAT;\r\n    vec3 xyY = XYZ_2_xyY(XYZ);\r\n    xyY.z = clamp(xyY.z, 0.0, MEDIUMP_FLT_MAX);\r\n    xyY.z = pow(xyY.z, DIM_SURROUND_GAMMA);\r\n    XYZ = xyY_2_XYZ(xyY);\r\n\r\n    return XYZ * XYZ_to_AP1_MAT;\r\n}\r\n\r\n#endif // ODTCommon_lib","#if !defined(RRT_lib)\r\n#define RRT_lib\r\n\r\n#include \"ACES_RRTCommon.glsl\";\r\n\r\n/**\r\n * @param ACES AP0\r\n * @returns OCES\r\n */\r\nvec3 RRT(vec3 aces)\r\n{\r\n    // --- Glow module --- //\r\n    float saturation = rgb_2_saturation(aces);\r\n    float ycIn = rgb_2_yc(aces);\r\n    float s = sigmoid_shaper((saturation - 0.4) / 0.2);\r\n    float addedGlow = 1.0 + glow_fwd(ycIn, RRT_GLOW_GAIN * s, RRT_GLOW_MID);\r\n\r\n    aces *= addedGlow;\r\n\r\n    // --- Red modifier --- //\r\n    float hue = rgb_2_hue(aces);\r\n    float centeredHue = center_hue(hue, RRT_RED_HUE);\r\n\r\n    float hueWeight = smoothstep(0.0, 1.0, 1.0 - abs(2.0 * centeredHue / RRT_RED_WIDTH));\r\n    hueWeight *= hueWeight;\r\n\r\n    aces.r += hueWeight * saturation * (RRT_RED_PIVOT - aces.r) * (1. - RRT_RED_SCALE);\r\n\r\n    // --- ACES to RGB rendering space --- //\r\n    vec3 rgbPre = AP0_to_AP1_MAT * aces;\r\n    rgbPre = clamp(rgbPre, 0.0, MEDIUMP_FLT_MAX);\r\n\r\n    // --- Global desaturation --- //\r\n    rgbPre = mix(vec3(dot(rgbPre, AP1_RGB2Y)), rgbPre, RRT_SAT_FACTOR);\r\n\r\n    // --- Apply the tonescale independently in rendering-space RGB --- //\r\n    vec3 rgbPost;\r\n    rgbPost.x = segmented_spline_c5_fwd(rgbPre.x);\r\n    rgbPost.y = segmented_spline_c5_fwd(rgbPre.y);\r\n    rgbPost.z = segmented_spline_c5_fwd(rgbPre.z);\r\n\r\n    // --- RGB rendering space to OCES --- //\r\n    vec3 rgbOces = AP1_to_AP0_MAT * rgbPost;\r\n\r\n    return rgbOces;\r\n}\r\n\r\n#endif // RRT_lib","#if !defined(ODT_sRGB_100nits_lib)\r\n#define ODT_sRGB_100nits_lib\r\n\r\n#include \"ACES_ODTCommon.glsl\";\r\n\r\n// CIE XYZ to REC.709\r\nconst mat3 XYZ_to_REC709_MAT = mat3(\r\n    vec3(3.2409699419, -0.9692436363, 0.0556300797),\r\n    vec3(-1.5373831776, 1.8759675015, -0.2039769589),\r\n    vec3(-0.498610760, 0.0415550574, 1.0569715142));\r\n\r\nconst float DISPGAMMA = 2.4;\r\nconst float OFFSET = 0.055;\r\n\r\nvec3 ODT_sRGB_100nits(vec3 oces)\r\n{\r\n    // OCES to RGB rendering space\r\n    vec3 rgbPre = AP0_to_AP1_MAT * oces;\r\n\r\n    // Apply the tonescale independently in rendering-space RGB\r\n    vec3 rgbPost;\r\n    rgbPost.r = segmented_spline_c9_fwd(rgbPre.r);\r\n    rgbPost.g = segmented_spline_c9_fwd(rgbPre.g);\r\n    rgbPost.b = segmented_spline_c9_fwd(rgbPre.b);\r\n\r\n    // Scale luminance to linear code value\r\n    vec3 linearCV;\r\n    linearCV.r = Y_2_linCV(rgbPost.r, CINEMA_WHITE, CINEMA_BLACK);\r\n    linearCV.g = Y_2_linCV(rgbPost.g, CINEMA_WHITE, CINEMA_BLACK);\r\n    linearCV.b = Y_2_linCV(rgbPost.b, CINEMA_WHITE, CINEMA_BLACK);\r\n\r\n    // Apply gamma adjustment to compensate for dim surround\r\n    linearCV = darkSurround_to_dimSurround(linearCV);\r\n\r\n    // Convert to display primary encoding\r\n    // Rendering space RGB to XYZ\r\n    vec3 XYZ = AP1_to_XYZ_MAT * linearCV;\r\n\r\n    // Apply CAT from ACES white point to assumed observer adapted white point\r\n    XYZ = D60_to_D65_MAT * XYZ;\r\n\r\n    // CIE XYZ to display primaries\r\n    linearCV = XYZ_to_REC709_MAT * XYZ;\r\n\r\n    linearCV = clamp(linearCV, vec3(0.0), vec3(1.0));\r\n    return linearCV;\r\n}\r\n\r\n#endif // ODT_sRGB_100nits_lib","// Academy Color Encoding System (ACES) software and tools are provided by the\r\n// Academy under the following terms and conditions: A worldwide, royalty-free,\r\n// non-exclusive right to copy, modify, create derivatives, and use, in source\r\n// and binary forms, is hereby granted, subject to acceptance of this license.\r\n\r\n// Copyright 2019 Academy of Motion Picture Arts and Sciences (A.M.P.A.S.).\r\n// Portions contributed by others as indicated. All rights reserved.\r\n\r\n// Performance of any of the aforementioned acts indicates acceptance to be\r\n// bound by the following terms and conditions:\r\n\r\n// Copies of source code, in whole or in part, must retain the above copyright\r\n// notice, this list of conditions and the Disclaimer of Warranty.\r\n\r\n// Use in binary form must retain the above copyright notice, this list of\r\n// conditions and the Disclaimer of Warranty in the documentation and/or other\r\n// materials provided with the distribution.\r\n\r\n// Nothing in this license shall be deemed to grant any rights to trademarks,\r\n// copyrights, patents, trade secrets or any other intellectual property of\r\n// A.M.P.A.S. or any contributors, except as expressly stated herein.\r\n\r\n// Neither the name \"A.M.P.A.S.\" nor the name of any other contributors to this\r\n// software may be used to endorse or promote products derivative of or based on\r\n// this software without express prior written permission of A.M.P.A.S. or the\r\n// contributors, as appropriate.\r\n\r\n// This license shall be construed pursuant to the laws of the State of\r\n// California, and any disputes related thereto shall be subject to the\r\n// jurisdiction of the courts therein.\r\n\r\n// Disclaimer of Warranty: THIS SOFTWARE IS PROVIDED BY A.M.P.A.S. AND\r\n// CONTRIBUTORS \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT\r\n// NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY, FITNESS FOR A\r\n// PARTICULAR PURPOSE, AND NON-INFRINGEMENT ARE DISCLAIMED. IN NO EVENT SHALL\r\n// A.M.P.A.S., OR ANY CONTRIBUTORS OR DISTRIBUTORS, BE LIABLE FOR ANY DIRECT,\r\n// INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, RESITUTIONARY, OR CONSEQUENTIAL\r\n// DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR\r\n// SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER\r\n// CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,\r\n// OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE\r\n// OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\r\n\r\n// WITHOUT LIMITING THE GENERALITY OF THE FOREGOING, THE ACADEMY SPECIFICALLY\r\n// DISCLAIMS ANY REPRESENTATIONS OR WARRANTIES WHATSOEVER RELATED TO PATENT OR\r\n// OTHER INTELLECTUAL PROPERTY RIGHTS IN THE ACADEMY COLOR ENCODING SYSTEM, OR\r\n// APPLICATIONS THEREOF, HELD BY PARTIES OTHER THAN A.M.P.A.S.,WHETHER DISCLOSED\r\n// OR UNDISCLOSED.\r\n\r\n#if !defined(ACES_lib)\r\n#define ACES_lib\r\n\r\n#include \"ACES_TransformCommon.glsl\";\r\n#include \"ACES_UtillitiesColor.glsl\";\r\n#include \"ACES_Tonescales.glsl\";\r\n\r\n#include \"ACES_RRT.glsl\";\r\n#include \"ACES_ODT_sRGB_100nits.glsl\";\r\n\r\n// idt\r\n\r\n// linear D65 sRGB to D60 ACES AP0\r\nvec3 sRGB_to_AP0(vec3 sRGB)\r\n{\r\n    return sRGB_to_AP0_MAT * sRGB;\r\n}\r\n\r\n// linear D65 sRGB to D60 ACES AP1\r\nvec3 sRGB_to_AP1(vec3 sRGB)\r\n{\r\n    return sRGB_to_AP1_MAT * sRGB;\r\n}\r\n\r\n// lmt\r\n// todo\r\n\r\n#endif // ACES_lib","\r\nimport { Shader3D } from \"../../RenderEngine/RenderShader/Shader3D\";\r\nimport UtilsGLSL from \"./utils/Utils.glsl\";\r\nimport ColorGLSL from \"./utils/Color.glsl\";\r\nimport MathGLSL from \"./utils/Math.glsl\";\r\nimport OutputTransformGLSL from \"./common/OutputTransform.glsl\";\r\nimport BakedBoneMatrixSamplerGLSL from \"./utils/BakedBoneMatrixSampler.glsl\";\r\n\r\nimport MorphTargetGLSL from \"./common/MorphTarget.glsl\";\r\nimport VertexGLSL from \"./common/VertexCommon.glsl\";\r\n\r\nimport ShadingCommonGLSL from \"./common/ShadingCommon.glsl\";\r\nimport ShadingVertexGLSL from \"./common/ShadingVertex.glsl\";\r\nimport ShadingFragGLSL from \"./common/ShadingFrag.glsl\";\r\n\r\nimport SceneGLSL from \"./common/SceneCommon.glsl\";\r\nimport CameraGLSL from \"./common/CameraCommon.glsl\";\r\nimport Sprite3DCommonGLSL from \"./common/Sprite3DCommon.glsl\";\r\nimport Sprite3DVertexGLSL from \"./common/Sprite3DVertex.glsl\";\r\nimport Sprite3DFragGLSL from \"./common/Sprite3DFrag.glsl\";\r\nimport DepthVertexGLSL from \"./depth/DepthVertex.glsl\";\r\nimport DepthFragGLSL from \"./depth/DepthFrag.glsl\";\r\nimport DepthNormalUtilGLSL from \"./depth/DepthNormalUtil.glsl\";\r\nimport DepthNormalFragGLSL from \"./depth/DepthNormalFrag.glsl\";\r\n\r\nimport ShadowSampleTentGLSL from \"./lighting/ShadowSampleTent.glsl\";\r\nimport ShadowSamplerGLSL from \"./lighting/ShadowSampler.glsl\";\r\nimport SceneFogGLSL from \"./utils/SceneFog.glsl\";\r\nimport SceneFogInputGLSL from \"./utils/SceneFogInput.glsl\";\r\nimport LightingGLSL from \"./lighting/Lighting.glsl\";\r\nimport GlobalIlluminationGLSL from \"./lighting/globalIllumination.glsl\";\r\nimport OctGLSL from \"./lighting/volumetricGI/Oct.glsl\";\r\nimport GridHelpersGLSL from \"./lighting/volumetricGI/GridHelpers.glsl\";\r\nimport VolumetricGIGLSL from \"./lighting/volumetricGI/VolumetricGI.glsl\";\r\n\r\nimport BlinnPhongLightingGLSL from \"./lightingmode/BlinnPhongLighting.glsl\";\r\nimport PBRLightingGLSL from \"./lightingmode/PBRLighting.glsl\";\r\nimport { BlitScreenShaderInit } from \"./postprocess/BlitScreenShaderInit\";\r\nimport { UnlitShaderInit } from \"./unlit/UnlitShaderInit\";\r\nimport { BlinnPhongShaderInit } from \"./blinnphong/BlinnPhongShaderInit\";\r\nimport { TrailShaderInit } from \"./Trail/TrailShaderInit\";\r\nimport { PBRShaderLib } from \"./pbr/PBRShaderLib\";\r\nimport { PBRStandardShaderInit } from \"./pbr/PBRStandardShaderInit\";\r\nimport { SkyBoxShaderInit } from \"./sky/SkyBoxShaderInit\";\r\nimport { ParticleShuriKenShaderInit } from \"./ShurikenParticle/ParticleShuriKenShaderInit\";\r\nimport { SkyProceduralShaderInit } from \"./sky/SkyProceduralShaderInit\";\r\nimport { SkyPanoramicShaderInit } from \"./sky/SkyPanoramicShaderInit\";\r\nimport { ACESShaderLib } from \"./postprocess/ACES/ACESShaderLib\";\r\n\r\n/**\r\n * @internal\r\n * <code>ShaderInit</code> Shader\r\n */\r\nexport class ShaderInit3D {\r\n\t/**\r\n\t * @internal\r\n\t */\r\n\tstatic __init__(): void {\r\n\r\n\t\t// utils\r\n\t\tShader3D.addInclude(\"Utils.glsl\", UtilsGLSL);\r\n\t\tShader3D.addInclude(\"Color.glsl\", ColorGLSL);\r\n\t\tShader3D.addInclude(\"Math.glsl\", MathGLSL);\r\n\t\tShader3D.addInclude(\"BakedBoneMatrixSampler.glsl\", BakedBoneMatrixSamplerGLSL);\r\n\t\tShader3D.addInclude(\"MorphTarget.glsl\", MorphTargetGLSL);\r\n\t\tShader3D.addInclude(\"VertexCommon.glsl\", VertexGLSL);\r\n\t\tShader3D.addInclude(\"ShadingCommon.glsl\", ShadingCommonGLSL);\r\n\t\tShader3D.addInclude(\"ShadingVertex.glsl\", ShadingVertexGLSL);\r\n\t\tShader3D.addInclude(\"ShadingFrag.glsl\", ShadingFragGLSL);\r\n\r\n\t\tShader3D.addInclude(\"OutputTransform.glsl\", OutputTransformGLSL);\r\n\r\n\t\t// scene\r\n\t\tShader3D.addInclude(\"Scene.glsl\", SceneGLSL);\r\n\r\n\t\t// camera\r\n\t\tShader3D.addInclude(\"Camera.glsl\", CameraGLSL);\r\n\r\n\t\t// sprite3D\r\n\t\tShader3D.addInclude(\"Sprite3DCommon.glsl\", Sprite3DCommonGLSL);\r\n\t\tShader3D.addInclude(\"Sprite3DVertex.glsl\", Sprite3DVertexGLSL);\r\n\t\tShader3D.addInclude(\"Sprite3DFrag.glsl\", Sprite3DFragGLSL);\r\n\r\n\t\t// depth\r\n\t\tShader3D.addInclude(\"DepthVertex.glsl\", DepthVertexGLSL);\r\n\t\tShader3D.addInclude(\"DepthFrag.glsl\", DepthFragGLSL);\r\n\t\tShader3D.addInclude(\"DepthNormalUtil.glsl\", DepthNormalUtilGLSL);\r\n\t\tShader3D.addInclude(\"DepthNormalFrag.glsl\", DepthNormalFragGLSL);\r\n\r\n\t\t// scene fog\r\n\t\tShader3D.addInclude(\"SceneFog.glsl\", SceneFogGLSL);\r\n\t\tShader3D.addInclude(\"SceneFogInput.glsl\", SceneFogInputGLSL);\r\n\t\t// shadow sampler\r\n\t\tShader3D.addInclude(\"ShadowSampleTent.glsl\", ShadowSampleTentGLSL);\r\n\t\tShader3D.addInclude(\"ShadowSampler.glsl\", ShadowSamplerGLSL);\r\n\r\n\t\t// lighting\r\n\t\tShader3D.addInclude(\"Lighting.glsl\", LightingGLSL);\r\n\t\tShader3D.addInclude(\"globalIllumination.glsl\", GlobalIlluminationGLSL);\r\n\t\t// volumetric GI\r\n\t\tShader3D.addInclude(\"Oct.glsl\", OctGLSL);\r\n\t\tShader3D.addInclude(\"GridHelpers.glsl\", GridHelpersGLSL);\r\n\t\tShader3D.addInclude(\"VolumetricGI.glsl\", VolumetricGIGLSL);\r\n\r\n\t\t// lighting mode\r\n\t\tShader3D.addInclude(\"BlinnPhongLighting.glsl\", BlinnPhongLightingGLSL);\r\n\t\tShader3D.addInclude(\"PBRLighting.glsl\", PBRLightingGLSL);\r\n\r\n\t\t// lib\r\n\t\tPBRShaderLib.init();\r\n\t\tACESShaderLib.init();\r\n\r\n\t\t// shader init\r\n\t\tBlitScreenShaderInit.init();\r\n\t\tUnlitShaderInit.init();\r\n\t\tPBRStandardShaderInit.init();\r\n\t\t//PBRShaderInit.init();\r\n\t\tBlinnPhongShaderInit.init();\r\n\t\tTrailShaderInit.init();\r\n\t\tParticleShuriKenShaderInit.init();\r\n\t\tSkyBoxShaderInit.init();\r\n\t\tSkyProceduralShaderInit.init();\r\n\t\tSkyPanoramicShaderInit.init();\r\n\r\n\t\t///////////////////////////////////////////////////////////////////////\r\n\t\tShader3D.SHADERDEFINE_LEGACYSINGALLIGHTING = Shader3D.getDefineByName(\"LEGACYSINGLELIGHTING\");\r\n\t\tShader3D.SHADERDEFINE_ENUNIFORMBLOCK = Shader3D.getDefineByName(\"ENUNIFORMBLOCK\");\r\n\t\tShader3D.SHADERDEFINE_FLOATTEXTURE = Shader3D.getDefineByName(\"FLOATTEXTURE\");\r\n\t\tShader3D.SHADERDEFINE_FLOATTEXTURE_FIL_LINEAR = Shader3D.getDefineByName(\"FLOATTEXTURE_FIL_LINEAR\");\r\n\t}\r\n}\r\n\r\n","#if !defined(Color_lib)\r\n    #define Color_lib\r\n\r\n    #include \"Math.glsl\";\r\n\r\nvec3 linearToGamma(in vec3 value)\r\n{\r\n    // return vec3(mix(pow(value.rgb, vec3(0.41666)) * 1.055 - vec3(0.055), value.rgb * 12.92, vec3(lessThanEqual(value.rgb, vec3(0.0031308)))));\r\n    return pow(value, vec3(1.0 / 2.2));\r\n}\r\n\r\nvec4 linearToGamma(in vec4 value)\r\n{\r\n    return vec4(linearToGamma(value.rgb), value.a);\r\n}\r\n\r\nvec3 gammaToLinear(in vec3 value)\r\n{\r\n    // return pow((value + 0.055) / 1.055, vec3(2.4));\r\n    return pow(value, vec3(2.2));\r\n}\r\n\r\nvec4 gammaToLinear(in vec4 value)\r\n{\r\n    return vec4(gammaToLinear(value.rgb), value.a);\r\n}\r\n\r\nconst float c_RGBDMaxRange = 255.0;\r\n\r\n// float color to rgbd\r\nvec4 encodeRGBD(in vec3 color)\r\n{\r\n    float maxRGB = max(vecmax(color), FLT_EPS);\r\n    float d = max(1.0, c_RGBDMaxRange / maxRGB);\r\n    d = saturate(d / 255.0);\r\n\r\n    vec3 rgb = color.rgb * d;\r\n    rgb = saturate(rgb);\r\n    return vec4(rgb, d);\r\n}\r\n\r\n// rgbd to float color\r\nvec3 decodeRGBD(in vec4 rgbd)\r\n{\r\n    vec3 color = rgbd.rgb * (1.0 / rgbd.a);\r\n    return color;\r\n}\r\n\r\n// float color to rgbm\r\nvec4 encodeRGBM(in vec3 color, float range)\r\n{\r\n    color *= 1.0 / range;\r\n    float maxRGB = max(vecmax(color), FLT_EPS);\r\n    float m = ceil(maxRGB * 255.0) / 255.0;\r\n    vec3 rgb = color.rgb * 1.0 / m;\r\n\r\n    vec4 rgbm = vec4(rgb, m);\r\n    return rgbm;\r\n}\r\n\r\n// rgbm to float color\r\nvec3 decodeRGBM(in vec4 rgbm, float range)\r\n{\r\n    return range * rgbm.rgb * rgbm.a;\r\n}\r\n\r\n    #include \"OutputTransform.glsl\";\r\n\r\n#endif // Color_lib","#if !defined(Math_lib)\r\n    #define Math_lib\r\n\r\n    #ifndef GRAPHICS_API_GLES3\r\nmat2 inverse(mat2 m)\r\n{\r\n    return mat2(m[1][1], -m[0][1], -m[1][0], m[0][0]) / (m[0][0] * m[1][1] - m[0][1] * m[1][0]);\r\n}\r\nmat3 inverse(mat3 m)\r\n{\r\n    float a00 = m[0][0], a01 = m[0][1], a02 = m[0][2];\r\n    float a10 = m[1][0], a11 = m[1][1], a12 = m[1][2];\r\n    float a20 = m[2][0], a21 = m[2][1], a22 = m[2][2];\r\n\r\n    float b01 = a22 * a11 - a12 * a21;\r\n    float b11 = -a22 * a10 + a12 * a20;\r\n    float b21 = a21 * a10 - a11 * a20;\r\n\r\n    float det = a00 * b01 + a01 * b11 + a02 * b21;\r\n\r\n    return mat3(b01, (-a22 * a01 + a02 * a21), (a12 * a01 - a02 * a11), b11, (a22 * a00 - a02 * a20),\r\n\t       (-a12 * a00 + a02 * a10), b21, (-a21 * a00 + a01 * a20), (a11 * a00 - a01 * a10))\r\n\t/ det;\r\n}\r\n\r\nmat4 inverse(mat4 m)\r\n{\r\n    float a00 = m[0][0], a01 = m[0][1], a02 = m[0][2], a03 = m[0][3], a10 = m[1][0], a11 = m[1][1], a12 = m[1][2],\r\n\t  a13 = m[1][3], a20 = m[2][0], a21 = m[2][1], a22 = m[2][2], a23 = m[2][3], a30 = m[3][0], a31 = m[3][1],\r\n\t  a32 = m[3][2], a33 = m[3][3],\r\n\r\n\t  b00 = a00 * a11 - a01 * a10, b01 = a00 * a12 - a02 * a10, b02 = a00 * a13 - a03 * a10,\r\n\t  b03 = a01 * a12 - a02 * a11, b04 = a01 * a13 - a03 * a11, b05 = a02 * a13 - a03 * a12,\r\n\t  b06 = a20 * a31 - a21 * a30, b07 = a20 * a32 - a22 * a30, b08 = a20 * a33 - a23 * a30,\r\n\t  b09 = a21 * a32 - a22 * a31, b10 = a21 * a33 - a23 * a31, b11 = a22 * a33 - a23 * a32,\r\n\r\n\t  det = b00 * b11 - b01 * b10 + b02 * b09 + b03 * b08 - b04 * b07 + b05 * b06;\r\n\r\n    return mat4(a11 * b11 - a12 * b10 + a13 * b09, a02 * b10 - a01 * b11 - a03 * b09, a31 * b05 - a32 * b04 + a33 * b03,\r\n\t       a22 * b04 - a21 * b05 - a23 * b03, a12 * b08 - a10 * b11 - a13 * b07, a00 * b11 - a02 * b08 + a03 * b07,\r\n\t       a32 * b02 - a30 * b05 - a33 * b01, a20 * b05 - a22 * b02 + a23 * b01, a10 * b10 - a11 * b08 + a13 * b06,\r\n\t       a01 * b08 - a00 * b10 - a03 * b06, a30 * b04 - a31 * b02 + a33 * b00, a21 * b02 - a20 * b04 - a23 * b00,\r\n\t       a11 * b07 - a10 * b09 - a12 * b06, a00 * b09 - a01 * b07 + a02 * b06, a31 * b01 - a30 * b03 - a32 * b00,\r\n\t       a20 * b03 - a21 * b01 + a22 * b00)\r\n\t/ det;\r\n}\r\n\r\nmat4 transpose(mat4 m)\r\n{\r\n    return mat4(m[0][0], m[1][0], m[2][0], m[3][0],\r\n\tm[0][1], m[1][1], m[2][1], m[3][1],\r\n\tm[0][2], m[1][2], m[2][2], m[3][2],\r\n\tm[0][3], m[1][3], m[2][3], m[3][3]);\r\n}\r\nmat3 transpose(mat3 m)\r\n{\r\n    return mat3(m[0][0], m[1][0], m[2][0],\r\n\tm[0][1], m[1][1], m[2][1],\r\n\tm[0][2], m[1][2], m[2][2]);\r\n}\r\n    #endif // GRAPHICS_API_GLES3\r\n\r\n    #define PI 3.14159265359\r\n\r\n    #define INVERT_PI 0.31830988618\r\n\r\n    #define HALF_PI 1.570796327\r\n\r\n    #define MEDIUMP_FLT_MAX 65504.0\r\n    #define MEDIUMP_FLT_MIN 0.00006103515625\r\n\r\n    #if defined(GL_FRAGMENT_PRECISION_HIGH)\r\n\t#define FLT_EPS\t\t   1e-5\r\n\t#define saturateMediump(x) x\r\n    #else\r\n\t#define FLT_EPS\t\t   MEDIUMP_FLT_MIN\r\n\t#define saturateMediump(x) min(x, MEDIUMP_FLT_MAX)\r\n    #endif // GL_FRAGMENT_PRECISION_HIGH\r\n\r\n    #define saturate(x) clamp(x, 0.0, 1.0)\r\n\r\nfloat pow2(float x)\r\n{\r\n    return x * x;\r\n}\r\n\r\nvec3 pow2(vec3 x)\r\n{\r\n    return x * x;\r\n}\r\n\r\nfloat pow5(float x)\r\n{\r\n    float x2 = x * x;\r\n    return x2 * x2 * x;\r\n}\r\n\r\nconst float INVERT_LOG10 = 0.43429448190325176;\r\n\r\nfloat log10(float x)\r\n{\r\n    return log(x) * INVERT_LOG10;\r\n}\r\n\r\nfloat vecmax(const vec2 v)\r\n{\r\n    return max(v.x, v.y);\r\n}\r\n\r\nfloat vecmax(const vec3 v)\r\n{\r\n    return max(v.x, max(v.y, v.z));\r\n}\r\n\r\nfloat vecmax(const vec4 v)\r\n{\r\n    return max(max(v.x, v.y), max(v.z, v.w));\r\n}\r\n\r\nfloat vecmin(const vec2 v)\r\n{\r\n    return min(v.x, v.y);\r\n}\r\n\r\nfloat vecmin(const vec3 v)\r\n{\r\n    return min(v.x, min(v.y, v.z));\r\n}\r\n\r\nfloat vecmin(const vec4 v)\r\n{\r\n    return min(min(v.x, v.y), min(v.z, v.w));\r\n}\r\n\r\nvec3 SafeNormalize(in vec3 inVec)\r\n{\r\n    float dp3 = max(0.001, dot(inVec, inVec));\r\n    return inVec * inversesqrt(dp3);\r\n}\r\n\r\nvec3 normalScale(in vec3 normal, in float scale)\r\n{\r\n    normal *= vec3(scale, scale, 1.0);\r\n    return normalize(normal);\r\n}\r\n\r\n/**\r\n * Approximates acos(x) with a max absolute error of 9.0x10^-3.\r\n * Valid in the range -1..1.\r\n */\r\nfloat acosFast(float x)\r\n{\r\n    // Lagarde 2014, \"Inverse trigonometric functions GPU optimization for AMD GCN architecture\"\r\n    // This is the approximation of degree 1, with a max absolute error of 9.0x10^-3\r\n    float y = abs(x);\r\n    float p = -0.1565827 * y + 1.570796;\r\n    p *= sqrt(1.0 - y);\r\n    return x >= 0.0 ? p : PI - p;\r\n}\r\n\r\n/**\r\n * Approximates acos(x) with a max absolute error of 9.0x10^-3.\r\n * Valid only in the range 0..1.\r\n */\r\nfloat acosFastPositive(float x)\r\n{\r\n    float p = -0.1565827 * x + 1.570796;\r\n    return p * sqrt(1.0 - x);\r\n}\r\n\r\n/*\r\n * Random number between 0 and 1, using interleaved gradient noise.\r\n * w must not be normalized (e.g. window coordinates)\r\n */\r\nfloat interleavedGradientNoise(const highp vec2 w)\r\n{\r\n    const vec3 m = vec3(0.06711056, 0.00583715, 52.9829189);\r\n    return fract(m.z * fract(dot(w, m.xy)));\r\n}\r\n\r\n/*\r\n * vertex rotate by Euler\r\n */\r\nvec3 rotationByEuler(in vec3 vector, in vec3 rot)\r\n{\r\n    float halfRoll = rot.z * 0.5;\r\n    float halfPitch = rot.x * 0.5;\r\n    float halfYaw = rot.y * 0.5;\r\n\r\n    float sinRoll = sin(halfRoll);\r\n    float cosRoll = cos(halfRoll);\r\n    float sinPitch = sin(halfPitch);\r\n    float cosPitch = cos(halfPitch);\r\n    float sinYaw = sin(halfYaw);\r\n    float cosYaw = cos(halfYaw);\r\n\r\n    float quaX = (cosYaw * sinPitch * cosRoll) + (sinYaw * cosPitch * sinRoll);\r\n    float quaY = (sinYaw * cosPitch * cosRoll) - (cosYaw * sinPitch * sinRoll);\r\n    float quaZ = (cosYaw * cosPitch * sinRoll) - (sinYaw * sinPitch * cosRoll);\r\n    float quaW = (cosYaw * cosPitch * cosRoll) + (sinYaw * sinPitch * sinRoll);\r\n\r\n    // vec4 q=vec4(quaX,quaY,quaZ,quaW);\r\n    // vec3 temp = cross(q.xyz, vector) + q.w * vector;\r\n    // return (cross(temp, -q.xyz) + dot(q.xyz,vector) * q.xyz + q.w * temp);\r\n\r\n    float x = quaX + quaX;\r\n    float y = quaY + quaY;\r\n    float z = quaZ + quaZ;\r\n    float wx = quaW * x;\r\n    float wy = quaW * y;\r\n    float wz = quaW * z;\r\n    float xx = quaX * x;\r\n    float xy = quaX * y;\r\n    float xz = quaX * z;\r\n    float yy = quaY * y;\r\n    float yz = quaY * z;\r\n    float zz = quaZ * z;\r\n\r\n    return vec3(((vector.x * ((1.0 - yy) - zz)) + (vector.y * (xy - wz))) + (vector.z * (xz + wy)),\r\n\t((vector.x * (xy + wz)) + (vector.y * ((1.0 - xx) - zz))) + (vector.z * (yz - wx)),\r\n\t((vector.x * (xz - wy)) + (vector.y * (yz + wx))) + (vector.z * ((1.0 - xx) - yy)));\r\n}\r\n\r\n/*\r\n * Assume that axis has been normalized\r\n * point rotate by one axis\r\n */\r\nvec3 rotationByAxis(in vec3 vector, in vec3 axis, in float angle)\r\n{\r\n    float halfAngle = angle * 0.5;\r\n    float sin = sin(halfAngle);\r\n\r\n    float quaX = axis.x * sin;\r\n    float quaY = axis.y * sin;\r\n    float quaZ = axis.z * sin;\r\n    float quaW = cos(halfAngle);\r\n\r\n    // vec4 q=vec4(quaX,quaY,quaZ,quaW);\r\n    // vec3 temp = cross(q.xyz, vector) + q.w * vector;\r\n    // return (cross(temp, -q.xyz) + dot(q.xyz,vector) * q.xyz + q.w * temp);\r\n\r\n    float x = quaX + quaX;\r\n    float y = quaY + quaY;\r\n    float z = quaZ + quaZ;\r\n    float wx = quaW * x;\r\n    float wy = quaW * y;\r\n    float wz = quaW * z;\r\n    float xx = quaX * x;\r\n    float xy = quaX * y;\r\n    float xz = quaX * z;\r\n    float yy = quaY * y;\r\n    float yz = quaY * z;\r\n    float zz = quaZ * z;\r\n\r\n    return vec3(((vector.x * ((1.0 - yy) - zz)) + (vector.y * (xy - wz))) + (vector.z * (xz + wy)),\r\n\t((vector.x * (xy + wz)) + (vector.y * ((1.0 - xx) - zz))) + (vector.z * (yz - wx)),\r\n\t((vector.x * (xz - wy)) + (vector.y * (yz + wx))) + (vector.z * ((1.0 - xx) - yy)));\r\n}\r\n\r\n/*\r\n *rotate by quaternions\r\n */\r\nvec3 rotationByQuaternions(in vec3 v, in vec4 q)\r\n{\r\n    return v + 2.0 * cross(q.xyz, cross(q.xyz, v) + q.w * v);\r\n}\r\n\r\n#endif // Math_lib","#if !defined(BakeBoneAnimSampler_lib)\r\n    #define BakeBoneAnimSampler_lib\r\n\r\nmat4 loadBakedMatMatrix(float FramePos, float boneIndices, float offset)\r\n{\r\n    vec2 uv;\r\n    float PixelPos = FramePos + boneIndices * 4.0;\r\n    float halfOffset = offset * 0.5;\r\n    float uvoffset = PixelPos / u_SimpleAnimatorTextureSize;\r\n    uv.y = floor(uvoffset) * offset + halfOffset;\r\n    uv.x = mod(float(PixelPos), u_SimpleAnimatorTextureSize) * offset + halfOffset;\r\n    vec4 mat0row = texture2D(u_SimpleAnimatorTexture, uv);\r\n    uv.x += offset;\r\n    vec4 mat1row = texture2D(u_SimpleAnimatorTexture, uv);\r\n    uv.x += offset;\r\n    vec4 mat2row = texture2D(u_SimpleAnimatorTexture, uv);\r\n    uv.x += offset;\r\n    vec4 mat3row = texture2D(u_SimpleAnimatorTexture, uv);\r\n    mat4 m = mat4(mat0row.x, mat0row.y, mat0row.z, mat0row.w,\r\n\tmat1row.x, mat1row.y, mat1row.z, mat1row.w,\r\n\tmat2row.x, mat2row.y, mat2row.z, mat2row.w,\r\n\tmat3row.x, mat3row.y, mat3row.z, mat3row.w);\r\n    return m;\r\n}\r\n\r\n#endif // BakeBoneAnimSampler_lib","#if !defined(MorphTarget_lib)\r\n    #define MorphTarget_lib\r\n\r\n    #ifdef GRAPHICS_API_GLES3\r\n\r\n/// static mesh property\r\nuniform sampler2DArray u_MorphTargetsTex;\r\n// xy: tex size, z: attribute count\r\nuniform vec4 u_MorphParams;\r\nuniform vec4 u_MorphAttrOffset;\r\n\r\n\t#define Morph_TexWidth\t   u_MorphParams.x\r\n\t#define Morph_TexHeight\t   u_MorphParams.y\r\n\t#define Morph_AttributeNum u_MorphParams.z\r\n\t#define Morph_TargetNum\t   u_MorphParams.w\r\n\r\n\t#define Morph_PositionOffset u_MorphAttrOffset.x\r\n\t#define Morph_NormalOffset   u_MorphAttrOffset.y\r\n\t#define Morph_TangentOffset  u_MorphAttrOffset.z\r\n\r\n// #define MORPH_MAX_COUNT 8\r\n\r\n/// dynamic params\r\nuniform float u_MorphActiveTargets[MORPH_MAX_COUNT];\r\nuniform float u_MorphTargetWeights[MORPH_MAX_COUNT];\r\nuniform int u_MorphTargetActiveCount;\r\n\r\n\t#define MORPH_ACTIVE_COUNT u_MorphTargetActiveCount\r\n\r\nvec4 sampleMorphTargets(in int vertexID, in float targetID)\r\n{\r\n    int v = vertexID / int(Morph_TexWidth);\r\n    int u = vertexID - v * int(Morph_TexWidth);\r\n\r\n    vec3 uvw = vec3((float(u) + 0.5) / Morph_TexWidth, (float(v) + 0.5) / Morph_TexHeight, targetID);\r\n\r\n    return texture(u_MorphTargetsTex, uvw);\r\n}\r\n\r\nvec3 positionMorph(in vec3 position)\r\n{\r\n    int vertexID = gl_VertexID * int(Morph_AttributeNum) + int(Morph_PositionOffset);\r\n\r\n    for (int i = 0; i < MORPH_ACTIVE_COUNT; i++)\r\n\t{\r\n\t    float index = u_MorphActiveTargets[i];\r\n\r\n\t    position += sampleMorphTargets(vertexID, index).xyz * u_MorphTargetWeights[i];\r\n\t}\r\n\r\n    return position;\r\n}\r\n\r\nvec3 normalMorph(in vec3 normal)\r\n{\r\n    int vertexID = gl_VertexID * int(Morph_AttributeNum) + int(Morph_NormalOffset);\r\n    for (int i = 0; i < MORPH_ACTIVE_COUNT; i++)\r\n\t{\r\n\t    float index = u_MorphActiveTargets[i];\r\n\r\n\t    normal += sampleMorphTargets(vertexID, index).xyz * u_MorphTargetWeights[i];\r\n\t}\r\n\r\n    return normal;\r\n}\r\n\r\nvec4 tangentMorph(in vec4 tangent)\r\n{\r\n    int vertexID = gl_VertexID * int(Morph_AttributeNum) + int(Morph_TangentOffset);\r\n    for (int i = 0; i < MORPH_ACTIVE_COUNT; i++)\r\n\t{\r\n\t    float index = u_MorphActiveTargets[i];\r\n\r\n\t    vec4 sampleTangent = sampleMorphTargets(vertexID, index);\r\n\r\n\t    tangent.xyz += sampleTangent.xyz * u_MorphTargetWeights[i] * tangent.w * sampleTangent.w;\r\n\t}\r\n\r\n    return tangent;\r\n}\r\n\r\n    #endif // GRAPHICS_API_GLES3\r\n\r\n#endif // MorphTarget_lib","#if !defined(VertexCommon_lib)\r\n    #define VertexCommon_lib\r\n\r\n    #ifdef MORPHTARGETS\r\n\t#include \"MorphTarget.glsl\";\r\n    #endif // MORPHTARGETS\r\n\r\nstruct Vertex {\r\n\r\n    vec3 positionOS;\r\n\r\n    vec3 normalOS;\r\n\r\n    #ifdef TANGENT\r\n    vec4 tangentOS;\r\n    #endif // TANGENT\r\n\r\n    // todo  uv define ?\r\n    #ifdef UV\r\n    vec2 texCoord0;\r\n    #endif // UV\r\n\r\n    #ifdef UV1\r\n    vec2 texCoord1;\r\n    #endif // UV1\r\n\r\n    #ifdef COLOR\r\n    vec4 vertexColor;\r\n    #endif // COLOR\r\n\r\n    #ifdef LIGHTMAP\r\n    vec4 lightmapScaleOffset;\r\n\t#endif LIGHTMAP\r\n};\r\n\r\n/**\r\n * vertex position\r\n */\r\nvec4 getVertexPosition()\r\n{\r\n    vec4 position = a_Position;\r\n\r\n    #ifdef MORPHTARGETS\r\n\t#ifdef MORPHTARGETS_POSITION\r\n    position.xyz = positionMorph(position.xyz);\r\n\t#endif // MORPHTARGETS_POSITION\r\n    #endif // MORPHTARGETS\r\n\r\n    return position;\r\n}\r\n\r\nvec3 getVertexNormal()\r\n{\r\n    vec3 normal = a_Normal.xyz;\r\n    #ifdef MORPHTARGETS\r\n\t#ifdef MORPHTARGETS_NORMAL\r\n    normal.xyz = normalMorph(normal);\r\n\t#endif // MORPHTARGETS_NORMAL\r\n    #endif // MORPHTARGETS\r\n\r\n    return normal;\r\n}\r\n\r\n    #ifdef TANGENT\r\nvec4 getVertexTangent()\r\n{\r\n    vec4 tangent = a_Tangent0;\r\n\r\n\t#ifdef MORPHTARGETS\r\n\t    #ifdef MORPHTARGETS_TANGENT\r\n    tangent = tangentMorph(tangent);\r\n\t    #endif // MORPHTARGETS_TANGENT\r\n\t#endif // MORPHTARGETS\r\n\r\n    return tangent;\r\n}\r\n    #endif // TANGENT\r\n\r\n    #ifdef LIGHTMAP\r\n#ifndef GPU_INSTANCE\r\n    uniform vec4 u_LightmapScaleOffset;\r\n#endif // GPU_INSTANCE\r\n\r\nvec4 getLightmapScaleOffset(){\r\n    \r\n    #ifdef GPU_INSTANCE\r\n        return a_LightmapScaleOffset;\r\n    #else\r\n        return u_LightmapScaleOffset;\r\n    #endif // GPU_INSTANCE\r\n}\r\n    #endif // LIGHTMAP\r\n\r\nvoid getVertexParams(inout Vertex vertex)\r\n{\r\n    vertex.positionOS = getVertexPosition().xyz;\r\n\r\n    vertex.normalOS = getVertexNormal();\r\n\r\n    #ifdef TANGENT\r\n    vertex.tangentOS = getVertexTangent();\r\n    #endif // TANGENT\r\n\r\n    #ifdef UV\r\n    vertex.texCoord0 = a_Texcoord0;\r\n    #endif // UV\r\n\r\n    #ifdef UV1\r\n    vertex.texCoord1 = a_Texcoord1;\r\n    #endif // UV1\r\n\r\n    #ifdef COLOR\r\n    // consider vertexColor is gamma\r\n    vertex.vertexColor = vec4(pow(a_Color.rgb, vec3(2.2)), a_Color.a);\r\n    #endif // COLOR\r\n\r\n    #ifdef LIGHTMAP\r\n    vertex.lightmapScaleOffset = getLightmapScaleOffset();\r\n\t#endif LIGHTMAP\r\n}\r\n\r\n#endif // VertexCommon_lib","#if !defined(ShadingCommon_lib)\r\n    #define ShadingCommon_lib\r\n\r\n// varying\r\nvarying vec3 v_PositionWS;\r\n// todo\r\nvarying vec3 v_NormalWS;\r\nvarying vec3 v_TangentWS;\r\nvarying vec3 v_BiNormalWS;\r\n\r\n    #ifdef UV\r\nvarying vec2 v_Texcoord0;\r\n    #endif // UV\r\n\r\n    #ifdef UV1\r\n\t#ifdef LIGHTMAP\r\nvarying vec2 v_Texcoord1;\r\n\t#endif // LIGHTMAP\r\n    #endif // UV1\r\n\r\n    #ifdef COLOR\r\nvarying vec4 v_VertexColor;\r\n    #endif // COLOR\r\n\r\n// , vsfs\r\nstruct PixelParams {\r\n    vec3 positionWS;\r\n\r\n    // todo\r\n    vec3 normalWS;\r\n    vec3 tangentWS;\r\n    vec3 biNormalWS;\r\n    mat3 TBN;\r\n\r\n    #ifdef UV\r\n    vec2 uv0;\r\n    #endif // UV\r\n\r\n    #ifdef UV1\r\n\t#ifdef LIGHTMAP\r\n    vec2 uv1;\r\n\t#endif // LIGHTMAP\r\n    #endif // UV1\r\n\r\n    #ifdef COLOR\r\n    vec4 vertexColor;\r\n    #endif // COLOR\r\n};\r\n\r\n#endif // ShadingCommon_lib","#if !defined(ShadingVertex_lib)\r\n    #define ShadingVertex_lib\r\n\r\n    #include \"ShadingCommon.glsl\";\r\n\r\nvoid sharePixelParams(const in PixelParams params)\r\n{\r\n    v_PositionWS = params.positionWS;\r\n\r\n    v_NormalWS = params.normalWS;\r\n    v_TangentWS = params.tangentWS;\r\n    v_BiNormalWS = params.biNormalWS;\r\n\r\n    #ifdef UV\r\n    v_Texcoord0 = params.uv0;\r\n    #endif // UV\r\n\r\n    #ifdef UV1\r\n\t#ifdef LIGHTMAP\r\n    v_Texcoord1 = params.uv1;\r\n\t#endif LIGHTMAP\r\n    #endif // UV1\r\n\r\n    #ifdef COLOR\r\n    v_VertexColor = params.vertexColor;\r\n    #endif // COLOR\r\n}\r\n\r\nvoid shadingPixelParams(inout PixelParams params, in Vertex vertex)\r\n{\r\n    mat4 worldMat = getWorldMatrix();\r\n    vec4 pos = (worldMat * vec4(vertex.positionOS, 1.0));\r\n    params.positionWS = pos.xyz / pos.w;\r\n\r\n    mat3 normalMat = transpose(inverse(mat3(worldMat)));\r\n    params.normalWS = normalize((normalMat * vertex.normalOS).xyz);\r\n\r\n    #ifdef TANGENT\r\n    params.tangentWS = normalize((normalMat * vertex.tangentOS.xyz).xyz);\r\n    params.tangentWS *= u_WroldInvertFront.x;\r\n    params.biNormalWS = normalize(cross(params.normalWS, params.tangentWS) * sign(vertex.tangentOS.w));\r\n    #else // TANGENT\r\n    params.tangentWS = vec3(1.0, 0.0, 0.0);\r\n    params.tangentWS *= u_WroldInvertFront.x;\r\n    params.biNormalWS = normalize(cross(params.normalWS, params.tangentWS));\r\n    #endif // TANGENT\r\n\r\n    #ifdef UV\r\n    params.uv0 = vertex.texCoord0;\r\n    #endif // UV\r\n\r\n    #ifdef UV1\r\n\t#ifdef LIGHTMAP\r\n    params.uv1 = tranformLightMapUV(vertex.texCoord1, vertex.lightmapScaleOffset);\r\n\t#endif LIGHTMAP\r\n    #endif // UV1\r\n\r\n    #ifdef COLOR\r\n    params.vertexColor = vertex.vertexColor;\r\n    #endif // COLOR\r\n}\r\n\r\n#endif // ShadingVertex_lib","#if !defined(ShadingFrag_lib)\r\n    #define ShadingFrag_lib\r\n\r\n    #include \"ShadingCommon.glsl\";\r\n\r\n    #define _InvertNormal (float(gl_FrontFacing) * 2.0 - 1.0);\r\n\r\nvoid getPixelParams(inout PixelParams params)\r\n{\r\n    params.positionWS = v_PositionWS;\r\n\r\n    float invertN = _InvertNormal;\r\n\r\n    params.normalWS = normalize(v_NormalWS * invertN);\r\n    params.tangentWS = normalize(v_TangentWS * invertN);\r\n    params.biNormalWS = normalize(v_BiNormalWS * invertN);\r\n\r\n    params.TBN = mat3(params.tangentWS, params.biNormalWS, params.normalWS);\r\n\r\n    #ifdef UV\r\n    params.uv0 = v_Texcoord0;\r\n    #endif // UV\r\n\r\n    #ifdef UV1\r\n\t#ifdef LIGHTMAP\r\n    params.uv1 = v_Texcoord1;\r\n\t#endif // LIGHTMAP\r\n    #endif // UV1\r\n\r\n    #ifdef COLOR\r\n    params.vertexColor = v_VertexColor;\r\n    #endif // COLOR\r\n}\r\n\r\n#endif // ShadingFrag_lib","#if !defined(OutputTransform_lib)\r\n    #define OutputTransform_lib\r\n\r\nvec3 gammaCorrect(in vec3 color, float gammaValue)\r\n{\r\n    return pow(color, vec3(gammaValue));\r\n}\r\n\r\nvec4 gammaCorrect(in vec4 color)\r\n{\r\n    // todo color gamut gamma value\r\n    // default sRGB\r\n    float gammaValue = 1.0 / 2.2;\r\n    return vec4(gammaCorrect(color.rgb, gammaValue), color.a);\r\n}\r\n\r\nvec4 outputTransform(in vec4 color)\r\n{\r\n    #ifdef GAMMACORRECT\r\n    // render in linear, output gamma\r\n    return gammaCorrect(color);\r\n    #else // GAMMACORRECT\r\n    return color;\r\n    #endif // GAMMACORRECT\r\n}\r\n\r\n#endif // OutputTransform_lib\r\n","#if !defined(SceneCommon_lib)\r\n    #define SceneCommon_lib\r\n\r\n    #ifdef ENUNIFORMBLOCK\r\nuniform SceneUniformBlock\r\n{\r\n    // time\r\n    float u_Time;\r\n    vec4 u_FogParams;// x start,y range,z Density\r\n    vec4 u_FogColor;\r\n};\r\n    #else // ENUNIFORMBLOCK\r\n// time\r\nuniform float u_Time;\r\nuniform vec4 u_FogParams;//x start,y range,z Density\r\nuniform vec4 u_FogColor;\r\n    #endif // ENUNIFORMBLOCK\r\n    //rotate SH IBL\r\nuniform float u_GIRotate;\r\n\r\n#endif // SceneCommon_lib","#if !defined(CameraCommon_lib)\r\n    #define CameraCommon_lib\r\n\r\n    #ifdef ENUNIFORMBLOCK\r\n\r\nuniform CameraUniformBlock\r\n{\r\n    mat4 u_View;\r\n    mat4 u_Projection;\r\n    mat4 u_ViewProjection;\r\n    vec4 u_ProjectionParams; // x: near, y: far, z: invert, w: 1/far\r\n    vec4 u_Viewport; // x,y,width,height\r\n    vec3 u_CameraDirection;\r\n    vec3 u_CameraUp;\r\n    vec3 u_CameraPos;\r\n};\r\n    #else\r\nuniform mat4 u_View;\r\nuniform mat4 u_Projection;\r\nuniform mat4 u_ViewProjection;\r\nuniform vec4 u_ProjectionParams; // x: near, y: far, z: invert, w: 1/far\r\nuniform vec4 u_Viewport; // x, y, width, height\r\nuniform vec3 u_CameraDirection;\r\nuniform vec3 u_CameraUp;\r\nuniform vec3 u_CameraPos;\r\n    #endif // ENUNIFORMBLOCK\r\n\r\n/*Depth or DepthNormal Uniform*/\r\nuniform highp sampler2D u_CameraDepthTexture;\r\nuniform vec4 u_ZBufferParams; //(1.0 - far / near, far / near, (near - far) / (near * far), 1 / near)\r\nuniform mediump sampler2D u_CameraDepthNormalsTexture;\r\nuniform mediump sampler2D u_CameraOpaqueTexture;\r\nuniform vec4 u_OpaqueTextureParams;\r\n\r\nvec4 getPositionCS(in vec3 positionWS)\r\n{\r\n    return u_ViewProjection * vec4(positionWS, 1.0);\r\n}\r\n\r\nvec3 getViewDirection(in vec3 positionWS)\r\n{\r\n    return normalize(u_CameraPos - positionWS);\r\n}\r\n\r\n// \r\nvec4 remapPositionZ(vec4 position)\r\n{\r\n    position.z = position.z * 2.0 - position.w;\r\n    return position;\r\n}\r\n\r\n#endif // CameraCommon_lib","#if !defined(Sprite3DCommon_lib)\r\n    #define Sprite3DCommon_lib\r\n\r\nuniform mat4 u_WorldMat;\r\n\r\nuniform vec4 u_WroldInvertFront; // x: invert front face\r\n\r\n    \r\n\r\n\r\nvec2 tranformLightMapUV(in vec2 texcoord, in vec4 tilingOffset)\r\n{\r\n    vec2 lightMapUV = vec2(texcoord.x, 1.0 - texcoord.y) * tilingOffset.xy + tilingOffset.zw;\r\n    lightMapUV.y = 1.0 - lightMapUV.y;\r\n    return lightMapUV;\r\n}\r\n\r\nvec2 transformUV(in vec2 texcoord, in vec4 tilingOffset)\r\n{\r\n    vec2 uv = texcoord * tilingOffset.xy + tilingOffset.zw * vec2(1.0, -1.0) + vec2(0.0, 1.0 - tilingOffset.y);\r\n    return uv;\r\n}\r\n\r\n#endif // Sprite3DCommon_lib","#if !defined(Sprite3DVertex_lib)\r\n    #define Sprite3DVertex_lib\r\n\r\n    #include \"Sprite3DCommon.glsl\";\r\n\r\n    #ifdef BONE\r\n// todo const int c_MaxBoneCount = 24\r\nuniform mat4 u_Bones[24];\r\n\r\n\t#ifdef SIMPLEBONE\r\nuniform vec4 u_SimpleAnimatorParams;\r\nuniform sampler2D u_SimpleAnimatorTexture;\r\nuniform float u_SimpleAnimatorTextureSize;\r\n\t    #include \"BakedBoneMatrixSampler.glsl\";\r\n\r\n\t#endif // SIMPLEBONE\r\n\r\n    #endif // BONE\r\n\r\n/**\r\n * world matrix\r\n */\r\nmat4 getWorldMatrix()\r\n{\r\n    #ifdef GPU_INSTANCE\r\n    mat4 worldMat = a_WorldMat;\r\n    #else\r\n    mat4 worldMat = u_WorldMat;\r\n    #endif // GPU_INSTANCE\r\n\r\n    #ifdef BONE\r\n\r\n\t#ifdef SIMPLEBONE\r\n\r\n\t    #ifdef GPU_INSTANCE\r\n    float currentPixelPos = a_SimpleTextureParams.x + a_SimpleTextureParams.y;\r\n\t    #else // GPU_INSTANCE\r\n    float currentPixelPos = u_SimpleAnimatorParams.x + u_SimpleAnimatorParams.y;\r\n\t    #endif // GPU_INSTANCE\r\n\r\n    float offset = 1.0 / u_SimpleAnimatorTextureSize;\r\n    mat4 skinTrans = loadBakedMatMatrix(currentPixelPos, a_BoneIndices.x, offset) * a_BoneWeights.x;\r\n    skinTrans += loadBakedMatMatrix(currentPixelPos, a_BoneIndices.y, offset) * a_BoneWeights.y;\r\n    skinTrans += loadBakedMatMatrix(currentPixelPos, a_BoneIndices.z, offset) * a_BoneWeights.z;\r\n    skinTrans += loadBakedMatMatrix(currentPixelPos, a_BoneIndices.w, offset) * a_BoneWeights.w;\r\n    worldMat = worldMat * skinTrans;\r\n\r\n\t#else // SIMPLEBONE\r\n\r\n    ivec4 boneIndex = ivec4(a_BoneIndices);\r\n    mat4 skinTrans = u_Bones[boneIndex.x] * a_BoneWeights.x;\r\n    skinTrans += u_Bones[boneIndex.y] * a_BoneWeights.y;\r\n    skinTrans += u_Bones[boneIndex.z] * a_BoneWeights.z;\r\n    skinTrans += u_Bones[boneIndex.w] * a_BoneWeights.w;\r\n    worldMat = worldMat * skinTrans;\r\n\r\n\t#endif // SIMPLEBONE\r\n\r\n    #endif // BONE\r\n\r\n    return worldMat;\r\n}\r\n\r\nvec2 getSimpleBoneCustomData(){\r\n    vec2 custom;\r\n   #ifdef BONE\r\n    #ifdef SIMPLEBONE\r\n    #ifdef GPU_INSTANCE\r\n    custom=a_SimpleTextureParams.zw;\r\n    #else// GPU_INSTANCE\r\n    custom=u_SimpleAnimatorParams.zw;\r\n    #endif// GPU_INSTANCE\r\n    #endif// SIMPLEBONE\r\n  #endif // BONE\r\n    return custom;\r\n}\r\n\r\n#endif // Sprite3DVertex_lib","#if !defined(Sprite3DFrag_lib)\r\n    #define Sprite3DFrag_lib\r\n\r\n    #include \"Sprite3DCommon.glsl\";\r\n\r\n#endif // Sprite3DFrag_lib","#if !defined(DepthVertex_lib)\r\n    #define DepthVertex_lib\r\n    #include \"Math.glsl\";\r\n    #include \"Scene.glsl\";\r\n    #include \"Camera.glsl\";\r\n    #include \"Sprite3DVertex.glsl\";\r\n\r\n    #include \"VertexCommon.glsl\";\r\n\r\n    #if defined(SHADOW) || defined(SHADOW_SPOT)\r\n\r\n\t#ifndef DEPTHPASS\r\n\t    #ifdef ENUNIFORMBLOCK\r\nuniform ShadowUniformBlock\r\n{\r\n    vec4 u_ShadowBias; // x: depth bias, y: normal bias\r\n    vec3 u_ShadowLightDirection;\r\n};\r\n\t    #else // ENUNIFORMBLOCK\r\nuniform vec4 u_ShadowBias; // x: depth bias, y: normal bias\r\n\t\t#ifdef SHADOW\r\nuniform vec3 u_ShadowLightDirection;\r\n\t\t#endif // SHADOW\r\n\t    #endif // ENUNIFORMBLOCK\r\n\r\nvec3 applyShadowBias(vec3 positionWS, vec3 normalWS, vec3 lightDirection)\r\n{\r\n    float invNdotL = 1.0 - clamp(dot(-lightDirection, normalWS), 0.0, 1.0);\r\n    float scale = invNdotL * u_ShadowBias.y;\r\n\r\n    // normal bias is negative since we want to apply an inset normal offset\r\n    positionWS += -lightDirection * u_ShadowBias.xxx;\r\n    positionWS += normalWS * vec3(scale);\r\n    return positionWS;\r\n}\r\n\t#endif // DEPTHPASS\r\n    #endif // SHADOW || SHADOW_SPOT\r\n\r\n    #ifdef DEPTHPASS\r\n\t#include \"Camera.glsl\";\r\n    #endif // DEPTHPASS\r\n\r\nvec4 DepthPositionCS(in vec3 positionWS, in vec3 normalWS)\r\n{\r\n    #ifdef DEPTHPASS\r\n    vec4 positionCS = u_ViewProjection * vec4(positionWS, 1.0);\r\n    #endif // DEPTHPASS\r\n\r\n    #ifdef SHADOW\r\n\t#ifndef DEPTHPASS\r\n    positionWS = applyShadowBias(positionWS, normalWS, u_ShadowLightDirection);\r\n    vec4 positionCS = u_ViewProjection * vec4(positionWS, 1.0);\r\n    positionCS.z = max(positionCS.z, 0.0); // min ndc z is 0.0\r\n\t#endif // DEPTHPASS\r\n    #endif // SHADOW\r\n\r\n    #ifdef SHADOW_SPOT\r\n\t#ifndef DEPTHPASS\r\n    vec4 positionCS = u_ViewProjection * vec4(positionWS, 1.0);\r\n    positionCS.z = positionCS.z - u_ShadowBias.x / positionCS.w;\r\n    positionCS.z = max(positionCS.z, 0.0); // min ndc z is 0.0\r\n\t#endif // DEPTHPASS\r\n    #endif // SHADOW_SPOT\r\n\r\n    return positionCS;\r\n}\r\n\r\n#endif // DepthVertex_lib","#if !defined(DepthFrag_lib)\r\n    #define DepthFrag_lib\r\n\r\nvec4 getDepthColor()\r\n{\r\n    return vec4(0.0);\r\n}\r\n\r\n#endif // DepthFrag_lib","#define SAMPLE_DEPTH_TEXTURE(textureName, coord2) (texture2D(textureName, coord2).r)\r\n//\r\n\r\n// Encoding/decoding view space normals into 2D 0..1 vector\r\nvec2 EncodeViewNormalStereo(vec3 n)\r\n{\r\n    n.z = abs(n.z);\r\n    float kScale = 1.7777;\r\n    vec2 enc;\r\n    enc = n.xy / (n.z + 1.0);\r\n    enc /= kScale;\r\n    enc = enc * 0.5 + 0.5;\r\n    return enc;\r\n}\r\n\r\nvec3 DecodeViewNormalStereo(vec4 enc4)\r\n{\r\n    float kScale = 1.7777;\r\n    vec3 nn = enc4.xyz * vec3(2.0 * kScale, 2.0 * kScale, 0.0) + vec3(-kScale, -kScale, 1.0);\r\n    float g = 2.0 / dot(nn.xyz, nn.xyz);\r\n    vec3 n;\r\n    n.xy = g * nn.xy;\r\n    n.z = g - 1.0;\r\n    return n;\r\n}\r\n\r\n// Encoding/decoding [0..1) floats into 8 bit/channel RG. Note that 1.0 will not be encoded properly.\r\nvec2 EncodeFloatRG(float v)\r\n{\r\n    vec2 kEncodeMul = vec2(1.0, 255.0);\r\n    float kEncodeBit = 1.0 / 255.0;\r\n    vec2 enc = kEncodeMul * v;\r\n    enc = fract(enc);\r\n    enc.x -= enc.y * kEncodeBit;\r\n    return enc;\r\n}\r\n\r\nfloat DecodeFloatRG(vec2 enc)\r\n{\r\n    vec2 kDecodeDot = vec2(1.0, 1.0 / 255.0);\r\n    return dot(enc, kDecodeDot);\r\n}\r\n\r\nvec4 EncodeDepthNormal(float depth, vec3 normals)\r\n{\r\n    vec4 encode;\r\n    encode.xy = EncodeViewNormalStereo(normals);\r\n    encode.zw = EncodeFloatRG(depth);\r\n    return encode;\r\n}\r\n\r\nvoid DecodeDepthNormal(vec4 enc, out float depth, out vec3 normal)\r\n{\r\n    depth = DecodeFloatRG(enc.zw);\r\n    normal = DecodeViewNormalStereo(enc);\r\n}\r\n\r\nvec4 depthNormalsFragment(vec4 depthNormal)\r\n{\r\n    return EncodeDepthNormal(depthNormal.w, depthNormal.xyz);\r\n}\r\n\r\n// Z buffer to linear 0..1 depth\r\nfloat Linear01Depth(float z, vec4 zbufferParams)\r\n{\r\n    return 1.0 / (zbufferParams.x * z + zbufferParams.y);\r\n}\r\n// Z buffer to linear depth\r\nfloat LinearEyeDepth(float z, vec4 zbufferParams)\r\n{\r\n    return 1.0 / (zbufferParams.z * z + zbufferParams.w);\r\n}\r\n","#if !defined(DepthNormalFrag_lib)\r\n    #define DepthNormalFrag_lib\r\n\r\n    #include \"DepthNormalUtil.glsl\";\r\n\r\nvec4 encodeDepthNormal(const in vec4 positionCS, const in vec3 normalWS)\r\n{\r\n    float depth = (positionCS.z * 2.0 - positionCS.w) * u_ProjectionParams.w;\r\n\r\n    vec3 normalVS = mat3(u_View) * normalWS;\r\n\r\n    return EncodeDepthNormal(depth, normalVS);\r\n}\r\n\r\n#endif // DepthNormalFrag_lib","#if !defined(SceneFog_lib)\r\n    #define SceneFog_lib\r\n\r\n    #ifdef FOG\r\nvarying float v_fogFactor;\r\nfloat getFogFactor()\r\n{\r\n    return v_fogFactor;\r\n}\r\n\r\nvec3 scenUnlitFog(in vec3 color)\r\n{\r\n    float lerpFact = getFogFactor();\r\n\t#ifdef ADDTIVEFOG\r\n    lerpFact = clamp(lerpFact, 0.0, 1.0);\r\n    return mix(vec3(0.0), color, lerpFact);\r\n\t#else\r\n    lerpFact = clamp(lerpFact, 0.0, 1.0);\r\n    return mix(u_FogColor.rgb, color, lerpFact);\r\n\t#endif // ADDTIVEFOG\r\n}\r\n\r\nvec3 sceneLitFog(in vec3 color)\r\n{\r\n    float lerpFact = getFogFactor();\r\n    lerpFact = clamp(lerpFact, 0.0, 1.0);\r\n    return mix(u_FogColor.rgb, color, lerpFact);\r\n}\r\n\r\n    #endif\r\n#endif // SceneFog_lib","#if !defined(SceneFog_lib)\r\n    #define SceneFog_lib\r\n\r\n    #ifdef FOG\r\nvarying float v_fogFactor;\r\nvoid FogHandle(in float fact)\r\n{\r\n    float lerpFact = 0.0;\r\n\t#ifdef FOG_EXP\r\n    lerpFact = fact * (u_FogParams.z / log(2.0));\r\n    lerpFact = exp2(-lerpFact);\r\n\t#elif defined(FOG_EXP2)\r\n    lerpFact = fact * (u_FogParams.z / sqrt(log(2.0)));\r\n    lerpFact = exp2(-lerpFact);\r\n\t#else // default FOG_LINEAR\r\n    lerpFact = (-1.0 * fact / (u_FogParams.y - u_FogParams.x) + u_FogParams.y / (u_FogParams.y - u_FogParams.x));\r\n\t#endif\r\n    v_fogFactor = lerpFact;\r\n}\r\n    #endif\r\n#endif // SceneFog_lib","// ------------------------------------------------------------------\r\n//  PCF Filtering Tent Functions\r\n// ------------------------------------------------------------------\r\n\r\n// Assuming a isoceles right angled triangle of height \"triangleHeight\" (as drawn below).\r\n// This function return the area of the triangle above the first texel(in Y the first texel).\r\n//\r\n// |\\      <-- 45 degree slop isosceles right angled triangle\r\n// | \\\r\n// ----    <-- length of this side is \"triangleHeight\"\r\n// _ _ _ _ <-- texels\r\nfloat sampleShadowGetIRTriangleTexelArea(float triangleHeight)\r\n{\r\n    return triangleHeight - 0.5;\r\n}\r\n\r\n// Assuming a isoceles triangle of 1.5 texels height and 3 texels wide lying on 4 texels.\r\n// This function return the area of the triangle above each of those texels.\r\n//    |    <-- offset from -0.5 to 0.5, 0 meaning triangle is exactly in the center\r\n//   / \\   <-- 45 degree slop isosceles triangle (ie tent projected in 2D)\r\n//  /   \\\r\n// _ _ _ _ <-- texels\r\n// X Y Z W <-- result indices (in computedArea.xyzw and computedAreaUncut.xyzw)\r\n// Top point at (right,top) in a texel,left bottom point at (middle,middle) in a texel,right bottom point at (middle,middle) in a texel.\r\nvoid sampleShadowGetTexelAreasTent3x3(float offset, out vec4 computedArea, out vec4 computedAreaUncut)\r\n{\r\n    // Compute the exterior areas,a and h is same.\r\n    float a = offset + 0.5;\r\n    float offsetSquaredHalved = a * a * 0.5;\r\n    computedAreaUncut.x = computedArea.x = offsetSquaredHalved - offset;\r\n    computedAreaUncut.w = computedArea.w = offsetSquaredHalved;\r\n\r\n    // Compute the middle areas\r\n    // For Y : We find the area in Y of as if the left section of the isoceles triangle would\r\n    // intersect the axis between Y and Z (ie where offset = 0).\r\n    computedAreaUncut.y = sampleShadowGetIRTriangleTexelArea(1.5 - offset);\r\n    // This area is superior to the one we are looking for if (offset < 0) thus we need to\r\n    // subtract the area of the triangle defined by (0,1.5-offset), (0,1.5+offset), (-offset,1.5).\r\n    float clampedOffsetLeft = min(offset,0.0);\r\n    float areaOfSmallLeftTriangle = clampedOffsetLeft * clampedOffsetLeft;\r\n    computedArea.y = computedAreaUncut.y - areaOfSmallLeftTriangle;\r\n\r\n    // We do the same for the Z but with the right part of the isoceles triangle\r\n    computedAreaUncut.z = sampleShadowGetIRTriangleTexelArea(1.5 + offset);\r\n    float clampedOffsetRight = max(offset,0.0);\r\n    float areaOfSmallRightTriangle = clampedOffsetRight * clampedOffsetRight;\r\n    computedArea.z = computedAreaUncut.z - areaOfSmallRightTriangle;\r\n}\r\n\r\n// Assuming a isoceles triangle of 2.5 texel height and 5 texels wide lying on 6 texels.\r\n// This function return the weight of each texels area relative to the full triangle area.\r\n//  /       \\\r\n// _ _ _ _ _ _ <-- texels\r\n// 0 1 2 3 4 5 <-- computed area indices (in texelsWeights[])\r\n// Top point at (right,top) in a texel,left bottom point at (middle,middle) in a texel,right bottom point at (middle,middle) in a texel.\r\nvoid sampleShadowGetTexelWeightsTent5x5(float offset, out vec3 texelsWeightsA, out vec3 texelsWeightsB)\r\n{\r\n    vec4 areaFrom3texelTriangle;\r\n    vec4 areaUncutFrom3texelTriangle;\r\n    sampleShadowGetTexelAreasTent3x3(offset, areaFrom3texelTriangle, areaUncutFrom3texelTriangle);\r\n\r\n    // Triangle slope is 45 degree thus we can almost reuse the result of the 3 texel wide computation.\r\n    // the 5 texel wide triangle can be seen as the 3 texel wide one but shifted up by one unit/texel.\r\n    // 0.16 is 1/(the triangle area)\r\n    texelsWeightsA.x = 0.16 * (areaFrom3texelTriangle.x);\r\n    texelsWeightsA.y = 0.16 * (areaUncutFrom3texelTriangle.y);\r\n    texelsWeightsA.z = 0.16 * (areaFrom3texelTriangle.y + 1.0);\r\n    texelsWeightsB.x = 0.16 * (areaFrom3texelTriangle.z + 1.0);\r\n    texelsWeightsB.y = 0.16 * (areaUncutFrom3texelTriangle.z);\r\n    texelsWeightsB.z = 0.16 * (areaFrom3texelTriangle.w);\r\n}\r\n\r\n// 5x5 Tent filter (45 degree sloped triangles in U and V)\r\nvoid sampleShadowComputeSamplesTent5x5(vec4 shadowMapTextureTexelSize, vec2 coord, out float fetchesWeights[9], out vec2 fetchesUV[9])\r\n{\r\n    // tent base is 5x5 base thus covering from 25 to 36 texels, thus we need 9 bilinear PCF fetches\r\n    vec2 tentCenterInTexelSpace = coord.xy * shadowMapTextureTexelSize.zw;\r\n    vec2 centerOfFetchesInTexelSpace = floor(tentCenterInTexelSpace + 0.5);\r\n    vec2 offsetFromTentCenterToCenterOfFetches = tentCenterInTexelSpace - centerOfFetchesInTexelSpace;\r\n\r\n    // find the weight of each texel based on the area of a 45 degree slop tent above each of them.\r\n    vec3 texelsWeightsUA, texelsWeightsUB;\r\n    vec3 texelsWeightsVA, texelsWeightsVB;\r\n    sampleShadowGetTexelWeightsTent5x5(offsetFromTentCenterToCenterOfFetches.x, texelsWeightsUA, texelsWeightsUB);\r\n    sampleShadowGetTexelWeightsTent5x5(offsetFromTentCenterToCenterOfFetches.y, texelsWeightsVA, texelsWeightsVB);\r\n\r\n    // each fetch will cover a group of 2x2 texels, the weight of each group is the sum of the weights of the texels\r\n    vec3 fetchesWeightsU = vec3(texelsWeightsUA.xz, texelsWeightsUB.y) + vec3(texelsWeightsUA.y, texelsWeightsUB.xz);\r\n    vec3 fetchesWeightsV = vec3(texelsWeightsVA.xz, texelsWeightsVB.y) + vec3(texelsWeightsVA.y, texelsWeightsVB.xz);\r\n\r\n    // move the PCF bilinear fetches to respect texels weights\r\n    vec3 fetchesOffsetsU = vec3(texelsWeightsUA.y, texelsWeightsUB.xz) / fetchesWeightsU.xyz + vec3(-2.5,-0.5,1.5);\r\n    vec3 fetchesOffsetsV = vec3(texelsWeightsVA.y, texelsWeightsVB.xz) / fetchesWeightsV.xyz + vec3(-2.5,-0.5,1.5);\r\n    fetchesOffsetsU *= shadowMapTextureTexelSize.xxx;\r\n    fetchesOffsetsV *= shadowMapTextureTexelSize.yyy;\r\n\r\n    vec2 bilinearFetchOrigin = centerOfFetchesInTexelSpace * shadowMapTextureTexelSize.xy;\r\n    fetchesUV[0] = bilinearFetchOrigin + vec2(fetchesOffsetsU.x, fetchesOffsetsV.x);\r\n    fetchesUV[1] = bilinearFetchOrigin + vec2(fetchesOffsetsU.y, fetchesOffsetsV.x);\r\n    fetchesUV[2] = bilinearFetchOrigin + vec2(fetchesOffsetsU.z, fetchesOffsetsV.x);\r\n    fetchesUV[3] = bilinearFetchOrigin + vec2(fetchesOffsetsU.x, fetchesOffsetsV.y);\r\n    fetchesUV[4] = bilinearFetchOrigin + vec2(fetchesOffsetsU.y, fetchesOffsetsV.y);\r\n    fetchesUV[5] = bilinearFetchOrigin + vec2(fetchesOffsetsU.z, fetchesOffsetsV.y);\r\n    fetchesUV[6] = bilinearFetchOrigin + vec2(fetchesOffsetsU.x, fetchesOffsetsV.z);\r\n    fetchesUV[7] = bilinearFetchOrigin + vec2(fetchesOffsetsU.y, fetchesOffsetsV.z);\r\n    fetchesUV[8] = bilinearFetchOrigin + vec2(fetchesOffsetsU.z, fetchesOffsetsV.z);\r\n\r\n    fetchesWeights[0] = fetchesWeightsU.x * fetchesWeightsV.x;\r\n    fetchesWeights[1] = fetchesWeightsU.y * fetchesWeightsV.x;\r\n    fetchesWeights[2] = fetchesWeightsU.z * fetchesWeightsV.x;\r\n    fetchesWeights[3] = fetchesWeightsU.x * fetchesWeightsV.y;\r\n    fetchesWeights[4] = fetchesWeightsU.y * fetchesWeightsV.y;\r\n    fetchesWeights[5] = fetchesWeightsU.z * fetchesWeightsV.y;\r\n    fetchesWeights[6] = fetchesWeightsU.x * fetchesWeightsV.z;\r\n    fetchesWeights[7] = fetchesWeightsU.y * fetchesWeightsV.z;\r\n    fetchesWeights[8] = fetchesWeightsU.z * fetchesWeightsV.z;\r\n}","#if !defined(ShadowSampler_lib)\r\n    #define ShadowSampler_lib\r\n\r\n    #ifndef GRAPHICS_API_GLES3\r\n\t#define NO_NATIVE_SHADOWMAP\r\n    #endif // GRAPHICS_API_GLES3\r\n\r\n    #if defined(NO_NATIVE_SHADOWMAP)\r\n\t#define TEXTURE2D_SHADOW(textureName)\t\t     uniform mediump sampler2D textureName\r\n\t#define SAMPLE_TEXTURE2D_SHADOW(textureName, coord3) (texture2D(textureName, coord3.xy).r < coord3.z ? 0.0 : 1.0)\r\n\t#define TEXTURE2D_SHADOW_PARAM(shadowMap)\t     mediump sampler2D shadowMap\r\n    #else // NO_NATIVE_SHADOWMAP\r\n\t#define TEXTURE2D_SHADOW(textureName)\t\t     uniform mediump sampler2DShadow textureName\r\n\t#define SAMPLE_TEXTURE2D_SHADOW(textureName, coord3) textureLod(textureName, coord3, 0.0)\r\n\t#define TEXTURE2D_SHADOW_PARAM(shadowMap)\t     mediump sampler2DShadow shadowMap\r\n    #endif // NO_NATIVE_SHADOWMAP\r\n\r\n    // \r\n    #ifdef RECEIVESHADOW\r\n\r\n\t#include \"ShadowSampleTent.glsl\";\r\n\r\nuniform vec4 u_ShadowParams;\r\n\r\n\t#define ShadowStrength\t   u_ShadowParams.x\r\n\t#define SpotShadowStrength u_ShadowParams.y\r\n\r\n    // \r\n\t#ifdef SHADOW\r\n\t    #define CALCULATE_SHADOWS\r\nvarying vec4 v_ShadowCoord;\r\nTEXTURE2D_SHADOW(u_ShadowMap);\r\nuniform vec4 u_ShadowMapSize;\r\n\r\n#ifdef SHADOW_CASCADE\r\nconst int c_MaxCascadeCount = 4;\r\n#else //SHADOW_CASCADE\r\nconst int c_MaxCascadeCount = 1;\r\n#endif//SHADOW_CASCADE\r\n\r\nuniform mat4 u_ShadowMatrices[c_MaxCascadeCount];\r\nuniform vec4 u_ShadowSplitSpheres[c_MaxCascadeCount];\r\n\t#endif // SHADOW\r\n\r\n\t// \r\n\t#ifdef SHADOW_SPOT\r\n\t    #define CALCULATE_SPOTSHADOWS\r\nvarying vec4 v_SpotShadowCoord;\r\nTEXTURE2D_SHADOW(u_SpotShadowMap);\r\nuniform vec4 u_SpotShadowMapSize;\r\nuniform mat4 u_SpotViewProjectMatrix;\r\n\t#endif // SHADOW_SPOT\r\n\r\nfloat sampleShdowMapFiltered4(TEXTURE2D_SHADOW_PARAM(shadowMap), vec3 shadowCoord, vec4 shadowMapSize)\r\n{\r\n    float attenuation;\r\n    vec4 attenuation4;\r\n    vec2 offset = shadowMapSize.xy / 2.0;\r\n    vec3 shadowCoord0 = shadowCoord + vec3(-offset, 0.0);\r\n    vec3 shadowCoord1 = shadowCoord + vec3(offset.x, -offset.y, 0.0);\r\n    vec3 shadowCoord2 = shadowCoord + vec3(-offset.x, offset.y, 0.0);\r\n    vec3 shadowCoord3 = shadowCoord + vec3(offset, 0.0);\r\n    attenuation4.x = SAMPLE_TEXTURE2D_SHADOW(shadowMap, shadowCoord0);\r\n    attenuation4.y = SAMPLE_TEXTURE2D_SHADOW(shadowMap, shadowCoord1);\r\n    attenuation4.z = SAMPLE_TEXTURE2D_SHADOW(shadowMap, shadowCoord2);\r\n    attenuation4.w = SAMPLE_TEXTURE2D_SHADOW(shadowMap, shadowCoord3);\r\n    attenuation = dot(attenuation4, vec4(0.25));\r\n    return attenuation;\r\n}\r\n\r\nfloat sampleShdowMapFiltered9(TEXTURE2D_SHADOW_PARAM(shadowMap), vec3 shadowCoord, vec4 shadowmapSize)\r\n{\r\n    float attenuation;\r\n    float fetchesWeights[9];\r\n    vec2 fetchesUV[9];\r\n    sampleShadowComputeSamplesTent5x5(shadowmapSize, shadowCoord.xy, fetchesWeights, fetchesUV);\r\n    attenuation = fetchesWeights[0] * SAMPLE_TEXTURE2D_SHADOW(shadowMap, vec3(fetchesUV[0].xy, shadowCoord.z));\r\n    attenuation += fetchesWeights[1] * SAMPLE_TEXTURE2D_SHADOW(shadowMap, vec3(fetchesUV[1].xy, shadowCoord.z));\r\n    attenuation += fetchesWeights[2] * SAMPLE_TEXTURE2D_SHADOW(shadowMap, vec3(fetchesUV[2].xy, shadowCoord.z));\r\n    attenuation += fetchesWeights[3] * SAMPLE_TEXTURE2D_SHADOW(shadowMap, vec3(fetchesUV[3].xy, shadowCoord.z));\r\n    attenuation += fetchesWeights[4] * SAMPLE_TEXTURE2D_SHADOW(shadowMap, vec3(fetchesUV[4].xy, shadowCoord.z));\r\n    attenuation += fetchesWeights[5] * SAMPLE_TEXTURE2D_SHADOW(shadowMap, vec3(fetchesUV[5].xy, shadowCoord.z));\r\n    attenuation += fetchesWeights[6] * SAMPLE_TEXTURE2D_SHADOW(shadowMap, vec3(fetchesUV[6].xy, shadowCoord.z));\r\n    attenuation += fetchesWeights[7] * SAMPLE_TEXTURE2D_SHADOW(shadowMap, vec3(fetchesUV[7].xy, shadowCoord.z));\r\n    attenuation += fetchesWeights[8] * SAMPLE_TEXTURE2D_SHADOW(shadowMap, vec3(fetchesUV[8].xy, shadowCoord.z));\r\n    return attenuation;\r\n}\r\n    #endif // RECEIVESHADOW\r\n\r\n    // \r\n    #if defined(CALCULATE_SHADOWS)\r\n\r\n#ifdef SHADOW_CASCADE\r\n// \r\nmediump int computeCascadeIndex(in vec3 positionWS)\r\n{\r\n    vec3 fromCenter0 = positionWS - u_ShadowSplitSpheres[0].xyz;\r\n    vec3 fromCenter1 = positionWS - u_ShadowSplitSpheres[1].xyz;\r\n    vec3 fromCenter2 = positionWS - u_ShadowSplitSpheres[2].xyz;\r\n    vec3 fromCenter3 = positionWS - u_ShadowSplitSpheres[3].xyz;\r\n\r\n    mediump vec4 comparison = vec4(dot(fromCenter0, fromCenter0) < u_ShadowSplitSpheres[0].w,\r\n\tdot(fromCenter1, fromCenter1) < u_ShadowSplitSpheres[1].w,\r\n\tdot(fromCenter2, fromCenter2) < u_ShadowSplitSpheres[2].w,\r\n\tdot(fromCenter3, fromCenter3) < u_ShadowSplitSpheres[3].w);\r\n\r\n    comparison.yzw = clamp(comparison.yzw - comparison.xyz, 0.0, 1.0); // keep the nearest\r\n    mediump vec4 indexCoefficient = vec4(4.0, 3.0, 2.0, 1.0);\r\n    mediump int index = 4 - int(dot(comparison, indexCoefficient));\r\n    return index;\r\n}\r\n#endif\r\n\r\n// \r\nvec4 getShadowCoord(in vec3 positionWS)\r\n{\r\n\t#ifdef SHADOW_CASCADE\r\n    mediump int cascadeIndex = computeCascadeIndex(positionWS);\r\n\t    #ifdef GRAPHICS_API_GLES3\r\n    mat4 shadowMat = u_ShadowMatrices[cascadeIndex];\r\n\t    #else // GRAPHICS_API_GLES3\r\n    mat4 shadowMat;\r\n    if (cascadeIndex == 0)\r\n\t{\r\n\t    shadowMat = u_ShadowMatrices[0];\r\n\t}\r\n    else if (cascadeIndex == 1)\r\n\t{\r\n\t    shadowMat = u_ShadowMatrices[1];\r\n\t}\r\n    else if (cascadeIndex == 2)\r\n\t{\r\n\t    shadowMat = u_ShadowMatrices[2];\r\n\t}\r\n    else\r\n\t{\r\n\t    shadowMat = u_ShadowMatrices[3];\r\n\t}\r\n\t    #endif // GRAPHICS_API_GLES3\r\n\r\n    return shadowMat * vec4(positionWS, 1.0);\r\n\r\n\t#else // SHADOW_CASCADE\r\n\r\n    return u_ShadowMatrices[0] * vec4(positionWS, 1.0);\r\n\r\n\t#endif // SHADOW_CASCADE\r\n}\r\n\r\n// \r\nfloat sampleShadowmap(in vec4 shadowCoord)\r\n{\r\n    float attenuation = 1.0;\r\n\r\n    vec3 coord = shadowCoord.xyz / shadowCoord.w;\r\n\r\n    vec4 shadowmapSize = u_ShadowMapSize;\r\n\r\n    if (coord.z > 0.0 && coord.z < 1.0)\r\n\t{\r\n\t#if defined(SHADOW_SOFT_SHADOW_HIGH)\r\n\t    attenuation = sampleShdowMapFiltered9(u_ShadowMap, coord, shadowmapSize);\r\n\t#elif defined(SHADOW_SOFT_SHADOW_LOW)\r\n\t    attenuation = sampleShdowMapFiltered4(u_ShadowMap, coord, shadowmapSize);\r\n\t#else // hard\r\n\t    attenuation = SAMPLE_TEXTURE2D_SHADOW(u_ShadowMap, coord);\r\n\t#endif // SHADOW_SOFT_SHADOW_HIGH\r\n\t    attenuation = mix(1.0, attenuation, ShadowStrength);\r\n\t}\r\n\r\n    return attenuation;\r\n}\r\n\r\n    #endif // CALCULATE_SHADOWS\r\n\r\n    //   \r\n    #if defined(CALCULATE_SPOTSHADOWS)\r\n\r\n// \r\nvec4 getSpotShadowCoord(in vec3 positionWS)\r\n{\r\n    vec4 coordinate = u_SpotViewProjectMatrix * vec4(positionWS, 1.0);\r\n\r\n    return coordinate;\r\n}\r\n\r\n// \r\nfloat sampleSpotShadowmap(vec4 shadowCoord)\r\n{\r\n    float attenuation = 1.0;\r\n\r\n    vec3 coord = shadowCoord.xyz / shadowCoord.w;\r\n    coord.xy = coord.xy * 0.5 + 0.5;\r\n\r\n    vec4 shadowmapSize = u_SpotShadowMapSize;\r\n    // todo\r\n    if (coord.z > 0.0 && coord.z < 1.0)\r\n\t{\r\n\t#if defined(SHADOW_SPOT_SOFT_SHADOW_HIGH)\r\n\t    attenuation = sampleShdowMapFiltered9(u_SpotShadowMap, coord, shadowmapSize);\r\n\t#elif defined(SHADOW_SPOT_SOFT_SHADOW_LOW)\r\n\t    attenuation = sampleShdowMapFiltered4(u_SpotShadowMap, coord, shadowmapSize);\r\n\t#else // hard\r\n\t    attenuation = SAMPLE_TEXTURE2D_SHADOW(u_SpotShadowMap, coord);\r\n\t#endif\r\n\t    attenuation = mix(1.0, attenuation, SpotShadowStrength);\r\n\t}\r\n\r\n    return attenuation;\r\n}\r\n\r\n    #endif // CALCULATE_SPOTSHADOWS\r\n\r\n#endif // ShadowSampler_lib","#if !defined(Lighting_lib)\r\n    #define Lighting_lib\r\n\r\n    #include \"ShadowSampler.glsl\";\r\n\r\nstruct Light {\r\n    vec3 color;\r\n    vec3 dir;\r\n    float attenuation;\r\n};\r\n\r\nstruct DirectionLight {\r\n    vec3 color;\r\n    vec3 direction;\r\n    float attenuation;\r\n    int lightMode;\r\n};\r\n\r\nstruct PointLight {\r\n    vec3 color;\r\n    vec3 position;\r\n    float range;\r\n    float attenuation;\r\n    int lightMode;\r\n};\r\n\r\nstruct SpotLight {\r\n    vec3 color;\r\n    vec3 position;\r\n    float range;\r\n    vec3 direction;\r\n    float spot;\r\n    float attenuation;\r\n    int lightMode;\r\n};\r\n\r\n    #define LightMode_Mix      0\r\n    #define LightMode_RealTime 1\r\n\r\nint getAttenuationByMode(float lightMapMode)\r\n{\r\n    #ifdef LIGHTMAP // mix 0 realtime 1\r\n    return int(lightMapMode);\r\n    #else // LIGHTMAP\r\n\r\n\t#ifdef VOLUMETRICGI\r\n    return int(lightMapMode);\r\n\t#endif // VOLUMETRICGI\r\n\r\n    #endif // LIGHTMAP\r\n    return LightMode_RealTime;\r\n}\r\n\r\n    #if defined(DIRECTIONLIGHT) || defined(POINTLIGHT) || defined(SPOTLIGHT)\r\n\r\n\t#define LIGHTING\r\n\r\n// \r\nfloat attenuation(in vec3 L, in float invLightRadius)\r\n{\r\n    float fRatio = clamp(length(L) * invLightRadius, 0.0, 1.0);\r\n    fRatio *= fRatio;\r\n    return 1.0 / (1.0 + 25.0 * fRatio) * clamp(4.0 * (1.0 - fRatio), 0.0, 1.0);\r\n}\r\n\r\n// \r\nLight getLight(in DirectionLight directionLight)\r\n{\r\n    Light light;\r\n    light.color = directionLight.color;\r\n    light.dir = directionLight.direction;\r\n    light.attenuation = directionLight.attenuation;\r\n    return light;\r\n}\r\n\r\n// \r\nLight getLight(in PointLight pointLight, in vec3 normalWS, in vec3 positionWS)\r\n{\r\n    vec3 lightDirection = positionWS - pointLight.position;\r\n    float rangeAttenuate = attenuation(lightDirection, 1.0 / pointLight.range);\r\n\r\n    Light light;\r\n    light.color = pointLight.color * rangeAttenuate;\r\n    light.dir = normalize(lightDirection);\r\n    light.attenuation = pointLight.attenuation;\r\n    return light;\r\n}\r\n\r\n// \r\nLight getLight(in SpotLight spotLight, in vec3 normalWS, in vec3 positionWS)\r\n{\r\n    vec3 lightDirection = positionWS - spotLight.position;\r\n    vec3 normalizeLightDir = normalize(lightDirection);\r\n\r\n    vec2 cosAngles = cos(vec2(spotLight.spot, spotLight.spot * 0.5) * 0.5);\r\n    float dirAttenuate = dot(spotLight.direction, normalizeLightDir);\r\n    dirAttenuate *= smoothstep(cosAngles.x, cosAngles.y, dirAttenuate);\r\n\r\n    float rangeAttenuate = attenuation(lightDirection, 1.0 / spotLight.range);\r\n\r\n    Light light;\r\n    light.color = spotLight.color * rangeAttenuate * dirAttenuate;\r\n    light.dir = normalizeLightDir;\r\n    light.attenuation = spotLight.attenuation;\r\n    return light;\r\n}\r\n\r\n\t#ifdef LEGACYSINGLELIGHTING\r\n\t    #define CalculateLightCount 1\r\n\t    #define DirectionCount\t1\r\n\r\n\t    #ifdef DIRECTIONLIGHT\r\nuniform DirectionLight u_DirectionLight;\r\n\t    #endif // DIRECTIONLIGHT\r\n\r\n\t    #ifdef POINTLIGHT\r\nuniform PointLight u_PointLight;\r\n\t    #endif // POINTLIGHT\r\n\r\n\t    #ifdef SPOTLIGHT\r\nuniform SpotLight u_SpotLight;\r\n\t    #endif // SPOTLIGHT\r\n\r\n\t#else // LEGACYSINGLELIGHTING\r\n\t    #define CalculateLightCount MAX_LIGHT_COUNT\r\n\t    #define DirectionCount\tu_DirationLightCount\r\n\r\nuniform sampler2D u_LightBuffer;\r\n\r\n\t    #ifdef DIRECTIONLIGHT\r\nuniform mediump int u_DirationLightCount;\r\n\t    #endif\r\n\r\n\t    #if defined(POINTLIGHT) || defined(SPOTLIGHT)\r\nconst int c_ClusterBufferWidth = CLUSTER_X_COUNT * CLUSTER_Y_COUNT;\r\nconst int c_ClusterBufferHeight = CLUSTER_Z_COUNT * (1 + int(ceil(float(MAX_LIGHT_COUNT_PER_CLUSTER) / 4.0)));\r\nconst int c_ClusterBufferFloatWidth = c_ClusterBufferWidth * 4;\r\nuniform sampler2D u_LightClusterBuffer;\r\n\r\nint getLightIndex(in int offset, in int index)\r\n{\r\n    int totalOffset = offset + index;\r\n    int row = totalOffset / c_ClusterBufferFloatWidth;\r\n    int lastRowFloat = totalOffset - row * c_ClusterBufferFloatWidth;\r\n    int col = lastRowFloat / 4;\r\n    vec2 uv = vec2((float(col) + 0.5) / float(c_ClusterBufferWidth), (float(row) + 0.5) / float(c_ClusterBufferHeight));\r\n    vec4 texPixel = texture2D(u_LightClusterBuffer, uv);\r\n    int pixelComponent = lastRowFloat - col * 4;\r\n\r\n\t\t#ifdef GRAPHICS_API_GLES3\r\n    return int(texPixel[pixelComponent]);\r\n\t\t#else\r\n    if (pixelComponent == 0)\r\n\treturn int(texPixel.x);\r\n    else if (pixelComponent == 1)\r\n\treturn int(texPixel.y);\r\n    else if (pixelComponent == 2)\r\n\treturn int(texPixel.z);\r\n    else\r\n\treturn int(texPixel.w);\r\n\t\t#endif\r\n}\r\n\t    #endif // POINTLIGHT || SPOTLIGHT\r\n\r\n\t#endif // LEGACYSINGLELIGHTING\r\n\r\n\t#ifdef DIRECTIONLIGHT\r\nDirectionLight getDirectionLight(in int index, in vec3 positionWS)\r\n{\r\n    DirectionLight light;\r\n\t    #ifdef LEGACYSINGLELIGHTING\r\n    light.color = u_DirectionLight.color;\r\n    light.direction = u_DirectionLight.direction;\r\n    light.attenuation = 1.0;\r\n    light.lightMode = getAttenuationByMode(float(u_DirectionLight.lightMode));\r\n\t    #else // LEGACYSINGLELIGHTING\r\n    float v = (float(index) + 0.5) / float(CalculateLightCount);\r\n    vec4 p1 = texture2D(u_LightBuffer, vec2(0.125, v));\r\n    vec4 p2 = texture2D(u_LightBuffer, vec2(0.375, v));\r\n    light.color = p1.rgb;\r\n    light.direction = p2.rgb;\r\n    light.attenuation = 1.0;\r\n    light.lightMode = getAttenuationByMode(p1.a);\r\n\t    #endif // LEGACYSINGLELIGHTING\r\n\r\n\t    #if defined(CALCULATE_SHADOWS)\r\n    if (index == 0)\r\n\t{\r\n\t    vec4 shadowCoord = getShadowCoord(positionWS);\r\n\t    float shadowAttenuation = sampleShadowmap(shadowCoord);\r\n\t    light.attenuation = shadowAttenuation;\r\n\t}\r\n\t    #endif // CALCULATE_SHADOWS\r\n\r\n    return light;\r\n}\r\n\t#endif // DIRECTIONLIGHT\r\n\r\n\t#if defined(POINTLIGHT) || defined(SPOTLIGHT)\r\nivec4 getClusterInfo(mat4 viewMatrix, vec4 viewport, vec3 positionWS, vec4 fragCoord, vec4 projectParams)\r\n{\r\n\t    #ifdef LEGACYSINGLELIGHTING\r\n    return ivec4(1, 1, 0, 0);\r\n\t    #else // LEGACYSINGLELIGHTING\r\n    // todo    positionVS ?\r\n    vec3 viewPos = vec3(viewMatrix * vec4(positionWS, 1.0));\r\n    int clusterXIndex = int(floor(fragCoord.x / (float(viewport.z) / float(CLUSTER_X_COUNT))));\r\n    int clusterYIndex = int(floor((viewport.w * (projectParams.z < 0.0 ? 0.0 : 1.0) - fragCoord.y * projectParams.z) / (float(viewport.w) / float(CLUSTER_Y_COUNT))));\r\n    float zSliceParam = float(CLUSTER_Z_COUNT) / log2(projectParams.y / projectParams.x);\r\n    int clusterZIndex = int(floor(log2(-viewPos.z) * zSliceParam - log2(projectParams.x) * zSliceParam));\r\n    // todo \r\n    vec2 uv = vec2((float(clusterXIndex + clusterYIndex * CLUSTER_X_COUNT) + 0.5) / float(c_ClusterBufferWidth), (float(clusterZIndex) + 0.5) / float(c_ClusterBufferHeight));\r\n    vec4 clusterPixel = texture2D(u_LightClusterBuffer, uv);\r\n    return ivec4(clusterPixel); // X:Point Count Y:Spot Count ZW:Light Offset\r\n\t    #endif // LEGACYSINGLELIGHTING\r\n}\r\n\t#endif // POINTLIGHT || SPOTLIGHT\r\n\r\n\t#ifdef POINTLIGHT\r\nPointLight getPointLight(in int index, in ivec4 clusterInfo, in vec3 positionWS)\r\n{\r\n\r\n    PointLight light;\r\n\t    #ifdef LEGACYSINGLELIGHTING\r\n    light.color = u_PointLight.color;\r\n    light.position = u_PointLight.position;\r\n    light.range = u_PointLight.range;\r\n    light.attenuation = 1.0;\r\n    light.lightMode = getAttenuationByMode(float(u_PointLight.lightMode));\r\n\t    #else // LEGACYSINGLELIGHTING\r\n    // todo  \r\n    int indexOffset = clusterInfo.z * c_ClusterBufferFloatWidth + clusterInfo.w;\r\n    int pointIndex = getLightIndex(indexOffset, index);\r\n    float v = (float(pointIndex) + 0.5) / float(CalculateLightCount);\r\n    vec4 p1 = texture2D(u_LightBuffer, vec2(0.125, v));\r\n    vec4 p2 = texture2D(u_LightBuffer, vec2(0.375, v));\r\n    light.color = p1.rgb;\r\n    light.range = p1.a;\r\n    light.position = p2.rgb;\r\n    light.attenuation = 1.0;\r\n    light.lightMode = getAttenuationByMode(p2.a);\r\n\t    #endif // LEGACYSINGLELIGHTING\r\n    return light;\r\n}\r\n\t#endif // POINTLIGHT\r\n\r\n\t#ifdef SPOTLIGHT\r\nSpotLight getSpotLight(in int index, in ivec4 clusterInfo, in vec3 positionWS)\r\n{\r\n    SpotLight light;\r\n\r\n\t    #ifdef LEGACYSINGLELIGHTING\r\n    light.color = u_SpotLight.color;\r\n    light.position = u_SpotLight.position;\r\n    light.range = u_SpotLight.range;\r\n    light.direction = u_SpotLight.direction;\r\n    light.spot = u_SpotLight.spot;\r\n    light.attenuation = 1.0;\r\n    light.lightMode = getAttenuationByMode(float(u_SpotLight.lightMode));\r\n\t    #else // LEGACYSINGLELIGHTING\r\n    // todo  \r\n    int indexOffset = clusterInfo.z * c_ClusterBufferFloatWidth + clusterInfo.w;\r\n    int spotIndex = getLightIndex(indexOffset, index + clusterInfo.x);\r\n    float v = (float(spotIndex) + 0.5) / float(CalculateLightCount);\r\n    vec4 p1 = texture2D(u_LightBuffer, vec2(0.125, v));\r\n    vec4 p2 = texture2D(u_LightBuffer, vec2(0.375, v));\r\n    vec4 p3 = texture2D(u_LightBuffer, vec2(0.625, v));\r\n    light.color = p1.rgb;\r\n    light.range = p1.a;\r\n    light.position = p2.rgb;\r\n    light.spot = p2.a;\r\n    light.direction = p3.rgb;\r\n    light.attenuation = 1.0;\r\n    light.lightMode = getAttenuationByMode(p3.a);\r\n\t    #endif // LEGACYSINGLELIGHTING\r\n\r\n\t    #if defined(CALCULATE_SPOTSHADOWS)\r\n    if (index == 0)\r\n\t{\r\n\t    vec4 shadowCoord = getSpotShadowCoord(positionWS);\r\n\t    float shadowAttenuation = sampleSpotShadowmap(shadowCoord);\r\n\t    light.attenuation = shadowAttenuation;\r\n\t}\r\n\t    #endif // CALCULATE_SPOTSHADOWS\r\n\r\n    return light;\r\n}\r\n\t#endif // SPOTLIGHT\r\n\r\n    #endif // DIRECTIONLIGHT || POINTLIGHT || SPOTLIGHT\r\n\r\n#endif // Lighting_lib","#if !defined(globalIllumination_lib)\r\n    #define globalIllumination_lib\r\n\r\n    #ifdef VOLUMETRICGI\r\n\t#include \"VolumetricGI.glsl\";\r\n    #endif // VOLUMETRICGI\r\n\r\nvec3 rotateByYAixs(in vec3 normal)\r\n{\r\n    float co = cos(u_GIRotate);\r\n    float si = sin(u_GIRotate);\r\n    float x = normal.x * co - normal.z * si;\r\n    float z = normal.x * si + normal.z * co;\r\n    return vec3(x, normal.y, z);\r\n}\r\n\r\nvec4 rotateByYAixs(in vec4 normal)\r\n{\r\n    float co = cos(u_GIRotate);\r\n    float si = sin(u_GIRotate);\r\n    float x = normal.x * co - normal.z * si;\r\n    float z = normal.x * si + normal.z * co;\r\n    return vec4(x, normal.y, z, normal.w);\r\n}\r\nuniform float u_AmbientIntensity;\r\nuniform float u_ReflectionIntensity;\r\n\r\n    #ifdef GI_IBL\r\n\r\nuniform vec3 u_IblSH[9];\r\n\r\nuniform samplerCube u_IBLTex;\r\nuniform float u_IBLRoughnessLevel;\r\n\r\n\t#define IBL_ROUGHNESS_LEVEL u_IBLRoughnessLevel\r\n\r\n// todo \r\nvec3 diffuseIrradiance(in vec3 normalWS)\r\n{\r\n    // todo cmeng  \r\n    vec3 n = normalWS * vec3(-1.0, 1.0, 1.0);\r\n    n = rotateByYAixs(n);\r\n    return max(\r\n\t       u_IblSH[0]\r\n\t\t   + u_IblSH[1] * n.y\r\n\t\t   + u_IblSH[2] * n.z\r\n\t\t   + u_IblSH[3] * n.x\r\n\t\t   + u_IblSH[4] * (n.y * n.x)\r\n\t\t   + u_IblSH[5] * (n.y * n.z)\r\n\t\t   + u_IblSH[6] * (3.0 * n.z * n.z - 1.0)\r\n\t\t   + u_IblSH[7] * (n.z * n.x)\r\n\t\t   + u_IblSH[8] * (n.x * n.x - n.y * n.y),\r\n\t       0.0)\r\n\t* u_AmbientIntensity;\r\n}\r\n\r\nvec3 diffuseIrradiance(in vec3 normalWS, in vec3 positionWS, in vec3 viewDir)\r\n{\r\n\t#ifdef VOLUMETRICGI\r\n    vec3 surfaceBias = VolumetricGISurfaceBias(normalWS, viewDir);\r\n    return VolumetricGIVolumeIrradiance(positionWS, surfaceBias, normalWS) * u_AmbientIntensity;\r\n\t#else // VOLUMETRICGI\r\n    return diffuseIrradiance(normalWS);\r\n\t#endif // VOLUMETRICGI\r\n}\r\n\r\nvec3 specularRadiance(in vec3 r, in float perceptualRoughness)\r\n{\r\n    float lod = IBL_ROUGHNESS_LEVEL * perceptualRoughness * (2.0 - perceptualRoughness);\r\n\r\n    // todo \r\n    vec3 reflectDir = r * vec3(-1.0, 1.0, 1.0);\r\n\r\n    // todo rotateY SceneConfig\r\n    reflectDir = rotateByYAixs(reflectDir);\r\n\r\n    // todo float  ?\r\n    vec4 reflectSampler = textureCubeLodEXT(u_IBLTex, reflectDir, lod);\r\n\r\n\t#ifdef IBL_RGBD\r\n    return decodeRGBD(reflectSampler) * u_ReflectionIntensity;\r\n\t#else // IBL_RGBD\r\n    return reflectSampler.rgb * u_ReflectionIntensity;\r\n\t#endif // IBL_RGBD\r\n}\r\n\r\n    #endif // GI_IBL\r\n\r\n    #ifdef GI_LEGACYIBL\r\n\r\nuniform vec4 u_AmbientSHAr;\r\nuniform vec4 u_AmbientSHAg;\r\nuniform vec4 u_AmbientSHAb;\r\nuniform vec4 u_AmbientSHBr;\r\nuniform vec4 u_AmbientSHBg;\r\nuniform vec4 u_AmbientSHBb;\r\nuniform vec4 u_AmbientSHC;\r\n\r\n\t#define LAYA_SPECCUBE_LOD_STEPS 6.0\r\nuniform samplerCube u_ReflectTexture;\r\nuniform vec4 u_ReflectCubeHDRParams;\r\n\r\nvec3 shEvalLinearL0L1(in vec4 normal)\r\n{\r\n    vec3 x;\r\n    x.r = dot(u_AmbientSHAr, normal);\r\n    x.g = dot(u_AmbientSHAg, normal);\r\n    x.b = dot(u_AmbientSHAb, normal);\r\n    return x;\r\n}\r\n\r\nvec3 shEvalLinearL2(in vec4 normal)\r\n{\r\n    vec3 x1, x2;\r\n    // 4 of the quadratic (L2) polynomials\r\n    vec4 vB = normal.xyzz * normal.yzzx;\r\n    x1.r = dot(u_AmbientSHBr, vB);\r\n    x1.g = dot(u_AmbientSHBg, vB);\r\n    x1.b = dot(u_AmbientSHBb, vB);\r\n\r\n    // Final (5th) quadratic (L2) polynomial\r\n    float vC = normal.x * normal.x - normal.y * normal.y;\r\n    x2 = u_AmbientSHC.rgb * vC;\r\n\r\n    return x1 + x2;\r\n}\r\n\r\nvec3 diffuseIrradiance(in vec3 normalWS)\r\n{\r\n    // todo -x \r\n    vec4 normal = vec4(-normalWS.x, normalWS.yz, 1.0);\r\n\r\n    // TODO rotate y SceneConfig\r\n\r\n    normal = rotateByYAixs(normal);\r\n\r\n    vec3 ambientContrib = shEvalLinearL0L1(normal);\r\n    ambientContrib += shEvalLinearL2(normal);\r\n    vec3 ambient = max(vec3(0.0), ambientContrib);\r\n\r\n    return ambient * u_AmbientIntensity;\r\n}\r\n\r\nvec3 diffuseIrradiance(in vec3 normalWS, in vec3 positionWS, in vec3 viewDir)\r\n{\r\n\t#ifdef VOLUMETRICGI\r\n    vec3 surfaceBias = VolumetricGISurfaceBias(normalWS, viewDir);\r\n    return VolumetricGIVolumeIrradiance(positionWS, surfaceBias, normalWS) * u_AmbientIntensity;\r\n\t#else // VOLUMETRICGI\r\n    return diffuseIrradiance(normalWS);\r\n\t#endif // VOLUMETRICGI\r\n}\r\n\r\nvec3 specularRadiance(in vec3 r, in float perceptualRoughness)\r\n{\r\n    float roughness = perceptualRoughness * (1.7 - 0.7 * perceptualRoughness);\r\n    // todo \r\n    r *= vec3(-1.0, 1.0, 1.0);\r\n    r = rotateByYAixs(r);\r\n\r\n    float lod = roughness * LAYA_SPECCUBE_LOD_STEPS;\r\n    vec4 rgbm = textureCubeLodEXT(u_ReflectTexture, r, lod);\r\n    float range = u_ReflectCubeHDRParams.x;\r\n    vec3 color = decodeRGBM(rgbm, range);\r\n    color = gammaToLinear(color);\r\n    return color * u_ReflectionIntensity;\r\n}\r\n\r\n    #endif // GI_LEGACYIBL\r\n\r\n    #ifndef GI_IBL\r\n\t#ifndef GI_LEGACYIBL\r\n\r\nuniform vec4 u_AmbientColor;\r\n\r\nvec3 diffuseIrradiance(in vec3 normalWS)\r\n{\r\n    return u_AmbientColor.rgb * u_AmbientIntensity;\r\n}\r\n\r\nvec3 diffuseIrradiance(in vec3 normalWS, in vec3 positionWS, in vec3 viewDir)\r\n{\r\n    return diffuseIrradiance(normalWS);\r\n}\r\n\r\nvec3 specularRadiance(in vec3 r, in float perceptualRoughness)\r\n{\r\n    // todo\r\n    return u_AmbientColor.rgb * u_ReflectionIntensity;\r\n}\r\n\r\n\t#endif // GI_LEGACYIBL\r\n    #endif // GI_IBL\r\n\r\n    #ifdef LIGHTMAP\r\n\r\n\t#ifdef UV1\r\n\t    #define USELIGHTMAP\r\n\t#endif // UV1\r\n\r\nuniform sampler2D u_LightMap;\r\n\r\n\t#ifdef LIGHTMAP_DIRECTIONAL\r\n\r\nuniform sampler2D u_LightMapDirection;\r\n\r\nvec3 DecodeDirectionalLightmap(in vec2 lightmapUV, in vec3 bakeColor, in vec3 normalWS)\r\n{\r\n    vec4 dirLightmap = texture2D(u_LightMapDirection, lightmapUV);\r\n    vec3 lightdir = normalize(dirLightmap.xyz - vec3(0.5)); // 0-1  => -0.5-0.5\r\n    //\r\n    float halfLambert = clamp(dot(normalWS, lightdir), 0.0, 1.0) * 0.5 + 0.5;\r\n    return bakeColor * halfLambert / max(dirLightmap.w, 0.001);\r\n}\r\n\r\n\t#endif // LIGHTMAP_DIRECTIONAL\r\n\r\nvec3 getBakedLightmapColor(in vec2 lightmapUV, in vec3 normalWS)\r\n{\r\n    vec4 lightmapSampler = texture2D(u_LightMap, lightmapUV);\r\n\t// todo lightmap rgbm encode color space\r\n    lightmapSampler.rgb =  decodeRGBM(lightmapSampler,5.0);\r\n\r\n\t//#ifdef Gamma_u_LightMap\r\n    lightmapSampler = gammaToLinear(lightmapSampler);\r\n\t//#endif // Gamma_u_LightMap\r\n\r\n\t#ifdef LIGHTMAP_DIRECTIONAL\r\n    lightmapSampler.rgb = DecodeDirectionalLightmap(lightmapUV, lightmapSampler.rgb, normalWS);\r\n\t#endif // LIGHTMAP_DIRECTIONAL\r\n\r\n    return lightmapSampler.rgb;\r\n}\r\n\r\n    #endif // LIGHTMAP\r\n\r\n    #ifdef SPECCUBE_BOX_PROJECTION\r\n\r\nuniform vec3 u_SpecCubeProbePosition;\r\nuniform vec3 u_SpecCubeBoxMax;\r\nuniform vec3 u_SpecCubeBoxMin;\r\n\r\nvec3 getBoxProjectionReflectedVector(vec3 r, vec3 positionWS)\r\n{\r\n    vec3 boxCenter = u_SpecCubeProbePosition;\r\n    vec3 boxMin = u_SpecCubeBoxMin;\r\n    vec3 boxMax = u_SpecCubeBoxMax;\r\n\r\n    vec3 nr = normalize(r);\r\n    vec3 rbmax = boxMax - positionWS;\r\n    vec3 rbmin = boxMin - positionWS;\r\n    vec3 select = step(vec3(0.0), r);\r\n    vec3 rbminmax = mix(rbmin, rbmax, select) / nr;\r\n    float scalar = vecmin(rbminmax);\r\n    vec3 boxr = nr * scalar + positionWS - boxCenter;\r\n    return boxr;\r\n}\r\n\r\n    #endif // SPECCUBE_BOX_PROJECTION\r\n\r\n#endif // globalIllumination_lib","#if !defined(Oct_lib)\r\n    #define Oct_lib\r\n\r\nfloat signNotZero(in float k) { return k >= 0.0 ? 1.0 : -1.0; }\r\n\r\nvec2 signNotZero(in vec2 v) { return vec2(signNotZero(v.x), signNotZero(v.y)); }\r\n\r\n/**\r\n * v: normalized sample dir\r\n * @return: oct encode uv [-1, 1]\r\n */\r\nvec2 octEncode(in vec3 v)\r\n{\r\n    float l1norm = abs(v.x) + abs(v.y) + abs(v.z);\r\n    vec2 result = v.xy * (1.0 / l1norm);\r\n    if (v.z < 0.0)\r\n\t{\r\n\t    result = (1.0 - abs(result.yx)) * signNotZero(result.xy);\r\n\t}\r\n\r\n    return result;\r\n}\r\n\r\n/**\r\n * x: u [-1, 1]\r\n * y: v [-1, 1]\r\n * @return: normalized sample dir\r\n */\r\nvec3 finalDecode(float x, float y)\r\n{\r\n    vec3 v = vec3(x, y, 1.0 - abs(x) - abs(y));\r\n    if (v.z < 0.0)\r\n\t{\r\n\t    v.xy = (1.0 - abs(v.yx)) * signNotZero(v.xy);\r\n\t}\r\n    return normalize(v);\r\n}\r\n\r\n/**\r\n * dir: cubemap sample dir\r\n * outsize: probe size with border (x: probe x, y: probe y, z: 1 / probe x, w: 1\r\n * / probe y) gridsize: probe grid size (x: probe x index, y: probe y index, z:\r\n * grid x size, w: grid y size)\r\n * @return texture coord [0, 1]\r\n */\r\nvec2 textureCoordFromDirection(in vec3 dir, vec4 outSize, vec4 gridSize)\r\n{\r\n    vec2 uv = (octEncode(normalize(dir))) * 0.5 + 0.5;\r\n    uv = uv * (outSize.xy - vec2(2.0, 2.0)) * outSize.zw + outSize.zw;\r\n    uv = gridSize.xy * (1.0 / gridSize.zw) + uv * (1.0 / gridSize.zw);\r\n    return uv;\r\n}\r\n\r\n#endif // Oct_lib","#if !defined(GridHelpers_lib)\r\n    #define GridHelpers_lib\r\n\r\nint gridCoordToProbeIndex(in ivec3 probeCoords, const in ivec3 probeCounts)\r\n{\r\n    return probeCoords.x + probeCoords.y * probeCounts.x + probeCoords.z * probeCounts.x * probeCounts.y;\r\n}\r\n\r\nivec3 probeIndexToGridcoord(in int probeIndex, const in ivec3 probeCounts)\r\n{\r\n    ivec3 iPos;\r\n    iPos.x = probeIndex % probeCounts.x;\r\n    iPos.y = (probeIndex % (probeCounts.x * probeCounts.y)) / probeCounts.x;\r\n    iPos.z = probeIndex / (probeCounts.x * probeCounts.y);\r\n    return iPos;\r\n\r\n    //   ivec3 iPos;\r\n    //   iPos.x = probeIndex & (probeCounts.x - 1);\r\n    //   iPos.y = (probeIndex & ((probeCounts.x * probeCounts.y) - 1)) >>\r\n    //            findMSB(probeCounts.x);\r\n    //   iPos.z = probeIndex >> findMSB(probeCounts.x * probeCounts.y);\r\n    //   return iPos;\r\n}\r\n\r\nvec3 gridCoordToPosition(in ivec3 coord, const in vec3 probeStep,\r\n    const in vec3 probeStartPosition)\r\n{\r\n    return (vec3(coord) + 0.5) * probeStep + probeStartPosition;\r\n}\r\n\r\nivec3 baseGridCoord(in vec3 position, in vec3 probeStep,\r\n    in vec3 probeStartPosition, in ivec3 probeCounts)\r\n{\r\n    probeStartPosition += 0.5 * probeStep;\r\n    return clamp(ivec3((position - probeStartPosition) / probeStep),\r\n\tivec3(0, 0, 0), probeCounts - ivec3(1, 1, 1));\r\n}\r\n\r\n#endif // GridHelpers_lib","// https://jcgt.org/published/0008/02/01/\r\n\r\n#if !defined(VolumetricGI_lib)\r\n    #define VolumetricGI_lib\r\n\r\n    #include \"Oct.glsl\";\r\n    #include \"GridHelpers.glsl\";\r\n\r\nstruct VolumetricGI {\r\n    vec3 probeCounts;\r\n    vec3 probeStep;\r\n    vec3 probeStartPosition;\r\n    // float irradianceTexels;\r\n    // float distanceTexels;\r\n    // float normalBias;\r\n    // float viewBias;\r\n    vec4 probeParams; // x: irradianceTexels, y: distanceTexels, z: normalBias, w: viewBias\r\n};\r\n\r\nuniform VolumetricGI u_VolumetricGI;\r\n\r\nuniform sampler2D u_ProbeIrradiance;\r\nuniform sampler2D u_ProbeDistance;\r\n\r\nvec2 porbeGridCoordToTextureGridCoord(in ivec3 porbeGridCoord,\r\n    in ivec3 probeCounts,\r\n    in vec2 textureGridSize)\r\n{\r\n    int probeIndex = gridCoordToProbeIndex(porbeGridCoord, probeCounts);\r\n    ivec2 index;\r\n    index.x = probeIndex % (probeCounts.x * probeCounts.y);\r\n    index.y = probeIndex / (probeCounts.x * probeCounts.y);\r\n\r\n    vec2 textureGridCoord = vec2(index);\r\n    textureGridCoord.y = textureGridCoord.y;\r\n    return textureGridCoord;\r\n}\r\n\r\nvec3 VolumetricGISurfaceBias(in vec3 surfaceNormal, in vec3 cameraDirection)\r\n{\r\n    return surfaceNormal * u_VolumetricGI.probeParams.z + cameraDirection * u_VolumetricGI.probeParams.w;\r\n}\r\n\r\nvec3 VolumetricGIVolumeIrradiance(in vec3 worldPosition, in vec3 surfaceBias,\r\n    in vec3 direction)\r\n{\r\n    // direction *= vec3(-1.0, 1.0, 1.0);\r\n    ivec3 porbeCounts = ivec3(u_VolumetricGI.probeCounts);\r\n    vec3 probeStep = u_VolumetricGI.probeStep;\r\n    vec3 probeStartPosition = u_VolumetricGI.probeStartPosition;\r\n    vec2 volumeCounts = vec2(porbeCounts.x * porbeCounts.y, porbeCounts.z);\r\n    vec4 irradianceTexels = vec4(u_VolumetricGI.probeParams.x, u_VolumetricGI.probeParams.x, 1.0 / u_VolumetricGI.probeParams.x, 1.0 / u_VolumetricGI.probeParams.x);\r\n    vec4 distanceTexels = vec4(u_VolumetricGI.probeParams.y, u_VolumetricGI.probeParams.y, 1.0 / u_VolumetricGI.probeParams.y, 1.0 / u_VolumetricGI.probeParams.y);\r\n\r\n    ivec3 maxGridCoord = porbeCounts - ivec3(1);\r\n\r\n    vec3 irradiance = vec3(0.0);\r\n    float accumulatedWeights = 0.0;\r\n\r\n    // Bias the world space position\r\n    vec3 biasedWorldPosition = worldPosition + surfaceBias;\r\n\r\n    // Get the 3D grid coordinates of the probe nearest the biased world position\r\n    // (i.e. the \"base\" probe)\r\n    ivec3 baseProbeCoords = baseGridCoord(biasedWorldPosition, probeStep,\r\n\tprobeStartPosition, porbeCounts);\r\n\r\n    // Get the world-space position of the base probe (ignore relocation)\r\n    vec3 baseProbeWorldPosition = gridCoordToPosition(baseProbeCoords, probeStep, probeStartPosition);\r\n\r\n    // Clamp the distance (in grid space) between the given point and the base\r\n    // probe's world position (on each axis) to [0, 1]\r\n    vec3 gridSpaceDistance = biasedWorldPosition - baseProbeWorldPosition;\r\n\r\n    vec3 alpha = clamp(gridSpaceDistance / probeStep, vec3(0.0), vec3(1.0));\r\n\r\n    // Iterate over the 8 closest probes and accumulate their contributions\r\n    for (int probeIndex = 0; probeIndex < 8; probeIndex++)\r\n\t{\r\n\t    // Compute the offset to the adjacent probe in grid coordinates by sourcing\r\n\t    // the offsets from the bits of the loop index: x = bit 0, y = bit 1, z =\r\n\t    // bit 2\r\n\t    ivec3 adjacentProbeOffset = ivec3(probeIndex, probeIndex >> 1, probeIndex >> 2) & ivec3(1, 1, 1);\r\n\r\n\t    // Get the 3D grid coordinates of the adjacent probe by adding the offset to\r\n\t    // the base probe and clamping to the grid boundaries\r\n\t    ivec3 adjacentProbeCoords = clamp(baseProbeCoords + adjacentProbeOffset, ivec3(0), maxGridCoord);\r\n\r\n\t    // Get the adjacent probe's world position\r\n\t    vec3 adjacentProbeWorldPosition = gridCoordToPosition(adjacentProbeCoords, probeStep, probeStartPosition);\r\n\r\n\t    // Compute the distance and direction from the (biased and non-biased)\r\n\t    // shading point and the adjacent probe\r\n\t    vec3 worldPosToAdjProbe = normalize(adjacentProbeWorldPosition - worldPosition);\r\n\t    vec3 biasedPosToAdjProbe = normalize(adjacentProbeWorldPosition - biasedWorldPosition);\r\n\t    float biasedPosToAdjProbeDist = distance(adjacentProbeWorldPosition, biasedWorldPosition);\r\n\r\n\t    // Compute trilinear weights based on the distance to each adjacent probe to\r\n\t    // smoothly transition between probes. adjacentProbeOffset is binary, so\r\n\t    // we're using a 1-alpha when adjacentProbeOffset = 0 and alpha when\r\n\t    // adjacentProbeOffset = 1.\r\n\t    vec3 trilinear = max(vec3(0.001), mix(1.0 - alpha, alpha, vec3(adjacentProbeOffset)));\r\n\t    float trilinearWeight = trilinear.x * trilinear.y * trilinear.z;\r\n\t    float weight = 1.0;\r\n\r\n\t    // A naive soft backface weight would ignore a probe when\r\n\t    // it is behind the surface. That's good for walls, but for\r\n\t    // small details inside of a room, the normals on the details\r\n\t    // might rule out all of the probes that have mutual visibility\r\n\t    // to the point. We instead use a \"wrap shading\" test. The small\r\n\t    // offset at the end reduces the \"going to zero\" impact.\r\n\t    float warpShading = (dot(worldPosToAdjProbe, direction) + 1.0) * 0.5;\r\n\t    weight *= (warpShading * warpShading) * 0.2;\r\n\r\n\t    vec2 textureGridCoord = porbeGridCoordToTextureGridCoord(\r\n\t\tadjacentProbeCoords, porbeCounts, volumeCounts);\r\n\t    // compute the octahedral coordinates of the adjacent probe\r\n\t    vec2 probeTextureUV = textureCoordFromDirection(-biasedPosToAdjProbe, distanceTexels,\r\n\t\tvec4(textureGridCoord, volumeCounts));\r\n\t    // Sample the probe's distance texture to get the mean distance to nearby\r\n\t    // surfaces\r\n\t    vec3 filteredDistance = texture2D(u_ProbeDistance, probeTextureUV).xyz;\r\n\t    // Find the variance of the mean distance\r\n\t    float variance = abs(filteredDistance.x * filteredDistance.x - filteredDistance.y);\r\n\r\n\t    // Occlusion test\r\n\t    float chebyshevWeight = 1.0;\r\n\t    if (biasedPosToAdjProbeDist > filteredDistance.x)\r\n\t\t{\r\n\t\t    float v = biasedPosToAdjProbeDist - filteredDistance.x;\r\n\t\t    // v must be greater than 0, which is guaranteed by the if condition\r\n\t\t    // above.\r\n\t\t    chebyshevWeight = variance / (variance + (v * v));\r\n\r\n\t\t    // Increase the contrast in the weight\r\n\t\t    chebyshevWeight = max(chebyshevWeight * chebyshevWeight * chebyshevWeight, 0.0);\r\n\t\t}\r\n\r\n\t    if (filteredDistance.z < 1.0)\r\n\t\t{\r\n\t\t    chebyshevWeight = 1.0;\r\n\t\t}\r\n\r\n\t    // Avoid visibility weights ever going all the way to zero because\r\n\t    // when *no* probe has visibility we need a fallback value\r\n\t    weight *= max(0.05, chebyshevWeight);\r\n\r\n\t    // Avoid a weight of zero\r\n\t    weight = max(0.000001, weight);\r\n\r\n\t    // A small amount of light is visible due to logarithmic perception, so\r\n\t    // crush tiny weights but keep the curve continuous\r\n\t    const float crushThreshold = 0.2;\r\n\t    if (weight < crushThreshold)\r\n\t\t{\r\n\t\t    weight *= (weight * weight) * (1.0 / (crushThreshold * crushThreshold));\r\n\t\t}\r\n\r\n\t    // Apply the trilinear weights\r\n\t    weight *= trilinearWeight;\r\n\r\n\t    probeTextureUV = textureCoordFromDirection(\r\n\t\tdirection, irradianceTexels, vec4(textureGridCoord, volumeCounts));\r\n\r\n\t    // Sample the probe's irradiance\r\n\t    vec3 probeIrradiance = linearToGamma(texture2D(u_ProbeIrradiance, probeTextureUV).rgb);\r\n\r\n\t    irradiance += (probeIrradiance * weight);\r\n\t    accumulatedWeights += weight;\r\n\t}\r\n\r\n    if (accumulatedWeights == 0.0)\r\n\t{\r\n\t    return vec3(0.0);\r\n\t}\r\n\r\n    irradiance *= (1.f / accumulatedWeights); // Normalize by the accumulated weights\r\n\r\n    irradiance = gammaToLinear(irradiance);\r\n\r\n    return irradiance;\r\n}\r\n\r\n#endif // VolumetricGI_lib","#if !defined(BlinnPhongLighting_lib)\r\n    #define BlinnPhongLighting_lib\r\n\r\n    #include \"Lighting.glsl\";\r\n    #include \"globalIllumination.glsl\";\r\n\r\nstruct PixelInfo {\r\n    vec3 positionWS;\r\n\r\n    vec3 vertexNormalWS;\r\n    vec3 normalWS;\r\n\r\n    vec3 viewDir;\r\n\r\n    #ifdef LIGHTMAP\r\n\t#ifdef UV1\r\n    vec2 lightmapUV;\r\n\t#endif // UV1\r\n    #endif // LIGHTMAP\r\n};\r\n\r\nstruct Surface {\r\n    vec3 diffuseColor;\r\n    vec3 specularColor;\r\n    float shininess;\r\n    vec3 gloss;\r\n\r\n    vec3 normalTS;\r\n\r\n    float alpha;\r\n    float alphaClip;\r\n};\r\n\r\nvec3 BlinnPhongLighting(in Surface surface, in Light light, in PixelInfo pixel)\r\n{\r\n    vec3 l = normalize(-light.dir);\r\n    vec3 v = pixel.viewDir;\r\n\r\n    vec3 normalWS = pixel.normalWS;\r\n\r\n    vec3 diffuseColor = surface.diffuseColor;\r\n    float shininess = surface.shininess;\r\n    vec3 specularColor = surface.specularColor;\r\n    vec3 gloss = surface.gloss;\r\n\r\n    // difffuse\r\n    float ndl = max(0.0, dot(normalWS, l));\r\n    vec3 lightDiffuse = light.color * diffuseColor * ndl;\r\n\r\n    // specular\r\n    mediump vec3 h = normalize(v + l);\r\n    lowp float ndh = max(0.0, dot(h, normalWS));\r\n    float specularIntensity = pow(ndh, shininess * 128.0);\r\n    vec3 lightSpecular = light.color * specularColor * specularIntensity * gloss;\r\n\r\n    return lightDiffuse + lightSpecular;\r\n}\r\n\r\nvec3 BlinnPhongGI(const in Surface surface, const in PixelInfo info)\r\n{\r\n    vec3 indirect = vec3(0.0);\r\n\r\n    #ifdef LIGHTMAP\r\n\t#ifdef UV1\r\n\r\n    vec2 lightmapUV = info.lightmapUV;\r\n    vec3 bakedColor = getBakedLightmapColor(lightmapUV, info.normalWS);\r\n\r\n    // todo  surface.diffuseColor \r\n    indirect = bakedColor * surface.diffuseColor;\r\n\r\n\t#endif // UV1\r\n\r\n    #else // LIGHTMAP\r\n\r\n    vec3 n = info.normalWS;\r\n    indirect = diffuseIrradiance(n) * surface.diffuseColor;\r\n\r\n    #endif // LIGHTMAP\r\n\r\n    return indirect;\r\n}\r\n\r\n#endif // BlinnPhongLighting_lib","#if !defined(PBRLighting_lib)\r\n    #define PBRLighting_lib\r\n\r\n    #include \"Lighting.glsl\";\r\n\r\n    // \r\n    #if !defined(GL_FRAGMENT_PRECISION_HIGH)\r\n\t#define MIN_PERCEPTUAL_ROUGHNESS 0.089\r\n\t#define MIN_ROUGHNESS\t\t 0.007921\r\n    #else\r\n\t#define MIN_PERCEPTUAL_ROUGHNESS 0.045\r\n\t#define MIN_ROUGHNESS\t\t 0.002025\r\n    #endif\r\n\r\n    #define MIN_N_DOT_V 1e-4\r\n\r\n    #include \"BRDF.glsl\";\r\n\r\nstruct PixelInfo {\r\n    vec3 positionWS;\r\n\r\n    vec3 vertexNormalWS;\r\n    vec3 normalWS;\r\n    vec3 tangentWS;\r\n    vec3 biNormalWS;\r\n\r\n    vec3 viewDir;\r\n    float NoV;\r\n\r\n    vec3 dfg;\r\n    vec3 energyCompensation;\r\n\r\n    #ifdef IRIDESCENCE\r\n    vec3 iridescenceFresnel;\r\n    #endif // IRIDESCENCE\r\n\r\n    #ifdef CLEARCOAT\r\n    vec3 clearCoatNormal;\r\n    float clearCoatNoV;\r\n    #endif // CLEARCOAT\r\n\r\n    #ifdef SHEEN\r\n    float sheenScaling;\r\n    float sheenDfg;\r\n    #endif // SHEEN\r\n\r\n    #ifdef ANISOTROPIC\r\n    vec3 anisotropicT;\r\n    vec3 anisotropicB;\r\n    float ToV;\r\n    float BoV;\r\n    float at;\r\n    float ab;\r\n    #endif // ANISOTROPIC\r\n\r\n    #ifdef THICKNESS\r\n    vec4 worldScale;\r\n    #endif // THICKNESS\r\n\r\n    #ifdef LIGHTMAP\r\n\t#ifdef UV1\r\n    vec2 lightmapUV;\r\n\t#endif // UV1\r\n    #endif // LIGHTMAP\r\n};\r\n\r\nstruct Surface {\r\n    vec3 diffuseColor;\r\n    float alpha;\r\n    vec3 f0;\r\n    vec3 f90;\r\n    float roughness;\r\n    float perceptualRoughness;\r\n    float occlusion;\r\n\r\n    #ifdef EMISSION\r\n    vec3 emissionColor;\r\n    #endif // EMISSION\r\n\r\n    vec3 normalTS;\r\n\r\n    float ior;\r\n\r\n    #ifdef CLEARCOAT\r\n    float clearCoat;\r\n    float clearCoatRoughness;\r\n    float clearCoatPerceptualRoughness;\r\n\t#ifdef CLEARCOAT_NORMAL\r\n    vec3 clearCoatNormalTS;\r\n\t#endif // CLEARCOAT_NORMAL\r\n    #endif // CLEARCOAT\r\n\r\n    #ifdef ANISOTROPIC\r\n    float anisotropy;\r\n    vec2 anisotropyDirection;\r\n    #endif // ANISOTROPIC\r\n\r\n    #ifdef IRIDESCENCE\r\n    float iridescence;\r\n    float iridescenceIor;\r\n    float iridescenceThickness;\r\n    #endif // IRIDESCENCE\r\n\r\n    #ifdef SHEEN\r\n    vec3 sheenColor;\r\n    float sheenRoughness;\r\n    float sheenPerceptualRoughness;\r\n    #endif // SHEEN\r\n\r\n    #ifdef TRANSMISSION\r\n    float transmission;\r\n    #endif // TRANSMISSION\r\n\r\n    #ifdef THICKNESS\r\n    float thickness;\r\n    vec3 attenuationColor;\r\n    float attenuationDistance;\r\n    #endif // THICKNESS\r\n};\r\n\r\nstruct LightParams {\r\n    vec3 l;\r\n    vec3 h;\r\n    float NoL;\r\n    float NoH;\r\n    float LoH;\r\n    float VoH;\r\n\r\n    #ifdef CLEARCOAT\r\n    float clearCoatNoH;\r\n    float clearCoatNoL;\r\n    #endif // CLEARCOAT\r\n\r\n    #ifdef ANISOTROPIC\r\n    float ToL;\r\n    float BoL;\r\n    #endif // ANISOTROPIC\r\n};\r\n\r\nvoid initLightParams(inout LightParams params, const in PixelInfo pixel, const in Light light)\r\n{\r\n    vec3 v = pixel.viewDir;\r\n    vec3 n = pixel.normalWS;\r\n\r\n    vec3 l = normalize(-light.dir);\r\n    params.l = l;\r\n\r\n    vec3 h = SafeNormalize(v + l);\r\n    params.h = h;\r\n    params.NoL = saturate(dot(n, l));\r\n    params.NoH = saturate(dot(n, h));\r\n    params.LoH = saturate(dot(l, h));\r\n    params.VoH = saturate(dot(v, h));\r\n\r\n    #ifdef CLEARCOAT\r\n    params.clearCoatNoL = saturate(dot(pixel.clearCoatNormal, l));\r\n    params.clearCoatNoH = saturate(dot(pixel.clearCoatNormal, h));\r\n    #endif // CLEARCOAT\r\n\r\n    #ifdef ANISOTROPIC\r\n    vec3 t = pixel.anisotropicT;\r\n    vec3 b = pixel.anisotropicB;\r\n    params.ToL = dot(t, l);\r\n    params.BoL = dot(b, l);\r\n    #endif // ANISOTROPIC\r\n}\r\n\r\nvec3 prefilteredDFG_LUT(float roughness, float NoV)\r\n{\r\n    vec2 samplePoint = clamp(vec2(NoV, roughness), vec2(0.0, 0.0), vec2(1.0, 1.0));\r\n    samplePoint.y = 1.0 - samplePoint.y;\r\n    #if defined(FLOATTEXTURE) && defined(FLOATTEXTURE_FIL_LINEAR)\r\n    return (texture2D(u_IBLDFG, samplePoint)).rgb;\r\n    #else\r\n    return decodeRGBD(texture2D(u_IBLDFG, samplePoint));\r\n    #endif\r\n}\r\n\r\n// todo remove\r\nvec2 EnvBRDFApproxLazarov(float roughness, float NoV)\r\n{\r\n    vec4 c0 = vec4(-1, -0.0275, -0.572, 0.022);\r\n    vec4 c1 = vec4(1, 0.0425, 1.04, -0.04);\r\n    vec4 r = roughness * c0 + c1;\r\n    float a004 = min(r.x * r.x, exp2(-9.28 * NoV)) * r.x + r.y;\r\n    vec2 AB = vec2(-1.04, 1.04) * a004 + r.zw;\r\n    return AB;\r\n}\r\n\r\nfloat dielectricSpecularToF0(float specular)\r\n{\r\n    return 0.08 * specular;\r\n}\r\n\r\nfloat dielectricF0ToIor(float f0)\r\n{\r\n    return 2.0 / (1.0 - sqrt(min(f0, 0.99))) - 1.0;\r\n}\r\n\r\nfloat dielectricIorToF0(float ior)\r\n{\r\n    return pow2((ior - 1.0) / (ior + 1.0));\r\n}\r\n\r\n// input dielectric f0, output surface f0\r\nvec3 computeF0(vec3 f0, vec3 baseColor, float metallic)\r\n{\r\n    return mix(f0, baseColor, metallic);\r\n}\r\n\r\n// input surface f0, output surface f90\r\nvec3 computeF90(vec3 f0)\r\n{\r\n    return vec3(saturate(dot(f0, vec3(50.0 * 0.33))));\r\n}\r\n\r\nvec3 computeDiffuse(vec3 baseColor, float metallic)\r\n{\r\n    return (1.0 - metallic) * baseColor;\r\n}\r\n\r\nfloat specularAA(float roughness, in vec3 normalWS)\r\n{\r\n\r\n    #if !defined(GRAPHICS_API_GLES3) && !defined(GL_OES_standard_derivatives)\r\n\r\n    return roughness;\r\n\r\n    #else // !GRAPHICS_API_GLES3 && !GL_OES_standard_derivatives\r\n\r\n    vec3 du = dFdx(normalWS);\r\n    vec3 dv = dFdy(normalWS);\r\n\r\n    float specularAAVariance = 0.15;\r\n    float specularAAThreshold = 0.04;\r\n\r\n    float variance = specularAAVariance * (dot(du, du) + dot(dv, dv));\r\n    float kernelRoughness = min(2.0 * variance, specularAAThreshold);\r\n\r\n    float squareRoughness = saturate(roughness * roughness + kernelRoughness);\r\n\r\n    return sqrt(squareRoughness);\r\n\r\n    #endif // !GRAPHICS_API_GLES3 && !GL_OES_standard_derivatives\r\n}\r\n\r\nvec3 diffuseLobe(in Surface surface, const in PixelInfo pixel, const in LightParams lightParams)\r\n{\r\n    return surface.diffuseColor * Fd_Lambert();\r\n    // return surface.diffuseColor * Fd_Burley(surface.roughness, pixel.NoV, lightParams.NoL, lightParams.LoH);\r\n}\r\n\r\nvec3 specularLobe(const in Surface surface, const in PixelInfo pixel, const in LightParams lightParams)\r\n{\r\n    float roughness = surface.roughness;\r\n\r\n    float D = distribution(roughness, lightParams.NoH, lightParams.h, pixel.normalWS);\r\n    float V = visibility(roughness, pixel.NoV, lightParams.NoL);\r\n    vec3 F = fresnel(surface.f0, surface.f90, lightParams.LoH);\r\n\r\n    return (D * V) * F;\r\n}\r\n\r\n    #ifdef IRIDESCENCE\r\nvec3 iridescenceDiffuseLobe(in Surface surface, const in PixelInfo pixel, const in LightParams lightParams)\r\n{\r\n    vec3 f0 = surface.f0;\r\n    vec3 f90 = vec3(1.0);\r\n    vec3 iridescenceFresnel = pixel.iridescenceFresnel;\r\n    float iridescence = surface.iridescence;\r\n    float VoH = lightParams.VoH;\r\n    return surface.diffuseColor * Fd_IridescenceLambert(f0, f90, iridescenceFresnel, iridescence, VoH);\r\n}\r\n\r\nvec3 iridescenceSpecularLobe(const in Surface surface, const in PixelInfo pixel, const in LightParams lightParams)\r\n{\r\n    float roughness = surface.roughness;\r\n    float D = distribution(roughness, lightParams.NoH, lightParams.h, pixel.normalWS);\r\n    float V = visibility(roughness, pixel.NoV, lightParams.NoL);\r\n\r\n    float iridescenceFactor = surface.iridescence;\r\n    vec3 iridescenceFresnel = pixel.iridescenceFresnel;\r\n    vec3 F = mix(fresnel(surface.f0, lightParams.LoH), iridescenceFresnel, vec3(iridescenceFactor));\r\n\r\n    return (D * V) * F;\r\n}\r\n    #endif // IRIDESCENCE\r\n\r\n    #ifdef CLEARCOAT\r\nfloat clearCoatLobe(const in Surface surface, const in PixelInfo pixel, const in LightParams lightParams)\r\n{\r\n    float roughness = surface.clearCoatRoughness;\r\n    float clearCoat = surface.clearCoat;\r\n    vec3 n = pixel.clearCoatNormal;\r\n    vec3 h = lightParams.h;\r\n    float LoH = lightParams.LoH;\r\n\r\n    float clearCoatNoH = lightParams.clearCoatNoH;\r\n\r\n    float D = distribution(roughness, clearCoatNoH, h, n);\r\n    float V = V_kelemen(LoH);\r\n\r\n    return D * V;\r\n}\r\n    #endif // CLEARCOAT\r\n\r\n    #ifdef SHEEN\r\nvec3 sheenLobe(const in Surface surface, const in PixelInfo pixel, const in LightParams lightParams)\r\n{\r\n    float roughness = surface.sheenRoughness;\r\n    float NoV = pixel.NoV;\r\n    float NoH = lightParams.NoH;\r\n    float NoL = lightParams.NoL;\r\n\r\n    float D = D_Charlie(roughness, NoH);\r\n    float V = V_Neubelt(NoV, NoL);\r\n    // F = 1.0\r\n    return D * V * surface.sheenColor;\r\n}\r\n    #endif // SHEEN\r\n\r\n    #ifdef ANISOTROPIC\r\nvec3 anisotropyLobe(const in Surface surface, const in PixelInfo pixel, const in LightParams lightParams)\r\n{\r\n    float anisotropy = surface.anisotropy;\r\n    float at = pixel.at;\r\n    float ab = pixel.ab;\r\n    vec3 anisotropicT = pixel.anisotropicT;\r\n    vec3 anisotropicB = pixel.anisotropicB;\r\n\r\n    float NoV = pixel.NoV;\r\n    float ToV = pixel.ToV;\r\n    float BoV = pixel.BoV;\r\n\r\n    vec3 h = lightParams.h;\r\n    float NoL = lightParams.NoL;\r\n    float NoH = lightParams.NoH;\r\n    float VoH = lightParams.VoH;\r\n    float ToL = lightParams.ToL;\r\n    float BoL = lightParams.BoL;\r\n\r\n    float V = V_SmithGGXCorrelated_Anisotropic(at, ab, ToV, BoV, ToL, BoL, NoV, NoL);\r\n    float D = D_GGX_Anisotropic(NoH, h, anisotropicT, anisotropicB, at, ab);\r\n    vec3 F = fresnel(surface.f0, surface.f90, lightParams.LoH);\r\n    return V * D * F;\r\n}\r\n    #endif // ANISOTROPIC\r\n\r\nvec3 PBRLighting(const in Surface surface, const in PixelInfo pixel, const in Light light)\r\n{\r\n    LightParams lightParams;\r\n    initLightParams(lightParams, pixel, light);\r\n\r\n    float NoL = lightParams.NoL;\r\n\r\n    #ifdef IRIDESCENCE\r\n    vec3 Fd = iridescenceDiffuseLobe(surface, pixel, lightParams);\r\n    vec3 Fr = iridescenceSpecularLobe(surface, pixel, lightParams);\r\n    #elif defined(ANISOTROPIC)\r\n    vec3 Fd = diffuseLobe(surface, pixel, lightParams);\r\n    vec3 Fr = anisotropyLobe(surface, pixel, lightParams);\r\n    #else\r\n    vec3 Fd = diffuseLobe(surface, pixel, lightParams);\r\n    vec3 Fr = specularLobe(surface, pixel, lightParams);\r\n    #endif\r\n\r\n    #ifdef TRANSMISSION\r\n    Fd *= 1.0 - surface.transmission;\r\n    #endif // TRANSMISSION\r\n\r\n    vec3 shading = (Fd + Fr * pixel.energyCompensation);\r\n\r\n    #ifdef SHEEN\r\n    vec3 fSheen = sheenLobe(surface, pixel, lightParams);\r\n    shading *= pixel.sheenScaling;\r\n    shading += fSheen;\r\n    #endif // SHEEN\r\n\r\n    #ifdef CLEARCOAT\r\n    float clearCoatNoL = lightParams.clearCoatNoL;\r\n    float LoH = lightParams.LoH;\r\n    // default IOR 1.5\r\n    float FccClearCoat = F_Schlick(0.04, 1.0, LoH) * surface.clearCoat;\r\n    float attenuation = 1.0 - FccClearCoat;\r\n    shading *= attenuation * NoL;\r\n\r\n    float clearcoat = clearCoatLobe(surface, pixel, lightParams) * FccClearCoat;\r\n    shading += clearcoat * clearCoatNoL;\r\n    // NoL has alread multiply\r\n    NoL = 1.0;\r\n    #endif // CLEARCOAT\r\n\r\n    return shading * light.color * NoL;\r\n}\r\n\r\n    // gi\r\n    #include \"PBRGI.glsl\";\r\n\r\n#endif // PBRLighting_lib","import { Event } from \"../../events/Event\";\r\nimport { SkinnedMeshRenderer } from \"./SkinnedMeshRenderer\";\r\nimport { RenderContext3D } from \"./render/RenderContext3D\";\r\nimport { Transform3D } from \"./Transform3D\";\r\nimport { SubMeshRenderElement } from \"./render/SubMeshRenderElement\";\r\nimport { Sprite3D } from \"./Sprite3D\";\r\nimport { RenderElement } from \"./render/RenderElement\";\r\nimport { SkinnedMeshSprite3DShaderDeclaration } from \"./SkinnedMeshSprite3DShaderDeclaration\";\r\nimport { Mesh } from \"../resource/models/Mesh\";\r\nimport { Texture2D } from \"../../resource/Texture2D\";\r\nimport { Component } from \"../../components/Component\";\r\nimport { ShaderDataType } from \"../../RenderEngine/RenderShader/ShaderData\";\r\nimport { Matrix4x4 } from \"../../maths/Matrix4x4\";\r\nimport { Vector2 } from \"../../maths/Vector2\";\r\nimport { Vector4 } from \"../../maths/Vector4\";\r\n\r\nexport class SimpleSkinnedMeshRenderer extends SkinnedMeshRenderer {\r\n    /**@internal  */\r\n    static SIMPLE_SIMPLEANIMATORTEXTURE: number;\r\n    /**@internal */\r\n    static SIMPLE_SIMPLEANIMATORPARAMS: number;\r\n    /**@internal */\r\n    static SIMPLE_SIMPLEANIMATORTEXTURESIZE: number;\r\n\r\n    /**@internal */\r\n    private _simpleAnimatorTexture: Texture2D;\r\n    /**@internal */\r\n    _simpleAnimatorParams: Vector4;\r\n    /**@internal */\r\n    private _simpleAnimatorTextureSize: number;\r\n    /**@internal  x simpleAnimation offset,y simpleFrameOffset*/\r\n    private _simpleAnimatorOffset: Vector2;\r\n    /**@internal */\r\n    _bonesNums: number;\r\n\r\n    /**\r\n     * @internal\r\n     * \r\n     */\r\n    get simpleAnimatorTexture(): Texture2D {\r\n        return this._simpleAnimatorTexture;\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    set simpleAnimatorTexture(value: Texture2D) {\r\n        this._simpleAnimatorTexture = value;\r\n        this._simpleAnimatorTextureSize = value.width;\r\n        this._shaderValues.setTexture(SimpleSkinnedMeshRenderer.SIMPLE_SIMPLEANIMATORTEXTURE, value);\r\n        value._addReference();\r\n        this._shaderValues.setNumber(SimpleSkinnedMeshRenderer.SIMPLE_SIMPLEANIMATORTEXTURESIZE, this._simpleAnimatorTextureSize);\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     * \r\n     */\r\n    get simpleAnimatorOffset(): Vector2 {\r\n        return this._simpleAnimatorOffset;\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    set simpleAnimatorOffset(value: Vector2) {\r\n        value.cloneTo(this._simpleAnimatorOffset);\r\n    }\r\n\r\n\r\n    /**\r\n     *  <code>SkinnedMeshRender</code> \r\n     */\r\n    constructor() {\r\n        super();\r\n        this._simpleAnimatorParams = new Vector4();\r\n        this._simpleAnimatorOffset = new Vector2();\r\n        this._shaderValues.addDefine(SkinnedMeshSprite3DShaderDeclaration.SHADERDEFINE_SIMPLEBONE);\r\n        this._shaderValues.addDefine(SkinnedMeshSprite3DShaderDeclaration.SHADERDEFINE_BONE);\r\n    }\r\n\r\n    protected _getcommonUniformMap(): string[] {\r\n        return [\"Sprite3D\", \"SimpleSkinnedMesh\"];\r\n    }\r\n\r\n    /**\r\n     *@inheritDoc\r\n     *@override\r\n     *@internal\r\n     */\r\n    _createRenderElement() {\r\n        let renderelement = new SubMeshRenderElement();\r\n        return renderelement as any;\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    _computeAnimatorParamsData(): void {\r\n        if (this._cacheMesh) {\r\n            this._simpleAnimatorParams.x = this._simpleAnimatorOffset.x;\r\n            this._simpleAnimatorParams.y = Math.round(this._simpleAnimatorOffset.y) * this._bonesNums * 4;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @param value1 1\r\n     * @param value2 1\r\n     */\r\n    setCustomData(value1: number, value2: number = 0) {\r\n        this._simpleAnimatorParams.z = value1;\r\n        this._simpleAnimatorParams.w = value2;\r\n    }\r\n\r\n    /**\r\n    *@inheritDoc\r\n    *@override\r\n    *@internal\r\n    */\r\n    _onMeshChange(value: Mesh): void {\r\n        this._onSkinMeshChange(value);\r\n        if (!value)\r\n            return;\r\n        this._cacheMesh = (<Mesh>value);\r\n\r\n    }\r\n    /**\r\n     * @inheritDoc\r\n     * @override\r\n     * @internal\r\n     */\r\n    _renderUpdate(context: RenderContext3D, transform: Transform3D): void {\r\n        var element: SubMeshRenderElement = <SubMeshRenderElement>context.renderElement;\r\n\r\n        if (this.rootBone) {\r\n            var worldMat: Matrix4x4 = (this.rootBone as Sprite3D).transform.worldMatrix;\r\n            if (this._subUniformBufferData) {\r\n                let oriMat = this._shaderValues.getMatrix4x4(Sprite3D.WORLDMATRIX);\r\n                this._subUniformBufferData._needUpdate = oriMat ? !oriMat.equalsOtherMatrix(worldMat) : true;\r\n            }\r\n            this._setShaderValue(Sprite3D.WORLDMATRIX, ShaderDataType.Matrix4x4, worldMat);\r\n            this._worldParams.x = (this.rootBone as Sprite3D).transform.getFrontFaceValue();\r\n            this._setShaderValue(Sprite3D.WORLDINVERTFRONT, ShaderDataType.Vector4, this._worldParams);\r\n        } else {\r\n            this._setShaderValue(Sprite3D.WORLDMATRIX, ShaderDataType.Matrix4x4, transform.worldMatrix);\r\n            this._worldParams.x = transform.getFrontFaceValue();\r\n            this._setShaderValue(Sprite3D.WORLDINVERTFRONT, ShaderDataType.Vector4, this._worldParams);\r\n        }\r\n        this._computeAnimatorParamsData();\r\n        this._shaderValues.setVector(SimpleSkinnedMeshRenderer.SIMPLE_SIMPLEANIMATORPARAMS, this._simpleAnimatorParams);\r\n\r\n    }\r\n\r\n    /**\r\n     * @inheritDoc\r\n     * @override\r\n     * @internal\r\n     */\r\n    _renderUpdateWithCamera(context: RenderContext3D, transform: Transform3D): void {\r\n    }\r\n\r\n    _cloneTo(dest: Component): void {\r\n        let render = dest as SimpleSkinnedMeshRenderer;\r\n        render.simpleAnimatorOffset = this.simpleAnimatorOffset;\r\n        render.simpleAnimatorTexture = this.simpleAnimatorTexture;\r\n        render._bonesNums = this._bonesNums;\r\n        super._cloneTo(dest);\r\n    }\r\n\r\n    /**\r\n     * \r\n     */\r\n    protected _onDestroy() {\r\n        if (this._cacheRootBone)\r\n            (!this._cacheRootBone._destroyed) && (this._cacheRootBone.transform.off(Event.TRANSFORM_CHANGED, this, this._onWorldMatNeedChange));\r\n        (this._simpleAnimatorTexture) && this._simpleAnimatorTexture._removeReference();\r\n        this._simpleAnimatorTexture = null;\r\n        super._onDestroy();\r\n    }\r\n}","import { Node } from \"../../display/Node\";\r\nimport { Loader } from \"../../net/Loader\";\r\nimport { Mesh } from \"../resource/models/Mesh\";\r\nimport { MeshFilter } from \"./MeshFilter\";\r\nimport { RenderableSprite3D } from \"./RenderableSprite3D\";\r\nimport { Sprite3D } from \"./Sprite3D\";\r\nimport { Material } from \"../../resource/Material\";\r\nimport { SimpleSkinnedMeshRenderer } from \"./SimpleSkinnedMeshRenderer\";\r\nimport { Texture2D } from \"../../resource/Texture2D\";\r\nimport { Shader3D } from \"../../RenderEngine/RenderShader/Shader3D\";\r\nimport { Vector3 } from \"../../maths/Vector3\";\r\nimport { Vector4 } from \"../../maths/Vector4\";\r\nimport { ShaderDataType } from \"../../RenderEngine/RenderShader/ShaderData\";\r\nimport { LayaGL } from \"../../layagl/LayaGL\";\r\n\r\n\r\n\r\n/**\r\n * <code>SkinnedMeshSprite3D</code> \r\n */\r\nexport class SimpleSkinnedMeshSprite3D extends RenderableSprite3D {\r\n    /**@internal */\r\n    static _tempArray0: any[] = [];\r\n\r\n    /** */\r\n    static SIMPLE_SIMPLEANIMATORTEXTURE: number;\r\n    static SIMPLE_SIMPLEANIMATORPARAMS: number;\r\n    static SIMPLE_SIMPLEANIMATORTEXTURESIZE: number;\r\n    /**\r\n     * @internal\r\n     */\r\n    static __init__(): void {\r\n        SimpleSkinnedMeshRenderer.SIMPLE_SIMPLEANIMATORPARAMS = SimpleSkinnedMeshSprite3D.SIMPLE_SIMPLEANIMATORPARAMS;\r\n        SimpleSkinnedMeshRenderer.SIMPLE_SIMPLEANIMATORTEXTURE = SimpleSkinnedMeshSprite3D.SIMPLE_SIMPLEANIMATORTEXTURE;\r\n        SimpleSkinnedMeshRenderer.SIMPLE_SIMPLEANIMATORTEXTURESIZE = SimpleSkinnedMeshSprite3D.SIMPLE_SIMPLEANIMATORTEXTURESIZE;\r\n\r\n        SimpleSkinnedMeshSprite3D.SIMPLE_SIMPLEANIMATORTEXTURE = Shader3D.propertyNameToID(\"u_SimpleAnimatorTexture\");\r\n        SimpleSkinnedMeshSprite3D.SIMPLE_SIMPLEANIMATORPARAMS = Shader3D.propertyNameToID(\"u_SimpleAnimatorParams\");\r\n        SimpleSkinnedMeshSprite3D.SIMPLE_SIMPLEANIMATORTEXTURESIZE = Shader3D.propertyNameToID(\"u_SimpleAnimatorTextureSize\");\r\n\r\n        const commandUniform = LayaGL.renderOBJCreate.createGlobalUniformMap(\"SimpleSkinnedMesh\");\r\n        commandUniform.addShaderUniform(SimpleSkinnedMeshSprite3D.SIMPLE_SIMPLEANIMATORTEXTURE, \"u_SimpleAnimatorTexture\", ShaderDataType.Texture2D);\r\n        commandUniform.addShaderUniform(SimpleSkinnedMeshSprite3D.SIMPLE_SIMPLEANIMATORPARAMS, \"u_SimpleAnimatorParams\", ShaderDataType.Vector4);\r\n        commandUniform.addShaderUniform(SimpleSkinnedMeshSprite3D.SIMPLE_SIMPLEANIMATORTEXTURESIZE, \"u_SimpleAnimatorTextureSize\", ShaderDataType.Float);\r\n    }\r\n\r\n    /** @internal */\r\n    private _meshFilter: MeshFilter;\r\n\r\n    /**\r\n     * \r\n     */\r\n    get meshFilter(): MeshFilter {\r\n        return this._meshFilter;\r\n    }\r\n\r\n    /**\r\n     * \r\n     */\r\n    get simpleSkinnedMeshRenderer(): SimpleSkinnedMeshRenderer {\r\n        return (<SimpleSkinnedMeshRenderer>this._render);\r\n    }\r\n\r\n    /**\r\n     *  <code>MeshSprite3D</code> \r\n     * @param mesh ,\r\n     * @param name \r\n     */\r\n    constructor(mesh: Mesh = null, name: string = null) {\r\n        super(name);\r\n        this._meshFilter = this.addComponent(MeshFilter);\r\n        this._render = this.addComponent(SimpleSkinnedMeshRenderer);\r\n        (mesh) && (this._meshFilter.sharedMesh = mesh);\r\n    }\r\n\r\n    /**\r\n     * @inheritDoc\r\n     * @override\r\n     * @internal\r\n     */\r\n    _parse(data: any, spriteMap: any): void {\r\n        super._parse(data, spriteMap);\r\n        var render: SimpleSkinnedMeshRenderer = this.simpleSkinnedMeshRenderer;\r\n        var lightmapIndex: any = data.lightmapIndex;\r\n        (lightmapIndex != null) && (render.lightmapIndex = lightmapIndex);\r\n        var lightmapScaleOffsetArray: any[] = data.lightmapScaleOffset;\r\n        (lightmapScaleOffsetArray) && (render.lightmapScaleOffset = new Vector4(lightmapScaleOffsetArray[0], lightmapScaleOffsetArray[1], lightmapScaleOffsetArray[2], lightmapScaleOffsetArray[3]));\r\n        (data.enableRender != undefined) && (render.enabled = data.enableRender);\r\n        (data.receiveShadows != undefined) && (render.receiveShadow = data.receiveShadows);\r\n        (data.castShadow != undefined) && (render.castShadow = data.castShadow);\r\n        let meshPath: string = data.meshPath;\r\n        if (meshPath) {\r\n            let mesh: Mesh = Loader.getRes(meshPath);//mesh\r\n            (mesh) && (this.meshFilter.sharedMesh = mesh);\r\n        }\r\n\r\n        var materials: any[] = data.materials;\r\n        if (materials) {\r\n            let sharedMaterials: Material[] = render.sharedMaterials;\r\n            let materialCount: number = materials.length;\r\n            sharedMaterials.length = materialCount;\r\n            for (let i = 0; i < materialCount; i++) {\r\n                sharedMaterials[i] = Loader.getRes(materials[i].path);\r\n            }\r\n            render.sharedMaterials = sharedMaterials;\r\n        }\r\n\r\n        var boundBox: any = data.boundBox;\r\n        var min: any[] = boundBox.min;\r\n        var max: any[] = boundBox.max;\r\n        render.localBounds.setMin(new Vector3(min[0], min[1], min[2]));\r\n        render.localBounds.setMax(new Vector3(max[0], max[1], max[2]));\r\n        render.localBounds = render.localBounds;\r\n        if (spriteMap) {\r\n            let rootBoneData: number = data.rootBone;\r\n            render.rootBone = spriteMap[rootBoneData];\r\n            let bonesData: any[] = data.bones;\r\n            for (let i = 0, n = bonesData.length; i < n; i++)\r\n                render.bones.push(spriteMap[bonesData[i]]);\r\n\r\n            render._bonesNums = data.bonesNums ? data.bonesNums : render.bones.length;\r\n        }\r\n        // else {//[]\r\n        // \t(data.rootBone) && (render._setRootBone(data.rootBone));//[]\r\n        // }\r\n        var animatorTexture: string = data.animatorTexture;\r\n        if (animatorTexture) {\r\n            let animatortexture: Texture2D = Loader.getRes(animatorTexture, Loader.TEXTURE2D);\r\n            render.simpleAnimatorTexture = animatortexture;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * @inheritDoc\r\n     * @override\r\n     * @internal\r\n     */\r\n    _cloneTo(destObject: any, srcRoot: Node, dstRoot: Node): void {\r\n        super._cloneTo(destObject, srcRoot, dstRoot);//,\r\n    }\r\n\r\n    /**\r\n     * @inheritDoc\r\n     * @override\r\n     */\r\n    destroy(destroyChild: boolean = true): void {\r\n        if (this._destroyed)\r\n            return;\r\n        super.destroy(destroyChild);\r\n        this._meshFilter.destroy();\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    protected _create(): Node {\r\n        return new Sprite3D();\r\n    }\r\n\r\n}\r\n\r\n","import { Texture2D } from \"../../../resource/Texture2D\";\r\nimport { Material } from \"../../../resource/Material\";\r\nimport { Shader3D } from \"../../../RenderEngine/RenderShader/Shader3D\";\r\nimport { Color } from \"../../../maths/Color\";\r\nimport { Vector4 } from \"../../../maths/Vector4\";\r\n\r\n/**\r\n * <code>SkyPanoramicMaterial</code> SkyPanoramicMaterial\r\n */\r\nexport class SkyPanoramicMaterial extends Material {\r\n    static TINTCOLOR: number;\r\n    static EXPOSURE: number;\r\n    static ROTATION: number;\r\n    static TEXTURE: number;\r\n    static TEXTURE_HDR_PARAMS: number;\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    static __init__(): void {\r\n\r\n        SkyPanoramicMaterial.TINTCOLOR = Shader3D.propertyNameToID(\"u_TintColor\");\r\n        SkyPanoramicMaterial.EXPOSURE = Shader3D.propertyNameToID(\"u_Exposure\");\r\n        SkyPanoramicMaterial.ROTATION = Shader3D.propertyNameToID(\"u_Rotation\");\r\n        SkyPanoramicMaterial.TEXTURE = Shader3D.propertyNameToID(\"u_Texture\");\r\n        SkyPanoramicMaterial.TEXTURE_HDR_PARAMS = Shader3D.propertyNameToID(\"u_Texture_HDR_params\");\r\n    }\r\n    /** @internal */\r\n    private _textureHDRParams: Vector4 = new Vector4(1.0, 0.0, 0.0, 1.0);\r\n\r\n    /**\r\n     * \r\n     */\r\n    get tintColor(): Color {\r\n        return this.getColorByIndex(SkyPanoramicMaterial.TINTCOLOR);\r\n    }\r\n\r\n    set tintColor(value: Color) {\r\n        this.setColorByIndex(SkyPanoramicMaterial.TINTCOLOR, value);\r\n    }\r\n\r\n    /**\r\n     * \r\n     */\r\n    get exposure(): number {\r\n        return this.getFloatByIndex(SkyPanoramicMaterial.EXPOSURE);\r\n    }\r\n\r\n    set exposure(value: number) {\r\n        this.setFloatByIndex(SkyPanoramicMaterial.EXPOSURE, value);\r\n    }\r\n\r\n    /**\r\n     * \r\n     */\r\n    get rotation(): number {\r\n        return this.getFloatByIndex(SkyPanoramicMaterial.ROTATION);\r\n    }\r\n\r\n    set rotation(value: number) {\r\n        this.setFloatByIndex(SkyPanoramicMaterial.ROTATION, value);\r\n    }\r\n\r\n    /**\r\n     * \r\n     */\r\n    get panoramicTexture(): Texture2D {\r\n        return <Texture2D>this.getTextureByIndex(SkyPanoramicMaterial.TEXTURE);\r\n    }\r\n\r\n    set panoramicTexture(value: Texture2D) {\r\n        this.setTextureByIndex(SkyPanoramicMaterial.TEXTURE, value);\r\n    }\r\n\r\n    /**\r\n     *  <code>SkyPanoramicMaterial</code> \r\n     */\r\n    constructor() {\r\n        super();\r\n        this.setShaderName(\"SkyPanoramic\");\r\n        this.setColorByIndex(SkyPanoramicMaterial.TINTCOLOR, new Color(0.5, 0.5, 0.5, 0.5));\r\n        this.setFloatByIndex(SkyPanoramicMaterial.ROTATION, 0.0);\r\n        this.setVector4ByIndex(SkyPanoramicMaterial.TEXTURE_HDR_PARAMS, this._textureHDRParams);\r\n        this.exposure = 1.3;\r\n    }\r\n}","#define SHADER_NAME BloomVS\r\n\r\nvarying vec2 v_Texcoord0;\r\nvec4 remapPositionZ(vec4 position)\r\n{\r\n    position.z = position.z * 2.0 - position.w;\r\n    return position;\r\n}\r\nvoid main()\r\n{\r\n    gl_Position = vec4(a_PositionTexcoord.xy, 0.0, 1.0);\r\n    v_Texcoord0 = a_PositionTexcoord.zw;\r\n    gl_Position = remapPositionZ(gl_Position);\r\n}","\r\nimport BloomVS from \"../../../shader/files/postProcess/Bloom/Bloom.vs\";\r\nimport BloomDownsample13PS from \"../../../shader/files/postProcess/Bloom/BloomDownsample13.fs\";\r\nimport BloomDownsample4PS from \"../../../shader/files/postProcess/Bloom/BloomDownsample4.fs\";\r\nimport BloomPrefilter13PS from \"../../../shader/files/postProcess/Bloom/BloomPrefilter13.fs\";\r\nimport BloomPrefilter4PS from \"../../../shader/files/postProcess/Bloom/BloomPrefilter4.fs\";\r\nimport BloomUpsampleBoxPS from \"../../../shader/files/postProcess/Bloom/BloomUpsampleBox.fs\";\r\nimport BloomUpsampleTentPS from \"../../../shader/files/postProcess/Bloom/BloomUpsampleTent.fs\";\r\nimport CompositePS from \"../../../shader/files/postProcess/Bloom/Composite.fs\";\r\nimport CompositeVS from \"../../../shader/files/postProcess/Bloom/Composite.vs\";\r\nimport SamplingGLSL from \"../../../shader/files/postProcess/Sampling.glsl\";\r\nimport StdLibGLSL from \"../../../shader/files/postProcess/StdLib.glsl\";\r\nimport ColorsGLSL from \"../../../shader/files/postProcess/Colors.glsl\";\r\nimport { FilterMode } from \"../../../../RenderEngine/RenderEnum/FilterMode\";\r\nimport { RenderTargetFormat } from \"../../../../RenderEngine/RenderEnum/RenderTargetFormat\";\r\nimport { Shader3D, ShaderFeatureType } from \"../../../../RenderEngine/RenderShader/Shader3D\";\r\nimport { ShaderDataType, ShaderData } from \"../../../../RenderEngine/RenderShader/ShaderData\";\r\nimport { Texture2D } from \"../../../../resource/Texture2D\";\r\nimport { PostProcess } from \"../../../component/PostProcess\";\r\nimport { Viewport } from \"../../../math/Viewport\";\r\nimport { CommandBuffer } from \"../command/CommandBuffer\";\r\nimport { PostProcessEffect } from \"../PostProcessEffect\";\r\nimport { PostProcessRenderContext } from \"../PostProcessRenderContext\";\r\nimport { BaseTexture } from \"../../../../resource/BaseTexture\";\r\nimport { Color } from \"../../../../maths/Color\";\r\nimport { Vector4 } from \"../../../../maths/Vector4\";\r\nimport { RenderTexture } from \"../../../../resource/RenderTexture\";\r\nimport { RenderState } from \"../../../../RenderEngine/RenderShader/RenderState\";\r\nimport { SubShader } from \"../../../../RenderEngine/RenderShader/SubShader\";\r\nimport { VertexMesh } from \"../../../../RenderEngine/RenderShader/VertexMesh\";\r\nimport { LayaGL } from \"../../../../layagl/LayaGL\";\r\n\r\n/**\r\n * <code>BloomEffect</code> \r\n */\r\nexport class BloomEffect extends PostProcessEffect {\r\n\t/** @internal */\r\n\tstatic SHADERVALUE_MAINTEX: number;\r\n\t/**@internal */\r\n\tstatic SHADERVALUE_AUTOEXPOSURETEX: number;\r\n\t/**@internal */\r\n\tstatic SHADERVALUE_SAMPLESCALE: number;\r\n\t/**@internal */\r\n\tstatic SHADERVALUE_THRESHOLD: number;\r\n\t/**@internal */\r\n\tstatic SHADERVALUE_PARAMS: number;\r\n\t/**@internal */\r\n\tstatic SHADERVALUE_BLOOMTEX: number;\r\n\r\n\t/**@internal */\r\n\tstatic SUBSHADER_PREFILTER13: number = 0;\r\n\t/**@internal */\r\n\tstatic SUBSHADER_PREFILTER4: number = 1;\r\n\t/**@internal */\r\n\tstatic SUBSHADER_DOWNSAMPLE13: number = 2;\r\n\t/**@internal */\r\n\tstatic SUBSHADER_DOWNSAMPLE4: number = 3;\r\n\t/**@internal */\r\n\tstatic SUBSHADER_UPSAMPLETENT: number = 4;\r\n\t/**@internal */\r\n\tstatic SUBSHADER_UPSAMPLEBOX: number = 5;\r\n\r\n\t/**@internal */\r\n\tprivate static MAXPYRAMIDSIZE: number = 16; // Just to make sure we handle 64k screens... Future-proof!\r\n\r\n\t/**\r\n\t * bloom resource init\r\n\t */\r\n\tstatic init() {\r\n\t\tShader3D.addInclude(\"StdLib.glsl\", StdLibGLSL);\r\n\t\tShader3D.addInclude(\"Colors.glsl\", ColorsGLSL);\r\n\t\tShader3D.addInclude(\"Sampling.glsl\", SamplingGLSL);\r\n\t\tvar attributeMap: any = {\r\n\t\t\t'a_PositionTexcoord': [VertexMesh.MESH_POSITION0, ShaderDataType.Vector4]\r\n\t\t};\r\n\r\n\t\tvar uniformMap: any = {\r\n\t\t\t\"u_MainTex\": ShaderDataType.Texture2D,\r\n\t\t\t\"u_MainTex_TexelSize\": ShaderDataType.Vector4,\r\n\t\t\t\"u_AutoExposureTex\": ShaderDataType.Texture2D,\r\n\t\t\t\"u_Threshold\": ShaderDataType.Vector4,\r\n\t\t\t\"u_Params\": ShaderDataType.Vector4,\r\n\t\t\t\"u_BloomTex\": ShaderDataType.Texture2D,\r\n\t\t\t\"u_SampleScale\": ShaderDataType.Float,\r\n\t\t};\r\n\t\tvar shader = Shader3D.add(\"PostProcessBloom\");\r\n\t\tshader.shaderType = ShaderFeatureType.PostProcess;\r\n\t\t//subShader0\r\n\t\tvar subShader = new SubShader(attributeMap, uniformMap);\r\n\t\tshader.addSubShader(subShader);\r\n\t\tvar shaderPass = subShader.addShaderPass(BloomVS, BloomPrefilter13PS);\r\n\t\tvar renderState: RenderState = shaderPass.renderState;\r\n\t\trenderState = shaderPass.renderState;\r\n\t\trenderState.depthTest = RenderState.DEPTHTEST_ALWAYS;\r\n\t\trenderState.depthWrite = false;\r\n\t\trenderState.cull = RenderState.CULL_NONE;\r\n\t\trenderState.blend = RenderState.BLEND_DISABLE;\r\n\t\t//subShader1\r\n\t\tsubShader = new SubShader(attributeMap, uniformMap);\r\n\t\tshader.addSubShader(subShader);\r\n\t\tshaderPass = subShader.addShaderPass(BloomVS, BloomPrefilter4PS);\r\n\t\trenderState = shaderPass.renderState;\r\n\t\trenderState.depthTest = RenderState.DEPTHTEST_ALWAYS;\r\n\t\trenderState.depthWrite = false;\r\n\t\trenderState.cull = RenderState.CULL_NONE;\r\n\t\trenderState.blend = RenderState.BLEND_DISABLE;\r\n\t\t//subShader2\r\n\t\tsubShader = new SubShader(attributeMap, uniformMap);\r\n\t\tshader.addSubShader(subShader);\r\n\t\tshaderPass = subShader.addShaderPass(BloomVS, BloomDownsample13PS);\r\n\t\trenderState = shaderPass.renderState;\r\n\t\trenderState.depthTest = RenderState.DEPTHTEST_ALWAYS;\r\n\t\trenderState.depthWrite = false;\r\n\t\trenderState.cull = RenderState.CULL_NONE;\r\n\t\trenderState.blend = RenderState.BLEND_DISABLE;\r\n\t\t//subShader3\r\n\t\tsubShader = new SubShader(attributeMap, uniformMap);\r\n\t\tshader.addSubShader(subShader);\r\n\t\tshaderPass = subShader.addShaderPass(BloomVS, BloomDownsample4PS);\r\n\t\trenderState = shaderPass.renderState;\r\n\t\trenderState.depthTest = RenderState.DEPTHTEST_ALWAYS;\r\n\t\trenderState.depthWrite = false;\r\n\t\trenderState.cull = RenderState.CULL_NONE;\r\n\t\trenderState.blend = RenderState.BLEND_DISABLE;\r\n\t\t//subShader4\r\n\t\tsubShader = new SubShader(attributeMap, uniformMap);\r\n\t\tshader.addSubShader(subShader);\r\n\t\tshaderPass = subShader.addShaderPass(BloomVS, BloomUpsampleTentPS);\r\n\t\trenderState = shaderPass.renderState;\r\n\t\trenderState.depthTest = RenderState.DEPTHTEST_ALWAYS;\r\n\t\trenderState.depthWrite = false;\r\n\t\trenderState.cull = RenderState.CULL_NONE;\r\n\t\trenderState.blend = RenderState.BLEND_DISABLE;\r\n\t\t//subShader5\r\n\t\tsubShader = new SubShader(attributeMap, uniformMap);\r\n\t\tshader.addSubShader(subShader);\r\n\t\tshaderPass = subShader.addShaderPass(BloomVS, BloomUpsampleBoxPS);\r\n\t\trenderState = shaderPass.renderState;\r\n\t\trenderState.depthTest = RenderState.DEPTHTEST_ALWAYS;\r\n\t\trenderState.depthWrite = false;\r\n\t\trenderState.cull = RenderState.CULL_NONE;\r\n\t\trenderState.blend = RenderState.BLEND_DISABLE;\r\n\t\tBloomEffect.CompositeInit();\r\n\t\tBloomEffect.__initDefine__();\r\n\t}\r\n\r\n\tstatic CompositeInit() {\r\n\t\t//PostProcessComposite\r\n\t\tlet attributeMap: any = {\r\n\t\t\t'a_PositionTexcoord': [VertexMesh.MESH_POSITION0, ShaderDataType.Vector4],\r\n\t\t};\r\n\t\tlet uniformMap = {\r\n\t\t\t'u_MainTex': ShaderDataType.Texture2D,\r\n\t\t\t'u_BloomTex': ShaderDataType.Texture2D,\r\n\t\t\t'u_AutoExposureTex': ShaderDataType.Texture2D,\r\n\t\t\t'u_Bloom_DirtTex': ShaderDataType.Texture2D,\r\n\t\t\t'u_BloomTex_TexelSize': ShaderDataType.Vector4,\r\n\t\t\t'u_Bloom_DirtTileOffset': ShaderDataType.Vector4,\r\n\t\t\t'u_Bloom_Settings': ShaderDataType.Vector3,\r\n\t\t\t'u_Bloom_Color': ShaderDataType.Vector3,\r\n\t\t};\r\n\t\tlet shader = Shader3D.add(\"PostProcessComposite\");\r\n\t\tshader.shaderType = ShaderFeatureType.PostProcess;\r\n\t\tlet subShader = new SubShader(attributeMap, uniformMap);\r\n\t\tshader.addSubShader(subShader);\r\n\t\tlet shaderPass = subShader.addShaderPass(CompositeVS, CompositePS);\r\n\t\tlet renderState = shaderPass.renderState;\r\n\t\trenderState.depthTest = RenderState.DEPTHTEST_ALWAYS;\r\n\t\trenderState.depthWrite = false;\r\n\t\trenderState.cull = RenderState.CULL_NONE;\r\n\t\trenderState.blend = RenderState.BLEND_DISABLE;\r\n\t}\r\n\r\n\tstatic __initDefine__() {\r\n\t\tBloomEffect.SHADERVALUE_MAINTEX = Shader3D.propertyNameToID(\"u_MainTex\");\r\n\t\tBloomEffect.SHADERVALUE_AUTOEXPOSURETEX = Shader3D.propertyNameToID(\"u_AutoExposureTex\");\r\n\t\tBloomEffect.SHADERVALUE_SAMPLESCALE = Shader3D.propertyNameToID(\"u_SampleScale\");\r\n\t\tBloomEffect.SHADERVALUE_THRESHOLD = Shader3D.propertyNameToID(\"u_Threshold\");\r\n\t\tBloomEffect.SHADERVALUE_PARAMS = Shader3D.propertyNameToID(\"u_Params\");\r\n\t\tBloomEffect.SHADERVALUE_BLOOMTEX = Shader3D.propertyNameToID(\"u_BloomTex\");\r\n\t}\r\n\r\n\t/**@internal */\r\n\tprivate _shader: Shader3D = null;\r\n\t/**@internal */\r\n\tprivate _shaderData: ShaderData = LayaGL.renderOBJCreate.createShaderData(null);\r\n\t/**@internal */\r\n\tprivate _linearColor: Color = new Color();\r\n\t/**@internal */\r\n\tprivate _bloomTextureTexelSize: Vector4 = new Vector4();\r\n\r\n\t/**@internal */\r\n\tprivate _shaderThreshold: Vector4 = new Vector4();\r\n\t/**@internal */\r\n\tprivate _shaderParams: Vector4 = new Vector4();\r\n\t/**@internal */\r\n\tprivate _pyramid: any[] = null;\r\n\t/**@internal */\r\n\tprivate _intensity: number = 0.0;\r\n\t/**@internal */\r\n\tprivate _threshold: number = 1.0;\r\n\t/**@internal */\r\n\tprivate _softKnee: number = 0.5;\r\n\t/**@internal */\r\n\tprivate _diffusion: number = 7.0;\r\n\t/**@internal */\r\n\tprivate _anamorphicRatio: number = 0.0;\r\n\t/**@internal */\r\n\tprivate _dirtIntensity: number = 0.0;\r\n\t/**@internal */\r\n\tprivate _shaderSetting: Vector4 = new Vector4();\r\n\t/**@internal */\r\n\tprivate _dirtTileOffset: Vector4 = new Vector4();\r\n\r\n\t/**@internal*/\r\n\tprivate _clamp: number;\r\n\r\n\t/***/\r\n\tprivate _color: Color;\r\n\r\n\t/***/\r\n\tprivate _fastMode: boolean = false;\r\n\r\n\t/**,*/\r\n\tprivate _dirtTexture: BaseTexture = null;\r\n\r\n\t/**\r\n\t * ,\r\n\t */\r\n\tget clamp(): number {\r\n\t\treturn this._clamp;\r\n\t}\r\n\r\n\tset clamp(value: number) {\r\n\t\tthis._clamp = value;\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t */\r\n\tget color(): Color {\r\n\t\treturn this._color;\r\n\t}\r\n\r\n\tset color(value: Color) {\r\n\t\tthis._color = value;\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t */\r\n\tget fastMode(): boolean {\r\n\t\treturn this._fastMode;\r\n\t}\r\n\r\n\tset fastMode(value: boolean) {\r\n\t\tthis._fastMode = value;\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t */\r\n\tget dirtTexture() {\r\n\t\treturn this._dirtTexture;\r\n\t}\r\n\r\n\tset dirtTexture(value: BaseTexture) {\r\n\t\tthis._dirtTexture && this._dirtTexture._removeReference(1);\r\n\t\tthis._dirtTexture = value;\r\n\t\tthis._dirtTexture && this._dirtTexture._addReference(1);\r\n\t}\r\n\r\n\t/**\r\n\t * ,0\r\n\t * @return \r\n\t */\r\n\tget intensity(): number {\r\n\t\treturn this._intensity;\r\n\t}\r\n\r\n\t/**\r\n\t * ,0\r\n\t * @param value \r\n\t */\r\n\tset intensity(value: number) {\r\n\t\tthis._intensity = Math.max(value, 0.0);\r\n\t}\r\n\r\n\t/**\r\n\t * ,,\r\n\t * @return \r\n\t */\r\n\tget threshold(): number {\r\n\t\treturn this._threshold;\r\n\t}\r\n\r\n\t/**\r\n\t * ,,\r\n\t * @param value \r\n\t */\r\n\tset threshold(value: number) {\r\n\t\tthis._threshold = Math.max(value, 0.0);\r\n\t}\r\n\r\n\t/**\r\n\t * ,(0,1)\r\n\t * @return \r\n\t */\r\n\tget softKnee(): number {\r\n\t\treturn this._softKnee;\r\n\t}\r\n\r\n\t/**\r\n\t * ,(0,1)\r\n\t * @param value \r\n\t */\r\n\tset softKnee(value: number) {\r\n\t\tthis._softKnee = Math.min(Math.max(value, 0.0), 1.0);\r\n\t}\r\n\r\n\t/**\r\n\t * ,,,,110\r\n\t * @return \r\n\t */\r\n\tget diffusion(): number {\r\n\t\treturn this._diffusion;\r\n\t}\r\n\r\n\t/**\r\n\t * ,,,,110\r\n\t * @param value \r\n\t */\r\n\tset diffusion(value: number) {\r\n\t\tthis._diffusion = Math.min(Math.max(value, 1), 10);\r\n\t}\r\n\r\n\t/**\r\n\t * ,,,-1 - 1\r\n\t * @return \r\n\t */\r\n\tget anamorphicRatio(): number {\r\n\t\treturn this._anamorphicRatio;\r\n\t}\r\n\r\n\t/**\r\n\t * ,,,-1 - 1\r\n\t * @param value \r\n\t */\r\n\tset anamorphicRatio(value: number) {\r\n\t\tthis._anamorphicRatio = Math.min(Math.max(value, -1.0), 1.0);\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t * @return \r\n\t */\r\n\tget dirtIntensity(): number {\r\n\t\treturn this._dirtIntensity;\r\n\t}\r\n\r\n\t/**\r\n\t * 0-1\r\n\t * @param value \r\n\t */\r\n\tset dirtIntensity(value: number) {\r\n\t\tthis._dirtIntensity = Math.max(value, 0.0);\r\n\t}\r\n\r\n\t/**\r\n\t *  <code>BloomEffect</code> \r\n\t */\r\n\tconstructor() {\r\n\t\tsuper();\r\n\t\tthis.singleton = true;\r\n\t\tthis.active = true;\r\n\t\tthis.intensity = 1.0;\r\n\t\tthis.threshold = 1.0;\r\n\t\tthis.softKnee = 0.5;\r\n\t\tthis.clamp = 65472;\r\n\t\tthis.diffusion = 7;\r\n\t\tthis.anamorphicRatio = 0;\r\n\t\tthis.color = new Color(1.0, 1.0, 1.0, 1.0);\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * ,\r\n\t */\r\n\teffectInit(postprocess: PostProcess) {\r\n\t\tsuper.effectInit(postprocess);\r\n\t\tthis._shader = Shader3D.find(\"PostProcessBloom\");\r\n\t\tthis._pyramid = new Array(BloomEffect.MAXPYRAMIDSIZE * 2);\r\n\t}\r\n\r\n\t/**\r\n\t * cameraDepthTextureMode\r\n\t * @inheritDoc\r\n\t * @override\r\n\t * @returns \r\n\t */\r\n\tgetCameraDepthTextureModeFlag() {\r\n\t\treturn 0;\r\n\t}\r\n\r\n\t/**\r\n\t * Effect\r\n\t */\r\n\trelease(postprocess: PostProcess) {\r\n\t\tsuper.release(postprocess);\r\n\t\tthis._shader = null;\r\n\t\tthis._pyramid = [];\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t * @override\r\n\t * @internal\r\n\t */\r\n\trender(context: PostProcessRenderContext): void {\r\n\t\tvar cmd: CommandBuffer = context.command;\r\n\t\tvar viewport: Viewport = context.camera.viewport;\r\n\r\n\t\t//\r\n\t\tthis._shaderData.setTexture(BloomEffect.SHADERVALUE_AUTOEXPOSURETEX, Texture2D.whiteTexture);\r\n\r\n\t\t//\r\n\t\tvar ratio: number = this._anamorphicRatio;\r\n\t\tvar rw: number = ratio < 0 ? -ratio : 0;\r\n\t\tvar rh: number = ratio > 0 ? ratio : 0;\r\n\r\n\t\t//,\r\n\t\tvar tw: number = Math.floor(viewport.width / (2 - rw));\r\n\t\tvar th: number = Math.floor(viewport.height / (2 - rh));\r\n\r\n\t\t//\r\n\t\tvar s: number = Math.max(tw, th);\r\n\t\tvar logs: number;\r\n\t\tlogs = Math.log2(s) + this._diffusion - 10;\r\n\t\tvar logsInt: number = Math.floor(logs);\r\n\t\tvar iterations: number = Math.min(Math.max(logsInt, 1), BloomEffect.MAXPYRAMIDSIZE);\r\n\t\tvar sampleScale: number = 0.5 + logs - logsInt;\r\n\t\tthis._shaderData.setNumber(BloomEffect.SHADERVALUE_SAMPLESCALE, sampleScale);\r\n\r\n\t\t//\r\n\t\tvar lthresh: number = Color.gammaToLinearSpace(this.threshold);\r\n\t\tvar knee: number = lthresh * this._softKnee + 1e-5;\r\n\t\tthis._shaderThreshold.setValue(lthresh, lthresh - knee, knee * 2, 0.25 / knee);\r\n\t\tthis._shaderData.setVector(BloomEffect.SHADERVALUE_THRESHOLD, this._shaderThreshold);\r\n\t\tvar lclamp: number = Color.gammaToLinearSpace(this.clamp);\r\n\r\n\t\tthis._shaderParams.setValue(lclamp, 0, 0, 0);\r\n\t\tthis._shaderData.setVector(BloomEffect.SHADERVALUE_PARAMS, this._shaderParams);\r\n\r\n\t\tvar qualityOffset: number = this.fastMode ? 1 : 0;\r\n\r\n\t\t// Downsample\r\n\t\tvar lastDownTexture: RenderTexture = context.indirectTarget;\r\n\t\tfor (var i: number = 0; i < iterations; i++) {\r\n\t\t\tvar downIndex: number = i * 2;\r\n\t\t\tvar upIndex: number = downIndex + 1;\r\n\t\t\tvar subShader: number = i == 0 ? BloomEffect.SUBSHADER_PREFILTER13 + qualityOffset : BloomEffect.SUBSHADER_DOWNSAMPLE13 + qualityOffset;\r\n\r\n\t\t\tvar mipDownTexture: RenderTexture = RenderTexture.createFromPool(tw, th, RenderTargetFormat.R8G8B8A8, RenderTargetFormat.None, false, 1, false, true);\r\n\t\t\tmipDownTexture.filterMode = FilterMode.Bilinear;\r\n\t\t\tthis._pyramid[downIndex] = mipDownTexture;\r\n\r\n\t\t\tif (i !== iterations - 1) {\r\n\t\t\t\tvar mipUpTexture: RenderTexture = RenderTexture.createFromPool(tw, th, RenderTargetFormat.R8G8B8A8, RenderTargetFormat.None, false, 1, false, true);\r\n\t\t\t\tmipUpTexture.filterMode = FilterMode.Bilinear;\r\n\t\t\t\tthis._pyramid[upIndex] = mipUpTexture;\r\n\t\t\t}\r\n\r\n\t\t\tcmd.blitScreenTriangle(lastDownTexture, mipDownTexture, null, this._shader, this._shaderData, subShader);\r\n\r\n\t\t\tlastDownTexture = mipDownTexture;\r\n\t\t\ttw = Math.max(Math.floor(tw / 2), 1);\r\n\t\t\tth = Math.max(Math.floor(th / 2), 1);\r\n\t\t}\r\n\t\t// Upsample\r\n\t\tvar lastUpTexture: RenderTexture = this._pyramid[(iterations - 1) * 2];//down\r\n\t\tfor (i = iterations - 2; i >= 0; i--) {\r\n\t\t\tdownIndex = i * 2;\r\n\t\t\tupIndex = downIndex + 1;\r\n\t\t\tmipDownTexture = this._pyramid[downIndex];\r\n\t\t\tmipUpTexture = this._pyramid[upIndex];\r\n\t\t\tcmd.setShaderDataTexture(this._shaderData, BloomEffect.SHADERVALUE_BLOOMTEX, mipDownTexture);//\r\n\t\t\tcmd.blitScreenTriangle(lastUpTexture, mipUpTexture, null, this._shader, this._shaderData, BloomEffect.SUBSHADER_UPSAMPLETENT + qualityOffset);\r\n\t\t\tlastUpTexture = mipUpTexture;\r\n\t\t}\r\n\r\n\t\tvar linearColor: Color = this._linearColor;\r\n\t\tthis.color.toLinear(linearColor);\r\n\t\tvar intensity: number = Math.pow(2, this._intensity / 10.0) - 1.0;\r\n\t\tvar shaderSettings: Vector4 = this._shaderSetting;\r\n\t\tthis._shaderSetting.setValue(sampleScale, intensity, this._dirtIntensity, iterations);\r\n\r\n\t\t//\r\n\t\t//\r\n\t\tvar usedirtTexture = this._dirtTexture ? this._dirtTexture : Texture2D.blackTexture;\r\n\r\n\t\tvar dirtRatio: number = usedirtTexture.width / usedirtTexture.height;\r\n\t\tvar screenRatio: number = viewport.width / viewport.height;\r\n\t\tvar dirtTileOffset: Vector4 = this._dirtTileOffset;\r\n\t\tif (dirtRatio > screenRatio)\r\n\t\t\tdirtTileOffset.setValue(screenRatio / dirtRatio, 1.0, (1.0 - dirtTileOffset.x) * 0.5, 0.0);\r\n\t\telse if (dirtRatio < screenRatio)\r\n\t\t\tdirtTileOffset.setValue(1.0, dirtRatio / screenRatio, 0.0, (1.0 - dirtTileOffset.y) * 0.5);\r\n\r\n\t\t//Shader\r\n\t\tvar compositeShaderData: ShaderData = context.compositeShaderData;\r\n\t\tif (this.fastMode)\r\n\t\t\tcompositeShaderData.addDefine(PostProcess.SHADERDEFINE_BLOOM_LOW);\r\n\t\telse\r\n\t\t\tcompositeShaderData.addDefine(PostProcess.SHADERDEFINE_BLOOM);\r\n\r\n\t\tthis._bloomTextureTexelSize.setValue(1.0 / lastUpTexture.width, 1.0 / lastUpTexture.height, lastUpTexture.width, lastUpTexture.height);\r\n\r\n\t\tcompositeShaderData.setVector(PostProcess.SHADERVALUE_BLOOM_DIRTTILEOFFSET, dirtTileOffset);\r\n\t\tcompositeShaderData.setVector(PostProcess.SHADERVALUE_BLOOM_SETTINGS, shaderSettings);\r\n\t\tcompositeShaderData.setVector(PostProcess.SHADERVALUE_BLOOM_COLOR, new Vector4(linearColor.r, linearColor.g, linearColor.b, linearColor.a));//TODO:Color\r\n\t\tcompositeShaderData.setTexture(PostProcess.SHADERVALUE_BLOOM_DIRTTEX, usedirtTexture);\r\n\t\tcompositeShaderData.setTexture(PostProcess.SHADERVALUE_BLOOMTEX, lastUpTexture);\r\n\t\tcompositeShaderData.setVector(PostProcess.SHADERVALUE_BLOOMTEX_TEXELSIZE, this._bloomTextureTexelSize);\r\n\r\n\t\tlet _compositeShader: Shader3D = Shader3D.find(\"PostProcessComposite\");\r\n\r\n\t\tcmd.blitScreenTriangle(context.indirectTarget, context.destination, context.camera._screenOffsetScale, _compositeShader, compositeShaderData, 0);\r\n\r\n\r\n\t\t//\r\n\t\tfor (i = 0; i < iterations; i++) {\r\n\t\t\tdownIndex = i * 2;\r\n\t\t\tupIndex = downIndex + 1;\r\n\t\t\tRenderTexture.recoverToPool(this._pyramid[downIndex]);\r\n\t\t\t(i !== 0 && i !== iterations - 1) && (RenderTexture.recoverToPool(this._pyramid[upIndex]));//i==0lastUpTexture,,i==iterations - 1,\r\n\t\t}\r\n\r\n\t\tcontext.deferredReleaseTextures.push(lastUpTexture);//TODO:\r\n\t}\r\n\r\n}\r\n\r\n\r\n","#define HALF_MAX       65504.0 // (2 - 2^-10) * 2^15\r\n\r\n#define FLT_EPSILON    1.192092896e-07 // Smallest positive number, such that 1.0 + FLT_EPSILON != 1.0\r\n\r\nmediump vec4 safeHDR(mediump vec4 c)\r\n{\r\n    return min(c, HALF_MAX);\r\n}\r\n\r\nfloat max3(float a, float b, float c)\r\n{\r\n    return max(max(a, b), c);\r\n}\r\n\r\nvec3 positivePow(vec3 base, vec3 power)\r\n{\r\n    return pow(max(abs(base), vec3(FLT_EPSILON, FLT_EPSILON, FLT_EPSILON)), power);\r\n}","#include \"StdLib.glsl\";\r\n\r\n#define EPSILON 1.0e-4\r\n\r\n// Quadratic color thresholding\r\n// curve = (threshold - knee, knee * 2, 0.25 / knee)\r\nmediump vec4 quadraticThreshold(mediump vec4 color, mediump float threshold, mediump vec3 curve) {\r\n\t// Pixel brightness\r\n\tmediump float br = max3(color.r, color.g, color.b);\r\n\r\n\t// Under-threshold part: quadratic curve\r\n\tmediump float rq = clamp(br - curve.x, 0.0, curve.y);\r\n\trq = curve.z * rq * rq;\r\n\r\n\t// Combine and apply the brightness response curve.\r\n\tcolor *= max(rq, br - threshold) / max(br, EPSILON);\r\n\r\n\treturn color;\r\n}\r\n\r\n\r\n\r\n//\r\n// sRGB transfer functions\r\n// Fast path ref: http://chilliant.blogspot.com.au/2012/08/srgb-approximations-for-hlsl.html?m=1\r\n//\r\n// mediump vec3 sRGBToLinear(mediump vec3 c) {\r\n// \t#ifdef USE_VERY_FAST_SRGB\r\n// \t\treturn c * c;\r\n// \t#elif defined(USE_FAST_SRGB)\r\n// \t\treturn c * (c * (c * 0.305306011 + 0.682171111) + 0.012522878);\r\n// \t#else\r\n// \t\tmediump vec3 linearRGBLo = c / 12.92;\r\n// \t\tmediump vec3 power=vec3(2.4, 2.4, 2.4);\r\n// \t\tmediump vec3 linearRGBHi = positivePow((c + 0.055) / 1.055, power);\r\n// \t\tmediump vec3 linearRGB =vec3((c.r<=0.04045) ? linearRGBLo.r : linearRGBHi.r,(c.g<=0.04045) ? linearRGBLo.g : linearRGBHi.g,(c.b<=0.04045) ? linearRGBLo.b : linearRGBHi.b);\r\n// \t\treturn linearRGB;\r\n// \t#endif\r\n// }\r\n\r\n// mediump vec4 sRGBToLinear(mediump vec4 c){\r\n//     return vec4(sRGBToLinear(c.rgb), c.a);\r\n// }\r\n\r\n\r\n\r\n// mediump vec3 linearToSRGB(mediump vec3 c) {\r\n// \t#ifdef USE_VERY_FAST_SRGB\r\n// \t\treturn sqrt(c);\r\n// \t#elif defined(USE_FAST_SRGB)\r\n// \t\treturn max(1.055 * PositivePow(c, 0.416666667) - 0.055, 0.0);\r\n// \t#else\r\n// \t\tmediump vec3 sRGBLo = c * 12.92;\r\n// \t\tmediump vec3 power=vec3(1.0 / 2.4, 1.0 / 2.4, 1.0 / 2.4);\r\n// \t\tmediump vec3 sRGBHi = (positivePow(c, power) * 1.055) - 0.055;\r\n// \t\tmediump vec3 sRGB =vec3((c.r<=0.0031308) ? sRGBLo.r : sRGBHi.r,(c.g<=0.0031308) ? sRGBLo.g : sRGBHi.g,(c.b<=0.0031308) ? sRGBLo.b : sRGBHi.b);\r\n// \t\treturn sRGB;\r\n// \t#endif\r\n// }\r\n\r\n// mediump vec4 linearToSRGB(mediump vec4 c){\r\n//     return vec4(linearToSRGB(c.rgb), c.a);\r\n// }","\r\n// todo only sampler u_MainTex\r\nvec4 samplerTex(sampler2D tex, vec2 uv)\r\n{\r\n    vec4 mainSampler = texture2D(tex, uv);\r\n#ifdef Gamma_u_MainTex\r\n    mainSampler = gammaToLinear(mainSampler);\r\n#endif // Gamma_u_MainTex\r\n\r\n    return mainSampler;\r\n}\r\n\r\n// Better, temporally stable box filtering\r\n// [Jimenez14] http://goo.gl/eomGso\r\n// . . . . . . .\r\n// . A . B . C .\r\n// . . D . E . .\r\n// . F . G . H .\r\n// . . I . J . .\r\n// . K . L . M .\r\n// . . . . . . .\r\nmediump vec4 downsampleBox13Tap(sampler2D tex, vec2 uv, vec2 texelSize)\r\n{\r\n    mediump vec4 A = samplerTex(tex, uv + texelSize * vec2(-1.0, -1.0));\r\n    mediump vec4 B = samplerTex(tex, uv + texelSize * vec2(0.0, -1.0));\r\n    mediump vec4 C = samplerTex(tex, uv + texelSize * vec2(1.0, -1.0));\r\n    mediump vec4 D = samplerTex(tex, uv + texelSize * vec2(-0.5, -0.5));\r\n    mediump vec4 E = samplerTex(tex, uv + texelSize * vec2(0.5, -0.5));\r\n    mediump vec4 F = samplerTex(tex, uv + texelSize * vec2(-1.0, 0.0));\r\n    mediump vec4 G = samplerTex(tex, uv);\r\n    mediump vec4 H = samplerTex(tex, uv + texelSize * vec2(1.0, 0.0));\r\n    mediump vec4 I = samplerTex(tex, uv + texelSize * vec2(-0.5, 0.5));\r\n    mediump vec4 J = samplerTex(tex, uv + texelSize * vec2(0.5, 0.5));\r\n    mediump vec4 K = samplerTex(tex, uv + texelSize * vec2(-1.0, 1.0));\r\n    mediump vec4 L = samplerTex(tex, uv + texelSize * vec2(0.0, 1.0));\r\n    mediump vec4 M = samplerTex(tex, uv + texelSize * vec2(1.0, 1.0));\r\n\r\n    mediump vec2 scale = vec2(0.5, 0.125);\r\n    mediump vec2 div = (1.0 / 4.0) * scale;\r\n\r\n    mediump vec4 o = (D + E + I + J) * div.x;\r\n    o += (A + B + G + F) * div.y;\r\n    o += (B + C + H + G) * div.y;\r\n    o += (F + G + L + K) * div.y;\r\n    o += (G + H + M + L) * div.y;\r\n\r\n    return o;\r\n}\r\n\r\n// Standard box filtering\r\nmediump vec4 downsampleBox4Tap(sampler2D tex, vec2 uv, vec2 texelSize)\r\n{\r\n    vec4 d = texelSize.xyxy * vec4(-1.0, -1.0, 1.0, 1.0);\r\n\r\n    mediump vec4 s = samplerTex(tex, uv + d.xy);\r\n    s += samplerTex(tex, uv + d.zy);\r\n    s += samplerTex(tex, uv + d.xw);\r\n    s += samplerTex(tex, uv + d.zw);\r\n\r\n    return s * (1.0 / 4.0);\r\n}\r\n\r\n// 9-tap bilinear upsampler (tent filter)\r\n// . . . . . . .\r\n// . 1 . 2 . 1 .\r\n// . . . . . . .\r\n// . 2 . 4 . 2 .\r\n// . . . . . . .\r\n// . 1 . 2 . 1 .\r\n// . . . . . . .\r\nmediump vec4 upsampleTent(sampler2D tex, vec2 uv, vec2 texelSize, vec4 sampleScale)\r\n{\r\n    vec4 d = texelSize.xyxy * vec4(1.0, 1.0, -1.0, 0.0) * sampleScale;\r\n\r\n    mediump vec4 s = samplerTex(tex, uv - d.xy);\r\n    s += samplerTex(tex, uv - d.wy) * 2.0;\r\n    s += samplerTex(tex, uv - d.zy);\r\n\r\n    s += samplerTex(tex, uv + d.zw) * 2.0;\r\n    s += samplerTex(tex, uv) * 4.0;\r\n    s += samplerTex(tex, uv + d.xw) * 2.0;\r\n\r\n    s += samplerTex(tex, uv + d.zy);\r\n    s += samplerTex(tex, uv + d.wy) * 2.0;\r\n    s += samplerTex(tex, uv + d.xy);\r\n\r\n    return s * (1.0 / 16.0);\r\n}\r\n\r\n// Standard box filtering\r\nmediump vec4 upsampleBox(sampler2D tex, vec2 uv, vec2 texelSize, vec4 sampleScale)\r\n{\r\n    vec4 d = texelSize.xyxy * vec4(-1.0, -1.0, 1.0, 1.0) * 0.5 * sampleScale;\r\n\r\n    mediump vec4 s = samplerTex(tex, uv + d.xy);\r\n    s += samplerTex(tex, uv + d.zy);\r\n    s += samplerTex(tex, uv + d.xw);\r\n    s += samplerTex(tex, uv + d.zw);\r\n\r\n    return s * (1.0 / 4.0);\r\n}","#define SHADER_NAME BloomPreFilter13FS\r\n\r\n#include \"Color.glsl\";\r\n#include \"Colors.glsl\";\r\n#include \"Sampling.glsl\";\r\n\r\nvarying vec2 v_Texcoord0;\r\n\r\nmediump vec4 prefilter(mediump vec4 color, vec2 uv)\r\n{\r\n    vec4 autoExposureSampler = texture2D(u_AutoExposureTex, uv);\r\n#ifdef Gamma_u_AutoExposureTex\r\n    autoExposureSampler = gammaToLinear(autoExposureSampler);\r\n#endif // Gamma_u_AutoExposureTex\r\n\r\n    mediump float autoExposure = autoExposureSampler.r;\r\n    color *= autoExposure;\r\n    color = min(vec4(u_Params.x), color); // clamp to max\r\n    color = quadraticThreshold(color, u_Threshold.x, u_Threshold.yzw);\r\n    return color;\r\n}\r\n\r\nvoid fragPrefilter13()\r\n{\r\n    mediump vec4 color = downsampleBox13Tap(u_MainTex, v_Texcoord0, u_MainTex_TexelSize.xy);\r\n    gl_FragColor = prefilter(safeHDR(color), v_Texcoord0);\r\n}\r\n\r\nvoid main()\r\n{\r\n    fragPrefilter13();\r\n\r\n    gl_FragColor = outputTransform(gl_FragColor);\r\n}","#define SHADER_NAME BloomPreFilter4FS\r\n\r\n#include \"Color.glsl\";\r\n#include \"Colors.glsl\";\r\n#include \"Sampling.glsl\";\r\n\r\nvarying vec2 v_Texcoord0;\r\n\r\nmediump vec4 prefilter(mediump vec4 color, vec2 uv)\r\n{\r\n    vec4 autoExposureSampler = texture2D(u_AutoExposureTex, uv);\r\n#ifdef Gamma_u_AutoExposureTex\r\n    autoExposureSampler = gammaToLinear(autoExposureSampler);\r\n#endif // Gamma_u_AutoExposureTex\r\n\r\n    mediump float autoExposure = autoExposureSampler.r;\r\n    color *= autoExposure;\r\n    color = min(vec4(u_Params.x), color); // clamp to max\r\n    color = quadraticThreshold(color, u_Threshold.x, u_Threshold.yzw);\r\n    return color;\r\n}\r\n\r\nvoid fragPrefilter4()\r\n{\r\n    mediump vec4 color = downsampleBox4Tap(u_MainTex, v_Texcoord0, u_MainTex_TexelSize.xy);\r\n    gl_FragColor = prefilter(safeHDR(color), v_Texcoord0);\r\n}\r\n\r\nvoid main()\r\n{\r\n    fragPrefilter4();\r\n\r\n    gl_FragColor = outputTransform(gl_FragColor);\r\n}","#define SHADER_NAME BloomDownSample13FS\r\n\r\n#include \"Color.glsl\";\r\n#include \"Colors.glsl\";\r\n#include \"Sampling.glsl\";\r\n\r\nvarying vec2 v_Texcoord0;\r\n\r\nvoid fragDownsample13()\r\n{\r\n    mediump vec4 color = downsampleBox13Tap(u_MainTex, v_Texcoord0, u_MainTex_TexelSize.xy);\r\n    gl_FragColor = color;\r\n}\r\n\r\nvoid main()\r\n{\r\n    fragDownsample13();\r\n\r\n    gl_FragColor = outputTransform(gl_FragColor);\r\n}","#define SHADER_NAME BloomDownSample4FS\r\n\r\n#include \"Color.glsl\";\r\n#include \"Colors.glsl\";\r\n#include \"Sampling.glsl\";\r\n\r\nvarying vec2 v_Texcoord0;\r\n\r\nvoid fragDownsample4()\r\n{\r\n    mediump vec4 color = downsampleBox4Tap(u_MainTex, v_Texcoord0, u_MainTex_TexelSize.xy);\r\n    gl_FragColor = color;\r\n}\r\n\r\nvoid main()\r\n{\r\n    fragDownsample4();\r\n\r\n    gl_FragColor = outputTransform(gl_FragColor);\r\n}","#define SHADER_NAME BloomUpSampleTentFS\r\n\r\n#include \"Color.glsl\";\r\n#include \"Colors.glsl\";\r\n#include \"Sampling.glsl\";\r\n\r\nvarying vec2 v_Texcoord0;\r\n\r\nmediump vec4 combine(mediump vec4 bloom, vec2 uv)\r\n{\r\n    mediump vec4 color = texture2D(u_BloomTex, uv);\r\n#ifdef Gamma_u_BloomTex\r\n    color = gammaToLinear(color);\r\n#endif // Gamma_u_BloomTex\r\n    return bloom + color;\r\n}\r\n\r\nvoid fragUpsampleTent()\r\n{\r\n    mediump vec4 bloom = upsampleTent(u_MainTex, v_Texcoord0, u_MainTex_TexelSize.xy, vec4(u_SampleScale));\r\n    gl_FragColor = combine(bloom, v_Texcoord0);\r\n}\r\n\r\nvoid main()\r\n{\r\n    fragUpsampleTent();\r\n\r\n    gl_FragColor = outputTransform(gl_FragColor);\r\n}","#define SHADER_NAME BloomUpSampleBoxFS\r\n\r\n#include \"Color.glsl\";\r\n#include \"Colors.glsl\";\r\n#include \"Sampling.glsl\";\r\n\r\nvarying vec2 v_Texcoord0;\r\n\r\nmediump vec4 combine(mediump vec4 bloom, vec2 uv)\r\n{\r\n    mediump vec4 color = texture2D(u_BloomTex, uv);\r\n#ifdef Gamma_u_BloomTex\r\n    color = gammaToLinear(color);\r\n#endif // Gamma_u_BloomTex\r\n    return bloom + color;\r\n}\r\n\r\nvoid fragUpsampleBox()\r\n{\r\n    mediump vec4 bloom = upsampleBox(u_MainTex, v_Texcoord0, u_MainTex_TexelSize.xy, vec4(u_SampleScale));\r\n    gl_FragColor = combine(bloom, v_Texcoord0);\r\n}\r\n\r\nvoid main()\r\n{\r\n    fragUpsampleBox();\r\n\r\n    gl_FragColor = outputTransform(gl_FragColor);\r\n}","#define SHADER_NAME CompositeVS\r\nvarying vec2 v_Texcoord0;\r\nvec4 remapPositionZ(vec4 position)\r\n{\r\n    position.z = position.z * 2.0 - position.w;\r\n    return position;\r\n}\r\nvoid main() {\r\n\tgl_Position = vec4(a_PositionTexcoord.xy, 0.0, 1.0);\r\n\tv_Texcoord0 = a_PositionTexcoord.zw;\r\n\tgl_Position = remapPositionZ(gl_Position);\r\n}","#define SHADER_NAME CompositeFS\r\n\r\n#include \"Color.glsl\";\r\n#include \"Colors.glsl\";\r\n#include \"Sampling.glsl\";\r\n\r\nvarying vec2 v_Texcoord0;\r\n\r\nvoid main()\r\n{\r\n    vec4 autoExposureSampler = texture2D(u_AutoExposureTex, v_Texcoord0);\r\n#ifdef Gamma_u_AutoExposureTex\r\n    autoExposureSampler = gammaToLinear(autoExposureSampler);\r\n#endif // Gamma_u_AutoExposureTex\r\n    mediump float autoExposure = autoExposureSampler.r;\r\n\r\n    mediump vec4 color = vec4(0.0);\r\n    color = texture2D(u_MainTex, v_Texcoord0);\r\n#ifdef Gamma_u_MainTex\r\n    color = gammaToLinear(color);\r\n#endif // Gamma_u_MainTex\r\n\r\n    color.rgb *= autoExposure;\r\n\r\n#if defined(BLOOM) || defined(BLOOM_LOW)\r\n    #ifdef BLOOM\r\n    mediump vec4 bloom = upsampleTent(u_BloomTex, v_Texcoord0, u_BloomTex_TexelSize.xy, vec4(u_Bloom_Settings.x));\r\n    #else\r\n    mediump vec4 bloom = upsampleBox(u_BloomTex, v_Texcoord0, u_BloomTex_TexelSize.xy, vec4(u_Bloom_Settings.x));\r\n    #endif\r\n\r\n    // UVs should be Distort(uv * u_Bloom_DirtTileOffset.xy + u_Bloom_DirtTileOffset.zw)\r\n    // but considering we use a cover-style scale on the dirt texture the difference\r\n    // isn't massive so we chose to save a few ALUs here instead in case lens distortion\r\n    // is active\r\n    mediump vec4 dirt = vec4(texture2D(u_Bloom_DirtTex, v_Texcoord0 * u_Bloom_DirtTileOffset.xy + u_Bloom_DirtTileOffset.zw).rgb, 0.0);\r\n    #ifdef Gamma_u_Bloom_DirtTex\r\n    dirt = gammaToLinear(dirt);\r\n    #endif // Gamma_u_Bloom_DirtTex\r\n\r\n    // Additive bloom (artist friendly)\r\n    bloom *= u_Bloom_Settings.y;\r\n    dirt *= u_Bloom_Settings.z;\r\n    mediump vec4 bloomColor = vec4(u_Bloom_Color, 1.0);\r\n    color += bloom * bloomColor;\r\n    color += dirt * bloom;\r\n#endif\r\n\r\n    mediump vec4 finalColor = color;\r\n    // finalColor = linearToSRGB(finalColor);\r\n    // finalColor.rgb = Dither(finalColor.rgb, v_Texcoord0);//TODO:\r\n    gl_FragColor = finalColor;\r\n\r\n    gl_FragColor = outputTransform(gl_FragColor);\r\n}","#define SHADER_NAME OcclusionEstimationFS\r\n\r\n#include \"DepthNormalUtil.glsl\";\r\n\r\n#include \"AmbientOcclusion.glsl\";\r\n\r\n#define FIX_SAMPLING_PATTERN\r\n\r\n// Check if the camera is perspective.\r\n// (returns 1.0 when orthographic)\r\nfloat CheckPerspective(float x)\r\n{\r\n    // todo ortho\r\n    return mix(x, 1.0, 0.0);\r\n}\r\n\r\nvec3 ReconstructViewPos(vec2 uv, float depth, vec2 p11_22, vec2 p13_31)\r\n{\r\n    return vec3((uv * 2.0 - 1.0 - p13_31) / p11_22 * CheckPerspective(depth), depth);\r\n}\r\n\r\n// Pseudo random number generator with 2D coordinates\r\n// https://stackoverflow.com/questions/12964279/whats-the-origin-of-this-glsl-rand-one-liner\r\nfloat UVRandom(float u, float v)\r\n{\r\n    float f = dot(vec2(12.9898, 78.233), vec2(u, v));\r\n    return fract(43758.5453 * sin(f));\r\n}\r\n\r\nvec2 CosSin(float theta)\r\n{\r\n    // float sn, cs;\r\n    // sincos(theta, sn, cs);\r\n    float sn = sin(theta);\r\n    float cs = cos(theta);\r\n    return vec2(cs, sn);\r\n}\r\n\r\nfloat GradientNoise(vec2 uv)\r\n{\r\n    uv = floor(uv * u_MainTex_TexelSize.zw);\r\n    float f = dot(vec2(0.06711056, 0.00583715), uv);\r\n    return fract(52.9829189 * fract(f));\r\n}\r\n\r\n// Sample point picker\r\nvec3 PickSamplePoint(vec2 uv, float index)\r\n{\r\n#if defined(FIX_SAMPLING_PATTERN)\r\n    float gn = GradientNoise(uv * DOWNSAMPLE);\r\n    float u = fract(UVRandom(0.0, index + uv.x * 1e-10) + gn) * 2.0 - 1.0;\r\n    float theta = (UVRandom(1.0, index + uv.x * 1e-10) + gn) * TWO_PI;\r\n#else\r\n    float u = UVRandom(uv.x + u_PlugTime.x, uv.y + index) * 2.0 - 1.0;\r\n    float theta = UVRandom(-uv.x - u_PlugTime.x, uv.y + index) * TWO_PI;\r\n#endif\r\n\r\n    vec3 v = vec3(CosSin(theta) * sqrt(1.0 - u * u), u);\r\n    float l = sqrt((index + 1.0) / float(SAMPLE_COUNT)) * RADIUS;\r\n    return v * l;\r\n}\r\n\r\nvoid main()\r\n{\r\n    vec2 uv = v_Texcoord0;\r\n\r\n    mat3 proj = mat3(u_Projection);\r\n    vec2 p11_22 = vec2(u_Projection[0][0], u_Projection[1][1]);\r\n    vec2 p13_31 = vec2(u_Projection[2][0], u_Projection[2][1]);\r\n\r\n    vec3 norm_o;\r\n    float depth_o = SampleDepthNormal(uv, norm_o);\r\n\r\n    // Reconstruct the view-space position.\r\n    vec3 vpos_o = ReconstructViewPos(uv, depth_o, p11_22, p13_31);\r\n\r\n    float ao = 0.0;\r\n\r\n    for (int s = 0; s < int(SAMPLE_COUNT); s++)\r\n\t{\r\n\t    float s_float = float(s);\r\n\t    vec3 v_s1 = PickSamplePoint(uv, s_float);\r\n\r\n\t    v_s1 = faceforward(v_s1, -norm_o, v_s1);\r\n\t    vec3 vpos_s1 = vpos_o + v_s1;\r\n\r\n\t    // Reproject the sample point\r\n\t    vec3 spos_s1 = proj * vpos_s1;\r\n\t    vec2 uv_s1_01 = (spos_s1.xy / CheckPerspective(vpos_s1.z) + 1.0) * 0.5;\r\n\r\n\t    float depth_s1 = SampleDepth(uv_s1_01);\r\n\r\n\t    vec3 vpos_s2 = ReconstructViewPos(uv_s1_01, depth_s1, p11_22, p13_31);\r\n\t    vec3 v_s2 = vpos_s2 - vpos_o;\r\n\r\n\t    float a1 = max(dot(v_s2, norm_o) - kBeta * depth_o, 0.0);\r\n\t    float a2 = dot(v_s2, v_s2) + EPSILON;\r\n\r\n\t    ao += a1 / a2;\r\n\t}\r\n\r\n    ao *= RADIUS;\r\n\r\n    ao = PositivePow(ao * INTENSITY / float(SAMPLE_COUNT), kContrast);\r\n\r\n    gl_FragColor = PackAONormal(ao, norm_o);\r\n}\r\n\r\n/**\r\n    0.8741,     0,          0,          0,\r\n    0,          1.7320,     0,          0,\r\n    0,          0,          -1.0152,    -1,\r\n    0,          0,          -0.3046,    0\r\n**/","\r\n\r\nimport BlitScreenVS from \"../../../shader/postprocess/BlitScreen.vs\";\r\nimport FragAO from \"../../../shader/files/postProcess/ScalableAO/FragAO.fs\";\r\nimport AoBlurHorizontal from \"../../../shader/files/postProcess/ScalableAO/AoBlurHorizontal.fs\";\r\nimport AOComposition from \"../../../shader/files/postProcess/ScalableAO/AOComposition.fs\";\r\nimport AmbientOcclusion from \"../../../shader/files/postProcess/ScalableAO/AmbientOcclusion.glsl\";\r\nimport { RenderTargetFormat } from \"../../../../RenderEngine/RenderEnum/RenderTargetFormat\";\r\nimport { WrapMode } from \"../../../../RenderEngine/RenderEnum/WrapMode\";\r\nimport { Shader3D, ShaderFeatureType } from \"../../../../RenderEngine/RenderShader/Shader3D\";\r\nimport { ShaderDataType, ShaderData } from \"../../../../RenderEngine/RenderShader/ShaderData\";\r\nimport { DepthTextureMode } from \"../../../depthMap/DepthPass\";\r\nimport { Viewport } from \"../../../math/Viewport\";\r\nimport { Camera } from \"../../Camera\";\r\nimport { CommandBuffer } from \"../command/CommandBuffer\";\r\nimport { PostProcessEffect } from \"../PostProcessEffect\";\r\nimport { PostProcessRenderContext } from \"../PostProcessRenderContext\";\r\nimport { BaseCamera } from \"../../BaseCamera\";\r\nimport { ShaderDefine } from \"../../../../RenderEngine/RenderShader/ShaderDefine\";\r\nimport { Color } from \"../../../../maths/Color\";\r\nimport { Vector2 } from \"../../../../maths/Vector2\";\r\nimport { Vector3 } from \"../../../../maths/Vector3\";\r\nimport { Vector4 } from \"../../../../maths/Vector4\";\r\nimport { RenderTexture } from \"../../../../resource/RenderTexture\";\r\nimport { SubShader } from \"../../../../RenderEngine/RenderShader/SubShader\";\r\nimport { VertexMesh } from \"../../../../RenderEngine/RenderShader/VertexMesh\";\r\nimport { LayaGL } from \"../../../../layagl/LayaGL\";\r\n\r\n/**\r\n * AO\r\n */\r\nexport enum AOQUALITY{\r\n    /** */\r\n    High,\r\n    /** */\r\n    MEDIUM,\r\n    /** */\r\n    LOWEST\r\n}\r\n\r\n/**\r\n * <code>BloomEffect</code> \r\n */\r\nexport class ScalableAO extends PostProcessEffect {\r\n\r\n    /**@internal */\r\n    static SHADERDEFINE_AOHigh: ShaderDefine;\r\n\r\n    /**@internal */\r\n    static SHADERDEFINE_AOMEDIUM: ShaderDefine;\r\n\r\n    /**@internal */\r\n    static SHADERDEFINE_LOWEST: ShaderDefine;\r\n\r\n    /**@internal */\r\n    static BlurDelty: number;\r\n\r\n    /**@internal */\r\n    static AOColor: number;\r\n\r\n    /**@internal */\r\n    static aoTexture: number;\r\n\r\n    /**@internal */\r\n    static AOParams: number;\r\n\r\n    /**@internal */\r\n    static SourceTex: number;\r\n\r\n    /**@internal */\r\n    static deltyHorizontal: Vector2 = new Vector2(1.0, 0.0);\r\n\r\n    /**@internal */\r\n    static deltyVector: Vector2 = new Vector2(0.0, 1.0);\r\n\r\n    /**\r\n     * scaleAO resource init\r\n     */\r\n    static init() {\r\n        ScalableAO.BlurDelty = Shader3D.propertyNameToID(\"u_Delty\");\r\n        ScalableAO.AOColor = Shader3D.propertyNameToID(\"u_AOColor\");\r\n        ScalableAO.aoTexture = Shader3D.propertyNameToID(\"u_compositionAoTexture\");\r\n\r\n        ScalableAO.AOParams = Shader3D.propertyNameToID('u_AOParams');\r\n        ScalableAO.SourceTex = Shader3D.propertyNameToID('u_SourceTex');\r\n        ScalableAO.SHADERDEFINE_AOHigh =Shader3D.getDefineByName(\"AO_High\");\r\n        ScalableAO.SHADERDEFINE_AOMEDIUM =Shader3D.getDefineByName(\"AO_MEDIUM\");\r\n        ScalableAO.SHADERDEFINE_LOWEST =Shader3D.getDefineByName(\"AO_LOWEST\");\r\n        Shader3D.addInclude(\"AmbientOcclusion.glsl\", AmbientOcclusion);\r\n        //scalableAoShader\r\n        let attributeMap: any = {\r\n            'a_PositionTexcoord': [VertexMesh.MESH_POSITION0, ShaderDataType.Vector4]\r\n        };\r\n        let uniformMap: any = {\r\n            'u_OffsetScale': ShaderDataType.Vector4,\r\n            'u_MainTex': ShaderDataType.Texture2D,\r\n            'u_MainTex_TexelSize': ShaderDataType.Vector4,\r\n            'u_Delty': ShaderDataType.Vector2,\r\n            'u_PlugTime': ShaderDataType.Vector4,\r\n            'u_AOParams': ShaderDataType.Vector4,\r\n            'u_BlurVector': ShaderDataType.Vector2,\r\n            'u_AOColor': ShaderDataType.Color,\r\n            'u_compositionAoTexture': ShaderDataType.Texture2D\r\n\r\n        }\r\n        let shader: Shader3D = Shader3D.add(\"ScalableAO\");\r\n        shader.shaderType = ShaderFeatureType.PostProcess;\r\n        let subShader: SubShader = new SubShader(attributeMap, uniformMap);\r\n        shader.addSubShader(subShader);\r\n        subShader.addShaderPass(BlitScreenVS, FragAO);\r\n        //BlurShader\r\n        shader = Shader3D.add(\"AOBlurHorizontal\");\r\n        shader.shaderType = ShaderFeatureType.PostProcess;\r\n        subShader = new SubShader(attributeMap, uniformMap);\r\n        shader.addSubShader(subShader);\r\n        subShader.addShaderPass(BlitScreenVS, AoBlurHorizontal);\r\n\r\n        //Composition\r\n        shader = Shader3D.add(\"AOComposition\");\r\n        shader.shaderType = ShaderFeatureType.PostProcess;\r\n        subShader = new SubShader(attributeMap, uniformMap);\r\n        shader.addSubShader(subShader);\r\n        subShader.addShaderPass(BlitScreenVS, AOComposition);\r\n    }\r\n\r\n    /*@internal scalable AO shader*/\r\n    private _shader: Shader3D;\r\n\r\n    /**@internal shader data */\r\n    private _shaderData: ShaderData;\r\n\r\n    /*@internal blurHorizontal Ao Shader */\r\n    private _aoBlurHorizontalShader: Shader3D;\r\n\r\n    /**@internal */\r\n    private _aoComposition: Shader3D;\r\n\r\n    /**@internal */\r\n    private _aoParams: Vector3 = new Vector3();\r\n\r\n    private _aoQuality:AOQUALITY = AOQUALITY.MEDIUM;\r\n\r\n    /**\r\n     * AO\r\n     */\r\n    constructor() {\r\n        super();\r\n        this._shader = Shader3D.find(\"ScalableAO\");\r\n        this._shaderData = LayaGL.renderOBJCreate.createShaderData(null);\r\n        this._aoParams = new Vector3(0.12, 0.15, 1);\r\n        this._shaderData.setVector3(ScalableAO.AOParams, this._aoParams);\r\n        this._shaderData.setVector(BaseCamera.DEPTHZBUFFERPARAMS, new Vector4());\r\n        this._aoBlurHorizontalShader = Shader3D.find(\"AOBlurHorizontal\");\r\n        this._aoComposition = Shader3D.find(\"AOComposition\");\r\n        this.aoQuality = AOQUALITY.MEDIUM;\r\n    }\r\n\r\n\r\n\r\n    /**\r\n     * ao Color\r\n     */\r\n    set aoColor(value: Color) {\r\n        this._shaderData.setColor(ScalableAO.AOColor, value);\r\n    }\r\n\r\n    get aoColor() {\r\n        return this._shaderData.getColor(ScalableAO.AOColor);\r\n    }\r\n\r\n    /**\r\n     * ao intensity\r\n     */\r\n    set intensity(value: number) {\r\n        this._aoParams.x = value;\r\n        this._shaderData.setVector3(ScalableAO.AOParams, this._aoParams);\r\n    }\r\n\r\n    get intensity() {\r\n        return this._aoParams.x;\r\n    }\r\n\r\n    /**\r\n     * ao\r\n     */\r\n    set radius(value: number) {\r\n        this._aoParams.y = value;\r\n        this._shaderData.setVector3(ScalableAO.AOParams, this._aoParams);\r\n    }\r\n\r\n    get radius() {\r\n        return this._aoParams.y;\r\n    }\r\n\r\n    /**\r\n     * ao\r\n     */\r\n    get aoQuality(){\r\n        return this._aoQuality;\r\n    }\r\n\r\n    set aoQuality(value:AOQUALITY){\r\n        this._aoQuality = value;\r\n        switch(value){\r\n            case AOQUALITY.High:\r\n                this._shaderData.addDefine(ScalableAO.SHADERDEFINE_AOHigh);\r\n                this._shaderData.removeDefine(ScalableAO.SHADERDEFINE_AOMEDIUM);\r\n                this._shaderData.removeDefine(ScalableAO.SHADERDEFINE_LOWEST);\r\n                break;\r\n            case AOQUALITY.MEDIUM:\r\n                this._shaderData.addDefine(ScalableAO.SHADERDEFINE_AOMEDIUM);\r\n                this._shaderData.removeDefine(ScalableAO.SHADERDEFINE_AOHigh);\r\n                this._shaderData.removeDefine(ScalableAO.SHADERDEFINE_LOWEST);\r\n                break;\r\n            case AOQUALITY.LOWEST:\r\n                this._shaderData.addDefine(ScalableAO.SHADERDEFINE_LOWEST);\r\n                this._shaderData.removeDefine(ScalableAO.SHADERDEFINE_AOHigh);\r\n                this._shaderData.removeDefine(ScalableAO.SHADERDEFINE_AOMEDIUM);\r\n                break;\r\n        }\r\n    }\r\n    \r\n    /**\r\n     * @override\r\n     */\r\n    getCameraDepthTextureModeFlag() {\r\n        return DepthTextureMode.DepthAndDepthNormals;\r\n    }\r\n\r\n    /**\r\n     * @override\r\n     * @param context \r\n     */\r\n    render(context: PostProcessRenderContext): void {\r\n        let cmd: CommandBuffer = context.command;\r\n        let viewport: Viewport = context.camera.viewport;\r\n        let camera: Camera = context.camera;\r\n\r\n        // camera rendermode\r\n        camera.depthTextureMode |= DepthTextureMode.DepthNormals;\r\n        camera.depthTextureMode |= DepthTextureMode.Depth;\r\n\r\n        let depthNormalTexture: RenderTexture = camera.depthNormalTexture;\r\n        let depthTexture = camera.depthTexture;\r\n\r\n        if (!depthNormalTexture || !depthTexture) {\r\n            return;\r\n        }\r\n\r\n        depthNormalTexture.wrapModeU = WrapMode.Clamp;\r\n        depthNormalTexture.wrapModeV = WrapMode.Clamp;\r\n\r\n        let source: RenderTexture = context.source;\r\n        let width = source.width;\r\n        let height = source.height;\r\n        let textureFormat: RenderTargetFormat = source.colorFormat;\r\n        let depthFormat: RenderTargetFormat = RenderTargetFormat.None;\r\n\r\n        let finalTex: RenderTexture = RenderTexture.createFromPool(width, height, textureFormat, depthFormat, false, 1);\r\n\r\n        let shader: Shader3D = this._shader;\r\n        let shaderData: ShaderData = this._shaderData;\r\n        //depthTexture;\r\n        //depthNormalTexture;\r\n        cmd.blitScreenTriangle(null, finalTex, null, shader, shaderData, 0);\r\n        //context.source = finalTex;\r\n        let blurTex: RenderTexture = RenderTexture.createFromPool(width, height, textureFormat, depthFormat, false, 1);\r\n        //blur horizontal\r\n        cmd.blitScreenTriangle(finalTex, blurTex, null, this._aoBlurHorizontalShader, shaderData, 0);\r\n        //blur Vec\r\n        cmd.setShaderDataVector2(shaderData, ScalableAO.BlurDelty, ScalableAO.deltyVector);\r\n        cmd.blitScreenTriangle(blurTex, finalTex, null, this._aoBlurHorizontalShader, this._shaderData, 0);\r\n        //blur Composition\r\n        cmd.setShaderDataTexture(shaderData, ScalableAO.aoTexture, finalTex);\r\n        cmd.blitScreenTriangle(context.source, context.destination, null, this._aoComposition, this._shaderData, 0);\r\n        //context.source = blurTex;\r\n        context.deferredReleaseTextures.push(finalTex);\r\n        context.deferredReleaseTextures.push(blurTex);\r\n    }\r\n\r\n}","#include \"Camera.glsl\";\r\n// const \r\n#define TWO_PI 6.2831852\r\n\r\n#define EPSILON         1.0e-4\r\n#define FLT_EPSILON     1.192092896e-07 // Smallest positive number, such that 1.0 + FLT_EPSILON != 1.0\r\n\r\nconst float kContrast = 0.6;\r\nconst float kGeometryCoeff = 0.8;\r\nconst float kBeta = 0.002;\r\n\r\n\r\n// varying\r\nvarying vec2 v_Texcoord0;\r\n\r\n#if defined(AO_High)\r\n\t#define SAMPLE_COUNT 12\r\n#elif defined(AO_MEDIUM)\r\n\t#define SAMPLE_COUNT 8\r\n#else\r\n\t#define SAMPLE_COUNT 4\r\n#endif\r\n\r\n#ifdef AOLOWEST\r\n#define SAMPLE_COUNT 8\r\n#endif\r\n\r\n#ifdef AOLOWEST\r\n#define SAMPLE_COUNT 8\r\n#endif\r\n\r\n\r\n#define INTENSITY u_AOParams.x\r\n#define RADIUS u_AOParams.y\r\n#define DOWNSAMPLE u_AOParams.z\r\n\r\nfloat PositivePow(float base, float power)\r\n{\r\n    return pow(max(abs(base), float(FLT_EPSILON)), power);\r\n}\r\n\r\n\r\n// Boundary check for depth sampler\r\n// (returns a very large value if it lies out of bounds)\r\nfloat CheckBounds(vec2 uv, float d) \r\n{\r\n    float ob = 0.0;\r\n    // todo\r\n    if (uv.x < 0.0 || uv.x > 1.0 || uv.y < 0.0 || uv.y > 1.0) \r\n    {\r\n        ob = 1.0;\r\n    }\r\n    if (d <= 0.00001) {\r\n        ob += 1.0;\r\n    }\r\n\r\n    return ob * 1e8;\r\n}\r\n\r\nfloat SampleDepth(vec2 uv) \r\n{\r\n    float depthTex_Depth = SAMPLE_DEPTH_TEXTURE(u_CameraDepthTexture, uv);\r\n    float depthTex_Linear01Depth = Linear01Depth(depthTex_Depth, u_ZBufferParams);\r\n    return  depthTex_Linear01Depth * u_ProjectionParams.y + CheckBounds(uv, depthTex_Linear01Depth);\r\n}\r\n\r\nvec3 SampleNormal(vec2 uv) \r\n{\r\n    vec4 col = texture2D(u_CameraDepthNormalsTexture, uv);\r\n    vec3 depthNormal_Normal = DecodeViewNormalStereo(col);\r\n    return depthNormal_Normal * vec3(1.0, 1.0, -1.0);\r\n}\r\n\r\nfloat SampleDepthNormal(vec2 uv, out vec3 normal) \r\n{\r\n    normal = SampleNormal(uv);\r\n    return SampleDepth(uv);\r\n}\r\n\r\n// Normal vector comparer (for geometry-aware weighting)\r\nfloat CompareNormal(vec3 d1, vec3 d2)\r\n{\r\n    return smoothstep(kGeometryCoeff, 1.0, dot(d1, d2));\r\n}\r\n\r\n// Accessors for packed AO/normal buffer\r\nvec4 PackAONormal(float ao, vec3 n) \r\n{\r\n    return vec4(ao, n * 0.5 + 0.5);\r\n}\r\n\r\nvec3 GetPackedNormal(vec4 p)\r\n{\r\n    return p.gba * 2.0 - 1.0;\r\n}\r\n\r\nfloat GetPackAO(vec4 p)\r\n{\r\n    return p.r;\r\n}\r\n\r\n\r\n","#define SHADER_NAME AOBlurHorizontal\r\n//\r\n#define BLUR_HIGH_QUALITY 0\r\n\r\nvarying vec2 v_Texcoord0;\r\n\r\n// uniform vec2 u_Delty;\r\n\r\nvec3 GetPackedNormal(vec4 p)\r\n{\r\n    return p.gba * 2.0 - 1.0;\r\n}\r\n\r\nfloat CompareNormal(vec3 d1, vec3 d2)\r\n{\r\n    return smoothstep(0.8, 1.0, dot(d1, d2));\r\n}\r\n\r\nfloat GetPackedAO(vec4 p)\r\n{\r\n    return p.r;\r\n}\r\n\r\nvec4 PackAONormal(float ao, vec3 normal)\r\n{\r\n    return vec4(ao, normal * 0.5 + 0.5);\r\n}\r\n\r\nvoid main()\r\n{\r\n    vec2 delta = vec2(u_MainTex_TexelSize.x * 2.0 * u_Delty.x, u_Delty.y * u_MainTex_TexelSize.y * 2.0);\r\n    vec2 uv = v_Texcoord0;\r\n\r\n#if defined(BLUR_HIGH_QUALITY)\r\n\r\n    // High quality 7-tap Gaussian with adaptive sampling\r\n    vec2 uvtran = uv;\r\n    vec4 p0 = texture2D(u_MainTex, uv);\r\n    uvtran = uv - delta;\r\n    vec4 p1a = texture2D(u_MainTex, uvtran);\r\n    uvtran = uv + delta;\r\n    vec4 p1b = texture2D(u_MainTex, uvtran);\r\n    uvtran = uv - delta * 2.0;\r\n    vec4 p2a = texture2D(u_MainTex, uvtran);\r\n    uvtran = uv + delta * 2.0;\r\n    vec4 p2b = texture2D(u_MainTex, uvtran);\r\n    uvtran = uv - delta * 3.2307692308;\r\n    vec4 p3a = texture2D(u_MainTex, uvtran);\r\n    ;\r\n    uvtran = uv + delta * 3.2307692308;\r\n    vec4 p3b = texture2D(u_MainTex, uvtran);\r\n    ;\r\n\r\n    vec3 n0 = GetPackedNormal(p0);\r\n\r\n    float w0 = 0.37004405286;\r\n    float w1a = CompareNormal(n0, GetPackedNormal(p1a)) * 0.31718061674;\r\n    float w1b = CompareNormal(n0, GetPackedNormal(p1b)) * 0.31718061674;\r\n    float w2a = CompareNormal(n0, GetPackedNormal(p2a)) * 0.19823788546;\r\n    float w2b = CompareNormal(n0, GetPackedNormal(p2b)) * 0.19823788546;\r\n    float w3a = CompareNormal(n0, GetPackedNormal(p3a)) * 0.11453744493;\r\n    float w3b = CompareNormal(n0, GetPackedNormal(p3b)) * 0.11453744493;\r\n\r\n    float s;\r\n    s = GetPackedAO(p0) * w0;\r\n    s += GetPackedAO(p1a) * w1a;\r\n    s += GetPackedAO(p1b) * w1b;\r\n    s += GetPackedAO(p2a) * w2a;\r\n    s += GetPackedAO(p2b) * w2b;\r\n    s += GetPackedAO(p3a) * w3a;\r\n    s += GetPackedAO(p3b) * w3b;\r\n\r\n    s /= w0 + w1a + w1b + w2a + w2b + w3a + w3b;\r\n\r\n#else\r\n\r\n    // Fater 5-tap Gaussian with linear sampling\r\n    vec4 p0 = texture2D(u_MainTex, sampler_MainTex, i.texcoordStereo);\r\n    vec4 p1a = SAMPLE_TEXTURE2D(_MainTex, sampler_MainTex, UnityStereoTransformScreenSpaceTex(i.texcoord - delta * 1.3846153846));\r\n    vec4 p1b = SAMPLE_TEXTURE2D(_MainTex, sampler_MainTex, UnityStereoTransformScreenSpaceTex(i.texcoord + delta * 1.3846153846));\r\n    vec4 p2a = SAMPLE_TEXTURE2D(_MainTex, sampler_MainTex, UnityStereoTransformScreenSpaceTex(i.texcoord - delta * 3.2307692308));\r\n    vec4 p2b = SAMPLE_TEXTURE2D(_MainTex, sampler_MainTex, UnityStereoTransformScreenSpaceTex(i.texcoord + delta * 3.2307692308));\r\n\r\n    vec2 uvtran = uv;\r\n    vec4 p0 = texture2D(u_MainTex, uv);\r\n    uvtran = uv - delta * 1.3846153846;\r\n    vec4 p1a = texture2D(u_MainTex, uvtran);\r\n    uvtran = uv + delta * 1.3846153846;\r\n    vec4 p1b = texture2D(u_MainTex, uvtran);\r\n    uvtran = uv - delta * 3.2307692308;\r\n    vec4 p2a = texture2D(u_MainTex, uvtran);\r\n    uvtran = uv + delta * 3.2307692308;\r\n    vec4 p2b = texture2D(u_MainTex, uvtran);\r\n\r\n    vec3 n0 = GetPackedNormal(p0);\r\n\r\n    float w0 = 0.2270270270;\r\n    float w1a = CompareNormal(n0, GetPackedNormal(p1a)) * 0.3162162162;\r\n    float w1b = CompareNormal(n0, GetPackedNormal(p1b)) * 0.3162162162;\r\n    float w2a = CompareNormal(n0, GetPackedNormal(p2a)) * 0.0702702703;\r\n    float w2b = CompareNormal(n0, GetPackedNormal(p2b)) * 0.0702702703;\r\n\r\n    float s;\r\n    s = GetPackedAO(p0) * w0;\r\n    s += GetPackedAO(p1a) * w1a;\r\n    s += GetPackedAO(p1b) * w1b;\r\n    s += GetPackedAO(p2a) * w2a;\r\n    s += GetPackedAO(p2b) * w2b;\r\n\r\n    s /= w0 + w1a + w1b + w2a + w2b;\r\n\r\n#endif\r\n\r\n    gl_FragColor = PackAONormal(s, n0);\r\n}","#define SHADER_NAME AOComposition\r\n\r\n#include \"Color.glsl\";\r\n\r\n#define BLUR_HIGH_QUALITY 0\r\n\r\nvarying vec2 v_Texcoord0;\r\n\r\nvec3 GetPackedNormal(vec4 p)\r\n{\r\n    return p.gba * 2.0 - 1.0;\r\n}\r\nfloat CompareNormal(vec3 d1, vec3 d2)\r\n{\r\n    return smoothstep(0.8, 1.0, dot(d1, d2));\r\n}\r\nfloat GetPackedAO(vec4 p)\r\n{\r\n    return p.r;\r\n}\r\n\r\n// Geometry-aware bilateral filter (single pass/small kernel)\r\nfloat BlurSmall(sampler2D tex, vec2 uv, vec2 delta)\r\n{\r\n    vec4 p0 = texture2D(tex, uv);\r\n    vec2 uvtran = uv + vec2(-delta.x, -delta.y);\r\n    vec4 p1 = texture2D(tex, uvtran);\r\n    uvtran = uv + vec2(delta.x, -delta.y);\r\n    vec4 p2 = texture2D(tex, uvtran);\r\n    uvtran = uv + vec2(-delta.x, delta.y);\r\n    vec4 p3 = texture2D(tex, uvtran);\r\n    uvtran = uv + delta;\r\n    vec4 p4 = texture2D(tex, uvtran);\r\n\r\n    vec3 n0 = GetPackedNormal(p0);\r\n\r\n    float w0 = 1.0;\r\n    float w1 = CompareNormal(n0, GetPackedNormal(p1));\r\n    float w2 = CompareNormal(n0, GetPackedNormal(p2));\r\n    float w3 = CompareNormal(n0, GetPackedNormal(p3));\r\n    float w4 = CompareNormal(n0, GetPackedNormal(p4));\r\n\r\n    float s;\r\n    s = GetPackedAO(p0) * w0;\r\n    s += GetPackedAO(p1) * w1;\r\n    s += GetPackedAO(p2) * w2;\r\n    s += GetPackedAO(p3) * w3;\r\n    s += GetPackedAO(p4) * w4;\r\n\r\n    return s / (w0 + w1 + w2 + w3 + w4);\r\n}\r\n\r\nvoid main()\r\n{\r\n    vec2 uv = v_Texcoord0;\r\n    vec2 delty = u_MainTex_TexelSize.xy;\r\n    float ao = BlurSmall(u_compositionAoTexture, uv, delty);\r\n    vec4 albedo = texture2D(u_MainTex, uv);\r\n#ifdef Gamma_u_MainTex\r\n    albedo = gammaToLinear(albedo);\r\n#endif // Gamma_u_MainTex\r\n    vec4 aocolor = vec4(ao * u_AOColor.rgb, ao);\r\n    albedo.rgb = albedo.rgb * (1.0 - ao) + ao * u_AOColor.rgb * ao;\r\n    gl_FragColor = albedo;\r\n\r\n    gl_FragColor = outputTransform(gl_FragColor);\r\n}","#define SHADER_NAME SCREENVS\r\n\r\nvarying vec2 v_Texcoord0;\r\n\r\nvec4 remapPositionZ(vec4 position)\r\n{\r\n    position.z = position.z * 2.0 - position.w;\r\n    return position;\r\n}\r\n\r\nvoid main() {\t\r\n\tgl_Position = vec4(u_OffsetScale.x*2.0-1.0+(a_PositionTexcoord.x+1.0)*u_OffsetScale.z,(1.0-((u_OffsetScale.y*2.0-1.0+(-a_PositionTexcoord.y+1.0)*u_OffsetScale.w)+1.0)/2.0)*2.0-1.0, 0.0, 1.0);\t\r\n\tv_Texcoord0 = a_PositionTexcoord.zw;\r\n\tgl_Position = remapPositionZ(gl_Position);\r\n}\r\n","import FullScreenVert from \"../../../shader/files/postProcess/GaussianDoF/FullScreenVert.vs\";\r\nimport CoCFS from \"../../../shader/files/postProcess/GaussianDoF/CoC.fs\";\r\nimport PrefilterFS from \"../../../shader/files/postProcess/GaussianDoF/Prefilter.fs\";\r\nimport BlurVFS from \"../../../shader/files/postProcess/GaussianDoF/BlurV.fs\";\r\nimport BlurHFS from \"../../../shader/files/postProcess/GaussianDoF/BlurH.fs\";\r\nimport CompositeFS from \"../../../shader/files/postProcess/GaussianDoF/Composite.fs\";\r\nimport { Camera } from \"../../../core/Camera\";\r\nimport { CommandBuffer } from \"../../../core/render/command/CommandBuffer\";\r\nimport { PostProcessEffect } from \"../../../core/render/PostProcessEffect\";\r\nimport { PostProcessRenderContext } from \"../../../core/render/PostProcessRenderContext\";\r\nimport { FilterMode } from \"../../../../RenderEngine/RenderEnum/FilterMode\";\r\nimport { RenderTargetFormat } from \"../../../../RenderEngine/RenderEnum/RenderTargetFormat\";\r\nimport { Shader3D, ShaderFeatureType } from \"../../../../RenderEngine/RenderShader/Shader3D\";\r\nimport { ShaderData, ShaderDataType } from \"../../../../RenderEngine/RenderShader/ShaderData\";\r\nimport { ShaderDefine } from \"../../../../RenderEngine/RenderShader/ShaderDefine\";\r\nimport { DepthTextureMode } from \"../../../depthMap/DepthPass\";\r\nimport { Vector3 } from \"../../../../maths/Vector3\";\r\nimport { Vector4 } from \"../../../../maths/Vector4\";\r\nimport { RenderTexture } from \"../../../../resource/RenderTexture\";\r\nimport { SubShader } from \"../../../../RenderEngine/RenderShader/SubShader\";\r\nimport { VertexMesh } from \"../../../../RenderEngine/RenderShader/VertexMesh\";\r\nimport { LayaGL } from \"../../../../layagl/LayaGL\";\r\n\r\n/**\r\n *  <code>BloomEffect</code> \r\n *  Gaussian DoF\r\n *  *  \r\n *  - start: \r\n *  - end: \r\n *  - maxRadius: \r\n */\r\nexport class GaussianDoF extends PostProcessEffect {\r\n    /**@internal */\r\n    static SOURCESIZE: number;\r\n\r\n    /**@internal */\r\n    static ZBUFFERPARAMS: number;\r\n\r\n    /**@internal */\r\n    static COCPARAMS: number;\r\n\r\n    /**@internal */\r\n    static DEPTHTEXTURE: number;\r\n\r\n    /**@internal */\r\n    static NORMALDEPTHTEXTURE: number;\r\n\r\n    /**@internal */\r\n    static FULLCOCTEXTURE: number;\r\n\r\n    /**@internal */\r\n    static DOWNSAMPLESCALE: number;\r\n\r\n    /**@internal */\r\n    static BLURCOCTEXTURE: number;\r\n\r\n    /**@internal */\r\n    static SHADERDEFINE_DEPTHNORMALTEXTURE: ShaderDefine;\r\n\r\n    /**\r\n     * GaussianDOF resource init\r\n     */\r\n    static init() {\r\n        GaussianDoF.SOURCESIZE = Shader3D.propertyNameToID(\"u_SourceSize\");\r\n        GaussianDoF.ZBUFFERPARAMS = Shader3D.propertyNameToID(\"u_ZBufferParams\");\r\n        GaussianDoF.COCPARAMS = Shader3D.propertyNameToID(\"u_CoCParams\");\r\n        GaussianDoF.DEPTHTEXTURE = Shader3D.propertyNameToID(\"u_CameraDepthTexture\");\r\n        GaussianDoF.NORMALDEPTHTEXTURE = Shader3D.propertyNameToID(\"u_CameraDepthNormalTexture\");\r\n        GaussianDoF.FULLCOCTEXTURE = Shader3D.propertyNameToID(\"u_FullCoCTex\");\r\n        GaussianDoF.DOWNSAMPLESCALE = Shader3D.propertyNameToID(\"u_DownSampleScale\");\r\n        GaussianDoF.BLURCOCTEXTURE = Shader3D.propertyNameToID(\"u_BlurCoCTex\");\r\n        GaussianDoF.SHADERDEFINE_DEPTHNORMALTEXTURE = Shader3D.getDefineByName(\"CAMERA_NORMALDEPTH\");\r\n\r\n        let attributeMap: any = {\r\n            'a_PositionTexcoord': [VertexMesh.MESH_POSITION0, ShaderDataType.Vector4],\r\n        };\r\n\r\n        let uniformMap: any = {\r\n            \"u_MainTex\": ShaderDataType.Texture2D,\r\n            \"u_MainTex_TexelSize\": ShaderDataType.Vector4,\r\n            \"u_OffsetScale\": ShaderDataType.Vector4,\r\n            \"u_ZBufferParams\": ShaderDataType.Vector4,\r\n            \"u_CoCParams\": ShaderDataType.Vector3,\r\n            \"u_FullCoCTex\": ShaderDataType.Texture2D,\r\n            \"u_SourceSize\": ShaderDataType.Vector4,\r\n            \"u_DownSampleScale\": ShaderDataType.Vector4,\r\n            \"u_BlurCoCTex\": ShaderDataType.Texture2D,\r\n        };\r\n        let shader: Shader3D = Shader3D.add(\"GaussianDoF\");\r\n        shader.shaderType = ShaderFeatureType.PostProcess;\r\n        /**\r\n         * CoC pass\r\n         *  FarStart  FarEnd  0 - 1\r\n         * \r\n         * Camera nearPlane---------FarStart---------FarEnd---------Camera farplane\r\n         *       0         ---------   0    ---------   1  ---------      1\r\n         */\r\n        let cocSubShader: SubShader = new SubShader(attributeMap, uniformMap);\r\n        shader.addSubShader(cocSubShader);\r\n        cocSubShader.addShaderPass(FullScreenVert, CoCFS);\r\n\r\n        /**\r\n         * Prefilter pass\r\n         * \r\n         */\r\n        let prefilterSubShader: SubShader = new SubShader(attributeMap, uniformMap);\r\n        shader.addSubShader(prefilterSubShader);\r\n        prefilterSubShader.addShaderPass(FullScreenVert, PrefilterFS);\r\n\r\n        // blur\r\n        /**\r\n         * blurH pass\r\n         */\r\n        let blurHSubShader: SubShader = new SubShader(attributeMap, uniformMap);\r\n        shader.addSubShader(blurHSubShader);\r\n        blurHSubShader.addShaderPass(FullScreenVert, BlurHFS);\r\n\r\n        /**\r\n         * blurV pass\r\n         */\r\n        let blurVSubShader: SubShader = new SubShader(attributeMap, uniformMap);\r\n        shader.addSubShader(blurVSubShader);\r\n        blurVSubShader.addShaderPass(FullScreenVert, BlurVFS);\r\n\r\n        /**\r\n         * Composite pass\r\n         */\r\n        let compositeSubShader: SubShader = new SubShader(attributeMap, uniformMap);\r\n        shader.addSubShader(compositeSubShader);\r\n        compositeSubShader.addShaderPass(FullScreenVert, CompositeFS);\r\n\r\n    }\r\n\r\n    /**@internal */\r\n    private _shader: Shader3D;\r\n\r\n    /**@internal */\r\n    private _shaderData: ShaderData;\r\n\r\n    /**@internal */\r\n    private _zBufferParams: Vector4;\r\n\r\n    /**@internal */\r\n    private _sourceSize: Vector4;\r\n\r\n    /**@internal */\r\n    private _dowmSampleScale: Vector4;\r\n\r\n    /**\r\n     * DOF\r\n     */\r\n    constructor() {\r\n        super();\r\n        this._shader = Shader3D.find(\"GaussianDoF\");\r\n        this._shaderData = LayaGL.renderOBJCreate.createShaderData(null);\r\n        this._shaderData.setVector3(GaussianDoF.COCPARAMS, new Vector3(10, 30, 1));\r\n        this._zBufferParams = new Vector4();\r\n        this._sourceSize = new Vector4();\r\n        this._dowmSampleScale = new Vector4();\r\n    }\r\n\r\n    /**\r\n     * \r\n     */\r\n    set farStart(value: number) {\r\n        let cocParams: Vector3 = this._shaderData.getVector3(GaussianDoF.COCPARAMS);\r\n        cocParams.x = value;\r\n        this._shaderData.setVector3(GaussianDoF.COCPARAMS, cocParams);\r\n    }\r\n\r\n    get farStart(): number {\r\n        return this._shaderData.getVector3(GaussianDoF.COCPARAMS).x;\r\n    }\r\n\r\n    /**\r\n     * \r\n     */\r\n    set farEnd(value: number) {\r\n        let cocParams: Vector3 = this._shaderData.getVector3(GaussianDoF.COCPARAMS);\r\n        cocParams.y = Math.max(cocParams.x, value);\r\n        this._shaderData.setVector3(GaussianDoF.COCPARAMS, cocParams);\r\n    }\r\n\r\n    get farEnd(): number {\r\n        return this._shaderData.getVector3(GaussianDoF.COCPARAMS).y;\r\n    }\r\n\r\n    /**\r\n     * \r\n     */\r\n    set maxRadius(value: number) {\r\n        let cocParams: Vector3 = this._shaderData.getVector3(GaussianDoF.COCPARAMS);\r\n        cocParams.z = Math.min(value, 2);\r\n        this._shaderData.setVector3(GaussianDoF.COCPARAMS, cocParams);\r\n    }\r\n\r\n    get maxRadius(): number {\r\n        return this._shaderData.getVector3(GaussianDoF.COCPARAMS).z;\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     * @param context \r\n     */\r\n    private _setupShaderValue(context: PostProcessRenderContext): void {\r\n        let camera: Camera = context.camera;\r\n        this._dowmSampleScale.setValue(0.5, 0.5, 2.0, 2.0);\r\n        this._shaderData.setVector(GaussianDoF.DOWNSAMPLESCALE, this._dowmSampleScale);\r\n        let far = camera.farPlane;\r\n        let near = camera.nearPlane;\r\n        this._zBufferParams.setValue(1.0 - far / near, far / near, (near - far) / (near * far), 1 / near);\r\n        this._shaderData.setVector(GaussianDoF.ZBUFFERPARAMS, this._zBufferParams);\r\n    }\r\n\r\n\r\n    /**\r\n     * @internal\r\n     * @override\r\n     */\r\n    getCameraDepthTextureModeFlag() {\r\n        return DepthTextureMode.Depth;\r\n    }\r\n\r\n    /**\r\n    * @override\r\n    * @param context \r\n    */\r\n    render(context: PostProcessRenderContext): void {\r\n        let cmd: CommandBuffer = context.command;\r\n        this._setupShaderValue(context);\r\n\r\n        let source: RenderTexture = context.source;\r\n\r\n        let shader: Shader3D = this._shader;\r\n        let shaderData: ShaderData = this._shaderData;\r\n\r\n        let dataTexFormat: RenderTargetFormat = RenderTargetFormat.R16G16B16A16;\r\n        // todo fullCoC format: R16\r\n        let fullCoC: RenderTexture = RenderTexture.createFromPool(source.width, source.height, dataTexFormat, RenderTargetFormat.None, false, 1);\r\n        // coc pass\r\n        cmd.blitScreenTriangle(source, fullCoC, null, shader, shaderData, 0);\r\n        // Prefilter pass\r\n        fullCoC.filterMode = FilterMode.Bilinear;\r\n        this._shaderData.setTexture(GaussianDoF.FULLCOCTEXTURE, fullCoC);\r\n        let prefilterTex: RenderTexture = RenderTexture.createFromPool(source.width / 2, source.height / 2, dataTexFormat, RenderTargetFormat.None, false, 1);\r\n        cmd.blitScreenTriangle(source, prefilterTex, null, shader, shaderData, 1);\r\n        // blur\r\n        prefilterTex.filterMode = FilterMode.Bilinear;\r\n        this._sourceSize.setValue(prefilterTex.width, prefilterTex.height, 1.0 / prefilterTex.width, 1.0 / prefilterTex.height);\r\n        this._shaderData.setShaderData(GaussianDoF.SOURCESIZE, ShaderDataType.Vector4, this._sourceSize);\r\n        // blur H\r\n        let blurHTex: RenderTexture = RenderTexture.createFromPool(prefilterTex.width, prefilterTex.height, dataTexFormat, RenderTargetFormat.None, false, 1);\r\n        cmd.blitScreenTriangle(prefilterTex, blurHTex, null, this._shader, this._shaderData, 2);\r\n        // blur V\r\n        let blurVTex: RenderTexture = RenderTexture.createFromPool(prefilterTex.width, prefilterTex.height, dataTexFormat, RenderTargetFormat.None, false, 1);\r\n        cmd.blitScreenTriangle(blurHTex, blurVTex, null, this._shader, this._shaderData, 3);\r\n        // composite\r\n        blurVTex.filterMode = FilterMode.Bilinear;\r\n        blurVTex.anisoLevel = 1;\r\n        fullCoC.filterMode = FilterMode.Point;\r\n        this._shaderData.setTexture(GaussianDoF.BLURCOCTEXTURE, blurVTex);\r\n        let finalTex: RenderTexture = RenderTexture.createFromPool(source.width, source.height, source.colorFormat, source.depthStencilFormat, false, 1);\r\n        cmd.blitScreenTriangle(source, context.destination, null, this._shader, this._shaderData, 4);\r\n        //context.source = finalTex;\r\n        // recover render texture\r\n        RenderTexture.recoverToPool(fullCoC);\r\n        RenderTexture.recoverToPool(prefilterTex);\r\n        RenderTexture.recoverToPool(blurHTex);\r\n        RenderTexture.recoverToPool(blurVTex);\r\n        context.deferredReleaseTextures.push(finalTex);\r\n    }\r\n}\r\n","#define SHADER_NAME COCFS\r\n\r\n#ifdef CAMERA_NORMALDEPTH\r\nuniform sampler2D u_CameraDepthNormalTexture;\r\n#else\r\nuniform sampler2D u_CameraDepthTexture;\r\n#endif\r\n\r\nvarying vec2 v_Texcoord0;\r\n\r\n// Z buffer to linear 0..1 depth\r\nfloat Linear01Depth(float z, vec4 zbufferParams)\r\n{\r\n    return 1.0 / (zbufferParams.x * z + zbufferParams.y);\r\n}\r\n\r\n// Z buffer to linear depth\r\nfloat LinearEyeDepth(float z, vec4 zbufferParams)\r\n{\r\n    return 1.0 / (zbufferParams.z * z + zbufferParams.w);\r\n}\r\n\r\nfloat DecodeFloatRG(vec2 enc)\r\n{\r\n    vec2 kDecodeDot = vec2(1.0, 1.0 / 255.0);\r\n    return dot(enc, kDecodeDot);\r\n}\r\n\r\nvoid DecodeDepthNormal(vec4 enc, out float depth)\r\n{\r\n    depth = DecodeFloatRG(enc.zw);\r\n}\r\n\r\nvoid main()\r\n{\r\n\r\n#ifdef CAMERA_NORMALDEPTH\r\n    vec4 depthNormal = texture2D(u_CameraDepthNormalTexture, v_Texcoord0);\r\n    float depth = 0.0;\r\n    DecodeDepthNormal(depthNormal, depth);\r\n    depth = ((1.0 / depth) - u_ZBufferParams.y) * (1.0 / u_ZBufferParams.x);\r\n#else\r\n    float depth = texture2D(u_CameraDepthTexture, v_Texcoord0).x;\r\n#endif\r\n\r\n    depth = LinearEyeDepth(depth, u_ZBufferParams);\r\n    float farStart = u_CoCParams.x;\r\n    float farEnd = u_CoCParams.y;\r\n\r\n    float coc = (depth - farStart) / (farEnd - farStart);\r\n    coc = clamp(coc, 0.0, 1.0);\r\n    gl_FragColor = vec4(coc, coc, coc, 1.0);\r\n}\r\n","#define SHADER_NAME PrefilterFS\r\n\r\n#include \"Color.glsl\";\r\n\r\nvarying vec2 v_Texcoord0;\r\n\r\nconst int kCount = 5;\r\nvec2 kTaps[5];\r\n\r\nvoid main()\r\n{\r\n\r\n    kTaps[0] = vec2(0.0, 0.0);\r\n    kTaps[1] = vec2(0.9, -0.4);\r\n    kTaps[2] = vec2(-0.9, 0.4);\r\n    kTaps[3] = vec2(0.4, 0.9);\r\n    kTaps[4] = vec2(-0.4, -0.9);\r\n\r\n    vec3 colorAcc = vec3(0.0);\r\n    float farCoCAcc = 0.0;\r\n    for (int i = 0; i < kCount; i++)\r\n\t{\r\n\t    vec2 uv = u_MainTex_TexelSize.xy * kTaps[i] + v_Texcoord0;\r\n\t    vec3 tapColor = texture2D(u_MainTex, uv).rgb;\r\n#ifdef Gamma_u_MainTex\r\n\t    tapColor = gammaToLinear(tapColor);\r\n#endif // Gamma_u_MainTex\r\n\r\n\t    float coc = texture2D(u_FullCoCTex, uv).r;\r\n\r\n\t    colorAcc += tapColor * coc;\r\n\t    farCoCAcc += coc;\r\n\t}\r\n    vec3 color = colorAcc * (1.0 / float(kCount));\r\n    float farCoC = farCoCAcc * (1.0 / float(kCount));\r\n\r\n    // float farCoC = texture2D(u_FullCoCTex, v_Texcoord0).x;\r\n    // vec3 color = texture2D(u_MainTex, v_Texcoord0).rgb;\r\n    // color *= farCoC;\r\n\r\n    gl_FragColor = vec4(color, farCoC);\r\n\r\n    gl_FragColor = outputTransform(gl_FragColor);\r\n}","#define SHADER_NAME BlurHFS\r\n\r\n#include \"Color.glsl\";\r\n\r\nvarying vec2 v_Texcoord0;\r\n\r\nconst int kTapCount = 3;\r\nfloat kOffsets[3];\r\nfloat kCoeffs[3];\r\n\r\nvec4 Blur(vec2 dir, float premultiply)\r\n{\r\n\r\n    kOffsets[0] = -1.33333333;\r\n    kOffsets[1] = 0.00000000;\r\n    kOffsets[2] = 1.33333333;\r\n\r\n    kCoeffs[0] = 0.35294118;\r\n    kCoeffs[1] = 0.29411765;\r\n    kCoeffs[2] = 0.3529411;\r\n\r\n    vec2 uv = v_Texcoord0;\r\n    // ivec2 positionSS = ivec2(u_SourceSize.xy * uv);\r\n\r\n    vec4 halfColor = texture2D(u_MainTex, uv);\r\n#ifdef Gamma_u_MainTex\r\n    halfColor = gammaToLinear(halfColor);\r\n#endif // Gamma_u_MainTex\r\n    float samp0CoC = halfColor.a;\r\n\r\n    float maxRadius = u_CoCParams.z;\r\n    vec2 offset = u_SourceSize.zw * dir * samp0CoC * maxRadius;\r\n\r\n    vec4 acc = vec4(0.0);\r\n\r\n    for (int i = 0; i < kTapCount; i++)\r\n\t{\r\n\t    vec2 sampCoord = uv + kOffsets[i] * offset;\r\n\t    vec4 samp = texture2D(u_MainTex, sampCoord);\r\n#ifdef Gamma_u_MainTex\r\n\t    samp = gammaToLinear(samp);\r\n#endif // Gamma_u_MainTex\r\n\t    float sampCoC = samp.a;\r\n\t    vec3 sampColor = samp.rgb;\r\n\r\n\t    float weight = clamp(1.0 - (samp0CoC - sampCoC), 0.0, 1.0);\r\n\t    acc += vec4(sampColor, sampCoC) * kCoeffs[i] * weight;\r\n\t}\r\n\r\n    acc.xyz /= acc.w + 1e-4;\r\n    return vec4(acc.xyz, samp0CoC);\r\n}\r\n\r\nvoid main()\r\n{\r\n    gl_FragColor = Blur(vec2(1.0, 0.0), 1.0);\r\n\r\n    gl_FragColor = outputTransform(gl_FragColor);\r\n}","#define SHADER_NAME BlurVFS\r\n\r\n#include \"Color.glsl\";\r\n\r\nvarying vec2 v_Texcoord0;\r\n\r\n// todo 3 & 5\r\nconst int kTapCount = 3;\r\nfloat kOffsets[3];\r\nfloat kCoeffs[3];\r\n\r\nvec4 Blur(vec2 dir, float premultiply)\r\n{\r\n\r\n    kOffsets[0] = -1.33333333;\r\n    kOffsets[1] = 0.00000000;\r\n    kOffsets[2] = 1.33333333;\r\n\r\n    kCoeffs[0] = 0.35294118;\r\n    kCoeffs[1] = 0.29411765;\r\n    kCoeffs[2] = 0.3529411;\r\n\r\n    vec2 uv = v_Texcoord0;\r\n    // ivec2 positionSS = ivec2(u_SourceSize.xy * uv);\r\n\r\n    vec4 halfColor = texture2D(u_MainTex, uv);\r\n#ifdef Gamma_u_MainTex\r\n    halfColor = gammaToLinear(halfColor);\r\n#endif // Gamma_u_MainTex\r\n    float samp0CoC = halfColor.a;\r\n\r\n    float maxRadius = u_CoCParams.z;\r\n    vec2 offset = u_SourceSize.zw * dir * samp0CoC * maxRadius;\r\n\r\n    vec4 acc = vec4(0.0);\r\n\r\n    for (int i = 0; i < kTapCount; i++)\r\n\t{\r\n\t    vec2 sampCoord = uv + kOffsets[i] * offset;\r\n\t    vec4 samp = texture2D(u_MainTex, sampCoord);\r\n#ifdef Gamma_u_MainTex\r\n\t    samp = gammaToLinear(samp);\r\n#endif // Gamma_u_MainTex\r\n\t    float sampCoC = samp.w;\r\n\t    vec3 sampColor = samp.xyz;\r\n\r\n\t    float weight = clamp(1.0 - (samp0CoC - sampCoC), 0.0, 1.0);\r\n\t    acc += vec4(sampColor, 1.0) * kCoeffs[i] * weight;\r\n\t}\r\n\r\n    acc.xyz /= acc.w + 1e-4;\r\n    return vec4(acc.xyz, 1.0);\r\n}\r\n\r\nvoid main()\r\n{\r\n    gl_FragColor = Blur(vec2(0.0, 1.0), 0.0);\r\n\r\n    gl_FragColor = outputTransform(gl_FragColor);\r\n}\r\n","#define SHADER_NAME CompositeFS\r\n\r\n#include \"Color.glsl\";\r\n\r\nvarying vec2 v_Texcoord0;\r\n\r\nvoid main()\r\n{\r\n\r\n    vec3 baseColor = texture2D(u_MainTex, v_Texcoord0).rgb;\r\n#ifdef Gamma_u_MainTex\r\n    baseColor = gammaToLinear(baseColor);\r\n#endif // Gamma_u_MainTex\r\n\r\n    vec4 samplevalue = texture2D(u_BlurCoCTex, v_Texcoord0);\r\n    vec3 farColor = samplevalue.rgb;\r\n    float coc = texture2D(u_FullCoCTex, v_Texcoord0).r;\r\n\r\n    vec3 dstColor = vec3(0.0);\r\n    float dstAlpha = 1.0;\r\n\r\n    float blend = sqrt(coc * 3.14 * 2.0);\r\n    dstColor = farColor * clamp(blend, 0.0, 1.0);\r\n    dstAlpha = clamp(1.0 - blend, 0.0, 1.0);\r\n\r\n    gl_FragColor = vec4(baseColor * dstAlpha + dstColor, 1.0);\r\n\r\n    gl_FragColor = outputTransform(gl_FragColor);\r\n}","import { BufferUsage } from \"../../../../../RenderEngine/RenderEnum/BufferTargetType\";\r\nimport { DrawType } from \"../../../../../RenderEngine/RenderEnum/DrawType\";\r\nimport { IndexFormat } from \"../../../../../RenderEngine/RenderEnum/IndexFormat\";\r\nimport { MeshTopology } from \"../../../../../RenderEngine/RenderEnum/RenderPologyMode\";\r\nimport { VertexDeclaration } from \"../../../../../RenderEngine/VertexDeclaration\";\r\nimport { VertexElement } from \"../../../../../renders/VertexElement\";\r\nimport { VertexElementFormat } from \"../../../../../renders/VertexElementFormat\";\r\nimport { BufferState } from \"../../../../../webgl/utils/BufferState\";\r\nimport { Laya3DRender } from \"../../../../RenderObjs/Laya3DRender\";\r\nimport { IndexBuffer3D } from \"../../../../graphics/IndexBuffer3D\";\r\nimport { VertexBuffer3D } from \"../../../../graphics/VertexBuffer3D\";\r\nimport { GeometryElement } from \"../../../GeometryElement\";\r\nimport { RenderContext3D } from \"../../RenderContext3D\";\r\n\r\nexport class LensFlareElementGeomtry extends GeometryElement {\r\n    static PositionUV: number = 0;\r\n    static PositionRotationScale: number = 1;\r\n    /**@internal */\r\n    static lensQuadVertices: Float32Array;\r\n    /**@internal */\r\n    static lensQuadIndex: Uint16Array;\r\n    /**@internal */\r\n    static vertexDeclaration: VertexDeclaration;\r\n    /**@internal */\r\n    static instanceVertexDeclaration: VertexDeclaration;\r\n    /**@internal instanceData*/\r\n    static lensFlareElementMax: number = 20;\r\n    /**@internal */\r\n    private _vertexBuffer: VertexBuffer3D;\r\n    /**@internal */\r\n    private _instanceVertexBuffer: VertexBuffer3D;\r\n    /**@internal */\r\n    private _indexBuffer: IndexBuffer3D;\r\n    /**@internal */\r\n    private static _type: number = GeometryElement._typeCounter++;\r\n\r\n    /**\r\n     * initData\r\n     */\r\n    static init() {\r\n        let quadSize = 0.1;\r\n        LensFlareElementGeomtry.lensQuadVertices = new Float32Array([\r\n            quadSize, quadSize, 1, 1,\r\n            -quadSize, quadSize, 0, 1,\r\n            -quadSize, -quadSize, 0, 0,\r\n            quadSize, -quadSize, 1, 0]);\r\n        LensFlareElementGeomtry.lensQuadIndex = new Uint16Array([0, 2, 1, 0, 3, 2]);\r\n        //xy:position zw:uv\r\n        LensFlareElementGeomtry.vertexDeclaration = new VertexDeclaration(16, [new VertexElement(0, VertexElementFormat.Vector4, 0)]);\r\n        //x:startPosition  y:angular zw:scale\r\n        LensFlareElementGeomtry.instanceVertexDeclaration = new VertexDeclaration(16, [new VertexElement(0, VertexElementFormat.Vector4, 1)])\r\n    }\r\n\r\n    /**\r\n     * instance LensFlaresGeometry\r\n     */\r\n    constructor() {\r\n        super(MeshTopology.Triangles, DrawType.DrawElementInstance);\r\n        this.indexFormat = IndexFormat.UInt16;\r\n        this._createBuffer();\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    private _createBuffer() {\r\n        //VB\r\n        this._vertexBuffer = Laya3DRender.renderOBJCreate.createVertexBuffer3D(LensFlareElementGeomtry.lensQuadVertices.length * 4, BufferUsage.Dynamic, false);\r\n        this._vertexBuffer.vertexDeclaration = LensFlareElementGeomtry.vertexDeclaration;\r\n        this._vertexBuffer.setData(LensFlareElementGeomtry.lensQuadVertices.buffer);\r\n        //instanceVB\r\n        this._instanceVertexBuffer = Laya3DRender.renderOBJCreate.createVertexBuffer3D(LensFlareElementGeomtry.lensFlareElementMax * 4 * 4, BufferUsage.Dynamic, false);\r\n        this._instanceVertexBuffer.instanceBuffer = true;\r\n        this._instanceVertexBuffer.vertexDeclaration = LensFlareElementGeomtry.instanceVertexDeclaration;\r\n        //IB\r\n        this._indexBuffer = Laya3DRender.renderOBJCreate.createIndexBuffer3D(IndexFormat.UInt16, LensFlareElementGeomtry.lensQuadIndex.length, BufferUsage.Static, false);\r\n        this._indexBuffer.setData(LensFlareElementGeomtry.lensQuadIndex);\r\n        //VAO\r\n        this.bufferState = new BufferState();\r\n        this.bufferState.applyState([this._vertexBuffer, this._instanceVertexBuffer], this._indexBuffer);\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    get instanceBuffer() {\r\n        return this._instanceVertexBuffer;\r\n    }\r\n\r\n    /**\r\n     *\t{@inheritDoc PixelLineFilter._getType}\r\n     *\t@override\r\n     *  @internal\r\n     */\r\n    _getType(): number {\r\n        return LensFlareElementGeomtry._type;\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     * @return  \r\n     */\r\n    _prepareRender(state: RenderContext3D): boolean {\r\n        return true;\r\n    }\r\n\r\n    /**\r\n     * \r\n     */\r\n    destroy(): void {\r\n        super.destroy();\r\n        this._vertexBuffer.destroy();\r\n        this._instanceVertexBuffer.destroy();\r\n        this.bufferState.destroy();\r\n        this._indexBuffer.destroy();\r\n    }\r\n\r\n    /**\r\n    * @internal\r\n    * UpdateGeometry Data\r\n    */\r\n    _updateRenderParams(state: RenderContext3D): void {\r\n        this.clearRenderParams();\r\n        this.setDrawElemenParams(LensFlareElementGeomtry.lensQuadIndex.length, 0);\r\n    }\r\n}\r\n","import { RenderState } from \"../../../../../RenderEngine/RenderShader/RenderState\";\r\nimport { Vector2 } from \"../../../../../maths/Vector2\";\r\nimport { Stat } from \"../../../../../utils/Stat\";\r\nimport { Utils } from \"../../../../../utils/Utils\";\r\nimport { Laya3DRender } from \"../../../../RenderObjs/Laya3DRender\";\r\nimport { Camera } from \"../../../Camera\";\r\nimport { Transform3D } from \"../../../Transform3D\";\r\nimport { Material, MaterialRenderMode } from \"../../../../../resource/Material\";\r\nimport { RenderContext3D } from \"../../RenderContext3D\";\r\nimport { RenderElement } from \"../../RenderElement\";\r\nimport { Command } from \"../../command/Command\";\r\nimport { LensFlareElement, LensFlareEffect } from \"./LensFlareEffect\";\r\nimport { LensFlareElementGeomtry } from \"./LensFlareGeometry\";\r\n\r\nexport class LensFlareCMD extends Command {\r\n\r\n    /**@internal geoemtry */\r\n    private _lensFlareGeometry: LensFlareElementGeomtry;\r\n\r\n    /**@internal renderElement*/\r\n    private _renderElement: RenderElement;\r\n\r\n    /**@internal */\r\n    private _materials: Material;\r\n\r\n    /**@internal */\r\n    private _transform3D: Transform3D;\r\n\r\n    /**@internal */\r\n    private _lensFlareElementData: LensFlareElement;\r\n\r\n    /**instance */\r\n    private _instanceCount: number = 1;\r\n\r\n    public get instanceCount(): number {\r\n        return this._instanceCount;\r\n    }\r\n    public set instanceCount(value: number) {\r\n        this._instanceCount = value;\r\n    }\r\n\r\n\r\n\r\n    /**\r\n     * instance CMD\r\n     */\r\n    constructor() {\r\n        super();\r\n        this._transform3D = Laya3DRender.renderOBJCreate.createTransform(null);\r\n        this._renderElement = new RenderElement();\r\n        this._lensFlareGeometry = new LensFlareElementGeomtry();\r\n        this._renderElement.setTransform(this._transform3D);\r\n        this._renderElement.setGeometry(this._lensFlareGeometry);\r\n        this._initMaterial();\r\n    }\r\n\r\n    /**\r\n     * init material\r\n     */\r\n    private _initMaterial() {\r\n        this._materials = new Material();\r\n        this._materials.setShaderName(\"LensFlare\");\r\n        this._materials.materialRenderMode = MaterialRenderMode.RENDERMODE_ADDTIVE;\r\n        this._materials.depthTest = RenderState.DEPTHTEST_ALWAYS;\r\n        this._materials.cull = RenderState.CULL_NONE;\r\n        this._renderElement.material = this._materials;\r\n        this._renderElement.renderSubShader = this._materials.shader.getSubShaderAt(0);\r\n        this._renderElement.subShaderIndex = 0;\r\n\r\n    }\r\n\r\n    /**@internal */\r\n    set center(value: Vector2) {\r\n        this._materials.setVector2(\"u_FlareCenter\", value);\r\n    }\r\n\r\n    /**@internal */\r\n    set rotate(value: number) {\r\n        this._materials.setFloat(\"u_rotate\", value);\r\n    }\r\n\r\n    /**@internal */\r\n    set lensFlareElement(value: LensFlareElement) {\r\n        this._lensFlareElementData = value;\r\n        this.applyElementData();\r\n    }\r\n\r\n    get lensFlareElement(): LensFlareElement {\r\n        return this._lensFlareElementData;\r\n    }\r\n\r\n    /**\r\n     * apply element Data\r\n     */\r\n    applyElementData() {\r\n        //LensFlareElement\r\n        this._materials.setTexture(\"u_FlareTexture\", this._lensFlareElementData.texture);\r\n        this._materials.setColor(\"u_Tint\", this._lensFlareElementData.tint);\r\n        this._materials.setFloat(\"u_TintIntensity\", this._lensFlareElementData.intensity);\r\n        this._materials.setVector2(\"u_Postionoffset\", this._lensFlareElementData.positionOffset);\r\n        this._materials.setFloat(\"u_Angularoffset\", this._lensFlareElementData.angularOffset);\r\n        if (this._lensFlareElementData.autoRotate) {\r\n            this._materials.addDefine(LensFlareEffect.SHADERDEFINE_AUTOROTATE);\r\n        } else {\r\n            this._materials.removeDefine(LensFlareEffect.SHADERDEFINE_AUTOROTATE);\r\n        }\r\n        //TODO\r\n\r\n        //InstanceBuffer\r\n        this._lensFlareGeometry.instanceCount = 1;//TODO\r\n        // startPosangularscaleXscaleY\r\n        let testFloat = new Float32Array([this._lensFlareElementData.startPosition, Utils.toAngle(this._lensFlareElementData.rotation), this._lensFlareElementData.scale.x, this._lensFlareElementData.scale.y]);//TODO        \r\n        // instanceBuffer set\r\n        this._lensFlareGeometry.instanceBuffer.setData(testFloat.buffer, 0, 0, testFloat.length * 4);//TODO\r\n    }\r\n\r\n    /**\r\n     * @inheritDoc\r\n     * @override\r\n     */\r\n    run(): void {\r\n        var context = RenderContext3D._instance;\r\n        this._materials.setFloat(\"u_aspectRatio\", context.camera.viewport.height / context.camera.viewport.width);\r\n        context.applyContext(Camera._updateMark);\r\n        context.drawRenderElement(this._renderElement);\r\n        Stat.blitDrawCall++;\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    recover(): void {\r\n        //TODO\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    destroy(): void {\r\n        //TODO\r\n    }\r\n}","#define SHADER_NAME LENSFLARESVS\r\n//attribute vec4 a_PositionTexcoord;\r\n// x: startPosition y: rotation zw: scale\r\n// attribute vec4 a_DistanceRotationScale;\r\n\r\nvarying vec2 v_Texcoord0;\r\n\r\nvec2 rotateVector(vec2 pos, vec2 center, float angle) {\r\n    float cosAngle = cos(angle);\r\n    float sinAngle = sin(angle);\r\n    vec2 offset = pos - center;\r\n    vec2 rotatedOffset = vec2(\r\n        offset.x * cosAngle - offset.y * sinAngle,\r\n        offset.x * sinAngle + offset.y * cosAngle\r\n    );\r\n    return center + rotatedOffset;\r\n}\r\n\r\nvec2 rotateVec2(float rad,vec2 pos){\r\n    float s = sin(rad);\r\n    float c = cos(rad);\r\n    float x = pos.x*c-pos.y*s;\r\n    float y = pos.x*s+c*pos.y;\r\n    return vec2(x,y);\r\n}\r\n\r\nvec2 scaleVec2(vec2 scale,vec2 pos){\r\n    float x = scale.x * pos.x;\r\n    float y = scale.y * pos.y;\r\n    return vec2(x,y);\r\n}\r\n\r\nvec2 transVec2(vec2 trans,vec2 pos){\r\n    float x = pos.x + trans.x;\r\n    float y = pos.y + trans.y;\r\n    return vec2(x,y);\r\n}\r\n\r\n\r\nvoid main(){\r\n    vec2 center = u_FlareCenter;\r\n    vec2 deltaPos = -2.0 * center;\r\n    vec2 lenFlarePosition = vec2(a_PositionTexcoord.x, a_PositionTexcoord.y);\r\n    // aspectRadio scale\r\n    vec2 aspectRadio = vec2(u_aspectRatio, 1.0);\r\n    //\r\n    vec2 scale = vec2(a_DistanceRotationScale.z, a_DistanceRotationScale.w);\r\n    lenFlarePosition = scaleVec2(scale,lenFlarePosition);\r\n    //\r\n    // float rad = acos(dot(normalize(center),vec2(0.0,1.0)));\r\n    // angular offset\r\n    #ifdef LENSFLAREAUTOROTATE\r\n        lenFlarePosition = rotateVec2(u_rotate, lenFlarePosition);\r\n        float texRotate = a_DistanceRotationScale.y;\r\n        lenFlarePosition = rotateVec2(texRotate, lenFlarePosition);\r\n    #endif\r\n    float angularoffset = u_Angularoffset;\r\n    lenFlarePosition = rotateVector(lenFlarePosition, center, angularoffset);\r\n    lenFlarePosition = scaleVec2(aspectRadio,lenFlarePosition);\r\n    //\r\n    lenFlarePosition = center + deltaPos * a_DistanceRotationScale.x + lenFlarePosition + u_Postionoffset;\r\n    gl_Position = vec4(lenFlarePosition.x, lenFlarePosition.y, 0.0, 1.0);\r\n    v_Texcoord0 = a_PositionTexcoord.zw;\r\n}\r\n","import { Config3D } from \"../../../../Config3D\";\r\nimport { ILaya } from \"../../../../ILaya\";\r\nimport { Sprite } from \"../../../display/Sprite\";\r\nimport { Loader } from \"../../../net/Loader\";\r\nimport { Context } from \"../../../resource/Context\";\r\nimport { Texture2D } from \"../../../resource/Texture2D\";\r\nimport { Handler } from \"../../../utils/Handler\";\r\nimport { Timer } from \"../../../utils/Timer\";\r\nimport { ISubmit } from \"../../../webgl/submit/ISubmit\";\r\nimport { SubmitKey } from \"../../../webgl/submit/SubmitKey\";\r\nimport { Cluster } from \"../../graphics/renderPath/Cluster\";\r\nimport { SphericalHarmonicsL2 } from \"../../graphics/SphericalHarmonicsL2\";\r\nimport { Viewport } from \"../../math/Viewport\";\r\nimport { PhysicsSettings } from \"../../physics/PhysicsSettings\";\r\nimport { SkyBox } from \"../../resource/models/SkyBox\";\r\nimport { SkyDome } from \"../../resource/models/SkyDome\";\r\nimport { SkyRenderer } from \"../../resource/models/SkyRenderer\";\r\nimport { TextureCube } from \"../../../resource/TextureCube\";\r\nimport { Utils3D } from \"../../utils/Utils3D\";\r\nimport { BaseCamera } from \"../BaseCamera\";\r\nimport { Camera, CameraClearFlags } from \"../Camera\";\r\nimport { AlternateLightQueue, LightQueue } from \"../light/LightQueue\";\r\nimport { RenderContext3D } from \"../render/RenderContext3D\";\r\nimport { RenderElement } from \"../render/RenderElement\";\r\nimport { Lightmap } from \"./Lightmap\";\r\nimport { Scene3DShaderDeclaration } from \"./Scene3DShaderDeclaration\";\r\nimport { ShadowCasterPass } from \"../../shadowMap/ShadowCasterPass\";\r\nimport { BaseTexture } from \"../../../resource/BaseTexture\";\r\nimport { BlitFrameBufferCMD } from \"../render/command/BlitFrameBufferCMD\";\r\nimport { DirectionLightCom } from \"../light/DirectionLightCom\";\r\nimport { Sprite3D } from \"../Sprite3D\";\r\nimport { PointLightCom } from \"../light/PointLightCom\";\r\nimport { SpotLightCom } from \"../light/SpotLightCom\";\r\nimport { FilterMode } from \"../../../RenderEngine/RenderEnum/FilterMode\";\r\nimport { RenderCapable } from \"../../../RenderEngine/RenderEnum/RenderCapable\";\r\nimport { DefineDatas } from \"../../../RenderEngine/RenderShader/DefineDatas\";\r\nimport { Shader3D } from \"../../../RenderEngine/RenderShader/Shader3D\";\r\nimport { ShaderData, ShaderDataItem, ShaderDataType } from \"../../../RenderEngine/RenderShader/ShaderData\";\r\nimport { UnifromBufferData, UniformBufferParamsType } from \"../../../RenderEngine/UniformBufferData\";\r\nimport { UniformBufferObject } from \"../../../RenderEngine/UniformBufferObject\";\r\nimport { RenderTargetFormat } from \"../../../RenderEngine/RenderEnum/RenderTargetFormat\";\r\nimport { RenderClearFlag } from \"../../../RenderEngine/RenderEnum/RenderClearFlag\";\r\nimport { ICullPass } from \"../../../RenderEngine/RenderInterface/RenderPipelineInterface/ICullPass\";\r\nimport { FrustumCulling } from \"../../graphics/FrustumCulling\";\r\nimport { IShadowCullInfo } from \"../../../RenderEngine/RenderInterface/RenderPipelineInterface/IShadowCullInfo\";\r\nimport { ICameraCullInfo } from \"../../../RenderEngine/RenderInterface/RenderPipelineInterface/ICameraCullInfo\";\r\nimport { BufferUsage } from \"../../../RenderEngine/RenderEnum/BufferTargetType\";\r\nimport { Prefab } from \"../../../resource/HierarchyResource\";\r\nimport { Stat } from \"../../../utils/Stat\";\r\nimport { CommandUniformMap } from \"../../../RenderEngine/CommandUniformMap\";\r\nimport { ComponentDriver } from \"../../../components/ComponentDriver\";\r\nimport { IRenderQueue } from \"../../../RenderEngine/RenderInterface/RenderPipelineInterface/IRenderQueue\";\r\nimport { LayaEnv } from \"../../../../LayaEnv\";\r\nimport { SceneRenderManager } from \"./SceneRenderManager\";\r\nimport { VolumeManager } from \"../../component/Volume/VolumeManager\";\r\nimport { UI3DManager } from \"../UI3D/UI3DManager\";\r\nimport { Scene } from \"../../../display/Scene\";\r\nimport { ReflectionProbe } from \"../../component/Volume/reflectionProbe/ReflectionProbe\";\r\nimport { AmbientMode } from \"./AmbientMode\";\r\nimport { BVHSpatialConfig } from \"./bvh/SpatialManager\";\r\nimport { BVHSceneRenderManager } from \"./BVHSceneRenderManager/BVHSceneRenderManager\";\r\nimport { BVHCullPass } from \"./BVHSceneRenderManager/BVHCullPass\";\r\nimport { Color } from \"../../../maths/Color\";\r\nimport { Vector3 } from \"../../../maths/Vector3\";\r\nimport { Vector4 } from \"../../../maths/Vector4\";\r\nimport { BufferState } from \"../../../webgl/utils/BufferState\";\r\nimport { RenderTexture } from \"../../../resource/RenderTexture\";\r\nimport { Laya3D } from \"../../../../Laya3D\";\r\nimport { IPhysicsManager } from \"../../../Physics3D/interface/IPhysicsManager\";\r\nimport { LayaGL } from \"../../../layagl/LayaGL\";\r\nimport { Laya3DRender } from \"../../RenderObjs/Laya3DRender\";\r\nimport { IElementComponentManager } from \"./IScenceComponentManager\";\r\nimport { ISceneRenderManager } from \"../../../RenderEngine/RenderInterface/RenderPipelineInterface/ISceneRenderManager\";\r\n\r\nexport enum FogMode {\r\n    Linear = 0, //Linear\r\n    EXP = 1,    // \r\n    EXP2 = 2,   // \r\n}\r\n\r\n/**\r\n * 3D\r\n */\r\nexport class Scene3D extends Sprite implements ISubmit {\r\n    /** @internal */\r\n    private static _lightTexture: Texture2D;\r\n    /** @internal */\r\n    private static _lightPixles: Float32Array;\r\n    /** @internal */\r\n    static _shadowCasterPass: ShadowCasterPass;\r\n    /**@internal */\r\n    static physicsSettings: PhysicsSettings = new PhysicsSettings();\r\n    /** reflection mode */\r\n    static REFLECTIONMODE_SKYBOX: number = 0;\r\n    static REFLECTIONMODE_CUSTOM: number = 1;\r\n    /** RenderQueue mode */\r\n    static SCENERENDERFLAG_RENDERQPAQUE = 0;\r\n    static SCENERENDERFLAG_SKYBOX = 1;\r\n    static SCENERENDERFLAG_RENDERTRANSPARENT = 2;\r\n    /**Scene3D UniformMap */\r\n    static sceneUniformMap: CommandUniformMap;\r\n    /** Scene UniformPropertyID */\r\n    /** @internal */\r\n    static FOGCOLOR: number;\r\n    /** @internal */\r\n    static FOGPARAMS: number;\r\n    /** @internal */\r\n    static DIRECTIONLIGHTCOUNT: number;\r\n    /** @internal */\r\n    static LIGHTBUFFER: number;\r\n    /** @internal */\r\n    static CLUSTERBUFFER: number;\r\n    /** @internal */\r\n    static SUNLIGHTDIRECTION: number;\r\n    /** @internal */\r\n    static SUNLIGHTDIRCOLOR: number;\r\n\r\n    /** @internal */\r\n    static AMBIENTCOLOR: number;\r\n\r\n    /** @internal */\r\n    static TIME: number;\r\n    /**@internal */\r\n    static GIRotate: number;\r\n    /** @internal */\r\n    static sceneID: number;\r\n\r\n    static SceneUBOData: UnifromBufferData;\r\n    /**@internal scene uniform block */\r\n    static SCENEUNIFORMBLOCK: number;\r\n    //------------------legacy lighting-------------------------------\r\n    /** @internal */\r\n    static LIGHTDIRECTION: number;\r\n    /** @internal */\r\n    static LIGHTDIRCOLOR: number;\r\n    /** @internal */\r\n    static LIGHTMODE: number;\r\n    /** @internal */\r\n    static POINTLIGHTPOS: number;\r\n    /** @internal */\r\n    static POINTLIGHTRANGE: number;\r\n    /** @internal */\r\n    static POINTLIGHTATTENUATION: number;\r\n    /** @internal */\r\n    static POINTLIGHTCOLOR: number;\r\n    /** @internal */\r\n    static POINTLIGHTMODE: number;\r\n    /** @internal */\r\n    static SPOTLIGHTPOS: number;\r\n    /** @internal */\r\n    static SPOTLIGHTDIRECTION: number;\r\n    /** @internal */\r\n    static SPOTLIGHTSPOTANGLE: number;\r\n    /** @internal */\r\n    static SPOTLIGHTRANGE: number;\r\n    /** @internal */\r\n    static SPOTLIGHTCOLOR: number;\r\n    /** @internal */\r\n    static SPOTLIGHTMODE: number;\r\n    //------------------legacy lighting-------------------------------\r\n    /** @internal */\r\n    static __updateMark: number = 0;\r\n    /** @internal*/\r\n    static _blitTransRT: RenderTexture;\r\n    /**@internal */\r\n    static _blitOffset: Vector4 = new Vector4();\r\n    /**@internal */\r\n    static mainCavansViewPort: Viewport = new Viewport(0, 0, 1, 1);\r\n\r\n    static componentManagerMap: Map<string, any> = new Map();\r\n\r\n    /**\r\n     * \r\n     */\r\n    static set _updateMark(value: number) {\r\n        Scene3D.__updateMark = value;\r\n    }\r\n\r\n    static get _updateMark(): number {\r\n        return Scene3D.__updateMark;\r\n    }\r\n\r\n\r\n    static regManager(type: string, cla: any) {\r\n        Scene3D.componentManagerMap.set(type, cla);\r\n    }\r\n\r\n    /**\r\n     * init shaderData\r\n     */\r\n    static shaderValueInit() {\r\n        Scene3DShaderDeclaration.SHADERDEFINE_FOG = Shader3D.getDefineByName(\"FOG\");\r\n        Scene3DShaderDeclaration.SHADERDEFINE_FOG_LINEAR = Shader3D.getDefineByName(\"FOG_LINEAR\");\r\n        Scene3DShaderDeclaration.SHADERDEFINE_FOG_EXP = Shader3D.getDefineByName(\"FOG_EXP\");\r\n        Scene3DShaderDeclaration.SHADERDEFINE_FOG_EXP2 = Shader3D.getDefineByName(\"FOG_EXP2\");\r\n        Scene3DShaderDeclaration.SHADERDEFINE_DIRECTIONLIGHT = Shader3D.getDefineByName(\"DIRECTIONLIGHT\");\r\n        Scene3DShaderDeclaration.SHADERDEFINE_POINTLIGHT = Shader3D.getDefineByName(\"POINTLIGHT\");\r\n        Scene3DShaderDeclaration.SHADERDEFINE_SPOTLIGHT = Shader3D.getDefineByName(\"SPOTLIGHT\");\r\n        Scene3DShaderDeclaration.SHADERDEFINE_SHADOW = Shader3D.getDefineByName(\"SHADOW\");\r\n        Scene3DShaderDeclaration.SHADERDEFINE_SHADOW_CASCADE = Shader3D.getDefineByName(\"SHADOW_CASCADE\");\r\n        Scene3DShaderDeclaration.SHADERDEFINE_SHADOW_SOFT_SHADOW_LOW = Shader3D.getDefineByName(\"SHADOW_SOFT_SHADOW_LOW\");\r\n        Scene3DShaderDeclaration.SHADERDEFINE_SHADOW_SOFT_SHADOW_HIGH = Shader3D.getDefineByName(\"SHADOW_SOFT_SHADOW_HIGH\");\r\n\r\n        Scene3DShaderDeclaration.SHADERDEFINE_SHADOW_SPOT = Shader3D.getDefineByName(\"SHADOW_SPOT\");\r\n        Scene3DShaderDeclaration.SHADERDEFINE_SHADOW_SPOT_SOFT_SHADOW_LOW = Shader3D.getDefineByName(\"SHADOW_SPOT_SOFT_SHADOW_LOW\");\r\n        Scene3DShaderDeclaration.SHADERDEFINE_SHADOW_SPOT_SOFT_SHADOW_HIGH = Shader3D.getDefineByName(\"SHADOW_SPOT_SOFT_SHADOW_HIGH\");\r\n\r\n        Scene3D.FOGCOLOR = Shader3D.propertyNameToID(\"u_FogColor\");\r\n        Scene3D.FOGPARAMS = Shader3D.propertyNameToID(\"u_FogParams\");//x start,y end,z Density\r\n        Scene3D.DIRECTIONLIGHTCOUNT = Shader3D.propertyNameToID(\"u_DirationLightCount\");\r\n        Scene3D.LIGHTBUFFER = Shader3D.propertyNameToID(\"u_LightBuffer\");\r\n        Scene3D.CLUSTERBUFFER = Shader3D.propertyNameToID(\"u_LightClusterBuffer\");\r\n        Scene3D.TIME = Shader3D.propertyNameToID(\"u_Time\");\r\n        Scene3D.GIRotate = Shader3D.propertyNameToID(\"u_GIRotate\");\r\n        Scene3D.SCENEUNIFORMBLOCK = Shader3D.propertyNameToID(UniformBufferObject.UBONAME_SCENE);\r\n        let sceneUniformMap: CommandUniformMap = Scene3D.sceneUniformMap = LayaGL.renderOBJCreate.createGlobalUniformMap(\"Scene3D\");\r\n        if (Config3D._uniformBlock) {\r\n\r\n            sceneUniformMap.addShaderBlockUniform(Scene3D.SCENEUNIFORMBLOCK, UniformBufferObject.UBONAME_SCENE, [\r\n                {\r\n                    id: Scene3D.TIME,\r\n                    propertyName: \"u_Time\",\r\n                    uniformtype: ShaderDataType.Float\r\n                },\r\n                {\r\n                    id: Scene3D.FOGPARAMS,\r\n                    propertyName: \"u_FogParams\",\r\n                    uniformtype: ShaderDataType.Vector4\r\n                },\r\n                {\r\n                    id: Scene3D.FOGCOLOR,\r\n                    propertyName: \"u_FogColor\",\r\n                    uniformtype: ShaderDataType.Vector4\r\n                }\r\n            ])\r\n        } else {\r\n            sceneUniformMap.addShaderUniform(Scene3D.FOGCOLOR, \"u_FogColor\", ShaderDataType.Color);\r\n            sceneUniformMap.addShaderUniform(Scene3D.FOGPARAMS, \"u_FogParams\", ShaderDataType.Vector4);\r\n            sceneUniformMap.addShaderUniform(Scene3D.TIME, \"u_Time\", ShaderDataType.Float);\r\n        }\r\n\r\n        sceneUniformMap.addShaderUniform(Scene3D.DIRECTIONLIGHTCOUNT, \"u_DirationLightCount\", ShaderDataType.Int);\r\n        sceneUniformMap.addShaderUniform(Scene3D.LIGHTBUFFER, \"u_LightBuffer\", ShaderDataType.Texture2D);\r\n        sceneUniformMap.addShaderUniform(Scene3D.CLUSTERBUFFER, \"u_LightClusterBuffer\", ShaderDataType.Texture2D);\r\n\r\n        sceneUniformMap.addShaderUniform(Scene3D.GIRotate, \"u_GIRotate\", ShaderDataType.Float);\r\n    }\r\n\r\n    /**\r\n     * legency ShaderData\r\n     */\r\n    static legacyLightingValueInit() {\r\n        Scene3D.LIGHTDIRECTION = Shader3D.propertyNameToID(\"u_DirectionLight.direction\");\r\n        Scene3D.sceneUniformMap.addShaderUniform(Scene3D.LIGHTDIRECTION, \"u_DirectionLight.direction\", ShaderDataType.Vector3);\r\n        Scene3D.LIGHTDIRCOLOR = Shader3D.propertyNameToID(\"u_DirectionLight.color\");\r\n        Scene3D.sceneUniformMap.addShaderUniform(Scene3D.LIGHTDIRCOLOR, \"u_DirectionLight.color\", ShaderDataType.Vector3);\r\n        Scene3D.LIGHTMODE = Shader3D.propertyNameToID(\"u_DirectionLight.lightMode\");\r\n        Scene3D.sceneUniformMap.addShaderUniform(Scene3D.LIGHTMODE, \"u_DirectionLight.lightMode\", ShaderDataType.Int);\r\n\r\n        Scene3D.POINTLIGHTPOS = Shader3D.propertyNameToID(\"u_PointLight.position\");\r\n        Scene3D.sceneUniformMap.addShaderUniform(Scene3D.POINTLIGHTPOS, \"u_PointLight.position\", ShaderDataType.Vector3);\r\n        Scene3D.POINTLIGHTRANGE = Shader3D.propertyNameToID(\"u_PointLight.range\");\r\n        Scene3D.sceneUniformMap.addShaderUniform(Scene3D.POINTLIGHTRANGE, \"u_PointLight.range\", ShaderDataType.Float);\r\n        Scene3D.POINTLIGHTATTENUATION = Shader3D.propertyNameToID(\"u_PointLight.attenuation\");\r\n        Scene3D.sceneUniformMap.addShaderUniform(Scene3D.POINTLIGHTATTENUATION, \"u_PointLight.attenuation\", ShaderDataType.Float);\r\n        Scene3D.POINTLIGHTCOLOR = Shader3D.propertyNameToID(\"u_PointLight.color\");\r\n        Scene3D.sceneUniformMap.addShaderUniform(Scene3D.POINTLIGHTCOLOR, \"u_PointLight.color\", ShaderDataType.Vector3);\r\n        Scene3D.POINTLIGHTMODE = Shader3D.propertyNameToID(\"u_PointLight.lightMode\");\r\n        Scene3D.sceneUniformMap.addShaderUniform(Scene3D.POINTLIGHTMODE, \"u_PointLight.lightMode\", ShaderDataType.Int);\r\n\r\n        Scene3D.SPOTLIGHTPOS = Shader3D.propertyNameToID(\"u_SpotLight.position\");\r\n        Scene3D.sceneUniformMap.addShaderUniform(Scene3D.SPOTLIGHTPOS, \"u_SpotLight.position\", ShaderDataType.Vector3);\r\n        Scene3D.SPOTLIGHTDIRECTION = Shader3D.propertyNameToID(\"u_SpotLight.direction\");\r\n        Scene3D.sceneUniformMap.addShaderUniform(Scene3D.SPOTLIGHTDIRECTION, \"u_SpotLight.direction\", ShaderDataType.Vector3);\r\n        Scene3D.SPOTLIGHTSPOTANGLE = Shader3D.propertyNameToID(\"u_SpotLight.spot\");\r\n        Scene3D.sceneUniformMap.addShaderUniform(Scene3D.SPOTLIGHTSPOTANGLE, \"u_SpotLight.spot\", ShaderDataType.Float);\r\n        Scene3D.SPOTLIGHTRANGE = Shader3D.propertyNameToID(\"u_SpotLight.range\");\r\n        Scene3D.sceneUniformMap.addShaderUniform(Scene3D.SPOTLIGHTRANGE, \"u_SpotLight.range\", ShaderDataType.Float);\r\n        Scene3D.SPOTLIGHTCOLOR = Shader3D.propertyNameToID(\"u_SpotLight.color\");\r\n        Scene3D.sceneUniformMap.addShaderUniform(Scene3D.SPOTLIGHTCOLOR, \"u_SpotLight.color\", ShaderDataType.Vector3);\r\n        Scene3D.SPOTLIGHTMODE = Shader3D.propertyNameToID(\"u_SpotLight.lightMode\");\r\n        Scene3D.sceneUniformMap.addShaderUniform(Scene3D.SPOTLIGHTMODE, \"u_SpotLight.lightMode\", ShaderDataType.Int);\r\n    }\r\n\r\n    /**\r\n     * create Scene UniformBuffer\r\n     * @internal\r\n     * @returns \r\n     */\r\n    static createSceneUniformBlock(): UnifromBufferData {\r\n        if (!Scene3D.SceneUBOData) {\r\n            let uniformpara: Map<string, UniformBufferParamsType> = new Map<string, UniformBufferParamsType>();\r\n            uniformpara.set(\"u_Time\", UniformBufferParamsType.Number);\r\n            uniformpara.set(\"u_FogParams\", UniformBufferParamsType.Vector4);\r\n            uniformpara.set(\"u_FogColor\", UniformBufferParamsType.Vector4);\r\n            let uniformMap = new Map<number, UniformBufferParamsType>();\r\n            uniformpara.forEach((value, key) => {\r\n                uniformMap.set(Shader3D.propertyNameToID(key), value);\r\n            });\r\n            Scene3D.SceneUBOData = new UnifromBufferData(uniformMap);\r\n        }\r\n        return Scene3D.SceneUBOData;\r\n    }\r\n\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    static __init__(): void {\r\n        var multiLighting: boolean = Config3D._multiLighting;\r\n        if (multiLighting) {\r\n            const width = 4;\r\n            var maxLightCount: number = Config3D.maxLightCount;\r\n            var clusterSlices: Vector3 = Config3D.lightClusterCount;\r\n            Cluster.instance = new Cluster(clusterSlices.x, clusterSlices.y, clusterSlices.z, Math.min(Config3D.maxLightCount, Config3D._maxAreaLightCountPerClusterAverage));\r\n            Scene3D._lightTexture = Utils3D._createFloatTextureBuffer(width, maxLightCount);\r\n            Scene3D._lightTexture.lock = true;\r\n            Scene3D._lightPixles = new Float32Array(maxLightCount * width * 4);\r\n        }\r\n        Scene3D.shaderValueInit();\r\n        var configShaderValue: DefineDatas = Shader3D._configDefineValues;\r\n        if (!Config3D._multiLighting) {\r\n            (configShaderValue.add(Shader3D.SHADERDEFINE_LEGACYSINGALLIGHTING));\r\n            Scene3D.legacyLightingValueInit()\r\n        }\r\n        Scene3D._shadowCasterPass = new ShadowCasterPass();\r\n        //UniformBuffer\r\n        if (Config3D._uniformBlock)\r\n            configShaderValue.add(Shader3D.SHADERDEFINE_ENUNIFORMBLOCK);\r\n\r\n        let supportFloatTex = LayaGL.renderEngine.getCapable(RenderCapable.TextureFormat_R32G32B32A32);\r\n        if (supportFloatTex) {\r\n            configShaderValue.add(Shader3D.SHADERDEFINE_FLOATTEXTURE);\r\n        }\r\n        let supportFloatLinearFiltering = LayaGL.renderEngine.getCapable(RenderCapable.Texture_FloatLinearFiltering);\r\n        if (supportFloatLinearFiltering) {\r\n            configShaderValue.add(Shader3D.SHADERDEFINE_FLOATTEXTURE_FIL_LINEAR);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * ,:\r\n     * @param url \r\n     * @param complete \r\n     */\r\n    static load(url: string, complete: Handler): void {\r\n        ILaya.loader.load(url).then((res: Prefab) => {\r\n            if (complete) {\r\n                let ret: Scene3D;\r\n                if (res) {\r\n                    let scene = res.create();\r\n                    if (scene instanceof Scene)\r\n                        ret = scene._scene3D;\r\n                    else\r\n                        ret = <Scene3D>scene;\r\n                }\r\n                complete.runWith([ret]);\r\n            }\r\n        });\r\n    }\r\n\r\n    /**ide */\r\n    _reflectionsSource: number = 0;\r\n    /**ide */\r\n    _reflectionsResolution: string = \"256\";\r\n    /**ide */\r\n    _reflectionsIblSamples = 128;\r\n\r\n\r\n\r\n    /** @internal */\r\n    private _group: string;\r\n    /** @internal */\r\n    public _lightCount: number = 0;\r\n    /** @internal */\r\n    public _pointLights: LightQueue<PointLightCom> = new LightQueue();\r\n    /** @internal */\r\n    public _spotLights: LightQueue<SpotLightCom> = new LightQueue();\r\n    /** @internal */\r\n    public _directionLights: LightQueue<DirectionLightCom> = new LightQueue();\r\n    /** @internal */\r\n    public _alternateLights: AlternateLightQueue = new AlternateLightQueue();\r\n    /** @internal */\r\n    private _lightmaps: Lightmap[] = [];\r\n    /** @internal */\r\n    private _skyRenderer: SkyRenderer = new SkyRenderer();\r\n    /** @internal */\r\n    private _enableFog: boolean;\r\n    /** @internal */\r\n    private _timer: Timer;\r\n    /** @internal */\r\n    private _time: number = 0;\r\n    /** @internal */\r\n    private _fogParams: Vector4;\r\n    /** @internal */\r\n    private _fogMode: FogMode;\r\n    /**@internal */\r\n    private _sceneReflectionProb: ReflectionProbe;\r\n    /**@internal */\r\n    private _physicsStepTime: number = 0;\r\n    /**@internal */\r\n    _lightmapDirtyFlag: number = -1;\r\n    /**@internal */\r\n    _sunColor: Color = new Color(1.0, 1.0, 1.0);\r\n    /**@interanl */\r\n    _sundir: Vector3 = new Vector3();\r\n    /**@internal*/\r\n    _id = Scene3D.sceneID++;\r\n    /** @internal */\r\n    _mainDirectionLight: DirectionLightCom;\r\n    /** @internal */\r\n    _mainSpotLight: SpotLightCom;\r\n    /** @internal */\r\n    _mainPointLight: PointLightCom;//TODO\r\n    /** @internal */\r\n    _physicsManager: IPhysicsManager;\r\n    /** @internal ,*/\r\n    _collsionTestList: number[] = [];\r\n    /** @internal */\r\n    _shaderValues: ShaderData;\r\n    /** @interanl */\r\n    _sceneUniformData: UnifromBufferData;\r\n    /** @internal */\r\n    _sceneUniformObj: UniformBufferObject;\r\n    /** @internal */\r\n    _key: SubmitKey = new SubmitKey();\r\n\r\n    /** @internal */\r\n    _opaqueQueue: IRenderQueue = Laya3DRender.renderOBJCreate.createBaseRenderQueue(false);\r\n    /** @internal */\r\n    _transparentQueue: IRenderQueue = Laya3DRender.renderOBJCreate.createBaseRenderQueue(true);\r\n    /** @internal */\r\n    _cameraPool: BaseCamera[] = [];\r\n\r\n    /** @internal */\r\n    _volumeManager: VolumeManager;\r\n    /**@internal */\r\n    _UI3DManager: UI3DManager = new UI3DManager();\r\n    /**@internal */\r\n    _sceneRenderManager: SceneRenderManager;\r\n    /**@internal */\r\n    _cullPass: ICullPass;\r\n    /** */\r\n    currentCreationLayer: number = Math.pow(2, 0);\r\n    /** */\r\n    enableLight: boolean = true;\r\n    /**lightShadowMap  @internal */\r\n    _ShadowMapupdateFrequency: number = 1;\r\n    /** @internal */\r\n    _nativeObj: any;\r\n\r\n    /** @internal IDE */\r\n    _renderByEditor: boolean;\r\n    /** @internal */\r\n    _scene2D: Scene;\r\n\r\n    componentElementMap: Map<string, IElementComponentManager> = new Map();\r\n\r\n    /** @internal */\r\n    private _componentElementDatasMap: any = {};\r\n\r\n    /**\r\n     * Scene3D2DIDE\r\n     */\r\n    get scene2D(): Scene {\r\n        return this._scene2D;\r\n    }\r\n\r\n    /**\r\n     * set SceneRenderableManager\r\n     */\r\n    set sceneRenderableManager(manager: SceneRenderManager) {\r\n        manager.list = this._sceneRenderManager.list;\r\n        this._sceneRenderManager = manager;\r\n    }\r\n\r\n    get sceneRenderableManager(): SceneRenderManager {\r\n        return this._sceneRenderManager;\r\n    }\r\n\r\n    /**\r\n     * set ICullPass\r\n     */\r\n    set cullPass(cullPass: ICullPass) {\r\n        this._cullPass = cullPass;\r\n    }\r\n\r\n    /**\r\n     * \r\n     */\r\n    get enableFog(): boolean {\r\n        return this._enableFog;\r\n    }\r\n\r\n    set enableFog(value: boolean) {\r\n        if (this._enableFog !== value) {\r\n            this._enableFog = value;\r\n            if (value) {\r\n                this._shaderValues.addDefine(Scene3DShaderDeclaration.SHADERDEFINE_FOG);\r\n            } else\r\n                this._shaderValues.removeDefine(Scene3DShaderDeclaration.SHADERDEFINE_FOG);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * \r\n     */\r\n    get fogMode(): FogMode {\r\n        return this._fogMode;\r\n    }\r\n\r\n    set fogMode(value: FogMode) {\r\n        this._fogMode = value;\r\n        switch (value) {\r\n            case FogMode.Linear:\r\n                this._shaderValues.addDefine(Scene3DShaderDeclaration.SHADERDEFINE_FOG_LINEAR);\r\n                this._shaderValues.removeDefine(Scene3DShaderDeclaration.SHADERDEFINE_FOG_EXP);\r\n                this._shaderValues.removeDefine(Scene3DShaderDeclaration.SHADERDEFINE_FOG_EXP2);\r\n                break;\r\n            case FogMode.EXP:\r\n                this._shaderValues.addDefine(Scene3DShaderDeclaration.SHADERDEFINE_FOG_EXP);\r\n                this._shaderValues.removeDefine(Scene3DShaderDeclaration.SHADERDEFINE_FOG_LINEAR);\r\n                this._shaderValues.removeDefine(Scene3DShaderDeclaration.SHADERDEFINE_FOG_EXP2);\r\n                break;\r\n            case FogMode.EXP2:\r\n                this._shaderValues.addDefine(Scene3DShaderDeclaration.SHADERDEFINE_FOG_EXP2);\r\n                this._shaderValues.removeDefine(Scene3DShaderDeclaration.SHADERDEFINE_FOG_LINEAR);\r\n                this._shaderValues.removeDefine(Scene3DShaderDeclaration.SHADERDEFINE_FOG_EXP);\r\n                break;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * \r\n     */\r\n    get fogColor(): Color {\r\n        return this._shaderValues.getColor(Scene3D.FOGCOLOR);\r\n    }\r\n\r\n    set fogColor(value: Color) {\r\n        this._shaderValues.setColor(Scene3D.FOGCOLOR, value);\r\n    }\r\n\r\n    /**\r\n     * \r\n     */\r\n    get fogStart(): number {\r\n        return this._fogParams.x;\r\n\r\n    }\r\n\r\n    set fogStart(value: number) {\r\n        this._fogParams.x = value;\r\n        this.fogParams = this._fogParams;\r\n    }\r\n\r\n    /**\r\n     * end\r\n     */\r\n    get fogEnd(): number {\r\n        return this._fogParams.y;\r\n    }\r\n\r\n    set fogEnd(value: number) {\r\n        this._fogParams.y = value;\r\n        this.fogParams = this._fogParams;\r\n    }\r\n\r\n\r\n    /**\r\n     * \r\n     */\r\n    get fogDensity(): number {\r\n        return this._fogParams.z\r\n    }\r\n\r\n    set fogDensity(value: number) {\r\n        this._fogParams.z = value;\r\n        this.fogParams = this._fogParams;\r\n    }\r\n\r\n    /**@internal */\r\n    get fogParams(): Vector4 {\r\n        return this._shaderValues.getVector(Scene3D.FOGPARAMS);\r\n    }\r\n\r\n    set fogParams(value: Vector4) {\r\n        this._shaderValues.setVector(Scene3D.FOGPARAMS, value);\r\n    }\r\n\r\n    //0-2PI\r\n    set GIRotate(value: number) {\r\n        this._shaderValues.setNumber(Scene3D.GIRotate, value);\r\n    }\r\n\r\n    get GIRotate() {\r\n        return this._shaderValues.getNumber(Scene3D.GIRotate);\r\n    }\r\n\r\n    /**\r\n     * \r\n     * AmbientMode.SolidColorambientColorAmbientMode.SphericalHarmonicsambientSphericalHarmonics\r\n     */\r\n    get ambientMode(): AmbientMode {\r\n        return this._sceneReflectionProb.ambientMode;\r\n    }\r\n\r\n    set ambientMode(value: AmbientMode) {\r\n        this._sceneReflectionProb.ambientMode = value;\r\n    }\r\n\r\n    get sceneReflectionProb(): ReflectionProbe {\r\n        return this._sceneReflectionProb;\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    set sceneReflectionProb(value: ReflectionProbe) {\r\n        this._sceneReflectionProb = value;\r\n    }\r\n\r\n    /**\r\n     * \r\n     */\r\n    get ambientColor(): Color {\r\n        return this._sceneReflectionProb.ambientColor;\r\n    }\r\n\r\n    set ambientColor(value: Color) {\r\n        this._sceneReflectionProb.ambientColor = value;\r\n    }\r\n\r\n\r\n    /**\r\n     * \r\n     */\r\n    get ambientIntensity(): number {\r\n        return this._sceneReflectionProb.ambientIntensity;\r\n    }\r\n\r\n    set ambientIntensity(value: number) {\r\n        this._sceneReflectionProb.ambientIntensity = value;\r\n    }\r\n\r\n    /**\r\n     * \r\n     */\r\n    get reflectionIntensity(): number {\r\n        return this._sceneReflectionProb.reflectionIntensity;\r\n    }\r\n\r\n    set reflectionIntensity(value: number) {\r\n        this._sceneReflectionProb.reflectionIntensity = value;\r\n    }\r\n\r\n    /**\r\n     * ambient sh\r\n     */\r\n    public get ambientSH(): Float32Array {\r\n        return this._sceneReflectionProb.ambientSH;\r\n    }\r\n    public set ambientSH(value: Float32Array) {\r\n        this._sceneReflectionProb.ambientSH = value;\r\n    }\r\n    /**\r\n     * ambient iblTexture\r\n     */\r\n    public get iblTex(): TextureCube {\r\n        return this._sceneReflectionProb.iblTex;\r\n\r\n    }\r\n    public set iblTex(value: TextureCube) {\r\n        this._sceneReflectionProb.iblTex = value\r\n    }\r\n\r\n    /**\r\n     * ambient rgbd compress\r\n     */\r\n    public get iblTexRGBD(): boolean {\r\n        return this._sceneReflectionProb.iblTexRGBD;\r\n    }\r\n    public set iblTexRGBD(value: boolean) {\r\n        this._sceneReflectionProb.iblTexRGBD = value;\r\n    }\r\n\r\n    /**\r\n     * \r\n     */\r\n    get skyRenderer(): SkyRenderer {\r\n        return this._skyRenderer;\r\n    }\r\n\r\n    /**\r\n     * \r\n     */\r\n    get physicsSimulation(): IPhysicsManager {\r\n        return this._physicsManager;\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @override\r\n     */\r\n    get timer(): Timer {\r\n        return this._timer;\r\n    }\r\n\r\n    set timer(value: Timer) {\r\n        this._timer = value;\r\n    }\r\n\r\n    /**\r\n     * ,\r\n     */\r\n    get lightmaps(): Lightmap[] {\r\n        return this._lightmaps.slice();\r\n    }\r\n\r\n    set lightmaps(value: Lightmap[]) {\r\n        var maps: Lightmap[] = this._lightmaps;\r\n        if (maps) {\r\n            for (var i: number = 0, n: number = maps.length; i < n; i++) {\r\n                var map: Lightmap = maps[i];\r\n                map.lightmapColor && map.lightmapColor._removeReference();\r\n                map.lightmapDirection && map.lightmapDirection._removeReference();\r\n            }\r\n        }\r\n        if (value) {\r\n            var count: number = value.length;\r\n            maps.length = count;\r\n            for (i = 0; i < count; i++) {\r\n                var map: Lightmap = value[i];\r\n                map.lightmapColor && map.lightmapColor._addReference();\r\n                map.lightmapDirection && map.lightmapDirection._addReference();\r\n                maps[i] = map;\r\n            }\r\n        } else {\r\n            maps.length = 0;\r\n        }\r\n        this._lightmapDirtyFlag = Scene3D._updateMark;\r\n\r\n    }\r\n\r\n    /**\r\n     * \r\n     */\r\n    get shadowMapFrequency() {\r\n        return this._ShadowMapupdateFrequency;\r\n    }\r\n\r\n    set shadowMapFrequency(value: number) {\r\n        this._ShadowMapupdateFrequency = value;\r\n    }\r\n\r\n\r\n    /**\r\n     *  <code>Scene3D</code> \r\n     */\r\n    constructor() {\r\n        super();\r\n\r\n        this._is3D = true;\r\n        this._componentDriver = new ComponentDriver();\r\n        this._timer = ILaya.timer;\r\n\r\n        if (LayaEnv.isConch && !(window as any).conchConfig.conchWebGL) {\r\n            this._nativeObj = new (window as any).conchSubmitScene3D(this.renderSubmit.bind(this));\r\n        }\r\n        if (Laya3D.enablePhysics)\r\n            this._physicsManager = Laya3D.PhysicsCreateUtil.createPhysicsManger(Scene3D.physicsSettings);\r\n\r\n        this._shaderValues = LayaGL.renderOBJCreate.createShaderData(null);\r\n        this._shaderValues._defineDatas.addDefineDatas(Shader3D._configDefineValues);\r\n        if (Config3D._uniformBlock) {\r\n            //SceneUniformBlock\r\n            this._sceneUniformObj = UniformBufferObject.getBuffer(UniformBufferObject.UBONAME_SCENE, 0);\r\n            this._sceneUniformData = Scene3D.createSceneUniformBlock();\r\n            if (!this._sceneUniformObj) {\r\n                this._sceneUniformObj = UniformBufferObject.create(UniformBufferObject.UBONAME_SCENE, BufferUsage.Dynamic, this._sceneUniformData.getbyteLength(), true);\r\n            }\r\n            this._shaderValues._addCheckUBO(UniformBufferObject.UBONAME_SCENE, this._sceneUniformObj, this._sceneUniformData);\r\n            this._shaderValues.setUniformBuffer(Scene3D.SCENEUNIFORMBLOCK, this._sceneUniformObj);\r\n\r\n            //ShadowUniformBlock\r\n            //Scene3D._shadowCasterPass\r\n            this._shaderValues._addCheckUBO(UniformBufferObject.UBONAME_SHADOW, Scene3D._shadowCasterPass._castDepthBufferOBJ, Scene3D._shadowCasterPass._castDepthBufferData);\r\n            this._shaderValues.setUniformBuffer(Shader3D.propertyNameToID(UniformBufferObject.UBONAME_SHADOW), Scene3D._shadowCasterPass._castDepthBufferOBJ);\r\n        }\r\n        this._fogParams = new Vector4(300, 1000, 0.01, 0);\r\n        this.enableFog = false;\r\n        this.fogStart = 300;\r\n        this.fogEnd = 1000;\r\n        this.fogDensity = 0.01;\r\n        this.fogColor = new Color(0.7, 0.7, 0.7);\r\n        this.fogMode = FogMode.Linear;\r\n        this.GIRotate = 0;\r\n\r\n        this._scene = this;\r\n        if (Config3D.useBVHCull) {\r\n            let bvhConfig = new BVHSpatialConfig();\r\n            bvhConfig.Min_BVH_Build_Nums = Config3D.BVH_Min_Build_nums;\r\n            bvhConfig.limit_size = Config3D.BVH_limit_size;\r\n            bvhConfig.max_SpatialCount = Config3D.BVH_max_SpatialCount;\r\n            this._sceneRenderManager = new BVHSceneRenderManager(bvhConfig);\r\n            this._cullPass = new BVHCullPass();\r\n        } else {\r\n            this._sceneRenderManager = new SceneRenderManager();\r\n            this._cullPass = Laya3DRender.renderOBJCreate.createCullPass();\r\n        }\r\n\r\n        if (Config3D.debugFrustumCulling) {\r\n        }\r\n\r\n        this._volumeManager = new VolumeManager();\r\n        this._UI3DManager = new UI3DManager();\r\n        this.sceneReflectionProb = this._volumeManager.reflectionProbeManager.sceneReflectionProbe;\r\n\r\n        this._sceneReflectionProb.reflectionIntensity = 1.0;\r\n        this.ambientColor = new Color(0.212, 0.227, 0.259);\r\n\r\n        Scene3D.componentManagerMap.forEach((val, key) => {\r\n            let cla: any = val;\r\n            this.componentElementMap.set(key, new cla());\r\n        });\r\n    }\r\n\r\n    /**\r\n   * @internal\r\n   */\r\n    set componentElementDatasMap(value: any) {\r\n        this._componentElementDatasMap = value;\r\n        this.componentElementMap.forEach((value, key) => {\r\n            value.Init(this._componentElementDatasMap[key])\r\n        });\r\n    }\r\n\r\n    get componentElementDatasMap(): any {\r\n        return this._componentElementDatasMap;\r\n    }\r\n\r\n    /**\r\n     *@internal\r\n     */\r\n    _update(): void {\r\n        var delta: number = this.timer._delta / 1000;\r\n        this._time += delta;\r\n        this._shaderValues.setNumber(Scene3D.TIME, this._time);\r\n        //Physics\r\n        if (LayaEnv.isPlaying) {\r\n            this._physicsStepTime += delta;\r\n            if (this._physicsStepTime > Scene3D.physicsSettings.fixedTimeStep) {\r\n\r\n                let physicsManager = this._physicsManager;\r\n                if (Laya3D.enablePhysics && Stat.enablePhysicsUpdate) {\r\n                    physicsManager.update(this._physicsStepTime);\r\n                }\r\n                this._physicsStepTime = 0;\r\n            }\r\n        }\r\n        if (this._volumeManager.needreCaculateAllRenderObjects())\r\n            this._volumeManager.reCaculateAllRenderObjects(this._sceneRenderManager.list);\r\n        else\r\n            this._volumeManager.handleMotionlist();\r\n\r\n        this.componentElementMap.forEach((value) => {\r\n            value.update(delta);\r\n        });\r\n        this._componentDriver.callStart();\r\n        this._componentDriver.callUpdate();\r\n\r\n        this._componentDriver.callLateUpdate();\r\n        this._componentDriver.callDestroy();\r\n\r\n        this._sceneRenderManager.updateMotionObjects();\r\n\r\n        if (!this._renderByEditor)\r\n            this._UI3DManager.update();\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    private _binarySearchIndexInCameraPool(camera: BaseCamera): number {\r\n        var start: number = 0;\r\n        var end: number = this._cameraPool.length - 1;\r\n        var mid: number;\r\n        while (start <= end) {\r\n            mid = Math.floor((start + end) / 2);\r\n            var midValue: number = this._cameraPool[mid]._renderingOrder;\r\n            if (midValue == camera._renderingOrder)\r\n                return mid;\r\n            else if (midValue > camera._renderingOrder)\r\n                end = mid - 1;\r\n            else\r\n                start = mid + 1;\r\n        }\r\n        return start;\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    _getGroup(): string {\r\n        return this._group;\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    _setGroup(value: string): void {\r\n        this._group = value;\r\n    }\r\n\r\n    /**\r\n     * @inheritDoc\r\n     * @override\r\n     */\r\n    protected _onActive(): void {\r\n        super._onActive();\r\n        ILaya.stage._scene3Ds.push(this);\r\n    }\r\n\r\n    /**\r\n     * @inheritDoc\r\n     * @override\r\n     */\r\n    protected _onInActive(): void {\r\n        super._onInActive();\r\n        var scenes: any[] = ILaya.stage._scene3Ds;\r\n        scenes.splice(scenes.indexOf(this), 1);\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    private _prepareSceneToRender(): void {\r\n        var shaderValues: ShaderData = this._shaderValues;\r\n        var multiLighting: boolean = Config3D._multiLighting && Stat.enableMulLight;\r\n        if (multiLighting) {\r\n            var ligTex: Texture2D = Scene3D._lightTexture;\r\n            var ligPix: Float32Array = Scene3D._lightPixles;\r\n            const pixelWidth: number = ligTex.width;\r\n            const floatWidth: number = pixelWidth * 4;\r\n            var curCount: number = 0;\r\n            var dirCount: number = Stat.enableLight ? this._directionLights._length : 0;\r\n            var dirElements: DirectionLightCom[] = this._directionLights._elements;\r\n            if (dirCount > 0) {\r\n                var sunLightIndex: number = this._directionLights.getBrightestLight();//get the brightest light as sun\r\n                this._mainDirectionLight = dirElements[sunLightIndex];\r\n                this._directionLights.normalLightOrdering(sunLightIndex);\r\n                for (var i: number = 0; i < dirCount; i++, curCount++) {\r\n                    var dirLight: DirectionLightCom = dirElements[i];\r\n                    var dir: Vector3 = dirLight._direction;\r\n                    var intCor: Vector3 = dirLight._intensityColor;\r\n                    var off: number = floatWidth * curCount;\r\n                    intCor.x = Color.gammaToLinearSpace(dirLight.color.r);\r\n                    intCor.y = Color.gammaToLinearSpace(dirLight.color.g);\r\n                    intCor.z = Color.gammaToLinearSpace(dirLight.color.b);\r\n                    Vector3.scale(intCor, dirLight._intensity, intCor);\r\n                    (dirLight.owner as Sprite3D).transform.worldMatrix.getForward(dir);\r\n                    Vector3.normalize(dir, dir);//\r\n                    ligPix[off] = intCor.x;\r\n                    ligPix[off + 1] = intCor.y;\r\n                    ligPix[off + 2] = intCor.z;\r\n                    ligPix[off + 3] = dirLight._lightmapBakedType;//0: MIX  1:REALTIME\r\n                    ligPix[off + 4] = dir.x;\r\n                    ligPix[off + 5] = dir.y;\r\n                    ligPix[off + 6] = dir.z;\r\n                    // if (i == 0) {\r\n                    // \tthis._setShaderValue(Scene3D.SUNLIGHTDIRCOLOR, intCor);\r\n                    // \tthis._setShaderValue(Scene3D.SUNLIGHTDIRECTION, dir);\r\n                    // }\r\n                    if (i == 0) {\r\n                        this._sunColor = dirLight.color;\r\n                        this._sundir = dir;\r\n                    }\r\n                }\r\n                shaderValues.addDefine(Scene3DShaderDeclaration.SHADERDEFINE_DIRECTIONLIGHT);\r\n            }\r\n            else {\r\n                shaderValues.removeDefine(Scene3DShaderDeclaration.SHADERDEFINE_DIRECTIONLIGHT);\r\n            }\r\n\r\n            var poiCount: number = Stat.enableLight ? this._pointLights._length : 0;\r\n            if (poiCount > 0) {\r\n                var poiElements: PointLightCom[] = this._pointLights._elements;\r\n                var mainPointLightIndex: number = this._pointLights.getBrightestLight();\r\n                this._mainPointLight = poiElements[mainPointLightIndex];\r\n                this._pointLights.normalLightOrdering(mainPointLightIndex);\r\n                for (var i: number = 0; i < poiCount; i++, curCount++) {\r\n                    var poiLight: PointLightCom = poiElements[i];\r\n                    var pos: Vector3 = (poiLight.owner as Sprite3D).transform.position;\r\n                    var intCor: Vector3 = poiLight._intensityColor;\r\n                    var off: number = floatWidth * curCount;\r\n                    intCor.x = Color.gammaToLinearSpace(poiLight.color.r);\r\n                    intCor.y = Color.gammaToLinearSpace(poiLight.color.g);\r\n                    intCor.z = Color.gammaToLinearSpace(poiLight.color.b);\r\n                    Vector3.scale(intCor, poiLight._intensity, intCor);\r\n                    ligPix[off] = intCor.x;\r\n                    ligPix[off + 1] = intCor.y;\r\n                    ligPix[off + 2] = intCor.z;\r\n                    ligPix[off + 3] = poiLight.range;\r\n                    ligPix[off + 4] = pos.x;\r\n                    ligPix[off + 5] = pos.y;\r\n                    ligPix[off + 6] = pos.z;\r\n                    ligPix[off + 7] = poiLight._lightmapBakedType;//0: MIX  1:REALTIME\r\n                }\r\n                shaderValues.addDefine(Scene3DShaderDeclaration.SHADERDEFINE_POINTLIGHT);\r\n            }\r\n            else {\r\n                shaderValues.removeDefine(Scene3DShaderDeclaration.SHADERDEFINE_POINTLIGHT);\r\n            }\r\n\r\n            var spoCount: number = Stat.enableLight ? this._spotLights._length : 0;\r\n            if (spoCount > 0) {\r\n                var spoElements: SpotLightCom[] = this._spotLights._elements;\r\n                var mainSpotLightIndex: number = this._spotLights.getBrightestLight();\r\n                this._mainSpotLight = spoElements[mainSpotLightIndex];\r\n                this._spotLights.normalLightOrdering(mainSpotLightIndex)\r\n                for (var i: number = 0; i < spoCount; i++, curCount++) {\r\n                    var spoLight: SpotLightCom = spoElements[i];\r\n                    var dir: Vector3 = spoLight._direction;\r\n                    var pos: Vector3 = (spoLight.owner as Sprite3D).transform.position;\r\n                    var intCor: Vector3 = spoLight._intensityColor;\r\n                    var off: number = floatWidth * curCount;\r\n                    intCor.x = Color.gammaToLinearSpace(spoLight.color.r);\r\n                    intCor.y = Color.gammaToLinearSpace(spoLight.color.g);\r\n                    intCor.z = Color.gammaToLinearSpace(spoLight.color.b);\r\n                    Vector3.scale(intCor, spoLight._intensity, intCor);\r\n                    (spoLight.owner as Sprite3D).transform.worldMatrix.getForward(dir);\r\n                    Vector3.normalize(dir, dir);\r\n                    ligPix[off] = intCor.x;\r\n                    ligPix[off + 1] = intCor.y;\r\n                    ligPix[off + 2] = intCor.z;\r\n                    ligPix[off + 3] = spoLight.range;\r\n                    ligPix[off + 4] = pos.x;\r\n                    ligPix[off + 5] = pos.y;\r\n                    ligPix[off + 6] = pos.z;\r\n                    ligPix[off + 7] = spoLight.spotAngle * Math.PI / 180;\r\n                    ligPix[off + 8] = dir.x;\r\n                    ligPix[off + 9] = dir.y;\r\n                    ligPix[off + 10] = dir.z;\r\n                    ligPix[off + 11] = spoLight._lightmapBakedType;//0: MIX  1:REALTIME\r\n                }\r\n                shaderValues.addDefine(Scene3DShaderDeclaration.SHADERDEFINE_SPOTLIGHT);\r\n            }\r\n            else {\r\n                shaderValues.removeDefine(Scene3DShaderDeclaration.SHADERDEFINE_SPOTLIGHT);\r\n            }\r\n\r\n            (curCount > 0) && (ligTex.setSubPixelsData(0, 0, pixelWidth, curCount, ligPix, 0, false, false, false));\r\n            shaderValues.setTexture(Scene3D.LIGHTBUFFER, ligTex);\r\n            shaderValues.setInt(Scene3D.DIRECTIONLIGHTCOUNT, this._directionLights._length);\r\n            shaderValues.setTexture(Scene3D.CLUSTERBUFFER, Cluster.instance._clusterTexture);\r\n        }\r\n        else {\r\n            if (this._directionLights._length > 0 && Stat.enableLight) {\r\n                var dirLight: DirectionLightCom = this._directionLights._elements[0];\r\n                this._mainDirectionLight = dirLight;\r\n                dirLight._intensityColor.x = Color.gammaToLinearSpace(dirLight.color.r);\r\n                dirLight._intensityColor.y = Color.gammaToLinearSpace(dirLight.color.g);\r\n                dirLight._intensityColor.z = Color.gammaToLinearSpace(dirLight.color.b);\r\n                Vector3.scale(dirLight._intensityColor, dirLight._intensity, dirLight._intensityColor);\r\n\r\n                (dirLight.owner as Sprite3D).transform.worldMatrix.getForward(dirLight._direction);\r\n                Vector3.normalize(dirLight._direction, dirLight._direction);\r\n                shaderValues.setVector3(Scene3D.LIGHTDIRCOLOR, dirLight._intensityColor);\r\n                shaderValues.setVector3(Scene3D.LIGHTDIRECTION, dirLight._direction);\r\n                shaderValues.setInt(Scene3D.LIGHTMODE, dirLight._lightmapBakedType);\r\n                if (i == 0) {\r\n                    this._sunColor = dirLight.color;\r\n                    this._sundir = dirLight._direction;\r\n                }\r\n                // this._setShaderValue(Scene3D.SUNLIGHTDIRCOLOR, dirLight._intensityColor);\r\n                // this._setShaderValue(Scene3D.SUNLIGHTDIRECTION, dirLight._direction);\r\n                shaderValues.addDefine(Scene3DShaderDeclaration.SHADERDEFINE_DIRECTIONLIGHT);\r\n            }\r\n            else {\r\n                shaderValues.removeDefine(Scene3DShaderDeclaration.SHADERDEFINE_DIRECTIONLIGHT);\r\n            }\r\n            if (this._pointLights._length > 0 && Stat.enableLight) {\r\n                var poiLight: PointLightCom = this._pointLights._elements[0];\r\n                this._mainPointLight = poiLight;\r\n                poiLight._intensityColor.x = Color.gammaToLinearSpace(poiLight.color.r);\r\n                poiLight._intensityColor.y = Color.gammaToLinearSpace(poiLight.color.g);\r\n                poiLight._intensityColor.z = Color.gammaToLinearSpace(poiLight.color.b);\r\n                Vector3.scale(poiLight._intensityColor, poiLight._intensity, poiLight._intensityColor);\r\n                shaderValues.setVector3(Scene3D.POINTLIGHTCOLOR, poiLight._intensityColor);\r\n                shaderValues.setVector3(Scene3D.POINTLIGHTPOS, (poiLight.owner as Sprite3D).transform.position);\r\n                shaderValues.setNumber(Scene3D.POINTLIGHTRANGE, poiLight.range);\r\n                shaderValues.setInt(Scene3D.POINTLIGHTMODE, poiLight._lightmapBakedType);\r\n                shaderValues.addDefine(Scene3DShaderDeclaration.SHADERDEFINE_POINTLIGHT);\r\n            }\r\n            else {\r\n                shaderValues.removeDefine(Scene3DShaderDeclaration.SHADERDEFINE_POINTLIGHT);\r\n            }\r\n            if (this._spotLights._length > 0 && Stat.enableLight) {\r\n                var spotLight: SpotLightCom = this._spotLights._elements[0];\r\n                this._mainSpotLight = spotLight;\r\n                spotLight._intensityColor.x = Color.gammaToLinearSpace(spotLight.color.r);\r\n                spotLight._intensityColor.y = Color.gammaToLinearSpace(spotLight.color.g);\r\n                spotLight._intensityColor.z = Color.gammaToLinearSpace(spotLight.color.b);\r\n                Vector3.scale(spotLight._intensityColor, spotLight._intensity, spotLight._intensityColor);\r\n                shaderValues.setVector3(Scene3D.SPOTLIGHTCOLOR, spotLight._intensityColor);\r\n                shaderValues.setVector3(Scene3D.SPOTLIGHTPOS, (spotLight.owner as Sprite3D).transform.position);\r\n                (spotLight.owner as Sprite3D).transform.worldMatrix.getForward(spotLight._direction);\r\n                Vector3.normalize(spotLight._direction, spotLight._direction);\r\n                shaderValues.setVector3(Scene3D.SPOTLIGHTDIRECTION, spotLight._direction);\r\n                shaderValues.setNumber(Scene3D.SPOTLIGHTRANGE, spotLight.range);\r\n                shaderValues.setNumber(Scene3D.SPOTLIGHTSPOTANGLE, spotLight.spotAngle * Math.PI / 180);\r\n                shaderValues.setInt(Scene3D.SPOTLIGHTMODE, spotLight._lightmapBakedType);\r\n                shaderValues.addDefine(Scene3DShaderDeclaration.SHADERDEFINE_SPOTLIGHT);\r\n            }\r\n            else {\r\n                shaderValues.removeDefine(Scene3DShaderDeclaration.SHADERDEFINE_SPOTLIGHT);\r\n            }\r\n        }\r\n    }\r\n\r\n    private _cullInfoCamera: Camera\r\n    get cullInfoCamera(): Camera {\r\n        return this._cullInfoCamera;\r\n    }\r\n    /**\r\n     * scenceCamera,\r\n     * @param camera \r\n     */\r\n    _setCullCamera(camera: Camera) {\r\n        this._cullInfoCamera = camera;\r\n    }\r\n\r\n    /**\r\n     * CullCamera\r\n     */\r\n    recaculateCullCamera() {\r\n        this._cullInfoCamera = this._cameraPool[0] as Camera;\r\n        this._cameraPool.forEach(element => {\r\n            if (this.cullInfoCamera.maxlocalYDistance < (element as Camera).maxlocalYDistance) {\r\n                this._cullInfoCamera = element as Camera;\r\n            }\r\n        });\r\n    }\r\n\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    _addCamera(camera: BaseCamera): void {\r\n        var index: number = this._binarySearchIndexInCameraPool(camera);\r\n        var order: number = camera._renderingOrder;\r\n        var count: number = this._cameraPool.length;\r\n        while (index < count && this._cameraPool[index]._renderingOrder <= order)\r\n            index++;\r\n        this._cameraPool.splice(index, 0, camera);\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    _removeCamera(camera: BaseCamera): void {\r\n        this._cameraPool.splice(this._cameraPool.indexOf(camera), 1);\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    _preCulling(context: RenderContext3D, camera: Camera): void {\r\n        this._clearRenderQueue();\r\n        var cameraCullInfo: ICameraCullInfo = FrustumCulling._cameraCullInfo;\r\n        var cameraPos = cameraCullInfo.position = camera._transform.position;\r\n        cameraCullInfo.cullingMask = camera.cullingMask;\r\n        cameraCullInfo.staticMask = camera.staticMask;\r\n        cameraCullInfo.boundFrustum = camera.boundFrustum;\r\n        cameraCullInfo.useOcclusionCulling = camera.useOcclusionCulling;\r\n        this._cullPass.cullByCameraCullInfo(cameraCullInfo, this.sceneRenderableManager);\r\n        //addQueue\r\n        let list = this._cullPass.cullList;\r\n        let element = list.elements;\r\n        for (let i: number = 0; i < list.length; i++) {\r\n            let render = element[i];\r\n            render.distanceForSort = Vector3.distanceSquared(render.bounds.getCenter(), cameraPos);//TODO:,\r\n            var elements: RenderElement[] = render._renderElements;\r\n            for (var j: number = 0, m: number = elements.length; j < m; j++)\r\n                elements[j]._update(this, context, context.customShader, context.replaceTag);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     * @param cullInfo \r\n     * @param context \r\n     */\r\n    _directLightShadowCull(cullInfo: IShadowCullInfo, context: RenderContext3D) {\r\n        this._clearRenderQueue();\r\n        const position: Vector3 = cullInfo.position;\r\n        this._cullPass.cullByShadowCullInfo(cullInfo, this.sceneRenderableManager);\r\n        let list = this._cullPass.cullList;\r\n        let element = list.elements;\r\n        for (let i: number = 0; i < list.length; i++) {\r\n            let render = element[i];\r\n            render.distanceForSort = Vector3.distanceSquared(render.bounds.getCenter(), position);//TODO:,\r\n            var elements: RenderElement[] = render._renderElements;\r\n            for (var j: number = 0, m: number = elements.length; j < m; j++)\r\n                elements[j]._update(this, context, null, null);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     * @param cameraCullInfo \r\n     * @param context \r\n     */\r\n    _sportLightShadowCull(cameraCullInfo: ICameraCullInfo, context: RenderContext3D) {\r\n        this._clearRenderQueue();\r\n        this._cullPass.cullingSpotShadow(cameraCullInfo, this.sceneRenderableManager);\r\n        let list = this._cullPass.cullList;\r\n        let element = list.elements;\r\n        for (var i: number = 0, n: number = list.length; i < n; i++) {\r\n            var render = element[i];\r\n            render.distanceForSort = Vector3.distanceSquared(render.bounds.getCenter(), cameraCullInfo.position);\r\n            var elements: RenderElement[] = render._renderElements;\r\n            for (var j: number = 0, m: number = elements.length; j < m; j++)\r\n                elements[j]._update(this, context, null, null);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    _clear(state: RenderContext3D): void {\r\n        var viewport: Viewport = state.viewport;\r\n        var camera: Camera = <Camera>state.camera;\r\n        var renderTex: RenderTexture = camera._getRenderTexture();\r\n        var vpX: number, vpY: number;\r\n        var vpW: number = viewport.width;\r\n        var vpH: number = viewport.height;\r\n        let needInternalRT = camera._needInternalRenderTexture();\r\n\r\n        if (needInternalRT) {\r\n            vpX = 0;\r\n            vpY = 0;\r\n        }\r\n        else {\r\n            if (camera.renderTarget) {\r\n                vpX = viewport.x;\r\n                vpY = viewport.y;\r\n            }\r\n            else {\r\n                vpX = viewport.x;\r\n                vpY = camera._getCanvasHeight() - viewport.y - vpH;\r\n            }\r\n        }\r\n\r\n        LayaGL.renderEngine.viewport(vpX, vpY, vpW, vpH);\r\n        LayaGL.renderEngine.scissor(vpX, vpY, vpW, vpH);\r\n        state.changeViewport(vpX, vpY, vpW, vpH);\r\n        state.changeScissor(vpX, vpY, vpW, vpH);\r\n        Camera._context3DViewPortCatch.set(vpX, vpY, vpW, vpH);\r\n        Camera._contextScissorPortCatch.setValue(vpX, vpY, vpW, vpH);\r\n\r\n        var clearFlag: number = camera.clearFlag;\r\n        if (clearFlag === CameraClearFlags.Sky && !(camera.skyRenderer._isAvailable() || this._skyRenderer._isAvailable()))\r\n            clearFlag = CameraClearFlags.SolidColor;\r\n        let clearConst: number = 0;\r\n        let stencilFlag = renderTex.depthStencilFormat == RenderTargetFormat.DEPTHSTENCIL_24_8 ? RenderClearFlag.Stencil : 0;\r\n        switch (clearFlag) {\r\n            case CameraClearFlags.SolidColor:\r\n                clearConst = RenderClearFlag.Color | RenderClearFlag.Depth | stencilFlag;\r\n                break;\r\n            case CameraClearFlags.DepthOnly:\r\n            case CameraClearFlags.Sky:\r\n                clearConst = RenderClearFlag.Depth | stencilFlag;\r\n                break;\r\n            case CameraClearFlags.Nothing:\r\n                clearConst = 0;\r\n                break;\r\n            case CameraClearFlags.ColorOnly:\r\n                clearConst = RenderClearFlag.Color;\r\n                break;\r\n        }\r\n\r\n        // todo other color gamut\r\n        let clearColor = camera._linearClearColor;\r\n        if (renderTex.gammaCorrection != 1) {\r\n            clearColor = camera.clearColor;\r\n        }\r\n\r\n        LayaGL.renderEngine.clearRenderTexture(clearConst, clearColor, 1);\r\n    }\r\n\r\n    /**\r\n     * @internal Scene\r\n     */\r\n    _renderScene(context: RenderContext3D, renderFlag: number): void {\r\n        var camera: Camera = <Camera>context.camera;\r\n        switch (renderFlag) {\r\n            case Scene3D.SCENERENDERFLAG_RENDERQPAQUE:\r\n                Stat.opaqueDrawCall += this._opaqueQueue.renderQueue(context);\r\n                break;\r\n            case Scene3D.SCENERENDERFLAG_SKYBOX:\r\n                if (camera.clearFlag === CameraClearFlags.Sky) {\r\n                    if (camera.skyRenderer._isAvailable())\r\n                        camera.skyRenderer._render(context);\r\n                    else if (this._skyRenderer._isAvailable())\r\n                        this._skyRenderer._render(context);\r\n                }\r\n                break;\r\n            case Scene3D.SCENERENDERFLAG_RENDERTRANSPARENT:\r\n                Stat.transDrawCall += this._transparentQueue.renderQueue(context);\r\n                if (Config3D.debugFrustumCulling) {\r\n                    // var renderElements: RenderElement[] = this._debugTool._render._renderElements;\r\n                    // for (var i: number = 0, n: number = renderElements.length; i < n; i++) {\r\n                    //     context.drawRenderElement(renderElements[i]);\r\n                    // }\r\n                }\r\n                break;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * @inheritDoc\r\n     * @override\r\n     * @internal\r\n     */\r\n    _parse(data: any, spriteMap: any): void {\r\n        var lightMapsData: any[] = data.lightmaps;\r\n        if (lightMapsData) {\r\n            var lightMapCount: number = lightMapsData.length;\r\n            var lightmaps: Lightmap[] = new Array(lightMapCount);\r\n            for (var i: number = 0; i < lightMapCount; i++) {\r\n                var lightMap: Lightmap = new Lightmap();\r\n                var lightMapData: any = lightMapsData[i];\r\n                if (lightMapData.path) {//\r\n                    lightMap.lightmapColor = Loader.getTexture2D(lightMapData.path);\r\n                }\r\n                else {\r\n                    lightMap.lightmapColor = Loader.getTexture2D(lightMapData.color.path);\r\n                    if (lightMapData.direction)\r\n                        lightMap.lightmapDirection = Loader.getTexture2D(lightMapData.direction.path);\r\n                }\r\n                lightmaps[i] = lightMap;\r\n            }\r\n            this.lightmaps = lightmaps;\r\n        }\r\n        var skyData: any = data.sky;\r\n        if (skyData) {\r\n            this._skyRenderer.material = Loader.getRes(skyData.material.path);\r\n            switch (skyData.mesh) {\r\n                case \"SkyBox\":\r\n                    this._skyRenderer.mesh = SkyBox.instance;\r\n                    break;\r\n                case \"SkyDome\":\r\n                    this._skyRenderer.mesh = SkyDome.instance;\r\n                    break;\r\n                default:\r\n                    this.skyRenderer.mesh = SkyBox.instance;\r\n            }\r\n        }\r\n        this.enableFog = data.enableFog;\r\n        this.fogStart = data.fogStart;\r\n        this.fogRange = data.fogRange;\r\n        var fogColorData: any[] = data.fogColor;\r\n        if (fogColorData) {\r\n            var fogCol: Color = this.fogColor;\r\n            fogCol.fromArray(fogColorData);\r\n            this.fogColor = fogCol;\r\n        }\r\n        //  \r\n        var ambientModeData: AmbientMode = data.ambientMode;\r\n        // \r\n        var ambientColorData: any[] = data.ambientColor;\r\n        if (ambientColorData) {\r\n            var ambCol: Color = this.ambientColor;\r\n            ambCol.fromArray(ambientColorData);\r\n            this.ambientColor = ambCol;\r\n        }\r\n        if (ambientModeData == AmbientMode.TripleColor) {\r\n            // \r\n            let ambientSkyColor: number[] = data.ambientSkyColor;\r\n            let tempV3sky = new Vector3();\r\n            tempV3sky.fromArray(ambientSkyColor);\r\n\r\n            let ambientEquatorColor: number[] = data.ambientEquatorColor;\r\n            let tempV3Equaltor = new Vector3();\r\n            tempV3Equaltor.fromArray(ambientEquatorColor);\r\n\r\n            let ambientGroundColor: number[] = data.ambientGroundColor;\r\n            let tempV3Ground = new Vector3();\r\n            tempV3Ground.fromArray(ambientGroundColor);\r\n\r\n            this._sceneReflectionProb.setGradientAmbient(tempV3sky, tempV3Equaltor, tempV3Ground);\r\n        }\r\n        // skybox\r\n        var ambientSphericalHarmonicsData: Array<number> = data.ambientSphericalHarmonics;\r\n        if (ambientSphericalHarmonicsData) {\r\n            var ambientSH: SphericalHarmonicsL2 = new SphericalHarmonicsL2();\r\n            for (var i: number = 0; i < 3; i++) {\r\n                var off: number = i * 9;\r\n                ambientSH.setCoefficients(i, ambientSphericalHarmonicsData[off], ambientSphericalHarmonicsData[off + 1], ambientSphericalHarmonicsData[off + 2], ambientSphericalHarmonicsData[off + 3], ambientSphericalHarmonicsData[off + 4], ambientSphericalHarmonicsData[off + 5], ambientSphericalHarmonicsData[off + 6], ambientSphericalHarmonicsData[off + 7], ambientSphericalHarmonicsData[off + 8]);\r\n            }\r\n            this._sceneReflectionProb.ambientSphericalHarmonics = ambientSH;\r\n        }\r\n        (ambientModeData != undefined) && (this.ambientMode = ambientModeData);\r\n        var reflectionData: string = data.reflection;\r\n        (reflectionData != undefined) && (this._sceneReflectionProb.reflectionTexture = Loader.getRes(reflectionData));\r\n        var reflectionDecodingFormatData: number = data.reflectionDecodingFormat;\r\n        (reflectionDecodingFormatData != undefined) && (this._sceneReflectionProb.reflectionDecodingFormat = reflectionDecodingFormatData);\r\n        var ambientSphericalHarmonicsIntensityData: number = data.ambientSphericalHarmonicsIntensity;\r\n        (ambientSphericalHarmonicsIntensityData != undefined) && (this._sceneReflectionProb.ambientIntensity = ambientSphericalHarmonicsIntensityData);\r\n        var reflectionIntensityData: number = data.reflectionIntensity;\r\n        (reflectionIntensityData != undefined) && (this._sceneReflectionProb.reflectionIntensity = reflectionIntensityData);\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    _addRenderObject(render: any): void {\r\n        // if (this._octree && render._supportOctree) {\r\n        // \tthis._octree.addRender(render);\r\n        // } else {\r\n        //this._renders.add(render);\r\n        this._sceneRenderManager.addRenderObject(render);\r\n        // }\r\n        render._addReflectionProbeUpdate();\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    _removeRenderObject(render: any): void {\r\n        // if (this._octree && render._supportOctree) {\r\n        // \tthis._octree.removeRender(render);\r\n        // } else {\r\n        this._sceneRenderManager.removeRenderObject(render);\r\n        //this._renders.remove(render);\r\n        // }\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    _getRenderQueue(index: number): IRenderQueue {\r\n        if (index <= 2500)//2500\r\n            return this._opaqueQueue;\r\n        else\r\n            return this._transparentQueue;\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    _clearRenderQueue(): void {\r\n        this._opaqueQueue.clear();\r\n        this._transparentQueue.clear();\r\n    }\r\n\r\n    /**\r\n     * @inheritDoc\r\n     * @override\r\n     * \r\n     */\r\n    destroy(destroyChild: boolean = true): void {\r\n        if (this._destroyed)\r\n            return;\r\n        super.destroy(destroyChild);\r\n        this._nativeObj = null;\r\n        this._skyRenderer.destroy();\r\n        this._skyRenderer = null;\r\n        this._directionLights = null;\r\n        this._pointLights = null;\r\n        this._spotLights = null;\r\n        this._alternateLights = null;\r\n        this._shaderValues.destroy();\r\n        this._opaqueQueue.destroy();\r\n        this._transparentQueue.destroy();\r\n        (RenderContext3D._instance.scene == this) && (RenderContext3D._instance.scene = null);\r\n        this._shaderValues = null;\r\n        this.sceneRenderableManager.destroy();\r\n        this._sceneRenderManager = null\r\n        this._cameraPool = null;\r\n        // this._octree = null;\r\n        this._physicsManager && this._physicsManager.destroy();\r\n        // this._reflection._removeReference();\r\n        // this._reflection = null;\r\n        var maps: Lightmap[] = this._lightmaps;\r\n        if (maps) {\r\n            for (var i: number = 0, n: number = maps.length; i < n; i++) {\r\n                var map: Lightmap = maps[i];\r\n                map.lightmapColor && map.lightmapColor._removeReference();\r\n                map.lightmapDirection && map.lightmapDirection._removeReference();\r\n            }\r\n        }\r\n        //this._sceneUniformData.destroy();\r\n        this._lightmaps = null;\r\n        this._volumeManager.destroy();\r\n        this._componentDriver.callDestroy();\r\n\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @param type \r\n     */\r\n    getComponentElementManager(type: string) {\r\n        return this.componentElementMap.get(type);\r\n    }\r\n\r\n    /**\r\n     * @inheritDoc\r\n     * @override\r\n     * @internal\r\n     */\r\n    render(ctx: Context): void {\r\n        if (this._children.length > 0) {\r\n            ctx.addRenderObject3D(this);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * \r\n     */\r\n    renderSubmit(): number {\r\n        if (this._renderByEditor) return 1;\r\n        BufferState._curBindedBufferState && BufferState._curBindedBufferState.unBind();\r\n        this._prepareSceneToRender();\r\n        var i: number, n: number, n1: number;\r\n        Scene3D._updateMark++;\r\n        // if (this._sceneUniformData) {\r\n        // \tthis._sceneUniformObj && this._sceneUniformObj.setDataByUniformBufferData(this._sceneUniformData);\r\n        // }\r\n        for (i = 0, n = this._cameraPool.length, n1 = n - 1; i < n; i++) {\r\n            // if (Render.supportWebGLPlusRendering)\r\n            // \tShaderData.setRuntimeValueMode((i == n1) ? true : false);\r\n\r\n            var camera: Camera = (<Camera>this._cameraPool[i]);\r\n            if (camera.renderTarget)\r\n                (camera.enableBuiltInRenderTexture = false);//TODO:\r\n            else\r\n                camera.enableBuiltInRenderTexture = true;\r\n\r\n            camera.enableRender && camera.render();\r\n            Scene3D._blitTransRT = null;\r\n\r\n            if (camera.enableRender && !camera.renderTarget) {\r\n                (Scene3D._blitTransRT = camera._internalRenderTexture);\r\n                var canvasWidth: number = camera._getCanvasWidth(), canvasHeight: number = camera._getCanvasHeight();\r\n                Scene3D._blitOffset.setValue(camera.viewport.x / canvasWidth, camera.viewport.y / canvasHeight, camera.viewport.width / canvasWidth, camera.viewport.height / canvasHeight);\r\n                this.blitMainCanvans(Scene3D._blitTransRT, camera.normalizedViewport, camera);\r\n            }\r\n            if (!camera._cacheDepth) {\r\n                camera.enableRender && camera._needInternalRenderTexture() && (!camera._internalRenderTexture._inPool) && RenderTexture.recoverToPool(camera._internalRenderTexture);\r\n            }\r\n\r\n        }\r\n        Context.set2DRenderConfig();//2D\r\n        RenderTexture.clearPool();\r\n        return 1;\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     * @param source \r\n     * @param normalizeViewPort \r\n     * @param camera \r\n     * @returns \r\n     */\r\n    blitMainCanvans(source: BaseTexture, normalizeViewPort: Viewport, camera: Camera) {\r\n        if (!source)\r\n            return;\r\n        Scene3D.mainCavansViewPort.x = RenderContext3D.clientWidth * normalizeViewPort.x | 0;\r\n        Scene3D.mainCavansViewPort.y = RenderContext3D.clientHeight * normalizeViewPort.y | 0;\r\n        Scene3D.mainCavansViewPort.width = RenderContext3D.clientWidth * normalizeViewPort.width | 0;\r\n        Scene3D.mainCavansViewPort.height = RenderContext3D.clientHeight * normalizeViewPort.height | 0;\r\n        source.filterMode = FilterMode.Bilinear;\r\n        if (camera.fxaa)\r\n            BlitFrameBufferCMD.shaderdata.addDefine(BaseCamera.SHADERDEFINE_FXAA);\r\n        var cmd = BlitFrameBufferCMD.create(source, null, Scene3D.mainCavansViewPort, null, null, BlitFrameBufferCMD.shaderdata);\r\n        cmd.run();\r\n        cmd.recover();\r\n        BlitFrameBufferCMD.shaderdata.removeDefine(BaseCamera.SHADERDEFINE_FXAA);\r\n    }\r\n\r\n    /**\r\n     * \r\n     */\r\n    getRenderType(): number {\r\n        return 0;\r\n    }\r\n\r\n    /**\r\n     * \r\n     */\r\n    releaseRender(): void {\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    reUse(context: Context, pos: number): number {\r\n        return 0;\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @param name \r\n     * @param shaderDataType \r\n     * @param value \r\n     */\r\n    setGlobalShaderValue(name: string, type: ShaderDataType, value: ShaderDataItem) {\r\n        var shaderOffset = Shader3D.propertyNameToID(name);\r\n        this._shaderValues.setShaderData(shaderOffset, type, value);\r\n    }\r\n    //--------------------------------------------------------deprecated------------------------------------------------------------------------\r\n\r\n    /**\r\n     * @deprecated\r\n     */\r\n    get fogRange(): number {\r\n        return this._fogParams.y - this.fogParams.x;\r\n    }\r\n\r\n    set fogRange(value: number) {\r\n        this._fogParams.y = value + this.fogParams.x;\r\n        this.fogParams = this._fogParams;\r\n    }\r\n\r\n    /**\r\n     * @deprecated\r\n     * \r\n     * @param value \r\n     */\r\n    setlightmaps(value: Texture2D[]): void {\r\n        var maps: Lightmap[] = this._lightmaps;\r\n        for (var i: number = 0, n: number = maps.length; i < n; i++)\r\n            maps[i].lightmapColor._removeReference();\r\n        if (value) {\r\n            var count: number = value.length;\r\n            maps.length = count;\r\n            for (i = 0; i < count; i++) {\r\n                var lightMap: Texture2D = value[i];\r\n                lightMap._addReference();\r\n                (maps[i]) || (maps[i] = new Lightmap());\r\n                maps[i].lightmapColor = lightMap;\r\n            }\r\n        } else {\r\n            throw new Error(\"Scene3D: value value can't be null.\");\r\n        }\r\n    }\r\n\r\n    /**\r\n     * @deprecated\r\n     * \r\n     * @return \r\n     */\r\n    getlightmaps(): Texture2D[] {\r\n        var lightmapColors: Texture2D[] = new Array(this._lightmaps.length);\r\n        for (var i: number = 0; i < this._lightmaps.length; i++) {\r\n            lightmapColors[i] = this._lightmaps[i].lightmapColor;\r\n        }\r\n        return lightmapColors;//slice()\r\n    }\r\n}","\r\nimport { Config3D } from \"../../../Config3D\";\r\nimport { ILaya3D } from \"../../../ILaya3D\";\r\nimport { Node } from \"../../display/Node\";\r\nimport { Event } from \"../../events/Event\";\r\nimport { BaseTexture } from \"../../resource/BaseTexture\";\r\nimport { PostProcess } from \"../component/PostProcess\";\r\nimport { DepthPass, DepthTextureMode } from \"../depthMap/DepthPass\";\r\nimport { Cluster } from \"../graphics/renderPath/Cluster\";\r\nimport { BoundFrustum } from \"../math/BoundFrustum\";\r\nimport { Ray } from \"../math/Ray\";\r\nimport { Viewport } from \"../math/Viewport\";\r\nimport { Picker } from \"../utils/Picker\";\r\nimport { BaseCamera } from \"./BaseCamera\";\r\nimport { DirectionLightCom } from \"./light/DirectionLightCom\";\r\nimport { ShadowMode } from \"./light/ShadowMode\";\r\nimport { ShadowUtils } from \"./light/ShadowUtils\";\r\nimport { BlitScreenQuadCMD } from \"./render/command/BlitScreenQuadCMD\";\r\nimport { CommandBuffer } from \"./render/command/CommandBuffer\";\r\nimport { RenderContext3D } from \"./render/RenderContext3D\";\r\nimport { Scene3D } from \"./scene/Scene3D\";\r\nimport { Scene3DShaderDeclaration } from \"./scene/Scene3DShaderDeclaration\";\r\nimport { Transform3D } from \"./Transform3D\";\r\nimport { FilterMode } from \"../../RenderEngine/RenderEnum/FilterMode\";\r\nimport { RenderTargetFormat } from \"../../RenderEngine/RenderEnum/RenderTargetFormat\";\r\nimport { RenderCapable } from \"../../RenderEngine/RenderEnum/RenderCapable\";\r\nimport { Shader3D } from \"../../RenderEngine/RenderShader/Shader3D\";\r\nimport { ILaya } from \"../../../ILaya\";\r\nimport { ShadowLightType } from \"../shadowMap/ShadowLightType\";\r\nimport { TextureCube } from \"../../resource/TextureCube\";\r\nimport { TextureFormat } from \"../../RenderEngine/RenderEnum/TextureFormat\";\r\nimport { Texture2D } from \"../../resource/Texture2D\";\r\nimport { Matrix4x4 } from \"../../maths/Matrix4x4\";\r\nimport { Quaternion } from \"../../maths/Quaternion\";\r\nimport { Vector2 } from \"../../maths/Vector2\";\r\nimport { Vector3 } from \"../../maths/Vector3\";\r\nimport { Vector4 } from \"../../maths/Vector4\";\r\nimport { RenderTexture } from \"../../resource/RenderTexture\";\r\nimport { Stat } from \"../../utils/Stat\";\r\nimport { WrapMode } from \"../../RenderEngine/RenderEnum/WrapMode\";\r\nimport { LayaGL } from \"../../layagl/LayaGL\";\r\n\r\n/**\r\n * \r\n */\r\nexport enum CameraClearFlags {\r\n    /***/\r\n    SolidColor,\r\n    /***/\r\n    Sky,\r\n    /***/\r\n    DepthOnly,\r\n    /***/\r\n    Nothing,\r\n    /** */\r\n    ColorOnly,\r\n}\r\n\r\n/**\r\n * \r\n */\r\nexport enum CameraEventFlags {\r\n    //BeforeDepthTexture,\r\n    //AfterDepthTexture,\r\n    //BeforeDepthNormalsTexture,\r\n    //AfterDepthNormalTexture,\r\n    /***/\r\n    BeforeForwardOpaque = 0,\r\n    /***/\r\n    BeforeSkyBox = 2,\r\n    /***/\r\n    BeforeTransparent = 4,\r\n    /***/\r\n    BeforeImageEffect = 6,\r\n    /***/\r\n    AfterEveryThing = 8,\r\n}\r\n\r\n/**\r\n * <code>Camera</code> \r\n */\r\nexport class Camera extends BaseCamera {\r\n    /** @internal */\r\n    static _tempVector20: Vector2 = new Vector2();\r\n    /** @internal*/\r\n    static _context3DViewPortCatch: Viewport = new Viewport(0, 0, 0, 0);\r\n    static _contextScissorPortCatch: Vector4 = new Vector4(0, 0, 0, 0);\r\n\r\n    /** @internal */\r\n    static __updateMark: number = 0;\r\n    static set _updateMark(value: number) {\r\n        Camera.__updateMark = value;\r\n    }\r\n\r\n    static get _updateMark(): number {\r\n        return Camera.__updateMark;\r\n    }\r\n\r\n    /** @internal */\r\n    static depthPass: DepthPass;\r\n\r\n    /**\r\n     * scenescene\r\n     * @param camera \r\n     * @param scene \r\n     * @param shader \r\n     * @param replacementTag \r\n     */\r\n    static drawRenderTextureByScene(camera: Camera, scene: Scene3D, renderTexture: RenderTexture, shader: Shader3D = null, replaceFlag: string = null): RenderTexture {\r\n        if (!renderTexture) return null;\r\n        Scene3D._updateMark++;\r\n\r\n        if (!scene.parent)\r\n            scene._update();\r\n\r\n        //@ts-ignore\r\n        scene._prepareSceneToRender();\r\n        scene._setCullCamera(camera);\r\n        let recoverTexture = camera.renderTarget;\r\n        camera.renderTarget = renderTexture;\r\n\r\n        var viewport: Viewport = camera.viewport;\r\n        var needInternalRT: boolean = camera._needInternalRenderTexture();\r\n        var context: RenderContext3D = RenderContext3D._instance;\r\n        var scene: Scene3D = context.scene = scene\r\n        context.pipelineMode = context.configPipeLineMode;\r\n        context.replaceTag = replaceFlag;\r\n        context.customShader = shader;\r\n\r\n        if (needInternalRT) {\r\n            camera._internalRenderTexture = RenderTexture.createFromPool(viewport.width, viewport.height, camera._getRenderTextureFormat(), camera.depthTextureFormat, false, camera.msaa ? 4 : 1, false, camera._needRenderGamma(camera._getRenderTextureFormat()));\r\n            camera._internalRenderTexture.filterMode = FilterMode.Bilinear;\r\n        }\r\n        else {\r\n            camera._internalRenderTexture = null;\r\n        }\r\n        scene._componentDriver.callPreRender();\r\n        var needShadowCasterPass: boolean = camera._renderShadowMap(scene, context);\r\n        camera._preRenderMainPass(context, scene, needInternalRT, viewport);\r\n        camera._renderMainPass(context, viewport, scene, shader, replaceFlag, needInternalRT);\r\n        camera._aftRenderMainPass(needShadowCasterPass);\r\n        camera.renderTarget = recoverTexture;\r\n        scene.recaculateCullCamera();\r\n        scene._componentDriver.callPostRender();\r\n        if (camera._internalRenderTexture)\r\n            (!camera._internalRenderTexture._inPool) && RenderTexture.recoverToPool(camera._internalRenderTexture);\r\n        return renderTexture;\r\n    }\r\n\r\n    /**\r\n     * get PixelTexture\r\n     * @param texture \r\n     * @returns \r\n     */\r\n    static getTexturePixel(texture: Texture2D): ArrayBufferView {\r\n        let coverFilter = texture.filterMode;\r\n        texture.filterMode = FilterMode.Point;\r\n        let rtFormat = RenderTargetFormat.R8G8B8;\r\n        let pixelData;\r\n        let size = texture.width * texture.height;\r\n        switch (texture.format) {\r\n            case TextureFormat.R32G32B32A32:\r\n            case TextureFormat.R16G16B16A16:\r\n                rtFormat = RenderTargetFormat.R32G32B32A32;\r\n                pixelData = new Float32Array(size * 4);\r\n                break;\r\n            case TextureFormat.R32G32B32:\r\n            case TextureFormat.R16G16B16:\r\n                rtFormat = RenderTargetFormat.R32G32B32;\r\n                pixelData = new Float32Array(size * 3);\r\n                break;\r\n            case TextureFormat.R5G6B5:\r\n            case TextureFormat.R8G8B8:\r\n                rtFormat = RenderTargetFormat.R8G8B8;\r\n                pixelData = new Uint8Array(size * 3);\r\n                break;\r\n            default:\r\n                rtFormat = RenderTargetFormat.R8G8B8A8;\r\n                pixelData = new Uint8Array(size * 4);\r\n                break;\r\n        }\r\n        let rt = new RenderTexture(texture.width, texture.height, rtFormat, RenderTargetFormat.None, false, 0, false);\r\n        var blit: BlitScreenQuadCMD = BlitScreenQuadCMD.create(texture, rt);\r\n        blit.setContext(RenderContext3D._instance);\r\n        blit.run();\r\n        blit.recover();\r\n        texture.filterMode = coverFilter;\r\n        rt.getData(0, 0, texture.width, texture.height, pixelData);\r\n        rt.destroy();//\r\n        return pixelData;\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @param position \r\n     * @param scene \r\n     * @param renderCubeSize \r\n     * @param format \r\n     * @returns bake front left right up down\r\n     */\r\n    static drawTextureCubePixelByScene(camera: Camera, scene: Scene3D, renderCubeSize: number, format: TextureFormat, cullingMask: number): ArrayBufferView[] {\r\n        let rtFormat = RenderTargetFormat.R8G8B8;\r\n        let pixelData;\r\n        let size = renderCubeSize * renderCubeSize;\r\n        let bytelength;\r\n        switch (format) {\r\n            case TextureFormat.R32G32B32A32:\r\n            case TextureFormat.R16G16B16A16:\r\n                rtFormat = RenderTargetFormat.R32G32B32A32;\r\n                size *= 4;\r\n                bytelength = 4;\r\n                break;\r\n            case TextureFormat.R32G32B32:\r\n            case TextureFormat.R16G16B16:\r\n                rtFormat = RenderTargetFormat.R32G32B32;\r\n                size *= 3;\r\n                bytelength = 4;\r\n                break;\r\n            case TextureFormat.R5G6B5:\r\n            case TextureFormat.R8G8B8:\r\n                rtFormat = RenderTargetFormat.R8G8B8;\r\n                size *= 3;\r\n                bytelength = 1;\r\n                break;\r\n            case TextureFormat.R8G8B8A8:\r\n                rtFormat = RenderTargetFormat.R8G8B8A8;\r\n                pixelData = new Uint8Array(size * 4);\r\n                size *= 4;\r\n                bytelength = 1;\r\n                break;\r\n            default:\r\n                throw \"Type is not supported\";\r\n                break;\r\n        }\r\n        let rt = new RenderTexture(renderCubeSize, renderCubeSize, rtFormat, RenderTargetFormat.DEPTH_16, false, 0, false, false);\r\n        camera.fieldOfView = 90;\r\n        camera.cullingMask = cullingMask;\r\n        // bake 0,1,0,0\r\n        //front 0,0,0,1\r\n        //left 0,0.7071068,0,0.7071068\r\n        //right 0,0.7071068,0,-0.7071068\r\n        //up 0,0.7071068,-0.7071068,0\r\n        //down 0,-0.7071068,-0.7071068,0\r\n        let pixels: ArrayBufferView[] = [];\r\n        let quaterionArray = [\r\n            new Quaternion(0, 1, 0, 0),\r\n            new Quaternion(0, 0, 0, 1),\r\n            new Quaternion(0, 0.7071068, 0, 0.7071068),\r\n            new Quaternion(0, 0.7071068, 0, -0.7071068),\r\n            new Quaternion(0, 0.7071068, -0.7071068, 0),\r\n            new Quaternion(0, -0.7071068, -0.7071068, 0),\r\n        ];\r\n        for (var i = 0; i < 6; i++) {\r\n            camera.transform.rotation = quaterionArray[i];\r\n            this.drawRenderTextureByScene(camera, scene, rt);\r\n            if (bytelength == 4)\r\n                pixelData = new Float32Array(size);\r\n            else\r\n                pixelData = new Uint8Array(size);\r\n            pixels[i] = rt.getData(0, 0, renderCubeSize, renderCubeSize, pixelData);\r\n        }\r\n        rt.destroy();\r\n        return pixels;\r\n    }\r\n\r\n    static drawTextureCubeByScene(camera: Camera, position: Vector3, scene: Scene3D, renderCubeSize: number, format: TextureFormat, cullingMask: number = 0): TextureCube {\r\n        camera.transform.position = position;\r\n        let pixels = this.drawTextureCubePixelByScene(camera, scene, renderCubeSize, format, cullingMask);\r\n        let finalformat: TextureFormat;\r\n        switch (format) {\r\n            case TextureFormat.R32G32B32A32:\r\n            case TextureFormat.R16G16B16A16:\r\n                finalformat = TextureFormat.R32G32B32A32;\r\n                break;\r\n            case TextureFormat.R32G32B32:\r\n            case TextureFormat.R16G16B16:\r\n                finalformat = TextureFormat.R32G32B32;\r\n                break;\r\n            case TextureFormat.R5G6B5:\r\n            case TextureFormat.R8G8B8:\r\n                finalformat = TextureFormat.R8G8B8;\r\n                break;\r\n            case TextureFormat.R8G8B8A8:\r\n                finalformat = TextureFormat.R8G8B8A8;\r\n                break;\r\n            default:\r\n                throw \"Type is not supported\";\r\n        }\r\n        let textureCube = new TextureCube(renderCubeSize, format, true, false);\r\n        textureCube.setPixelsData(pixels, false, false);\r\n        return textureCube;\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    static __init__(): void {\r\n        Camera.depthPass = new DepthPass();\r\n    }\r\n\r\n\r\n    /** @internal */\r\n    protected _aspectRatio: number;\r\n    /** @internal */\r\n    protected _viewport: Viewport;\r\n    /** @internal */\r\n    protected _rayViewport: Viewport;\r\n    /** @internal */\r\n    protected _normalizedViewport: Viewport;\r\n    /** @internal */\r\n    protected _viewMatrix: Matrix4x4;\r\n    /** @internal */\r\n    protected _projectionMatrix: Matrix4x4;\r\n    /** @internal */\r\n    protected _projectionViewMatrix: Matrix4x4;\r\n    /** @internal */\r\n    protected _boundFrustum: BoundFrustum;\r\n    /** @internal */\r\n    private _updateViewMatrix: boolean = true;\r\n    /** @internal */\r\n    protected _postProcess: PostProcess = null;\r\n    /** @internal */\r\n    protected _enableHDR: boolean = false;\r\n    /** @internal */\r\n    private _viewportParams: Vector4 = new Vector4();\r\n    /** @internal */\r\n    private _projectionParams: Vector4 = new Vector4();\r\n    /** @internal*/\r\n    protected _needBuiltInRenderTexture: boolean = false;\r\n    /**@internal */\r\n    protected _msaa: boolean = false;\r\n    /**@internal */\r\n    private _fxaa: boolean = false;\r\n    /** @internal*/\r\n    private _depthTextureMode: DepthTextureMode;\r\n    /** @internal */\r\n    _offScreenRenderTexture: RenderTexture = null;\r\n    /** @internal */\r\n    _internalRenderTexture: RenderTexture = null;\r\n    /** @internal*/\r\n    _canBlitDepth: boolean = false;\r\n    /**@internal */\r\n    _internalCommandBuffer: CommandBuffer = new CommandBuffer();\r\n    /** */\r\n    protected _depthTextureFormat: RenderTargetFormat = RenderTargetFormat.DEPTH_16;\r\n    /** */\r\n    private _depthTexture: BaseTexture;\r\n    /** */\r\n    private _depthNormalsTexture: RenderTexture;\r\n\r\n    /**  */\r\n    private _opaqueTexture: RenderTexture;\r\n    /**  */\r\n    private _opaquePass: boolean;\r\n\r\n\r\n    private _cameraEventCommandBuffer: { [key: string]: CommandBuffer[] } = {};\r\n    /**@internal CommanBuffer */\r\n    private _shadowCasterCommanBuffer: CommandBuffer[] = [];\r\n\r\n    /** @internal */\r\n    _clusterXPlanes: Vector3[];\r\n    /** @internal */\r\n    _clusterYPlanes: Vector3[];\r\n    /** @internal */\r\n    _clusterPlaneCacheFlag: Vector2 = new Vector2(-1, -1);\r\n    /** @internal */\r\n    _screenOffsetScale: Vector4 = new Vector4();\r\n\r\n    /***/\r\n    enableRender: boolean = true;\r\n    /***/\r\n    clearFlag: CameraClearFlags = CameraClearFlags.SolidColor;\r\n    /**Depth */\r\n    _cacheDepth: boolean\r\n    /**cache  */\r\n    _cacheDepthTexture: RenderTexture;\r\n\r\n    /**\r\n     * \r\n     */\r\n    get aspectRatio(): number {\r\n        if (this._aspectRatio === 0) {\r\n            var vp: Viewport = this.viewport;\r\n            return vp.width / vp.height;\r\n        }\r\n        return this._aspectRatio;\r\n    }\r\n\r\n    set aspectRatio(value: number) {\r\n        if (value < 0)\r\n            throw new Error(\"Camera: the aspect ratio has to be a positive real number.\");\r\n        this._aspectRatio = value;\r\n        this._calculateProjectionMatrix();\r\n    }\r\n\r\n    /**\r\n     * \r\n     */\r\n    get viewport(): Viewport {//TODO:\r\n        if (this._offScreenRenderTexture)\r\n            this._calculationViewport(this._normalizedViewport, this._offScreenRenderTexture.width, this._offScreenRenderTexture.height);\r\n        else\r\n            this._calculationViewport(this._normalizedViewport, this.clientWidth, this.clientHeight);//,\r\n        return this._viewport;\r\n    }\r\n\r\n    set viewport(value: Viewport) {\r\n        var width: number;\r\n        var height: number;\r\n        if (this._offScreenRenderTexture) {\r\n            width = this._offScreenRenderTexture.width;\r\n            height = this._offScreenRenderTexture.height;\r\n        } else {\r\n            width = this.clientWidth;\r\n            height = this.clientHeight;\r\n        }\r\n        this._normalizedViewport.x = value.x / width;\r\n        this._normalizedViewport.y = value.y / height;\r\n        this._normalizedViewport.width = value.width / width;\r\n        this._normalizedViewport.height = value.height / height;\r\n        this._calculationViewport(this._normalizedViewport, width, height);\r\n        this._calculateProjectionMatrix();\r\n    }\r\n\r\n    get clientWidth(): number {\r\n        ILaya.stage.needUpdateCanvasSize();\r\n        if (Config3D.customResolution)\r\n            return Config3D.pixelRatio * Config3D._resoluWidth | 0;\r\n        else\r\n            return RenderContext3D.clientWidth * Config3D.pixelRatio | 0;\r\n    }\r\n\r\n    get clientHeight(): number {\r\n        ILaya.stage.needUpdateCanvasSize();\r\n        if (Config3D.customResolution)\r\n            return Config3D.pixelRatio * Config3D._resoluHeight | 0;\r\n        else\r\n            return RenderContext3D.clientHeight * Config3D.pixelRatio | 0;\r\n    }\r\n\r\n\r\n\r\n    /**\r\n     * \r\n     */\r\n    set msaa(value: boolean) {\r\n        LayaGL.renderEngine.getCapable(RenderCapable.MSAA) ? this._msaa = value : this._msaa = false;\r\n    }\r\n\r\n\r\n    get msaa(): boolean {\r\n        return this._msaa && Stat.enablemsaa;\r\n    }\r\n\r\n    /**\r\n     * \r\n     */\r\n    set fxaa(value: boolean) {\r\n        this._fxaa = value;\r\n    }\r\n\r\n    get fxaa(): boolean {\r\n        return this._fxaa;\r\n    }\r\n\r\n    /**\r\n     * \r\n     */\r\n    get normalizedViewport(): Viewport {\r\n        return this._normalizedViewport;\r\n    }\r\n\r\n    set normalizedViewport(value: Viewport) {\r\n        var width: number;\r\n        var height: number;\r\n        if (this._offScreenRenderTexture) {\r\n            width = this._offScreenRenderTexture.width;\r\n            height = this._offScreenRenderTexture.height;\r\n        } else {\r\n            width = this.clientWidth;\r\n            height = this.clientHeight;\r\n        }\r\n        if (this._normalizedViewport !== value)\r\n            value.cloneTo(this._normalizedViewport);\r\n        this._calculationViewport(value, width, height);\r\n        this._calculateProjectionMatrix();\r\n    }\r\n\r\n    /**\r\n     * \r\n     */\r\n    get viewMatrix(): Matrix4x4 {\r\n        if (this._updateViewMatrix) {\r\n            var scale: Vector3 = this.transform.getWorldLossyScale();\r\n            var scaleX: number = scale.x;\r\n            var scaleY: number = scale.y;\r\n            var scaleZ: number = scale.z;\r\n            var viewMatE: Float32Array = this._viewMatrix.elements;\r\n\r\n            this.transform.worldMatrix.cloneTo(this._viewMatrix)\r\n            viewMatE[0] /= scaleX;//\r\n            viewMatE[1] /= scaleX;\r\n            viewMatE[2] /= scaleX;\r\n            viewMatE[4] /= scaleY;\r\n            viewMatE[5] /= scaleY;\r\n            viewMatE[6] /= scaleY;\r\n            viewMatE[8] /= scaleZ;\r\n            viewMatE[9] /= scaleZ;\r\n            viewMatE[10] /= scaleZ;\r\n            this._viewMatrix.invert(this._viewMatrix);\r\n            this._updateViewMatrix = false;\r\n        }\r\n        return this._viewMatrix;\r\n    }\r\n\r\n    /**\r\n     * \r\n     */\r\n    get projectionMatrix(): Matrix4x4 {\r\n        return this._projectionMatrix;\r\n    }\r\n\r\n    set projectionMatrix(value: Matrix4x4) {\r\n        this._projectionMatrix = value;\r\n        this._useUserProjectionMatrix = true;\r\n    }\r\n\r\n    /**\r\n     * \r\n     */\r\n    get projectionViewMatrix(): Matrix4x4 {\r\n        Matrix4x4.multiply(this.projectionMatrix, this.viewMatrix, this._projectionViewMatrix);\r\n        return this._projectionViewMatrix;\r\n    }\r\n\r\n    /**\r\n     * \r\n     */\r\n    get boundFrustum(): BoundFrustum {\r\n        this._boundFrustum.matrix = this.projectionViewMatrix;\r\n        return this._boundFrustum;\r\n    }\r\n\r\n    /**\r\n     * \r\n     */\r\n    get renderTarget(): RenderTexture {\r\n        return this._offScreenRenderTexture;\r\n    }\r\n\r\n    set renderTarget(value: RenderTexture) {\r\n        var lastValue: RenderTexture = this._offScreenRenderTexture;\r\n        if (lastValue !== value) {\r\n            (lastValue) && (lastValue._isCameraTarget = false);\r\n            (value) && (value._isCameraTarget = true);\r\n            this._offScreenRenderTexture = value;\r\n            this._calculateProjectionMatrix();\r\n        }\r\n    }\r\n\r\n    /**\r\n     * \r\n     */\r\n    get postProcess(): PostProcess {\r\n        return this._postProcess;\r\n    }\r\n\r\n    set postProcess(value: PostProcess) {\r\n        this._postProcess = value;\r\n        //if (!value) return;\r\n        //value && value._init(this);\r\n    }\r\n\r\n    /**\r\n     * HDR\r\n     * \r\n     */\r\n    get enableHDR(): boolean {\r\n        return this._enableHDR;\r\n    }\r\n\r\n    set enableHDR(value: boolean) {\r\n        if (value && !LayaGL.renderEngine.getCapable(RenderCapable.RenderTextureFormat_R16G16B16A16)) {\r\n            console.warn(\"Camera:can't enable HDR in this device.\");\r\n            return;\r\n        }\r\n        this._enableHDR = value;\r\n    }\r\n\r\n    /**\r\n     * RenderTextureCommandBuffertrue\r\n     * CommandBuffer\r\n     */\r\n    get enableBuiltInRenderTexture(): boolean {\r\n        return this._needBuiltInRenderTexture;\r\n    }\r\n\r\n    set enableBuiltInRenderTexture(value: boolean) {\r\n        this._needBuiltInRenderTexture = value;\r\n    }\r\n\r\n    /**\r\n     * \r\n     */\r\n    get depthTextureMode(): DepthTextureMode {\r\n        return this._depthTextureMode;\r\n    }\r\n\r\n    set depthTextureMode(value: DepthTextureMode) {\r\n        this._depthTextureMode = value;\r\n        if (!LayaGL.renderEngine.getCapable(RenderCapable.RenderTextureFormat_Depth)) {\r\n            this._depthTextureMode &= ~DepthTextureMode.Depth;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * OpaquePass\r\n     */\r\n    set opaquePass(value: boolean) {\r\n        if (value == this._opaquePass)\r\n            return;\r\n        if (!value) {\r\n            this._shaderValues.setTexture(BaseCamera.OPAQUETEXTURE, Texture2D.blackTexture);\r\n            this._shaderValues.setVector(BaseCamera.OPAQUETEXTUREPARAMS, Vector4.ONE);\r\n            this._opaqueTexture && RenderTexture.recoverToPool(this._opaqueTexture);\r\n            this._opaqueTexture = null;\r\n        }\r\n        this._opaquePass = value;\r\n    }\r\n\r\n    get opaquePass() {\r\n        return this._opaquePass;\r\n    }\r\n\r\n    /**\r\n     * \r\n     */\r\n    get depthTextureFormat(): RenderTargetFormat {\r\n        return this._depthTextureFormat;\r\n    }\r\n    set depthTextureFormat(value: RenderTargetFormat) {\r\n        this._depthTextureFormat = value;\r\n    }\r\n\r\n\r\n    /**\r\n     * (TODO:,)\r\n     */\r\n    set enableBlitDepth(value: boolean) {\r\n        if (value == this._canBlitDepth)\r\n            return;\r\n        this._canBlitDepth = value;\r\n        this._cacheDepth = value;\r\n        if (value)\r\n            this._internalRenderTexture && (this._internalRenderTexture.generateDepthTexture = true);\r\n        else {\r\n            this._internalRenderTexture && (this._internalRenderTexture.generateDepthTexture = false);\r\n            if (this._cacheDepthTexture)\r\n                this._cacheDepthTexture._inPool ? 0 : RenderTexture.recoverToPool(this._cacheDepthTexture);\r\n        }\r\n\r\n    }\r\n    get enableBlitDepth() {\r\n        return this._canBlitDepth;\r\n    }\r\n    get canblitDepth() {\r\n        return this._canBlitDepth && this._internalRenderTexture && this._internalRenderTexture.depthStencilFormat != null;\r\n    }\r\n\r\n    /**\r\n     *  <code>Camera</code> \r\n     * @param\taspectRatio \r\n     * @param\tnearPlane \r\n     * @param\tfarPlane \r\n     */\r\n    constructor(aspectRatio: number = 0, nearPlane: number = 0.3, farPlane: number = 1000) {\r\n        super(nearPlane, farPlane);\r\n        this._viewMatrix = new Matrix4x4();\r\n        this._projectionMatrix = new Matrix4x4();\r\n        this._projectionViewMatrix = new Matrix4x4();\r\n        this._viewport = new Viewport(0, 0, 0, 0);\r\n        this._normalizedViewport = new Viewport(0, 0, 1, 1);\r\n        this._rayViewport = new Viewport(0, 0, 0, 0);\r\n        this._aspectRatio = aspectRatio;\r\n        this._boundFrustum = new BoundFrustum(new Matrix4x4());\r\n        this.depthTextureMode = 0;\r\n        this.opaquePass = false;\r\n        this._calculateProjectionMatrix();\r\n        ILaya.stage.on(Event.RESIZE, this, this._onScreenSizeChanged);\r\n        this.transform.on(Event.TRANSFORM_CHANGED, this, this._onTransformChanged);\r\n        this.opaquePass = false;\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    private _calculationViewport(normalizedViewport: Viewport, width: number, height: number): void {\r\n        var lx: number = normalizedViewport.x * width;//x\r\n        var ly: number = normalizedViewport.y * height;//y\r\n        var rx: number = lx + Math.max(normalizedViewport.width * width, 0);\r\n        var ry: number = ly + Math.max(normalizedViewport.height * height, 0);\r\n\r\n        var ceilLeftX: number = Math.ceil(lx);\r\n        var ceilLeftY: number = Math.ceil(ly);\r\n        var floorRightX: number = Math.floor(rx);\r\n        var floorRightY: number = Math.floor(ry);\r\n\r\n        var pixelLeftX: number = ceilLeftX - lx >= 0.5 ? Math.floor(lx) : ceilLeftX;\r\n        var pixelLeftY: number = ceilLeftY - ly >= 0.5 ? Math.floor(ly) : ceilLeftY;\r\n        var pixelRightX: number = rx - floorRightX >= 0.5 ? Math.ceil(rx) : floorRightX;\r\n        var pixelRightY: number = ry - floorRightY >= 0.5 ? Math.ceil(ry) : floorRightY;\r\n\r\n        this._viewport.x = pixelLeftX;\r\n        this._viewport.y = pixelLeftY;\r\n        this._viewport.width = pixelRightX - pixelLeftX;\r\n        this._viewport.height = pixelRightY - pixelLeftY;\r\n    }\r\n\r\n    /**\r\n     * @inheritDoc\r\n     * @override\r\n     * @internal\r\n     */\r\n    protected _calculateProjectionMatrix(): void {\r\n        if (!this._useUserProjectionMatrix) {\r\n            if (this._orthographic) {\r\n                var halfHeight: number = this.orthographicVerticalSize * 0.5;\r\n                var halfWidth: number = halfHeight * this.aspectRatio;\r\n                Matrix4x4.createOrthoOffCenter(-halfWidth, halfWidth, -halfHeight, halfHeight, this.nearPlane, this.farPlane, this._projectionMatrix);\r\n            } else {\r\n                Matrix4x4.createPerspective(3.1416 * this.fieldOfView / 180.0, this.aspectRatio, this.nearPlane, this.farPlane, this._projectionMatrix);\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     *\t\r\n     * \t@param  layer \r\n     * \t@return \r\n     */\r\n    _isLayerVisible(layer: number): boolean {\r\n        return (Math.pow(2, layer) & this.cullingMask) != 0;\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    _onTransformChanged(flag: number): void {\r\n        flag &= Transform3D.TRANSFORM_WORLDMATRIX;//TRANSFORM\r\n        (flag) && (this._updateViewMatrix = true);\r\n    }\r\n\r\n    /**\r\n     * @inheritDoc\r\n     * @override\r\n     * @internal\r\n     */\r\n    _parse(data: any, spriteMap: any): void {\r\n        super._parse(data, spriteMap);\r\n        var clearFlagData: any = data.clearFlag;\r\n        (clearFlagData !== undefined) && (this.clearFlag = clearFlagData);\r\n        var viewport: any[] = data.viewport;\r\n        this.normalizedViewport = new Viewport(viewport[0], viewport[1], viewport[2], viewport[3]);\r\n        var enableHDR: boolean = data.enableHDR;\r\n        (enableHDR !== undefined) && (this.enableHDR = enableHDR);\r\n    }\r\n\r\n    clone(): Camera {\r\n        let camera = <Camera>super.clone();\r\n        camera.clearFlag = this.clearFlag;\r\n        this.clearColor.cloneTo(camera.clearColor);\r\n        camera.clearColor = camera.clearColor;\r\n        camera.viewport = this.viewport;\r\n        this.normalizedViewport.cloneTo(camera.normalizedViewport);\r\n        camera.enableHDR = this.enableHDR;\r\n        camera.farPlane = this.farPlane;\r\n        camera.nearPlane = this.nearPlane;\r\n        camera.fieldOfView = this.fieldOfView;\r\n        camera.orthographic = this.orthographic;\r\n        camera.orthographicVerticalSize = this.orthographicVerticalSize;\r\n        camera.opaquePass = this.opaquePass;\r\n        camera._cameraEventCommandBuffer = this._cameraEventCommandBuffer;\r\n        camera.opaquePass = this.opaquePass;\r\n        //Object.assign(camera._cameraEventCommandBuffer, this._cameraEventCommandBuffer);\r\n        return camera;\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    _getCanvasWidth(): number {\r\n        if (this._offScreenRenderTexture)\r\n            return this._offScreenRenderTexture.width;\r\n        else\r\n            return this.clientWidth;\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    _getCanvasHeight(): number {\r\n        if (this._offScreenRenderTexture)\r\n            return this._offScreenRenderTexture.height;\r\n        else\r\n            return this.clientHeight;\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    _getRenderTexture(): RenderTexture {\r\n        return this._internalRenderTexture || this._offScreenRenderTexture;\r\n    }\r\n\r\n    /**\r\n     * Gamma\r\n     * @param rt \r\n     */\r\n    _needRenderGamma(rt: RenderTargetFormat) {\r\n        switch (rt) {\r\n            case RenderTargetFormat.R8G8B8:\r\n            case RenderTargetFormat.R8G8B8A8:\r\n                return true;\r\n            default:\r\n                return false;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    _needInternalRenderTexture(): boolean {\r\n        return (this._postProcess && this._postProcess.enable) || this._enableHDR || this._needBuiltInRenderTexture ? true : false;//condition of internal RT\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    _getRenderTextureFormat(): RenderTargetFormat {\r\n        if (this._enableHDR)\r\n            return RenderTargetFormat.R16G16B16A16;\r\n        else\r\n            return RenderTargetFormat.R8G8B8A8;\r\n    }\r\n\r\n    /**\r\n     * update Camera Render\r\n     * @param context \r\n     */\r\n    _updateCameraRenderData(context: RenderContext3D) {\r\n        this._prepareCameraToRender();\r\n        this._applyViewProject(context, this.viewMatrix, this._projectionMatrix);\r\n    }\r\n\r\n\r\n    /**\r\n     * @override\r\n     * @internal\r\n     */\r\n    _prepareCameraToRender(): void {\r\n        super._prepareCameraToRender();\r\n        var vp: Viewport = this.viewport;\r\n        this._viewportParams.setValue(vp.x, vp.y, vp.width, vp.height);\r\n        this._projectionParams.setValue(this._nearPlane, this._farPlane, RenderContext3D._instance.invertY ? -1 : 1, 1 / this.farPlane);\r\n        this._shaderValues.setVector(BaseCamera.VIEWPORT, this._viewportParams);\r\n        this._shaderValues.setVector(BaseCamera.PROJECTION_PARAMS, this._projectionParams);\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    _applyViewProject(context: RenderContext3D, viewMat: Matrix4x4, proMat: Matrix4x4): void {\r\n        var projectView: Matrix4x4;\r\n        if (context.invertY) {\r\n            Matrix4x4.multiply(BaseCamera._invertYScaleMatrix, proMat, BaseCamera._invertYProjectionMatrix);\r\n            Matrix4x4.multiply(BaseCamera._invertYProjectionMatrix, viewMat, BaseCamera._invertYProjectionViewMatrix);\r\n            proMat = BaseCamera._invertYProjectionMatrix;\r\n            projectView = BaseCamera._invertYProjectionViewMatrix;\r\n        }\r\n        else {\r\n            Matrix4x4.multiply(proMat, viewMat, this._projectionViewMatrix);\r\n            projectView = this._projectionViewMatrix;\r\n        }\r\n\r\n        context.viewMatrix = viewMat;\r\n        context.projectionMatrix = proMat;\r\n        context.projectionViewMatrix = projectView;\r\n        this._shaderValues.setMatrix4x4(BaseCamera.VIEWMATRIX, viewMat);\r\n        this._shaderValues.setMatrix4x4(BaseCamera.PROJECTMATRIX, proMat);\r\n        this._shaderValues.setMatrix4x4(BaseCamera.VIEWPROJECTMATRIX, projectView);\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    _updateClusterPlaneXY(): void {\r\n        var fieldOfView: number = this.fieldOfView;\r\n        var aspectRatio: number = this.aspectRatio;\r\n        if (this._clusterPlaneCacheFlag.x !== fieldOfView || this._clusterPlaneCacheFlag.y !== aspectRatio) {\r\n            var clusterCount: Vector3 = Config3D.lightClusterCount;\r\n            var xSlixe: number = clusterCount.x, ySlice: number = clusterCount.y;\r\n            var xCount: number = xSlixe + 1, yCount: number = ySlice + 1;\r\n            var xPlanes: Vector3[] = this._clusterXPlanes, yPlanes: Vector3[] = this._clusterYPlanes;\r\n\r\n            if (!xPlanes) {\r\n                xPlanes = this._clusterXPlanes = new Array(xCount);\r\n                yPlanes = this._clusterYPlanes = new Array(yCount);\r\n                for (var i: number = 0; i < xCount; i++)\r\n                    xPlanes[i] = new Vector3();\r\n                for (var i: number = 0; i < yCount; i++)\r\n                    yPlanes[i] = new Vector3();\r\n            }\r\n            var halfY = Math.tan((this.fieldOfView / 2) * Math.PI / 180);\r\n            var halfX = this.aspectRatio * halfY;\r\n            var yLengthPerCluster = 2 * halfY / ySlice;\r\n            var xLengthPerCluster = 2 * halfX / xSlixe;\r\n            for (var i: number = 0; i < xCount; i++) {\r\n                var angle: number = -halfX + xLengthPerCluster * i;\r\n                var bigHypot: number = Math.sqrt(1 + angle * angle);\r\n                var normX: number = 1 / bigHypot;\r\n                var xPlane: Vector3 = xPlanes[i];\r\n                xPlane.setValue(normX, 0, -angle * normX);\r\n            }\r\n            //start from top is more similar to light pixel data\r\n            for (var i: number = 0; i < yCount; i++) {\r\n                var angle: number = halfY - yLengthPerCluster * i;\r\n                var bigHypot: number = Math.sqrt(1 + angle * angle);\r\n                var normY: number = -1 / bigHypot;\r\n                var yPlane: Vector3 = yPlanes[i];\r\n                yPlane.setValue(0, normY, -angle * normY);\r\n            }\r\n\r\n            this._clusterPlaneCacheFlag.x = fieldOfView;\r\n            this._clusterPlaneCacheFlag.y = aspectRatio;\r\n        }\r\n    }\r\n\r\n\r\n    /**\r\n     * \r\n     * @param event \r\n     * @param renderTarget \r\n     * @param context \r\n     */\r\n    _applyCommandBuffer(event: number, context: RenderContext3D) {\r\n        if (!Stat.enableCameraCMD)\r\n            return;\r\n        var commandBufferArray: CommandBuffer[] = this._cameraEventCommandBuffer[event];\r\n        if (!commandBufferArray || commandBufferArray.length == 0)\r\n            return;\r\n        commandBufferArray.forEach(function (value) {\r\n            value._context = context;\r\n            value._apply();\r\n        });\r\n        (RenderTexture.currentActive) && (RenderTexture.currentActive._end());\r\n        if (this._internalRenderTexture || this._offScreenRenderTexture)\r\n            this._getRenderTexture()._start();\r\n        else {\r\n            LayaGL.textureContext.bindoutScreenTarget();\r\n        }\r\n        LayaGL.renderEngine.viewport(0, 0, context.viewport.width, context.viewport.height);\r\n    }\r\n\r\n    /**\r\n     * apply \r\n     * @internal\r\n     */\r\n    _applyCasterPassCommandBuffer(context: RenderContext3D) {\r\n        if (!this._shadowCasterCommanBuffer || this._shadowCasterCommanBuffer.length == 0)\r\n            return;\r\n        this._shadowCasterCommanBuffer.forEach(function (value) {\r\n            value._context = context;\r\n            value._apply();\r\n        });\r\n    }\r\n\r\n    /**\r\n    * @internal\r\n    */\r\n    _addCasterShadowCommandBuffer(commandBuffer: CommandBuffer) {\r\n        if (this._shadowCasterCommanBuffer.indexOf(commandBuffer) < 0)\r\n            this._shadowCasterCommanBuffer.push(commandBuffer);\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     * @param commandBuffer \r\n     */\r\n    _removeCasterShadowCommandBuffer(commandBuffer: CommandBuffer) {\r\n        var index: number = this._shadowCasterCommanBuffer.indexOf(commandBuffer);\r\n        if (index != -1) this._shadowCasterCommanBuffer.splice(index, 1);\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @internal\r\n     * @param scene \r\n     * @param context \r\n     */\r\n    _renderShadowMap(scene: Scene3D, context: RenderContext3D) {\r\n        if (Scene3D._updateMark % scene._ShadowMapupdateFrequency != 0) {\r\n            return false;\r\n        }\r\n\r\n        //render shadowMap\r\n        var shadowCasterPass;\r\n        var mainDirectLight: DirectionLightCom = scene._mainDirectionLight;\r\n        var needShadowCasterPass: boolean = mainDirectLight && mainDirectLight.shadowMode !== ShadowMode.None && ShadowUtils.supportShadow() && Stat.enableShadow;\r\n        if (needShadowCasterPass) {\r\n            scene._shaderValues.removeDefine(Scene3DShaderDeclaration.SHADERDEFINE_SHADOW_SPOT)\r\n            scene._shaderValues.addDefine(Scene3DShaderDeclaration.SHADERDEFINE_SHADOW);\r\n            shadowCasterPass = ILaya3D.Scene3D._shadowCasterPass;\r\n            shadowCasterPass.update(this, mainDirectLight, ShadowLightType.DirectionLight);\r\n            shadowCasterPass.render(context, scene, ShadowLightType.DirectionLight, this);\r\n        }\r\n        else {\r\n            scene._shaderValues.removeDefine(Scene3DShaderDeclaration.SHADERDEFINE_SHADOW);\r\n        }\r\n        var spotMainLight = scene._mainSpotLight;\r\n        var spotneedShadowCasterPass: boolean = spotMainLight && spotMainLight.shadowMode !== ShadowMode.None && ShadowUtils.supportShadow() && Stat.enableShadow;\r\n        if (spotneedShadowCasterPass) {\r\n            scene._shaderValues.removeDefine(Scene3DShaderDeclaration.SHADERDEFINE_SHADOW);\r\n            scene._shaderValues.addDefine(Scene3DShaderDeclaration.SHADERDEFINE_SHADOW_SPOT);\r\n            shadowCasterPass = ILaya3D.Scene3D._shadowCasterPass;\r\n            shadowCasterPass.update(this, spotMainLight, ShadowLightType.SpotLight);\r\n            shadowCasterPass.render(context, scene, ShadowLightType.SpotLight, this);\r\n        }\r\n        else {\r\n            scene._shaderValues.removeDefine(Scene3DShaderDeclaration.SHADERDEFINE_SHADOW_SPOT);\r\n        }\r\n        if (needShadowCasterPass)\r\n            scene._shaderValues.addDefine(Scene3DShaderDeclaration.SHADERDEFINE_SHADOW);\r\n        if (spotneedShadowCasterPass)\r\n            scene._shaderValues.addDefine(Scene3DShaderDeclaration.SHADERDEFINE_SHADOW_SPOT);\r\n\r\n        return needShadowCasterPass || spotneedShadowCasterPass;\r\n\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @internal\r\n     * @param context \r\n     * @param scene \r\n     * @param needInternalRT Rendertarget\r\n     * @param viewport \r\n     */\r\n    _preRenderMainPass(context: RenderContext3D, scene: Scene3D, needInternalRT: boolean, viewport: Viewport) {\r\n        context.camera = this;\r\n        context.cameraShaderValue = this._shaderValues;\r\n        Camera._updateMark++;\r\n\r\n        //TODO:webgl2 should use blitFramebuffer\r\n        //TODO:if adjacent camera param can use same internal RT can merge\r\n        //if need internal RT and no off screen RT and clearFlag is DepthOnly or Nothing, should grab the backBuffer\r\n        if (needInternalRT && !this._offScreenRenderTexture && (this.clearFlag == CameraClearFlags.DepthOnly || this.clearFlag == CameraClearFlags.Nothing)) {\r\n            if (RenderTexture.bindCanvasRender) {//iOSCopyTexSubImage2Dbug\r\n                if (RenderTexture.bindCanvasRender != this._internalRenderTexture) {\r\n                    var blit: BlitScreenQuadCMD = BlitScreenQuadCMD.create(RenderTexture.bindCanvasRender, this._internalRenderTexture);\r\n                    blit.setContext(context);\r\n                    blit.run();\r\n                    blit.recover();\r\n                }\r\n            } else {\r\n                if (this._enableHDR) {//internal RT is HDR can't directly copy\r\n                    var grabTexture: RenderTexture = RenderTexture.createFromPool(viewport.width, viewport.height, RenderTargetFormat.R8G8B8, RenderTargetFormat.DEPTH_16, false, 1);\r\n                    grabTexture.filterMode = FilterMode.Bilinear;\r\n                    this._renderEngine.copySubFrameBuffertoTex(grabTexture, 0, 0, 0, viewport.x, RenderContext3D.clientHeight - (viewport.y + viewport.height), viewport.width, viewport.height);\r\n                    // this._renderEngine.bindTexture(gl.TEXTURE_2D, grabTexture._getSource());\r\n                    // gl.copyTexSubImage2D(gl.TEXTURE_2D, 0, 0, 0, viewport.x, RenderContext3D.clientHeight - (viewport.y + viewport.height), viewport.width, viewport.height);\r\n                    var blit: BlitScreenQuadCMD = BlitScreenQuadCMD.create(grabTexture, this._internalRenderTexture);\r\n                    blit.setContext(context);\r\n                    blit.run();\r\n                    blit.recover();\r\n                    RenderTexture.recoverToPool(grabTexture);\r\n                }\r\n            }\r\n\r\n        }\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @internal\r\n     * @param context \r\n     * @param viewport \r\n     * @param scene \r\n     * @param shader shader\r\n     * @param replacementTag \r\n     * @param needInternalRT RT\r\n     */\r\n    _renderMainPass(context: RenderContext3D, viewport: Viewport, scene: Scene3D, shader: Shader3D, replacementTag: string, needInternalRT: boolean) {\r\n        var renderTex: RenderTexture = this._getRenderTexture();//renderTexturerenderTexture,,renderTexture\r\n        if (renderTex && renderTex._isCameraTarget)//Y\r\n            context.invertY = true;\r\n        else\r\n            context.invertY = false;\r\n        context.viewport = viewport;\r\n        //context\r\n        context.destTarget = renderTex;\r\n        this._prepareCameraToRender();\r\n        var multiLighting: boolean = Config3D._multiLighting;\r\n        (multiLighting) && (Cluster.instance.update(this, <Scene3D>(scene)));\r\n\r\n        context.customShader = shader;\r\n        context.replaceTag = replacementTag;\r\n        scene._preCulling(context, this);\r\n\r\n        this._applyViewProject(context, this.viewMatrix, this._projectionMatrix);\r\n        if (this._cameraUniformData) {//Depth\r\n            this._cameraUniformUBO && this._cameraUniformUBO.setDataByUniformBufferData(this._cameraUniformData);\r\n        }\r\n        // if (this.depthTextureMode != 0) {\r\n        //     //TODO:\r\n        this._renderDepthMode(context);\r\n        // }\r\n\r\n        // todo layame temp\r\n        (renderTex) && (renderTex._start());\r\n\r\n\r\n        scene._clear(context);\r\n\r\n        this._applyCommandBuffer(CameraEventFlags.BeforeForwardOpaque, context);\r\n\r\n        this.recoverRenderContext3D(context, renderTex);\r\n        Stat.enableOpaque && scene._renderScene(context, ILaya3D.Scene3D.SCENERENDERFLAG_RENDERQPAQUE);\r\n        this._applyCommandBuffer(CameraEventFlags.BeforeSkyBox, context);\r\n\r\n        scene._renderScene(context, ILaya3D.Scene3D.SCENERENDERFLAG_SKYBOX);\r\n        this._applyCommandBuffer(CameraEventFlags.BeforeTransparent, context);\r\n\r\n        this._opaquePass && this._createOpaqueTexture(renderTex, context);\r\n        this.recoverRenderContext3D(context, renderTex);\r\n\r\n        this.recoverRenderContext3D(context, renderTex);\r\n        Stat.enableTransparent && scene._renderScene(context, ILaya3D.Scene3D.SCENERENDERFLAG_RENDERTRANSPARENT);\r\n        //scene._componentDriver.callPostRender();//TODO:duo\r\n        this._applyCommandBuffer(CameraEventFlags.BeforeImageEffect, context);\r\n        (renderTex) && (renderTex._end());\r\n\r\n        if (needInternalRT && Stat.enablePostprocess) {\r\n            if (this._postProcess && this._postProcess.enable) {\r\n                this._postProcess.commandContext = context;\r\n                this._postProcess._render(this);\r\n                this._postProcess._applyPostProcessCommandBuffers();\r\n            } else if (this._enableHDR || this._needBuiltInRenderTexture) {\r\n                var canvasWidth: number = this._getCanvasWidth(), canvasHeight: number = this._getCanvasHeight();\r\n                if (this._offScreenRenderTexture) {\r\n                    this._screenOffsetScale.setValue(viewport.x / canvasWidth, (canvasHeight - viewport.y - viewport.height) / canvasHeight, viewport.width / canvasWidth, viewport.height / canvasHeight);\r\n                    this._internalCommandBuffer._camera = this;\r\n                    this._internalCommandBuffer._context = context;\r\n                    this._internalCommandBuffer.blitScreenQuad(this._internalRenderTexture, this._offScreenRenderTexture, this._screenOffsetScale, null, null, 0);\r\n                    this._internalCommandBuffer._apply();\r\n                    this._internalCommandBuffer.clear();\r\n                }\r\n            }\r\n        }\r\n        if (this._offScreenRenderTexture) {\r\n            RenderTexture.bindCanvasRender = null;\r\n        } else\r\n            RenderTexture.bindCanvasRender = this._internalRenderTexture;\r\n        this._applyCommandBuffer(CameraEventFlags.AfterEveryThing, context);\r\n\r\n        // if (renderTex && renderTex._isCameraTarget)//Y\r\n        //     context.invertY = false;\r\n    }\r\n\r\n    recoverRenderContext3D(context: RenderContext3D, renderTexture: RenderTexture) {\r\n        const cacheViewPor = Camera._context3DViewPortCatch;\r\n        const cacheScissor = Camera._contextScissorPortCatch;\r\n        context.changeViewport(cacheViewPor.x, cacheViewPor.y, cacheViewPor.width, cacheViewPor.height);\r\n        context.changeScissor(cacheScissor.x, cacheScissor.y, cacheScissor.z, cacheScissor.w);\r\n        context.destTarget = renderTexture;\r\n    }\r\n\r\n    /**\r\n     * camera\r\n     * @internal\r\n     */\r\n    _renderDepthMode(context: RenderContext3D) {\r\n        var cameraDepthMode = this._depthTextureMode;\r\n        if (this._postProcess && this._postProcess.enable) {\r\n            cameraDepthMode |= this._postProcess.cameraDepthTextureMode;\r\n        }\r\n        if (!LayaGL.renderEngine.getCapable(RenderCapable.RenderTextureFormat_Depth)) {\r\n            cameraDepthMode &= ~DepthTextureMode.Depth;\r\n        }\r\n        if ((cameraDepthMode & DepthTextureMode.Depth) != 0) {\r\n            // todo\r\n            if (!this.canblitDepth || !this._internalRenderTexture.depthStencilTexture) {\r\n                Camera.depthPass.update(this, DepthTextureMode.Depth, this._depthTextureFormat);\r\n                Camera.depthPass.render(context, DepthTextureMode.Depth);\r\n            }\r\n            else {\r\n                this.depthTexture = this._cacheDepthTexture.depthStencilTexture;\r\n                //@ts-ignore;\r\n                Camera.depthPass._depthTexture = this.depthTexture;\r\n                Camera.depthPass._setupDepthModeShaderValue(DepthTextureMode.Depth, this);\r\n            }\r\n        }\r\n        if ((cameraDepthMode & DepthTextureMode.DepthNormals) != 0) {\r\n            Camera.depthPass.update(this, DepthTextureMode.DepthNormals, this._depthTextureFormat);\r\n            Camera.depthPass.render(context, DepthTextureMode.DepthNormals);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     * \r\n     */\r\n    get depthTexture(): BaseTexture {\r\n        return this._depthTexture;\r\n    }\r\n\r\n    set depthTexture(value: BaseTexture) {\r\n        this._depthTexture = value;\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     * \r\n     */\r\n    get depthNormalTexture(): RenderTexture {\r\n        return this._depthNormalsTexture;\r\n    }\r\n\r\n    set depthNormalTexture(value: RenderTexture) {\r\n        this._depthNormalsTexture = value;\r\n    }\r\n\r\n\r\n    /**\r\n     * @internal\r\n     * @param needShadowPass \r\n     */\r\n    _aftRenderMainPass(needShadowPass: Boolean) {\r\n        // if (needShadowPass)\r\n        //     ILaya3D.Scene3D._shadowCasterPass.cleanUp();\r\n        if (this._cacheDepth && this._internalRenderTexture) {\r\n            if (this._cacheDepthTexture)\r\n                this._cacheDepthTexture._inPool ? 0 : RenderTexture.recoverToPool(this._cacheDepthTexture);\r\n            this._cacheDepthTexture = this._internalRenderTexture;\r\n        }\r\n        Camera.depthPass.cleanUp();\r\n    }\r\n\r\n\r\n    _createOpaqueTexture(currentTarget: RenderTexture, renderContext: RenderContext3D) {\r\n        if (!this._opaqueTexture) {\r\n            let tex = this._getRenderTexture();\r\n            // this._opaqueTexture = RenderTexture.createFromPool(tex.width, tex.height, tex.colorFormat, RenderTargetFormat.None, false, 1, false, true);\r\n            this._opaqueTexture = RenderTexture.createFromPool(1024, 1024, tex.colorFormat, RenderTargetFormat.None, true, 1, false, true);\r\n            this._opaqueTexture.filterMode = FilterMode.Bilinear;\r\n            this._opaqueTexture.wrapModeU = WrapMode.Clamp;\r\n            this._opaqueTexture.wrapModeV = WrapMode.Clamp;\r\n            this._shaderValues.setTexture(BaseCamera.OPAQUETEXTURE, this._opaqueTexture);\r\n\r\n            let opaqueTexParams = new Vector4();\r\n            opaqueTexParams.x = this._opaqueTexture.width;\r\n            opaqueTexParams.y = this._opaqueTexture.height;\r\n            opaqueTexParams.z = this._opaqueTexture.maxMipmapLevel;\r\n\r\n            this._shaderValues.setVector(BaseCamera.OPAQUETEXTUREPARAMS, opaqueTexParams);\r\n        }\r\n\r\n\r\n\r\n        var blit: BlitScreenQuadCMD = BlitScreenQuadCMD.create(currentTarget, this._opaqueTexture);\r\n        blit.setContext(renderContext);\r\n        blit.run();\r\n        blit.recover();\r\n    }\r\n\r\n    /**\r\n     * @override\r\n     * @param shader \r\n     * @param replacementTag \r\n     */\r\n    render(shader: Shader3D = null, replacementTag: string = null): void {\r\n        if (!this.activeInHierarchy) //custom render should protected with activeInHierarchy=true\r\n            return;\r\n\r\n        var viewport: Viewport = this.viewport;\r\n        var needInternalRT: boolean = this._needInternalRenderTexture();\r\n        var context: RenderContext3D = RenderContext3D._instance;\r\n        var scene: Scene3D = context.scene = <Scene3D>this._scene;\r\n        scene._setCullCamera(this);\r\n        context.pipelineMode = context.configPipeLineMode;\r\n        context.replaceTag = replacementTag;\r\n        context.customShader = shader;\r\n        let texFormat = this._getRenderTextureFormat();\r\n\r\n        if (needInternalRT) {\r\n            if (this.msaa) {\r\n                this._internalRenderTexture = RenderTexture.createFromPool(viewport.width, viewport.height, texFormat, this._depthTextureFormat, false, 4, this.canblitDepth, this._needRenderGamma(texFormat));\r\n                this._internalRenderTexture.filterMode = FilterMode.Bilinear;\r\n            } else {\r\n                this._internalRenderTexture = RenderTexture.createFromPool(viewport.width, viewport.height, texFormat, this._depthTextureFormat, false, 1, this.canblitDepth, this._needRenderGamma(texFormat));\r\n                this._internalRenderTexture.filterMode = FilterMode.Bilinear;\r\n            }\r\n        }\r\n        else {\r\n            this._internalRenderTexture = null;\r\n        }\r\n        scene._componentDriver.callPreRender();\r\n        var needShadowCasterPass: boolean = this._renderShadowMap(scene, context);\r\n        this._preRenderMainPass(context, scene, needInternalRT, viewport);\r\n        this._renderMainPass(context, viewport, scene, shader, replacementTag, needInternalRT);\r\n        this._aftRenderMainPass(needShadowCasterPass);\r\n        scene._componentDriver.callPostRender();\r\n    }\r\n\r\n\r\n    /**\r\n     * \r\n     * @param point \r\n     * @param out  \r\n     */\r\n    viewportPointToRay(point: Vector2, out: Ray): void {\r\n        this._rayViewport.x = this.viewport.x;\r\n        this._rayViewport.y = this.viewport.y;\r\n        this._rayViewport.width = ILaya.stage._width;\r\n        this._rayViewport.height = ILaya.stage._height;\r\n        Picker.calculateCursorRay(point, this._rayViewport, this._projectionMatrix, this.viewMatrix, null, out);\r\n    }\r\n\r\n    /** \r\n     * \r\n     * @param point \r\n     * @param out  \r\n     */\r\n    normalizedViewportPointToRay(point: Vector2, out: Ray): void {\r\n        var finalPoint: Vector2 = Camera._tempVector20;\r\n        var vp: Viewport = this.normalizedViewport;\r\n        point.x = point.x * Config3D.pixelRatio;\r\n        point.y = point.y * Config3D.pixelRatio;\r\n        finalPoint.x = point.x * vp.width;\r\n        finalPoint.y = point.y * vp.height;\r\n\r\n        Picker.calculateCursorRay(finalPoint, this.viewport, this._projectionMatrix, this.viewMatrix, null, out);\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @param position \r\n     * @param out  xyz,wz\r\n     */\r\n    worldToViewportPoint(position: Vector3, out: Vector4): void {\r\n        Matrix4x4.multiply(this._projectionMatrix, this._viewMatrix, this._projectionViewMatrix);\r\n        this.viewport.project(position, this._projectionViewMatrix, out);\r\n        var r = Config3D.pixelRatio;\r\n        let _wr = (out.x - this.viewport.x) / r;\r\n        let _hr = (out.y - this.viewport.y) / r;\r\n        out.x = _wr + this.viewport.x;\r\n        out.y = _hr + this.viewport.y;\r\n\r\n        out.x = (out.x / ILaya.stage.clientScaleX) | 0;\r\n        out.y = (out.y / ILaya.stage.clientScaleY) | 0;\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @param position \r\n     * @param out  xyz,wz\r\n     */\r\n    worldToNormalizedViewportPoint(position: Vector3, out: Vector4): void {\r\n        this.worldToViewportPoint(position, out);\r\n        out.x = out.x / ILaya.stage.width;\r\n        out.y = out.y / ILaya.stage.height;\r\n    }\r\n\r\n    /**\r\n     * 2D3D:\r\n     * @param   source \r\n     * @param   out \r\n     * @return \r\n     */\r\n    convertScreenCoordToOrthographicCoord(source: Vector3, out: Vector3): boolean {//TODO:viewport\r\n        if (this._orthographic) {\r\n            var clientWidth: number = this.clientWidth;\r\n            var clientHeight: number = this.clientHeight;\r\n            var ratioX: number = this.orthographicVerticalSize * this.aspectRatio / clientWidth;\r\n            var ratioY: number = this.orthographicVerticalSize / clientHeight;\r\n            out.x = (-clientWidth / 2 + source.x * ILaya.stage.clientScaleX) * ratioX;\r\n            out.y = (clientHeight / 2 - source.y * ILaya.stage.clientScaleY) * ratioY;\r\n            out.z = (this.nearPlane - this.farPlane) * (source.z + 1) / 2 - this.nearPlane;\r\n            Vector3.transformCoordinate(out, this.transform.worldMatrix, out);\r\n            return true;\r\n        } else {\r\n            return false;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * @inheritDoc\r\n     * @override\r\n     */\r\n    destroy(destroyChild: boolean = true): void {\r\n        this._needInternalRenderTexture() && this._internalRenderTexture && (!this._internalRenderTexture._inPool) && RenderTexture.recoverToPool(this._internalRenderTexture);\r\n        this._offScreenRenderTexture = null;\r\n        this.transform.off(Event.TRANSFORM_CHANGED, this, this._onTransformChanged);\r\n        ILaya.stage.off(Event.RESIZE, this, this._onScreenSizeChanged);\r\n        this._cameraEventCommandBuffer = {};\r\n        this._shaderValues.destroy();\r\n        if (RenderContext3D._instance.camera == this) {\r\n            RenderContext3D._instance.cameraShaderValue = null;\r\n            RenderContext3D._instance.camera = null;\r\n        }\r\n        super.destroy(destroyChild);\r\n    }\r\n\r\n    /**\r\n     * camera\r\n     * @param event \r\n     * @param commandBuffer \r\n     */\r\n    addCommandBuffer(event: CameraEventFlags, commandBuffer: CommandBuffer): void {\r\n        var commandBufferArray: CommandBuffer[] = this._cameraEventCommandBuffer[event];\r\n        if (!commandBufferArray) commandBufferArray = this._cameraEventCommandBuffer[event] = [];\r\n        if (commandBufferArray.indexOf(commandBuffer) < 0)\r\n            commandBufferArray.push(commandBuffer);\r\n        commandBuffer._camera = this;\r\n        if (commandBuffer.casterShadow) {\r\n            this._addCasterShadowCommandBuffer(commandBuffer);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * camera\r\n     * @param event \r\n     * @param commandBuffer \r\n     */\r\n    removeCommandBuffer(event: CameraEventFlags, commandBuffer: CommandBuffer): void {\r\n        var commandBufferArray: CommandBuffer[] = this._cameraEventCommandBuffer[event];\r\n        if (commandBufferArray) {\r\n            var index: number = commandBufferArray.indexOf(commandBuffer);\r\n            if (index != -1) commandBufferArray.splice(index, 1);\r\n\r\n            commandBuffer.casterShadow && this._removeCasterShadowCommandBuffer(commandBuffer);\r\n        }\r\n        else\r\n            throw \"Camera:unknown event.\";\r\n    }\r\n\r\n    /**\r\n     * camera\r\n     * @param event \r\n     */\r\n    removeCommandBuffers(event: CameraEventFlags): void {\r\n        if (this._cameraEventCommandBuffer[event])\r\n            this._cameraEventCommandBuffer[event].length = 0;\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    protected _create(): Node {\r\n        return new Camera();\r\n    }\r\n\r\n    /** @internal [NATIVE]*/\r\n    _boundFrustumBuffer: Float32Array;\r\n}\r\n\r\n","import { Component } from \"../../../components/Component\";\r\nimport { Vector2 } from \"../../../maths/Vector2\";\r\nimport { Light, LightMode, LightType } from \"./Light\";\r\nexport enum AreaShape {\r\n    rectangle,\r\n    ellipse,\r\n}\r\n/**\r\n * <code>LightSprite</code> \r\n */\r\nexport class AreaLightCom extends Light {\r\n    /**@internal */\r\n    private _areaShape: AreaShape;\r\n\r\n    /**@internal */\r\n    private _power: number;\r\n\r\n    /**@internal */\r\n    private _size: Vector2;\r\n\r\n    /**@internal */\r\n    private _spread: number;\r\n\r\n    /**@internal */\r\n    private _maxBounces: number;\r\n    /**\r\n     *  <code>AreaLightCoponent</code> \r\n     */\r\n    constructor() {\r\n        super();\r\n        this._lightType = LightType.Area;\r\n        this._lightmapBakedType = LightMode.bakeOnly;\r\n        this._spread = 90;\r\n        this._maxBounces = 1024;\r\n        this._size = new Vector2(1, 1);\r\n        this._areaShape = AreaShape.rectangle;\r\n        this._power = 100;\r\n    }\r\n\r\n    /**\r\n      * \r\n      */\r\n    get lightmapBakedType(): LightMode {\r\n        return LightMode.bakeOnly;\r\n    }\r\n\r\n    set lightmapBakedType(value: LightMode) {\r\n        this._lightmapBakedType = LightMode.bakeOnly;\r\n    }\r\n\r\n\r\n    /**\r\n     * \r\n     */\r\n    get shape(): AreaShape {\r\n        return this._areaShape;\r\n    }\r\n\r\n    set shape(value: AreaShape) {\r\n        this._areaShape = value;\r\n    }\r\n\r\n    /**\r\n     * \r\n     */\r\n    set power(value: number) {\r\n        this._power = value;\r\n    }\r\n\r\n    get power() {\r\n        return this._power;\r\n    }\r\n\r\n    /**\r\n     * \r\n     */\r\n    set size(value: Vector2) {\r\n        value && value.cloneTo(this._size);\r\n    }\r\n\r\n    get size() {\r\n        return this._size;\r\n    }\r\n\r\n    /**\r\n     * \r\n     */\r\n    set spread(value: number) {\r\n        this._spread = Math.min((Math.max(0, value)), 180);\r\n    }\r\n\r\n    get spread(): number {\r\n        return this._spread;\r\n    }\r\n\r\n    /**\r\n     * \r\n     */\r\n    set maxBounces(value: number) {\r\n        this._maxBounces = value;\r\n    }\r\n\r\n    get maxBounces() {\r\n        return this._maxBounces;\r\n    }\r\n\r\n\r\n    /**\r\n     * @internal\r\n     * @override\r\n     */\r\n    protected _addToLightQueue(): void {\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     * @override\r\n     */\r\n    protected _removeFromLightQueue(): void {\r\n    }\r\n\r\n    /**\r\n     * @inheritDoc\r\n     * @override\r\n     * @internal\r\n     */\r\n    _parse(data: any, spriteMap: any): void {\r\n        super._parse(data, spriteMap);\r\n        //this.range = data.range;\r\n    }\r\n    /**\r\n     * @inheritDoc\r\n     * @override\r\n     * @internal\r\n     */\r\n    _cloneTo(dest: AreaLightCom): void {\r\n        super._cloneTo(dest);\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    protected _create(): Component {\r\n        return new AreaLightCom();\r\n    }\r\n}\r\n\r\n","\r\nimport LensFlareVS from \"../../../../shader/files/postProcess/LensFlare/LensFlare.vs\";\r\nimport LensFlareFS from \"../../../../shader/files/postProcess/LensFlare/LensFlare.fs\";\r\nimport { Shader3D, ShaderFeatureType } from \"../../../../../RenderEngine/RenderShader/Shader3D\";\r\nimport { ShaderDataType } from \"../../../../../RenderEngine/RenderShader/ShaderData\";\r\nimport { SubShader } from \"../../../../../RenderEngine/RenderShader/SubShader\";\r\nimport { Color } from \"../../../../../maths/Color\";\r\nimport { LensFlareElementGeomtry } from \"./LensFlareGeometry\";\r\n\r\nexport class LensFlareShaderInit {\r\n\r\n    static init() {\r\n        let attribute: { [name: string]: [number, ShaderDataType] } = {\r\n            'a_PositionTexcoord': [LensFlareElementGeomtry.PositionUV, ShaderDataType.Vector4],\r\n            'a_DistanceRotationScale': [LensFlareElementGeomtry.PositionRotationScale, ShaderDataType.Vector4],\r\n        }\r\n        let uniformMap = {\r\n            \"u_Tint\": ShaderDataType.Color,\r\n            \"u_TintIntensity\": ShaderDataType.Float,\r\n            \"u_FlareTexture\": ShaderDataType.Texture2D,\r\n            \"u_FlareCenter\": ShaderDataType.Vector2,\r\n            \"u_aspectRatio\": ShaderDataType.Float,\r\n            \"u_rotate\": ShaderDataType.Float,\r\n            \"u_Postionoffset\": ShaderDataType.Vector2,\r\n            \"u_Angularoffset\": ShaderDataType.Float,\r\n        }\r\n        let defaultValue = {\r\n            \"u_Tint\": Color.WHITE,\r\n            \"u_aspectRatio\": 1\r\n        }\r\n        let shader = Shader3D.add(\"LensFlare\", true, false);\r\n        shader.shaderType = ShaderFeatureType.PostProcess;\r\n        let subshader = new SubShader(attribute, uniformMap, defaultValue)\r\n        shader.addSubShader(subshader);\r\n        subshader.addShaderPass(LensFlareVS, LensFlareFS);\r\n    }\r\n}","#define SHADER_NAME LENSFLARESFS\r\n\r\nvarying vec2 v_Texcoord0;\r\n\r\nvoid main(){\r\n      gl_FragColor = texture2D(u_FlareTexture, v_Texcoord0)* u_Tint * u_TintIntensity;\r\n}","import { Shader3D } from \"../../../../../RenderEngine/RenderShader/Shader3D\";\r\nimport { ShaderDefine } from \"../../../../../RenderEngine/RenderShader/ShaderDefine\";\r\nimport { Color } from \"../../../../../maths/Color\";\r\nimport { Vector2 } from \"../../../../../maths/Vector2\";\r\nimport { Vector3 } from \"../../../../../maths/Vector3\";\r\nimport { Vector4 } from \"../../../../../maths/Vector4\";\r\nimport { BaseTexture } from \"../../../../../resource/BaseTexture\";\r\nimport { RenderTexture } from \"../../../../../resource/RenderTexture\";\r\nimport { Resource } from \"../../../../../resource/Resource\";\r\nimport { Texture2D } from \"../../../../../resource/Texture2D\";\r\nimport { Utils } from \"../../../../../utils/Utils\";\r\nimport { PostProcess } from \"../../../../component/PostProcess\";\r\nimport { Camera } from \"../../../Camera\";\r\nimport { DirectionLightCom } from \"../../../light/DirectionLightCom\";\r\nimport { Light, LightType } from \"../../../light/Light\";\r\nimport { PostProcessEffect } from \"../../PostProcessEffect\";\r\nimport { PostProcessRenderContext } from \"../../PostProcessRenderContext\";\r\nimport { CommandBuffer } from \"../../command/CommandBuffer\";\r\nimport { LensFlareCMD } from \"./LensFlareCMD\";\r\nimport { LensFlareElementGeomtry } from \"./LensFlareGeometry\";\r\nimport { LensFlareShaderInit } from \"./LensFlareShaderInit\";\r\n\r\n\r\n/**\r\n * lens Flare Element\r\n * \r\n */\r\nexport class LensFlareElement {\r\n    /**@internal active*/\r\n    private _active: boolean = true;\r\n\r\n    /**@internal type*/\r\n    private _type: string = \"Image\";\r\n\r\n    /**@internal tintColor */\r\n    private _tint: Color = new Color(1, 1, 1, 1);\r\n\r\n    /**@internal intensity*/\r\n    private _intensity: number = 1;\r\n\r\n    /**@internal texture*/\r\n    private _texture: BaseTexture = Texture2D.whiteTexture;\r\n\r\n    /**@internal positionOffet In screen space */\r\n    private _positionOffset: Vector2 = new Vector2(0, 0);\r\n\r\n    /**@internal scale in each dimension */\r\n    private _scale: Vector2 = new Vector2(1, 1);\r\n\r\n    /**@internal */\r\n    private _autoRotate: boolean = false;\r\n\r\n    /**@internal rotation with angle */\r\n    private _rotation: number = 0;\r\n\r\n    //AxisTransform\r\n    private _startPosition: number = 0.0;\r\n\r\n    private _angularOffset: number = 0;//0-360\r\n\r\n    // TODO\r\n    /**@internal */\r\n    private _aspectRatio: boolean = false;\r\n    /**@internal */\r\n    private _modulateByLightColor: boolean = false;\r\n    /**@internal */\r\n    private _blendMode: any;\r\n    /**@internal */\r\n    private _translationScale: Vector2 = new Vector2(1, 1);\r\n    //elemet TODO\r\n    //TODO\r\n\r\n\r\n\r\n    /**\r\n     * \r\n     */\r\n    public get active(): boolean {\r\n        return this._active;\r\n    }\r\n    public set active(value: boolean) {\r\n        this._active = value;\r\n    }\r\n\r\n    /**\r\n     * \r\n     */\r\n    public get tint(): Color {\r\n        return this._tint;\r\n    }\r\n    public set tint(value: Color) {\r\n        this._tint = value;\r\n    }\r\n\r\n    /**\r\n     * \r\n     */\r\n    public get intensity(): number {\r\n        return this._intensity;\r\n    }\r\n    public set intensity(value: number) {\r\n        this._intensity = value;\r\n    }\r\n\r\n    /**\r\n     * \r\n     */\r\n    public get texture(): BaseTexture {\r\n        return this._texture;\r\n    }\r\n    public set texture(value: BaseTexture) {\r\n        this._texture = value;\r\n    }\r\n\r\n    /**\r\n     * ()\r\n     */\r\n    public get positionOffset(): Vector2 {\r\n        return this._positionOffset;\r\n    }\r\n    public set positionOffset(value: Vector2) {\r\n        this._positionOffset = value;\r\n    }\r\n\r\n    /**\r\n     * ()\r\n     */\r\n    public get scale(): Vector2 {\r\n        return this._scale;\r\n    }\r\n    public set scale(value: Vector2) {\r\n        this._scale = value;\r\n    }\r\n\r\n    /**\r\n     * \r\n     */\r\n    public get autoRotate(): boolean {\r\n        return this._autoRotate;\r\n    }\r\n    public set autoRotate(value: boolean) {\r\n        this._autoRotate = value;\r\n    }\r\n\r\n    /**\r\n     * \r\n     */\r\n    public get rotation(): number {\r\n        return this._rotation;\r\n    }\r\n    public set rotation(value: number) {\r\n        this._rotation = value;\r\n    }\r\n\r\n    /**\r\n     * \r\n     */\r\n    public get startPosition(): number {\r\n        return this._startPosition;\r\n    }\r\n    public set startPosition(value: number) {\r\n        this._startPosition = value;\r\n    }\r\n\r\n    /**\r\n     * \r\n     */\r\n    public get angularOffset(): number {\r\n        return this._angularOffset;\r\n    }\r\n    public set angularOffset(value: number) {\r\n        this._angularOffset = value;\r\n    }\r\n\r\n}\r\n\r\n/**\r\n * lens Flare Data \r\n * \r\n */\r\nexport class LensFlareData extends Resource {\r\n    constructor() {\r\n        super(false);\r\n    }\r\n\r\n    elements: LensFlareElement[] = [];\r\n}\r\n\r\n/**\r\n * lens Flare Element\r\n */\r\nexport class LensFlareEffect extends PostProcessEffect {\r\n    /**@interal */\r\n    static SHADERDEFINE_AUTOROTATE: ShaderDefine;\r\n\r\n    /**\r\n     * @internal\r\n     * initdefine\r\n     */\r\n    static __initDefine__() {\r\n        LensFlareEffect.SHADERDEFINE_AUTOROTATE = Shader3D.getDefineByName(\"LENSFLAREAUTOROTATE\");\r\n    }\r\n\r\n    /**\r\n     * init Shader\\Geometry\r\n     */\r\n    static init() {\r\n        LensFlareElementGeomtry.init();\r\n        LensFlareShaderInit.init();\r\n        LensFlareEffect.__initDefine__();\r\n    }\r\n\r\n    /**@internal */\r\n    private _tempV3: Vector3;\r\n\r\n    /**@internal */\r\n    private _tempV4: Vector4;\r\n\r\n    /**@internal */\r\n    private _flareCMDS: LensFlareCMD[];\r\n\r\n    /**@internal */\r\n    private _center: Vector2;\r\n\r\n    /**@internal */\r\n    private _rotate: number\r\n\r\n    /**@internal */\r\n    private _light: Light;\r\n\r\n    /**@internal */\r\n    private _effectIntensity: number = 1;\r\n\r\n    /**@internal */\r\n    private _effectScale: number = 1;\r\n\r\n    /**@internal */\r\n    private _needUpdate: boolean = false;\r\n\r\n    /**@internal */\r\n    _lensFlareData: LensFlareData;\r\n\r\n    /**\r\n     * LensFlareData\r\n     */\r\n    set lensFlareData(value: LensFlareData) {\r\n        if (!value) return;\r\n        this._flareCMDS.length = 0;\r\n        for (let i = 0; i < value.elements.length; i++) {\r\n            let ele = value.elements[i];\r\n            if (!ele.active) continue;\r\n            var cmd = new LensFlareCMD();\r\n            cmd.lensFlareElement = ele;\r\n            this._flareCMDS.push(cmd);\r\n        }\r\n        this._lensFlareData = value;\r\n        this._needUpdate = true;\r\n    }\r\n\r\n    get lensFlareData(): LensFlareData {\r\n        return this._lensFlareData;\r\n    }\r\n\r\n    /**\r\n     * bind light\r\n     */\r\n    set bindLight(light: Light) {\r\n        if (!light)\r\n            return;\r\n        this._light = light;//TODO\r\n        this._needUpdate = true;\r\n    }\r\n\r\n    get bindLight(): Light {\r\n        return this._light;\r\n    }\r\n\r\n    /**\r\n     * \r\n     */\r\n    public get effectIntensity(): number {\r\n        return this._effectIntensity;\r\n    }\r\n    public set effectIntensity(value: number) {\r\n        this._effectIntensity = value;\r\n        this._needUpdate = true;\r\n    }\r\n\r\n    /**\r\n     * \r\n     */\r\n    public get effectScale(): number {\r\n        return this._effectScale;\r\n    }\r\n    public set effectScale(value: number) {\r\n        this._effectScale = value;\r\n        this._needUpdate = true;\r\n    }\r\n\r\n    constructor() {\r\n        super();\r\n        this.singleton = false;\r\n        this._flareCMDS = [];\r\n        this._flareCMDS.push(new LensFlareCMD());\r\n        this._center = new Vector2();\r\n        this._tempV3 = new Vector3();\r\n        this._tempV4 = new Vector4();\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     * \r\n     */\r\n    _updateEffectData(cmd: CommandBuffer) {\r\n        if (this._flareCMDS.length == 0) return;\r\n        for (let i = 0; i < this._flareCMDS.length; i++) {\r\n            this._flareCMDS[i].center = this._center;//set center\r\n            this._flareCMDS[i].rotate = this._rotate;//set rotate\r\n            if (this._needUpdate) {\r\n                let cmdEle = this._flareCMDS[i].lensFlareElement;\r\n                if (!cmdEle) continue;\r\n                cmdEle.intensity *= this.effectIntensity;\r\n                let scale = cmdEle.scale;\r\n                scale.setValue(scale.x * this.effectScale, scale.y * this.effectScale);\r\n                cmdEle.scale = scale;\r\n                this._flareCMDS[i].applyElementData();\r\n            }\r\n            cmd.addCustomCMD(this._flareCMDS[i]);\r\n        }\r\n        this._needUpdate = false;\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @param camera \r\n     */\r\n    caculateDirCenter(camera: Camera) {\r\n        //center caculate start\r\n        // lightDirection\r\n        (this._light as DirectionLightCom)._direction.cloneTo(this._tempV3);\r\n        // lightDir revert\r\n        Vector3.scale(this._tempV3, -10, this._tempV3);\r\n        // offset of light to camera\r\n        Vector3.add(camera.transform.position, this._tempV3, this._tempV3);\r\n        // to screen space\r\n        Vector3.transformV3ToV4(this._tempV3, camera.projectionViewMatrix, this._tempV4);\r\n        // normalize x\\y coordinate\r\n        this._center.setValue(this._tempV4.x / this._tempV4.w, this._tempV4.y / this._tempV4.w);\r\n        // angle caculatge\r\n        var angle: number = Utils.toAngle(Math.atan2(this._center.x, this._center.y));\r\n        // angle round\r\n        angle = (angle < 0) ? angle + 360 : angle;\r\n        angle = Math.round(angle);\r\n        this._rotate = Math.PI * 2.0 - Math.PI / 180 * angle;\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @param camera \r\n     */\r\n    caculatePointCenter(camera: Camera) {\r\n        //TODO\r\n        this._needUpdate = true;\r\n    }\r\n\r\n    /**\r\n     * spot\r\n     * @param value \r\n     */\r\n    caculateSpotCenter(value: Vector2) {\r\n        //TODO\r\n        this._needUpdate = true;\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @param context \r\n     * @returns \r\n     */\r\n    render(context: PostProcessRenderContext) {\r\n        var cmd: CommandBuffer = context.command;\r\n        let source: RenderTexture = context.indirectTarget;\r\n        cmd.setRenderTarget(source);\r\n        if (!this._light)\r\n            return;\r\n        switch (this._light.lightType) {\r\n            case LightType.Directional:\r\n                this.caculateDirCenter(context.camera);\r\n                break;\r\n            case LightType.Point:\r\n                //TODO\r\n                break;\r\n            case LightType.Spot:\r\n                //TODO\r\n                break;\r\n        }\r\n        if (Math.abs(this._center.x) > 1.0 || Math.abs(this._center.y) > 1.0) return;\r\n        this._updateEffectData(cmd);\r\n        cmd.blitScreenQuad(source, context.destination);\r\n    }\r\n\r\n    /**\r\n   * Effect\r\n   * @inheritDoc\r\n   * @override\r\n   */\r\n    release(postprocess: PostProcess) {\r\n        //TODO\r\n        this._needUpdate = false;\r\n    }\r\n}","import { Config3D } from \"./Config3D\";\r\nimport { ILaya3D } from \"./ILaya3D\";\r\nimport { PostProcess } from \"./laya/d3/component/PostProcess\";\r\nimport { BlinnPhongMaterial } from \"./laya/d3/core/material/BlinnPhongMaterial\";\r\nimport { PBRMaterial } from \"./laya/d3/core/material/PBRMaterial\";\r\nimport { PBRStandardMaterial } from \"./laya/d3/core/material/PBRStandardMaterial\";\r\nimport { SkyBoxMaterial } from \"./laya/d3/core/material/SkyBoxMaterial\";\r\nimport { SkyProceduralMaterial } from \"./laya/d3/core/material/SkyProceduralMaterial\";\r\nimport { UnlitMaterial } from \"./laya/d3/core/material/UnlitMaterial\";\r\nimport { MeshRenderer } from \"./laya/d3/core/MeshRenderer\";\r\nimport { MeshSprite3D } from \"./laya/d3/core/MeshSprite3D\";\r\nimport { ShuriKenParticle3D } from \"./laya/d3/core/particleShuriKen/ShuriKenParticle3D\";\r\nimport { ShurikenParticleMaterial } from \"./laya/d3/core/particleShuriKen/ShurikenParticleMaterial\";\r\nimport { PixelLineVertex } from \"./laya/d3/core/pixelLine/PixelLineVertex\";\r\nimport { Command } from \"./laya/d3/core/render/command/Command\";\r\nimport { RenderContext3D } from \"./laya/d3/core/render/RenderContext3D\";\r\nimport { ScreenQuad } from \"./laya/d3/core/render/ScreenQuad\";\r\nimport { RenderableSprite3D } from \"./laya/d3/core/RenderableSprite3D\";\r\nimport { Scene3D } from \"./laya/d3/core/scene/Scene3D\";\r\nimport { SkinnedMeshSprite3D } from \"./laya/d3/core/SkinnedMeshSprite3D\";\r\nimport { Sprite3D } from \"./laya/d3/core/Sprite3D\";\r\nimport { TrailMaterial } from \"./laya/d3/core/trail/TrailMaterial\";\r\nimport { TrailSprite3D } from \"./laya/d3/core/trail/TrailSprite3D\";\r\nimport { VertexTrail } from \"./laya/d3/core/trail/VertexTrail\";\r\nimport { FrustumCulling } from \"./laya/d3/graphics/FrustumCulling\";\r\nimport { SubMeshInstanceBatch } from \"./laya/d3/graphics/SubMeshInstanceBatch\";\r\nimport { VertexPositionTerrain } from \"./laya/d3/graphics/Vertex/VertexPositionTerrain\";\r\nimport { VertexPositionTexture0 } from \"./laya/d3/graphics/Vertex/VertexPositionTexture0\";\r\nimport { VertexShurikenParticleBillboard } from \"./laya/d3/graphics/Vertex/VertexShurikenParticleBillboard\";\r\nimport { VertexShurikenParticleMesh } from \"./laya/d3/graphics/Vertex/VertexShurikenParticleMesh\";\r\nimport { Mesh } from \"./laya/d3/resource/models/Mesh\";\r\nimport { PrimitiveMesh } from \"./laya/d3/resource/models/PrimitiveMesh\";\r\nimport { SkyBox } from \"./laya/d3/resource/models/SkyBox\";\r\nimport { SkyDome } from \"./laya/d3/resource/models/SkyDome\";\r\nimport { TextureCube } from \"./laya/resource/TextureCube\";\r\nimport { ShaderInit3D } from \"./laya/d3/shader/ShaderInit3D\";\r\nimport { Texture2D } from \"./laya/resource/Texture2D\";\r\nimport { WebGL } from \"./laya/webgl/WebGL\";\r\nimport { ShadowUtils } from \"./laya/d3/core/light/ShadowUtils\";\r\nimport { ShadowCasterPass } from \"./laya/d3/shadowMap/ShadowCasterPass\";\r\nimport { SimpleSkinnedMeshSprite3D } from \"./laya/d3/core/SimpleSkinnedMeshSprite3D\";\r\nimport { HalfFloatUtils } from \"./laya/utils/HalfFloatUtils\";\r\nimport { Camera } from \"./laya/d3/core/Camera\";\r\nimport { BaseCamera } from \"./laya/d3/core/BaseCamera\";\r\nimport { ShuriKenParticle3DShaderDeclaration } from \"./laya/d3/core/particleShuriKen/ShuriKenParticle3DShaderDeclaration\";\r\nimport { BaseRender } from \"./laya/d3/core/render/BaseRender\";\r\nimport { TrailFilter } from \"./laya/d3/core/trail/TrailFilter\";\r\nimport { DepthPass } from \"./laya/d3/depthMap/DepthPass\";\r\nimport { RenderCapable } from \"./laya/RenderEngine/RenderEnum/RenderCapable\";\r\nimport { BlitFrameBufferCMD } from \"./laya/d3/core/render/command/BlitFrameBufferCMD\";\r\nimport { SkyRenderer } from \"./laya/d3/resource/models/SkyRenderer\";\r\nimport { SkyPanoramicMaterial } from \"./laya/d3/core/material/SkyPanoramicMaterial\";\r\nimport { BloomEffect } from \"./laya/d3/core/render/PostEffect/BloomEffect\";\r\nimport { ScalableAO } from \"./laya/d3/core/render/PostEffect/ScalableAO\";\r\nimport { GaussianDoF } from \"./laya/d3/core/render/PostEffect/GaussianDoF\";\r\nimport { VertexMesh } from \"./laya/RenderEngine/RenderShader/VertexMesh\";\r\nimport { RenderTexture } from \"./laya/resource/RenderTexture\";\r\nimport { ColorGradEffect } from \"./laya/d3/core/render/PostEffect/ColorGradEffect\";\r\nimport { LensFlareEffect } from \"./laya/d3/core/render/PostEffect/LensFlares/LensFlareEffect\";\r\nimport { IPhysicsCreateUtil } from \"./laya/Physics3D/interface/IPhysicsCreateUtil\";\r\nimport { LayaGL } from \"./laya/layagl/LayaGL\";\r\nimport { Laya } from \"./Laya\";\r\nimport { Texture2DArray } from \"./laya/resource/Texture2DArray\";\r\n\r\n/**\r\n * <code>Laya3D</code> 3D\r\n */\r\nexport class Laya3D {\r\n    /** */\r\n    static _PhysicsCreateUtil: IPhysicsCreateUtil;\r\n\r\n    /**@internal */\r\n    static _enablePhysics: boolean = false;\r\n\r\n    /**\r\n     * \r\n     */\r\n    static set PhysicsCreateUtil(value: IPhysicsCreateUtil) {\r\n        if (value && !Laya3D._PhysicsCreateUtil) {\r\n            Laya3D._PhysicsCreateUtil = value;\r\n            Laya3D._enablePhysics = true;\r\n        }\r\n    }\r\n\r\n    static get PhysicsCreateUtil() {\r\n        return this._PhysicsCreateUtil;\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @param \r\n     */\r\n    static get enablePhysics(): any {\r\n        return Laya3D._enablePhysics;\r\n    }\r\n\r\n    /**\r\n     *@internal\r\n     */\r\n    static _changeWebGLSize(width: number, height: number): void {\r\n        WebGL.onStageResize(width, height);\r\n        RenderContext3D.clientWidth = width;\r\n        RenderContext3D.clientHeight = height;\r\n    }\r\n\r\n    /**\r\n     *@internal\r\n     */\r\n    static __init__() {\r\n        Config3D._multiLighting = Config3D.enableMultiLight && LayaGL.renderEngine.getCapable(RenderCapable.TextureFormat_R32G32B32A32);\r\n        Config3D._uniformBlock = Config3D.enableUniformBufferObject && LayaGL.renderEngine.getCapable(RenderCapable.UnifromBufferObject);\r\n\r\n        if (Config3D.maxLightCount > 2048) {\r\n            Config3D.maxLightCount = 2048;\r\n            console.warn(\"Config3D: maxLightCount must less equal 2048.\");\r\n        }\r\n\r\n        let lcc = Config3D.lightClusterCount;\r\n        if (lcc.x > 128 || lcc.y > 128 || lcc.z > 128) {\r\n            lcc.setValue(Math.min(lcc.x, 128), Math.min(lcc.y, 128), Math.min(lcc.z, 128));\r\n            console.warn(\"Config3D: lightClusterCount X and YZ must less equal 128.\");\r\n        }\r\n\r\n        let maxAreaLightCountWithZ = Math.floor(2048 / Config3D.lightClusterCount.z - 1) * 4;\r\n        if (maxAreaLightCountWithZ < Config3D.maxLightCount)\r\n            console.warn(\"Config3D: if the area light(PointLightSpotLight) count is large than \" + maxAreaLightCountWithZ + \",maybe the far away culster will ingonre some light.\");\r\n        Config3D._maxAreaLightCountPerClusterAverage = Math.min(maxAreaLightCountWithZ, Config3D.maxLightCount);\r\n\r\n        ILaya3D.Scene3D = Scene3D;\r\n        ILaya3D.Laya3D = Laya3D;\r\n        VertexMesh.__init__();\r\n        VertexShurikenParticleBillboard.__init__();\r\n        VertexShurikenParticleMesh.__init__();\r\n        VertexPositionTexture0.__init__();\r\n        VertexTrail.__init__();\r\n        VertexPositionTerrain.__init__();\r\n        PixelLineVertex.__init__();\r\n        SubMeshInstanceBatch.__init__();\r\n        ShaderInit3D.__init__();\r\n        ShuriKenParticle3DShaderDeclaration.__init__();\r\n        SimpleSkinnedMeshSprite3D.__init__();\r\n        PBRMaterial.__init__();\r\n        PBRStandardMaterial.__init__();\r\n        SkyPanoramicMaterial.__init__();\r\n        BloomEffect.init();\r\n        ScalableAO.init();\r\n        GaussianDoF.init();\r\n        ColorGradEffect.init();\r\n        LensFlareEffect.init();\r\n\r\n        Mesh.__init__();\r\n        PrimitiveMesh.__init__();\r\n        Sprite3D.__init__();\r\n        RenderableSprite3D.__init__();\r\n        MeshSprite3D.__init__();\r\n        DepthPass.__init__();\r\n        SkinnedMeshSprite3D.__init__();\r\n        SimpleSkinnedMeshSprite3D.__init__();\r\n        TrailFilter.__init__();\r\n        ShuriKenParticle3D.__init__();\r\n        TrailSprite3D.__init__();\r\n        PostProcess.__init__();\r\n        Scene3D.__init__();\r\n        ShadowCasterPass.__init__();\r\n        BaseCamera.__init__();\r\n        BaseRender.__init__();\r\n        MeshRenderer.__init__();\r\n        SkyRenderer.__init__();\r\n        Camera.__init__();\r\n        ShadowUtils.init();\r\n        RenderContext3D.__init__();\r\n        RenderTexture.configRenderContextInstance(RenderContext3D._instance);\r\n        BlinnPhongMaterial.__initDefine__();\r\n        SkyProceduralMaterial.__initDefine__();\r\n        UnlitMaterial.__initDefine__();\r\n        TrailMaterial.__initDefine__();\r\n        ShurikenParticleMaterial.__initDefine__();\r\n        SkyBoxMaterial.__initDefine__();\r\n        Command.__init__();\r\n        BlitFrameBufferCMD.__init__();\r\n        BlinnPhongMaterial.defaultMaterial = new BlinnPhongMaterial();\r\n        BlinnPhongMaterial.defaultMaterial.lock = true;\r\n        ShurikenParticleMaterial.defaultMaterial = new ShurikenParticleMaterial();\r\n        ShurikenParticleMaterial.defaultMaterial.lock = true;\r\n        TrailMaterial.defaultMaterial = new TrailMaterial();\r\n        TrailMaterial.defaultMaterial.lock = true;\r\n        Texture2D.__init__();\r\n        TextureCube.__init__();\r\n        Texture2DArray.__init__();\r\n        SkyBox.__init__();\r\n        SkyDome.__init__();\r\n        ScreenQuad.__init__();\r\n        FrustumCulling.__init__();\r\n        HalfFloatUtils.__init__();\r\n    }\r\n\r\n    /**\r\n     *@internal\r\n    */\r\n    static __initPhysics__(): Promise<void> {\r\n        if (!Laya3D._PhysicsCreateUtil) {\r\n            Laya3D._enablePhysics = false;\r\n            return Promise.resolve();\r\n        }\r\n        else {\r\n            Laya3D._enablePhysics = true;\r\n            return Laya3D._PhysicsCreateUtil.initialize();\r\n        }\r\n    }\r\n}\r\n\r\n(window as any).Laya3D = Laya3D;\r\nLaya.addInitCallback(() => Laya3D.__initPhysics__());","import { Scene3D } from \"../scene/Scene3D\";\r\nimport { ShadowCascadesMode } from \"./ShadowCascadesMode\";\r\nimport { Light, LightType } from \"./Light\";\r\nimport { Vector3 } from \"../../../maths/Vector3\";\r\n\r\n\r\n/**\r\n * <code>DirectionLight</code> \r\n */\r\nexport class DirectionLightCom extends Light {\r\n\t/** @internal */\r\n\t_direction: Vector3 = new Vector3();\r\n\t/** @internal */\r\n\t_shadowCascadesMode: ShadowCascadesMode = ShadowCascadesMode.NoCascades;\r\n\t/** @internal */\r\n\t_shadowTwoCascadeSplits: number = 1.0 / 3.0;\r\n\t/** @internal */\r\n\t_shadowFourCascadeSplits: Vector3 = new Vector3(1.0 / 15, 3.0 / 15.0, 7.0 / 15.0);\r\n\r\n\t/**\r\n\t * \r\n\t */\r\n\tget shadowCascadesMode(): ShadowCascadesMode {\r\n\t\treturn this._shadowCascadesMode;\r\n\t}\r\n\r\n\tset shadowCascadesMode(value: ShadowCascadesMode) {\r\n\t\tthis._shadowCascadesMode = value;\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t */\r\n\tget shadowTwoCascadeSplits(): number {\r\n\t\treturn this._shadowTwoCascadeSplits;\r\n\t}\r\n\r\n\tset shadowTwoCascadeSplits(value: number) {\r\n\t\tthis._shadowTwoCascadeSplits = value;\r\n\t}\r\n\r\n\t/**\r\n\t * ,XYZ,ZY,YX\r\n\t */\r\n\tget shadowFourCascadeSplits(): Vector3 {\r\n\t\treturn this._shadowFourCascadeSplits;\r\n\t}\r\n\r\n\tset shadowFourCascadeSplits(value: Vector3) {\r\n\t\tif (value.x > value.y || value.y > value.z || value.z > 1.0)\r\n\t\t\tthrow \"DiretionLight:Invalid value.\";\r\n\t\tvalue.cloneTo(this._shadowFourCascadeSplits);\r\n\t}\r\n\r\n\t/**\r\n\t *  <code>DirectionLight</code> \r\n\t */\r\n\tconstructor() {\r\n\t\tsuper();\r\n\t\tthis._lightType = LightType.Directional;\r\n\t}\r\n\r\n\t/**\r\n\t * @internal\r\n\t * @override\r\n\t */\r\n\tprotected _addToLightQueue(): void {\r\n\t\t(<Scene3D>this.owner.scene)._directionLights.add(this);\r\n\t}\r\n\r\n\t/**\r\n\t * @internal\r\n\t * @override\r\n\t */\r\n\tprotected _removeFromLightQueue(): void {\r\n\t\t(<Scene3D>this.owner.scene)._directionLights.remove(this);\r\n\t}\r\n\r\n\t/**\r\n\t * @internal\r\n\t */\r\n\tprotected _create(): DirectionLightCom {\r\n\t\treturn new DirectionLightCom();\r\n\t}\r\n}\r\n\r\n","import { Node } from \"../../../display/Node\";\r\nimport { Sprite3D } from \"../Sprite3D\";\r\nimport { ShadowMode } from \"./ShadowMode\";\r\nimport { Light, LightMode } from \"./Light\";\r\nimport { Color } from \"../../../maths/Color\";\r\nimport { Matrix4x4 } from \"../../../maths/Matrix4x4\";\r\n\r\n/**\r\n * @deprecated\r\n * <code>LightSprite</code> \r\n */\r\nexport class LightSprite extends Sprite3D {\r\n\t/** @internal */\r\n\t_light: Light;\r\n\t/**\r\n\t * \r\n\t */\r\n\tget color(): Color {\r\n\t\treturn this._light.color;\r\n\t}\r\n\r\n\tset color(value: Color) {\r\n\t\tthis._light.color = value;\r\n\t}\r\n\r\n\tget mode(): LightMode {\r\n\t\treturn this._light.lightmapBakedType;\r\n\t}\r\n\r\n\tset mode(value: LightMode) {\r\n\t\tthis._light.lightmapBakedType = value;\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t */\r\n\tget intensity(): number {\r\n\t\treturn this._light.intensity;\r\n\t}\r\n\r\n\tset intensity(value: number) {\r\n\t\tthis._light.intensity = value;\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t */\r\n\tget shadowMode(): ShadowMode {\r\n\t\treturn this._light.shadowMode;\r\n\t}\r\n\r\n\tset shadowMode(value: ShadowMode) {\r\n\t\tthis._light.shadowMode = value\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t */\r\n\tget shadowDistance(): number {\r\n\t\treturn this._light.shadowDistance;\r\n\t}\r\n\r\n\tset shadowDistance(value: number) {\r\n\t\tthis._light.shadowDistance = value;\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t */\r\n\tget shadowResolution(): number {\r\n\t\treturn this._light.shadowResolution;\r\n\t}\r\n\r\n\tset shadowResolution(value: number) {\r\n\t\tthis._light.shadowResolution = value;\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t */\r\n\tget shadowDepthBias(): number {\r\n\t\treturn this._light.shadowDepthBias;\r\n\t}\r\n\r\n\tset shadowDepthBias(value: number) {\r\n\t\tthis._light.shadowDepthBias = value;\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t */\r\n\tget shadowNormalBias(): number {\r\n\t\treturn this._light.shadowNormalBias;\r\n\t}\r\n\r\n\tset shadowNormalBias(value: number) {\r\n\t\tthis._light.shadowNormalBias = value;\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t */\r\n\tget shadowStrength(): number {\r\n\t\treturn this._light.shadowStrength;\r\n\t}\r\n\r\n\tset shadowStrength(value: number) {\r\n\t\tthis._light.shadowStrength = value;\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t */\r\n\tget shadowNearPlane(): number {\r\n\t\treturn this._light.shadowNearPlane;\r\n\t}\r\n\r\n\tset shadowNearPlane(value: number) {\r\n\t\tthis._light.shadowNearPlane = value;\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t */\r\n\tget lightmapBakedType(): number {\r\n\t\treturn this._light.lightmapBakedType;\r\n\t}\r\n\r\n\tset lightmapBakedType(value: number) {\r\n\t\tthis._light.lightmapBakedType = value;\r\n\t}\r\n\r\n\tget lightWorldMatrix(): Matrix4x4 {\r\n\t\treturn this._light.lightWorldMatrix;\r\n\t}\r\n\r\n\t/**\r\n\t *  <code>LightSprite</code> \r\n\t */\r\n\tconstructor() {\r\n\t\tsuper();\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t * @override\r\n\t * @internal\r\n\t */\r\n\t_parse(data: any, spriteMap: any): void {\r\n\t\tsuper._parse(data, spriteMap);\r\n\t\tvar colorData: any[] = data.color;\r\n\t\tthis.color.r = colorData[0];\r\n\t\tthis.color.g = colorData[1];\r\n\t\tthis.color.b = colorData[2];\r\n\t\tthis.intensity = data.intensity;\r\n\t\tthis.lightmapBakedType = data.lightmapBakedType;\r\n\t}\r\n\t/**\r\n\t * @inheritDoc\r\n\t * @override\r\n\t * @internal\r\n\t */\r\n\t_cloneTo(destObject: any, rootSprite: Node, dstSprite: Node) {\r\n\t\tsuper._cloneTo(destObject, rootSprite, dstSprite);\r\n\t\tvar spriteLight = <LightSprite>destObject;\r\n\t\tspriteLight.color = this.color.clone();\r\n\t\tspriteLight.intensity = this.intensity;\r\n\t\tspriteLight.lightmapBakedType = this.lightmapBakedType;\r\n\t}\r\n\r\n\t/**\r\n\t * @internal\r\n\t */\r\n\tprotected _addToLightQueue(): void {\r\n\t}\r\n\r\n\t/**\r\n\t * @internal\r\n\t */\r\n\tprotected _removeFromLightQueue(): void {\r\n\t}\r\n\r\n\t/**\r\n\t * @internal\r\n\t */\r\n\tprotected _create(): Node {\r\n\t\treturn new Sprite3D();\r\n\t}\r\n}\r\n\r\n","import { ShadowCascadesMode } from \"./ShadowCascadesMode\";\r\nimport { Node } from \"../../../display/Node\";\r\nimport { DirectionLightCom } from \"./DirectionLightCom\";\r\nimport { LightSprite } from \"./LightSprite\";\r\nimport { Sprite3D } from \"../Sprite3D\";\r\nimport { Vector3 } from \"../../../maths/Vector3\";\r\n\r\n/**\r\n * @deprecated\r\n * <code>DirectionLight</code> \r\n */\r\nexport class DirectionLight extends LightSprite {\r\n\r\n\t/** @internal */\r\n\t_light: DirectionLightCom;\r\n\r\n\t/**\r\n\t * \r\n\t */\r\n\tget shadowCascadesMode(): ShadowCascadesMode {\r\n\t\treturn this._light._shadowCascadesMode;\r\n\t}\r\n\r\n\tset shadowCascadesMode(value: ShadowCascadesMode) {\r\n\t\tthis._light._shadowCascadesMode = value;\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t */\r\n\tget shadowTwoCascadeSplits(): number {\r\n\t\treturn this._light._shadowTwoCascadeSplits;\r\n\t}\r\n\r\n\tset shadowTwoCascadeSplits(value: number) {\r\n\t\tthis._light._shadowTwoCascadeSplits = value;\r\n\t}\r\n\r\n\t/**\r\n\t * ,XYZ,ZY,YX\r\n\t */\r\n\tget shadowFourCascadeSplits(): Vector3 {\r\n\t\treturn this._light._shadowFourCascadeSplits;\r\n\t}\r\n\r\n\tset shadowFourCascadeSplits(value: Vector3) {\r\n\t\tif (value.x > value.y || value.y > value.z || value.z > 1.0)\r\n\t\t\tthrow \"DiretionLight:Invalid value.\";\r\n\t\tvalue.cloneTo(this._light._shadowFourCascadeSplits);\r\n\t}\r\n\r\n\t/**\r\n\t *  <code>DirectionLight</code> \r\n\t */\r\n\tconstructor() {\r\n\t\tsuper();\r\n\t\tthis._light = this.addComponent(DirectionLightCom);\r\n\t}\r\n\r\n\r\n\t/**\r\n\t * @internal\r\n\t */\r\n\tprotected _create(): Node {\r\n\t\treturn new Sprite3D();\r\n\t}\r\n}\r\n\r\n","import { Component } from \"../../../components/Component\";\r\nimport { Light, LightType } from \"./Light\";\r\n\r\n\r\nexport class PointLightCom extends Light {\r\n    /** @internal */\r\n    private _range: number;\r\n\r\n    /**\r\n     * \r\n     * @return \r\n     */\r\n    get range(): number {\r\n        return this._range;\r\n    }\r\n\r\n    set range(value: number) {\r\n        this._range = value;\r\n    }\r\n\r\n    /**\r\n     *  <code>PointLight</code> \r\n     */\r\n    constructor() {\r\n        super();\r\n        this._range = 6.0;\r\n        this._lightType = LightType.Point;\r\n    }\r\n\r\n\r\n    /**\r\n     * @internal\r\n     * @override\r\n     */\r\n    protected _addToLightQueue(): void {\r\n        this.owner.scene._pointLights.add(this);\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     * @override\r\n     */\r\n    protected _removeFromLightQueue(): void {\r\n        this.owner.scene._pointLights.remove(this);\r\n    }\r\n\r\n    /**\r\n     * @inheritDoc\r\n     * @override\r\n     * @internal\r\n     */\r\n    _parse(data: any, spriteMap: any): void {\r\n        super._parse(data, spriteMap);\r\n        this.range = data.range;\r\n    }\r\n    /**\r\n     * @inheritDoc\r\n     * @override\r\n     * @internal\r\n     */\r\n    _cloneTo(dest: PointLightCom): void {\r\n        super._cloneTo(dest);\r\n        var pointlight = dest as PointLightCom;\r\n        pointlight.range = this.range;\r\n        pointlight._lightType = LightType.Point;\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    protected _create(): Component {\r\n        return new PointLightCom();\r\n    }\r\n\r\n}","import { Node } from \"../../../display/Node\"\r\nimport { PointLightCom } from \"./PointLightCom\";\r\nimport { LightSprite } from \"./LightSprite\";\r\nimport { Sprite3D } from \"../Sprite3D\";\r\n/**\r\n * @deprecated\r\n * <code>PointLight</code> \r\n */\r\nexport class PointLight extends LightSprite {\r\n\r\n\t/**@internal */\r\n\t_light: PointLightCom;\r\n\r\n\t/**\r\n\t * \r\n\t * @return \r\n\t */\r\n\tget range(): number {\r\n\t\treturn this._light.range;\r\n\t}\r\n\r\n\tset range(value: number) {\r\n\t\tthis._light.range = value;\r\n\t}\r\n\r\n\t/**\r\n\t *  <code>PointLight</code> \r\n\t */\r\n\tconstructor() {\r\n\t\tsuper();\r\n\t\tthis._light = this.addComponent(PointLightCom);\r\n\t\tthis._light.range = 6.0;\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t * @override\r\n\t * @internal\r\n\t */\r\n\t_parse(data: any, spriteMap: any): void {\r\n\t\tsuper._parse(data, spriteMap);\r\n\t\tthis.range = data.range;\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t * @override\r\n\t * @internal\r\n\t */\r\n\t_cloneTo(destObject: any, rootSprite: Node, dstSprite: Node) {\r\n\t\tsuper._cloneTo(destObject, rootSprite, dstSprite);\r\n\t}\r\n\r\n\t/**\r\n\t * @internal\r\n\t */\r\n\tprotected _create(): Node {\r\n\t\treturn new Sprite3D();\r\n\t}\r\n}\r\n\r\n","import { Scene3D } from \"../scene/Scene3D\";\r\nimport { Light, LightType } from \"./Light\";\r\nimport { Component } from \"../../../components/Component\";\r\nimport { Vector3 } from \"../../../maths/Vector3\";\r\n\r\n/**\r\n * <code>SpotLight</code> \r\n */\r\nexport class SpotLightCom extends Light {\r\n\t/** @internal */\r\n\tprivate _spotAngle: number;\r\n\t/** @internal */\r\n\tprivate _range: number;\r\n\r\n\t/** @internal */\r\n\tpublic _direction: Vector3;\r\n\r\n\t/**\r\n\t  * \r\n\t  */\r\n\tget spotAngle(): number {\r\n\t\treturn this._spotAngle;\r\n\t}\r\n\r\n\tset spotAngle(value: number) {\r\n\t\tthis._spotAngle = Math.max(Math.min(value, 179), 0);\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t */\r\n\tget range(): number {\r\n\t\treturn this._range;\r\n\t}\r\n\r\n\tset range(value: number) {\r\n\t\tthis._range = value;\r\n\t}\r\n\r\n\t/**\r\n\t *  <code>SpotLight</code> \r\n\t */\r\n\tconstructor() {\r\n\t\tsuper();\r\n\t\tthis._spotAngle = 30.0;\r\n\t\tthis._range = 10.0;\r\n\t\tthis._direction = new Vector3();\r\n\t\tthis._lightType = LightType.Spot;\r\n\t}\r\n\r\n\t/**\r\n\t * @internal\r\n\t * @override\r\n\t */\r\n\tprotected _addToLightQueue(): void {\r\n\t\t(<Scene3D>this.owner.scene)._spotLights.add(this);\r\n\t}\r\n\r\n\t/**\r\n\t * @internal\r\n\t * @override\r\n\t */\r\n\tprotected _removeFromLightQueue(): void {\r\n\t\t(<Scene3D>this.owner.scene)._spotLights.remove(this);\r\n\t}\r\n\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t * @override\r\n\t * @internal\r\n\t */\r\n\t_parse(data: any, spriteMap: any): void {\r\n\t\tsuper._parse(data, spriteMap);\r\n\t\tthis.range = data.range;\r\n\t\tthis.spotAngle = data.spotAngle;\r\n\t}\r\n\t/**\r\n\t * @inheritDoc\r\n\t * @override\r\n\t * @internal\r\n\t */\r\n\t_cloneTo(dest: Component): void {\r\n\t\tsuper._cloneTo(dest);\r\n\t\tvar spotLight = <SpotLightCom>dest;\r\n\t\tspotLight.range = this.range;\r\n\t\tspotLight.spotAngle = this.spotAngle;\r\n\t}\r\n\r\n\r\n\t/**\r\n\t * @internal\r\n\t */\r\n\tprotected _create(): Component {\r\n\t\treturn new SpotLightCom();\r\n\t}\r\n\r\n}\r\n\r\n\r\n","import { Node } from \"../../../display/Node\";\r\nimport { Sprite3D } from \"../Sprite3D\";\r\nimport { LightSprite } from \"./LightSprite\";\r\nimport { SpotLightCom } from \"./SpotLightCom\";\r\n\r\n/**\r\n * @deprecated\r\n * <code>SpotLight</code> \r\n */\r\nexport class SpotLight extends LightSprite {\r\n\t/**@internal */\r\n\t_light: SpotLightCom;\r\n\r\n\t/**\r\n\t  * \r\n\t  */\r\n\tget spotAngle(): number {\r\n\t\treturn this._light.spotAngle;\r\n\t}\r\n\r\n\tset spotAngle(value: number) {\r\n\t\tthis._light.spotAngle = Math.max(Math.min(value, 179), 0);\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t */\r\n\tget range(): number {\r\n\t\treturn this._light.range;\r\n\t}\r\n\r\n\tset range(value: number) {\r\n\t\tthis._light.range = value;\r\n\t}\r\n\r\n\t/**\r\n\t *  <code>SpotLight</code> \r\n\t */\r\n\tconstructor() {\r\n\t\tsuper();\r\n\t\tthis._light = this.addComponent(SpotLightCom);\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t * @override\r\n\t * @internal\r\n\t */\r\n\t_parse(data: any, spriteMap: any): void {\r\n\t\tsuper._parse(data, spriteMap);\r\n\t\tthis.range = data.range;\r\n\t\tthis.spotAngle = data.spotAngle;\r\n\t}\r\n\t/**\r\n\t * @inheritDoc\r\n\t * @override\r\n\t * @internal\r\n\t */\r\n\t_cloneTo(destObject: any, rootSprite: Node, dstSprite: Node) {\r\n\t\tsuper._cloneTo(destObject, rootSprite, dstSprite);\r\n\t}\r\n\r\n\r\n\t/**\r\n\t * @internal\r\n\t */\r\n\tprotected _create(): Node {\r\n\t\treturn new Sprite3D();\r\n\t}\r\n\r\n}\r\n\r\n\r\n","import { Color } from \"../../../maths/Color\";\r\nimport { Vector4 } from \"../../../maths/Vector4\";\r\nimport { RenderState } from \"../../../RenderEngine/RenderShader/RenderState\";\r\nimport { BaseTexture } from \"../../../resource/BaseTexture\";\r\nimport { Material } from \"../../../resource/Material\";\r\nimport { UnlitMaterial } from \"./UnlitMaterial\";\r\n\r\n/**\r\n * <code>EffectMaterial</code> Mesh\r\n */\r\nexport class EffectMaterial extends Material {\r\n\t/** */\r\n\tstatic defaultMaterial: EffectMaterial;\r\n\r\n\r\n\r\n\t/**\r\n\t * \r\n\t */\r\n\tget color(): Color {\r\n\t\treturn (<Color>this.getColorByIndex(UnlitMaterial.ALBEDOCOLOR));\r\n\t}\r\n\r\n\tset color(value: Color) {\r\n\t\tthis.setColorByIndex(UnlitMaterial.ALBEDOCOLOR, value);\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t */\r\n\tget texture(): BaseTexture {\r\n\t\treturn this.getTextureByIndex(UnlitMaterial.ALBEDOTEXTURE);\r\n\t}\r\n\r\n\tset texture(value: BaseTexture) {\r\n\t\tif (value)\r\n\t\t\tthis.addDefine(UnlitMaterial.SHADERDEFINE_ALBEDOTEXTURE);\r\n\t\telse\r\n\t\t\tthis.removeDefine(UnlitMaterial.SHADERDEFINE_ALBEDOTEXTURE);\r\n\t\tthis.setTextureByIndex(UnlitMaterial.ALBEDOTEXTURE, value);\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t */\r\n\tget tilingOffset(): Vector4 {\r\n\t\treturn (<Vector4>this.getVector4ByIndex(UnlitMaterial.TILINGOFFSET));\r\n\t}\r\n\r\n\tset tilingOffset(value: Vector4) {\r\n\t\tif (value) {\r\n\t\t\tthis.setVector4ByIndex(UnlitMaterial.TILINGOFFSET, value);\r\n\t\t}\r\n\t\telse {\r\n\t\t\tthis.getVector4ByIndex(UnlitMaterial.TILINGOFFSET).setValue(1.0, 1.0, 0.0, 0.0);\r\n\t\t}\r\n\t}\r\n\r\n\r\n\t/**\r\n\t *  <code>EffectMaterial</code> \r\n\t */\r\n\tconstructor() {\r\n\t\tsuper();\r\n\t\tthis.setShaderName(\"Unlit\");\r\n\t\tthis.setVector4ByIndex(UnlitMaterial.TILINGOFFSET, new Vector4(1.0, 1.0, 0.0, 0.0));\r\n\t\tthis.setColorByIndex(UnlitMaterial.ALBEDOCOLOR, new Color(1.0, 1.0, 1.0, 1.0));\r\n\t\tthis.renderMode = EffectMaterial.RENDERMODE_ADDTIVE;\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t * @return\t \r\n\t * @override\r\n\t */\r\n\tclone(): any {\r\n\t\tvar dest: EffectMaterial = new EffectMaterial();\r\n\t\tthis.cloneTo(dest);\r\n\t\treturn dest;\r\n\t}\r\n\r\n\t//----------------deprecated----------------\r\n\r\n\t/**\r\n\t * @deprecated\r\n\t * _\r\n\t */\r\n\tstatic RENDERMODE_ADDTIVE: number = 0;\r\n\r\n\t/**\r\n\t * @deprecated\r\n\t * _*/\r\n\tstatic RENDERMODE_ALPHABLENDED: number = 1;\r\n\r\n\t/**\r\n\t * @deprecated\r\n\t * \r\n\t * \r\n\t */\r\n\tset renderMode(value: number) {\r\n\t\tswitch (value) {\r\n\t\t\tcase EffectMaterial.RENDERMODE_ADDTIVE:\r\n\t\t\t\tthis.renderQueue = Material.RENDERQUEUE_TRANSPARENT;\r\n\t\t\t\tthis.alphaTest = false;\r\n\t\t\t\tthis.depthWrite = false;\r\n\t\t\t\tthis.cull = RenderState.CULL_NONE;\r\n\t\t\t\tthis.blend = RenderState.BLEND_ENABLE_ALL;\r\n\t\t\t\tthis.blendSrc = RenderState.BLENDPARAM_SRC_ALPHA;\r\n\t\t\t\tthis.blendDst = RenderState.BLENDPARAM_ONE;\r\n\t\t\t\tthis.depthTest = RenderState.DEPTHTEST_LEQUAL;\r\n\t\t\t\tthis.addDefine(Material.SHADERDEFINE_ADDTIVEFOG);\r\n\t\t\t\tbreak;\r\n\t\t\tcase EffectMaterial.RENDERMODE_ALPHABLENDED:\r\n\t\t\t\tthis.renderQueue = Material.RENDERQUEUE_TRANSPARENT;\r\n\t\t\t\tthis.alphaTest = false;\r\n\t\t\t\tthis.depthWrite = false;\r\n\t\t\t\tthis.cull = RenderState.CULL_NONE;\r\n\t\t\t\tthis.blend = RenderState.BLEND_ENABLE_ALL;\r\n\t\t\t\tthis.blendSrc = RenderState.BLENDPARAM_SRC_ALPHA;\r\n\t\t\t\tthis.blendDst = RenderState.BLENDPARAM_ONE_MINUS_SRC_ALPHA;\r\n\t\t\t\tthis.depthTest = RenderState.DEPTHTEST_LEQUAL;\r\n\t\t\t\tthis.removeDefine(Material.SHADERDEFINE_ADDTIVEFOG);\r\n\t\t\t\tbreak;\r\n\t\t\tdefault:\r\n\t\t\t\tthrow new Error(\"MeshEffectMaterial : renderMode value error.\");\r\n\t\t}\r\n\t}\r\n}\r\n\r\n","import { Vector4 } from \"../../../maths/Vector4\";\r\nimport { RenderState } from \"../../../RenderEngine/RenderShader/RenderState\";\r\nimport { Shader3D } from \"../../../RenderEngine/RenderShader/Shader3D\";\r\nimport { ShaderDefine } from \"../../../RenderEngine/RenderShader/ShaderDefine\";\r\nimport { BaseTexture } from \"../../../resource/BaseTexture\";\r\nimport { Material } from \"../../../resource/Material\";\r\n\r\n/**\r\n * ...\r\n * @author ...\r\n */\r\nexport class ExtendTerrainMaterial extends Material {\r\n\t/**_*/\r\n\tstatic RENDERMODE_OPAQUE: number = 1;\r\n\t/**_*/\r\n\tstatic RENDERMODE_TRANSPARENT: number = 2;\r\n\r\n\t/**@internal */\r\n\tstatic SPLATALPHATEXTURE: number;\r\n\t/**@internal */\r\n\tstatic DIFFUSETEXTURE1: number;\r\n\t/**@internal */\r\n\tstatic DIFFUSETEXTURE2: number;\r\n\t/**@internal */\r\n\tstatic DIFFUSETEXTURE3: number;\r\n\t/**@internal */\r\n\tstatic DIFFUSETEXTURE4: number;\r\n\t/**@internal */\r\n\tstatic DIFFUSETEXTURE5: number;\r\n\t/**@internal */\r\n\tstatic DIFFUSESCALEOFFSET1: number;\r\n\t/**@internal */\r\n\tstatic DIFFUSESCALEOFFSET2: number;\r\n\t/**@internal */\r\n\tstatic DIFFUSESCALEOFFSET3: number;\r\n\t/**@internal */\r\n\tstatic DIFFUSESCALEOFFSET4: number;\r\n\t/**@internal */\r\n\tstatic DIFFUSESCALEOFFSET5: number;\r\n\r\n\t/***/\r\n\t/**@internal */\r\n\tstatic SHADERDEFINE_DETAIL_NUM1: ShaderDefine;\r\n\t/**@internal */\r\n\tstatic SHADERDEFINE_DETAIL_NUM2: ShaderDefine;\r\n\t/**@internal */\r\n\tstatic SHADERDEFINE_DETAIL_NUM3: ShaderDefine;\r\n\t/**@internal */\r\n\tstatic SHADERDEFINE_DETAIL_NUM4: ShaderDefine;\r\n\t/**@internal */\r\n\tstatic SHADERDEFINE_DETAIL_NUM5: ShaderDefine;\r\n\r\n\t/**\r\n\t * @internal\r\n\t */\r\n\tstatic __initDefine__(): void {\r\n\t\tExtendTerrainMaterial.SHADERDEFINE_DETAIL_NUM1 = Shader3D.getDefineByName(\"ExtendTerrain_DETAIL_NUM1\");\r\n\t\tExtendTerrainMaterial.SHADERDEFINE_DETAIL_NUM2 = Shader3D.getDefineByName(\"ExtendTerrain_DETAIL_NUM2\");\r\n\t\tExtendTerrainMaterial.SHADERDEFINE_DETAIL_NUM3 = Shader3D.getDefineByName(\"ExtendTerrain_DETAIL_NUM3\");\r\n\t\tExtendTerrainMaterial.SHADERDEFINE_DETAIL_NUM4 = Shader3D.getDefineByName(\"ExtendTerrain_DETAIL_NUM4\");\r\n\t\tExtendTerrainMaterial.SHADERDEFINE_DETAIL_NUM5 = Shader3D.getDefineByName(\"ExtendTerrain_DETAIL_NUM5\");\r\n\r\n\t\tExtendTerrainMaterial.SPLATALPHATEXTURE = Shader3D.propertyNameToID(\"u_SplatAlphaTexture\");\r\n\t\tExtendTerrainMaterial.DIFFUSETEXTURE1 = Shader3D.propertyNameToID(\"u_DiffuseTexture1\");\r\n\t\tExtendTerrainMaterial.DIFFUSETEXTURE2 = Shader3D.propertyNameToID(\"u_DiffuseTexture2\");\r\n\t\tExtendTerrainMaterial.DIFFUSETEXTURE3 = Shader3D.propertyNameToID(\"u_DiffuseTexture3\");\r\n\t\tExtendTerrainMaterial.DIFFUSETEXTURE4 = Shader3D.propertyNameToID(\"u_DiffuseTexture4\");\r\n\t\tExtendTerrainMaterial.DIFFUSETEXTURE5 = Shader3D.propertyNameToID(\"u_DiffuseTexture5\");\r\n\t\tExtendTerrainMaterial.DIFFUSESCALEOFFSET1 = Shader3D.propertyNameToID(\"u_DiffuseScaleOffset1\");\r\n\t\tExtendTerrainMaterial.DIFFUSESCALEOFFSET2 = Shader3D.propertyNameToID(\"u_DiffuseScaleOffset2\");\r\n\t\tExtendTerrainMaterial.DIFFUSESCALEOFFSET3 = Shader3D.propertyNameToID(\"u_DiffuseScaleOffset3\");\r\n\t\tExtendTerrainMaterial.DIFFUSESCALEOFFSET4 = Shader3D.propertyNameToID(\"u_DiffuseScaleOffset4\");\r\n\t\tExtendTerrainMaterial.DIFFUSESCALEOFFSET5 = Shader3D.propertyNameToID(\"u_DiffuseScaleOffset5\");\r\n\t}\r\n\t/**\r\n\t * splatAlpha\r\n\t */\r\n\tget splatAlphaTexture(): BaseTexture {\r\n\t\treturn this._shaderValues.getTexture(ExtendTerrainMaterial.SPLATALPHATEXTURE);\r\n\t}\r\n\r\n\tset splatAlphaTexture(value: BaseTexture) {\r\n\t\tthis._shaderValues.setTexture(ExtendTerrainMaterial.SPLATALPHATEXTURE, value);\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t */\r\n\tget diffuseTexture1(): BaseTexture {\r\n\t\treturn this._shaderValues.getTexture(ExtendTerrainMaterial.DIFFUSETEXTURE1);\r\n\t}\r\n\r\n\tset diffuseTexture1(value: BaseTexture) {\r\n\t\tthis._shaderValues.setTexture(ExtendTerrainMaterial.DIFFUSETEXTURE1, value);\r\n\t\tthis._setDetailNum(1);\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t */\r\n\tget diffuseTexture2(): BaseTexture {\r\n\t\treturn this._shaderValues.getTexture(ExtendTerrainMaterial.DIFFUSETEXTURE2);\r\n\t}\r\n\r\n\tset diffuseTexture2(value: BaseTexture) {\r\n\t\tthis._shaderValues.setTexture(ExtendTerrainMaterial.DIFFUSETEXTURE2, value);\r\n\t\tthis._setDetailNum(2);\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t */\r\n\tget diffuseTexture3(): BaseTexture {\r\n\t\treturn this._shaderValues.getTexture(ExtendTerrainMaterial.DIFFUSETEXTURE3);\r\n\t}\r\n\r\n\tset diffuseTexture3(value: BaseTexture) {\r\n\t\tthis._shaderValues.setTexture(ExtendTerrainMaterial.DIFFUSETEXTURE3, value);\r\n\t\tthis._setDetailNum(3);\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t */\r\n\tget diffuseTexture4(): BaseTexture {\r\n\t\treturn this._shaderValues.getTexture(ExtendTerrainMaterial.DIFFUSETEXTURE4);\r\n\t}\r\n\r\n\tset diffuseTexture4(value: BaseTexture) {\r\n\t\tthis._shaderValues.setTexture(ExtendTerrainMaterial.DIFFUSETEXTURE4, value);\r\n\t\tthis._setDetailNum(4);\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t */\r\n\tget diffuseTexture5(): BaseTexture {\r\n\t\treturn this._shaderValues.getTexture(ExtendTerrainMaterial.DIFFUSETEXTURE5);\r\n\t}\r\n\r\n\tset diffuseTexture5(value: BaseTexture) {\r\n\t\tthis._shaderValues.setTexture(ExtendTerrainMaterial.DIFFUSETEXTURE5, value);\r\n\t\tthis._setDetailNum(5);\r\n\t}\r\n\r\n\r\n\t/**\r\n\t * \r\n\t */\r\n\tset diffuseScaleOffset1(scaleOffset1: Vector4) {\r\n\t\tthis._shaderValues.setVector(ExtendTerrainMaterial.DIFFUSESCALEOFFSET1, scaleOffset1);\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t */\r\n\tset diffuseScaleOffset2(scaleOffset2: Vector4) {\r\n\t\tthis._shaderValues.setVector(ExtendTerrainMaterial.DIFFUSESCALEOFFSET2, scaleOffset2);\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t */\r\n\tset diffuseScaleOffset3(scaleOffset3: Vector4) {\r\n\t\tthis._shaderValues.setVector(ExtendTerrainMaterial.DIFFUSESCALEOFFSET3, scaleOffset3);\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t */\r\n\tset diffuseScaleOffset4(scaleOffset4: Vector4) {\r\n\t\tthis._shaderValues.setVector(ExtendTerrainMaterial.DIFFUSESCALEOFFSET4, scaleOffset4);\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t */\r\n\tset diffuseScaleOffset5(scaleOffset5: Vector4) {\r\n\t\tthis._shaderValues.setVector(ExtendTerrainMaterial.DIFFUSESCALEOFFSET5, scaleOffset5);\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t */\r\n\tset renderMode(value: number) {\r\n\t\tswitch (value) {\r\n\t\t\tcase ExtendTerrainMaterial.RENDERMODE_OPAQUE:\r\n\t\t\t\tthis.renderQueue = Material.RENDERQUEUE_OPAQUE;\r\n\t\t\t\tthis.depthWrite = true;\r\n\t\t\t\tthis.cull = RenderState.CULL_BACK;\r\n\t\t\t\tthis.blend = RenderState.BLEND_DISABLE;\r\n\t\t\t\tthis.depthTest = RenderState.DEPTHTEST_LESS;\r\n\t\t\t\tbreak;\r\n\t\t\tcase ExtendTerrainMaterial.RENDERMODE_TRANSPARENT:\r\n\t\t\t\tthis.renderQueue = Material.RENDERQUEUE_OPAQUE;\r\n\t\t\t\tthis.depthWrite = false;\r\n\t\t\t\tthis.cull = RenderState.CULL_BACK;\r\n\t\t\t\tthis.blend = RenderState.BLEND_ENABLE_ALL;\r\n\t\t\t\tthis.blendSrc = RenderState.BLENDPARAM_SRC_ALPHA;\r\n\t\t\t\tthis.blendDst = RenderState.BLENDPARAM_ONE_MINUS_SRC_ALPHA;\r\n\t\t\t\tthis.depthTest = RenderState.DEPTHTEST_LEQUAL;\r\n\t\t\t\tbreak;\r\n\t\t\tdefault:\r\n\t\t\t\tthrow new Error(\"ExtendTerrainMaterial:renderMode value error.\");\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t *  <code>ExtendTerrainMaterial</code> \r\n\t */\r\n\tconstructor() {\r\n\t\tsuper();\r\n\t\tthis.setShaderName(\"ExtendTerrain\");\r\n\t\tthis.renderMode = ExtendTerrainMaterial.RENDERMODE_OPAQUE;\r\n\t}\r\n\r\n\t/**\r\n\t * @internal\r\n\t */\r\n\tprivate _setDetailNum(value: number): void {\r\n\t\tswitch (value) {\r\n\t\t\tcase 1:\r\n\t\t\t\tthis._shaderValues.addDefine(ExtendTerrainMaterial.SHADERDEFINE_DETAIL_NUM1);\r\n\t\t\t\tthis._shaderValues.removeDefine(ExtendTerrainMaterial.SHADERDEFINE_DETAIL_NUM2);\r\n\t\t\t\tthis._shaderValues.removeDefine(ExtendTerrainMaterial.SHADERDEFINE_DETAIL_NUM3);\r\n\t\t\t\tthis._shaderValues.removeDefine(ExtendTerrainMaterial.SHADERDEFINE_DETAIL_NUM4);\r\n\t\t\t\tthis._shaderValues.removeDefine(ExtendTerrainMaterial.SHADERDEFINE_DETAIL_NUM5);\r\n\t\t\t\tbreak;\r\n\t\t\tcase 2:\r\n\t\t\t\tthis._shaderValues.addDefine(ExtendTerrainMaterial.SHADERDEFINE_DETAIL_NUM2);\r\n\t\t\t\tthis._shaderValues.removeDefine(ExtendTerrainMaterial.SHADERDEFINE_DETAIL_NUM1);\r\n\t\t\t\tthis._shaderValues.removeDefine(ExtendTerrainMaterial.SHADERDEFINE_DETAIL_NUM3);\r\n\t\t\t\tthis._shaderValues.removeDefine(ExtendTerrainMaterial.SHADERDEFINE_DETAIL_NUM4);\r\n\t\t\t\tthis._shaderValues.removeDefine(ExtendTerrainMaterial.SHADERDEFINE_DETAIL_NUM5);\r\n\t\t\t\tbreak;\r\n\t\t\tcase 3:\r\n\t\t\t\tthis._shaderValues.addDefine(ExtendTerrainMaterial.SHADERDEFINE_DETAIL_NUM3);\r\n\t\t\t\tthis._shaderValues.removeDefine(ExtendTerrainMaterial.SHADERDEFINE_DETAIL_NUM1);\r\n\t\t\t\tthis._shaderValues.removeDefine(ExtendTerrainMaterial.SHADERDEFINE_DETAIL_NUM2);\r\n\t\t\t\tthis._shaderValues.removeDefine(ExtendTerrainMaterial.SHADERDEFINE_DETAIL_NUM4);\r\n\t\t\t\tthis._shaderValues.removeDefine(ExtendTerrainMaterial.SHADERDEFINE_DETAIL_NUM5);\r\n\t\t\t\tbreak;\r\n\t\t\tcase 4:\r\n\t\t\t\tthis._shaderValues.addDefine(ExtendTerrainMaterial.SHADERDEFINE_DETAIL_NUM4);\r\n\t\t\t\tthis._shaderValues.removeDefine(ExtendTerrainMaterial.SHADERDEFINE_DETAIL_NUM1);\r\n\t\t\t\tthis._shaderValues.removeDefine(ExtendTerrainMaterial.SHADERDEFINE_DETAIL_NUM2);\r\n\t\t\t\tthis._shaderValues.removeDefine(ExtendTerrainMaterial.SHADERDEFINE_DETAIL_NUM3);\r\n\t\t\t\tthis._shaderValues.removeDefine(ExtendTerrainMaterial.SHADERDEFINE_DETAIL_NUM5);\r\n\t\t\t\tbreak;\r\n\t\t\tcase 5:\r\n\t\t\t\tthis._shaderValues.addDefine(ExtendTerrainMaterial.SHADERDEFINE_DETAIL_NUM5);\r\n\t\t\t\tthis._shaderValues.removeDefine(ExtendTerrainMaterial.SHADERDEFINE_DETAIL_NUM1);\r\n\t\t\t\tthis._shaderValues.removeDefine(ExtendTerrainMaterial.SHADERDEFINE_DETAIL_NUM2);\r\n\t\t\t\tthis._shaderValues.removeDefine(ExtendTerrainMaterial.SHADERDEFINE_DETAIL_NUM3);\r\n\t\t\t\tthis._shaderValues.removeDefine(ExtendTerrainMaterial.SHADERDEFINE_DETAIL_NUM4);\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t* \r\n\t* @return\t \r\n\t* @override\r\n\t*/\r\n\tclone(): any {\r\n\t\tvar dest: ExtendTerrainMaterial = new ExtendTerrainMaterial();\r\n\t\tthis.cloneTo(dest);\r\n\t\treturn dest;\r\n\t}\r\n\r\n}\r\n\r\n\r\n","import { Vector4 } from \"../../../maths/Vector4\";\r\nimport { Shader3D } from \"../../../RenderEngine/RenderShader/Shader3D\";\r\nimport { ShaderDefine } from \"../../../RenderEngine/RenderShader/ShaderDefine\";\r\nimport { BaseTexture } from \"../../../resource/BaseTexture\";\r\nimport { Material } from \"../../../resource/Material\";\r\n\r\n/**\r\n * <code>WaterPrimaryMaterial</code> \r\n */\r\nexport class WaterPrimaryMaterial extends Material {\r\n\r\n\tstatic HORIZONCOLOR: number;\r\n\tstatic MAINTEXTURE: number;\r\n\tstatic NORMALTEXTURE: number;\r\n\tstatic WAVESCALE: number;\r\n\tstatic WAVESPEED: number;\r\n\r\n\tstatic SHADERDEFINE_MAINTEXTURE: ShaderDefine;\r\n\tstatic SHADERDEFINE_NORMALTEXTURE: ShaderDefine;\r\n\r\n\t/** */\r\n\tstatic defaultMaterial: WaterPrimaryMaterial;\r\n\r\n\t/**\r\n\t * @internal\r\n\t */\r\n\tstatic __initDefine__(): void {\r\n\t\tWaterPrimaryMaterial.SHADERDEFINE_MAINTEXTURE = Shader3D.getDefineByName(\"MAINTEXTURE\");\r\n\t\tWaterPrimaryMaterial.SHADERDEFINE_NORMALTEXTURE = Shader3D.getDefineByName(\"NORMALTEXTURE\");\r\n\t\tWaterPrimaryMaterial.HORIZONCOLOR = Shader3D.propertyNameToID(\"u_HorizonColor\");\r\n\t\tWaterPrimaryMaterial.MAINTEXTURE = Shader3D.propertyNameToID(\"u_MainTexture\");\r\n\t\tWaterPrimaryMaterial.NORMALTEXTURE = Shader3D.propertyNameToID(\"u_NormalTexture\");\r\n\t\tWaterPrimaryMaterial.WAVESCALE = Shader3D.propertyNameToID(\"u_WaveScale\");\r\n\t\tWaterPrimaryMaterial.WAVESPEED = Shader3D.propertyNameToID(\"u_WaveSpeed\");\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t */\r\n\tget horizonColor(): Vector4 {\r\n\t\treturn (<Vector4>this._shaderValues.getVector(WaterPrimaryMaterial.HORIZONCOLOR));\r\n\t}\r\n\r\n\tset horizonColor(value: Vector4) {\r\n\t\tthis._shaderValues.setVector(WaterPrimaryMaterial.HORIZONCOLOR, value);\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t */\r\n\tget mainTexture(): BaseTexture {\r\n\t\treturn this._shaderValues.getTexture(WaterPrimaryMaterial.MAINTEXTURE);\r\n\t}\r\n\r\n\tset mainTexture(value: BaseTexture) {\r\n\t\tif (value)\r\n\t\t\tthis._shaderValues.addDefine(WaterPrimaryMaterial.SHADERDEFINE_MAINTEXTURE);\r\n\t\telse\r\n\t\t\tthis._shaderValues.removeDefine(WaterPrimaryMaterial.SHADERDEFINE_MAINTEXTURE);\r\n\t\tthis._shaderValues.setTexture(WaterPrimaryMaterial.MAINTEXTURE, value);\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t */\r\n\tget normalTexture(): BaseTexture {\r\n\t\treturn this._shaderValues.getTexture(WaterPrimaryMaterial.NORMALTEXTURE);\r\n\t}\r\n\r\n\tset normalTexture(value: BaseTexture) {\r\n\t\tif (value)\r\n\t\t\tthis._shaderValues.addDefine(WaterPrimaryMaterial.SHADERDEFINE_NORMALTEXTURE);\r\n\t\telse\r\n\t\t\tthis._shaderValues.removeDefine(WaterPrimaryMaterial.SHADERDEFINE_NORMALTEXTURE);\r\n\t\tthis._shaderValues.setTexture(WaterPrimaryMaterial.NORMALTEXTURE, value);\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t */\r\n\tget waveScale(): number {\r\n\t\treturn this._shaderValues.getNumber(WaterPrimaryMaterial.WAVESCALE);\r\n\t}\r\n\r\n\tset waveScale(value: number) {\r\n\t\tthis._shaderValues.setNumber(WaterPrimaryMaterial.WAVESCALE, value);\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t */\r\n\tget waveSpeed(): Vector4 {\r\n\t\treturn (<Vector4>this._shaderValues.getVector(WaterPrimaryMaterial.WAVESPEED));\r\n\t}\r\n\r\n\tset waveSpeed(value: Vector4) {\r\n\t\tthis._shaderValues.setVector(WaterPrimaryMaterial.WAVESPEED, value);\r\n\t}\r\n\r\n\r\n\tconstructor() {\r\n\t\tsuper();\r\n\t\tthis.setShaderName(\"WaterPrimary\");\r\n\t\tthis._shaderValues.setVector(WaterPrimaryMaterial.HORIZONCOLOR, new Vector4(0.172, 0.463, 0.435, 0));\r\n\t\tthis._shaderValues.setNumber(WaterPrimaryMaterial.WAVESCALE, 0.15);\r\n\t\tthis._shaderValues.setVector(WaterPrimaryMaterial.WAVESPEED, new Vector4(19, 9, -16, -7));\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t * @return\t \r\n\t * @override\r\n\t */\r\n\tclone(): any {\r\n\t\tvar dest: WaterPrimaryMaterial = new WaterPrimaryMaterial();\r\n\t\tthis.cloneTo(dest);\r\n\t\treturn dest;\r\n\t}\r\n}\r\n\r\n\r\n","import { ILaya3D } from \"../../../../../ILaya3D\";\r\nimport { Vector3 } from \"../../../../maths/Vector3\";\r\nimport { Vector4 } from \"../../../../maths/Vector4\";\r\nimport { ShaderData } from \"../../../../RenderEngine/RenderShader/ShaderData\";\r\nimport { Texture2D } from \"../../../../resource/Texture2D\";\r\nimport { Sprite3DRenderDeclaration } from \"../../../core/render/Sprite3DRenderDeclaration\";\r\nimport { RenderableSprite3D } from \"../../../core/RenderableSprite3D\";\r\nimport { Volume } from \"../Volume\";\r\nimport { VolumeManager } from \"../VolumeManager\";\r\n\r\nexport class VolumetricGI extends Volume {\r\n    static volumetricCount: number = 0;\r\n    /**ID*/\r\n    static getID(): number {\r\n        return VolumetricGI.volumetricCount++;\r\n    }\r\n    /**@internal */\r\n    private _probeCounts: Vector3;\r\n\r\n    /**@internal */\r\n    private _probeStep: Vector3;\r\n\r\n    /** @internal */\r\n    probeLocations: Float32Array;\r\n\r\n    /**\r\n     * @internal\r\n     * x: irradiance probe texel size\r\n     * y: distance probe texel size\r\n     * z: normalBias\r\n     * w: viewBias\r\n     */\r\n    private _params: Vector4;\r\n\r\n    /**@internal */\r\n    private _irradiance: Texture2D;\r\n\r\n    /**@internal */\r\n    private _distance: Texture2D;\r\n\r\n    /** */\r\n    private _intensity: number;\r\n\r\n    /**@internal */\r\n    _updateMark: number;\r\n\r\n    /**@internal */\r\n    _volumetricProbeID: number\r\n    /**\r\n     * <code><code>\r\n     */\r\n    constructor() {\r\n        super();\r\n        this._type = VolumeManager.VolumetricGIType;\r\n        this._probeCounts = new Vector3();\r\n        this._probeStep = new Vector3();\r\n        this._params = new Vector4(8, 16, 0, 0);\r\n        this._volumetricProbeID = VolumetricGI.getID();\r\n        this._intensity = 1;\r\n    }\r\n\r\n    /**\r\n    * @inheritDoc\r\n    * @override\r\n    */\r\n    protected _onEnable(): void {\r\n        super._onEnable();\r\n        this._updateMark = ILaya3D.Scene3D._updateMark;\r\n    }\r\n\r\n    /**\r\n     * light probe texture\r\n     */\r\n    get irradiance(): Texture2D {\r\n        return this._irradiance;\r\n    }\r\n\r\n    set irradiance(value: Texture2D) {\r\n        if (this._irradiance == value)\r\n            return;\r\n        this._irradiance && (this.irradiance._removeReference());\r\n        value && (value._addReference());\r\n        this._irradiance = value;\r\n        this._updateMark = ILaya3D.Scene3D._updateMark;\r\n    }\r\n\r\n    /**\r\n     * distance texture\r\n     */\r\n    get distance(): Texture2D {\r\n        return this._distance;\r\n    }\r\n\r\n    set distance(value: Texture2D) {\r\n        if (this._distance == value)\r\n            return;\r\n        this._distance && (this._distance._removeReference());\r\n        value && (value._addReference());\r\n\r\n        this._distance = value;\r\n        this._updateMark = ILaya3D.Scene3D._updateMark;\r\n    }\r\n\r\n    /**\r\n     * normal bias\r\n     */\r\n    get normalBias(): number {\r\n        return this._params.z;\r\n    }\r\n\r\n    set normalBias(value: number) {\r\n        this._params.z = value;\r\n        this._updateMark = ILaya3D.Scene3D._updateMark;\r\n    }\r\n\r\n    /**\r\n     * view bias\r\n     */\r\n    get viewBias(): number {\r\n        return this._params.w;\r\n    }\r\n\r\n    set viewBias(value: number) {\r\n        this._params.w = value;\r\n        this._updateMark = ILaya3D.Scene3D._updateMark;\r\n    }\r\n\r\n    /**\r\n     * irradiance Texture one probe texel number\r\n     */\r\n    get irradianceTexel(): number {\r\n        return this._params.x;\r\n    }\r\n\r\n    /**\r\n     * distance Texture one probe texel number\r\n     */\r\n    get distanceTexel(): number {\r\n        return this._params.y;\r\n    }\r\n\r\n    /**\r\n     * \r\n     */\r\n    get intensity(): number {\r\n        return this._intensity;\r\n    }\r\n\r\n    set intensity(value: number) {\r\n        if (value == this._intensity) return;\r\n        value = Math.max(value, 0.0);\r\n        this._updateMark = ILaya3D.Scene3D._updateMark;\r\n    }\r\n\r\n    /**\r\n     * \r\n     */\r\n    get probeCounts(): Vector3 {\r\n        return this._probeCounts;\r\n    }\r\n\r\n    set probeCounts(value: Vector3) {\r\n        if (value.equal(this._probeCounts)) return;\r\n        value.cloneTo(this._probeCounts);\r\n        this._updateMark = ILaya3D.Scene3D._updateMark;\r\n    }\r\n    /**\r\n     * \r\n     */\r\n    get probeStep(): Vector3 {\r\n        return this._probeStep;\r\n    }\r\n\r\n    set probeStep(value: Vector3) {\r\n        if (value.equal(this._probeStep)) return;\r\n        value.cloneTo(this._probeStep);\r\n        this._updateMark = ILaya3D.Scene3D._updateMark;\r\n    }\r\n\r\n    /**\r\n     * @interanl\r\n     * upload volumetric GI data\r\n     * @param shaderData \r\n     */\r\n    applyVolumetricGI(shaderData: ShaderData) {\r\n        shaderData.addDefine(Sprite3DRenderDeclaration.SHADERDEFINE_VOLUMETRICGI);\r\n\r\n        shaderData.setVector3(RenderableSprite3D.VOLUMETRICGI_PROBECOUNTS, this._probeCounts);\r\n        shaderData.setVector3(RenderableSprite3D.VOLUMETRICGI_PROBESTEPS, this._probeStep);\r\n\r\n        shaderData.setVector3(RenderableSprite3D.VOLUMETRICGI_PROBESTARTPOS, this.bounds.getMin());\r\n        shaderData.setVector(RenderableSprite3D.VOLUMETRICGI_PROBEPARAMS, this._params);\r\n\r\n        shaderData.setTexture(RenderableSprite3D.VOLUMETRICGI_IRRADIANCE, this.irradiance);\r\n        shaderData.setTexture(RenderableSprite3D.VOLUMETRICGI_DISTANCE, this.distance);\r\n        shaderData.setNumber(RenderableSprite3D.AMBIENTINTENSITY, this._intensity);\r\n    }\r\n\r\n    /**\r\n     * @interanl\r\n     */\r\n    _onDestroy() {\r\n        // todo\r\n        this.irradiance = null;\r\n        this.distance = null;\r\n    }\r\n\r\n    /**@internal */\r\n    _cloneTo(dest: VolumetricGI): void {\r\n        dest.irradiance = this.irradiance;\r\n        dest.distance = this.distance;\r\n        this._probeCounts.cloneTo(dest._probeCounts);\r\n        this.probeStep.cloneTo(dest.probeStep);\r\n        dest.normalBias = this.normalBias;\r\n        dest.viewBias = this.viewBias;\r\n        dest.intensity = this.intensity;\r\n    }\r\n\r\n}","import { Component } from \"../../components/Component\";\r\nimport { Camera } from \"../core/Camera\";\r\nimport { BaseRender, RenderBitFlag } from \"../core/render/BaseRender\";\r\nimport { Scene3D } from \"../core/scene/Scene3D\";\r\nimport { Sprite3D } from \"../core/Sprite3D\";\r\nimport { Bounds } from \"../math/Bounds\";\r\nimport { Event } from \"../../events/Event\";\r\nimport { Utils3D } from \"../utils/Utils3D\";\r\nimport { IBoundsCell } from \"../math/IBoundsCell\";\r\nimport { Vector3 } from \"../../maths/Vector3\";\r\n\r\nconst tempVec = new Vector3();\r\nconst tempVec1 = new Vector3();\r\n\r\n/**\r\n * Lod\r\n */\r\nexport class LODInfo {\r\n    /**@internal */\r\n    _mincullRate: number;// 0-1\r\n\r\n    /**@internal */\r\n    _renders: BaseRender[];//LOD\r\n\r\n    /**@internal */\r\n    _cachSprite3D: Sprite3D[];\r\n\r\n    /**@internal */\r\n    _lodIndex: number;\r\n\r\n    /**@internal */\r\n    private _group: LODGroup;\r\n\r\n\r\n\r\n    /**\r\n     * LODInfo\r\n     * @param mincullRate \r\n     */\r\n    constructor(mincullRate: number) {\r\n        this._mincullRate = mincullRate;\r\n        this._renders = [];\r\n        this._cachSprite3D = [];\r\n    }\r\n\r\n    /**\r\n     * \r\n     */\r\n    set mincullRate(value: number) {\r\n        this._mincullRate = value;\r\n    }\r\n\r\n    get mincullRate() {\r\n        return this._mincullRate;\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     * LODGroup\r\n     */\r\n    set group(value: LODGroup) {\r\n        if (value == this._group)\r\n            return;\r\n        if (this._group) {//remove old event\r\n            // this._renders.forEach(element => {\r\n            //     (element.owner as Sprite3D).transform.off(Event.TRANSFORM_CHANGED, this._group._updateRecaculateFlag);\r\n            //     element._LOD = -1;\r\n            // })\r\n            for (let i = 0, n = this._renders.length; i < n; i++) {\r\n                let element = this._renders[i];\r\n                (element.owner as Sprite3D).transform.off(Event.TRANSFORM_CHANGED, this._group._updateRecaculateFlag);\r\n                element._LOD = -1;\r\n            }\r\n        }\r\n        this._group = value;\r\n        for (let i = 0, n = this._renders.length; i < n; i++) {\r\n            let element = this._renders[i];\r\n            (element.owner as Sprite3D).transform.on(Event.TRANSFORM_CHANGED, this._group, this._group._updateRecaculateFlag);\r\n            element._LOD = this._lodIndex;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * LODInfo\r\n     */\r\n    set renders(value: Sprite3D[]) {\r\n        this._cachSprite3D = value;\r\n        for (var i = 0, n = value.length; i < n; i++) {\r\n            this.addNode(value[i]);\r\n        }\r\n    }\r\n\r\n    get renders(): Sprite3D[] {\r\n        return this._cachSprite3D;\r\n    }\r\n\r\n    /**\r\n     * lodInfo\r\n     * @param node \r\n     */\r\n    addNode(node: Sprite3D) {\r\n        if (!node)\r\n            return;\r\n        let ren = node;\r\n        if (ren._isRenderNode > 0) {\r\n            let components = ren.components;\r\n            for (let comp of components) {\r\n                if ((comp instanceof BaseRender) && this._renders.indexOf(comp) == -1)\r\n                    this._renders.push(comp);\r\n            }\r\n            this._group && node.transform.on(Event.TRANSFORM_CHANGED, this._group, this._group._updateRecaculateFlag);\r\n        }\r\n        for (var i = 0, n = node.numChildren; i < n; i++) {\r\n            this.addNode(node.getChildAt(i) as Sprite3D);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * lod\r\n     * @param node \r\n     */\r\n    removeNode(node: Sprite3D) {\r\n        let ren = node;\r\n        if (ren._isRenderNode > 0) {\r\n            let components = ren.components;\r\n            let index: number;\r\n            for (let comp of components) {\r\n                if ((comp instanceof BaseRender) && (index = this._renders.indexOf(comp)) == -1) {\r\n                    this._renders.splice(index, 1);\r\n                    comp.setRenderbitFlag(RenderBitFlag.RenderBitFlag_CullFlag, false);\r\n                    this._group && node.transform.off(Event.TRANSFORM_CHANGED, this._group._updateRecaculateFlag);\r\n                }\r\n            }\r\n        }\r\n        for (var i = 0, n = node.numChildren; i < n; i++) {\r\n            this.removeNode(node.getChildAt(i) as Sprite3D);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * cull\r\n     */\r\n    removeAllRender() {\r\n        this._renders.forEach(element => {\r\n            element.setRenderbitFlag(RenderBitFlag.RenderBitFlag_CullFlag, false);\r\n        })\r\n    }\r\n}\r\n\r\n/**\r\n * <code>SpotLight</code> LOD\r\n */\r\nexport class LODGroup extends Component implements IBoundsCell {\r\n\r\n    /**\r\n     * _lodBoundsRadius_bounds\r\n     * LOD\r\n     */\r\n    private _needcaculateBounds: boolean = false;\r\n\r\n    /**     \r\n     * lodGroup\r\n     */\r\n    private _bounds: Bounds;\r\n\r\n    /**\r\n     * size\r\n     */\r\n    private _size: number;\r\n\r\n    /**\r\n     * \r\n     */\r\n    private _lodPosition: Vector3;\r\n\r\n    /**\r\n     * lod\r\n     */\r\n    private _lodCount: number;\r\n\r\n    /**\r\n     * lod\r\n     */\r\n    private _lods: LODInfo[] = [];\r\n\r\n    /**\r\n     * \r\n     */\r\n    private _visialIndex = -1;\r\n\r\n    /**\r\n     * lod\r\n     */\r\n    private _nowRate: number;\r\n\r\n    /**\r\n     * LODGroup\r\n     */\r\n    constructor() {\r\n        super();\r\n        this._bounds = new Bounds();\r\n        this._lodPosition = new Vector3();\r\n        this.runInEditor = true;\r\n    }\r\n    shadowCullPass(): boolean {\r\n        return false;\r\n    }\r\n\r\n    /**\r\n    * get LODInfo \r\n    * @returns \r\n    */\r\n    get lods(): LODInfo[] {\r\n        return this._lods;\r\n    }\r\n\r\n    /**\r\n     *  LODInfo \r\n     * @param data \r\n     */\r\n    set lods(data: LODInfo[]) {\r\n        this._lods = data;\r\n        for (var i = 0, n = this._lods.length; i < n; i++) {\r\n            let element = this._lods[i]\r\n            element._lodIndex = i;\r\n            element.group = this;\r\n        }\r\n        this._updateRecaculateFlag();\r\n        this._lodCount = this._lods.length;\r\n    }\r\n\r\n    get nowRate() {\r\n        return this._nowRate;\r\n    }\r\n\r\n    /**\r\n     * LOD\r\n     */\r\n    get bounds() {\r\n        this.recalculateBounds();\r\n        return this._bounds;\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    protected _onEnable(): void {\r\n        super._onEnable();\r\n        for (var i = 0, n = this._lods.length; i < n; i++) {\r\n            this._setLODinvisible(i);\r\n        }\r\n        this._visialIndex = -1;\r\n\r\n      \r\n        this._applyVisibleRate(1);\r\n    }\r\n    /**\r\n     * @internal\r\n     */\r\n    protected _onDisable(): void {\r\n        super._onDisable();\r\n        this._lods.forEach(element => {\r\n            element.removeAllRender();\r\n        })\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @param rate \r\n     * @returns \r\n     */\r\n    private _applyVisibleRate(rate: number) {\r\n        for (var i = 0; i < this._lodCount; i++) {\r\n            let lod = this._lods[i];\r\n            if (rate > lod.mincullRate) {\r\n                if (i == -1) {\r\n                    this._setLODvisible(i);\r\n                    this._visialIndex = i;\r\n                    return;\r\n                }\r\n                if (i == this._visialIndex)\r\n                    return;\r\n                else {\r\n                    (this._visialIndex != -1) && this._setLODinvisible(this._visialIndex);\r\n                    this._setLODvisible(i);\r\n                    this._visialIndex = i;\r\n                    return;\r\n                }\r\n            }\r\n        }\r\n        //cull\r\n        if (this._visialIndex != -1) {\r\n            this._setLODinvisible(this._visialIndex);\r\n            this._visialIndex = -1;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * LOD\r\n     * @param index \r\n     */\r\n    private _setLODvisible(index: number): void {\r\n        let lod = this._lods[index];\r\n        for (var i = 0, n = lod._renders.length; i < n; i++) {\r\n            lod._renders[i].setRenderbitFlag(RenderBitFlag.RenderBitFlag_CullFlag, false);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * LOD\r\n     * @param index \r\n     */\r\n    private _setLODinvisible(index: number) {\r\n        let lod = this._lods[index];\r\n        for (var i = 0, n = lod._renders.length; i < n; i++) {\r\n            lod._renders[i].setRenderbitFlag(RenderBitFlag.RenderBitFlag_CullFlag, true);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     * \r\n     */\r\n    onDestroy() {\r\n        this._lods.forEach(element => {\r\n            let renderarray = element._renders;\r\n            for (var i = 0; i < renderarray.length; i++) {\r\n                element.removeNode(renderarray[i].owner as Sprite3D);\r\n            }\r\n        })\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    _updateRecaculateFlag() {\r\n        this._needcaculateBounds = true;\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     * @param lodGroup \r\n     */\r\n    _cloneTo(lodGroup: LODGroup) {\r\n        super._cloneTo(lodGroup);\r\n        //get common parent\r\n        let getCommomParent = (rootNode: Sprite3D, rootCheckNode: Sprite3D): Sprite3D => {\r\n            let nodeArray: Sprite3D[] = [];\r\n            let node = rootNode;\r\n            while (!!node) {\r\n                if (node instanceof Sprite3D)\r\n                    nodeArray.push(node);\r\n                node = node.parent as Sprite3D;\r\n            }\r\n            let checkNode: Sprite3D = rootCheckNode;\r\n            while (!!checkNode && nodeArray.indexOf(checkNode) == -1) {\r\n                checkNode = checkNode.parent as Sprite3D;\r\n            }\r\n            return checkNode;\r\n        }\r\n        let cloneHierachFun = (rootNode: Sprite3D, rootCheckNode: Sprite3D, destNode: Sprite3D): Sprite3D => {\r\n            let rootparent: Sprite3D = getCommomParent(rootNode, rootCheckNode);\r\n            if (!rootparent)\r\n                return null;\r\n            let path: number[] = [];\r\n            Utils3D._getHierarchyPath(rootparent, rootNode, path);\r\n            let pathcheck: number[] = [];\r\n            Utils3D._getHierarchyPath(rootparent, rootCheckNode, pathcheck);\r\n            let destParent = Utils3D._getParentNodeByHierarchyPath(destNode, path);\r\n            if (!destParent)\r\n                return null;\r\n            return Utils3D._getNodeByHierarchyPath(destParent, pathcheck) as Sprite3D;\r\n        }\r\n        let lodArray: LODInfo[] = [];\r\n        for (let i = 0, n = this._lodCount; i < n; i++) {\r\n            let lod = this._lods[i];\r\n            let cloneLOD = new LODInfo(lod.mincullRate);\r\n            lodArray.push(cloneLOD);\r\n            lod._renders.forEach(element => {\r\n                let node = cloneHierachFun(this.owner as Sprite3D, element.owner as Sprite3D, lodGroup.owner as Sprite3D);\r\n                if (node)\r\n                    cloneLOD.addNode(node);\r\n            });\r\n        }\r\n        lodGroup.lods = lodArray;\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     * \r\n     */\r\n    recalculateBounds() {\r\n        if (!this._needcaculateBounds) {\r\n            return;\r\n        }\r\n        let firstBounds = true;\r\n        for (let i = 0, n = this._lods.length; i < n; i++) {\r\n            let lod = this._lods[i];\r\n            lod._renders.forEach(element => {\r\n                if (firstBounds) {\r\n                    element.bounds.cloneTo(this._bounds);\r\n                    firstBounds = false;\r\n                }\r\n                else\r\n                    Bounds.merge(this._bounds, element.bounds, this._bounds);\r\n            });\r\n        }\r\n        this._lodPosition = this._bounds.getCenter();\r\n        let extend = this._bounds.getExtent();\r\n        this._size = 2 * Math.max(extend.x, extend.y, extend.z);\r\n        this._needcaculateBounds = false;\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     * \r\n     */\r\n    onPreRender() {\r\n        this.recalculateBounds();\r\n        //\r\n        let checkCamera = (this.owner.scene as Scene3D).cullInfoCamera as Camera;\r\n        let maxYDistance = checkCamera.maxlocalYDistance;\r\n        let cameraFrustum = checkCamera.boundFrustum;\r\n        Vector3.subtract(this._lodPosition, checkCamera.transform.position, tempVec);\r\n        //farplane,.lod\r\n        let length = tempVec.length();\r\n        if (length > checkCamera.farPlane || cameraFrustum.containsPoint(this._lodPosition) == 0) {\r\n            return;\r\n        }\r\n        let rateYDistance = length / checkCamera.farPlane * maxYDistance;\r\n        let rate = (this._size / rateYDistance);\r\n        this._nowRate = rate;\r\n        this._applyVisibleRate(rate);\r\n    }\r\n}\r\n","import { Color } from \"../../../maths/Color\";\r\nimport { Vector3 } from \"../../../maths/Vector3\";\r\n\r\n/**\r\n * <code>PixelLineData</code> \r\n */\r\nexport class PixelLineData {\r\n\t/** */\r\n\tstartPosition: Vector3 = new Vector3();\r\n\t/** */\r\n\tendPosition: Vector3 = new Vector3();\r\n\t/** */\r\n\tstartColor: Color = new Color();\r\n\t/** */\r\n\tendColor: Color = new Color();\r\n\r\n\t/**\r\n\t * \r\n\t * @param\tdestObject \r\n\t */\r\n\tcloneTo(destObject: PixelLineData): void {\r\n\t\tthis.startPosition.cloneTo(destObject.startPosition);\r\n\t\tthis.endPosition.cloneTo(destObject.endPosition);\r\n\t\tthis.startColor.cloneTo(destObject.startColor);\r\n\t\tthis.endColor.cloneTo(destObject.endColor);\r\n\t}\r\n}\r\n\r\n","import { Color } from \"../../../maths/Color\";\r\nimport { Vector3 } from \"../../../maths/Vector3\";\r\nimport { BufferUsage } from \"../../../RenderEngine/RenderEnum/BufferTargetType\";\r\nimport { DrawType } from \"../../../RenderEngine/RenderEnum/DrawType\";\r\nimport { MeshTopology } from \"../../../RenderEngine/RenderEnum/RenderPologyMode\";\r\nimport { BufferState } from \"../../../webgl/utils/BufferState\";\r\nimport { VertexBuffer3D } from \"../../graphics/VertexBuffer3D\";\r\nimport { Bounds } from \"../../math/Bounds\";\r\nimport { Laya3DRender } from \"../../RenderObjs/Laya3DRender\";\r\nimport { GeometryElement } from \"../GeometryElement\";\r\nimport { RenderContext3D } from \"../render/RenderContext3D\";\r\nimport { PixelLineData } from \"./PixelLineData\";\r\nimport { PixelLineRenderer } from \"./PixelLineRenderer\";\r\nimport { PixelLineVertex } from \"./PixelLineVertex\";\r\n\r\n/**\r\n * <code>PixelLineFilter</code> \r\n */\r\nexport class PixelLineFilter extends GeometryElement {\r\n\t/** @private */\r\n\tprivate static _tempVector0: Vector3 = new Vector3();\r\n\t/** @private */\r\n\tprivate static _tempVector1: Vector3 = new Vector3();\r\n\r\n\t/**@internal */\r\n\tprivate static _type: number = GeometryElement._typeCounter++;\r\n\r\n\t/** @internal */\r\n\tprivate _floatCountPerVertices: number = 7;\r\n\r\n\r\n\t/** @internal */\r\n\tprivate _vertexBuffer: VertexBuffer3D;\r\n\t/** @internal */\r\n\tprivate _vertices: Float32Array;\r\n\t/** @internal */\r\n\tprivate _minUpdate: number = Number.MAX_VALUE;\r\n\t/** @internal */\r\n\tprivate _maxUpdate: number = Number.MIN_VALUE;\r\n\t/** @internal */\r\n\tprivate _floatBound: Float32Array = new Float32Array(6);\r\n\t/** @internal */\r\n\tprivate _calculateBound: boolean = false;\r\n\r\n\t/** @internal */\r\n\t_ownerRender: PixelLineRenderer;\r\n\t/** @internal */\r\n\t_bounds: Bounds;\r\n\t/** @internal */\r\n\t_maxLineCount: number = 0;\r\n\t/** @internal */\r\n\t_lineCount: number = 0;\r\n\r\n\t/**\r\n\t * PixelLineFilter\r\n\t * @param owner  \r\n\t * @param maxLineCount \r\n\t */\r\n\tconstructor(owner: PixelLineRenderer, maxLineCount: number) {\r\n\t\tsuper(MeshTopology.Lines, DrawType.DrawArray);\r\n\t\tvar pointCount: number = maxLineCount * 2;\r\n\t\tthis._ownerRender = owner;\r\n\t\tthis._maxLineCount = maxLineCount;\r\n\t\tthis._vertices = new Float32Array(pointCount * this._floatCountPerVertices);\r\n\t\tthis._vertexBuffer = Laya3DRender.renderOBJCreate.createVertexBuffer3D(PixelLineVertex.vertexDeclaration.vertexStride * pointCount, BufferUsage.Static, false);\r\n\t\tthis._vertexBuffer.vertexDeclaration = PixelLineVertex.vertexDeclaration;\r\n\r\n\t\tvar bufferState = new BufferState();\r\n\t\tthis.bufferState = bufferState;\r\n\t\tthis.bufferState.applyState([this._vertexBuffer], null);\r\n\r\n\t\tvar min: Vector3 = PixelLineFilter._tempVector0;\r\n\t\tvar max: Vector3 = PixelLineFilter._tempVector1;\r\n\t\tmin.setValue(Number.MAX_VALUE, Number.MAX_VALUE, Number.MAX_VALUE);\r\n\t\tmax.setValue(-Number.MAX_VALUE, -Number.MAX_VALUE, -Number.MAX_VALUE);\r\n\t\tthis._bounds = new Bounds(min, max);\r\n\t}\r\n\r\n\t/**\r\n\t *\t{@inheritDoc PixelLineFilter._getType}\r\n\t *\t@override\r\n\t *  @internal\r\n\t */\r\n\t_getType(): number {\r\n\t\treturn PixelLineFilter._type;\r\n\t}\r\n\r\n\t/**\r\n\t * @internal\r\n\t */\r\n\t_resizeLineData(maxCount: number): void {\r\n\t\tvar pointCount: number = maxCount * 2;\r\n\t\tvar lastVertices: Float32Array = this._vertices;\r\n\r\n\t\tthis._vertexBuffer.destroy();\r\n\t\tthis._maxLineCount = maxCount;\r\n\r\n\t\tvar vertexCount: number = pointCount * this._floatCountPerVertices;\r\n\t\tthis._vertices = new Float32Array(vertexCount);\r\n\t\tthis._vertexBuffer = Laya3DRender.renderOBJCreate.createVertexBuffer3D(PixelLineVertex.vertexDeclaration.vertexStride * pointCount, BufferUsage.Static, false);\r\n\t\tthis._vertexBuffer.vertexDeclaration = PixelLineVertex.vertexDeclaration;\r\n\r\n\t\tif (vertexCount < lastVertices.length) {//,\r\n\t\t\tthis._vertices.set(new Float32Array(lastVertices.buffer, 0, vertexCount));\r\n\t\t\tthis._vertexBuffer.setData(this._vertices.buffer, 0, 0, vertexCount * 4);\r\n\t\t} else {\r\n\t\t\tthis._vertices.set(lastVertices);\r\n\t\t\tthis._vertexBuffer.setData(this._vertices.buffer, 0, 0, lastVertices.length * 4);\r\n\t\t}\r\n\r\n\t\tthis.bufferState.applyState([this._vertexBuffer], null);\r\n\r\n\t\tthis._minUpdate = Number.MAX_VALUE;\r\n\t\tthis._maxUpdate = Number.MIN_VALUE;\r\n\t}\r\n\r\n\t/**\r\n\t * @internal\r\n\t */\r\n\tprivate _updateLineVertices(offset: number, startPosition: Vector3, endPosition: Vector3, startColor: Color, endColor: Color): void {\r\n\t\tif (startPosition) {\r\n\t\t\tthis._vertices[offset + 0] = startPosition.x;\r\n\t\t\tthis._vertices[offset + 1] = startPosition.y;\r\n\t\t\tthis._vertices[offset + 2] = startPosition.z;\r\n\t\t}\r\n\r\n\t\tif (startColor) {\r\n\t\t\tthis._vertices[offset + 3] = startColor.r;\r\n\t\t\tthis._vertices[offset + 4] = startColor.g;\r\n\t\t\tthis._vertices[offset + 5] = startColor.b;\r\n\t\t\tthis._vertices[offset + 6] = startColor.a;\r\n\t\t}\r\n\r\n\t\tif (endPosition) {\r\n\t\t\tthis._vertices[offset + 7] = endPosition.x;\r\n\t\t\tthis._vertices[offset + 8] = endPosition.y;\r\n\t\t\tthis._vertices[offset + 9] = endPosition.z;\r\n\t\t}\r\n\r\n\t\tif (endColor) {\r\n\t\t\tthis._vertices[offset + 10] = endColor.r;\r\n\t\t\tthis._vertices[offset + 11] = endColor.g;\r\n\t\t\tthis._vertices[offset + 12] = endColor.b;\r\n\t\t\tthis._vertices[offset + 13] = endColor.a;\r\n\t\t}\r\n\t\tthis._minUpdate = Math.min(this._minUpdate, offset);\r\n\t\tthis._maxUpdate = Math.max(this._maxUpdate, offset + this._floatCountPerVertices * 2);\r\n\r\n\t\t//expand bound\r\n\t\tvar bounds: Bounds = this._bounds;\r\n\t\tvar floatBound: Float32Array = this._floatBound;\r\n\t\tvar min: Vector3 = bounds.getMin(), max: Vector3 = bounds.getMax();\r\n\t\tVector3.min(min, startPosition, min);\r\n\t\tVector3.min(min, endPosition, min);\r\n\t\tVector3.max(max, startPosition, max);\r\n\t\tVector3.max(max, endPosition, max);\r\n\t\tbounds.setMin(min);\r\n\t\tbounds.setMax(max);\r\n\t\tfloatBound[0] = min.x, floatBound[1] = min.y, floatBound[2] = min.z;\r\n\t\tfloatBound[3] = max.x, floatBound[4] = max.y, floatBound[5] = max.z;\r\n\t\tthis._ownerRender.boundsChange = true;\r\n\t}\r\n\r\n\r\n\t/**\r\n\t * @internal\r\n\t */\r\n\t_reCalculateBound(): void {\r\n\t\tif (this._calculateBound) {\r\n\t\t\tvar vertices: Float32Array = this._vertices;\r\n\t\t\tvar min: Vector3 = PixelLineFilter._tempVector0;\r\n\t\t\tvar max: Vector3 = PixelLineFilter._tempVector1;\r\n\t\t\tmin.setValue(Number.MAX_VALUE, Number.MAX_VALUE, Number.MAX_VALUE);\r\n\t\t\tmax.setValue(-Number.MAX_VALUE, -Number.MAX_VALUE, -Number.MAX_VALUE);\r\n\t\t\tfor (var i: number = 0; i < this._lineCount * 2; ++i) {\r\n\t\t\t\tvar offset: number = this._floatCountPerVertices * i;\r\n\t\t\t\tvar x: number = vertices[offset + 0], y: number = vertices[offset + 1], z: number = vertices[offset + 2];\r\n\t\t\t\tmin.x = Math.min(x, min.x);\r\n\t\t\t\tmin.y = Math.min(y, min.y);\r\n\t\t\t\tmin.z = Math.min(z, min.z);\r\n\t\t\t\tmax.x = Math.max(x, max.x);\r\n\t\t\t\tmax.y = Math.max(y, max.y);\r\n\t\t\t\tmax.z = Math.max(z, max.z);\r\n\t\t\t}\r\n\t\t\tthis._bounds.setMin(min);\r\n\t\t\tthis._bounds.setMax(max);\r\n\t\t\tvar floatBound: Float32Array = this._floatBound;\r\n\t\t\tfloatBound[0] = min.x, floatBound[1] = min.y, floatBound[2] = min.z;\r\n\t\t\tfloatBound[3] = max.x, floatBound[4] = max.y, floatBound[5] = max.z;\r\n\t\t\tthis._calculateBound = false;\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @internal\r\n\t */\r\n\t_removeLineData(index: number): void {\r\n\t\tvar floatCount: number = this._floatCountPerVertices * 2;\r\n\t\tvar nextIndex: number = index + 1;\r\n\t\tvar offset: number = index * floatCount;\r\n\r\n\t\tvar vertices: Float32Array = this._vertices;\r\n\t\tvar rightPartVertices: Float32Array = new Float32Array(vertices.buffer, nextIndex * floatCount * 4, (this._lineCount - nextIndex) * floatCount);\r\n\t\tvertices.set(rightPartVertices, offset);\r\n\t\tthis._minUpdate = Math.min(this._minUpdate, offset);\r\n\t\tthis._maxUpdate = Math.max(this._maxUpdate, offset + rightPartVertices.length);\r\n\t\tthis._lineCount--;\r\n\r\n\t\tvar floatBound: Float32Array = this._floatBound;\r\n\t\tvar startX: number = vertices[offset], startY: number = vertices[offset + 1], startZ: number = vertices[offset + 2];\r\n\t\tvar endX: number = vertices[offset + 7], endY: number = vertices[offset + 8], endZ: number = vertices[offset + 9];\r\n\t\tvar minX: number = floatBound[0], minY: number = floatBound[1], minZ: number = floatBound[2];\r\n\t\tvar maxX: number = floatBound[3], maxY: number = floatBound[4], maxZ: number = floatBound[5];\r\n\r\n\t\tif ((startX === minX) || (startX === maxX) || (startY === minY) || (startY === maxY) || (startZ === minZ) || (startZ === maxZ) ||\r\n\t\t\t(endX === minX) || (endX === maxX) || (endY === minY) || (endY === maxY) || (endZ === minZ) || (endZ === maxZ))\r\n\t\t\tthis._calculateBound = true;\r\n\t}\r\n\r\n\t/**\r\n\t * @internal\r\n\t */\r\n\t_updateLineData(index: number, startPosition: Vector3, endPosition: Vector3, startColor: Color, endColor: Color): void {\r\n\t\tvar floatCount: number = this._floatCountPerVertices * 2;\r\n\t\tthis._updateLineVertices(index * floatCount, startPosition, endPosition, startColor, endColor);\r\n\t}\r\n\r\n\t/**\r\n\t * @internal\r\n\t */\r\n\t_updateLineDatas(index: number, data: PixelLineData[]): void {\r\n\t\tvar floatCount: number = this._floatCountPerVertices * 2;\r\n\t\tvar count: number = data.length;\r\n\t\tfor (var i: number = 0; i < count; i++) {\r\n\t\t\tvar line: PixelLineData = data[i];\r\n\t\t\tthis._updateLineVertices((index + i) * floatCount, line.startPosition, line.endPosition, line.startColor, line.endColor);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t * @return \r\n\t */\r\n\t_getLineData(index: number, out: PixelLineData): void {\r\n\t\tvar startPosition: Vector3 = out.startPosition;\r\n\t\tvar startColor: Color = out.startColor;\r\n\t\tvar endPosition: Vector3 = out.endPosition;\r\n\t\tvar endColor: Color = out.endColor;\r\n\r\n\t\tvar vertices: Float32Array = this._vertices;\r\n\t\tvar offset: number = index * this._floatCountPerVertices * 2;\r\n\r\n\t\tstartPosition.x = vertices[offset + 0];\r\n\t\tstartPosition.y = vertices[offset + 1];\r\n\t\tstartPosition.z = vertices[offset + 2];\r\n\t\tstartColor.r = vertices[offset + 3];\r\n\t\tstartColor.g = vertices[offset + 4];\r\n\t\tstartColor.b = vertices[offset + 5];\r\n\t\tstartColor.a = vertices[offset + 6];\r\n\r\n\t\tendPosition.x = vertices[offset + 7];\r\n\t\tendPosition.y = vertices[offset + 8];\r\n\t\tendPosition.z = vertices[offset + 9];\r\n\t\tendColor.r = vertices[offset + 10];\r\n\t\tendColor.g = vertices[offset + 11];\r\n\t\tendColor.b = vertices[offset + 12];\r\n\t\tendColor.a = vertices[offset + 13];\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t * @override\r\n\t * @internal\r\n\t */\r\n\t_prepareRender(state: RenderContext3D): boolean {\r\n\t\treturn true;\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t * @override\r\n\t * @internal\r\n\t */\r\n\t_updateRenderParams(state: RenderContext3D): void {\r\n\t\tthis.clearRenderParams();\r\n\t\tif (this._minUpdate !== Number.MAX_VALUE && this._maxUpdate !== Number.MIN_VALUE) {\r\n\t\t\tthis._vertexBuffer.setData(this._vertices.buffer, this._minUpdate * 4, this._minUpdate * 4, (this._maxUpdate - this._minUpdate) * 4);\r\n\t\t\tthis._minUpdate = Number.MAX_VALUE;\r\n\t\t\tthis._maxUpdate = Number.MIN_VALUE;\r\n\t\t}\r\n\t\tif (this._lineCount > 0) {\r\n\t\t\tthis.setDrawArrayParams(0, this._lineCount * 2);\r\n\t\t\t// LayaGL.renderDrawConatext.drawArrays(MeshTopology.Lines, 0, this._lineCount * 2);\r\n\t\t\t// Stat.renderBatches++;\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t * @override\r\n\t * \r\n\t */\r\n\tdestroy(): void {\r\n\t\tif (this._destroyed)\r\n\t\t\treturn;\r\n\t\tsuper.destroy();\r\n\t\tthis.bufferState.destroy();\r\n\t\tthis._vertexBuffer.destroy();\r\n\t\tthis.bufferState = null;\r\n\t\tthis._vertexBuffer = null;\r\n\t\tthis._vertices = null;\r\n\t}\r\n}\r\n\r\n","import { Vector4 } from \"../../../maths/Vector4\";\r\nimport { Shader3D } from \"../../../RenderEngine/RenderShader/Shader3D\";\r\nimport { Material } from \"../../../resource/Material\";\r\n\r\n/**\r\n * <code>PixelLineMaterial</code> \r\n */\r\nexport class PixelLineMaterial extends Material {\r\n\t/**@internal */\r\n\tstatic COLOR: number;\r\n\r\n\t/** */\r\n\tstatic defaultMaterial: PixelLineMaterial;\r\n\r\n\t/**\r\n\t* @internal\r\n\t*/\r\n\tstatic __initDefine__(): void {\r\n\t\tPixelLineMaterial.COLOR = Shader3D.propertyNameToID(\"u_Color\");\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t * @return \r\n\t */\r\n\tget color(): Vector4 {\r\n\t\treturn (<Vector4>this._shaderValues.getVector(PixelLineMaterial.COLOR));\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t * @param value \r\n\t */\r\n\tset color(value: Vector4) {\r\n\t\tthis._shaderValues.setVector(PixelLineMaterial.COLOR, value);\r\n\t}\r\n\r\n\t/**\r\n\t *   <code>PixelLineMaterial</code> \r\n\t */\r\n\tconstructor() {\r\n\t\tsuper();\r\n\t\tthis.setShaderName(\"LineShader\");\r\n\t\tthis._shaderValues.setVector(PixelLineMaterial.COLOR, new Vector4(1.0, 1.0, 1.0, 1.0));\r\n\t}\r\n\r\n\t/**\r\n\t * @internal\r\n\t * \r\n\t * @return\t \r\n\t */\r\n\tclone(): any {\r\n\t\tvar dest: PixelLineMaterial = new PixelLineMaterial();\r\n\t\tthis.cloneTo(dest);\r\n\t\treturn dest;\r\n\t}\r\n\r\n}\r\n\r\n","import { Component } from \"../../../components/Component\";\r\nimport { Color } from \"../../../maths/Color\";\r\nimport { Matrix4x4 } from \"../../../maths/Matrix4x4\";\r\nimport { Vector3 } from \"../../../maths/Vector3\";\r\nimport { Vector4 } from \"../../../maths/Vector4\";\r\nimport { ShaderData } from \"../../../RenderEngine/RenderShader/ShaderData\";\r\nimport { Material } from \"../../../resource/Material\";\r\nimport { MeshSprite3DShaderDeclaration } from \"../MeshSprite3DShaderDeclaration\";\r\nimport { BaseRender } from \"../render/BaseRender\";\r\nimport { RenderContext3D } from \"../render/RenderContext3D\";\r\nimport { RenderElement } from \"../render/RenderElement\";\r\nimport { Sprite3D } from \"../Sprite3D\";\r\nimport { Transform3D } from \"../Transform3D\";\r\nimport { PixelLineData } from \"./PixelLineData\";\r\nimport { PixelLineFilter } from \"./PixelLineFilter\";\r\nimport { PixelLineMaterial } from \"./PixelLineMaterial\";\r\n\r\n\r\n/**\r\n * <code>PixelLineRenderer</code> \r\n */\r\nexport class PixelLineRenderer extends BaseRender {\r\n    /** @internal */\r\n    protected _projectionViewWorldMatrix: Matrix4x4;\r\n\r\n    /**@internal */\r\n    _pixelLineFilter: PixelLineFilter;\r\n    /** @private active */\r\n    private _isRenderActive: Boolean = false;\r\n    /** @private */\r\n    private _isInRenders: Boolean = false;\r\n\r\n    private _needUpdatelines: boolean = false;\r\n    /**\r\n     * PixelLineRenderer\r\n     * @param owner \r\n     */\r\n    constructor() {\r\n        super();\r\n        this._projectionViewWorldMatrix = new Matrix4x4();\r\n        this._pixelLineFilter = new PixelLineFilter(this, 20);\r\n        this._shaderValues.addDefine(MeshSprite3DShaderDeclaration.SHADERDEFINE_COLOR);\r\n    }\r\n\r\n    private _lines: PixelLineData[] = [];\r\n\r\n    get pixelLinesDatas() {\r\n        if (this._needUpdatelines) {\r\n            this._updateLineDatas();\r\n        }\r\n        return this._lines;\r\n    }\r\n\r\n    set pixelLinesDatas(value: PixelLineData[]) {\r\n        this.clear();\r\n        this.addLines(value);\r\n    }\r\n\r\n    /**\r\n     * \r\n     */\r\n    get maxLineCount(): number {\r\n        return this._pixelLineFilter._maxLineCount;\r\n    }\r\n\r\n    set maxLineCount(value: number) {\r\n        this._pixelLineFilter._resizeLineData(value);\r\n        this._pixelLineFilter._lineCount = Math.min(this._pixelLineFilter._lineCount, value);\r\n    }\r\n\r\n    /**\r\n     * \r\n     */\r\n    get lineCount(): number {\r\n        return this._pixelLineFilter._lineCount;\r\n    }\r\n\r\n    protected _onAdded(): void {\r\n        super._onAdded();\r\n        this._changeRenderObjects(0, PixelLineMaterial.defaultMaterial);\r\n    }\r\n\r\n    protected _onEnable(): void {\r\n        this._isRenderActive = true;\r\n        if (this._pixelLineFilter._lineCount != 0) {\r\n            (this.owner.scene)._addRenderObject(this);\r\n            this._isInRenders = true;\r\n        }\r\n        this._setBelongScene(this.owner.scene);\r\n    }\r\n\r\n    protected _onDisable(): void {\r\n        if (this._pixelLineFilter && this._pixelLineFilter._lineCount != 0 && this._isRenderActive) {\r\n            this.owner.scene._removeRenderObject(this);\r\n            this._isInRenders = false;\r\n        }\r\n        this._isRenderActive = false;\r\n        this._setUnBelongScene();\r\n    }\r\n\r\n    /**\r\n     * @inheritDoc\r\n     * @override\r\n     * @internal\r\n     */\r\n    protected _calculateBoundingBox(): void {\r\n        var worldMat: Matrix4x4 = (this.owner as Sprite3D).transform.worldMatrix;\r\n        var lineFilter: PixelLineFilter = this._pixelLineFilter;\r\n        lineFilter._reCalculateBound();\r\n        lineFilter._bounds._tranform(worldMat, this._bounds);\r\n    }\r\n\r\n    /**\r\n     * @inheritDoc\r\n     * @override\r\n     * @internal\r\n     */\r\n    _renderUpdateWithCamera(context: RenderContext3D, transform: Transform3D): void {//TODO:_renderUpdate\r\n        var projectionView: Matrix4x4 = context.projectionViewMatrix;\r\n        var sv: ShaderData = this._shaderValues;\r\n        if (transform) {\r\n            var worldMat: Matrix4x4 = transform.worldMatrix;\r\n            sv.setMatrix4x4(Sprite3D.WORLDMATRIX, worldMat);\r\n            this._worldParams.x = transform.getFrontFaceValue();\r\n            sv.setVector(Sprite3D.WORLDINVERTFRONT, this._worldParams);\r\n        } else {\r\n            sv.setMatrix4x4(Sprite3D.WORLDMATRIX, Matrix4x4.DEFAULT);\r\n            sv.setVector(Sprite3D.WORLDINVERTFRONT, Vector4.UnitX);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * @inheritDoc\r\n     */\r\n    _changeRenderObjects(index: number, material: Material): void {\r\n        var renderObjects: RenderElement[] = this._renderElements;\r\n        var renderElement: RenderElement = renderObjects[index];\r\n        (renderElement) || (renderElement = renderObjects[index] = new RenderElement());\r\n        renderElement.setTransform((this.owner as Sprite3D)._transform);\r\n        renderElement.setGeometry(this._pixelLineFilter);\r\n        renderElement.render = this;\r\n\r\n        this.sharedMaterial = material;\r\n    }\r\n\r\n    /**\r\n     * @internal //animator data set call\r\n     * @param key \r\n     */\r\n    _pixelLinesDataChange(key: string) {\r\n        if (key != null) {\r\n            let keyN = parseInt(key);\r\n            let line = this._lines[keyN];\r\n            if (line) {\r\n                this.setLine(keyN, line.startPosition, line.endPosition, line.startColor, line.endColor);\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @param\tstartPosition  \r\n     * @param\tendPosition\t   \r\n     * @param\tstartColor\t   \r\n     * @param\tendColor\t   \r\n     */\r\n    addLine(startPosition: Vector3, endPosition: Vector3, startColor: Color, endColor: Color): void {\r\n        if (this._pixelLineFilter._lineCount !== this._pixelLineFilter._maxLineCount)\r\n            this._pixelLineFilter._updateLineData(this._pixelLineFilter._lineCount++, startPosition, endPosition, startColor, endColor);\r\n        else\r\n            throw \"PixelLineSprite3D: lineCount has equal with maxLineCount.\";\r\n        if (this._isRenderActive && !this._isInRenders && this._pixelLineFilter._lineCount > 0) {\r\n            this.owner.scene && this.owner.scene._addRenderObject(this);\r\n            this._isInRenders = true;\r\n        }\r\n        this._needUpdatelines = true;\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @param\tlines  \r\n     */\r\n    addLines(lines: PixelLineData[]): void {\r\n        var lineCount: number = this._pixelLineFilter._lineCount;\r\n        var addCount: number = lines.length;\r\n        if (lineCount + addCount > this._pixelLineFilter._maxLineCount) {\r\n            throw \"PixelLineSprite3D: lineCount plus lines count must less than maxLineCount.\";\r\n        } else {\r\n            this._pixelLineFilter._updateLineDatas(lineCount, lines);\r\n            this._pixelLineFilter._lineCount += addCount;\r\n        }\r\n        if (this._isRenderActive && !this._isInRenders && this._pixelLineFilter._lineCount > 0) {\r\n            this.owner.scene && this.owner.scene._addRenderObject(this);\r\n            this._isInRenders = true;\r\n        }\r\n        this._needUpdatelines = true;\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @param index \r\n     */\r\n    removeLine(index: number): void {\r\n        if (index < this._pixelLineFilter._lineCount)\r\n            this._pixelLineFilter._removeLineData(index);\r\n        else\r\n            throw \"PixelLineSprite3D: index must less than lineCount.\";\r\n        if (this._isRenderActive && this._isInRenders && this._pixelLineFilter._lineCount == 0) {\r\n            this.owner.scene && this.owner.scene._removeRenderObject(this);\r\n            this._isInRenders = false;\r\n        }\r\n        this._needUpdatelines = true;\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @param\tindex  \t\t   \r\n     * @param\tstartPosition  \r\n     * @param\tendPosition\t   \r\n     * @param\tstartColor\t   \r\n     * @param\tendColor\t   \r\n     */\r\n    setLine(index: number, startPosition: Vector3, endPosition: Vector3, startColor: Color, endColor: Color): void {\r\n        if (index < this._pixelLineFilter._lineCount) {\r\n            this._pixelLineFilter._updateLineData(index, startPosition, endPosition, startColor, endColor);\r\n            let pixeldata = this._lines[index];\r\n            if (pixeldata) {\r\n                startColor.cloneTo(pixeldata.startColor);\r\n                endColor.cloneTo(pixeldata.endColor);\r\n                startPosition.cloneTo(pixeldata.startPosition);\r\n                endPosition.cloneTo(pixeldata.endPosition);\r\n            }\r\n        }\r\n\r\n        else\r\n            throw \"PixelLineSprite3D: index must less than lineCount.\";\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @param out \r\n     */\r\n    getLine(index: number, out: PixelLineData): void {\r\n        if (index < this.lineCount)\r\n            this._pixelLineFilter._getLineData(index, out);\r\n        else\r\n            throw \"PixelLineSprite3D: index must less than lineCount.\";\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    private _updateLineDatas() {\r\n        let n = this.lineCount;\r\n        this._lines = [];\r\n        for (let i = 0; i < n; i++) {\r\n            let pixelLineDatas = new PixelLineData();\r\n            this.getLine(i, pixelLineDatas);\r\n            this._lines.push(pixelLineDatas);\r\n        }\r\n        this._needUpdatelines = false;\r\n    }\r\n\r\n    /**\r\n     * \r\n     */\r\n    clear(): void {\r\n        this._pixelLineFilter._lineCount = 0;\r\n        if (this._isRenderActive && this._isInRenders) {\r\n            this.owner.scene && this.owner.scene._removeRenderObject(this);\r\n            this._isInRenders = false;\r\n        }\r\n    }\r\n\r\n    protected _onDestroy() {\r\n        this._pixelLineFilter.destroy();\r\n        this._pixelLineFilter = null;\r\n        super._onDestroy();\r\n    }\r\n\r\n    /**\r\n     * @override\r\n     * @param dest \r\n     */\r\n    _cloneTo(dest: Component): void {\r\n        super._cloneTo(dest);\r\n        let render = dest as PixelLineRenderer;\r\n        render.maxLineCount = this.maxLineCount;\r\n        const lineCount = this.lineCount;\r\n        let linedata = new PixelLineData();\r\n        for (let i = 0, n = lineCount; i < n; i++) {\r\n            this.getLine(i, linedata);\r\n            render.addLine(linedata.startPosition, linedata.endPosition, linedata.startColor, linedata.endColor);\r\n        }\r\n    }\r\n\r\n}\r\n\r\n\r\n","import { AnimatorState } from \"./AnimatorState\";\r\n\r\n/**\r\n * <code>AnimatorPlayState</code> \r\n */\r\nexport class AnimatorPlayState {\r\n\t/**@internal */\r\n\t_finish: boolean;\r\n\t/**@internal */\r\n\t_startPlayTime: number;\r\n\t/**@internal */\r\n\t_lastElapsedTime: number;\r\n\t/**@internal */\r\n\t_elapsedTime: number;\r\n\t/**@internal ,*/\r\n\t_normalizedTime: number;\r\n\t/**@internal  */\r\n\t_normalizedPlayTime: number;\r\n\t/**@internal */\r\n\t_duration: number;\r\n\t/**@internal event*/\r\n\t_parentPlayTime: number;\r\n\t/**@internal */\r\n\t_playEventIndex: number;\r\n\t/**@internal */\r\n\t_lastIsFront: boolean;\r\n\t/**@internal */\r\n\tprivate _currentState: AnimatorState | null = null;\r\n\r\n\t/**\r\n\t * State\r\n\t */\r\n\tpublic get currentState(): AnimatorState | null {\r\n\t\treturn this._currentState;\r\n\t}\r\n\tpublic set currentState(value: AnimatorState | null) {\r\n\t\tthis._currentState = value;\r\n\t\tthis._currentState.curTransition = null;//\r\n\t}\r\n\r\n\t/**\r\n\t * ,\r\n\t */\r\n\tget normalizedTime(): number {\r\n\t\treturn this._normalizedTime;\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t */\r\n\tget duration(): number {\r\n\t\treturn this._duration;\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t */\r\n\tget animatorState(): AnimatorState {\r\n\t\treturn this._currentState!;\r\n\t}\r\n\r\n\t/**\r\n\t *  <code>AnimatorPlayState</code> \r\n\t */\r\n\tconstructor() {\r\n\t}\r\n\r\n\t/**\r\n\t * @internal\r\n\t */\r\n\t_resetPlayState(startTime: number, clipDuration: number): void {\r\n\t\tthis._finish = false;\r\n\t\tthis._playEventIndex = 0;\r\n\t\tthis._startPlayTime = startTime;\r\n\t\tthis._elapsedTime = startTime;\r\n\t\tthis._lastIsFront = true;\r\n\t\tthis._normalizedTime = this._elapsedTime / clipDuration;\r\n\t\tvar playTime = this._normalizedTime % 1.0;\r\n\t\tthis._normalizedPlayTime = playTime < 0 ? playTime + 1.0 : playTime;\r\n\t}\r\n\r\n\t/**\r\n\t * @internal\r\n\t */\r\n\t_cloneTo(dest: AnimatorPlayState): void {\r\n\t\tdest._finish = this._finish;\r\n\t\tdest._startPlayTime = this._startPlayTime;\r\n\t\tdest._playEventIndex = this._playEventIndex;\r\n\t\tdest._elapsedTime = this._elapsedTime;\r\n\t\tdest._normalizedTime = this._normalizedTime;\r\n\t\tdest._normalizedPlayTime = this._normalizedPlayTime;\r\n\t\tdest._lastIsFront = this._lastIsFront;\r\n\t}\r\n\r\n}\r\n\r\n\r\n","import { IClone } from \"../../../utils/IClone\";\r\nimport { AnimationClip } from \"../../animation/AnimationClip\";\r\nimport { Animator } from \"./Animator\";\r\nimport { AnimatorPlayState } from \"./AnimatorPlayState\";\r\nimport { AnimatorState } from \"./AnimatorState\";\r\nimport { AvatarMask } from \"./AvatarMask\";\r\nimport { KeyframeNodeOwner } from \"./KeyframeNodeOwner\";\r\n\r\n\r\n/**\r\n * <code>AnimatorControllerLayer</code> \r\n */\r\nexport class AnimatorControllerLayer implements IClone {\r\n    /**_ */\r\n    static BLENDINGMODE_OVERRIDE: number = 0;\r\n    /**_ */\r\n    static BLENDINGMODE_ADDTIVE: number = 1;\r\n\r\n    /**@internal */\r\n    private _defaultState: AnimatorState | null;\r\n    /**@internal */\r\n    private _referenceCount: number = 0;\r\n\r\n    /**@internal 0:1:2:*/\r\n    _playType: number = -1;\r\n    /**@internal */\r\n    _crossDuration: number = -1;\r\n    /**@internal */\r\n    _crossPlayState: AnimatorState;\r\n    /**@internal */\r\n    _crossMark: number = 0;\r\n    /**@internal */\r\n    _crossNodesOwnersCount: number = 0;\r\n    /**@internal */\r\n    _crossNodesOwners: KeyframeNodeOwner[] = [];\r\n    /**@internal */\r\n    _crossNodesOwnersIndicesMap: any = {};\r\n    /**@internal */\r\n    _srcCrossClipNodeIndices: number[] = [];\r\n    /**@internal */\r\n    _destCrossClipNodeIndices: number[] = [];\r\n\r\n    /**@internal */\r\n    _animator: Animator;\r\n    /**@internal */\r\n    _states: AnimatorState[] = [];\r\n    /**@internal */\r\n    _playStateInfo: AnimatorPlayState | null = new AnimatorPlayState();\r\n    /**@internal */\r\n    _crossPlayStateInfo: AnimatorPlayState | null = new AnimatorPlayState();\r\n    /**@internal */\r\n    _avatarMask: AvatarMask;\r\n    /** */\r\n    name: string;\r\n    /** */\r\n    blendingMode: number = AnimatorControllerLayer.BLENDINGMODE_OVERRIDE;\r\n    /** */\r\n    defaultWeight: number = 1.0;\r\n    /**\t*/\r\n    playOnWake: boolean = true;\r\n    /**  */\r\n    enable: boolean = true;\r\n\r\n    /**\r\n     * \r\n     */\r\n    get defaultState(): AnimatorState {\r\n        return this._defaultState!;\r\n    }\r\n\r\n    set defaultState(value: AnimatorState) {\r\n        this._defaultState = value;\r\n    }\r\n\r\n    /**\r\n     * \r\n     */\r\n    get avatarMask(): AvatarMask {\r\n        return this._avatarMask;\r\n    }\r\n\r\n    set avatarMask(value: AvatarMask) {\r\n        this._avatarMask = value;\r\n    }\r\n\r\n    //@internal\r\n    public get defaultStateName() {\r\n        if (!this._defaultState) {\r\n            return null;\r\n        }\r\n        return this._defaultState.name;\r\n    }\r\n\r\n    private _defaultStateNameCatch: string;\r\n    //@internal\r\n    public set defaultStateName(value: string) {\r\n        this._defaultState = this.getAnimatorState(value);\r\n        if (null == this._defaultState) {\r\n            if (0 == this._states.length) {\r\n                this._defaultStateNameCatch = value;\r\n            } else {\r\n                for (var i = this._states.length - 1; i >= 0; i--) {\r\n                    if (this._states[i].name == value) {\r\n                        this._defaultState = this._states[i];\r\n                        break;\r\n                    }\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    //@internal\r\n    public get states(): ReadonlyArray<AnimatorState> {\r\n        return this._states;\r\n    }\r\n\r\n    //@internal\r\n    public set states(states: ReadonlyArray<AnimatorState>) {\r\n        if (this._states === states)\r\n            return;\r\n\r\n        if (this._states.length > 0) {\r\n            let removed = this._states.filter(s => states.indexOf(s) == -1);\r\n            for (let state of removed)\r\n                this.removeState(state);\r\n        }\r\n\r\n        if (states.length > 0) {\r\n            let newAdded = states.filter(s => this._states.indexOf(s) == -1);\r\n            for (let state of newAdded)\r\n                this.addState(state);\r\n        }\r\n\r\n        this._states.length = 0;\r\n        this._states.push(...states);\r\n    }\r\n\r\n    /**\r\n     *  <code>AnimatorControllerLayer</code> \r\n     * @param \r\n     */\r\n    constructor(name: string) {\r\n        this.name = name;\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    private _removeClip(clipStateInfos: AnimatorState[], index: number, state: AnimatorState): void {\r\n        var clip: AnimationClip = state._clip!;\r\n        var clipStateInfo: AnimatorState = clipStateInfos[index];\r\n\r\n        clipStateInfos.splice(index, 1);\r\n\r\n        if (this._animator) {\r\n            var frameNodes = clip._nodes;\r\n            var nodeOwners: KeyframeNodeOwner[] = clipStateInfo._nodeOwners;\r\n            clip._removeReference();\r\n            for (var i: number = 0, n: number = frameNodes!.count; i < n; i++)\r\n                this._animator._removeKeyframeNodeOwner(nodeOwners, frameNodes!.getNodeByIndex(i));\r\n        }\r\n    }\r\n\r\n    _getReferenceCount(): number {\r\n        return this._referenceCount;\r\n    }\r\n\r\n    _addReference(count: number = 1): void {\r\n        for (var i: number = 0, n: number = this._states.length; i < n; i++)\r\n            this._states[i]._addReference(count);\r\n        this._referenceCount += count;\r\n    }\r\n\r\n    _removeReference(count: number = 1): void {\r\n        for (var i: number = 0, n: number = this._states.length; i < n; i++)\r\n            this._states[i]._removeReference(count);\r\n        this._referenceCount -= count;\r\n    }\r\n\r\n    _clearReference(): void {\r\n        this._removeReference(-this._referenceCount);\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @return \r\n     */\r\n    getCurrentPlayState(): AnimatorPlayState {\r\n        return this._playStateInfo!;\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @return \r\n     */\r\n    getAnimatorState(name: string): AnimatorState | null {\r\n        var state: AnimatorState;;\r\n        for (let i = 0; i < this._states.length; i++) {\r\n            if (this._states[i].name == name) {\r\n                state = this._states[i];\r\n                break;\r\n            }\r\n        }\r\n        return state ? state : null;\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @param\tstate \r\n     * @param   layerIndex \r\n     */\r\n    addState(state: AnimatorState): void {\r\n        var stateName: string = state.name;\r\n        if (this.getAnimatorState(stateName)) {\r\n            throw \"AnimatorControllerLayer:this stat's name has exist.\";\r\n        } else {\r\n            this._states.push(state);\r\n            if (stateName == this._defaultStateNameCatch) {\r\n                this._defaultState = state;\r\n                this._defaultStateNameCatch = null;\r\n            }\r\n\r\n            if (this._animator) {\r\n                (state._clip) && (state._clip!._addReference());\r\n                this._animator._getOwnersByClip(state);\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @param\tstate \r\n     * @param   layerIndex \r\n     */\r\n    removeState(state: AnimatorState): void {\r\n        var states: AnimatorState[] = this._states;\r\n        var index: number = -1;\r\n        for (var i: number = 0, n: number = states.length; i < n; i++) {\r\n            if (states[i] === state) {\r\n                index = i;\r\n                break;\r\n            }\r\n        }\r\n        if (index !== -1)\r\n            this._removeClip(states, index, state);\r\n    }\r\n\r\n    /**\r\n     * \r\n     */\r\n    destroy(): void {\r\n        this._clearReference();\r\n        this._states = [];\r\n        this._playStateInfo = null;\r\n        this._crossPlayStateInfo = null;\r\n        this._defaultState = null;\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @param\tdestObject \r\n     */\r\n    cloneTo(destObject: any): void {\r\n        var dest: AnimatorControllerLayer = (<AnimatorControllerLayer>destObject);\r\n        dest.name = this.name;\r\n        dest.blendingMode = this.blendingMode;\r\n        dest.defaultWeight = this.defaultWeight;\r\n        dest.playOnWake = this.playOnWake;\r\n        this.avatarMask && (dest.avatarMask = this._avatarMask.clone());\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @return\t \r\n     */\r\n    clone(): any {\r\n        var dest: AnimatorControllerLayer = new AnimatorControllerLayer(this.name);\r\n        this.cloneTo(dest);\r\n        return dest;\r\n    }\r\n\r\n}\r\n\r\n\r\n","import { Component } from \"../../../components/Component\";\r\nimport { ClassUtils } from \"../../../utils/ClassUtils\";\r\nimport { SimpleSkinnedMeshRenderer } from \"../../core/SimpleSkinnedMeshRenderer\";\r\nimport { Sprite3D } from \"../../core/Sprite3D\";\r\n\r\n\r\nexport class AnimatorResource {\r\n    static getAnimatorResource(sprite: Sprite3D, propertyKey: string): Component {\r\n        switch (propertyKey) {\r\n            case \"simpleSkinnedMeshRenderer\":\r\n                return sprite.getComponent(SimpleSkinnedMeshRenderer);\r\n            default:\r\n                return sprite.getComponent(ClassUtils.getClass(propertyKey));\r\n                break;\r\n        }\r\n        return null;\r\n    }\r\n}","import { EventDispatcher } from \"../../../events/EventDispatcher\";\r\nimport { Quaternion } from \"../../../maths/Quaternion\";\r\nimport { Vector2 } from \"../../../maths/Vector2\";\r\nimport { Vector3 } from \"../../../maths/Vector3\";\r\nimport { Vector4 } from \"../../../maths/Vector4\";\r\nimport { IClone } from \"../../../utils/IClone\";\r\nimport { AnimationClip } from \"../../animation/AnimationClip\";\r\nimport { AnimatorStateScript } from \"../../animation/AnimatorStateScript\";\r\nimport { KeyframeNodeList } from \"../../animation/KeyframeNodeList\";\r\nimport { Animator, AnimatorParams } from \"./Animator\";\r\nimport { AnimatorTransition } from \"./AnimatorTransition\";\r\nimport { KeyframeNodeOwner, KeyFrameValueType } from \"./KeyframeNodeOwner\";\r\n\r\n/**\r\n * <code>AnimatorState</code> \r\n */\r\nexport class AnimatorState extends EventDispatcher implements IClone {\r\n    /**\r\n     *  \r\n     */\r\n    static EVENT_OnStateEnter = \"OnStartEnter\";\r\n    /**\r\n     *  \r\n     */\r\n    static EVENT_OnStateUpdate = \"OnStateUpdate\";\r\n\r\n    /**\r\n    *  \r\n    */\r\n    static EVENT_OnStateLoop = 'OnStateLoop';\r\n    /**\r\n     *  \r\n     */\r\n    static EVENT_OnStateExit = \"OnStateExit\";\r\n\r\n    /** @internal */\r\n    private _referenceCount: number = 0;\r\n\r\n    /** @internal */\r\n    _clip: AnimationClip | null = null;\r\n\r\n    /** @internal */\r\n    _nodeOwners: KeyframeNodeOwner[] = [];//TODO:\r\n\r\n    /** @internal */\r\n    _currentFrameIndices: Int16Array | null = null;\r\n\r\n    /**,0_clip.islooping12 */\r\n    _isLooping: 0 | 1 | 2 = 0;\r\n\r\n    /**\r\n     * @internal\r\n     * to avoid data confused,must put realtime datas in animatorState,can't be in animationClip,\r\n     * for example use crossFade() with different animatorState but the sample clip source.\r\n     */\r\n    _realtimeDatas: Array<number | Vector3 | Quaternion> = [];\r\n\r\n    /** @internal */\r\n    _scripts: AnimatorStateScript[] | null = null;\r\n\r\n    /**@internal */\r\n    _transitions: AnimatorTransition[] = [];\r\n\r\n    /**@internal only play this transition */\r\n    _soloTransitions: AnimatorTransition[] = [];\r\n\r\n    curTransition: AnimatorTransition;\r\n\r\n    /***/\r\n    name: string;\r\n\r\n    /**,1.0*/\r\n    speed: number = 1.0;\r\n\r\n    /***/\r\n    clipStart: number = 0.0;\r\n\r\n    /***/\r\n    clipEnd: number = 1.0;\r\n    /**play on awake start offset*/\r\n    cycleOffset: number = 0;\r\n\r\n    /**\r\n     * \r\n     */\r\n    get clip(): AnimationClip | null {\r\n        return this._clip;\r\n    }\r\n\r\n    set clip(value: AnimationClip | null) {\r\n        if (this._clip !== value) {\r\n            if (this._clip)\r\n                (this._referenceCount > 0) && (this._clip._removeReference(this._referenceCount));\r\n            if (value) {\r\n                var realtimeDatas: Array<number | Vector3 | Quaternion | Vector2 | Vector4> = this._realtimeDatas;\r\n                var clipNodes: KeyframeNodeList = value._nodes!;\r\n                var count: number = clipNodes.count;\r\n                this._currentFrameIndices = new Int16Array(count);\r\n                this._resetFrameIndices();\r\n                (this._referenceCount > 0) && (value._addReference(this._referenceCount));\r\n                this._realtimeDatas.length = count;\r\n                for (var i: number = 0; i < count; i++) {\r\n                    switch (clipNodes.getNodeByIndex(i).type) {\r\n                        case KeyFrameValueType.Float:\r\n                            break;\r\n                        case KeyFrameValueType.Position:\r\n                        case KeyFrameValueType.Scale:\r\n                        case KeyFrameValueType.RotationEuler:\r\n                        case KeyFrameValueType.Vector3:\r\n                            realtimeDatas[i] = new Vector3();\r\n                            break;\r\n                        case KeyFrameValueType.Rotation:\r\n                            realtimeDatas[i] = new Quaternion();\r\n                            break;\r\n                        case KeyFrameValueType.Vector2:\r\n                            realtimeDatas[i] = new Vector2();\r\n                            break;\r\n                        case KeyFrameValueType.Vector4:\r\n                        case KeyFrameValueType.Color:\r\n                            realtimeDatas[i] = new Vector4();\r\n                            break;\r\n                        default:\r\n                            throw \"AnimationClipParser04:unknown type.\";\r\n                    }\r\n                }\r\n            }\r\n            this._clip = value;\r\n        }\r\n    }\r\n    get islooping() {\r\n        if (0 != this._isLooping) {\r\n            return 1 == this._isLooping;\r\n        }\r\n        return this._clip.islooping;\r\n    }\r\n\r\n    /**\r\n     * IDE\r\n     */\r\n    get transitions() {\r\n        return this._transitions;\r\n    }\r\n\r\n    set transitions(value: AnimatorTransition[]) {\r\n        this._transitions = value;\r\n    }\r\n\r\n    /**\r\n     * IDE\r\n     */\r\n    get soloTransitions() {\r\n        return this._soloTransitions;\r\n    }\r\n\r\n    set soloTransitions(value: AnimatorTransition[]) {\r\n        this._soloTransitions = value\r\n    }\r\n\r\n\r\n\r\n    /**\r\n     *  <code>AnimatorState</code> \r\n     */\r\n    constructor() {\r\n        super();\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    _eventStart(animator: Animator, layerIndex: number) {\r\n        this.event(AnimatorState.EVENT_OnStateEnter);\r\n\r\n        if (this._scripts) {\r\n            for (var i: number = 0, n: number = this._scripts.length; i < n; i++) {\r\n                this._scripts[i].setPlayScriptInfo(animator, layerIndex, this);\r\n                this._scripts[i].onStateEnter();\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    _eventExit() {\r\n        this.event(AnimatorState.EVENT_OnStateExit);\r\n        this.curTransition = null;\r\n        if (this._scripts) {\r\n            for (let i = 0, n = this._scripts.length; i < n; i++) {\r\n                this._scripts[i].onStateExit();\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    _eventStateUpdate(value: number) {\r\n        this.event(AnimatorState.EVENT_OnStateUpdate, value);\r\n        if (this._scripts) {\r\n            for (var i = 0, n = this._scripts.length; i < n; i++)\r\n                this._scripts[i].onStateUpdate(value);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    _eventLoop() {\r\n        this.event(AnimatorState.EVENT_OnStateLoop);\r\n        if (this._scripts) {\r\n            for (let i = 0, n = this._scripts.length; i < n; i++) {\r\n                if (this._scripts[i].onStateLoop)\r\n                    this._scripts[i].onStateLoop();\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @internal\r\n     * @param normalizeTime \r\n     * @param paramsMap \r\n     */\r\n    _eventtransition(normalizeTime: number, paramsMap: AnimatorParams): AnimatorTransition {\r\n        let soloNums = this._soloTransitions.length;\r\n        if (soloNums > 0) {\r\n            for (var i = 0; i < soloNums; i++) {\r\n                if (this._soloTransitions[i].check(normalizeTime, paramsMap))\r\n                    return this._soloTransitions[i];\r\n            }\r\n            return null;\r\n        }\r\n        let transNums = this._transitions.length;\r\n        for (var i = 0; i < transNums; i++) {\r\n            if (this._transitions[i].check(normalizeTime, paramsMap))\r\n                return this._transitions[i];\r\n        }\r\n        return null;\r\n    }\r\n\r\n\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    _getReferenceCount(): number {\r\n        return this._referenceCount;\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     * @param count \r\n     */\r\n    _addReference(count: number = 1): void {\r\n        (this._clip) && (this._clip._addReference(count));\r\n        this._referenceCount += count;\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     * @param count \r\n     */\r\n    _removeReference(count: number = 1): void {\r\n        (this._clip) && (this._clip._removeReference(count));\r\n        this._referenceCount -= count;\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    _clearReference(): void {\r\n        this._removeReference(-this._referenceCount);\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    _resetFrameIndices(): void {\r\n        for (var i: number = 0, n: number = this._currentFrameIndices!.length; i < n; i++)\r\n            this._currentFrameIndices![i] = -1;//-10,\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @param\ttype  \r\n     * @return \r\n     *\r\n     */\r\n    addScript(type: typeof AnimatorStateScript): AnimatorStateScript {\r\n        var script: AnimatorStateScript = new type();\r\n        this._scripts = this._scripts || [];\r\n        this._scripts.push(script);\r\n        return script;\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @param\ttype  \r\n     * @return \r\n     *\r\n     */\r\n    getScript(type: typeof AnimatorStateScript): AnimatorStateScript | null {\r\n        if (this._scripts) {\r\n            for (var i: number = 0, n: number = this._scripts.length; i < n; i++) {\r\n                var script: AnimatorStateScript = this._scripts[i];\r\n                if (script instanceof type)\r\n                    return script;\r\n            }\r\n        }\r\n        return null;\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @param\ttype  \r\n     * @return \r\n     */\r\n    getScripts(type: typeof AnimatorStateScript): AnimatorStateScript[] | null {\r\n        var coms: AnimatorStateScript[] | null = null;\r\n        if (this._scripts) {\r\n            for (var i: number = 0, n: number = this._scripts.length; i < n; i++) {\r\n                var script: AnimatorStateScript = this._scripts[i];\r\n                if (script instanceof type) {\r\n                    coms = coms || [];\r\n                    coms.push(script);\r\n                }\r\n            }\r\n        }\r\n        return coms;\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @param\tdestObject \r\n     */\r\n    cloneTo(destObject: any): void {\r\n        var dest: AnimatorState = <AnimatorState>destObject;\r\n        dest.name = this.name;\r\n        dest.speed = this.speed;\r\n        dest.clipStart = this.clipStart;\r\n        dest.clipEnd = this.clipEnd;\r\n        dest.clip = this._clip;\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @return\t \r\n     */\r\n    clone(): any {\r\n        var dest: AnimatorState = new AnimatorState();\r\n        this.cloneTo(dest);\r\n        return dest;\r\n    }\r\n\r\n}","/**\r\n * \r\n */\r\nexport class AvatarMask {\r\n    /**@internal */\r\n    private _avatarPathMap: Record<string, boolean>;\r\n\r\n    /**\r\n     * <code>AvatarMask</code>\r\n     */\r\n    constructor(data?: any) {\r\n        this._avatarPathMap = data?._avatarPathMap || {};\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @param path \r\n     * @returns \r\n     */\r\n    getTransformActive(path: string): boolean {\r\n        return this._avatarPathMap[path];\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @param path \r\n     * @param value \r\n     */\r\n    setTransformActive(path: string, value: boolean) {\r\n        this._avatarPathMap[path] = value;\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @returns \r\n     */\r\n    getAllTranfromPath() {\r\n        return this._avatarPathMap;\r\n    }\r\n\r\n    /**\r\n   * \r\n   * @return\t \r\n   */\r\n    clone(): any {\r\n        var dest: AvatarMask = new AvatarMask();\r\n        this.cloneTo(dest);\r\n        return dest;\r\n    }\r\n    /**\r\n     * \r\n     * @param\tdestObject \r\n     */\r\n    cloneTo(destObject: any): void {\r\n        var dest: AvatarMask = (<AvatarMask>destObject);\r\n        for (var key in this._avatarPathMap) {\r\n            dest.setTransformActive(key, this._avatarPathMap[key]);\r\n        }\r\n\r\n    }\r\n\r\n}","\r\nimport { Component } from \"../../../components/Component\";\r\nimport { NodeFlags } from \"../../../Const\";\r\nimport { Loader } from \"../../../net/Loader\";\r\nimport { Stat } from \"../../../utils/Stat\";\r\nimport { AnimationClip } from \"../../animation/AnimationClip\";\r\nimport { AnimatorStateScript } from \"../../animation/AnimatorStateScript\";\r\nimport { KeyframeNode } from \"../../animation/KeyframeNode\";\r\nimport { KeyframeNodeList } from \"../../animation/KeyframeNodeList\";\r\nimport { Material } from \"../../../resource/Material\";\r\nimport { RenderableSprite3D } from \"../../core/RenderableSprite3D\";\r\nimport { Sprite3D } from \"../../core/Sprite3D\";\r\nimport { Utils3D } from \"../../utils/Utils3D\";\r\nimport { AnimatorControllerLayer } from \"./AnimatorControllerLayer\";\r\nimport { AnimatorPlayState } from \"./AnimatorPlayState\";\r\nimport { AnimatorResource } from \"./AnimatorResource\";\r\nimport { AnimatorState } from \"./AnimatorState\";\r\nimport { AvatarMask } from \"./AvatarMask\";\r\nimport { KeyframeNodeOwner, KeyFrameValueType } from \"./KeyframeNodeOwner\";\r\nimport { AnimationEvent } from \"../../animation/AnimationEvent\";\r\nimport { AnimatorTransition } from \"./AnimatorTransition\";\r\nimport { AnimatorController } from \"./AnimatorController\";\r\nimport { Color } from \"../../../maths/Color\";\r\nimport { Quaternion } from \"../../../maths/Quaternion\";\r\nimport { Vector2 } from \"../../../maths/Vector2\";\r\nimport { Vector3 } from \"../../../maths/Vector3\";\r\nimport { Vector4 } from \"../../../maths/Vector4\";\r\nimport { AnimatorUpdateMode } from \"../../../components/AnimatorUpdateMode\";\r\nimport { AnimatorStateCondition } from \"../../../components/AnimatorStateCondition\";\r\n\r\nexport type AnimatorParams = { [key: number]: number | boolean };\r\n\r\n\r\n/**\r\n * <code>Animator</code> \r\n */\r\nexport class Animator extends Component {\r\n    /**@internal */\r\n    private static _tempVector31: Vector3 = new Vector3();\r\n    /**@internal */\r\n    private static _tempColor: Color = new Color();\r\n    /**@internal */\r\n    private static _tempQuaternion1: Quaternion = new Quaternion();\r\n\r\n    /** _*/\r\n    static CULLINGMODE_ALWAYSANIMATE: number = 0;\r\n    /** _*/\r\n    static CULLINGMODE_CULLCOMPLETELY: number = 2;\r\n\r\n    /**@internal */\r\n    private _speed: number;\r\n    /**@internal */\r\n    private _keyframeNodeOwnerMap: any;\r\n    /**@internal */\r\n    private _keyframeNodeOwners: KeyframeNodeOwner[] = [];\r\n    /**@internal */\r\n    private _updateMark: number;\r\n    /**@internal */\r\n    private _controllerLayers: AnimatorControllerLayer[];\r\n    /**@internal */\r\n    private _updateMode: AnimatorUpdateMode = AnimatorUpdateMode.Normal;\r\n    /**@internal */\r\n    private _lowUpdateDelty: number = 20;\r\n    /**@internal */\r\n    private _animatorParams: AnimatorParams = {};\r\n    // /**@internal */\r\n    // _linkSprites: any;\r\n    /**@internal\t*/\r\n    _avatarNodeMap: any;\r\n    /**@internal */\r\n    _linkAvatarSpritesData: any = {};\r\n    /**@internal */\r\n    _linkAvatarSprites: Sprite3D[] = [];\r\n    /**@internal */\r\n    _renderableSprites: RenderableSprite3D[] = [];\r\n\r\n    /**\t*/\r\n    cullingMode: number = Animator.CULLINGMODE_CULLCOMPLETELY;\r\n\r\n    /**@internal\t[NATIVE]*/\r\n    _animationNodeLocalPositions: Float32Array;\r\n    /**@internal\t[NATIVE]*/\r\n    _animationNodeLocalRotations: Float32Array;\r\n    /**@internal\t[NATIVE]*/\r\n    _animationNodeLocalScales: Float32Array;\r\n    /**@internal\t[NATIVE]*/\r\n    _animationNodeWorldMatrixs: Float32Array;\r\n    /**@internal\t[NATIVE]*/\r\n    _animationNodeParentIndices: Int16Array;\r\n    /**@internal */\r\n    private _finishSleep: boolean = false;\r\n\r\n    _controller: AnimatorController;\r\n\r\n\r\n    set controller(val: AnimatorController) {\r\n\r\n        this._controller = val;\r\n        if (this._controller) {\r\n            this._controller.updateTo(this);\r\n        }\r\n\r\n    }\r\n    get controller() {\r\n        return this._controller;\r\n    }\r\n\r\n\r\n\r\n    /**\r\n     * ,1.0\r\n     */\r\n    get speed(): number {\r\n        return this._speed;\r\n    }\r\n\r\n\r\n    set speed(value: number) {\r\n        this._speed = value;\r\n    }\r\n\r\n\r\n\r\n\r\n\r\n    /**\r\n     * \r\n     */\r\n    set updateMode(value: AnimatorUpdateMode) {\r\n        this._updateMode = value;\r\n    }\r\n\r\n    /**\r\n     * \r\n     */\r\n    set lowUpdateDelty(value: number) {\r\n        this._lowUpdateDelty = value;\r\n    }\r\n\r\n    get controllerLayerCount(): number {\r\n        return this._controllerLayers.length;\r\n    }\r\n\r\n    /**\r\n     * map\r\n     */\r\n    set animatorParams(values: AnimatorParams) {\r\n        this._animatorParams = values;\r\n    }\r\n\r\n    get animatorParams() {\r\n        return this._animatorParams;\r\n    }\r\n\r\n    /**\r\n     * \r\n     */\r\n    set sleep(value: boolean) {\r\n        this._finishSleep = value;\r\n    }\r\n\r\n    get sleep() {\r\n        return this._finishSleep;\r\n    }\r\n\r\n    /**\r\n     *  <code>Animation</code> \r\n     */\r\n    constructor() {\r\n        super();\r\n        this._controllerLayers = [];\r\n        //this._linkSprites = {};\r\n        this._speed = 1.0;\r\n        this._keyframeNodeOwnerMap = {};\r\n        this._updateMark = 0;\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    private _addKeyframeNodeOwner(clipOwners: KeyframeNodeOwner[], node: KeyframeNode, propertyOwner: any): void {\r\n        var nodeIndex = node._indexInList;\r\n        var fullPath = node.fullPath;\r\n        var keyframeNodeOwner = this._keyframeNodeOwnerMap[fullPath];\r\n        let mat = false;\r\n        if (keyframeNodeOwner) {\r\n            keyframeNodeOwner.referenceCount++;\r\n            clipOwners[nodeIndex] = keyframeNodeOwner;\r\n        } else {\r\n            var property = propertyOwner;\r\n            for (var i = 0, n = node.propertyCount; i < n; i++) {\r\n                property = property[node.getPropertyByIndex(i)];\r\n                if (property instanceof Material) {\r\n                    mat = true\r\n                }\r\n                if (!property)\r\n                    break;\r\n            }\r\n\r\n            keyframeNodeOwner = this._keyframeNodeOwnerMap[fullPath] = new KeyframeNodeOwner();\r\n            keyframeNodeOwner.isMaterial = mat;\r\n            keyframeNodeOwner.fullPath = fullPath;\r\n            keyframeNodeOwner.indexInList = this._keyframeNodeOwners.length;\r\n            keyframeNodeOwner.referenceCount = 1;\r\n            keyframeNodeOwner.propertyOwner = propertyOwner;\r\n            keyframeNodeOwner.nodePath = node.nodePath;\r\n            keyframeNodeOwner.callbackFunData = node.callbackFunData;\r\n            keyframeNodeOwner.callParams = node.callParams;\r\n            keyframeNodeOwner.getCallbackNode();\r\n            var propertyCount = node.propertyCount;\r\n            var propertys: string[] = [];\r\n            for (i = 0; i < propertyCount; i++)\r\n                propertys[i] = node.getPropertyByIndex(i);\r\n            keyframeNodeOwner.property = propertys;\r\n            keyframeNodeOwner.type = node.type;\r\n\r\n            if (property) {//\r\n                if (node.type === 0) {\r\n                    keyframeNodeOwner.defaultValue = property;\r\n                } else {\r\n                    var defaultValue = new property.constructor();\r\n                    property.cloneTo(defaultValue);\r\n                    keyframeNodeOwner.defaultValue = defaultValue;\r\n                    keyframeNodeOwner.value = new property.constructor();\r\n                    keyframeNodeOwner.crossFixedValue = new property.constructor();\r\n                }\r\n            }\r\n\r\n            this._keyframeNodeOwners.push(keyframeNodeOwner);\r\n            clipOwners[nodeIndex] = keyframeNodeOwner;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    _removeKeyframeNodeOwner(nodeOwners: (KeyframeNodeOwner | null)[], node: KeyframeNode): void {\r\n        var fullPath = node.fullPath;\r\n        var keyframeNodeOwner = this._keyframeNodeOwnerMap[fullPath];\r\n        if (keyframeNodeOwner) {//TODO:Avatar,,_keyframeNodeOwnerMap,BUG,SkinnedMeshRenderAvatar\r\n            keyframeNodeOwner.referenceCount--;\r\n            if (keyframeNodeOwner.referenceCount === 0) {\r\n                delete this._keyframeNodeOwnerMap[fullPath];\r\n                this._keyframeNodeOwners.splice(this._keyframeNodeOwners.indexOf(keyframeNodeOwner), 1);\r\n            }\r\n            nodeOwners[node._indexInList] = null;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    _getOwnersByClip(clipStateInfo: AnimatorState): void {\r\n        if (!clipStateInfo._clip)\r\n            return;\r\n\r\n        var frameNodes = clipStateInfo._clip!._nodes;\r\n        var frameNodesCount = frameNodes!.count;\r\n        var nodeOwners: KeyframeNodeOwner[] = clipStateInfo._nodeOwners;\r\n        nodeOwners.length = frameNodesCount;\r\n        for (var i: number = 0; i < frameNodesCount; i++) {\r\n            var node: KeyframeNode = frameNodes!.getNodeByIndex(i);\r\n            //var property: any = this._avatar ? this._avatarNodeMap[this._avatar._rootNode.name!] : this.owner;//avatar\r\n            var property: any = this.owner;\r\n            for (var j: number = 0, m: number = node.ownerPathCount; j < m; j++) {\r\n                var ownPat: string = node.getOwnerPathByIndex(j);\r\n                if (ownPat === \"\") {//TODO:\r\n                    break;\r\n                } else {\r\n                    property = property.getChildByName(ownPat);\r\n                    if (!property)\r\n                        break;\r\n                }\r\n            }\r\n\r\n            if (property) {\r\n                var propertyOwner: string = node.propertyOwner;\r\n                const oriProperty = property;\r\n                (propertyOwner) && (property = property[propertyOwner]);\r\n                if (!property) {\r\n                    property = AnimatorResource.getAnimatorResource(oriProperty, propertyOwner);\r\n                }\r\n                property && this._addKeyframeNodeOwner(nodeOwners, node, property);\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    private _updatePlayer(animatorState: AnimatorState, playState: AnimatorPlayState, elapsedTime: number, islooping: boolean, layerIndex: number): void {\r\n        var clipDuration: number = animatorState._clip!._duration * (animatorState.clipEnd - animatorState.clipStart);\r\n        var lastElapsedTime: number = playState._elapsedTime;\r\n        var elapsedPlaybackTime: number = lastElapsedTime + elapsedTime;\r\n        playState._lastElapsedTime = lastElapsedTime;\r\n        playState._elapsedTime = elapsedPlaybackTime;\r\n        var normalizedTime: number = elapsedPlaybackTime / clipDuration;//TODO:\r\n        playState._normalizedTime = normalizedTime;\r\n        var playTime: number = normalizedTime % 1.0;\r\n        playState._normalizedPlayTime = playTime < 0 ? playTime + 1.0 : playTime;\r\n        playState._duration = clipDuration;\r\n        if (elapsedPlaybackTime >= clipDuration) {\r\n            if (!islooping) {\r\n                playState._finish = true;\r\n                playState._elapsedTime = clipDuration;\r\n                playState._normalizedPlayTime = 1.0;\r\n            } else {\r\n                let loopNum = Math.floor(elapsedPlaybackTime / clipDuration);\r\n                let pLoopNum = Math.floor(lastElapsedTime / clipDuration);\r\n                if (pLoopNum != loopNum) {\r\n                    animatorState._eventLoop();\r\n                }\r\n            }\r\n        }\r\n\r\n        (!playState._finish) && animatorState._eventStateUpdate(playState._normalizedPlayTime);\r\n        this._applyTransition(animatorState, layerIndex, animatorState._eventtransition(playState._normalizedPlayTime, this.animatorParams));\r\n        return;\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @param layerindex \r\n     * @param transition \r\n     * @returns \r\n     */\r\n    private _applyTransition(state: AnimatorState, layerindex: number, transition: AnimatorTransition) {\r\n        if (!transition || transition == state.curTransition)\r\n            return;\r\n        state.curTransition = transition;\r\n        this.crossFade(transition.destState.name, transition.transduration, layerindex, transition.transstartoffset);\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     * @param animatorState \r\n     * @param playState \r\n     */\r\n    private _updateStateFinish(animatorState: AnimatorState, playState: AnimatorPlayState): void {\r\n        if (playState._finish) {\r\n            animatorState._eventExit();//\r\n        }\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    private _updateEventScript(stateInfo: AnimatorState, playStateInfo: AnimatorPlayState): void {\r\n        if (!this.owner._getBit(NodeFlags.HAS_SCRIPT))\r\n            return;\r\n\r\n        let clip = stateInfo._clip;\r\n        let events = clip!._animationEvents;\r\n        if (!events || 0 == events.length || null == playStateInfo.animatorState) return;\r\n        let clipDuration = clip!._duration;\r\n        let time = playStateInfo._normalizedPlayTime * clipDuration;\r\n        let parentPlayTime = playStateInfo._parentPlayTime;\r\n        if (null == parentPlayTime) {\r\n            parentPlayTime = clipDuration * playStateInfo.animatorState.clipStart;\r\n        }\r\n        if (time < parentPlayTime) {\r\n            this._eventScript(events, parentPlayTime, clipDuration * playStateInfo.animatorState.clipEnd);\r\n        }\r\n        this._eventScript(events, parentPlayTime, time);\r\n        playStateInfo._parentPlayTime = time;\r\n    }\r\n    /**\r\n    * @internal\r\n    */\r\n    private _eventScript(events: AnimationEvent[], parentPlayTime: number, currPlayTime: number) {\r\n        let scripts = this.owner.components;\r\n        for (let i = 0, len = events.length; i < len; i++) {\r\n            let e = events[i];\r\n            if (e.time > parentPlayTime && e.time <= currPlayTime) {\r\n                for (let j = 0, m = scripts.length; j < m; j++) {\r\n                    let script = scripts[j];\r\n                    if (script._isScript()) {\r\n                        let fun: Function = (script as any)[e.eventName];\r\n                        (fun) && (fun.apply(script, e.params));\r\n                    }\r\n                }\r\n            } else if (e.time > currPlayTime) {\r\n                break;\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * clip\r\n     * @internal\r\n     */\r\n    private _updateClipDatas(animatorState: AnimatorState, addtive: boolean, playStateInfo: AnimatorPlayState, animatorMask: AvatarMask = null): void {\r\n        var clip = animatorState._clip;\r\n        var clipDuration = clip!._duration;\r\n\r\n        var curPlayTime = animatorState.clipStart * clipDuration + playStateInfo._normalizedPlayTime * playStateInfo._duration;\r\n        var currentFrameIndices = animatorState._currentFrameIndices;\r\n        var frontPlay = playStateInfo._elapsedTime > playStateInfo._lastElapsedTime;\r\n        clip!._evaluateClipDatasRealTime(clip!._nodes!, curPlayTime, currentFrameIndices!, addtive, frontPlay, animatorState._realtimeDatas, animatorMask);\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    private _applyFloat(defaultValue: number, nodeOwner: KeyframeNodeOwner, additive: boolean, weight: number, isFirstLayer: boolean, data: number): number {\r\n        if (nodeOwner.updateMark === this._updateMark) {//\r\n            if (additive) {\r\n                defaultValue += weight * data;\r\n            } else {\r\n                var oriValue: number = defaultValue;\r\n                defaultValue = oriValue + weight * (data - oriValue);\r\n            }\r\n        } else {\r\n            if (isFirstLayer) {\r\n                if (additive)\r\n                    defaultValue = nodeOwner.defaultValue + data;\r\n                else\r\n                    defaultValue = data;\r\n            } else {\r\n                if (additive) {\r\n                    defaultValue = nodeOwner.defaultValue + weight * (data);\r\n                } else {\r\n                    var defValue: number = nodeOwner.defaultValue;\r\n                    defaultValue = defValue + weight * (data - defValue);\r\n                }\r\n            }\r\n        }\r\n        return defaultValue;\r\n    }\r\n\r\n    private _applyVec2(defaultValue: Vector2, nodeOwner: KeyframeNodeOwner, additive: boolean, weight: number, isFirstLayer: boolean, data: Vector2): Vector2 {\r\n        if (!defaultValue) return null;\r\n\r\n        if (nodeOwner.updateMark === this._updateMark) {//\r\n            if (additive) {\r\n                defaultValue.x += weight * data.x;\r\n                defaultValue.y += weight * data.y;\r\n            } else {\r\n                var oriValue = defaultValue;\r\n                defaultValue.x = oriValue.x + weight * (data.x - oriValue.x);\r\n                defaultValue.y = oriValue.y + weight * (data.y - oriValue.y);\r\n            }\r\n        } else {\r\n            if (isFirstLayer) {\r\n                if (additive) {\r\n                    defaultValue.x = nodeOwner.defaultValue.x + data.x;\r\n                    defaultValue.y = nodeOwner.defaultValue.y + data.y;\r\n                }\r\n                else\r\n                    data.cloneTo(defaultValue);\r\n            } else {\r\n                if (additive) {\r\n                    defaultValue.x = nodeOwner.defaultValue.x + weight * (data.x);\r\n                    defaultValue.y = nodeOwner.defaultValue.y + weight * (data.y);\r\n                } else {\r\n                    var defValue: Vector2 = nodeOwner.defaultValue;\r\n                    defaultValue.x = defValue.x + weight * (data.x - defValue.x);\r\n                    defaultValue.y = defValue.y + weight * (data.y - defValue.y);\r\n                }\r\n            }\r\n        }\r\n        return defaultValue;\r\n    }\r\n\r\n    private _applyVec3(defaultValue: Vector3, nodeOwner: KeyframeNodeOwner, additive: boolean, weight: number, isFirstLayer: boolean, data: Vector3) {\r\n        if (!defaultValue) return null;\r\n        if (nodeOwner.updateMark === this._updateMark) {//\r\n            if (additive) {\r\n                defaultValue.x += weight * data.x;\r\n                defaultValue.y += weight * data.y;\r\n                defaultValue.z += weight * data.z;\r\n            } else {\r\n                var oriValue = defaultValue;\r\n                defaultValue.x = oriValue.x + weight * (data.x - oriValue.x);\r\n                defaultValue.y = oriValue.y + weight * (data.y - oriValue.y);\r\n                defaultValue.z = oriValue.z + weight * (data.z - oriValue.z);\r\n            }\r\n        } else {\r\n            if (isFirstLayer) {\r\n                if (additive) {\r\n                    defaultValue.x = nodeOwner.defaultValue.x + data.x;\r\n                    defaultValue.y = nodeOwner.defaultValue.y + data.y;\r\n                    defaultValue.z = nodeOwner.defaultValue.z + data.z;\r\n                }\r\n                else\r\n                    data.cloneTo(defaultValue);\r\n            } else {\r\n                if (additive) {\r\n                    defaultValue.x = nodeOwner.defaultValue.x + weight * (data.x);\r\n                    defaultValue.y = nodeOwner.defaultValue.y + weight * (data.y);\r\n                    defaultValue.z = nodeOwner.defaultValue.z + weight * (data.z);\r\n                } else {\r\n                    var defValue: Vector3 = nodeOwner.defaultValue;\r\n                    defaultValue.x = defValue.x + weight * (data.x - defValue.x);\r\n                    defaultValue.y = defValue.y + weight * (data.y - defValue.y);\r\n                    defaultValue.z = defValue.z + weight * (data.z - defValue.z);\r\n                }\r\n            }\r\n        }\r\n        return defaultValue;\r\n    }\r\n\r\n    private _applyVec4(defaultValue: Vector4, nodeOwner: KeyframeNodeOwner, additive: boolean, weight: number, isFirstLayer: boolean, data: Vector4) {\r\n        if (!defaultValue) return null;\r\n        if (nodeOwner.updateMark === this._updateMark) {//\r\n            if (additive) {\r\n                defaultValue.x += weight * data.x;\r\n                defaultValue.y += weight * data.y;\r\n                defaultValue.z += weight * data.z;\r\n                defaultValue.w += weight * data.w;\r\n            } else {\r\n                var oriValue = defaultValue;\r\n                defaultValue.x = oriValue.x + weight * (data.x - oriValue.x);\r\n                defaultValue.y = oriValue.y + weight * (data.y - oriValue.y);\r\n                defaultValue.z = oriValue.z + weight * (data.z - oriValue.z);\r\n                defaultValue.w = oriValue.w + weight * (data.w - oriValue.w);\r\n            }\r\n        } else {\r\n            if (isFirstLayer) {\r\n                if (additive) {\r\n                    defaultValue.x = nodeOwner.defaultValue.x + data.x;\r\n                    defaultValue.y = nodeOwner.defaultValue.y + data.y;\r\n                    defaultValue.z = nodeOwner.defaultValue.z + data.z;\r\n                    defaultValue.w = nodeOwner.defaultValue.w + data.w;\r\n                }\r\n                else\r\n                    data.cloneTo(defaultValue);\r\n            } else {\r\n                if (additive) {\r\n                    defaultValue.x = nodeOwner.defaultValue.x + weight * (data.x);\r\n                    defaultValue.y = nodeOwner.defaultValue.y + weight * (data.y);\r\n                    defaultValue.z = nodeOwner.defaultValue.z + weight * (data.z);\r\n                    defaultValue.w = nodeOwner.defaultValue.w + weight * (data.w);\r\n                } else {\r\n                    var defValue: Vector4 = nodeOwner.defaultValue;\r\n                    defaultValue.x = defValue.x + weight * (data.x - defValue.x);\r\n                    defaultValue.y = defValue.y + weight * (data.y - defValue.y);\r\n                    defaultValue.z = defValue.z + weight * (data.z - defValue.z);\r\n                    defaultValue.w = defValue.w + weight * (data.w - defValue.w);\r\n                }\r\n            }\r\n        }\r\n        return defaultValue;\r\n    }\r\n\r\n    private _applyColor(defaultValue: Color, nodeOwner: KeyframeNodeOwner, additive: boolean, weight: number, isFirstLayer: boolean, data: Vector4) {\r\n        if (!defaultValue) return null;\r\n        if (nodeOwner.updateMark === this._updateMark) {//\r\n            if (additive) {\r\n                defaultValue.r += weight * data.x;\r\n                defaultValue.g += weight * data.y;\r\n                defaultValue.b += weight * data.z;\r\n                defaultValue.a += weight * data.w;\r\n            } else {\r\n                var oriValue = defaultValue;\r\n                defaultValue.r = oriValue.r + weight * (data.x - oriValue.r);\r\n                defaultValue.g = oriValue.g + weight * (data.y - oriValue.g);\r\n                defaultValue.b = oriValue.b + weight * (data.z - oriValue.b);\r\n                defaultValue.a = oriValue.a + weight * (data.w - oriValue.a);\r\n            }\r\n        } else {\r\n            if (isFirstLayer) {\r\n                if (additive) {\r\n                    defaultValue.r = nodeOwner.defaultValue.r + data.x;\r\n                    defaultValue.g = nodeOwner.defaultValue.g + data.y;\r\n                    defaultValue.b = nodeOwner.defaultValue.b + data.z;\r\n                    defaultValue.a = nodeOwner.defaultValue.a + data.w;\r\n                }\r\n                else {\r\n                    //data.cloneTo(defaultValue);\r\n                    defaultValue.setValue(data.x, data.y, data.z, data.w);\r\n                }\r\n\r\n            } else {\r\n                if (additive) {\r\n                    defaultValue.r = nodeOwner.defaultValue.r + weight * (data.x);\r\n                    defaultValue.g = nodeOwner.defaultValue.g + weight * (data.y);\r\n                    defaultValue.b = nodeOwner.defaultValue.b + weight * (data.z);\r\n                    defaultValue.a = nodeOwner.defaultValue.a + weight * (data.w);\r\n                } else {\r\n                    var defValue: Color = nodeOwner.defaultValue;\r\n                    defaultValue.r = defValue.r + weight * (data.x - defValue.r);\r\n                    defaultValue.g = defValue.g + weight * (data.y - defValue.g);\r\n                    defaultValue.b = defValue.b + weight * (data.z - defValue.b);\r\n                    defaultValue.a = defValue.a + weight * (data.w - defValue.a);\r\n                }\r\n            }\r\n        }\r\n        return defaultValue;\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    private _applyPositionAndRotationEuler(nodeOwner: KeyframeNodeOwner, additive: boolean, weight: number, isFirstLayer: boolean, data: Vector3, out: Vector3): void {\r\n        if (nodeOwner.updateMark === this._updateMark) {//\r\n            if (additive) {\r\n                out.x += weight * data.x;\r\n                out.y += weight * data.y;\r\n                out.z += weight * data.z;\r\n            } else {\r\n                var oriX: number = out.x;\r\n                var oriY: number = out.y;\r\n                var oriZ: number = out.z;\r\n                out.x = oriX + weight * (data.x - oriX);\r\n                out.y = oriY + weight * (data.y - oriY);\r\n                out.z = oriZ + weight * (data.z - oriZ);\r\n            }\r\n        } else {\r\n            if (isFirstLayer) {\r\n                if (additive) {\r\n                    var defValue: Vector3 = nodeOwner.defaultValue;\r\n                    out.x = defValue.x + data.x;\r\n                    out.y = defValue.y + data.y;\r\n                    out.z = defValue.z + data.z;\r\n                } else {\r\n                    out.x = data.x;\r\n                    out.y = data.y;\r\n                    out.z = data.z;\r\n                }\r\n            } else {\r\n                defValue = nodeOwner.defaultValue;\r\n                if (additive) {\r\n                    out.x = defValue.x + weight * data.x;\r\n                    out.y = defValue.y + weight * data.y;\r\n                    out.z = defValue.z + weight * data.z;\r\n                } else {\r\n                    var defX: number = defValue.x;\r\n                    var defY: number = defValue.y;\r\n                    var defZ: number = defValue.z;\r\n                    out.x = defX + weight * (data.x - defX);\r\n                    out.y = defY + weight * (data.y - defY);\r\n                    out.z = defZ + weight * (data.z - defZ);\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    private _applyRotation(nodeOwner: KeyframeNodeOwner, additive: boolean, weight: number, isFirstLayer: boolean, clipRot: Quaternion, localRotation: Quaternion): void {\r\n        if (nodeOwner.updateMark === this._updateMark) {//\r\n            if (additive) {\r\n                var tempQuat: Quaternion = Animator._tempQuaternion1;//_tempQuaternion1\r\n                Utils3D.quaternionWeight(clipRot, weight, tempQuat);\r\n                tempQuat.normalize(tempQuat);\r\n                Quaternion.multiply(localRotation, tempQuat, localRotation);\r\n            } else {\r\n                Quaternion.lerp(localRotation, clipRot, weight, localRotation);\r\n            }\r\n        } else {\r\n            if (isFirstLayer) {\r\n                if (additive) {\r\n                    var defaultRot: Quaternion = nodeOwner.defaultValue;\r\n                    Quaternion.multiply(defaultRot, clipRot, localRotation);\r\n                } else {\r\n                    localRotation.x = clipRot.x;\r\n                    localRotation.y = clipRot.y;\r\n                    localRotation.z = clipRot.z;\r\n                    localRotation.w = clipRot.w;\r\n                }\r\n            } else {\r\n                defaultRot = nodeOwner.defaultValue;\r\n                if (additive) {\r\n                    tempQuat = Animator._tempQuaternion1;\r\n                    Utils3D.quaternionWeight(clipRot, weight, tempQuat);\r\n                    tempQuat.normalize(tempQuat);\r\n                    Quaternion.multiply(defaultRot, tempQuat, localRotation);\r\n                } else {\r\n                    Quaternion.lerp(defaultRot, clipRot, weight, localRotation);\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    private _applyScale(nodeOwner: KeyframeNodeOwner, additive: boolean, weight: number, isFirstLayer: boolean, clipSca: Vector3, localScale: Vector3): void {\r\n        if (nodeOwner.updateMark === this._updateMark) {//\r\n            if (additive) {\r\n                var scale: Vector3 = Animator._tempVector31;\r\n                Utils3D.scaleWeight(clipSca, weight, scale);\r\n                localScale.x = localScale.x * scale.x;\r\n                localScale.y = localScale.y * scale.y;\r\n                localScale.z = localScale.z * scale.z;\r\n            } else {\r\n                Utils3D.scaleBlend(localScale, clipSca, weight, localScale);\r\n            }\r\n        } else {\r\n            if (isFirstLayer) {\r\n                if (additive) {\r\n                    var defaultSca: Vector3 = nodeOwner.defaultValue;\r\n                    localScale.x = defaultSca.x * clipSca.x;\r\n                    localScale.y = defaultSca.y * clipSca.y;\r\n                    localScale.z = defaultSca.z * clipSca.z;\r\n                } else {\r\n                    localScale.x = clipSca.x;\r\n                    localScale.y = clipSca.y;\r\n                    localScale.z = clipSca.z;\r\n                }\r\n            } else {\r\n                defaultSca = nodeOwner.defaultValue;\r\n                if (additive) {\r\n                    scale = Animator._tempVector31;\r\n                    Utils3D.scaleWeight(clipSca, weight, scale);\r\n                    localScale.x = defaultSca.x * scale.x;\r\n                    localScale.y = defaultSca.y * scale.y;\r\n                    localScale.z = defaultSca.z * scale.z;\r\n                } else {\r\n                    Utils3D.scaleBlend(defaultSca, clipSca, weight, localScale);\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    private _applyCrossData(nodeOwner: KeyframeNodeOwner, additive: boolean, weight: number, isFirstLayer: boolean, srcValue: any, desValue: any, crossWeight: number): void {\r\n        var pro: any = nodeOwner.propertyOwner;\r\n        let lastpro;\r\n        if (pro) {\r\n            switch (nodeOwner.type) {\r\n                case KeyFrameValueType.Float: //Float\r\n                    var proPat: string[] = nodeOwner.property!;\r\n                    var m: number = proPat.length - 1;\r\n                    for (var j: number = 0; j < m; j++) {\r\n                        pro = pro[proPat[j]];\r\n                        if (!pro)//\r\n                            break;\r\n                    }\r\n\r\n                    var crossValue: number = srcValue + crossWeight * (desValue - srcValue);\r\n                    nodeOwner.value = crossValue;\r\n                    lastpro = proPat[m];\r\n                    if (!nodeOwner.isMaterial) {\r\n                        pro && (pro[lastpro] = this._applyFloat(pro[lastpro], nodeOwner, additive, weight, isFirstLayer, crossValue));\r\n                    } else {\r\n                        pro && (pro as Material).setFloat(lastpro, this._applyFloat((pro as Material).getFloat(lastpro), nodeOwner, additive, weight, isFirstLayer, crossValue));\r\n                    }\r\n                    if (nodeOwner.callbackFun) {\r\n                        nodeOwner.animatorDataSetCallBack();\r\n                    }\r\n                    break;\r\n                case KeyFrameValueType.Position: //Position\r\n                    var localPos: Vector3 = pro.localPosition;\r\n                    var position: Vector3 = nodeOwner.value;\r\n                    var srcX: number = srcValue.x, srcY: number = srcValue.y, srcZ: number = srcValue.z;\r\n                    position.x = srcX + crossWeight * (desValue.x - srcX);\r\n                    position.y = srcY + crossWeight * (desValue.y - srcY);\r\n                    position.z = srcZ + crossWeight * (desValue.z - srcZ);\r\n                    this._applyPositionAndRotationEuler(nodeOwner, additive, weight, isFirstLayer, position, localPos);\r\n                    pro.localPosition = localPos;\r\n                    break;\r\n                case KeyFrameValueType.Rotation: //Rotation\r\n                    var localRot: Quaternion = pro.localRotation;\r\n                    var rotation: Quaternion = nodeOwner.value;\r\n                    Quaternion.lerp(srcValue, desValue, crossWeight, rotation);\r\n                    this._applyRotation(nodeOwner, additive, weight, isFirstLayer, rotation, localRot);\r\n                    pro.localRotation = localRot;\r\n                    break;\r\n                case KeyFrameValueType.Scale: //Scale\r\n                    var localSca: Vector3 = pro.localScale;\r\n                    var scale: Vector3 = nodeOwner.value;\r\n                    Utils3D.scaleBlend(srcValue, desValue, crossWeight, scale);\r\n                    this._applyScale(nodeOwner, additive, weight, isFirstLayer, scale, localSca);\r\n                    pro.localScale = localSca;\r\n                    break;\r\n                case KeyFrameValueType.RotationEuler: //RotationEuler\r\n                    var localEuler: Vector3 = pro.localRotationEuler;\r\n                    var rotationEuler: Vector3 = nodeOwner.value;\r\n                    srcX = srcValue.x, srcY = srcValue.y, srcZ = srcValue.z;\r\n                    rotationEuler.x = srcX + crossWeight * (desValue.x - srcX);\r\n                    rotationEuler.y = srcY + crossWeight * (desValue.y - srcY);\r\n                    rotationEuler.z = srcZ + crossWeight * (desValue.z - srcZ);\r\n                    this._applyPositionAndRotationEuler(nodeOwner, additive, weight, isFirstLayer, rotationEuler, localEuler);\r\n                    pro.localRotationEuler = localEuler;\r\n                    break;\r\n                case KeyFrameValueType.Color:\r\n                    var proPat: string[] = nodeOwner.property!;\r\n                    var m: number = proPat.length - 1;\r\n                    for (var j: number = 0; j < m; j++) {\r\n                        pro = pro[proPat[j]];\r\n                        if (!pro)//\r\n                            break;\r\n                    }\r\n                    let v44 = nodeOwner.value as Vector4;\r\n                    v44.x = srcValue.r + crossWeight * (desValue.r - srcValue.r);\r\n                    v44.y = srcValue.g + crossWeight * (desValue.g - srcValue.g);\r\n                    v44.z = srcValue.b + crossWeight * (desValue.b - srcValue.b);\r\n                    v44.w = srcValue.a + crossWeight * (desValue.a - srcValue.a);\r\n\r\n                    nodeOwner.value = v44;\r\n                    lastpro = proPat[m];\r\n                    if (!nodeOwner.isMaterial) {\r\n                        pro && (pro[lastpro] = this._applyColor(pro[lastpro], nodeOwner, additive, weight, isFirstLayer, v44));\r\n                    } else {\r\n                        pro && (pro as Material).setColor(lastpro, this._applyColor((pro as Material).getColor(lastpro), nodeOwner, additive, weight, isFirstLayer, v44));\r\n                    }\r\n                    if (nodeOwner.callbackFun) {\r\n                        nodeOwner.animatorDataSetCallBack();\r\n                    }\r\n                    break;\r\n                case KeyFrameValueType.Vector2:\r\n                    var proPat: string[] = nodeOwner.property!;\r\n                    var m: number = proPat.length - 1;\r\n                    for (var j: number = 0; j < m; j++) {\r\n                        pro = pro[proPat[j]];\r\n                        if (!pro)//\r\n                            break;\r\n                    }\r\n                    let v2 = nodeOwner.value as Vector2;\r\n                    v2.x = srcValue.r + crossWeight * (desValue.r - srcValue.r);\r\n                    v2.y = srcValue.g + crossWeight * (desValue.g - srcValue.g);\r\n                    nodeOwner.value = v2;\r\n                    lastpro = proPat[m];\r\n                    if (!nodeOwner.isMaterial) {\r\n                        pro && (pro[lastpro] = this._applyVec2(pro[lastpro], nodeOwner, additive, weight, isFirstLayer, v2));\r\n                    } else {\r\n                        pro && (pro as Material).setVector2(lastpro, this._applyVec2((pro as Material).getVector2(lastpro), nodeOwner, additive, weight, isFirstLayer, v2));\r\n                    }\r\n                    if (nodeOwner.callbackFun) {\r\n                        nodeOwner.animatorDataSetCallBack();\r\n                    }\r\n                    break;\r\n                case KeyFrameValueType.Vector4:\r\n                    var proPat: string[] = nodeOwner.property!;\r\n                    var m: number = proPat.length - 1;\r\n                    for (var j: number = 0; j < m; j++) {\r\n                        pro = pro[proPat[j]];\r\n                        if (!pro)//\r\n                            break;\r\n                    }\r\n                    let v4 = nodeOwner.value as Vector4;\r\n                    v4.x = srcValue.x + crossWeight * (desValue.x - srcValue.x);\r\n                    v4.y = srcValue.y + crossWeight * (desValue.y - srcValue.y);\r\n                    v4.z = srcValue.z + crossWeight * (desValue.z - srcValue.z);\r\n                    nodeOwner.value = v4;\r\n                    lastpro = proPat[m];\r\n                    if (!nodeOwner.isMaterial) {\r\n                        pro && (pro[lastpro] = this._applyVec4(pro[lastpro], nodeOwner, additive, weight, isFirstLayer, v4));\r\n                    } else {\r\n                        pro && (pro as Material).setVector4(lastpro, this._applyVec4((pro as Material).getVector4(lastpro), nodeOwner, additive, weight, isFirstLayer, v4));\r\n                    }\r\n                    if (nodeOwner.callbackFun) {\r\n                        nodeOwner.animatorDataSetCallBack();\r\n                    }\r\n                    break;\r\n                case KeyFrameValueType.Vector3:\r\n                    var proPat: string[] = nodeOwner.property!;\r\n                    var m: number = proPat.length - 1;\r\n                    for (var j: number = 0; j < m; j++) {\r\n                        pro = pro[proPat[j]];\r\n                        if (!pro)//\r\n                            break;\r\n                    }\r\n                    let v3 = nodeOwner.value as Vector3;\r\n                    v3.x = srcValue.x + crossWeight * (desValue.x - srcValue.x);\r\n                    v3.y = srcValue.y + crossWeight * (desValue.y - srcValue.y);\r\n                    v3.z = srcValue.z + crossWeight * (desValue.z - srcValue.z);\r\n                    nodeOwner.value = v3;\r\n                    lastpro = proPat[m];\r\n                    if (!nodeOwner.isMaterial) {\r\n                        pro && (pro[lastpro] = this._applyVec3(pro[lastpro], nodeOwner, additive, weight, isFirstLayer, v3));\r\n                    } else {\r\n                        pro && (pro as Material).setVector3(lastpro, this._applyVec3((pro as Material).getVector3(lastpro), nodeOwner, additive, weight, isFirstLayer, v3));\r\n                    }\r\n                    if (nodeOwner.callbackFun) {\r\n                        nodeOwner.animatorDataSetCallBack();\r\n                    }\r\n                    break;\r\n            }\r\n            nodeOwner.updateMark = this._updateMark;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Node\r\n     * @param stateInfo \r\n     * @param additive addtive\r\n     * @param weight state\r\n     * @param isFirstLayer \r\n     */\r\n    private _setClipDatasToNode(stateInfo: AnimatorState, additive: boolean, weight: number, isFirstLayer: boolean, controllerLayer: AnimatorControllerLayer = null): void {\r\n        var realtimeDatas: Array<number | Vector3 | Quaternion | Vector2 | Vector4 | Color> = stateInfo._realtimeDatas;\r\n        var nodes: KeyframeNodeList = stateInfo._clip!._nodes!;\r\n        var nodeOwners: KeyframeNodeOwner[] = stateInfo._nodeOwners;\r\n        for (var i: number = 0, n: number = nodes.count; i < n; i++) {\r\n            var nodeOwner: KeyframeNodeOwner = nodeOwners[i];\r\n            if (nodeOwner) {//\r\n                var node = nodes.getNodeByIndex(i);\r\n                if (controllerLayer.avatarMask && (!controllerLayer.avatarMask.getTransformActive(node.nodePath))) {\r\n                    continue;\r\n                }\r\n                var pro: any = nodeOwner.propertyOwner;\r\n                let value: string;\r\n                if (pro) {\r\n                    switch (nodeOwner.type) {\r\n                        case KeyFrameValueType.Float: //Float\r\n                            var proPat: string[] = nodeOwner.property!;\r\n                            var m: number = proPat.length - 1;\r\n                            for (var j: number = 0; j < m; j++) {\r\n                                pro = pro[proPat[j]];\r\n                                if (!pro)//\r\n                                    break;\r\n                            }\r\n                            //pro && this._applyFloat(pro, proPat[m], nodeOwner, additive, weight, isFirstLayer, <number>realtimeDatas[i]);\r\n                            let lastpro = proPat[m];\r\n                            if (!nodeOwner.isMaterial) {\r\n                                pro && (pro[lastpro] = this._applyFloat(pro[lastpro], nodeOwner, additive, weight, isFirstLayer, <number>realtimeDatas[i]));\r\n                                if (nodeOwner.callbackFun) {\r\n                                    nodeOwner.animatorDataSetCallBack();\r\n                                }\r\n                            } else {\r\n                                pro && (pro as Material).setFloat(lastpro, this._applyFloat(0, nodeOwner, additive, weight, isFirstLayer, <number>realtimeDatas[i]));\r\n                            }\r\n                            break;\r\n                        case KeyFrameValueType.Position: //Position\r\n                            var localPos: Vector3 = pro.localPosition;\r\n                            this._applyPositionAndRotationEuler(nodeOwner, additive, weight, isFirstLayer, <Vector3>realtimeDatas[i], localPos);\r\n                            pro.localPosition = localPos;\r\n                            break;\r\n                        case KeyFrameValueType.Rotation: //Rotation\r\n                            var localRot: Quaternion = pro.localRotation;\r\n                            this._applyRotation(nodeOwner, additive, weight, isFirstLayer, <Quaternion>realtimeDatas[i], localRot);\r\n                            pro.localRotation = localRot;\r\n                            break;\r\n                        case KeyFrameValueType.Scale: //Scale\r\n                            var localSca: Vector3 = pro.localScale;\r\n                            this._applyScale(nodeOwner, additive, weight, isFirstLayer, <Vector3>realtimeDatas[i], localSca);\r\n                            pro.localScale = localSca;\r\n                            break;\r\n                        case KeyFrameValueType.RotationEuler: //RotationEuler\r\n                            var localEuler: Vector3 = pro.localRotationEuler;\r\n                            this._applyPositionAndRotationEuler(nodeOwner, additive, weight, isFirstLayer, <Vector3>realtimeDatas[i], localEuler);\r\n                            pro.localRotationEuler = localEuler;\r\n                            break;\r\n                        case KeyFrameValueType.Vector2://vec2\r\n                            var proPat: string[] = nodeOwner.property!;\r\n                            var m: number = proPat.length - 1;\r\n                            for (var j: number = 0; j < m; j++) {\r\n                                pro = pro[proPat[j]];\r\n                                if (!pro)//\r\n                                    break;\r\n                            }\r\n                            value = proPat[m];\r\n                            if (!nodeOwner.isMaterial) {\r\n                                pro && (pro[value] = this._applyVec2(pro[value], nodeOwner, additive, weight, isFirstLayer, <Vector2>realtimeDatas[i]));\r\n                                if (nodeOwner.callbackFun) {\r\n                                    nodeOwner.animatorDataSetCallBack();\r\n                                }\r\n                            } else {\r\n                                pro && pro.getVector2(value) && (pro as Material).setVector2(value, this._applyVec2(pro.getVector2(value), nodeOwner, additive, weight, isFirstLayer, <Vector2>realtimeDatas[i]));\r\n                            }\r\n                            break;\r\n                        case KeyFrameValueType.Vector3://vec3\r\n                            var proPat: string[] = nodeOwner.property!;\r\n                            var m: number = proPat.length - 1;\r\n                            for (var j: number = 0; j < m; j++) {\r\n                                pro = pro[proPat[j]];\r\n                                if (!pro)//\r\n                                    break;\r\n                            }\r\n                            value = proPat[m];\r\n                            if (!nodeOwner.isMaterial) {\r\n                                pro && (pro[value] = this._applyVec3(pro[value], nodeOwner, additive, weight, isFirstLayer, <Vector3>realtimeDatas[i]));\r\n                                if (nodeOwner.callbackFun) {\r\n                                    nodeOwner.animatorDataSetCallBack();\r\n                                }\r\n                            } else {\r\n                                pro && pro.getVector3(value) && (pro as Material).setVector3(value, this._applyVec3(pro.getVector3(value), nodeOwner, additive, weight, isFirstLayer, <Vector3>realtimeDatas[i]));\r\n                            }\r\n                            break;\r\n                        case KeyFrameValueType.Vector4://vec4\r\n                            var proPat: string[] = nodeOwner.property!;\r\n                            var m: number = proPat.length - 1;\r\n                            for (var j: number = 0; j < m; j++) {\r\n                                pro = pro[proPat[j]];\r\n                                if (!pro)//\r\n                                    break;\r\n                            }\r\n                            value = proPat[m];\r\n                            if (!nodeOwner.isMaterial) {\r\n                                pro && (pro[value] = this._applyVec4(pro[value], nodeOwner, additive, weight, isFirstLayer, <Vector4>realtimeDatas[i]));\r\n                                if (nodeOwner.callbackFun) {\r\n                                    nodeOwner.animatorDataSetCallBack();\r\n                                }\r\n                            } else {\r\n                                pro && pro.getVector4(value) && (pro as Material).setVector4(value, this._applyVec4(pro.getVector4(value), nodeOwner, additive, weight, isFirstLayer, <Vector4>realtimeDatas[i]));\r\n                            }\r\n                            break;\r\n                        case KeyFrameValueType.Color://Color\r\n                            var proPat: string[] = nodeOwner.property!;\r\n                            var m: number = proPat.length - 1;\r\n                            for (var j: number = 0; j < m; j++) {\r\n                                pro = pro[proPat[j]];\r\n                                if (!pro)//\r\n                                    break;\r\n                            }\r\n                            value = proPat[m];\r\n                            if (!nodeOwner.isMaterial) {\r\n                                pro && (pro[value] = this._applyColor(pro[value], nodeOwner, additive, weight, isFirstLayer, <Vector4>realtimeDatas[i]));\r\n                                if (nodeOwner.callbackFun) {\r\n                                    nodeOwner.animatorDataSetCallBack();\r\n                                }\r\n                            } else {\r\n                                pro && pro.getColor(value) && (pro as Material).setColor(value, this._applyColor(pro.getColor(value), nodeOwner, additive, weight, isFirstLayer, <Vector4>realtimeDatas[i]));\r\n                            }\r\n                            break;\r\n                    }\r\n                    nodeOwner.updateMark = this._updateMark;\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    private _setCrossClipDatasToNode(controllerLayer: AnimatorControllerLayer, srcState: AnimatorState, destState: AnimatorState, crossWeight: number, isFirstLayer: boolean): void {\r\n        var nodeOwners: KeyframeNodeOwner[] = controllerLayer._crossNodesOwners;\r\n        var ownerCount: number = controllerLayer._crossNodesOwnersCount;\r\n        var additive: boolean = controllerLayer.blendingMode !== AnimatorControllerLayer.BLENDINGMODE_OVERRIDE;\r\n        var weight: number = controllerLayer.defaultWeight;\r\n\r\n        var destRealtimeDatas: Array<number | Vector3 | Quaternion> = destState._realtimeDatas;\r\n        var destDataIndices: number[] = controllerLayer._destCrossClipNodeIndices;\r\n        var destNodeOwners: KeyframeNodeOwner[] = destState._nodeOwners;\r\n        var srcRealtimeDatas: Array<number | Vector3 | Quaternion> = srcState._realtimeDatas;\r\n        var srcDataIndices: number[] = controllerLayer._srcCrossClipNodeIndices;\r\n        var srcNodeOwners: KeyframeNodeOwner[] = srcState._nodeOwners;\r\n\r\n        for (var i: number = 0; i < ownerCount; i++) {\r\n            var nodeOwner: KeyframeNodeOwner = nodeOwners[i];\r\n            if (nodeOwner) {\r\n                var srcIndex: number = srcDataIndices[i];\r\n                var destIndex: number = destDataIndices[i];\r\n                if (-1 == srcIndex && -1 == destIndex) continue;\r\n                var srcValue: any = srcIndex !== -1 ? srcRealtimeDatas[srcIndex] : destNodeOwners[destIndex].defaultValue;\r\n                if (null == srcValue) continue;\r\n                var desValue: any = destIndex !== -1 ? destRealtimeDatas[destIndex] : srcNodeOwners[srcIndex].defaultValue;\r\n                if (!desValue) {\r\n                    desValue = srcNodeOwners[srcIndex].defaultValue;\r\n                }\r\n                if (null == desValue) continue;\r\n                if (!controllerLayer.avatarMask || controllerLayer.avatarMask.getTransformActive(nodeOwner.nodePath)) {\r\n                    this._applyCrossData(nodeOwner, additive, weight, isFirstLayer, srcValue, desValue, crossWeight);\r\n                }\r\n            }\r\n        }\r\n\r\n    }\r\n\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    private _setFixedCrossClipDatasToNode(controllerLayer: AnimatorControllerLayer, destState: AnimatorState, crossWeight: number, isFirstLayer: boolean): void {\r\n        var nodeOwners: KeyframeNodeOwner[] = controllerLayer._crossNodesOwners;\r\n        var ownerCount: number = controllerLayer._crossNodesOwnersCount;\r\n        var additive: boolean = controllerLayer.blendingMode !== AnimatorControllerLayer.BLENDINGMODE_OVERRIDE;\r\n        var weight: number = controllerLayer.defaultWeight;\r\n        var destRealtimeDatas: Array<number | Vector3 | Quaternion> = destState._realtimeDatas;\r\n        var destDataIndices: number[] = controllerLayer._destCrossClipNodeIndices;\r\n\r\n        for (var i: number = 0; i < ownerCount; i++) {\r\n            var nodeOwner: KeyframeNodeOwner = nodeOwners[i];\r\n            if (nodeOwner) {\r\n                var destIndex: number = destDataIndices[i];\r\n                var srcValue: any = nodeOwner.crossFixedValue;\r\n                var desValue;\r\n                if (destIndex == -1 || !destRealtimeDatas[destIndex]) {\r\n                    desValue = nodeOwner.defaultValue;\r\n                } else {\r\n                    desValue = destRealtimeDatas[destIndex];\r\n                }\r\n                this._applyCrossData(nodeOwner, additive, weight, isFirstLayer, srcValue, desValue, crossWeight);\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    private _revertDefaultKeyframeNodes(clipStateInfo: AnimatorState): void {\r\n        var nodeOwners: KeyframeNodeOwner[] = clipStateInfo._nodeOwners;\r\n        for (var i: number = 0, n: number = nodeOwners.length; i < n; i++) {\r\n            var nodeOwner: KeyframeNodeOwner = nodeOwners[i];\r\n            if (nodeOwner) {\r\n                var pro: any = nodeOwner.propertyOwner;\r\n                let value: string;\r\n                if (pro) {\r\n                    switch (nodeOwner.type) {\r\n                        case KeyFrameValueType.Float:\r\n                            var proPat: string[] = nodeOwner.property!;\r\n                            var m: number = proPat.length - 1;\r\n                            for (var j: number = 0; j < m; j++) {\r\n                                pro = pro[proPat[j]];\r\n                                if (!pro)//\r\n                                    break;\r\n                            }\r\n                            //pro && this._applyFloat(pro, proPat[m], nodeOwner, additive, weight, isFirstLayer, <number>realtimeDatas[i]);\r\n                            let lastpro = proPat[m];\r\n                            if (!nodeOwner.isMaterial) {\r\n                                pro && (pro[lastpro] = nodeOwner.defaultValue);\r\n                                if (nodeOwner.callbackFun) {\r\n                                    nodeOwner.animatorDataSetCallBack();\r\n                                }\r\n                            } else {\r\n                                pro && (pro as Material).setFloat(lastpro, nodeOwner.defaultValue);\r\n                            }\r\n                            break;\r\n                        case KeyFrameValueType.Position:\r\n                            var locPos: Vector3 = pro.localPosition;\r\n                            var def: Vector3 = nodeOwner.defaultValue;\r\n                            locPos.x = def.x;\r\n                            locPos.y = def.y;\r\n                            locPos.z = def.z;\r\n                            pro.localPosition = locPos;\r\n                            break;\r\n                        case KeyFrameValueType.Rotation:\r\n                            var locRot: Quaternion = pro.localRotation;\r\n                            var defQua: Quaternion = nodeOwner.defaultValue;\r\n                            locRot.x = defQua.x;\r\n                            locRot.y = defQua.y;\r\n                            locRot.z = defQua.z;\r\n                            locRot.w = defQua.w;\r\n                            pro.localRotation = locRot;\r\n                            break;\r\n                        case KeyFrameValueType.Scale:\r\n                            var locSca: Vector3 = pro.localScale;\r\n                            def = nodeOwner.defaultValue;\r\n                            locSca.x = def.x;\r\n                            locSca.y = def.y;\r\n                            locSca.z = def.z;\r\n                            pro.localScale = locSca;\r\n                            break;\r\n                        case KeyFrameValueType.RotationEuler:\r\n                            var locEul: Vector3 = pro.localRotationEuler;\r\n                            def = nodeOwner.defaultValue;\r\n                            locEul.x = def.x;\r\n                            locEul.y = def.y;\r\n                            locEul.z = def.z;\r\n                            pro.localRotationEuler = locEul;\r\n                            break;\r\n                        case KeyFrameValueType.Vector2:\r\n                            var proPat: string[] = nodeOwner.property!;\r\n                            var m: number = proPat.length - 1;\r\n                            for (var j: number = 0; j < m; j++) {\r\n                                pro = pro[proPat[j]];\r\n                                if (!pro)//\r\n                                    break;\r\n                            }\r\n                            value = proPat[m];\r\n                            if (!nodeOwner.isMaterial) {\r\n                                pro && (pro[value] = nodeOwner.defaultValue);\r\n                                if (nodeOwner.callbackFun) {\r\n                                    nodeOwner.animatorDataSetCallBack();\r\n                                }\r\n                            } else {\r\n                                pro && pro.getVector2(value) && (pro as Material).setVector2(value, nodeOwner.defaultValue);\r\n                            }\r\n                            break;\r\n                        case KeyFrameValueType.Vector3:\r\n                            var proPat: string[] = nodeOwner.property!;\r\n                            var m: number = proPat.length - 1;\r\n                            for (var j: number = 0; j < m; j++) {\r\n                                pro = pro[proPat[j]];\r\n                                if (!pro)//\r\n                                    break;\r\n                            }\r\n                            value = proPat[m];\r\n                            if (!nodeOwner.isMaterial) {\r\n                                pro && (pro[value] = nodeOwner.defaultValue);\r\n                                if (nodeOwner.callbackFun) {\r\n                                    nodeOwner.animatorDataSetCallBack();\r\n                                }\r\n                            } else {\r\n                                pro && pro.getVector3(value) && (pro as Material).setVector3(value, nodeOwner.defaultValue);\r\n                            }\r\n                            break;\r\n                        case KeyFrameValueType.Vector4:\r\n                            var proPat: string[] = nodeOwner.property!;\r\n                            var m: number = proPat.length - 1;\r\n                            for (var j: number = 0; j < m; j++) {\r\n                                pro = pro[proPat[j]];\r\n                                if (!pro)//\r\n                                    break;\r\n                            }\r\n                            value = proPat[m];\r\n                            if (!nodeOwner.isMaterial) {\r\n                                pro && (pro[value] = nodeOwner.defaultValue);\r\n                                if (nodeOwner.callbackFun) {\r\n                                    nodeOwner.animatorDataSetCallBack();\r\n                                }\r\n                            } else {\r\n                                pro && pro.getVector3(value) && (pro as Material).setVector3(value, nodeOwner.defaultValue);\r\n                            }\r\n                            break;\r\n                        case KeyFrameValueType.Color:\r\n                            var proPat: string[] = nodeOwner.property!;\r\n                            var m: number = proPat.length - 1;\r\n                            for (var j: number = 0; j < m; j++) {\r\n                                pro = pro[proPat[j]];\r\n                                if (!pro)//\r\n                                    break;\r\n                            }\r\n                            value = proPat[m];\r\n                            let tempColor = Animator._tempColor;\r\n                            tempColor.r = nodeOwner.defaultValue.x;\r\n                            tempColor.g = nodeOwner.defaultValue.y;\r\n                            tempColor.b = nodeOwner.defaultValue.z;\r\n                            tempColor.a = nodeOwner.defaultValue.w;\r\n                            if (!nodeOwner.isMaterial) {\r\n                                pro && (pro[value] = tempColor);\r\n                                if (nodeOwner.callbackFun) {\r\n                                    nodeOwner.animatorDataSetCallBack();\r\n                                }\r\n                            } else {\r\n                                pro && pro.getColor(value) && (pro as Material).setColor(value, tempColor);\r\n                            }\r\n                            break;\r\n                        default:\r\n                            throw \"Animator:unknown type.\";\r\n                    }\r\n\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    /** @internal */\r\n    onAfterDeserialize(): void {\r\n        let arr = (<any>this).controllerLayers;\r\n        if (!arr || null != this.controller)\r\n            return;\r\n        delete (<any>this).controllerLayers;\r\n        this._controllerLayers.length = 0;\r\n        for (let layer of arr) {\r\n            this.addControllerLayer(layer);\r\n        }\r\n    }\r\n\r\n    protected _onEnable(): void {\r\n        for (let i = 0, n = this._controllerLayers.length; i < n; i++) {\r\n            if (this._controllerLayers[i].playOnWake) {\r\n                let defaultClip: AnimatorState = this.getDefaultState(i);\r\n                (defaultClip) && (this.play(null, i, defaultClip.cycleOffset));\r\n            }\r\n        }\r\n    }\r\n\r\n    protected _onDestroy() {\r\n        for (let i = 0, n = this._controllerLayers.length; i < n; i++)\r\n            this._controllerLayers[i]._removeReference();\r\n    }\r\n\r\n    private _applyUpdateMode(delta: number): number {\r\n        let ret;\r\n        switch (this._updateMode) {\r\n            case AnimatorUpdateMode.Normal:\r\n                ret = delta;\r\n                break;\r\n            case AnimatorUpdateMode.LowFrame:\r\n                ret = (Stat.loopCount % this._lowUpdateDelty == 0) ? delta * this._lowUpdateDelty : 0;\r\n                break;\r\n            case AnimatorUpdateMode.UnScaleTime:\r\n                ret = 0;\r\n                break;\r\n        }\r\n        return ret;\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    _handleSpriteOwnersBySprite(isLink: boolean, path: string[], sprite: Sprite3D): void {\r\n        for (var i: number = 0, n: number = this._controllerLayers.length; i < n; i++) {\r\n            if (!this._controllerLayers[i].enable)\r\n                continue;\r\n            var clipStateInfos: AnimatorState[] = this._controllerLayers[i]._states;\r\n            for (var j: number = 0, m: number = clipStateInfos.length; j < m; j++) {\r\n                var clipStateInfo: AnimatorState = clipStateInfos[j];\r\n                var clip: AnimationClip = clipStateInfo._clip!;\r\n                var nodePath: string = path.join(\"/\");\r\n                var ownersNodes: KeyframeNode[] = clip._nodesMap[nodePath];\r\n                if (ownersNodes) {\r\n                    var nodeOwners: KeyframeNodeOwner[] = clipStateInfo._nodeOwners;\r\n                    for (var k: number = 0, p: number = ownersNodes.length; k < p; k++) {\r\n                        if (isLink)\r\n                            this._addKeyframeNodeOwner(nodeOwners, ownersNodes[k], sprite);\r\n                        else\r\n                            this._removeKeyframeNodeOwner(nodeOwners, ownersNodes[k]);\r\n                    }\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * @inheritDoc\r\n     * @internal\r\n     * @override\r\n     */\r\n    _parse(data: any): void {\r\n        var play: any = data.playOnWake;\r\n        var layersData: any[] = data.layers;\r\n        for (var i: number = 0; i < layersData.length; i++) {\r\n            var layerData: any = layersData[i];\r\n            var animatorLayer: AnimatorControllerLayer = new AnimatorControllerLayer(layerData.name);\r\n            if (i === 0)\r\n                animatorLayer.defaultWeight = 1.0;//TODO:\r\n            else\r\n                animatorLayer.defaultWeight = layerData.weight;\r\n\r\n            var blendingModeData: any = layerData.blendingMode;\r\n            (blendingModeData) && (animatorLayer.blendingMode = blendingModeData);\r\n            this.addControllerLayer(animatorLayer);\r\n            var states: any[] = layerData.states;\r\n            for (var j: number = 0, m: number = states.length; j < m; j++) {\r\n                var state: any = states[j];\r\n                var clipPath: string = state.clipPath;\r\n                if (clipPath) {\r\n                    var name: string = state.name;\r\n                    var motion: AnimationClip;\r\n                    motion = Loader.getRes(clipPath);\r\n                    if (motion) {//motion\r\n                        var animatorState: AnimatorState = new AnimatorState();\r\n                        animatorState.name = name;\r\n                        animatorState.clip = motion;\r\n                        state.speed && (animatorState.speed = state.speed);\r\n                        animatorLayer.addState(animatorState);\r\n                        (j === 0) && (this.getControllerLayer(i).defaultState = animatorState);\r\n                    }\r\n                }\r\n            }\r\n            (play !== undefined) && (animatorLayer.playOnWake = play);\r\n            //avatarMask\r\n            let layerMaskData = layerData.avatarMask;\r\n            if (layerMaskData) {\r\n                let avaMask = new AvatarMask();\r\n                animatorLayer.avatarMask = avaMask;\r\n                for (var bips in layerMaskData) {\r\n                    avaMask.setTransformActive(bips, layerMaskData[bips]);\r\n                }\r\n            }\r\n        }\r\n        var cullingModeData: any = data.cullingMode;\r\n        (cullingModeData !== undefined) && (this.cullingMode = cullingModeData);\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    onUpdate(): void {\r\n        let timer = this.owner._scene.timer;\r\n        let delta = timer._delta / 1000.0;//Laya.timer.deltaLaya.timer.scale\r\n        delta = this._applyUpdateMode(delta);\r\n        if (this._speed === 0 || delta === 0)//delta0,crossWeightNaN\r\n            return;\r\n        if (!Stat.enableAnimatorUpdate)\r\n            return;\r\n        var needRender = true;//TODO:needRendertrue\r\n        var i, n;\r\n        this._updateMark++;\r\n        for (i = 0, n = this._controllerLayers.length; i < n; i++) {\r\n            var controllerLayer: AnimatorControllerLayer = this._controllerLayers[i];\r\n            if (!controllerLayer.enable)\r\n                continue;\r\n            var playStateInfo: AnimatorPlayState = controllerLayer._playStateInfo!;\r\n            if (this.sleep && playStateInfo._finish && controllerLayer._playType == 0) {\r\n                continue;\r\n            }\r\n            var crossPlayStateInfo: AnimatorPlayState = controllerLayer._crossPlayStateInfo!;\r\n            addtive = controllerLayer.blendingMode !== AnimatorControllerLayer.BLENDINGMODE_OVERRIDE;\r\n            switch (controllerLayer._playType) {\r\n                case 0:\r\n                    var animatorState: AnimatorState = playStateInfo.currentState!;\r\n                    var clip: AnimationClip = animatorState._clip!;\r\n                    var speed: number = this._speed * animatorState.speed;\r\n                    var finish: boolean = playStateInfo._finish;//finish,\r\n                    finish || this._updatePlayer(animatorState, playStateInfo, delta * speed, animatorState.islooping, i);\r\n                    if (needRender) {\r\n                        var addtive: boolean = controllerLayer.blendingMode !== AnimatorControllerLayer.BLENDINGMODE_OVERRIDE;\r\n                        this._updateClipDatas(animatorState, addtive, playStateInfo, controllerLayer.avatarMask);//clipDatas,Animator,updateClipDatas\r\n                        this._setClipDatasToNode(animatorState, addtive, controllerLayer.defaultWeight, i === 0, controllerLayer);//\r\n                        finish || this._updateEventScript(animatorState, playStateInfo);\r\n                    }\r\n                    finish || this._updateStateFinish(animatorState, playStateInfo);\r\n                    break;\r\n                case 1:\r\n                    animatorState = playStateInfo.currentState!;\r\n                    clip = animatorState._clip!;\r\n                    var crossState: AnimatorState = controllerLayer._crossPlayState;\r\n                    var crossClip: AnimationClip = crossState._clip!;\r\n                    var crossDuratuion: number = controllerLayer._crossDuration;\r\n                    var startPlayTime: number = crossPlayStateInfo._startPlayTime;\r\n                    var crossClipDuration: number = crossClip._duration - startPlayTime;\r\n                    var crossScale: number = (crossDuratuion > crossClipDuration && 0 != crossClipDuration) ? crossClipDuration / crossDuratuion : 1.0;//,\r\n                    var crossSpeed: number = this._speed * crossState.speed;\r\n                    this._updatePlayer(crossState, crossPlayStateInfo, delta * crossScale * crossSpeed, crossClip.islooping, i);\r\n                    var crossWeight: number = ((crossPlayStateInfo._elapsedTime - startPlayTime) / crossScale) / crossDuratuion;\r\n                    var needUpdateFinishcurrentState = false;\r\n                    if (crossWeight >= 1.0) {\r\n                        if (needRender) {\r\n                            this._updateClipDatas(crossState, addtive, crossPlayStateInfo, controllerLayer.avatarMask);\r\n                            this._setClipDatasToNode(crossState, addtive, controllerLayer.defaultWeight, i === 0, controllerLayer);\r\n\r\n                            controllerLayer._playType = 0;//,\r\n                            playStateInfo.currentState = crossState;\r\n                            crossPlayStateInfo._cloneTo(playStateInfo);\r\n                        }\r\n                    } else {\r\n                        if (!playStateInfo._finish) {\r\n                            speed = this._speed * animatorState.speed;\r\n                            needUpdateFinishcurrentState = true;\r\n                            this._updatePlayer(animatorState, playStateInfo, delta * speed, animatorState.islooping, i);\r\n                            if (needRender)\r\n                                this._updateClipDatas(animatorState, addtive, playStateInfo, controllerLayer.avatarMask);\r\n                        }\r\n                        if (needRender) {\r\n                            this._updateClipDatas(crossState, addtive, crossPlayStateInfo, controllerLayer.avatarMask);\r\n                            this._setCrossClipDatasToNode(controllerLayer, animatorState, crossState, crossWeight, i === 0);\r\n                        }\r\n                    }\r\n                    if (needRender) {\r\n                        this._updateEventScript(animatorState, playStateInfo);\r\n                        this._updateEventScript(crossState, crossPlayStateInfo);\r\n                    }\r\n                    this._updateStateFinish(crossState, crossPlayStateInfo);\r\n                    needUpdateFinishcurrentState && this._updateStateFinish(playStateInfo.currentState, playStateInfo);\r\n                    break;\r\n                case 2:\r\n                    crossState = controllerLayer._crossPlayState;\r\n                    crossClip = crossState._clip!;\r\n                    crossDuratuion = controllerLayer._crossDuration;\r\n                    startPlayTime = crossPlayStateInfo._startPlayTime;\r\n                    crossClipDuration = crossClip._duration - startPlayTime;\r\n                    crossScale = crossDuratuion > crossClipDuration ? crossClipDuration / crossDuratuion : 1.0;//,\r\n                    crossSpeed = this._speed * crossState.speed;\r\n                    this._updatePlayer(crossState, crossPlayStateInfo, delta * crossScale * crossSpeed, crossState.islooping, i);\r\n                    if (needRender) {\r\n                        crossWeight = ((crossPlayStateInfo._elapsedTime - startPlayTime) / crossScale) / crossDuratuion;\r\n                        if (crossWeight >= 1.0) {\r\n                            this._updateClipDatas(crossState, addtive, crossPlayStateInfo, controllerLayer.avatarMask);\r\n                            this._setClipDatasToNode(crossState, addtive, 1.0, i === 0, controllerLayer);\r\n                            controllerLayer._playType = 0;//,\r\n                            playStateInfo.currentState = crossState;\r\n                            crossPlayStateInfo._cloneTo(playStateInfo);\r\n                        } else {\r\n                            this._updateClipDatas(crossState, addtive, crossPlayStateInfo, controllerLayer.avatarMask);\r\n                            this._setFixedCrossClipDatasToNode(controllerLayer, crossState, crossWeight, i === 0);\r\n                        }\r\n                        this._updateEventScript(crossState, crossPlayStateInfo);\r\n                    }\r\n                    this._updateStateFinish(crossState, crossPlayStateInfo);\r\n                    break;\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     * @override\r\n     */\r\n    _cloneTo(dest: Component): void {\r\n        var animator: Animator = (<Animator>dest);\r\n        animator.cullingMode = this.cullingMode;\r\n\r\n        for (var i: number = 0, n: number = this._controllerLayers.length; i < n; i++) {\r\n            var controllLayer: AnimatorControllerLayer = this._controllerLayers[i];\r\n            animator.addControllerLayer(controllLayer.clone());\r\n            var animatorStates: AnimatorState[] = controllLayer._states;\r\n            for (var j: number = 0, m: number = animatorStates.length; j < m; j++) {\r\n                var state: AnimatorState = animatorStates[j].clone();\r\n                var cloneLayer: AnimatorControllerLayer = animator.getControllerLayer(i);\r\n                cloneLayer.addState(state);\r\n                (j == 0) && (cloneLayer.defaultState = state);\r\n            }\r\n        }\r\n        animator.controller = this._controller\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @param\tlayerIndex \r\n     * @return \r\n     */\r\n    getDefaultState(layerIndex: number = 0): AnimatorState {\r\n        var controllerLayer: AnimatorControllerLayer = this._controllerLayers[layerIndex];\r\n        return controllerLayer.defaultState;\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @param\tstate \r\n     * @param   layerIndex \r\n     */\r\n    addState(state: AnimatorState, layerIndex: number = 0): void {\r\n        var controllerLayer: AnimatorControllerLayer = this._controllerLayers[layerIndex];\r\n        controllerLayer.addState(state);\r\n        console.warn(\"Animator:this function is discard,please use animatorControllerLayer.addState() instead.\");\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @param\tstate \r\n     * @param   layerIndex \r\n     */\r\n    removeState(state: AnimatorState, layerIndex: number = 0): void {\r\n        var controllerLayer: AnimatorControllerLayer = this._controllerLayers[layerIndex];\r\n        controllerLayer.removeState(state);\r\n        console.warn(\"Animator:this function is discard,please use animatorControllerLayer.removeState() instead.\");\r\n    }\r\n\r\n    /**\r\n     * \r\n     */\r\n    addControllerLayer(controllderLayer: AnimatorControllerLayer): void {\r\n        this._controllerLayers.push(controllderLayer);\r\n        controllderLayer._animator = this;//TODO:,\r\n        controllderLayer._addReference();\r\n        var states: AnimatorState[] = controllderLayer._states;\r\n        for (var i: number = 0, n: number = states.length; i < n; i++)\r\n            this._getOwnersByClip(states[i]);\r\n    }\r\n\r\n    /**\r\n     * \r\n     */\r\n    getControllerLayer(layerInex: number = 0): AnimatorControllerLayer {\r\n        return this._controllerLayers[layerInex];\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @param\tname null\r\n     * @param\tlayerIndex \r\n     * @param\tnormalizedTime \r\n     */\r\n    play(name: string | null = null, layerIndex: number = 0, normalizedTime: number = Number.NEGATIVE_INFINITY): void {\r\n        var controllerLayer: AnimatorControllerLayer = this._controllerLayers[layerIndex];\r\n        if (controllerLayer) {\r\n            var defaultState: AnimatorState = controllerLayer.defaultState;\r\n            if (!name && !defaultState)\r\n                throw new Error(\"Animator:must have default clip value,please set clip property.\");\r\n            var playStateInfo: AnimatorPlayState = controllerLayer._playStateInfo!;\r\n            var curPlayState: AnimatorState = playStateInfo.currentState!;\r\n\r\n\r\n            var animatorState: AnimatorState = name ? controllerLayer.getAnimatorState(name) : defaultState;\r\n            if (!animatorState._clip)\r\n                return;\r\n\r\n            var clipDuration: number = animatorState._clip!._duration;\r\n            var calclipduration = animatorState._clip!._duration * (animatorState.clipEnd - animatorState.clipStart);\r\n            if (curPlayState !== animatorState) {\r\n                if (normalizedTime !== Number.NEGATIVE_INFINITY)\r\n                    playStateInfo._resetPlayState(clipDuration * normalizedTime, calclipduration);\r\n                else\r\n                    playStateInfo._resetPlayState(0.0, calclipduration);\r\n                (curPlayState !== null && curPlayState !== animatorState) && (this._revertDefaultKeyframeNodes(curPlayState));\r\n                controllerLayer._playType = 0;\r\n                playStateInfo.currentState = animatorState;\r\n            } else {\r\n                if (normalizedTime !== Number.NEGATIVE_INFINITY) {\r\n                    playStateInfo._resetPlayState(clipDuration * normalizedTime, calclipduration);\r\n                    controllerLayer._playType = 0;\r\n                }\r\n            }\r\n            var scripts: AnimatorStateScript[] = animatorState._scripts!;\r\n            animatorState._eventStart(this, layerIndex);\r\n\r\n        }\r\n        else {\r\n            console.warn(\"Invalid layerIndex \" + layerIndex + \".\");\r\n        }\r\n        if (this.owner._scene) {\r\n            this.onUpdate();\r\n        }\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @param\tname \r\n     * @param\ttransitionDuration ,0.0~1.0\r\n     * @param\tlayerIndex \r\n     * @param\tnormalizedTime \r\n     */\r\n    crossFade(name: string, transitionDuration: number, layerIndex: number = 0, normalizedTime: number = Number.NEGATIVE_INFINITY): void {\r\n        var controllerLayer = this._controllerLayers[layerIndex];\r\n        if (controllerLayer) {\r\n            var destAnimatorState = controllerLayer.getAnimatorState(name);\r\n            if (destAnimatorState) {\r\n                var playType = controllerLayer._playType;\r\n                if (playType === -1) {//playplay\r\n                    this.play(name, layerIndex, normalizedTime);\r\n                    return;\r\n                }\r\n\r\n                var crossPlayStateInfo = controllerLayer._crossPlayStateInfo;\r\n                var crossNodeOwners = controllerLayer._crossNodesOwners;\r\n                var crossNodeOwnerIndicesMap = controllerLayer._crossNodesOwnersIndicesMap;\r\n\r\n                var srcAnimatorState = controllerLayer._playStateInfo!.currentState;\r\n                var destNodeOwners = destAnimatorState._nodeOwners;\r\n                var destCrossClipNodeIndices = controllerLayer._destCrossClipNodeIndices;\r\n                var destClip = destAnimatorState._clip;\r\n                var destNodes = destClip._nodes!;\r\n                var destNodesMap = destClip._nodesDic;\r\n                var crossCount = 0;\r\n                switch (playType) {\r\n                    case 0:\r\n                        var srcNodeOwners = srcAnimatorState!._nodeOwners;\r\n                        var scrCrossClipNodeIndices = controllerLayer._srcCrossClipNodeIndices;\r\n                        var srcClip = srcAnimatorState!._clip;\r\n                        var srcNodes = srcClip!._nodes!;\r\n                        var srcNodesMap = srcClip!._nodesDic;\r\n                        controllerLayer._playType = 1;\r\n\r\n                        var crossMark = ++controllerLayer._crossMark;\r\n                        crossCount = controllerLayer._crossNodesOwnersCount = 0;\r\n\r\n                        for (var i = 0, n = srcNodes.count; i < n; i++) {\r\n                            var srcNode = srcNodes.getNodeByIndex(i);\r\n                            var srcIndex = srcNode._indexInList;\r\n                            var srcNodeOwner = srcNodeOwners[srcIndex];\r\n                            if (srcNodeOwner) {\r\n                                var srcFullPath = srcNode.fullPath;\r\n                                scrCrossClipNodeIndices[crossCount] = srcIndex;\r\n                                var destNode = destNodesMap[srcFullPath];\r\n                                if (destNode)\r\n                                    destCrossClipNodeIndices[crossCount] = destNode._indexInList;\r\n                                else\r\n                                    destCrossClipNodeIndices[crossCount] = -1;\r\n\r\n                                crossNodeOwnerIndicesMap[srcFullPath] = crossMark;\r\n                                crossNodeOwners[crossCount] = srcNodeOwner;\r\n                                crossCount++;\r\n                            }\r\n                        }\r\n\r\n                        for (i = 0, n = destNodes.count; i < n; i++) {\r\n                            destNode = destNodes.getNodeByIndex(i);\r\n                            var destIndex = destNode._indexInList;\r\n                            var destNodeOwner = destNodeOwners[destIndex];\r\n                            if (destNodeOwner) {\r\n                                var destFullPath = destNode.fullPath;\r\n                                if (!srcNodesMap[destFullPath]) {\r\n                                    scrCrossClipNodeIndices[crossCount] = -1;\r\n                                    destCrossClipNodeIndices[crossCount] = destIndex;\r\n\r\n                                    crossNodeOwnerIndicesMap[destFullPath] = crossMark;\r\n                                    crossNodeOwners[crossCount] = destNodeOwner;\r\n                                    crossCount++;\r\n                                }\r\n                            }\r\n                        }\r\n                        break;\r\n                    case 1:\r\n                    case 2:\r\n                        controllerLayer._playType = 2;\r\n                        for (i = 0, n = crossNodeOwners.length; i < n; i++) {\r\n                            var nodeOwner = crossNodeOwners[i];\r\n                            nodeOwner.saveCrossFixedValue();\r\n                            destNode = destNodesMap[nodeOwner.fullPath!];\r\n                            if (destNode)\r\n                                destCrossClipNodeIndices[i] = destNode._indexInList;\r\n                            else\r\n                                destCrossClipNodeIndices[i] = -1;\r\n                        }\r\n\r\n                        crossCount = controllerLayer._crossNodesOwnersCount;\r\n                        crossMark = controllerLayer._crossMark;\r\n                        for (i = 0, n = destNodes.count; i < n; i++) {\r\n                            destNode = destNodes.getNodeByIndex(i);\r\n                            destIndex = destNode._indexInList;\r\n                            destNodeOwner = destNodeOwners[destIndex];\r\n                            if (destNodeOwner) {\r\n                                destFullPath = destNode.fullPath;\r\n                                if (crossNodeOwnerIndicesMap[destFullPath] !== crossMark) {\r\n                                    destCrossClipNodeIndices[crossCount] = destIndex;\r\n\r\n                                    crossNodeOwnerIndicesMap[destFullPath] = crossMark;\r\n                                    nodeOwner = destNodeOwners[destIndex];\r\n                                    crossNodeOwners[crossCount] = nodeOwner;\r\n                                    nodeOwner.saveCrossFixedValue();\r\n                                    crossCount++;\r\n                                }\r\n                            }\r\n                        }\r\n                        break;\r\n                    default:\r\n                }\r\n                controllerLayer._crossNodesOwnersCount = crossCount;\r\n                controllerLayer._crossPlayState = destAnimatorState;\r\n                controllerLayer._crossDuration = srcAnimatorState!._clip!._duration * transitionDuration;\r\n                if (normalizedTime !== Number.NEGATIVE_INFINITY)\r\n                    crossPlayStateInfo!._resetPlayState(destClip._duration * normalizedTime, controllerLayer._crossDuration);\r\n                else\r\n                    crossPlayStateInfo!._resetPlayState(0.0, controllerLayer._crossDuration);\r\n                destAnimatorState._eventStart(this, layerIndex);\r\n            }\r\n            else {\r\n                console.warn(\"Invalid name \" + layerIndex + \".\");\r\n            }\r\n        }\r\n        else {\r\n            console.warn(\"Invalid layerIndex \" + layerIndex + \".\");\r\n        }\r\n    }\r\n\r\n    /**\r\n     * set params value\r\n     * @param name \r\n     */\r\n    setParamsTrigger(name: number): void;\r\n    setParamsTrigger(name: string): void;\r\n    setParamsTrigger(name: string | number) {\r\n        let id;\r\n        if (typeof name == \"number\")\r\n            id = name;\r\n        else\r\n            id = AnimatorStateCondition.conditionNameToID(name);\r\n        this._animatorParams[id] = true;\r\n    }\r\n\r\n    /**\r\n     * set params value\r\n     * @param name \r\n     */\r\n    setParamsNumber(name: number, value: number): void;\r\n    setParamsNumber(name: string, value: number): void;\r\n    setParamsNumber(name: string | number, value: number) {\r\n        let id;\r\n        if (typeof name == \"number\")\r\n            id = name;\r\n        else\r\n            id = AnimatorStateCondition.conditionNameToID(name);\r\n        this._animatorParams[id] = value;\r\n    }\r\n\r\n    /**\r\n     * set params value\r\n     * @param name \r\n     */\r\n    setParamsBool(name: number, value: boolean): void;\r\n    setParamsBool(name: string, value: boolean): void;\r\n    setParamsBool(name: string | number, value: boolean) {\r\n        let id;\r\n        if (typeof name == \"number\")\r\n            id = name;\r\n        else\r\n            id = AnimatorStateCondition.conditionNameToID(name);\r\n        this._animatorParams[id] = value;\r\n    }\r\n\r\n    /**\r\n     * get params value\r\n     * @param name \r\n     */\r\n    getParamsvalue(name: number): number | boolean;\r\n    getParamsvalue(name: string): number | boolean;\r\n    getParamsvalue(name: string | number): number | boolean {\r\n        let id;\r\n        if (typeof name == \"number\")\r\n            id = name;\r\n        else\r\n            id = AnimatorStateCondition.conditionNameToID(name);\r\n        return this._animatorParams[id];\r\n    }\r\n\r\n\r\n    /**\r\n     * @deprecated animator.getControllerLayer(layerIndex).getCurrentPlayState()use animator.getControllerLayer(layerIndex).getCurrentPlayState() instead\r\n     * \r\n     * @param   layerIndex \r\n     * @return  \r\n     */\r\n    getCurrentAnimatorPlayState(layerInex: number = 0): AnimatorPlayState {\r\n        return this._controllerLayers[layerInex]._playStateInfo!;\r\n    }\r\n}\r\n\r\n\r\n","import { AniStateConditionType } from \"../../../components/AnimatorControllerParse\";\r\nimport { AnimatorStateCondition } from \"../../../components/AnimatorStateCondition\";\r\nimport { AnimatorState } from \"./AnimatorState\";\r\n\r\nexport class AnimatorTransition {\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    private _name: string;\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    private _mute: boolean;//can,t play on this transition\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    private _exitTime: number;//\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    private _exitByTime: boolean;//\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    private _transstartoffset: number;//state\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    private _transduration: number;// 0-1\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    private _conditions: AnimatorStateCondition[];//\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    private _destState: AnimatorState;\r\n\r\n    /**\r\n     * Animatortransition\r\n     */\r\n    constructor() {\r\n        this._conditions = [];\r\n        this._exitByTime = true;\r\n        this._exitTime = 0.85;\r\n        this._transduration = 0.15;\r\n        this._transstartoffset = 0;\r\n        this._mute = false;\r\n    }\r\n\r\n    /**\r\n     * \r\n     */\r\n    get name() {\r\n        return this._name;\r\n    }\r\n\r\n    set name(value: string) {\r\n        this._name = value;\r\n    }\r\n\r\n    /**\r\n     * \r\n     */\r\n    get mute() {\r\n        return this._mute;\r\n    }\r\n\r\n    set mute(value: boolean) {\r\n        this._mute = value;\r\n    }\r\n\r\n    /**\r\n     * \r\n     */\r\n    get destState() {\r\n        return this._destState;\r\n    }\r\n\r\n    set destState(value: AnimatorState) {\r\n        this._destState = value;\r\n    }\r\n\r\n    /**\r\n     * condition\r\n     * IDE\r\n     */\r\n    get conditions() {\r\n        return this._conditions;\r\n    }\r\n\r\n    set conditions(value: AnimatorStateCondition[]) {\r\n        for (var i = this._conditions.length - 1; i >= 0; i--) {\r\n            this.removeCondition(this._conditions[i]);\r\n        }\r\n\r\n        for (var i = 0; i < value.length; i++) {\r\n            this.addCondition(value[i]);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * \r\n     */\r\n    get exitByTime() {\r\n        return this._exitByTime;\r\n    }\r\n\r\n    set exitByTime(value: boolean) {\r\n        this._exitByTime = value;\r\n    }\r\n\r\n    /**\r\n     * State\r\n     */\r\n    set transduration(value: number) {\r\n        this._transduration = Math.max(0, Math.min(value, 1.0));\r\n    }\r\n\r\n    get transduration() {\r\n        return this._transduration;\r\n    }\r\n\r\n\r\n    /**\r\n    * State\r\n    */\r\n    set transstartoffset(value: number) {\r\n        this._transstartoffset = Math.max(0, Math.min(value, 1.0));\r\n    }\r\n\r\n    get transstartoffset() {\r\n        return this._transstartoffset;\r\n    }\r\n\r\n    /**\r\n    * \r\n    */\r\n    set exitTime(value: number) {\r\n        this._exitTime = Math.max(0, Math.min(value, 1.0));\r\n    }\r\n\r\n    get exitTime() {\r\n        return this._exitTime;\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @param condition \r\n     */\r\n    addCondition(condition: AnimatorStateCondition): void {\r\n        if (this._conditions.indexOf(condition) == -1) {\r\n            this._conditions.push(condition);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @param condition \r\n     */\r\n    removeCondition(condition: AnimatorStateCondition): void {\r\n        let index = this._conditions.indexOf(condition);\r\n        if (index != -1) {\r\n            this._conditions.splice(index, 0);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @param normalizeTime \r\n     * @param paramsMap \r\n     */\r\n    check(normalizeTime: number, paramsMap: { [key: number]: number | boolean }): boolean {\r\n        if (this._mute) {\r\n            return false;\r\n        }\r\n        if (this._conditions.length == 0) {\r\n            if (normalizeTime >= this._exitTime)\r\n                return true;\r\n        } else {\r\n            if (this._exitByTime && normalizeTime < this._exitTime) {\r\n                return false;\r\n            }\r\n            for (var i = 0; i < this._conditions.length; i++) {\r\n                let con = this._conditions[i];\r\n                let out = con.checkState(paramsMap[con.id]);\r\n                if (out) {\r\n                    if (con.type == AniStateConditionType.Trigger)\r\n                        paramsMap[con.id] = false;\r\n                    return true;\r\n                }\r\n            }\r\n        }\r\n        return false;\r\n    }\r\n}","import { AnimatorControllerParse, AniParmType, TypeAnimatorConditions, TypeAnimatorControllerData, TypeAnimatorParams, TypeAnimatorState, TypeAnimatorTransition } from \"../../../components/AnimatorControllerParse\";\r\nimport { AnimatorStateCondition, AnimatorStateBoolCondition, AnimatorStateNumberCondition, AnimatorStateTriggerCondition } from \"../../../components/AnimatorStateCondition\";\r\nimport { Resource } from \"../../../resource/Resource\";\r\nimport { ClassUtils } from \"../../../utils/ClassUtils\";\r\nimport { Animator } from \"./Animator\";\r\nimport { AnimatorControllerLayer } from \"./AnimatorControllerLayer\";\r\nimport { AnimatorState } from \"./AnimatorState\";\r\nimport { AnimatorTransition } from \"./AnimatorTransition\";\r\nimport { AvatarMask } from \"./AvatarMask\";\r\n\r\nexport class AnimatorController extends Resource {\r\n    data: TypeAnimatorControllerData;\r\n    clipsID: string[];\r\n    constructor(data: any) {\r\n        super();\r\n        let obj = AnimatorControllerParse.parse(data);\r\n        this.data = obj.ret;\r\n        this.clipsID = obj.clipsID;\r\n    }\r\n\r\n    private getLayers() {\r\n        let layers = this.data.controllerLayers;\r\n        let lArr: AnimatorControllerLayer[] = [];\r\n        for (let i = layers.length - 1; i >= 0; i--) {\r\n            let l = layers[i];\r\n            let acl = new AnimatorControllerLayer(l.name);\r\n            if (l.avatarMask) {\r\n                acl.avatarMask = l.avatarMask;\r\n            }\r\n            lArr.unshift(acl);\r\n            for (let k in l) {\r\n                if (\"avatarMask\" == k || \"name\" == k || \"states\" == k || null == (l as any)[k]) {\r\n                    continue;\r\n                }\r\n                try {\r\n                    (acl as any)[k] = (l as any)[k];\r\n                } catch (err: any) { }\r\n            }\r\n            this.getState(l.states, acl, this.data);\r\n        }\r\n        return lArr;\r\n    }\r\n\r\n    updateTo(a: Animator) {\r\n        let currLayer = (a as any)._controllerLayers;\r\n\r\n        for (let i = 0, len = currLayer.length; i < len; i++) {\r\n            currLayer[i]._removeReference();\r\n        }\r\n        currLayer.length = 0;\r\n\r\n        let layers = this.getLayers();\r\n\r\n        for (let i = 0, len = layers.length; i < len; i++) {\r\n            a.addControllerLayer(layers[i]);\r\n        }\r\n        let parms = this.data.animatorParams;\r\n        if (parms) {\r\n            for (let i = parms.length - 1; i >= 0; i--) {\r\n                let p = parms[i];\r\n                if (AniParmType.Bool == p.type) {\r\n                    a.setParamsBool(p.name, Boolean(p.val));\r\n                } else if (AniParmType.Float == p.type) {\r\n                    let val = Number(p.val);\r\n                    if (isNaN(val)) {\r\n                        val = 0;\r\n                    }\r\n                    a.setParamsNumber(p.name, val);\r\n                } else if (AniParmType.Trigger == p.type) {\r\n                    if (p.val) {\r\n                        a.setParamsTrigger(p.name);\r\n                    }\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    private createState(states: TypeAnimatorState[], idCatch: Record<string, AnimatorState>, acl: AnimatorControllerLayer) {\r\n        if (!states) return null;\r\n        let ret: Record<string, AnimatorState> = {};\r\n        let defID: string = null;\r\n        for (let i = states.length - 1; i >= 0; i--) {\r\n            let obj = states[i];\r\n\r\n            let childStates = obj.states;\r\n\r\n            if (childStates) {\r\n                let groupRet = this.createState(childStates, idCatch, acl);\r\n\r\n                if (groupRet) {\r\n                    idCatch[obj.id] = groupRet.states[groupRet.id];\r\n                }\r\n                continue;\r\n            }\r\n            if (0 > Number(obj.id)) {\r\n                if (\"-1\" == obj.id) {\r\n                    let transitions = obj.soloTransitions;\r\n                    if (transitions && 0 < transitions.length) {\r\n                        defID = transitions[0].id;\r\n                    }\r\n                }\r\n                continue;\r\n            }\r\n            let state = new AnimatorState();\r\n            idCatch[obj.id] = state;\r\n            ret[obj.id] = state;\r\n            for (let k in obj) {\r\n                try {\r\n                    if (\"scripts\" == k) {\r\n                        let scripts: string[] = obj[k];\r\n                        if (scripts && Array.isArray(scripts)) {\r\n                            for (let k = scripts.length - 1; k >= 0; k--) {\r\n                                let uuid = scripts[k];\r\n                                if (uuid && 0 == uuid.indexOf(\"res://\")) {\r\n                                    uuid = uuid.substring(6);\r\n                                }\r\n                                let c = ClassUtils.getClass(uuid);\r\n                                if (c) {\r\n                                    state.addScript(c);\r\n                                }\r\n                            }\r\n                        }\r\n                        continue;\r\n                    } else if (\"soloTransitions\" == k) {\r\n                        continue;\r\n                    } else if (null != (obj as any)[k]) {\r\n                        (state as any)[k] = (obj as any)[k];\r\n                    }\r\n                } catch (err: any) { }\r\n            }\r\n            acl.addState(state);\r\n        }\r\n        return { id: defID, states: ret };\r\n    }\r\n\r\n\r\n    private setExitTransition(exitRet: Record<string, TypeAnimatorTransition[]>, transitions: TypeAnimatorTransition[], idCatch: Record<string, AnimatorState>, data: TypeAnimatorControllerData, pExitRet: Record<string, TypeAnimatorTransition[]>) {\r\n        for (let id in exitRet) {\r\n            let state = idCatch[id];\r\n            if (state) {\r\n                let ats: AnimatorTransition[] = state.transitions;\r\n                let sts: AnimatorTransition[] = state.soloTransitions;\r\n                let linArr = exitRet[id];\r\n                for (let i = transitions.length - 1; i >= 0; i--) {\r\n                    let t = transitions[i];\r\n                    if (\"-3\" == t.id) {\r\n                        if (null == pExitRet[id]) {\r\n                            pExitRet[id] = [];\r\n                        }\r\n                        pExitRet[id].push(t);\r\n                        continue;\r\n                    }\r\n                    for (let j = linArr.length - 1; j >= 0; j--) {\r\n                        let t2 = linArr[j];\r\n                        let ato = new AnimatorTransition();\r\n                        ato.destState = idCatch[t.id];\r\n                        if (t.conditions) {\r\n                            this.addConditions(t.conditions, ato, data);\r\n                        }\r\n                        if (t2.conditions) {\r\n                            this.addConditions(t2.conditions, ato, data);\r\n                        }\r\n                        for (let k in t) {\r\n                            if (\"solo\" == k || \"id\" == k || \"conditions\" == k) {\r\n                                continue;\r\n                            } else {\r\n                                (ato as any)[k] = (t as any)[k];\r\n                            }\r\n                        }\r\n                        if (t.solo) {\r\n                            sts.unshift(ato);\r\n                        } else {\r\n                            ats.unshift(ato);\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n\r\n    private setTransitions(states: TypeAnimatorState[], idCatch: Record<string, AnimatorState>, acl: AnimatorControllerLayer, data: TypeAnimatorControllerData, pState?: TypeAnimatorState) {\r\n        if (!states) return null;\r\n        let exitRet: Record<string, TypeAnimatorTransition[]> = {};\r\n        for (let i = states.length - 1; i >= 0; i--) {\r\n            let obj = states[i];\r\n            if (obj.states) {\r\n                let exitTransition = this.setTransitions(obj.states, idCatch, acl, data, obj);\r\n                if (exitTransition) {\r\n                    let transitions = obj.soloTransitions;\r\n                    if (transitions) {\r\n                        this.setExitTransition(exitTransition, transitions, idCatch, data, exitRet);\r\n                    }\r\n                }\r\n            }\r\n        }\r\n        for (let i = states.length - 1; i >= 0; i--) {\r\n            let obj = states[i];\r\n            if (obj.states) {\r\n                continue;\r\n            }\r\n            if (\"-1\" == obj.id) {\r\n                if (obj.soloTransitions && 0 < obj.soloTransitions.length) {\r\n                    if (null == pState) {\r\n                        acl.defaultState = idCatch[obj.soloTransitions[0].id];\r\n                    } else {\r\n                        idCatch[pState.id] = idCatch[obj.soloTransitions[0].id];\r\n                    }\r\n                    continue;\r\n                }\r\n            } else if (\"-2\" == obj.id) {\r\n                let transitions = obj.soloTransitions;\r\n                if (transitions) {\r\n                    for (let j = transitions.length - 1; j >= 0; j--) {\r\n                        let o = transitions[j];\r\n                        let destState = idCatch[o.id];\r\n                        if (destState) {\r\n                            for (let idk in idCatch) {\r\n                                let state = idCatch[idk];\r\n                                let ato = new AnimatorTransition();\r\n                                ato.destState = destState;\r\n                                if (o.conditions) {\r\n                                    this.addConditions(o.conditions, ato, data);\r\n                                }\r\n\r\n                                for (let k in o) {\r\n                                    if (\"solo\" == k || \"id\" == k || \"conditions\" == k) {\r\n                                        continue;\r\n                                    } else {\r\n                                        (ato as any)[k] = (o as any)[k];\r\n                                    }\r\n                                }\r\n\r\n                                if (o.solo) {\r\n                                    state.soloTransitions.unshift(ato);\r\n                                } else {\r\n                                    state.transitions.unshift(ato);\r\n                                }\r\n                            }\r\n                        }\r\n                    }\r\n                }\r\n                continue;\r\n            } else if (\"-3\" == obj.id) {\r\n                continue;\r\n            }\r\n            let soloTransitions = obj.soloTransitions;\r\n            if (soloTransitions && idCatch[obj.id]) {\r\n                let ats: AnimatorTransition[] = idCatch[obj.id].transitions;\r\n                let sts: AnimatorTransition[] = idCatch[obj.id].soloTransitions;\r\n                for (let j = soloTransitions.length - 1; j >= 0; j--) {\r\n                    let o = soloTransitions[j];\r\n                    if (\"-3\" == o.id) {\r\n                        if (null == exitRet[obj.id]) {\r\n                            exitRet[obj.id] = [];\r\n                        }\r\n                        exitRet[obj.id].push(o);\r\n                        continue;\r\n                    }\r\n\r\n                    let ato = new AnimatorTransition();\r\n\r\n                    if (idCatch[o.id]) {\r\n                        ato.destState = idCatch[o.id];\r\n                    }\r\n                    if (o.conditions) {\r\n                        this.addConditions(o.conditions, ato, data);\r\n                    }\r\n                    for (let k in o) {\r\n                        if (\"solo\" == k || \"id\" == k || \"conditions\" == k) {\r\n                            continue;\r\n                        } else {\r\n                            (ato as any)[k] = (o as any)[k];\r\n                        }\r\n                    }\r\n                    if (o.solo) {\r\n                        sts.unshift(ato);\r\n                    } else {\r\n                        ats.unshift(ato);\r\n                    }\r\n                }\r\n            }\r\n        }\r\n        return exitRet;\r\n    }\r\n\r\n    private getState(states: TypeAnimatorState[], acl: AnimatorControllerLayer, data: TypeAnimatorControllerData) {\r\n        if (states) {\r\n            let idCatch: Record<string, AnimatorState> = {};\r\n            this.createState(states, idCatch, acl);\r\n            this.setTransitions(states, idCatch, acl, data);\r\n        }\r\n    }\r\n\r\n    private addConditions(arr: TypeAnimatorConditions[], ato: AnimatorTransition, data: TypeAnimatorControllerData) {\r\n        let parms = data.animatorParams;\r\n        if (null == parms || 0 == parms.length) return;\r\n        for (let i = 0, len = arr.length; i < len; i++) {\r\n            let o = arr[i];\r\n            let parm: TypeAnimatorParams = null;\r\n            for (let j = parms.length - 1; j >= 0; j--) {\r\n                if (parms[j].id == o.id) {\r\n                    parm = parms[j];\r\n                    break;\r\n                }\r\n            }\r\n            if (null == parm) {\r\n                return;\r\n            }\r\n            let c: AnimatorStateCondition;\r\n            if (parm.type == AniParmType.Bool) {\r\n                let b = new AnimatorStateBoolCondition(parm.name);\r\n                b.compareFlag = Boolean(o.checkValue);\r\n                c = b;\r\n            } else if (parm.type == AniParmType.Float) {\r\n                let n = new AnimatorStateNumberCondition(parm.name);\r\n                n.numberValue = Number(o.checkValue);\r\n                n.compareFlag = o.type;\r\n                c = n;\r\n            } else if (parm.type == AniParmType.Trigger) {\r\n                let t = new AnimatorStateTriggerCondition(parm.name);\r\n                c = t;\r\n            }\r\n            ato.addCondition(c);\r\n        }\r\n    }\r\n}","/**\r\n * @internal\r\n */\r\nexport class BatchMark {\r\n\t/**@internal */\r\n\tupdateMark: number = -1;\r\n\t/**@internal */\r\n\tindexInList: number = -1;\r\n\t/**@internal */\r\n\tbatched: boolean = false;\r\n}\r\n\r\n","import { BatchMark } from \"../../core/render/BatchMark\";\r\nimport { RenderElement } from \"../../core/render/RenderElement\";\r\n/**\r\n * @internal\r\n */\r\nexport class InstanceBatchManager {\r\n    /** @internal */\r\n    static instance = new InstanceBatchManager();\r\n    /**@internal */\r\n    private _instanceBatchOpaqueMarks: any[] = [];\r\n    /**@internal []*/\r\n    updateCountMark: number = 0;\r\n    constructor() {\r\n    }\r\n\r\n    /**\r\n     * get batch index\r\n     */\r\n    private _getData<T>(key: boolean | number, data: any, cls?: new () => T): T {\r\n        if (null == cls) {\r\n            cls = Array as any;\r\n        }\r\n        if (\"boolean\" == typeof key) {\r\n            return (data[key ? 0 : 1]) || (data[key ? 0 : 1] = new cls());\r\n        } else {\r\n            return data[key] || (data[key] = new cls());\r\n        }\r\n    }\r\n\r\n    // /**\r\n    //  * get batchMark by render property\r\n    //  * @param receiveShadow \r\n    //  * @param materialID \r\n    //  * @param subMeshID \r\n    //  * @param invertFace \r\n    //  * @param lightmapIndex \r\n    //  * @returns \r\n    //  */\r\n    // getInstanceBatchOpaquaMark(receiveShadow: boolean, materialID: number, subMeshID: number, invertFace: boolean, reflectionprob: number, lightmapIndex: number): BatchMark {\r\n    //     var data = this._getData(receiveShadow, this._instanceBatchOpaqueMarks);\r\n    //     data = this._getData(materialID, data);\r\n    //     data = this._getData(subMeshID, data);\r\n    //     data = this._getData(invertFace, data);\r\n    //     data = this._getData(lightmapIndex, data);\r\n    //     return this._getData(reflectionprob, data, BatchMark);\r\n    // }\r\n\r\n    getInstanceBatchOpaquaMark(element: RenderElement): BatchMark {\r\n        //transID\r\n        let invertFrontFace = element._transform && element._transform._isFrontFaceInvert ? 1 : 0;\r\n        let receiveShadow = element._baseRender._receiveShadow ? 1 : 0;\r\n        let matID_geometry = (element._material._id << 17) + (element._geometry._id << 2) | (invertFrontFace << 1) | (receiveShadow);\r\n        //gi id\r\n        let reflectid = (element._baseRender._probReflection ? element._baseRender._probReflection._reflectionProbeID : -1) + 1;\r\n        let lightmapid = (element._baseRender.lightmapIndex) + 1;\r\n        let lightprobid = (element._baseRender._lightProb ? element._baseRender._lightProb._volumetricProbeID : -1) + 1;\r\n        let giID = (reflectid << 10) | (lightmapid << 20) | lightprobid;\r\n        //get Mark\r\n        var data = this._getData(matID_geometry, this._instanceBatchOpaqueMarks);\r\n        return this._getData(giID, data, BatchMark);\r\n\r\n\r\n\r\n    }\r\n}","import { Vector3 } from \"../../../../maths/Vector3\";\r\nimport { SingletonList } from \"../../../../utils/SingletonList\";\r\nimport { Camera } from \"../../../core/Camera\";\r\nimport { BaseRender, RenderBitFlag } from \"../../../core/render/BaseRender\";\r\nimport { InstanceRenderElement } from \"../../../core/render/InstanceRenderElement\";\r\nimport { Scene3D } from \"../../../core/scene/Scene3D\";\r\nconst tempVec = new Vector3();\r\nconst tempVec1 = new Vector3();\r\n/**\r\n * \r\n */\r\nexport class BatchRender extends BaseRender {\r\n    /**@internal */\r\n    protected _checkLOD: boolean;\r\n    protected _lodCount: number;\r\n    protected _lodRateArray: number[];\r\n    protected _batchList: SingletonList<BaseRender>;\r\n    protected _batchbit: RenderBitFlag;\r\n    protected _RenderBitFlag: RenderBitFlag;\r\n    protected _lodInstanceRenderElement: { [key: number]: InstanceRenderElement[] } = {};\r\n    protected _lodsize: number;\r\n    private _cacheLod: number;\r\n\r\n    /**\r\n     *  <code>BatchRender</code> \r\n     */\r\n    constructor() {\r\n        super();\r\n        this._RenderBitFlag = RenderBitFlag.RenderBitFlag_Batch;\r\n        this._renderElements = [];\r\n        this._lodInstanceRenderElement[-1] = [];\r\n        this._batchList = new SingletonList<BaseRender>();\r\n    }\r\n\r\n    /**\r\n     * lod\r\n     */\r\n    get checkLOD() {\r\n        return this._checkLOD;\r\n    }\r\n\r\n    set checkLOD(value: boolean) {\r\n        this._checkLOD = value;\r\n    }\r\n\r\n    /**\r\n     * lod\r\n     */\r\n    set lodCullRateArray(value: number[]) {\r\n        if (!this._checkLOD) {\r\n            return;\r\n        }\r\n        value.sort((a, b) => b - a);\r\n        this._lodRateArray = value;\r\n    }\r\n\r\n    get lodCullRateArray() {\r\n        return this._lodRateArray;\r\n    }\r\n\r\n\r\n    /**\r\n     * Overrid it\r\n     *  batch\r\n     */\r\n    protected _canBatch(render: BaseRender): boolean {\r\n        if (render._batchRender) {\r\n            return false;\r\n        }\r\n        return false;\r\n    }\r\n\r\n    protected _onEnable(): void {\r\n        super._onEnable();\r\n        if (this._batchList) {\r\n            for (let i = 0, n = this._batchList.length; i < n; i++) {\r\n                this._batchList.elements[i].setRenderbitFlag(this._RenderBitFlag, true);\r\n            }\r\n        }\r\n    }\r\n\r\n    protected _onDisable(): void {\r\n        super._onDisable();\r\n        if (this._batchList) {\r\n            for (let i = 0, n = this._batchList.length; i < n; i++) {\r\n                this._batchList.elements[i].setRenderbitFlag(this._RenderBitFlag, false);\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * lod\r\n     */\r\n    protected _changeLOD(lod: number) {\r\n        if (this._cacheLod == lod) {\r\n            return;\r\n        }\r\n\r\n        if(this._cacheLod == this.lodCullRateArray.length - 1)\r\n        {\r\n            lod = -1;\r\n        }\r\n        \r\n        this._renderElements = this._lodInstanceRenderElement[lod];\r\n        if (this._lodInstanceRenderElement[lod] && lod != -1) {\r\n            this._renderElements || (this._renderElements = []);\r\n            this._renderElements = this._renderElements.concat(this._lodInstanceRenderElement[-1]);\r\n        } else {\r\n            this._renderElements = this._lodInstanceRenderElement[-1];\r\n        }\r\n\r\n    }\r\n\r\n    onPreRender() {\r\n        if (!this.checkLOD || !this._lodRateArray || this._lodRateArray.length < 1) {\r\n            this._changeLOD(0);\r\n        } else {\r\n            let checkCamera = (this.owner.scene as Scene3D).cullInfoCamera as Camera;\r\n            let maxYDistance = checkCamera.maxlocalYDistance;\r\n            Vector3.subtract(this._bounds.getCenter(), checkCamera.transform.position, tempVec);\r\n            //farplane,.lod\r\n            let length = tempVec.length();\r\n            let rateYDistance = length / checkCamera.farPlane * maxYDistance;\r\n            let rate = (this._lodsize / rateYDistance);\r\n            for (let i = 0; i < this._lodRateArray.length; i++) {\r\n                if (rate < this._lodRateArray[i])\r\n                    continue;\r\n                this._changeLOD(i);\r\n                break;\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * @param render \r\n     */\r\n    _batchOneRender(render: BaseRender): boolean {\r\n        //TODO\r\n        return false\r\n    }\r\n\r\n    /**\r\n     * @param render \r\n     */\r\n    _removeOneRender(render: BaseRender) {\r\n        //TODO\r\n    }\r\n\r\n    /**\r\n     * @param render \r\n     */\r\n    _updateOneRender(render: BaseRender) {\r\n        //TODO\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @param renderNodes \r\n     */\r\n    addList(renderNode: BaseRender[]) {\r\n        for (var i = 0, n = renderNode.length; i < n; i++) {\r\n            let baseRender = renderNode[i];\r\n            if (this._canBatch(baseRender)) {\r\n                this._batchList.add(baseRender);\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * _batchList\r\n     */\r\n    reBatch() {\r\n        let renderNums = this._batchList.length;\r\n        let renders = this._batchList.elements;\r\n        for (var i = 0; i < renderNums; i++) {\r\n            let render = renders[i];\r\n            this._batchOneRender(render);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Restoring the Batch Render State\r\n     */\r\n    _restorRenderNode() {\r\n        for (let i = 0, n = this._batchList.length; i < n; i++) {\r\n            this._removeOneRender(this._batchList.elements[i]);\r\n        }\r\n    }\r\n\r\n    _clear() {\r\n        this._restorRenderNode();\r\n        this._renderElements = [];\r\n        this._batchList.destroy();\r\n        this._batchList = new SingletonList<BaseRender>();\r\n        this._lodInstanceRenderElement = {};\r\n        this._lodInstanceRenderElement[-1] = [];\r\n\r\n    }\r\n}","import { SingletonList } from \"../../../../utils/SingletonList\";\r\nimport { BaseRender, RenderBitFlag } from \"../../../core/render/BaseRender\";\r\nimport { BatchMark } from \"../../../core/render/BatchMark\";\r\nimport { InstanceRenderElement } from \"../../../core/render/InstanceRenderElement\";\r\nimport { RenderElement } from \"../../../core/render/RenderElement\";\r\nimport { InstanceBatchManager } from \"../../../graphics/Batch/InstanceBatchManager\";\r\nimport { MeshInstanceGeometry } from \"../../../graphics/MeshInstanceGeometry\";\r\nimport { Bounds } from \"../../../math/Bounds\";\r\nimport { SubMesh } from \"../../../resource/models/SubMesh\";\r\nimport { BatchRender } from \"./BatchRender\";\r\n\r\n/**\r\n * <code>StaticInstanceBatchRender</code> \r\n */\r\nexport class StaticInstanceBatchRender extends BatchRender {\r\n\r\n    /**@internal instanceBatchManager*/\r\n    private _batchManager: InstanceBatchManager;\r\n\r\n    /**@internal  BatchMaskInstance*/\r\n    private _insBatchMarksNums: number[] = [];\r\n\r\n    /**@interal */\r\n    private _insElementMarksArray: InstanceRenderElement[] = [];\r\n\r\n    /**@interal batch rule:Batch min count*/\r\n    private _instanceBatchminNums: number = 10;\r\n\r\n    /**@interal cache udpate element*/\r\n    private _updateChangeElement: InstanceRenderElement[] = [];\r\n\r\n    /**\r\n     *  <code>StaticInstanceBatchRender</code> \r\n     */\r\n    constructor() {\r\n        super();\r\n        this.checkLOD = true;\r\n        this._batchManager = new InstanceBatchManager();\r\n        this._RenderBitFlag = RenderBitFlag.RenderBitFlag_InstanceBatch;\r\n    }\r\n\r\n    /**\r\n     * RenderInstanceBatch\r\n     * @param render \r\n     * @returns \r\n     */\r\n    private _isRenderNodeAllCanInstanceBatch(render: BaseRender): boolean {\r\n        let elements = render._renderElements;\r\n        for (var i = 0, n = elements.length; i < n; i++) {\r\n            let element = elements[i];\r\n            if (!element.material._shader._enableInstancing) {\r\n                return false;\r\n            }\r\n        }\r\n        return true;\r\n    }\r\n\r\n    /**\r\n     * Instance\r\n     * @param render \r\n     */\r\n    private _sumInstanceBatch(render: BaseRender) {\r\n        let elements = render._renderElements;\r\n        for (var i = 0, n = elements.length; i < n; i++) {\r\n            let element = elements[i];\r\n            var insBatchMarks = this._batchManager.getInstanceBatchOpaquaMark(element);\r\n            if (insBatchMarks.indexInList == -1) {\r\n                insBatchMarks.indexInList = this._insBatchMarksNums.length;\r\n                this._insBatchMarksNums.push(0);\r\n            }\r\n            this._insBatchMarksNums[insBatchMarks.indexInList] += 1;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * batch one element\r\n     * @param element \r\n     * @param render \r\n     * @returns \r\n     */\r\n    private _batchOneElement(element: RenderElement, render: BaseRender) {\r\n        var insBatchMarks = this._batchManager.getInstanceBatchOpaquaMark(element);\r\n        if (insBatchMarks.indexInList == -1)\r\n            return;\r\n        let instanceelement: InstanceRenderElement = this._insElementMarksArray[insBatchMarks.indexInList];\r\n        if (!instanceelement) {\r\n            instanceelement = this._createInstanceElement(element, render, insBatchMarks);\r\n        }\r\n        let list = instanceelement._instanceBatchElementList;\r\n        if (list.length == InstanceRenderElement.maxInstanceCount) {\r\n            this._insBatchMarksNums.push(this._insBatchMarksNums[insBatchMarks.indexInList]);\r\n            insBatchMarks.indexInList = this._insBatchMarksNums.length - 1;\r\n            instanceelement = this._createInstanceElement(element, render, insBatchMarks);\r\n            list = instanceelement._instanceBatchElementList;\r\n        }\r\n        if (list.indexof(element) == -1) {\r\n            list.add(element);\r\n            instanceelement._isUpdataData = true;\r\n            (this._updateChangeElement.indexOf(instanceelement) == -1) && this._updateChangeElement.push(instanceelement);\r\n            element._batchElement = instanceelement;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * remove one element\r\n     * @param element \r\n     * @param render \r\n     * @returns \r\n     */\r\n    private _removeOneElement(element: RenderElement, render: BaseRender) {\r\n        var insBatchMarks = this._batchManager.getInstanceBatchOpaquaMark(element);\r\n        if (insBatchMarks.indexInList == -1)\r\n            return;\r\n        let instanceelement: InstanceRenderElement = element._batchElement as InstanceRenderElement;\r\n        if (!instanceelement || this._renderElements.indexOf(instanceelement) == -1) {\r\n            return;\r\n        }\r\n        let list = instanceelement._instanceBatchElementList;\r\n        if (list.indexof(element) != -1) {\r\n            list.remove(element);\r\n            instanceelement._isUpdataData = true;\r\n            (this._updateChangeElement.indexOf(instanceelement) == -1) && this._updateChangeElement.push(instanceelement);\r\n            element._batchElement = null;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * update one element\r\n     * @param element \r\n     * @param render \r\n     * @returns \r\n     */\r\n    private _updateOneElement(element: RenderElement, render: BaseRender) {\r\n        let instanceelement: InstanceRenderElement = element._batchElement as InstanceRenderElement;\r\n        if (!instanceelement || this._renderElements.indexOf(instanceelement) == -1) {\r\n            return;\r\n        }\r\n        let list = instanceelement._instanceBatchElementList;\r\n        if (list.indexof(element) != -1) {\r\n            instanceelement._isUpdataData = true;\r\n            (this._updateChangeElement.indexOf(instanceelement) == -1) && this._updateChangeElement.push(instanceelement);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * create instanceElement\r\n     * @param element \r\n     * @param render \r\n     * @param batchMark \r\n     * @returns \r\n     */\r\n    private _createInstanceElement(element: RenderElement, render: BaseRender, batchMark: BatchMark) {\r\n        let instanceRenderElement = new InstanceRenderElement();\r\n        instanceRenderElement.render = render;\r\n        instanceRenderElement.renderType = RenderElement.RENDERTYPE_INSTANCEBATCH;\r\n        //Geometry updaste\r\n        (instanceRenderElement._geometry as MeshInstanceGeometry).subMesh = (element._geometry as SubMesh);\r\n        instanceRenderElement.material = element.material;\r\n        instanceRenderElement.setTransform(null);\r\n        instanceRenderElement.renderSubShader = element.renderSubShader;\r\n        let list = instanceRenderElement._instanceBatchElementList;\r\n        list.length = 0;\r\n        list.add(element);\r\n        this._insElementMarksArray[batchMark.indexInList] = instanceRenderElement;\r\n        batchMark.batched = true;\r\n        if (!this._lodInstanceRenderElement[render._LOD]) {\r\n            this._lodInstanceRenderElement[render._LOD] = [];\r\n        }\r\n        this._lodInstanceRenderElement[render._LOD].push(instanceRenderElement);\r\n        return instanceRenderElement;\r\n    }\r\n\r\n    /**\r\n     * batch\r\n     * @override\r\n     * @param render \r\n     * @returns \r\n     */\r\n    protected _canBatch(render: BaseRender): boolean {\r\n        let elements = render._renderElements;\r\n        for (var i = 0, n = elements.length; i < n; i++) {\r\n            let element = elements[i];\r\n            var insBatchMarks = this._batchManager.getInstanceBatchOpaquaMark(element);\r\n            if (this._insBatchMarksNums[insBatchMarks.indexInList] < this._instanceBatchminNums || element.material.renderQueue >= 3000) {\r\n                return false;\r\n            }\r\n        }\r\n        return true;\r\n    }\r\n\r\n    /**\r\n     * @override\r\n     * @internal\r\n     * \r\n     */\r\n    protected _calculateBoundingBox() {\r\n        let bound = this._bounds;\r\n        for (let i = 0, n = this._batchList.length; i < n; i++) {\r\n            if (i == 0) {\r\n                this._batchList.elements[i].bounds.cloneTo(bound);\r\n            } else {\r\n                Bounds.merge(bound, this._batchList.elements[i].bounds, bound);\r\n            }\r\n        }\r\n        let extend = this._bounds.getExtent();\r\n        this._lodsize = 2 * Math.max(extend.x, extend.y, extend.z);\r\n        return this._bounds;\r\n    }\r\n\r\n    /**\r\n     * destroy\r\n     */\r\n    protected _onDestroy() {\r\n        super._onDestroy();\r\n    }\r\n\r\n    /**\r\n     * render\r\n     * @param render \r\n     * @internal\r\n     * @returns \r\n     */\r\n    _batchOneRender(render: BaseRender) {\r\n        if (!this._canBatch(render)) return false;\r\n        this.boundsChange = true;\r\n        let elements = render._renderElements;\r\n        for (let i = 0, n = elements.length; i < n; i++) {\r\n            let renderelement = elements[i];\r\n            this._batchOneElement(renderelement, render);\r\n        }\r\n        render._batchRender = this;\r\n        render.setRenderbitFlag(RenderBitFlag.RenderBitFlag_InstanceBatch, true);\r\n        return true;\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @Override\r\n     * @internal\r\n     * @param render \r\n     * @returns \r\n     */\r\n    _removeOneRender(render: BaseRender) {\r\n        if (!this._canBatch(render)) return;\r\n        if (this._batchList.indexof(render) != -1) {\r\n            this.boundsChange = true;\r\n            let elements = render._renderElements;\r\n            for (let i = 0, n = elements.length; i < n; i++) {\r\n                let renderelement = elements[i];\r\n                this._removeOneElement(renderelement, render);\r\n            }\r\n            render._batchRender = null;\r\n            render.setRenderbitFlag(RenderBitFlag.RenderBitFlag_InstanceBatch, false);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @override\r\n     * @internal\r\n     * @param render \r\n     * @returns \r\n     */\r\n    _updateOneRender(render: BaseRender) {\r\n        if (!this._canBatch(render)) return;\r\n        if (this._batchList.indexof(render) != -1) {\r\n            this.boundsChange = true;\r\n            let elements = render._renderElements;\r\n            for (let i = 0, n = elements.length; i < n; i++) {\r\n                let renderelement = elements[i];\r\n                this._updateOneElement(renderelement, render);\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     * \r\n     */\r\n    _clear() {\r\n        super._clear();\r\n        this._insElementMarksArray.forEach(element => {\r\n            element && element.destroy();\r\n        });\r\n\r\n        this._insElementMarksArray = [];\r\n        this._updateChangeElement = [];\r\n        this._insBatchMarksNums = [];\r\n    }\r\n\r\n\r\n\r\n    /**\r\n    * \r\n    * @param renderNodes\r\n    */\r\n    addList(renderNodes: BaseRender[]) {\r\n        if (!this._batchList) {\r\n            this._batchList = new SingletonList<BaseRender>();\r\n        }\r\n        let renders: BaseRender[] = [];\r\n        for (var i = 0; i < renderNodes.length; i++) {\r\n            let baseRender = renderNodes[i];\r\n            if (baseRender._batchRender) {\r\n                continue;\r\n            }\r\n            if (this._isRenderNodeAllCanInstanceBatch(baseRender)) {\r\n                // this._batchList.add(baseRender);\r\n                renders.push(baseRender);\r\n                this._sumInstanceBatch(baseRender);\r\n            }\r\n        }\r\n        for (var i = 0, n = renders.length; i < n; i++) {\r\n            let baseRender = renders[i];\r\n            if (this._canBatch(baseRender)) {\r\n                this._batchList.add(baseRender);\r\n            }\r\n        }\r\n    }\r\n    /**\r\n     * _batchList\r\n     */\r\n    reBatch() {\r\n        let renderNums = this._batchList.length;\r\n        let renders = this._batchList.elements;\r\n        for (var i = 0; i < renderNums; i++) {\r\n            let render = renders[i];\r\n            this._batchOneRender(render);\r\n        }\r\n    }\r\n\r\n}","import { BaseRender } from \"../../../core/render/BaseRender\";\r\nimport { BatchRender } from \"./BatchRender\";\r\n\r\nexport class StatiVertexMergeBatchRender extends BatchRender {\r\n    \r\n    //TODO \r\n    _addList(renderNodes: BaseRender[]) {\r\n        //TODO  add list\r\n    }\r\n}","import { SingletonList } from \"../../../../utils/SingletonList\";\r\nimport { BaseRender } from \"../../../core/render/BaseRender\";\r\nimport { Sprite3D, StaticFlag } from \"../../../core/Sprite3D\";\r\nimport { Volume } from \"../Volume\";\r\nimport { BatchRender } from \"./BatchRender\";\r\nimport { StaticInstanceBatchRender } from \"./StaticInstanceBatchRender\";\r\nimport { StatiVertexMergeBatchRender } from \"./StatiVertexMergeBatchRender\";\r\n\r\n/**\r\n * \r\n */\r\nexport class StaticBatchVolume extends Volume {\r\n\r\n    /**@internal */\r\n    private _cacheRender: SingletonList<BaseRender>;\r\n\r\n    /**@internal BaseRender */\r\n    private _batchRender: SingletonList<BaseRender>;\r\n\r\n    /**@internal LOD */\r\n    private _checkLOD: boolean;//LOD\r\n\r\n    /** StaticInstanceBatch */\r\n    /**@internal Instance */\r\n    private _enableStaticInstanceBatch: boolean;\r\n\r\n    /**@internal Instance */\r\n    private _instanceBatchRender: StaticInstanceBatchRender;\r\n\r\n    /**StaticVertexMergeBatch */\r\n    /**@internal  TODO */\r\n    private _enableStaticVertexMergeBatch: boolean;\r\n\r\n    /**@internal   TODO*/\r\n    private _vertexMergeBatchRender: StatiVertexMergeBatchRender;\r\n\r\n    /**@internal CustomBatchbatch*/\r\n    private _enableCustomBatch: boolean;\r\n\r\n    /**@internal */\r\n    private _customBatchs: BatchRender[] = [];\r\n\r\n    /**\r\n     * @internal\r\n     * @returns \r\n     */\r\n    private _getStaticInstanceBatchRender(): StaticInstanceBatchRender {\r\n        let render = (this.owner as Sprite3D).getComponent(StaticInstanceBatchRender);\r\n        if (!render) {\r\n            render = (this.owner as Sprite3D).addComponent(StaticInstanceBatchRender) as StaticInstanceBatchRender;\r\n        }\r\n        return render;\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     * @returns \r\n     */\r\n    private _getStatiVertexMergeBatchRender(): StatiVertexMergeBatchRender {\r\n        let render = (this.owner as Sprite3D).getComponent(StatiVertexMergeBatchRender);\r\n        if (!render) {\r\n            render = (this.owner as Sprite3D).addComponent(StatiVertexMergeBatchRender) as StatiVertexMergeBatchRender;\r\n        }\r\n        return render;\r\n    }\r\n\r\n    /**\r\n     * LOD\r\n     */\r\n    get checkLOD(): boolean {\r\n        return this._checkLOD;\r\n    }\r\n\r\n    set checkLOD(value: boolean) {\r\n        this._checkLOD = value;\r\n        if (this._enableStaticInstanceBatch) {\r\n            this._instanceBatchRender.checkLOD = value;\r\n        }\r\n        if (this._enableStaticVertexMergeBatch) {\r\n            this._vertexMergeBatchRender.checkLOD = value;\r\n        }\r\n        if (this._enableCustomBatch) {\r\n            this._customBatchs.forEach(element => {\r\n                element.checkLOD = value;\r\n            });\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Instance\r\n     */\r\n    get enableStaticInstanceBatchRender(): boolean {\r\n        return this._enableStaticInstanceBatch;\r\n    }\r\n\r\n    set enableStaticInstanceBatchRender(value: boolean) {\r\n        if (!this._instanceBatchRender && value) {\r\n            this._instanceBatchRender = this._getStaticInstanceBatchRender();\r\n        }\r\n        if (value == this._enableStaticInstanceBatch)\r\n            return;\r\n        if (value) {\r\n            this._instanceBatchRender.enabled = true;\r\n        } else {\r\n            this._instanceBatchRender.enabled = false;\r\n        }\r\n        this._enableStaticInstanceBatch = value;\r\n    }\r\n\r\n    /**\r\n     * \r\n     */\r\n    get enableMergeBatchRender() {\r\n        return this._enableStaticVertexMergeBatch;\r\n    }\r\n\r\n    set enableMergeBatchRender(value: boolean) {\r\n        if (!this._vertexMergeBatchRender && value) {\r\n            this._vertexMergeBatchRender = this._getStatiVertexMergeBatchRender();\r\n        }\r\n        if (value == this._enableStaticVertexMergeBatch)\r\n            return;\r\n        if (value) {\r\n            this._vertexMergeBatchRender.enabled = true;\r\n        } else {\r\n            this._vertexMergeBatchRender.enabled = false;\r\n        }\r\n        this._enableStaticVertexMergeBatch = value;\r\n    }\r\n\r\n    /**\r\n     * \r\n     */\r\n    get enableCustomBatchRender() {\r\n        return this._enableCustomBatch;\r\n    }\r\n\r\n    set enableCustomBatchRender(value: boolean) {\r\n        this._enableCustomBatch = value;\r\n        this._customBatchs.forEach(element => {\r\n            element.enabled = value;\r\n        });\r\n    }\r\n\r\n    /**\r\n     * BatchRender\r\n     */\r\n    set customBatchRenders(value: BatchRender[]) {\r\n        if (this._customBatchs) {\r\n            this._customBatchs.forEach(element => {\r\n                (this.owner as Sprite3D)._destroyComponent(element);\r\n            });\r\n        }\r\n        this._customBatchs = value;\r\n        this._customBatchs.forEach(element => {\r\n            (this.owner as Sprite3D).addComponentInstance(element);\r\n        });\r\n        this.enableCustomBatchRender = this._enableCustomBatch;\r\n    }\r\n\r\n    get customBatchRenders() {\r\n        return this._customBatchs;\r\n    }\r\n\r\n    /**\r\n     * <code>BatchVolume</code>\r\n     */\r\n    constructor() {\r\n        super();\r\n        this.checkLOD = true;\r\n        this._enableStaticInstanceBatch = false;\r\n        this._enableStaticVertexMergeBatch = false;\r\n        this._cacheRender = new SingletonList<BaseRender>();\r\n        this._batchRender = new SingletonList<BaseRender>();\r\n        this._enableCustomBatch = false;\r\n    }\r\n\r\n    /**     \r\n     * Restoring the Batch Render State\r\n     */\r\n    private _restorRenderNode() {\r\n        if (this.enableCustomBatchRender) {\r\n            this._customBatchs.forEach(element => {\r\n                element._clear();\r\n            });\r\n        }\r\n        if (this._enableStaticInstanceBatch) {\r\n            this._instanceBatchRender._clear();\r\n        }\r\n        if (this.enableCustomBatchRender) {\r\n            this._vertexMergeBatchRender._clear();\r\n        }\r\n    }\r\n\r\n    /**\r\n     * add one RenderNode\r\n     * @param renderNode \r\n     * @returns \r\n     */\r\n    private __addRenderNodeToBatch(renderNode: BaseRender) {\r\n        //\r\n        if (this.enableCustomBatchRender) {\r\n            this._customBatchs.forEach(element => {\r\n                if (element._batchOneRender(renderNode)) return;\r\n            });\r\n        }\r\n        if (this._enableStaticInstanceBatch) {\r\n            if (this._instanceBatchRender._batchOneRender(renderNode)) return;\r\n        }\r\n        if (this.enableCustomBatchRender) {\r\n            if (this._vertexMergeBatchRender._batchOneRender(renderNode)) return;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * remove one RenderNode\r\n     * @param renderNode \r\n     */\r\n    private __removeRenderNodeFromBatch(renderNode: BaseRender) {\r\n        //\r\n        renderNode._batchRender._removeOneRender(renderNode);\r\n    }\r\n\r\n    /**\r\n     * @inheritDoc\r\n     * @override\r\n     */\r\n    protected _onEnable(): void {\r\n        super._onEnable();\r\n        if (this._enableStaticInstanceBatch)\r\n            this._instanceBatchRender && (this._instanceBatchRender.enabled = true);\r\n        if (this._enableStaticVertexMergeBatch)\r\n            this._vertexMergeBatchRender && (this._vertexMergeBatchRender.enabled = true);\r\n        if (this.enableCustomBatchRender) {\r\n            this._customBatchs.forEach(element => {\r\n                element.enabled = true;\r\n            });\r\n        }\r\n    }\r\n\r\n    /**\r\n     * @inheritDoc\r\n     * @override\r\n     */\r\n    protected _onDisable(): void {\r\n        super._onDisable();\r\n        if (this._enableStaticInstanceBatch)\r\n            this._instanceBatchRender && (this._instanceBatchRender.enabled = false);\r\n        if (this._enableStaticVertexMergeBatch)\r\n            this._vertexMergeBatchRender && (this._vertexMergeBatchRender.enabled = false);\r\n        if (this.enableCustomBatchRender) {\r\n            this._customBatchs.forEach(element => {\r\n                element.enabled = false;\r\n            });\r\n        }\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @internal\r\n     * @override\r\n     * @param renderNode \r\n     */\r\n    _addRenderNode?(renderNode: BaseRender): void {\r\n        if (renderNode.renderNode.staticMask == StaticFlag.StaticBatch) {\r\n            if (this._cacheRender.indexof(renderNode) != -1) {\r\n                return;\r\n            }\r\n            this._cacheRender.add(renderNode);\r\n            if (this._batchRender.length > 0) {//if batch exited\r\n                this.__addRenderNodeToBatch(renderNode);\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @internal\r\n     * @override\r\n     * @param renderNode    \r\n     */\r\n    _removeRenderNode(renderNode: BaseRender): void {\r\n        if (renderNode.renderNode.staticMask == StaticFlag.StaticBatch) {\r\n            if (this._batchRender.indexof(renderNode) != -1) {\r\n                this.__removeRenderNodeFromBatch(renderNode);\r\n                this._batchRender.remove(renderNode);\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     * Volume change\r\n     */\r\n    _VolumeChange() {\r\n        super._VolumeChange();\r\n        this._cacheRender.clear();\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    onStart() {\r\n        this.reBatch();\r\n    }\r\n\r\n    /**\r\n     * ,\r\n     * ,Volume,\r\n     */\r\n    reBatch() {\r\n        this._cacheRender.elements.length = this._cacheRender.length;\r\n        this._batchRender.clear();\r\n        this._restorRenderNode();\r\n        if (this.enableCustomBatchRender) {\r\n            this._customBatchs.forEach(element => {\r\n                element.addList(this._cacheRender.elements);\r\n                element.reBatch();\r\n            });\r\n        }\r\n        if (this._enableStaticInstanceBatch) {\r\n            this._instanceBatchRender.addList(this._cacheRender.elements);\r\n            this._instanceBatchRender.reBatch();\r\n        }\r\n        if (this.enableCustomBatchRender) {\r\n            this._vertexMergeBatchRender.addList(this._cacheRender.elements);\r\n            this._vertexMergeBatchRender.reBatch();\r\n        }\r\n        //UpdateBatch Render\r\n        for (var i = 0, n = this._cacheRender.length; i < n; i++) {\r\n            (this._cacheRender.elements[i]._batchRender) && this._batchRender.add(this._cacheRender.elements[i]);\r\n        }\r\n    }\r\n}","import { Matrix4x4 } from \"../../../maths/Matrix4x4\";\r\nimport { Vector2 } from \"../../../maths/Vector2\";\r\nimport { Vector3 } from \"../../../maths/Vector3\";\r\nimport { BufferUsage } from \"../../../RenderEngine/RenderEnum/BufferTargetType\";\r\nimport { DrawType } from \"../../../RenderEngine/RenderEnum/DrawType\";\r\nimport { IndexFormat } from \"../../../RenderEngine/RenderEnum/IndexFormat\";\r\nimport { MeshTopology } from \"../../../RenderEngine/RenderEnum/RenderPologyMode\";\r\nimport { VertexMesh } from \"../../../RenderEngine/RenderShader/VertexMesh\";\r\nimport { VertexDeclaration } from \"../../../RenderEngine/VertexDeclaration\";\r\nimport { BufferState } from \"../../../webgl/utils/BufferState\";\r\nimport { IndexBuffer3D } from \"../../graphics/IndexBuffer3D\";\r\nimport { VertexBuffer3D } from \"../../graphics/VertexBuffer3D\";\r\nimport { Bounds } from \"../../math/Bounds\";\r\nimport { Laya3DRender } from \"../../RenderObjs/Laya3DRender\";\r\nimport { Utils3D } from \"../../utils/Utils3D\";\r\nimport { GeometryElement } from \"../GeometryElement\";\r\nimport { RenderContext3D } from \"../render/RenderContext3D\";\r\nimport { UI3D } from \"./UI3D\";\r\n\r\nexport class UI3DGeometry extends GeometryElement {\r\n    /**@internal */\r\n    private static tempV0: Vector3 = new Vector3();\r\n    /**@internal */\r\n    private static _type: number = GeometryElement._typeCounter++;\r\n    /* @internal buffer*/\r\n    private _vertexBuffer: VertexBuffer3D;\r\n    /* @internal */\r\n    private _vertex: Float32Array;\r\n    /**@internal indexbuffer */\r\n    private _indexBuffer: IndexBuffer3D;\r\n    /**@internal index */\r\n    private _index: Uint16Array;\r\n    /**@internal */\r\n    private _bound: Bounds;\r\n    /**@internal */\r\n    _positionArray: Vector3[];\r\n\r\n    /**@internal */\r\n    constructor(owner: UI3D) {\r\n        super(MeshTopology.Triangles, DrawType.DrawElement);\r\n        this._owner = owner;\r\n        //_segementCount\r\n        this.bufferState = new BufferState();\r\n        this._bound = new Bounds();\r\n        this._createBuffer();\r\n        this.indexFormat = IndexFormat.UInt16;\r\n    }\r\n\r\n    /**@internal */\r\n    get bounds() {\r\n        return this._bound;\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    private _createBuffer() {\r\n        var vertexDeclaration: VertexDeclaration = VertexMesh.getVertexDeclaration(\"POSITION,NORMAL,UV\");\r\n        var halfLong: number = 1 / 2;\r\n        var halfWidth: number = 1 / 2;\r\n        this._vertex = new Float32Array([-halfLong, halfWidth, 0, 0, 0, 1, 0, 0,\r\n            halfLong, halfWidth, 0, 0, 0, 1, 1, 0,\r\n        -halfLong, -halfWidth, 0, 0, 0, 1, 0, 1,\r\n            halfLong, -halfWidth, 0, 0, 0, 1, 1, 1]);\r\n        this._index = new Uint16Array([0, 1, 2, 3, 2, 1]);\r\n        //VB\r\n        this._vertexBuffer = Laya3DRender.renderOBJCreate.createVertexBuffer3D(this._vertex.length * 4, BufferUsage.Dynamic, false);\r\n        this._vertexBuffer.vertexDeclaration = vertexDeclaration;\r\n        this._vertexBuffer.setData(this._vertex.buffer);\r\n        //IB\r\n        this._indexBuffer = Laya3DRender.renderOBJCreate.createIndexBuffer3D(IndexFormat.UInt16, this._index.length, BufferUsage.Static, false);\r\n        this._indexBuffer.setData(this._index);\r\n        //VAO\r\n        this.bufferState = new BufferState();\r\n        this.bufferState.applyState([this._vertexBuffer], this._indexBuffer);\r\n        this._bound.setExtent(new Vector3(halfLong, halfWidth, halfLong));\r\n        this._bound.setCenter(new Vector3(0, 0, 0));\r\n        this._positionArray = [new Vector3(), new Vector3(), new Vector3(), new Vector3()];\r\n        this._positionArray[0].set(-halfWidth, halfLong, 0.0);\r\n        this._positionArray[1].set(halfWidth, halfLong, 0.0);\r\n        this._positionArray[2].set(-halfWidth, -halfLong, 0.0);\r\n        this._positionArray[3].set(halfWidth, -halfLong, 0.0);\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     * reset view vertex data\r\n     */\r\n    _resizeViewVertexData(size: Vector2, cameraDir: Vector3, cameraUp: Vector3, viewMode: boolean, worldPos: Vector3): void {\r\n        var halfwidth = size.x / 2;\r\n        var halfhight = size.y / 2;\r\n        if (viewMode) {\r\n            UI3DGeometry.tempV0.set(-halfwidth, halfhight, 0.0);\r\n            Utils3D.billboardTrans(UI3DGeometry.tempV0, cameraDir, cameraUp, this._positionArray[0]);\r\n            UI3DGeometry.tempV0.set(halfwidth, halfhight, 0.0);\r\n            Utils3D.billboardTrans(UI3DGeometry.tempV0, cameraDir, cameraUp, this._positionArray[1]);\r\n            UI3DGeometry.tempV0.set(-halfwidth, -halfhight, 0.0);\r\n            Utils3D.billboardTrans(UI3DGeometry.tempV0, cameraDir, cameraUp, this._positionArray[2]);\r\n            UI3DGeometry.tempV0.set(halfwidth, -halfhight, 0.0);\r\n            Utils3D.billboardTrans(UI3DGeometry.tempV0, cameraDir, cameraUp, this._positionArray[3]);\r\n            this._vertex[3] = this._vertex[11] = this._vertex[19] = this._vertex[27] = -cameraDir.x;\r\n            this._vertex[4] = this._vertex[12] = this._vertex[20] = this._vertex[28] = -cameraDir.y;\r\n            this._vertex[5] = this._vertex[13] = this._vertex[21] = this._vertex[29] = -cameraDir.z;\r\n        } else {\r\n            this._positionArray[0].set(-halfwidth, halfhight, 0.0);\r\n            this._positionArray[1].set(halfwidth, halfhight, 0.0);\r\n            this._positionArray[2].set(-halfwidth, -halfhight, 0.0);\r\n            this._positionArray[3].set(halfwidth, -halfhight, 0.0);\r\n        }\r\n        Vector3.add(this._positionArray[0], worldPos, this._positionArray[0]);\r\n        Vector3.add(this._positionArray[1], worldPos, this._positionArray[1]);\r\n        Vector3.add(this._positionArray[2], worldPos, this._positionArray[2]);\r\n        Vector3.add(this._positionArray[3], worldPos, this._positionArray[3]);\r\n        this._changeVertex(size);\r\n    }\r\n\r\n\r\n    /**\r\n     * @internal\r\n     * reset view vertex data\r\n     */\r\n    _resizeVertexData(size: Vector2): void {\r\n        var halfwidth = size.x / 2;\r\n        var halfhight = size.y / 2;\r\n        // if (viewMode) {\r\n        //     UI3DGeometry.tempV0.set(-halfwidth, halfhight, 0.0);\r\n        //     Utils3D.billboardTrans(UI3DGeometry.tempV0, cameraDir, cameraUp, this._positionArray[0]);\r\n        //     UI3DGeometry.tempV0.set(halfwidth, halfhight, 0.0);\r\n        //     Utils3D.billboardTrans(UI3DGeometry.tempV0, cameraDir, cameraUp, this._positionArray[1]);\r\n        //     UI3DGeometry.tempV0.set(-halfwidth, -halfhight, 0.0);\r\n        //     Utils3D.billboardTrans(UI3DGeometry.tempV0, cameraDir, cameraUp, this._positionArray[2]);\r\n        //     UI3DGeometry.tempV0.set(halfwidth, -halfhight, 0.0);\r\n        //     Utils3D.billboardTrans(UI3DGeometry.tempV0, cameraDir, cameraUp, this._positionArray[3]);\r\n        //     this._vertex[3] = this._vertex[11] = this._vertex[19] = this._vertex[27] = -cameraDir.x;\r\n        //     this._vertex[4] = this._vertex[12] = this._vertex[20] = this._vertex[28] = -cameraDir.y;\r\n        //     this._vertex[5] = this._vertex[13] = this._vertex[21] = this._vertex[29] = -cameraDir.z;\r\n        // } else {\r\n        this._positionArray[0].set(-halfwidth, halfhight, 0.0);\r\n        this._positionArray[1].set(halfwidth, halfhight, 0.0);\r\n        this._positionArray[2].set(-halfwidth, -halfhight, 0.0);\r\n        this._positionArray[3].set(halfwidth, -halfhight, 0.0);\r\n        // }\r\n        // Vector3.add(this._positionArray[0], worldPos, this._positionArray[0]);\r\n        // Vector3.add(this._positionArray[1], worldPos, this._positionArray[1]);\r\n        // Vector3.add(this._positionArray[2], worldPos, this._positionArray[2]);\r\n        // Vector3.add(this._positionArray[3], worldPos, this._positionArray[3]);\r\n        this._changeVertex(size);\r\n    }\r\n\r\n\r\n    /**\r\n     * @internal\r\n     * reset vertex data\r\n     */\r\n    _resizeWorldVertexData(size: Vector2, worldMat: Matrix4x4) {\r\n        let applyMat = (v3: Vector3, mat: Matrix4x4) => {\r\n            Vector3.transformV3ToV3(v3, mat, v3);\r\n            return v3;\r\n        }\r\n        var halfwidth = size.x / 2;\r\n        var halfhight = size.y / 2;\r\n        this._positionArray[0].set(-halfwidth, halfhight, 0.0);\r\n        this._positionArray[1].set(halfwidth, halfhight, 0.0);\r\n        this._positionArray[2].set(-halfwidth, -halfhight, 0.0);\r\n        this._positionArray[3].set(halfwidth, -halfhight, 0.0);\r\n        applyMat(this._positionArray[0], worldMat);\r\n        applyMat(this._positionArray[1], worldMat);\r\n        applyMat(this._positionArray[2], worldMat);\r\n        applyMat(this._positionArray[3], worldMat);\r\n        this._changeVertex(size);\r\n    }\r\n\r\n    private _changeVertex(size: Vector2) {\r\n        this._vertex[0] = this._positionArray[0].x;\r\n        this._vertex[1] = this._positionArray[0].y;\r\n        this._vertex[2] = this._positionArray[0].z;\r\n        this._vertex[8] = this._positionArray[1].x;\r\n        this._vertex[9] = this._positionArray[1].y;\r\n        this._vertex[10] = this._positionArray[1].z;\r\n        this._vertex[16] = this._positionArray[2].x;\r\n        this._vertex[17] = this._positionArray[2].y;\r\n        this._vertex[18] = this._positionArray[2].z;\r\n        this._vertex[24] = this._positionArray[3].x;\r\n        this._vertex[25] = this._positionArray[3].y;\r\n        this._vertex[26] = this._positionArray[3].z;\r\n        this._vertexBuffer.setData(this._vertex.buffer, 0, 0, this._vertex.length * 4);\r\n        UI3DGeometry.tempV0.setValue(size.x / 2, size.y / 2, 0.0);\r\n        this._bound.setExtent(UI3DGeometry.tempV0);\r\n        let halfWidth = (this._positionArray[3].x - this._positionArray[2].x) / 2;\r\n        let halfHeight = (this._positionArray[0].y - this._positionArray[2].y) / 2;\r\n        UI3DGeometry.tempV0.setValue(this._positionArray[2].x + halfWidth, this._positionArray[2].y + halfHeight, this._positionArray[2].z);\r\n        this._bound.setCenter(UI3DGeometry.tempV0);\r\n    }\r\n\r\n    /**\r\n     * @inheritDoc\r\n     * @internal\r\n     * @override\r\n     */\r\n    _updateRenderParams(state: RenderContext3D): void {\r\n        this.clearRenderParams();\r\n        this.setDrawElemenParams(6, 0);\r\n    }\r\n    /**\r\n     * @inheritDoc\r\n     * @override\r\n     */\r\n    destroy() {\r\n        super.destroy();\r\n        this.bufferState.destroy();\r\n        this._vertexBuffer.destroy();\r\n        this._indexBuffer.destroy();\r\n        this.bufferState = null;\r\n        this._vertexBuffer = null;\r\n        this._indexBuffer = null;\r\n        delete this._vertex;\r\n        delete this._index;\r\n    }\r\n}","import { Sprite } from \"../../../display/Sprite\";\r\nimport { Matrix4x4 } from \"../../../maths/Matrix4x4\";\r\nimport { Vector2 } from \"../../../maths/Vector2\";\r\nimport { Vector3 } from \"../../../maths/Vector3\";\r\nimport { RenderTargetFormat } from \"../../../RenderEngine/RenderEnum/RenderTargetFormat\";\r\nimport { ShaderDataType } from \"../../../RenderEngine/RenderShader/ShaderData\";\r\nimport { BaseTexture } from \"../../../resource/BaseTexture\";\r\nimport { RenderTexture2D } from \"../../../resource/RenderTexture2D\";\r\nimport { Plane } from \"../../math/Plane\";\r\nimport { Ray } from \"../../math/Ray\";\r\nimport { Material, MaterialRenderMode } from \"../../../resource/Material\";\r\nimport { MeshSprite3DShaderDeclaration } from \"../MeshSprite3DShaderDeclaration\";\r\nimport { BaseRender } from \"../render/BaseRender\";\r\nimport { RenderContext3D } from \"../render/RenderContext3D\";\r\nimport { RenderElement } from \"../render/RenderElement\";\r\nimport { Scene3D } from \"../scene/Scene3D\";\r\nimport { Sprite3D } from \"../Sprite3D\";\r\nimport { Transform3D } from \"../Transform3D\";\r\nimport { UI3DGeometry } from \"./UI3DGeometry\";\r\nimport { Event } from \"../../../events/Event\";\r\nimport { UnlitMaterial } from \"../material/UnlitMaterial\";\r\nimport { Prefab } from \"../../../resource/HierarchyResource\";\r\nimport { InputManager } from \"../../../events/InputManager\";\r\nimport { NodeFlags } from \"../../../Const\";\r\nimport { ILaya } from \"../../../../ILaya\";\r\nimport { RenderState } from \"../../../RenderEngine/RenderShader/RenderState\";\r\nimport { LayaEnv } from \"../../../../LayaEnv\";\r\n\r\n/**\r\n * <code>BaseCamera</code> \r\n */\r\nexport class UI3D extends BaseRender {\r\n    /**@intrtnal */\r\n    static TempMatrix = new Matrix4x4();\r\n    /**@internal */\r\n    static temp0: Vector3 = new Vector3();\r\n    /**@internal */\r\n    static temp1: Vector3 = new Vector3();\r\n    /**@internal */\r\n    static temp2: Vector3 = new Vector3();\r\n    /**@internal */\r\n    static DEBUG: boolean = false;\r\n    //,2DUI3D \r\n    private _shellSprite: Sprite;\r\n    /**@internal UISprite*/\r\n    private _uisprite: Sprite;\r\n    /**@internal */\r\n    private _ui3DMat: Material;\r\n    /**@internal */\r\n    private _rendertexure2D: RenderTexture2D;\r\n    /**@internal */\r\n    private _geometry: UI3DGeometry;\r\n    /**@internal 2D*/\r\n    private _needUpdate: boolean;\r\n    /**@internal */\r\n    private _uiPlane: Plane;\r\n    /**@internal */\r\n    private _size: Vector2;\r\n    /**@internal */\r\n    private _sizeChange: boolean = true;\r\n    /**@internal */\r\n    private _resolutionRate: number;\r\n    /**@internal */\r\n    private _view: boolean = true;\r\n    /**@internal */\r\n    private _bindPropertyName: string = \"u_AlbedoTexture\";\r\n    /**@internal */\r\n    private _hit: boolean = false;\r\n    /**@internal */\r\n    private _prefab: Prefab;\r\n    /**@internal */\r\n    private _matrix: Matrix4x4;\r\n    /**@internal  */\r\n    private _scale: Vector3;\r\n    /**@internal */\r\n    static _ray: Ray = new Ray(new Vector3(), new Vector3());\r\n\r\n    /**\r\n     * 3DUI\r\n     */\r\n    set sprite(value: Sprite) {\r\n        if (value == this._uisprite)\r\n            return;\r\n        this._uisprite = value;\r\n        this._shellSprite.removeChildren(0, this._shellSprite.numChildren - 1);\r\n        if (value)\r\n            this._shellSprite.addChild(value);\r\n        this._resizeRT();\r\n        this.boundsChange = true;\r\n    }\r\n\r\n    get sprite() {\r\n        return this._uisprite;\r\n    }\r\n\r\n    /**\r\n     * IDE\r\n     * 3DUI\r\n     */\r\n    set prefab(value: Prefab) {\r\n        this._prefab = value;\r\n        if (value)\r\n            this.sprite = <Sprite>value.create();\r\n        else\r\n            this.sprite = null;\r\n    }\r\n\r\n    get prefab() {\r\n        return this._prefab;\r\n    }\r\n\r\n    /**\r\n     * UI3DmeshScale\r\n     */\r\n    set scale(value: Vector2) {\r\n        if (value.x <= 0 || value.y <= 0)\r\n            return;\r\n        value.cloneTo(this._size);\r\n        this._resizeRT();\r\n        this.boundsChange = true;\r\n        this._scale.setValue(value.x, value.y, 1);\r\n    }\r\n\r\n    get scale() {\r\n        return this._size;\r\n    }\r\n\r\n    /**\r\n     * UI\r\n     */\r\n    set renderMode(value: MaterialRenderMode) {\r\n        this.sharedMaterial.materialRenderMode = value;\r\n        this.boundsChange = true;\r\n    }\r\n\r\n\r\n    get renderMode(): MaterialRenderMode {\r\n        if (!this.sharedMaterial)\r\n            this.sharedMaterial = this._ui3DMat;\r\n        return this.sharedMaterial.materialRenderMode;\r\n    }\r\n\r\n    /**\r\n     * UI\r\n     */\r\n    set cull(value: number) {\r\n        this.sharedMaterial && (this.sharedMaterial.cull = value);\r\n    }\r\n\r\n\r\n    get cull(): number {\r\n        let mat = this.sharedMaterial;\r\n        if (!mat) {\r\n            mat = this._ui3DMat;\r\n        }\r\n        return mat.cull;\r\n    }\r\n\r\n\r\n    /**\r\n     * \r\n     */\r\n    get resolutionRate() {\r\n        return this._resolutionRate;\r\n    }\r\n\r\n    set resolutionRate(value: number) {\r\n        if (value <= 0)\r\n            return\r\n        if (this._resolutionRate == value)\r\n            return\r\n        this._resolutionRate = value;\r\n        this._resizeRT();\r\n    }\r\n\r\n    /**\r\n     * \r\n     */\r\n    get billboard() {\r\n        return this._view;\r\n    }\r\n\r\n    set billboard(value: boolean) {\r\n        this._view = value;\r\n        this._sizeChange = true;\r\n        this.boundsChange = true;\r\n    }\r\n\r\n    /**\r\n     * ()\r\n     */\r\n    get enableHit() {\r\n        return this._hit;\r\n    }\r\n\r\n    set enableHit(value: boolean) {\r\n        this._hit = value;\r\n    }\r\n\r\n    /**\r\n     * UI3D\r\n     */\r\n    constructor() {\r\n        super();\r\n        this._uiPlane = new Plane(new Vector3(), 0);\r\n        this._size = new Vector2(1, 1);\r\n        this._resolutionRate = 128;\r\n        this._shellSprite = new Sprite();\r\n        this._shellSprite.name = \"UI3D\";\r\n        this._shellSprite._setBit(NodeFlags.DISPLAYED_INSTAGE, true);\r\n        this._shellSprite._setBit(NodeFlags.ACTIVE_INHIERARCHY, true);\r\n        this._shellSprite._parent = ILaya.stage;\r\n        this._shaderValues.addDefine(MeshSprite3DShaderDeclaration.SHADERDEFINE_UV0);\r\n        this._ui3DMat = new UnlitMaterial();\r\n        this._ui3DMat.materialRenderMode = MaterialRenderMode.RENDERMODE_OPAQUE;\r\n        this._ui3DMat.cull = RenderState.CULL_BACK;\r\n        this._matrix = new Matrix4x4();\r\n        this._scale = new Vector3(1.0, 1.0, 1.0);\r\n    }\r\n\r\n    /**\r\n     * @internal add renderelement\r\n     */\r\n    private _addRenderElement() {\r\n        var elements: RenderElement[] = this._renderElements;\r\n        this._setMaterialTexture();\r\n        var material: Material = (<Material>this.sharedMaterial);\r\n        var element: RenderElement = new RenderElement();\r\n        element.setTransform((this.owner as Sprite3D)._transform);\r\n        element.render = this;\r\n        element.material = material;\r\n        this._geometry = new UI3DGeometry(this);\r\n        element.setGeometry(this._geometry);\r\n        elements.push(element);\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    private _resizeRT() {\r\n        let width = this._size.x * this._resolutionRate;\r\n        let height = this._size.y * this._resolutionRate;\r\n        if (!this._rendertexure2D) {\r\n            this._rendertexure2D = new RenderTexture2D(width, height, RenderTargetFormat.R8G8B8A8, RenderTargetFormat.None);\r\n            this._rendertexure2D._invertY = true;\r\n        } else {\r\n            if (this._rendertexure2D.width != width || this._rendertexure2D.height != height) {\r\n                this._rendertexure2D.destroy();\r\n                this._rendertexure2D = new RenderTexture2D(width, height, RenderTargetFormat.R8G8B8A8, RenderTargetFormat.None);\r\n                this._rendertexure2D._invertY = true;\r\n                this._setMaterialTexture();\r\n            }\r\n        }\r\n        this._submitRT();\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    onPreRender(): void {\r\n        //this._geometry\r\n        if (this.billboard) {\r\n            this._sizeChange = false;\r\n            let camera = (this.owner.scene as Scene3D).cullInfoCamera;\r\n            Matrix4x4.createAffineTransformation(this._transform.position, camera.transform.rotation, this._scale, this._matrix);\r\n        } else if (this._sizeChange) {\r\n            this._sizeChange = false;\r\n            this._transform.worldMatrix.cloneTo(this._matrix);\r\n        }\r\n    }\r\n\r\n    /**\r\n    * \r\n    * @param hit \r\n    */\r\n    private _parseHit(ray: Ray) {\r\n        let _tempRay = UI3D._ray;\r\n        let u, v;\r\n        if (!this._uisprite || !LayaEnv.isPlaying) return null;\r\n        this._matrix.invert(UI3D.TempMatrix);\r\n        Vector3.transformCoordinate(ray.origin, UI3D.TempMatrix, _tempRay.origin);\r\n        Vector3.TransformNormal(ray.direction, UI3D.TempMatrix, _tempRay.direction);\r\n        _tempRay.direction.normalize();\r\n\r\n        let normalizeHitWidth = 0;\r\n        let normalizeHitHeight = 0;\r\n\r\n        let t = -_tempRay.origin.z / _tempRay.direction.z;\r\n        if (t < 0) {\r\n            return null;\r\n        }\r\n        else {\r\n            u = _tempRay.origin.x + t * _tempRay.direction.x;\r\n            v = _tempRay.origin.y + t * _tempRay.direction.y;\r\n        }\r\n\r\n        normalizeHitWidth = u + 0.5;\r\n        normalizeHitHeight = v + 0.5;\r\n\r\n        let cx = normalizeHitWidth * this._rendertexure2D.width;\r\n        let cy = (1.0 - normalizeHitHeight) * this._rendertexure2D.height;\r\n\r\n        // drawCircle to test\r\n        // UI3D.DEBUG && this._uisprite && this._shellSprite.graphics.drawCircle(cx, cy, 10, \"#e53d30\");\r\n\r\n        let target = InputManager.inst.getSpriteUnderPoint(this._uisprite, cx, cy);\r\n        if (target)\r\n            return target;\r\n        else\r\n            return null;\r\n    }\r\n\r\n    /**\r\n     * ui\r\n     */\r\n    getUITexture(): BaseTexture {\r\n        return this._rendertexure2D;\r\n    }\r\n\r\n    /**\r\n     * get camera distance\r\n     * @param rayOri \r\n     * @returns \r\n     */\r\n    _getCameraDistance(rayOri: Vector3): number {\r\n        return Vector3.distance(rayOri, (this.owner as Sprite3D).transform.position);\r\n    }\r\n\r\n    /**\r\n     * @inheritDoc\r\n     * @override\r\n     * @internal\r\n     */\r\n    _renderUpdate(context: RenderContext3D, transform: Transform3D): void {\r\n        this._applyReflection();\r\n        this._setShaderValue(Sprite3D.WORLDMATRIX, ShaderDataType.Matrix4x4, this._matrix);\r\n        this._worldParams.x = transform.getFrontFaceValue();\r\n        this._setShaderValue(Sprite3D.WORLDINVERTFRONT, ShaderDataType.Vector4, this._worldParams);\r\n    }\r\n\r\n    /** \r\n     * @internal\r\n     * SpriteRT\r\n     */\r\n    _submitRT() {\r\n        //\r\n        this._rendertexure2D && this._shellSprite.drawToTexture(this._rendertexure2D.width, this._rendertexure2D.height, 0, 0, this._rendertexure2D);\r\n        this._setMaterialTexture();\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     * \r\n     */\r\n    _setMaterialTexture() {\r\n        if (!this.sharedMaterial)\r\n            this.sharedMaterial = this._ui3DMat;\r\n        if (!this.sharedMaterial.hasDefine(UnlitMaterial.SHADERDEFINE_ALBEDOTEXTURE)) {\r\n            this.sharedMaterial.addDefine(UnlitMaterial.SHADERDEFINE_ALBEDOTEXTURE);\r\n        }\r\n        this.sharedMaterial.setTexture(this._bindPropertyName, this._rendertexure2D);\r\n    }\r\n\r\n    /**\r\n     * UI\r\n     * @internal \r\n     * @param ray \r\n     * @returns \r\n     */\r\n    _checkUIPos(ray: Ray) {\r\n        if (!this.enableHit)\r\n            return false;\r\n        return this._parseHit(ray);\r\n    }\r\n\r\n    /**\r\n     * @inheritDoc\r\n     * @override\r\n     * @internal\r\n     */\r\n    protected _calculateBoundingBox(): void {\r\n        var worldMat: Matrix4x4 = this._transform.worldMatrix;\r\n        this._geometry.bounds._tranform(worldMat, this._bounds);\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    protected _onAdded(): void {\r\n        super._onAdded();\r\n        this._addRenderElement();\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    protected _onDisable(): void {\r\n        super._onDisable();\r\n        (this.owner as Sprite3D).transform.off(Event.TRANSFORM_CHANGED, this, this._transByRotate);//BaseRender,owner\r\n        (this.owner.scene as Scene3D)._UI3DManager.remove(this);\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    protected _onEnable(): void {\r\n        super._onEnable();\r\n        (this.owner.scene as Scene3D)._UI3DManager.add(this);\r\n        (this.owner as Sprite3D).transform.on(Event.TRANSFORM_CHANGED, this, this._transByRotate);//BaseRender,owner\r\n        this._transByRotate();\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    protected _onDestroy() {\r\n        super._onDestroy();\r\n        this._rendertexure2D && this._rendertexure2D.destroy();\r\n        this._uisprite && this._uisprite.destroy();\r\n        this._shellSprite && this._shellSprite.destroy();\r\n        this._ui3DMat && this._ui3DMat.destroy();\r\n        this._resolutionRate = null;\r\n        this._uiPlane = null;\r\n        this._size = null;\r\n        this._scale = null;\r\n        this._matrix = null;\r\n    }\r\n\r\n    private _transByRotate() {\r\n        if (!this.billboard) {\r\n            this._sizeChange = true;\r\n        }\r\n        this.boundsChange = true;\r\n    }\r\n}\r\n\r\n","import { IResourceLoader, ILoadTask, Loader } from \"../../net/Loader\";\r\nimport { URL } from \"../../net/URL\";\r\nimport { KTXTextureInfo } from \"../../RenderEngine/KTXTextureInfo\";\r\nimport { FilterMode } from \"../../RenderEngine/RenderEnum/FilterMode\";\r\nimport { TextureDimension } from \"../../RenderEngine/RenderEnum/TextureDimension\";\r\nimport { TextureFormat } from \"../../RenderEngine/RenderEnum/TextureFormat\";\r\nimport { WrapMode } from \"../../RenderEngine/RenderEnum/WrapMode\";\r\nimport { AssetDb } from \"../../resource/AssetDb\";\r\nimport { Resource } from \"../../resource/Resource\";\r\nimport { Byte } from \"../../utils/Byte\";\r\nimport { Utils } from \"../../utils/Utils\";\r\nimport { TextureCube } from \"../../resource/TextureCube\";\r\n\r\nvar internalResources: Record<string, TextureCube>;\r\n\r\nexport class CubemapLoader implements IResourceLoader {\r\n    constructor() {\r\n        if (!internalResources) {\r\n            internalResources = {\r\n                \"WhiteTextureCube.ltc\": TextureCube.whiteTexture,\r\n                \"BlackTextureCube.ltc\": TextureCube.blackTexture,\r\n                \"GrayTextureCube.ltc\": TextureCube.grayTexture,\r\n            };\r\n        }\r\n    }\r\n\r\n    load(task: ILoadTask) {\r\n        if (task.url.indexOf(\"internal/\") != -1) {\r\n            let tex = internalResources[Utils.getBaseName(task.url)];\r\n            if (tex)\r\n                return Promise.resolve(tex);\r\n        }\r\n\r\n        if (task.ext == \"ktx\" || task.ext == \"cubemap\") {\r\n            let url = task.url;\r\n            if (task.ext == \"cubemap\")\r\n                url = AssetDb.inst.getSubAssetURL(url, task.uuid, \"0\", \"ktx\");\r\n\r\n            return task.loader.fetch(url, \"arraybuffer\", task.progress.createCallback(), task.options).then(data => {\r\n                if (!data)\r\n                    return null;\r\n\r\n                let ktxInfo = KTXTextureInfo.getKTXTextureInfo(data);\r\n                if (ktxInfo.dimension != TextureDimension.Cube) {\r\n                    Loader.warn(\"ktxInfo.dimension != TextureDimension.Cube! \" + task.url);\r\n                    return null;\r\n                }\r\n\r\n                let tex = new TextureCube(ktxInfo.width, ktxInfo.format, ktxInfo.mipmapCount > 1, ktxInfo.sRGB);\r\n                tex.setKTXData(ktxInfo);\r\n\r\n                let obsoluteInst = task.obsoluteInst;\r\n                if (obsoluteInst && (obsoluteInst instanceof TextureCube))\r\n                    tex = this.move(obsoluteInst, tex);\r\n\r\n                return tex;\r\n            });\r\n        }\r\n        else if (task.ext == \"ltcb\" || task.ext == \"ltcb.ls\") {\r\n            return task.loader.fetch(task.url, \"arraybuffer\", task.progress.createCallback(), task.options).then(data => {\r\n                if (!data)\r\n                    return null;\r\n\r\n                let byte: Byte = new Byte(data);\r\n                let version: string = byte.readUTFString();\r\n                if (version !== \"LAYATEXTURECUBE:0000\") {\r\n                    console.warn(`CubemapBinLoader: unknow version. ${version}`);\r\n                    return null;\r\n                }\r\n                let format: TextureFormat = <TextureFormat>byte.readUint8();\r\n                let mipCount: number = byte.getUint8();\r\n                let size: number = byte.readUint16();\r\n                let filterMode: FilterMode = <FilterMode>byte.getUint8();\r\n                let wrapModeU: WrapMode = <WrapMode>byte.getUint8();\r\n                let wrapModev: WrapMode = <WrapMode>byte.getUint8();\r\n                let anisoLevel: FilterMode = byte.getUint8();\r\n\r\n                let tex: TextureCube = new TextureCube(size, format, mipCount > 1 ? true : false);\r\n                tex.setPixelsData(null, false, false);\r\n                tex.filterMode = filterMode;\r\n                tex.wrapModeU = wrapModeU;\r\n                tex.wrapModeV = wrapModev;\r\n                tex.anisoLevel = anisoLevel;\r\n                let pos: number = byte.pos;\r\n                let mipSize: number = size;\r\n                for (let i = 0; i < mipCount; i++) {\r\n                    let uint8Arrays: Array<Uint8Array> = new Array<Uint8Array>(6);\r\n                    let mipPixelLength: number = mipSize * mipSize * tex._getFormatByteCount();\r\n                    for (let j = 0; j < 6; j++) {\r\n                        uint8Arrays[j] = new Uint8Array(data, pos, mipPixelLength);\r\n                        pos += mipPixelLength;\r\n                    }\r\n                    // todo   mipmap   mipmap\r\n                    tex.updateSubPixelsData(uint8Arrays, 0, 0, mipSize, mipSize, i, false, false, false);\r\n                    mipSize /= 2;\r\n                }\r\n\r\n                let obsoluteInst = task.obsoluteInst;\r\n                if (obsoluteInst && (obsoluteInst instanceof TextureCube))\r\n                    tex = this.move(obsoluteInst, tex);\r\n                return tex;\r\n            });\r\n        }\r\n        else {\r\n            return task.loader.fetch(task.url, \"json\", task.progress.createCallback(0.2), task.options).then(data => {\r\n                if (!data)\r\n                    return null;\r\n\r\n                let ltcBasePath: string = URL.getPath(task.url);\r\n                let urls: any[] = [\r\n                    URL.join(ltcBasePath, data.front),\r\n                    URL.join(ltcBasePath, data.back),\r\n                    URL.join(ltcBasePath, data.left),\r\n                    URL.join(ltcBasePath, data.right),\r\n                    URL.join(ltcBasePath, data.up),\r\n                    URL.join(ltcBasePath, data.down)\r\n                ];\r\n\r\n                return Promise.all(urls.map(url => {\r\n                    if (url)\r\n                        return task.loader.fetch(url, \"image\", task.progress.createCallback(), task.options);\r\n                    else\r\n                        return Promise.resolve(null);\r\n                })).then(images => {\r\n                    let constructParams = task.options.constructParams;\r\n                    let size = constructParams ? constructParams[0] : ((images[0]?.width) ?? 1);\r\n                    let format = constructParams ? constructParams[1] : TextureFormat.R8G8B8A8;\r\n                    let mipmap = constructParams ? constructParams[3] : false;\r\n                    let srgb = constructParams ? constructParams[5] : true;\r\n                    let tex = new TextureCube(size, format, mipmap, srgb);\r\n                    tex.setImageData(images, false, false);\r\n\r\n                    let obsoluteInst = task.obsoluteInst;\r\n                    if (obsoluteInst && (obsoluteInst instanceof TextureCube))\r\n                        tex = this.move(obsoluteInst, tex);\r\n                    return tex;\r\n                });\r\n            });\r\n        }\r\n    }\r\n\r\n    private move(obsoluteInst: TextureCube, tex: TextureCube) {\r\n        obsoluteInst._texture = tex._texture;\r\n        (<any>obsoluteInst)._format = tex.format;\r\n        obsoluteInst.width = tex.width;\r\n        obsoluteInst.height = tex.height;\r\n        obsoluteInst.obsolute = false;\r\n        delete Resource._idResourcesMap[tex.id];\r\n        return obsoluteInst;\r\n    }\r\n}\r\n\r\nLoader.registerLoader([\"ltc\", \"ltcb\", \"ltcb.ls\", \"cubemap\"], CubemapLoader, Loader.TEXTURECUBE);","import { IResourceLoader, ILoadTask, Loader } from \"../../net/Loader\";\r\nimport { AssetDb } from \"../../resource/AssetDb\";\r\nimport { AnimationClip } from \"../animation/AnimationClip\";\r\n\r\nclass AnimationClipLoader implements IResourceLoader {\r\n    load(task: ILoadTask) {\r\n        let url = AssetDb.inst.getSubAssetURL(task.url, task.uuid, null, \"lani\");\r\n        return task.loader.fetch(url, \"arraybuffer\", task.progress.createCallback(), task.options).then(data => {\r\n            if (!data) {\r\n                return null;\r\n            }\r\n            return AnimationClip._parse(data);\r\n        });\r\n    }\r\n}\r\n\r\nLoader.registerLoader([\"lani\"], AnimationClipLoader, Loader.ANIMATIONCLIP);","\r\nimport { IndexBuffer3D } from \"../graphics/IndexBuffer3D\"\r\nimport { VertexBuffer3D } from \"../graphics/VertexBuffer3D\"\r\nimport { Mesh, skinnedMatrixCache } from \"../resource/models/Mesh\"\r\nimport { SubMesh } from \"../resource/models/SubMesh\"\r\nimport { Byte } from \"../../utils/Byte\"\r\nimport { BufferUsage } from \"../../RenderEngine/RenderEnum/BufferTargetType\"\r\nimport { VertexDeclaration } from \"../../RenderEngine/VertexDeclaration\"\r\nimport { IndexFormat } from \"../../RenderEngine/RenderEnum/IndexFormat\"\r\nimport { Matrix4x4 } from \"../../maths/Matrix4x4\"\r\nimport { VertexMesh } from \"../../RenderEngine/RenderShader/VertexMesh\"\r\nimport { Laya3DRender } from \"../RenderObjs/Laya3DRender\"\r\n\r\n/**\r\n * @internal\r\n * <code>LoadModel</code> \r\n */\r\nexport class LoadModelV04 {\r\n\r\n\t/**@internal */\r\n\tprivate static _BLOCK: any = { count: 0 };\r\n\t/**@internal */\r\n\tprivate static _DATA: any = { offset: 0, size: 0 };\r\n\r\n\t/**@internal */\r\n\tprivate static _strings: any[] = [];\r\n\t/**@internal */\r\n\tprivate static _readData: Byte;\r\n\t/**@internal */\r\n\tprivate static _version: string;\r\n\t/**@internal */\r\n\tprivate static _mesh: Mesh;\r\n\t/**@internal */\r\n\tprivate static _subMeshes: SubMesh[];\r\n\r\n\t/**\r\n\t * @internal\r\n\t */\r\n\tstatic parse(readData: Byte, version: string, mesh: Mesh, subMeshes: SubMesh[]): void {\r\n\t\tLoadModelV04._mesh = mesh;\r\n\t\tLoadModelV04._subMeshes = subMeshes;\r\n\t\tLoadModelV04._version = version;\r\n\t\tLoadModelV04._readData = readData;\r\n\t\tLoadModelV04.READ_DATA();\r\n\t\tLoadModelV04.READ_BLOCK();\r\n\t\tLoadModelV04.READ_STRINGS();\r\n\t\tfor (var i: number = 0, n: number = LoadModelV04._BLOCK.count; i < n; i++) {\r\n\t\t\tLoadModelV04._readData.pos = LoadModelV04._BLOCK.blockStarts[i];\r\n\t\t\tvar index: number = LoadModelV04._readData.getUint16();\r\n\t\t\tvar blockName: string = LoadModelV04._strings[index];\r\n\t\t\tvar fn: Function = (LoadModelV04 as any)[\"READ_\" + blockName];\r\n\t\t\tif (fn == null)\r\n\t\t\t\tthrow new Error(\"model file err,no this function:\" + index + \" \" + blockName);\r\n\t\t\telse\r\n\t\t\t\tfn.call(null);\r\n\t\t}\r\n\t\tLoadModelV04._strings.length = 0;\r\n\t\tLoadModelV04._readData = null;\r\n\t\tLoadModelV04._version = null;\r\n\t\tLoadModelV04._mesh = null;\r\n\t\tLoadModelV04._subMeshes = null;\r\n\t}\r\n\r\n\t/**\r\n\t * @internal\r\n\t */\r\n\tprivate static _readString(): string {\r\n\t\treturn LoadModelV04._strings[LoadModelV04._readData.getUint16()];\r\n\t}\r\n\r\n\t/**\r\n\t * @internal\r\n\t */\r\n\tprivate static READ_DATA(): void {\r\n\t\tLoadModelV04._DATA.offset = LoadModelV04._readData.getUint32();\r\n\t\tLoadModelV04._DATA.size = LoadModelV04._readData.getUint32();\r\n\t}\r\n\r\n\t/**\r\n\t * @internal\r\n\t */\r\n\tprivate static READ_BLOCK(): void {\r\n\t\tvar count: number = LoadModelV04._BLOCK.count = LoadModelV04._readData.getUint16();\r\n\t\tvar blockStarts: any[] = LoadModelV04._BLOCK.blockStarts = [];\r\n\t\tvar blockLengths: any[] = LoadModelV04._BLOCK.blockLengths = [];\r\n\t\tfor (var i: number = 0; i < count; i++) {\r\n\t\t\tblockStarts.push(LoadModelV04._readData.getUint32());\r\n\t\t\tblockLengths.push(LoadModelV04._readData.getUint32());\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @internal\r\n\t */\r\n\tprivate static READ_STRINGS(): void {\r\n\t\tvar offset: number = LoadModelV04._readData.getUint32();\r\n\t\tvar count: number = LoadModelV04._readData.getUint16();\r\n\t\tvar prePos: number = LoadModelV04._readData.pos;\r\n\t\tLoadModelV04._readData.pos = offset + LoadModelV04._DATA.offset;\r\n\r\n\t\tfor (var i: number = 0; i < count; i++)\r\n\t\t\tLoadModelV04._strings[i] = LoadModelV04._readData.readUTFString();\r\n\r\n\t\tLoadModelV04._readData.pos = prePos;\r\n\t}\r\n\r\n\t/**\r\n\t * @internal\r\n\t */\r\n\tprivate static READ_MESH(): boolean {\r\n\t\tvar name: string = LoadModelV04._readString();\r\n\t\tvar arrayBuffer: ArrayBuffer = LoadModelV04._readData.__getBuffer();\r\n\t\tvar i: number;\r\n\r\n\t\tvar memorySize: number = 0;\r\n\t\tvar vertexBufferCount: number = LoadModelV04._readData.getInt16();\r\n\t\tvar offset: number = LoadModelV04._DATA.offset;\r\n\t\tfor (i = 0; i < vertexBufferCount; i++) {//TODO:1\r\n\t\t\tvar vbStart: number = offset + LoadModelV04._readData.getUint32();\r\n\t\t\tvar vbLength: number = LoadModelV04._readData.getUint32();\r\n\t\t\tvar vbArrayBuffer: ArrayBuffer = arrayBuffer.slice(vbStart, vbStart + vbLength);\r\n\t\t\tvar vbDatas: Float32Array = new Float32Array(vbArrayBuffer);\r\n\t\t\tvar bufferAttribute: string = LoadModelV04._readString();\r\n\t\t\tvar vertexDeclaration: VertexDeclaration;\r\n\t\t\tswitch (LoadModelV04._version) {\r\n\t\t\t\tcase \"LAYAMODEL:0301\":\r\n\t\t\t\tcase \"LAYAMODEL:0400\":\r\n\t\t\t\t\tvertexDeclaration = VertexMesh.getVertexDeclaration(bufferAttribute);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase \"LAYAMODEL:0401\":\r\n\t\t\t\t\tvertexDeclaration = VertexMesh.getVertexDeclaration(bufferAttribute, false);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tdefault:\r\n\t\t\t\t\tthrow new Error(\"LoadModelV03: unknown version.\");\r\n\t\t\t}\r\n\r\n\t\t\tif (!vertexDeclaration)\r\n\t\t\t\tthrow new Error(\"LoadModelV03: unknown vertexDeclaration.\");\r\n\r\n\t\t\tvar vertexBuffer: VertexBuffer3D = Laya3DRender.renderOBJCreate.createVertexBuffer3D(vbDatas.length * 4, BufferUsage.Static, true);\r\n\t\t\tvertexBuffer.vertexDeclaration = vertexDeclaration;\r\n\t\t\tvertexBuffer.setData(vbDatas.buffer);\r\n\t\t\tLoadModelV04._mesh._vertexBuffer = vertexBuffer;\r\n\t\t\tLoadModelV04._mesh._vertexCount += vertexBuffer._byteLength / vertexDeclaration.vertexStride;\r\n\t\t\tmemorySize += vbDatas.length * 4;\r\n\t\t}\r\n\r\n\t\tvar ibStart: number = offset + LoadModelV04._readData.getUint32();\r\n\t\tvar ibLength: number = LoadModelV04._readData.getUint32();\r\n\t\tvar ibDatas: Uint16Array = new Uint16Array(arrayBuffer.slice(ibStart, ibStart + ibLength));\r\n\t\tvar indexBuffer: IndexBuffer3D = Laya3DRender.renderOBJCreate.createIndexBuffer3D(IndexFormat.UInt16, ibLength / 2, BufferUsage.Static, true);\r\n\t\tindexBuffer.setData(ibDatas);\r\n\t\tLoadModelV04._mesh._indexBuffer = indexBuffer;\r\n\t\tmemorySize += indexBuffer.indexCount * 2;\r\n\r\n\t\tLoadModelV04._mesh._setBuffer(LoadModelV04._mesh._vertexBuffer, indexBuffer);\r\n\r\n\t\tLoadModelV04._mesh._setCPUMemory(memorySize);\r\n\t\tLoadModelV04._mesh._setGPUMemory(memorySize);\r\n\r\n\t\tvar boneNames: string[] = LoadModelV04._mesh._boneNames = [];\r\n\t\tvar boneCount: number = LoadModelV04._readData.getUint16();\r\n\t\tboneNames.length = boneCount;\r\n\t\tfor (i = 0; i < boneCount; i++)\r\n\t\t\tboneNames[i] = LoadModelV04._strings[LoadModelV04._readData.getUint16()];\r\n\r\n\t\tLoadModelV04._readData.pos += 8;//TODO:\r\n\r\n\t\tvar bindPoseDataStart: number = LoadModelV04._readData.getUint32();\r\n\t\tvar bindPoseDataLength: number = LoadModelV04._readData.getUint32();\r\n\t\tvar bindPoseDatas: Float32Array = new Float32Array(arrayBuffer.slice(offset + bindPoseDataStart, offset + bindPoseDataStart + bindPoseDataLength));\r\n\t\tvar bindPoseFloatCount: number = bindPoseDatas.length;\r\n\t\tvar bindPoseBuffer: ArrayBuffer = LoadModelV04._mesh._inverseBindPosesBuffer = new ArrayBuffer(bindPoseFloatCount * 4);//TODO:[NATIVE]\r\n\t\tLoadModelV04._mesh._inverseBindPoses = [];\r\n\t\tif (bindPoseFloatCount != 0)\r\n\t\t\tLoadModelV04._mesh._instanceBufferStateType = Mesh.MESH_INSTANCEBUFFER_TYPE_SIMPLEANIMATOR;\r\n\t\telse\r\n\t\t\tLoadModelV04._mesh._instanceBufferStateType = Mesh.MESH_INSTANCEBUFFER_TYPE_NORMAL;\r\n\t\t//LoadModelV04._mesh._setInstanceBuffer(LoadModelV04._mesh._instanceBufferStateType);\r\n\t\tfor (i = 0; i < bindPoseFloatCount; i += 16) {\r\n\t\t\tvar inverseGlobalBindPose: Matrix4x4 = new Matrix4x4(bindPoseDatas[i + 0], bindPoseDatas[i + 1], bindPoseDatas[i + 2], bindPoseDatas[i + 3], bindPoseDatas[i + 4], bindPoseDatas[i + 5], bindPoseDatas[i + 6], bindPoseDatas[i + 7], bindPoseDatas[i + 8], bindPoseDatas[i + 9], bindPoseDatas[i + 10], bindPoseDatas[i + 11], bindPoseDatas[i + 12], bindPoseDatas[i + 13], bindPoseDatas[i + 14], bindPoseDatas[i + 15], new Float32Array(bindPoseBuffer, i * 4, 16));\r\n\t\t\tLoadModelV04._mesh._inverseBindPoses[i / 16] = inverseGlobalBindPose;\r\n\t\t}\r\n\t\treturn true;\r\n\t}\r\n\r\n\t/**\r\n\t * @internal\r\n\t */\r\n\tprivate static READ_SUBMESH(): boolean {\r\n\t\tvar arrayBuffer: ArrayBuffer = LoadModelV04._readData.__getBuffer();\r\n\t\tvar subMesh: SubMesh = new SubMesh(LoadModelV04._mesh);\r\n\r\n\t\tLoadModelV04._readData.getInt16();//TODO:vbIndex\r\n\t\tLoadModelV04._readData.getUint32();//TODO:vbStart\r\n\t\tLoadModelV04._readData.getUint32();//TODO:vbLength\r\n\r\n\t\tvar ibStart: number = LoadModelV04._readData.getUint32();\r\n\t\tvar ibCount: number = LoadModelV04._readData.getUint32();\r\n\t\tvar indexBuffer: IndexBuffer3D = LoadModelV04._mesh._indexBuffer;\r\n\t\tsubMesh._indexBuffer = indexBuffer;\r\n\t\tsubMesh._setIndexRange(ibStart, ibCount);\r\n\t\tvar vertexBuffer: VertexBuffer3D = LoadModelV04._mesh._vertexBuffer;\r\n\t\tsubMesh._vertexBuffer = vertexBuffer;\r\n\r\n\t\tvar offset: number = LoadModelV04._DATA.offset;\r\n\t\tvar subIndexBufferStart: number[] = subMesh._subIndexBufferStart;\r\n\t\tvar subIndexBufferCount: number[] = subMesh._subIndexBufferCount;\r\n\t\tvar boneIndicesList: Uint16Array[] = subMesh._boneIndicesList;\r\n\t\tvar drawCount: number = LoadModelV04._readData.getUint16();\r\n\t\tsubIndexBufferStart.length = drawCount;\r\n\t\tsubIndexBufferCount.length = drawCount;\r\n\t\tboneIndicesList.length = drawCount;\r\n\r\n\t\tvar skinnedCache: skinnedMatrixCache[] = LoadModelV04._mesh._skinnedMatrixCaches;\r\n\t\tvar subMeshIndex: number = LoadModelV04._subMeshes.length;\r\n\t\tskinnedCache.length = LoadModelV04._mesh._inverseBindPoses.length;\r\n\t\tfor (var i: number = 0; i < drawCount; i++) {\r\n\t\t\tsubIndexBufferStart[i] = LoadModelV04._readData.getUint32();\r\n\t\t\tsubIndexBufferCount[i] = LoadModelV04._readData.getUint32();\r\n\t\t\tvar boneDicofs: number = LoadModelV04._readData.getUint32();\r\n\t\t\tvar boneDicCount: number = LoadModelV04._readData.getUint32();\r\n\t\t\tvar boneIndices: Uint16Array = boneIndicesList[i] = new Uint16Array(arrayBuffer.slice(offset + boneDicofs, offset + boneDicofs + boneDicCount));\r\n\t\t\tvar boneIndexCount: number = boneIndices.length;\r\n\t\t\tfor (var j: number = 0; j < boneIndexCount; j++) {\r\n\t\t\t\tvar index: number = boneIndices[j];\r\n\t\t\t\tskinnedCache[index] || (skinnedCache[index] = new skinnedMatrixCache(subMeshIndex, i, j));\r\n\t\t\t}\r\n\t\t}\r\n\t\tLoadModelV04._subMeshes.push(subMesh);\r\n\t\treturn true;\r\n\t}\r\n}\r\n\r\n\r\n","\r\nexport class MorphTarget {\r\n\r\n    /** @internal */\r\n    _index: number;\r\n\r\n    name: string;\r\n\r\n    fullWeight: number;\r\n\r\n    data: Float32Array;\r\n\r\n    constructor() {\r\n        this.fullWeight = 1;\r\n    }\r\n\r\n}\r\n\r\n// todo class name\r\nexport class MorphTargetChannel {\r\n\r\n    /** @internal */\r\n    _index: number;\r\n\r\n    name: string;\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    targets: Array<MorphTarget>;\r\n\r\n    targetCount: number = 0;\r\n\r\n    constructor() {\r\n        this.targets = new Array<MorphTarget>();\r\n    }\r\n\r\n    getTargetByIndex(index: number) {\r\n        return this.targets[index];\r\n    }\r\n\r\n    addTarget(target: MorphTarget) {\r\n        this.targetCount++;\r\n        this.targets.push(target);\r\n        this.targets.sort((a, b) => {\r\n            return a.fullWeight - b.fullWeight;\r\n        })\r\n    }\r\n\r\n}","import { LayaGL } from \"../../../layagl/LayaGL\";\r\nimport { Vector4 } from \"../../../maths/Vector4\";\r\nimport { FilterMode } from \"../../../RenderEngine/RenderEnum/FilterMode\";\r\nimport { RenderCapable } from \"../../../RenderEngine/RenderEnum/RenderCapable\";\r\nimport { RenderParams } from \"../../../RenderEngine/RenderEnum/RenderParams\";\r\nimport { TextureFormat } from \"../../../RenderEngine/RenderEnum/TextureFormat\";\r\nimport { VertexMesh } from \"../../../RenderEngine/RenderShader/VertexMesh\";\r\nimport { VertexDeclaration } from \"../../../RenderEngine/VertexDeclaration\";\r\nimport { Texture2DArray } from \"../../../resource/Texture2DArray\";\r\nimport { Bounds } from \"../../math/Bounds\";\r\nimport { MorphTarget, MorphTargetChannel } from \"./MorphTarget\";\r\n\r\nexport class MorphTargetData {\r\n\r\n    // keep origin insert order\r\n\r\n    private targets: Array<MorphTarget>;\r\n\r\n    private channels: Array<MorphTargetChannel>;\r\n\r\n    vertexCount: number;\r\n\r\n    /**\r\n     * // todo   \r\n     * //   VertexDeclaration \r\n     * morph target attribute element count\r\n     */\r\n    elementCount: number;\r\n\r\n    /**@internal */\r\n    attributeOffset: Vector4;\r\n    /**@internal */\r\n    params: Vector4;\r\n\r\n    /** @internal */\r\n    targetTexture: Texture2DArray;\r\n\r\n    vertexDec: VertexDeclaration;\r\n\r\n    bounds: Bounds;\r\n\r\n    constructor() {\r\n        this.targets = new Array();\r\n        this.channels = new Array();\r\n        this.bounds = new Bounds();\r\n        this.params = new Vector4();\r\n    }\r\n\r\n    addMorphChannel(channel: MorphTargetChannel) {\r\n\r\n        channel._index = this.channels.length;\r\n        this.channels.push(channel);\r\n\r\n        channel.targets.forEach(target => {\r\n            target._index = this.targets.length;\r\n            this.targets.push(target);\r\n        })\r\n    }\r\n\r\n    getMorphChannel(name: string): MorphTargetChannel {\r\n        // return this.targets.find(value => value.name == name);\r\n        return this.channels.find(value => value.name == name);\r\n    }\r\n\r\n    getMorphChannelbyIndex(index: number) {\r\n        return this.channels[index];\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    get targetCount(): number {\r\n        return this.targets.length;\r\n    }\r\n\r\n    get channelCount(): number {\r\n        return this.channels.length;\r\n    }\r\n\r\n    initData() {\r\n        if (LayaGL.renderEngine.getCapable(RenderCapable.Texture3D)) {\r\n            let targetNum = this.targets.length;\r\n\r\n            let maxTexSize = LayaGL.renderEngine.getParams(RenderParams.MAX_Texture_Size);\r\n\r\n            let vertexCount = this.vertexCount;\r\n\r\n            let vertexDec = this.vertexDec;\r\n\r\n            let morphStride = vertexDec.vertexStride / 4;\r\n\r\n            let elementCount = vertexDec.vertexElementCount;\r\n            this.elementCount = elementCount;\r\n\r\n            let texHeight = Math.floor(elementCount * vertexCount / maxTexSize) + 1;\r\n\r\n            let texelStride = 4;\r\n            this.targetTexture = new Texture2DArray(maxTexSize, texHeight, targetNum, TextureFormat.R32G32B32A32, false, false, false);\r\n            this.targetTexture.filterMode = FilterMode.Point;\r\n            this.targetTexture.anisoLevel = 1;\r\n            this.targetTexture.lock = true;\r\n\r\n            let data = new Float32Array(maxTexSize * texHeight * targetNum * texelStride).fill(0);\r\n\r\n            /**\r\n             * x: position offset\r\n             * y: normal offset\r\n             * z: tangent offset\r\n             */\r\n            let attributeOffset = this.attributeOffset = new Vector4(0, 0, 0, 0);\r\n            attributeOffset.x = vertexDec._vertexElements.indexOf(vertexDec.getVertexElementByUsage(VertexMesh.MESH_POSITION0));\r\n            attributeOffset.y = vertexDec._vertexElements.indexOf(vertexDec.getVertexElementByUsage(VertexMesh.MESH_NORMAL0));\r\n            attributeOffset.z = vertexDec._vertexElements.indexOf(vertexDec.getVertexElementByUsage(VertexMesh.MESH_TANGENT0));\r\n\r\n            let targetStride = maxTexSize * texHeight;\r\n\r\n            for (let targetIndex = 0; targetIndex < targetNum; targetIndex++) {\r\n                let target = this.targets[targetIndex];\r\n                for (let vertexIndex = 0; vertexIndex < vertexCount; vertexIndex++) {\r\n                    let dataOffset = (targetIndex * targetStride + vertexIndex * elementCount) * texelStride;\r\n                    vertexDec._vertexElements.forEach((element, elementIndex) => {\r\n                        let pixelOffset = dataOffset + elementIndex * 4;\r\n\r\n                        let elementOffset = element.offset / 4;\r\n                        let targetDataOffset = vertexIndex * morphStride + elementOffset;\r\n                        switch (element.elementUsage) {\r\n                            case VertexMesh.MESH_POSITION0:\r\n                            case VertexMesh.MESH_NORMAL0:\r\n                                data[pixelOffset] = target.data[targetDataOffset];\r\n                                data[pixelOffset + 1] = target.data[targetDataOffset + 1];\r\n                                data[pixelOffset + 2] = target.data[targetDataOffset + 2];\r\n                                break;\r\n                            case VertexMesh.MESH_TANGENT0:\r\n                                data[pixelOffset] = target.data[targetDataOffset];\r\n                                data[pixelOffset + 1] = target.data[targetDataOffset + 1];\r\n                                data[pixelOffset + 2] = target.data[targetDataOffset + 2];\r\n                                data[pixelOffset + 3] = target.data[targetDataOffset + 3];\r\n                                break;\r\n                            default:\r\n                                break;\r\n                        }\r\n                    });\r\n                }\r\n            }\r\n\r\n            this.targetTexture.setPixelsData(data, false, false);\r\n\r\n            this.params.setValue(this.targetTexture.width, this.targetTexture.height, this.elementCount, this.channelCount);\r\n        }\r\n    }\r\n\r\n    destroy() {\r\n        if (this.targetTexture) {\r\n            this.targetTexture.lock = false;\r\n            this.targetTexture.destroy();\r\n            this.targetTexture = null;\r\n        }\r\n\r\n        // todo\r\n        this.targets = null;\r\n        this.channels = null;\r\n    }\r\n\r\n    clone(): MorphTargetData {\r\n        let res = new MorphTargetData();\r\n\r\n        res.bounds.setMin(this.bounds.getMin());\r\n        res.bounds.setMax(this.bounds.getMax());\r\n\r\n        res.vertexCount = this.vertexCount;\r\n        res.vertexDec = this.vertexDec;\r\n\r\n        let channelCount = this.channelCount;\r\n        for (let index = 0; index < channelCount; index++) {\r\n            let channel = this.getMorphChannelbyIndex(index);\r\n\r\n            let newChannel = new MorphTargetChannel();\r\n            newChannel.name = channel.name;\r\n\r\n            let targetCount = channel.targetCount;\r\n            for (let targetIndex = 0; targetIndex < targetCount; targetIndex++) {\r\n                let target = channel.getTargetByIndex(targetIndex);\r\n                \r\n                let newTarget = new MorphTarget();\r\n                newTarget.name = target.name;\r\n                newTarget.fullWeight = target.fullWeight;\r\n                newTarget.data = new Float32Array(target.data);\r\n                \r\n                newChannel.addTarget(newTarget);\r\n            }\r\n\r\n            res.addMorphChannel(newChannel);\r\n        }\r\n\r\n        res.initData();\r\n        return res;\r\n    }\r\n\r\n}","import { Matrix4x4 } from \"../../maths/Matrix4x4\"\r\nimport { Vector3 } from \"../../maths/Vector3\"\r\nimport { BufferUsage } from \"../../RenderEngine/RenderEnum/BufferTargetType\"\r\nimport { IndexFormat } from \"../../RenderEngine/RenderEnum/IndexFormat\"\r\nimport { VertexMesh } from \"../../RenderEngine/RenderShader/VertexMesh\"\r\nimport { VertexDeclaration } from \"../../RenderEngine/VertexDeclaration\"\r\nimport { Byte } from \"../../utils/Byte\"\r\nimport { HalfFloatUtils } from \"../../utils/HalfFloatUtils\"\r\nimport { IndexBuffer3D } from \"../graphics/IndexBuffer3D\"\r\nimport { VertexBuffer3D } from \"../graphics/VertexBuffer3D\"\r\nimport { Laya3DRender } from \"../RenderObjs/Laya3DRender\"\r\nimport { Mesh, skinnedMatrixCache } from \"../resource/models/Mesh\"\r\nimport { MorphTarget, MorphTargetChannel } from \"../resource/models/MorphTarget\"\r\nimport { MorphTargetData } from \"../resource/models/MorphTargetData\"\r\nimport { SubMesh } from \"../resource/models/SubMesh\"\r\n\r\n\r\n/**\r\n * @internal\r\n * <code>LoadModelV05</code> \r\n */\r\nexport class LoadModelV05 {\r\n\r\n    /**@internal */\r\n    private static _BLOCK: any = { count: 0 };\r\n    /**@internal */\r\n    private static _DATA = { offset: 0, size: 0 };\r\n\r\n    /**@internal */\r\n    private static _strings: any[] = [];\r\n    /**@internal */\r\n    private static _readData: Byte;\r\n    /**@internal */\r\n    private static _version: string;\r\n    /**@internal */\r\n    private static _mesh: Mesh;\r\n    /**@internal */\r\n    private static _subMeshes: SubMesh[];\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    static parse(readData: Byte, version: string, mesh: Mesh, subMeshes: SubMesh[]): void {\r\n        LoadModelV05._mesh = mesh;\r\n        LoadModelV05._subMeshes = subMeshes;\r\n        LoadModelV05._version = version;\r\n        LoadModelV05._readData = readData;\r\n        LoadModelV05.READ_DATA();\r\n        LoadModelV05.READ_BLOCK();\r\n        LoadModelV05.READ_STRINGS();\r\n        for (var i: number = 0, n: number = LoadModelV05._BLOCK.count; i < n; i++) {\r\n            LoadModelV05._readData.pos = LoadModelV05._BLOCK.blockStarts[i];\r\n            var index: number = LoadModelV05._readData.getUint16();\r\n            var blockName: string = LoadModelV05._strings[index];\r\n            var fn: Function = (LoadModelV05 as any)[\"READ_\" + blockName];\r\n            if (fn == null)\r\n                console.warn(\"model file err,no this function:\" + index + \" \" + blockName);\r\n            else\r\n                fn.call(null);\r\n        }\r\n        LoadModelV05._strings.length = 0;\r\n        LoadModelV05._readData = null;\r\n        LoadModelV05._version = null;\r\n        LoadModelV05._mesh = null;\r\n        LoadModelV05._subMeshes = null;\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    private static _readString(): string {\r\n        return LoadModelV05._strings[LoadModelV05._readData.getUint16()];\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    private static READ_DATA(): void {\r\n        LoadModelV05._DATA.offset = LoadModelV05._readData.getUint32();\r\n        LoadModelV05._DATA.size = LoadModelV05._readData.getUint32();\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    private static READ_BLOCK(): void {\r\n        var count: number = LoadModelV05._BLOCK.count = LoadModelV05._readData.getUint16();\r\n        var blockStarts: any[] = LoadModelV05._BLOCK.blockStarts = [];\r\n        var blockLengths: any[] = LoadModelV05._BLOCK.blockLengths = [];\r\n        for (var i: number = 0; i < count; i++) {\r\n            blockStarts.push(LoadModelV05._readData.getUint32());\r\n            blockLengths.push(LoadModelV05._readData.getUint32());\r\n        }\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    private static READ_STRINGS(): void {\r\n        var offset: number = LoadModelV05._readData.getUint32();\r\n        var count: number = LoadModelV05._readData.getUint16();\r\n        var prePos: number = LoadModelV05._readData.pos;\r\n        LoadModelV05._readData.pos = offset + LoadModelV05._DATA.offset;\r\n\r\n        for (var i: number = 0; i < count; i++)\r\n            LoadModelV05._strings[i] = LoadModelV05._readData.readUTFString();\r\n\r\n        LoadModelV05._readData.pos = prePos;\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    private static READ_MESH(): boolean {\r\n        var i: number;\r\n        var memorySize: number = 0;\r\n        var name: string = LoadModelV05._readString();\r\n        var reader: Byte = LoadModelV05._readData;\r\n        var arrayBuffer: ArrayBuffer = reader.__getBuffer();\r\n\r\n\r\n\r\n        var vertexBufferCount: number = reader.getInt16();\r\n        var offset: number = LoadModelV05._DATA.offset;\r\n        for (i = 0; i < vertexBufferCount; i++) {//TODO:1\r\n            var vbStart: number = offset + reader.getUint32();\r\n            var vertexCount: number = reader.getUint32();\r\n            var vertexFlag: string = LoadModelV05._readString();\r\n            var vertexDeclaration: VertexDeclaration = VertexMesh.getVertexDeclaration(vertexFlag, false);\r\n\r\n            var vertexStride: number = vertexDeclaration.vertexStride;\r\n            var vertexData: ArrayBuffer;\r\n            var floatData: Float32Array;\r\n            var uint8Data: Uint8Array;\r\n\r\n            var subVertexFlags: any[] = vertexFlag.split(\",\");\r\n            var subVertexCount: number = subVertexFlags.length;\r\n            var mesh: Mesh = LoadModelV05._mesh;\r\n\r\n            switch (LoadModelV05._version) {\r\n                case \"LAYAMODEL:05\":\r\n                case \"LAYAMODEL:0501\":\r\n                case \"LAYAMODEL:0502\":\r\n                    vertexData = arrayBuffer.slice(vbStart, vbStart + vertexCount * vertexStride);\r\n                    floatData = new Float32Array(vertexData);\r\n                    uint8Data = new Uint8Array(vertexData);\r\n                    break;\r\n                case \"LAYAMODEL:COMPRESSION_05\":\r\n                case \"LAYAMODEL:COMPRESSION_0501\":\r\n                    vertexData = new ArrayBuffer(vertexStride * vertexCount);\r\n                    floatData = new Float32Array(vertexData);\r\n                    uint8Data = new Uint8Array(vertexData);\r\n                    var lastPosition: number = reader.pos;\r\n                    reader.pos = vbStart;\r\n\r\n                    for (var j: number = 0; j < vertexCount; j++) {\r\n                        var subOffset: number;\r\n                        var verOffset: number = j * vertexStride;\r\n                        for (var k: number = 0; k < subVertexCount; k++) {\r\n                            switch (subVertexFlags[k]) {\r\n                                case \"POSITION\":\r\n                                    subOffset = verOffset / 4;\r\n                                    floatData[subOffset] = HalfFloatUtils.convertToNumber(reader.getUint16());\r\n                                    floatData[subOffset + 1] = HalfFloatUtils.convertToNumber(reader.getUint16());\r\n                                    floatData[subOffset + 2] = HalfFloatUtils.convertToNumber(reader.getUint16());\r\n                                    verOffset += 12;\r\n                                    break;\r\n                                case \"NORMAL\":\r\n                                    subOffset = verOffset / 4;\r\n                                    floatData[subOffset] = reader.getUint8() / 127.5 - 1;\r\n                                    floatData[subOffset + 1] = reader.getUint8() / 127.5 - 1;\r\n                                    floatData[subOffset + 2] = reader.getUint8() / 127.5 - 1;\r\n                                    verOffset += 12;\r\n                                    break;\r\n                                case \"COLOR\":\r\n                                    subOffset = verOffset / 4;\r\n                                    floatData[subOffset] = reader.getUint8() / 255;\r\n                                    floatData[subOffset + 1] = reader.getUint8() / 255;\r\n                                    floatData[subOffset + 2] = reader.getUint8() / 255;\r\n                                    floatData[subOffset + 3] = reader.getUint8() / 255;\r\n                                    verOffset += 16;\r\n                                    break;\r\n                                case \"UV\":\r\n                                    subOffset = verOffset / 4;\r\n                                    floatData[subOffset] = HalfFloatUtils.convertToNumber(reader.getUint16());\r\n                                    floatData[subOffset + 1] = HalfFloatUtils.convertToNumber(reader.getUint16());\r\n                                    verOffset += 8;\r\n                                    break;\r\n                                case \"UV1\":\r\n                                    subOffset = verOffset / 4;\r\n                                    floatData[subOffset] = HalfFloatUtils.convertToNumber(reader.getUint16());\r\n                                    floatData[subOffset + 1] = HalfFloatUtils.convertToNumber(reader.getUint16());\r\n                                    verOffset += 8;\r\n                                    break;\r\n                                case \"BLENDWEIGHT\":\r\n                                    subOffset = verOffset / 4;\r\n                                    floatData[subOffset] = reader.getUint8() / 255;\r\n                                    floatData[subOffset + 1] = reader.getUint8() / 255;\r\n                                    floatData[subOffset + 2] = reader.getUint8() / 255;\r\n                                    floatData[subOffset + 3] = reader.getUint8() / 255;\r\n                                    verOffset += 16;\r\n                                    break;\r\n                                case \"BLENDINDICES\":\r\n                                    uint8Data[verOffset] = reader.getUint8();\r\n                                    uint8Data[verOffset + 1] = reader.getUint8();\r\n                                    uint8Data[verOffset + 2] = reader.getUint8();\r\n                                    uint8Data[verOffset + 3] = reader.getUint8();\r\n                                    verOffset += 4;\r\n                                    break;\r\n                                case \"TANGENT\":\r\n                                    subOffset = verOffset / 4;\r\n                                    floatData[subOffset] = reader.getUint8() / 127.5 - 1;\r\n                                    floatData[subOffset + 1] = reader.getUint8() / 127.5 - 1;\r\n                                    floatData[subOffset + 2] = reader.getUint8() / 127.5 - 1;\r\n                                    floatData[subOffset + 3] = reader.getUint8() / 127.5 - 1;\r\n                                    verOffset += 16;\r\n                                    break;\r\n                            }\r\n                        }\r\n                    }\r\n                    reader.pos = lastPosition;\r\n                    break;\r\n            }\r\n\r\n            var vertexBuffer: VertexBuffer3D = Laya3DRender.renderOBJCreate.createVertexBuffer3D(vertexData.byteLength, BufferUsage.Static, true);\r\n            vertexBuffer.vertexDeclaration = vertexDeclaration;\r\n            vertexBuffer.setData(vertexData);\r\n            var vertexCount: number = vertexBuffer._byteLength / vertexDeclaration.vertexStride;\r\n            //TDDO:\r\n            if (vertexCount > 65535)\r\n                mesh._indexFormat = IndexFormat.UInt32;\r\n            else\r\n                mesh._indexFormat = IndexFormat.UInt16;\r\n            mesh._vertexBuffer = vertexBuffer;\r\n            mesh._vertexCount += vertexCount;\r\n            memorySize += floatData.length * 4;\r\n        }\r\n\r\n        var ibStart: number = offset + reader.getUint32();\r\n        var ibLength: number = reader.getUint32();\r\n\r\n        var ibDatas: Uint16Array | Uint32Array;\r\n        if (mesh.indexFormat == IndexFormat.UInt32)\r\n            ibDatas = new Uint32Array(arrayBuffer.slice(ibStart, ibStart + ibLength));\r\n        else\r\n            ibDatas = new Uint16Array(arrayBuffer.slice(ibStart, ibStart + ibLength));\r\n\r\n        var indexBuffer: IndexBuffer3D = Laya3DRender.renderOBJCreate.createIndexBuffer3D(mesh.indexFormat, ibDatas.length, BufferUsage.Static, true);\r\n        indexBuffer.setData(ibDatas);\r\n        mesh._indexBuffer = indexBuffer;\r\n\r\n        mesh._setBuffer(mesh._vertexBuffer, indexBuffer);\r\n\r\n        memorySize += indexBuffer.indexCount * 2;\r\n        mesh._setCPUMemory(memorySize);\r\n        mesh._setGPUMemory(memorySize);\r\n\r\n        if (LoadModelV05._version == \"LAYAMODEL:0501\" || LoadModelV05._version == \"LAYAMODEL:COMPRESSION_0501\" || LoadModelV05._version == \"LAYAMODEL:0502\") {\r\n            var bounds = mesh.bounds;\r\n            var min: Vector3 = bounds.getMin();\r\n            var max: Vector3 = bounds.getMax();\r\n            min.setValue(reader.getFloat32(), reader.getFloat32(), reader.getFloat32());\r\n            max.setValue(reader.getFloat32(), reader.getFloat32(), reader.getFloat32());\r\n            bounds.setMin(min);\r\n            bounds.setMax(max);\r\n            mesh.bounds = bounds;\r\n        }\r\n\r\n        var boneNames: string[] = mesh._boneNames = [];\r\n        var boneCount: number = reader.getUint16();\r\n        boneNames.length = boneCount;\r\n        for (i = 0; i < boneCount; i++)\r\n            boneNames[i] = LoadModelV05._strings[reader.getUint16()];//[]\r\n\r\n        var bindPoseDataStart: number = reader.getUint32();\r\n        var bindPoseDataLength: number = reader.getUint32();\r\n        var bindPoseDatas: Float32Array = new Float32Array(arrayBuffer.slice(offset + bindPoseDataStart, offset + bindPoseDataStart + bindPoseDataLength));\r\n        var bindPoseFloatCount: number = bindPoseDatas.length;\r\n        var bindPoseBuffer: ArrayBuffer = mesh._inverseBindPosesBuffer = new ArrayBuffer(bindPoseFloatCount * 4);//TODO:[NATIVE]\r\n        mesh._inverseBindPoses = [];\r\n        if (bindPoseFloatCount != 0)\r\n            mesh._instanceBufferStateType = Mesh.MESH_INSTANCEBUFFER_TYPE_SIMPLEANIMATOR;\r\n        else\r\n            mesh._instanceBufferStateType = Mesh.MESH_INSTANCEBUFFER_TYPE_NORMAL;\r\n        //mesh._setInstanceBuffer(mesh._instanceBufferStateType);\r\n        for (i = 0; i < bindPoseFloatCount; i += 16) {\r\n            var inverseGlobalBindPose: Matrix4x4 = new Matrix4x4(bindPoseDatas[i + 0], bindPoseDatas[i + 1], bindPoseDatas[i + 2], bindPoseDatas[i + 3], bindPoseDatas[i + 4], bindPoseDatas[i + 5], bindPoseDatas[i + 6], bindPoseDatas[i + 7], bindPoseDatas[i + 8], bindPoseDatas[i + 9], bindPoseDatas[i + 10], bindPoseDatas[i + 11], bindPoseDatas[i + 12], bindPoseDatas[i + 13], bindPoseDatas[i + 14], bindPoseDatas[i + 15], new Float32Array(bindPoseBuffer, i * 4, 16));\r\n            mesh._inverseBindPoses[i / 16] = inverseGlobalBindPose;\r\n        }\r\n\r\n        return true;\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    private static READ_SUBMESH(): boolean {\r\n        var reader: Byte = LoadModelV05._readData;\r\n        var arrayBuffer: ArrayBuffer = reader.__getBuffer();\r\n        var subMesh: SubMesh = new SubMesh(LoadModelV05._mesh);\r\n\r\n        reader.getInt16();//TODO:vbIndex\r\n        var ibStart: number = reader.getUint32();\r\n        var ibCount: number = reader.getUint32();\r\n        var indexBuffer: IndexBuffer3D = LoadModelV05._mesh._indexBuffer;\r\n        subMesh._indexBuffer = indexBuffer;\r\n        subMesh._setIndexRange(ibStart, ibCount);\r\n        var vertexBuffer: VertexBuffer3D = LoadModelV05._mesh._vertexBuffer;\r\n        subMesh._vertexBuffer = vertexBuffer;\r\n\r\n        var offset: number = LoadModelV05._DATA.offset;\r\n        var subIndexBufferStart: number[] = subMesh._subIndexBufferStart;\r\n        var subIndexBufferCount: number[] = subMesh._subIndexBufferCount;\r\n        var boneIndicesList: Uint16Array[] = subMesh._boneIndicesList;\r\n        var drawCount: number = reader.getUint16();\r\n        subIndexBufferStart.length = drawCount;\r\n        subIndexBufferCount.length = drawCount;\r\n        boneIndicesList.length = drawCount;\r\n\r\n        var skinnedCache: skinnedMatrixCache[] = LoadModelV05._mesh._skinnedMatrixCaches;\r\n        var subMeshIndex: number = LoadModelV05._subMeshes.length;\r\n        skinnedCache.length = LoadModelV05._mesh._inverseBindPoses.length;\r\n        for (var i: number = 0; i < drawCount; i++) {\r\n            subIndexBufferStart[i] = reader.getUint32();\r\n            subIndexBufferCount[i] = reader.getUint32();\r\n            var boneDicofs: number = reader.getUint32();\r\n            var boneDicCount: number = reader.getUint32();\r\n            var boneIndices: Uint16Array = boneIndicesList[i] = new Uint16Array(arrayBuffer.slice(offset + boneDicofs, offset + boneDicofs + boneDicCount));\r\n            for (var j: number = 0, m: number = boneIndices.length; j < m; j++) {\r\n                var index: number = boneIndices[j];\r\n                skinnedCache[index] || (skinnedCache[index] = new skinnedMatrixCache(subMeshIndex, i, j));\r\n            }\r\n        }\r\n        LoadModelV05._subMeshes.push(subMesh);\r\n        return true;\r\n    }\r\n\r\n    private static READ_MORPH(): boolean {\r\n\r\n        let reader: Byte = LoadModelV05._readData;\r\n        let arrayBuffer: ArrayBuffer = reader.__getBuffer();\r\n        let offset = LoadModelV05._DATA.offset;\r\n        let mesh = LoadModelV05._mesh;\r\n\r\n        let morphData = mesh.morphTargetData = new MorphTargetData();\r\n\r\n        let morphVertexDecStr = LoadModelV05._strings[reader.getUint16()];\r\n\r\n        morphData.vertexDec = VertexMesh.getVertexDeclaration(morphVertexDecStr);\r\n\r\n        let bounds = morphData.bounds;\r\n        let min = bounds.getMin();\r\n        let max = bounds.getMax();\r\n        min.set(reader.getFloat32(), reader.getFloat32(), reader.getFloat32());\r\n        max.set(reader.getFloat32(), reader.getFloat32(), reader.getFloat32());\r\n        bounds.setMin(min);\r\n        bounds.setMax(max);\r\n\r\n        let channelCount = reader.readUint16();\r\n\r\n        for (let channelIndex = 0; channelIndex < channelCount; channelIndex++) {\r\n            let channel = new MorphTargetChannel();\r\n            channel.name = LoadModelV05._strings[reader.getUint16()];\r\n            let targetCount = reader.readUint16();\r\n            for (let targetIndex = 0; targetIndex < targetCount; targetIndex++) {\r\n                let target = new MorphTarget();\r\n                let targetName = LoadModelV05._strings[reader.getUint16()];\r\n                target.name = targetName;\r\n                target.fullWeight = reader.readFloat32();\r\n                let bufferStart = reader.readUint32();\r\n                let bufferLength = reader.readUint32();\r\n                target.data = new Float32Array(arrayBuffer.slice(offset + bufferStart, offset + bufferStart + bufferLength));\r\n\r\n                channel.addTarget(target);\r\n            }\r\n            morphData.addMorphChannel(channel);\r\n        }\r\n\r\n        morphData.vertexCount = mesh.vertexCount;\r\n        morphData.initData();\r\n\r\n        return true;\r\n    }\r\n\r\n    private static READ_UVSIZE(): void {\r\n        LoadModelV05._mesh._width = LoadModelV05._readData.readUint16();\r\n        LoadModelV05._mesh._height = LoadModelV05._readData.readUint16();\r\n    }\r\n}\r\n\r\n\r\n","import { Byte } from \"../../utils/Byte\";\r\nimport { Mesh } from \"../resource/models/Mesh\";\r\nimport { SubMesh } from \"../resource/models/SubMesh\";\r\nimport { LoadModelV04 } from \"./LoadModelV04\";\r\nimport { LoadModelV05 } from \"./LoadModelV05\";\r\n\r\n/**\r\n * @internal\r\n */\r\nexport class MeshReader {\r\n\t/**\r\n\t */\r\n\tstatic _parse(data: ArrayBuffer): Mesh {\r\n\t\tvar mesh: Mesh = new Mesh();\r\n\t\tMeshReader.read(data, mesh, mesh._subMeshes);\r\n\t\treturn mesh;\r\n\t}\r\n\r\n\tstatic read(data: ArrayBuffer, mesh: Mesh, subMeshes: SubMesh[]): void {\r\n\t\tvar readData: Byte = new Byte(data);\r\n\t\treadData.pos = 0;\r\n\t\tvar version: string = readData.readUTFString();\r\n\t\tswitch (version) {\r\n\t\t\tcase \"LAYAMODEL:0301\":\r\n\t\t\tcase \"LAYAMODEL:0400\":\r\n\t\t\tcase \"LAYAMODEL:0401\":\r\n\t\t\t\tLoadModelV04.parse(readData, version, mesh, subMeshes);\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"LAYAMODEL:05\":\r\n\t\t\tcase \"LAYAMODEL:COMPRESSION_05\":\r\n\t\t\tcase \"LAYAMODEL:0501\":\r\n\t\t\tcase \"LAYAMODEL:COMPRESSION_0501\":\r\n\t\t\tcase \"LAYAMODEL:0502\":\r\n\t\t\t\tLoadModelV05.parse(readData, version, mesh, subMeshes);\r\n\t\t\t\tbreak;\r\n\t\t\tdefault:\r\n\t\t\t\tthrow new Error(\"unknown mesh version: \" + version);\r\n\t\t}\r\n\t\tmesh._setSubMeshes(subMeshes);\r\n\t\tif (version != \"LAYAMODEL:0501\" && version != \"LAYAMODEL:COMPRESSION_0501\" && version != \"LAYAMODEL:0502\")//compatible\r\n\t\t\tmesh.calculateBounds();\r\n\t}\r\n}\r\n\r\n","import { IResourceLoader, ILoadTask, Loader } from \"../../net/Loader\";\r\nimport { AssetDb } from \"../../resource/AssetDb\";\r\nimport { MeshReader } from \"./MeshReader\";\r\n\r\nclass MeshLoader implements IResourceLoader {\r\n    load(task: ILoadTask) {\r\n        let url = AssetDb.inst.getSubAssetURL(task.url, task.uuid, null, \"lm\");\r\n        return task.loader.fetch(url, \"arraybuffer\", task.progress.createCallback(), task.options).then(data => {\r\n            if (!data)\r\n                return null;\r\n\r\n            return MeshReader._parse(data);\r\n        });\r\n    }\r\n}\r\n\r\nLoader.registerLoader([\"lm\"], MeshLoader, Loader.MESH);","import { Component } from \"../../components/Component\";\r\nimport { Node } from \"../../display/Node\";\r\nimport { Camera } from \"../core/Camera\";\r\nimport { DirectionLight } from \"../core/light/DirectionLight\";\r\nimport { PointLight } from \"../core/light/PointLight\";\r\nimport { SpotLight } from \"../core/light/SpotLight\";\r\nimport { MeshSprite3D } from \"../core/MeshSprite3D\";\r\nimport { ShuriKenParticle3D } from \"../core/particleShuriKen/ShuriKenParticle3D\";\r\nimport { RenderableSprite3D } from \"../core/RenderableSprite3D\";\r\nimport { Scene3D } from \"../core/scene/Scene3D\";\r\nimport { SkinnedMeshSprite3D } from \"../core/SkinnedMeshSprite3D\";\r\nimport { Sprite3D } from \"../core/Sprite3D\";\r\nimport { TrailSprite3D } from \"../core/trail/TrailSprite3D\";\r\nimport { ClassUtils } from \"../../utils/ClassUtils\";\r\nimport { SimpleSkinnedMeshSprite3D } from \"../core/SimpleSkinnedMeshSprite3D\";\r\nimport { ILoadURL, Loader } from \"../../net/Loader\";\r\nimport { URL } from \"../../net/URL\";\r\nimport { HierarchyLoader } from \"../../loaders/HierarchyLoader\";\r\nimport { ReflectionProbe } from \"../component/Volume/reflectionProbe/ReflectionProbe\";\r\n\r\n/**\r\n * @internal\r\n * <code>Utils3D</code> 3D\r\n */\r\nclass HierarchyParserV2 {\r\n    /**\r\n     * @internal\r\n     * @param nodeData \r\n     * @param spriteMap \r\n     * @param outBatchSprites \r\n     */\r\n    private static _createSprite3DInstance(nodeData: any, spriteMap: any, outBatchSprites: RenderableSprite3D[]): Node {\r\n        let node: Node;\r\n        switch (nodeData.type) {\r\n            case \"Scene3D\":\r\n                node = new Scene3D();\r\n                break;\r\n            case \"Sprite3D\":\r\n                node = new Sprite3D();\r\n                break;\r\n            case \"MeshSprite3D\":\r\n                node = new MeshSprite3D();\r\n                (outBatchSprites && nodeData.props.isStatic) && (outBatchSprites.push(<MeshSprite3D>node));\r\n                break;\r\n            case \"SkinnedMeshSprite3D\":\r\n                node = new SkinnedMeshSprite3D();\r\n                break;\r\n            case \"SimpleSkinnedMeshSprite3D\":\r\n                node = new SimpleSkinnedMeshSprite3D();\r\n                break;\r\n            case \"ShuriKenParticle3D\":\r\n                node = new ShuriKenParticle3D();\r\n                break;\r\n            case \"Camera\":\r\n                node = new Camera();\r\n                break;\r\n            case \"DirectionLight\":\r\n                node = new DirectionLight();\r\n                break;\r\n            case \"PointLight\":\r\n                node = new PointLight();\r\n                break;\r\n            case \"SpotLight\":\r\n                node = new SpotLight();\r\n                break;\r\n            case \"TrailSprite3D\":\r\n                node = new TrailSprite3D();\r\n                break;\r\n            case \"ReflectionProbe\":\r\n                node = new Sprite3D();\r\n                node.addComponent(ReflectionProbe);\r\n                break;\r\n            default:\r\n                throw new Error(\"Utils3D:unidentified class type in (.lh) file.\");\r\n        }\r\n\r\n        let childData: any[] = nodeData.child;\r\n        if (childData) {\r\n            for (let i: number = 0, n: number = childData.length; i < n; i++) {\r\n                let child: any = HierarchyParserV2._createSprite3DInstance(childData[i], spriteMap, outBatchSprites)\r\n                node.addChild(child);\r\n            }\r\n        }\r\n\r\n        spriteMap[nodeData.instanceID] = node;\r\n        return node;\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     * @param nodeData \r\n     * @param spriteMap \r\n     * @param interactMap \r\n     */\r\n    private static _createComponentInstance(nodeData: any, spriteMap: any, interactMap: any): void {\r\n        let node: Node = spriteMap[nodeData.instanceID];\r\n        node._parse(nodeData.props, spriteMap);\r\n\r\n        let childData: any[] = nodeData.child;\r\n        if (childData) {\r\n            for (let i: number = 0, n: number = childData.length; i < n; i++)\r\n                HierarchyParserV2._createComponentInstance(childData[i], spriteMap, interactMap)\r\n        }\r\n\r\n        let componentsData: any[] = nodeData.components;\r\n        if (componentsData) {\r\n            for (let j: number = 0, m: number = componentsData.length; j < m; j++) {\r\n                let data: any = componentsData[j];\r\n                let cls: any = ClassUtils.getClass(data.type);\r\n                if (cls) {\r\n                    let component: Component = node.addComponent(cls);\r\n                    component._parse(data, interactMap);\r\n                } else {\r\n                    console.warn(`Unidentified component type: ${data.type}.`);\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    static _createNodeByJson02(nodeData: any, outBatchSprites: RenderableSprite3D[]): Node {\r\n        let spriteMap: any = {};\r\n        let interactMap: any = { component: [], data: [] };\r\n        let node: Node = HierarchyParserV2._createSprite3DInstance(nodeData, spriteMap, outBatchSprites);\r\n        HierarchyParserV2._createComponentInstance(nodeData, spriteMap, interactMap);\r\n        HierarchyParserV2._createInteractInstance(interactMap, spriteMap);\r\n        return node;\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    static _createInteractInstance(interatMap: any, spriteMap: any) {\r\n        let components: Component[] = interatMap.component;\r\n        let data = interatMap.data;\r\n        for (let i = 0, n = components.length; i < n; i++) {\r\n            components[i]._parseInteractive(data[i], spriteMap);\r\n        }\r\n    }\r\n\r\n    /**\r\n     *@internal\r\n     */\r\n    static parse(data: any) {\r\n        let json: any = data.data;\r\n        let outBatchSprits: RenderableSprite3D[] = [];\r\n        let sprite: Sprite3D | Scene3D;\r\n        switch (data.version) {\r\n            case \"LAYAHIERARCHY:02\":\r\n            case \"LAYASCENE3D:02\":\r\n                sprite = (<Sprite3D | Scene3D>HierarchyParserV2._createNodeByJson02(json, outBatchSprits));\r\n                break;\r\n            default:\r\n                sprite = (<Sprite3D | Scene3D>HierarchyParserV2._createNodeByJson(json, outBatchSprits));\r\n        }\r\n\r\n        //StaticBatchManager.combine((sprite instanceof Sprite3D) ? sprite : null, outBatchSprits);\r\n        return sprite;\r\n    }\r\n\r\n    //--------------------------------------------------------------------------------------------------------------------------------\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    static _createNodeByJson(nodeData: any, outBatchSprites: RenderableSprite3D[]): Node {//\r\n        let node: Node;\r\n        switch (nodeData.type) {\r\n            case \"Scene3D\":\r\n                node = new Scene3D();\r\n                break;\r\n            case \"Sprite3D\":\r\n                node = new Sprite3D();\r\n                break;\r\n            case \"MeshSprite3D\":\r\n                node = new MeshSprite3D();\r\n                (outBatchSprites && nodeData.props.isStatic) && (outBatchSprites.push(<MeshSprite3D>node));\r\n                break;\r\n            case \"SkinnedMeshSprite3D\":\r\n                node = new SkinnedMeshSprite3D();\r\n                break;\r\n            case \"ShuriKenParticle3D\":\r\n                node = new ShuriKenParticle3D();\r\n                break;\r\n            case \"Camera\":\r\n                node = new Camera();\r\n                break;\r\n            case \"DirectionLight\":\r\n                node = new DirectionLight();\r\n                break;\r\n            case \"PointLight\":\r\n                node = new PointLight();\r\n                break;\r\n            case \"SpotLight\":\r\n                node = new SpotLight();\r\n                break;\r\n            case \"TrailSprite3D\":\r\n                node = new TrailSprite3D();\r\n                break;\r\n            default:\r\n                throw new Error(`Unidentified node type ${nodeData.type}`);\r\n        }\r\n\r\n        let childData: any[] = nodeData.child;\r\n        if (childData) {\r\n            for (let i: number = 0, n: number = childData.length; i < n; i++) {\r\n                let child: any = HierarchyParserV2._createNodeByJson(childData[i], outBatchSprites)\r\n                node.addChild(child);\r\n            }\r\n        }\r\n\r\n        let componentsData: any[] = nodeData.components;\r\n        if (componentsData) {\r\n            for (let j: number = 0, m: number = componentsData.length; j < m; j++) {\r\n                let data: any = componentsData[j];\r\n                let clas: any = ClassUtils.getClass(data.type);\r\n                if (clas) {\r\n                    let component: Component = node.addComponent(clas);\r\n                    component._parse(data);\r\n                } else {\r\n                    console.warn(`Unidentified component type: ${data.type}.`);\r\n                }\r\n            }\r\n        }\r\n        node._parse(nodeData.props, null);\r\n        return node;\r\n    }\r\n\r\n    public static collectResourceLinks(data: any, basePath: string): (string | ILoadURL)[] {\r\n        let test: Record<string, string> = {};\r\n        let innerUrls: ILoadURL[] = [];\r\n\r\n        function addInnerUrl(url: string, type: string, constructParams?: any, propertyParams?: any) {\r\n            let url2 = test[url];\r\n            if (url2 === undefined) {\r\n                url2 = URL.join(basePath, url);\r\n                innerUrls.push({ url: url2, type: type, constructParams: constructParams, propertyParams: propertyParams });\r\n                test[url] = url2;\r\n            }\r\n            return url2;\r\n        }\r\n\r\n        function check(nodeData: any) {\r\n            let props: any = nodeData.props;\r\n            switch (nodeData.type) {\r\n                case \"Scene3D\":\r\n                    let lightmaps: any[] = props.lightmaps;\r\n                    if (lightmaps) {\r\n                        for (let i = 0, n = lightmaps.length; i < n; i++) {\r\n                            let lightMap: any = lightmaps[i];\r\n                            if (lightMap.path) {\r\n                                lightMap.path = addInnerUrl(lightMap.path, Loader.TEXTURE2D, lightMap.constructParams, lightMap.propertyParams);\r\n                            }\r\n                            else {\r\n                                let lightmapColorData: any = lightMap.color;\r\n                                lightmapColorData.path = addInnerUrl(lightmapColorData.path, Loader.TEXTURE2D, lightmapColorData.constructParams, lightmapColorData.propertyParams);\r\n                                let lightmapDirectionData: any = lightMap.direction;\r\n                                if (lightmapDirectionData)\r\n                                    lightmapDirectionData.path = addInnerUrl(lightmapDirectionData.path, Loader.TEXTURE2D, lightmapDirectionData.constructParams, lightmapDirectionData.propertyParams);\r\n                            }\r\n                        }\r\n                    }\r\n\r\n                    //\r\n                    let reflectionTextureData: string = props.reflectionTexture;\r\n                    (reflectionTextureData) && (props.reflection = addInnerUrl(reflectionTextureData, Loader.TEXTURECUBE));\r\n\r\n                    let reflectionData: string = props.reflection;\r\n                    (reflectionData) && (props.reflection = addInnerUrl(reflectionData, Loader.TEXTURECUBE));\r\n                    if (props.sky) {\r\n                        let skyboxMaterial: any = props.sky.material;\r\n                        (skyboxMaterial) && (skyboxMaterial.path = addInnerUrl(skyboxMaterial.path, Loader.MATERIAL));\r\n                    }\r\n                    break;\r\n                case \"Camera\":\r\n                    let skyboxMatData: any = props.skyboxMaterial;\r\n                    (skyboxMatData) && (skyboxMatData.path = addInnerUrl(skyboxMatData.path, Loader.MATERIAL));\r\n                    break;\r\n                case \"TrailSprite3D\":\r\n                case \"MeshSprite3D\":\r\n                case \"SkinnedMeshSprite3D\":\r\n                case \"SimpleSkinnedMeshSprite3D\":\r\n                    let meshPath: string = props.meshPath;\r\n                    (meshPath) && (props.meshPath = addInnerUrl(meshPath, Loader.MESH));\r\n                    let materials: any[] = props.materials;\r\n                    if (materials)\r\n                        for (let i = 0, n = materials.length; i < n; i++)\r\n                            materials[i].path = addInnerUrl(materials[i].path, Loader.MATERIAL);\r\n                    if (nodeData.type == \"SimpleSkinnedMeshSprite3D\")\r\n                        if (props.animatorTexture)\r\n                            props.animatorTexture = addInnerUrl(props.animatorTexture, Loader.TEXTURE2D)\r\n                    break;\r\n\r\n                case \"ShuriKenParticle3D\":\r\n                    if (props.main) {\r\n                        let resources: any = props.renderer.resources;\r\n                        let mesh: string = resources.mesh;\r\n                        let material: string = resources.material;\r\n                        (mesh) && (resources.mesh = addInnerUrl(mesh, Loader.MESH));\r\n                        (material) && (resources.material = addInnerUrl(material, Loader.MATERIAL));\r\n                    }\r\n                    else {//\r\n                        let parMeshPath: string = props.meshPath;\r\n                        (parMeshPath) && (props.meshPath = addInnerUrl(parMeshPath, Loader.MESH));\r\n                        props.material.path = addInnerUrl(props.material.path, Loader.MATERIAL);\r\n                    }\r\n                    break;\r\n                case \"Terrain\":\r\n                    addInnerUrl(props.dataPath, Loader.TERRAINRES);\r\n                    break;\r\n                case \"ReflectionProbe\":\r\n                    let reflection = props.reflection;\r\n                    (reflection) && (props.reflection = addInnerUrl(reflection, Loader.TEXTURECUBE));\r\n                    break;\r\n            }\r\n\r\n            let components: any[] = nodeData.components;\r\n            if (components) {\r\n                for (let k: number = 0, p: number = components.length; k < p; k++) {\r\n                    let component: any = components[k];\r\n                    switch (component.type) {\r\n                        case \"Animator\":\r\n                            // let avatarData: any = component.avatar;\r\n                            // (avatarData) && (avatarData.path = addInnerUrl(avatarData.path, Loader.AVATAR));\r\n                            let clipPaths: string[] = component.clipPaths;\r\n                            if (!clipPaths) {\r\n                                let layersData: any[] = component.layers;\r\n                                for (let i = 0; i < layersData.length; i++) {\r\n                                    let states: any[] = layersData[i].states;\r\n                                    for (let j: number = 0, m: number = states.length; j < m; j++) {\r\n                                        let clipPath: string = states[j].clipPath;\r\n                                        (clipPath) && (states[j].clipPath = addInnerUrl(clipPath, Loader.ANIMATIONCLIP));\r\n                                    }\r\n                                }\r\n                            } else {\r\n                                for (let i = 0, n = clipPaths.length; i < n; i++)\r\n                                    clipPaths[i] = addInnerUrl(clipPaths[i], Loader.ANIMATIONCLIP);\r\n                            }\r\n                            break;\r\n                        case \"PhysicsCollider\":\r\n                        case \"Rigidbody3D\":\r\n                        case \"CharacterController\":\r\n                            let shapes: any[] = component.shapes;\r\n                            for (let i = 0; i < shapes.length; i++) {\r\n                                let shape: any = shapes[i];\r\n                                if (shape.type === \"MeshColliderShape\") {\r\n                                    let mesh: string = shape.mesh;\r\n                                    (mesh) && (shape.mesh = addInnerUrl(mesh, Loader.MESH));\r\n                                }\r\n                            }\r\n                            break;\r\n                    }\r\n                }\r\n            }\r\n\r\n            let children: any[] = nodeData.child;\r\n            if (!children) return;\r\n            for (let i = 0, n = children.length; i < n; i++)\r\n                check(children[i]);\r\n        }\r\n\r\n        check(data.data);\r\n\r\n        return innerUrls;\r\n    }\r\n}\r\n\r\nHierarchyLoader.v2 = HierarchyParserV2;","import { IResourceLoader, ILoadTask, Loader } from \"../../net/Loader\";\r\nimport { AvatarMask } from \"../component/Animator/AvatarMask\";\r\n\r\nclass AvatarMaskLoader implements IResourceLoader {\r\n    load(task: ILoadTask) {\r\n        return task.loader.fetch(task.url, \"json\", task.progress.createCallback(), task.options).then(data => {\r\n            if (!data)\r\n                return null;\r\n\r\n            return new AvatarMask(data);\r\n        });\r\n}\r\n}\r\n\r\nLoader.registerLoader([\"lavm\"], AvatarMaskLoader);","import { ILoadTask, IResourceLoader, Loader } from \"../../net/Loader\";\r\nimport { ShaderCompile } from \"../../webgl/utils/ShaderCompile\";\r\n\r\nclass GLSLLoader implements IResourceLoader {\r\n    load(task: ILoadTask) {\r\n        let url = task.url;\r\n        return task.loader.fetch(url, \"text\", task.progress.createCallback(), task.options).then(data => {\r\n            if (!data)\r\n                return null;\r\n\r\n            return ShaderCompile.addInclude(task.url, data, true);\r\n        });\r\n    }\r\n}\r\n\r\nLoader.registerLoader([\"glsl\", \"vs\", \"fs\"], GLSLLoader);","import { TypeAnimatorLayer, TypeAnimatorState } from \"../../components/AnimatorControllerParse\";\r\nimport { IResourceLoader, ILoadTask, Loader } from \"../../net/Loader\";\r\nimport { AnimatorController } from \"../component/Animator/AnimatorController\";\r\nimport { URL } from \"../../net/URL\";\r\nclass AnimationControllerLoader implements IResourceLoader {\r\n    load(task: ILoadTask) {\r\n        return task.loader.fetch(task.url, \"json\", task.progress.createCallback(0.2), task.options).then(data => {\r\n            let ret = new AnimatorController(data);\r\n            if (ret.data && ret.data.controllerLayers) {\r\n                let layers = ret.data.controllerLayers;\r\n                let promises: Array<any> = [];\r\n                for (let i = layers.length - 1; i >= 0; i--) {\r\n                    if (layers[i].avatarMask) {\r\n                        this.loadAvatarMask(layers[i], promises, task);\r\n                    }\r\n                    let states = layers[i].states;\r\n                    this.loadStates(states, promises, task);\r\n\r\n                }\r\n                return Promise.all(promises).then(() => ret);\r\n            }\r\n            else\r\n                return ret;\r\n        });\r\n    }\r\n    loadAvatarMask(l: TypeAnimatorLayer, promises: Array<any>, task: ILoadTask) {\r\n        let basePath = URL.getPath(task.url);\r\n        if (l.avatarMask && l.avatarMask._$uuid && '' != l.avatarMask._$uuid) {\r\n            let url = URL.getResURLByUUID(l.avatarMask._$uuid);\r\n            if (!url.startsWith(\"res://\"))\r\n                url = URL.join(basePath, url);\r\n            promises.push(task.loader.load(url).then(res => {\r\n                l.avatarMask = res;\r\n            }));\r\n        } else {\r\n            l.avatarMask = null;\r\n        }\r\n    }\r\n\r\n    loadStates(states: TypeAnimatorState[], promises: Array<any>, task: ILoadTask) {\r\n        let basePath = URL.getPath(task.url);\r\n        for (let j = states.length - 1; j >= 0; j--) {\r\n            if (states[j].clip && states[j].clip._$uuid) {\r\n                let url = URL.getResURLByUUID(states[j].clip._$uuid);\r\n                if (!url.startsWith(\"res://\"))\r\n                    url = URL.join(basePath, url);\r\n                promises.push(task.loader.load(url).then(res => {\r\n                    states[j].clip = res;\r\n                }));\r\n\r\n                // promises.push(task.loader.load(\"res://\" + states[j].clip._$uuid).then(res => {\r\n                //     states[j].clip = res;\r\n                // }));\r\n            }\r\n\r\n            if (states[j].states) {\r\n                this.loadStates(states[j].states, promises, task);\r\n            }\r\n        }\r\n    }\r\n}\r\n\r\nLoader.registerLoader([\"controller\"], AnimationControllerLoader);","import { ClassUtils } from \"../utils/ClassUtils\";\r\nimport { AnimationClip } from \"./animation/AnimationClip\";\r\nimport { Sprite3D } from \"./core/Sprite3D\";\r\nimport { Camera } from \"./core/Camera\";\r\nimport { Gradient } from \"./core/Gradient\";\r\nimport { DirectionLight } from \"./core/light/DirectionLight\";\r\nimport { LightSprite } from \"./core/light/LightSprite\";\r\nimport { PointLight } from \"./core/light/PointLight\";\r\nimport { SpotLight } from \"./core/light/SpotLight\";\r\nimport { BlinnPhongMaterial } from \"./core/material/BlinnPhongMaterial\";\r\nimport { EffectMaterial } from \"./core/material/EffectMaterial\";\r\nimport { ExtendTerrainMaterial } from \"./core/material/ExtendTerrainMaterial\";\r\nimport { Material } from \"../resource/Material\";\r\nimport { PBRStandardMaterial } from \"./core/material/PBRStandardMaterial\";\r\nimport { SkyBoxMaterial } from \"./core/material/SkyBoxMaterial\";\r\nimport { SkyPanoramicMaterial } from \"./core/material/SkyPanoramicMaterial\";\r\nimport { SkyProceduralMaterial } from \"./core/material/SkyProceduralMaterial\";\r\nimport { UnlitMaterial } from \"./core/material/UnlitMaterial\";\r\nimport { WaterPrimaryMaterial } from \"./core/material/WaterPrimaryMaterial\";\r\nimport { MeshFilter } from \"./core/MeshFilter\";\r\nimport { MeshRenderer } from \"./core/MeshRenderer\";\r\nimport { MeshSprite3D } from \"./core/MeshSprite3D\";\r\nimport { Burst } from \"./core/particleShuriKen/module/Burst\";\r\nimport { ColorOverLifetime } from \"./core/particleShuriKen/module/ColorOverLifetime\";\r\nimport { Emission } from \"./core/particleShuriKen/module/Emission\";\r\nimport { FrameOverTime } from \"./core/particleShuriKen/module/FrameOverTime\";\r\nimport { GradientAngularVelocity } from \"./core/particleShuriKen/module/GradientAngularVelocity\";\r\nimport { GradientColor } from \"./core/particleShuriKen/module/GradientColor\";\r\nimport { GradientDataInt } from \"./core/particleShuriKen/module/GradientDataInt\";\r\nimport { GradientDataNumber } from \"./core/particleShuriKen/module/GradientDataNumber\";\r\nimport { GradientSize } from \"./core/particleShuriKen/module/GradientSize\";\r\nimport { GradientVelocity } from \"./core/particleShuriKen/module/GradientVelocity\";\r\nimport { RotationOverLifetime } from \"./core/particleShuriKen/module/RotationOverLifetime\";\r\nimport { BaseShape } from \"./core/particleShuriKen/module/shape/BaseShape\";\r\nimport { BoxShape } from \"./core/particleShuriKen/module/shape/BoxShape\";\r\nimport { CircleShape } from \"./core/particleShuriKen/module/shape/CircleShape\";\r\nimport { ConeShape } from \"./core/particleShuriKen/module/shape/ConeShape\";\r\nimport { HemisphereShape } from \"./core/particleShuriKen/module/shape/HemisphereShape\";\r\nimport { SphereShape } from \"./core/particleShuriKen/module/shape/SphereShape\";\r\nimport { SizeOverLifetime } from \"./core/particleShuriKen/module/SizeOverLifetime\";\r\nimport { StartFrame } from \"./core/particleShuriKen/module/StartFrame\";\r\nimport { TextureSheetAnimation } from \"./core/particleShuriKen/module/TextureSheetAnimation\";\r\nimport { VelocityOverLifetime } from \"./core/particleShuriKen/module/VelocityOverLifetime\";\r\nimport { ShuriKenParticle3D } from \"./core/particleShuriKen/ShuriKenParticle3D\";\r\nimport { ShurikenParticleMaterial } from \"./core/particleShuriKen/ShurikenParticleMaterial\";\r\nimport { ShurikenParticleRenderer } from \"./core/particleShuriKen/ShurikenParticleRenderer\";\r\nimport { ShurikenParticleSystem } from \"./core/particleShuriKen/ShurikenParticleSystem\";\r\nimport { BaseRender } from \"./core/render/BaseRender\";\r\nimport { RenderableSprite3D } from \"./core/RenderableSprite3D\";\r\nimport { Lightmap } from \"./core/scene/Lightmap\";\r\nimport { Scene3D } from \"./core/scene/Scene3D\";\r\nimport { SimpleSkinnedMeshRenderer } from \"./core/SimpleSkinnedMeshRenderer\";\r\nimport { SimpleSkinnedMeshSprite3D } from \"./core/SimpleSkinnedMeshSprite3D\";\r\nimport { SkinnedMeshRenderer } from \"./core/SkinnedMeshRenderer\";\r\nimport { SkinnedMeshSprite3D } from \"./core/SkinnedMeshSprite3D\";\r\nimport { TrailFilter } from \"./core/trail/TrailFilter\";\r\nimport { TrailMaterial } from \"./core/trail/TrailMaterial\";\r\nimport { TrailRenderer } from \"./core/trail/TrailRenderer\";\r\nimport { TrailSprite3D } from \"./core/trail/TrailSprite3D\";\r\nimport { Transform3D } from \"./core/Transform3D\";\r\nimport { SphericalHarmonicsL2 } from \"./graphics/SphericalHarmonicsL2\";\r\nimport { BoundBox } from \"./math/BoundBox\";\r\nimport { Viewport } from \"./math/Viewport\";\r\nimport { Mesh } from \"./resource/models/Mesh\";\r\nimport { SkyRenderer } from \"./resource/models/SkyRenderer\";\r\nimport { TextureCube } from \"../resource/TextureCube\";\r\nimport { DirectionLightCom } from \"./core/light/DirectionLightCom\";\r\nimport { PointLightCom } from \"./core/light/PointLightCom\";\r\nimport { SpotLightCom } from \"./core/light/SpotLightCom\";\r\nimport { Bounds } from \"./math/Bounds\";\r\nimport { ReflectionProbe } from \"./component/Volume/reflectionProbe/ReflectionProbe\";\r\nimport { VolumetricGI } from \"./component/Volume/VolumetricGI/VolumetricGI\";\r\nimport { AreaLightCom } from \"./core/light/AreaLightCom\";\r\nimport { LODGroup, LODInfo } from \"./component/LODGroup\";\r\nimport { PixelLineData } from \"./core/pixelLine/PixelLineData\";\r\nimport { PixelLineRenderer } from \"./core/pixelLine/PixelLineRenderer\";\r\nimport { FloatKeyframe } from \"./core/FloatKeyframe\";\r\nimport { Animator } from \"./component/Animator/Animator\";\r\nimport { AnimatorControllerLayer } from \"./component/Animator/AnimatorControllerLayer\";\r\nimport { AnimatorState } from \"./component/Animator/AnimatorState\";\r\nimport { AvatarMask } from \"./component/Animator/AvatarMask\";\r\nimport { PostProcess } from \"./component/PostProcess\";\r\nimport { PostProcessEffect } from \"./core/render/PostProcessEffect\";\r\nimport { BloomEffect } from \"./core/render/PostEffect/BloomEffect\";\r\nimport { GaussianDoF } from \"./core/render/PostEffect/GaussianDoF\";\r\nimport { ScalableAO } from \"./core/render/PostEffect/ScalableAO\";\r\nimport { AnimatorController } from \"./component/Animator/AnimatorController\";\r\nimport { StaticBatchVolume } from \"./component/Volume/BatchVolume/StaticBatchVolume\";\r\nimport { StaticInstanceBatchRender } from \"./component/Volume/BatchVolume/StaticInstanceBatchRender\";\r\nimport { RenderTexture } from \"../resource/RenderTexture\";\r\nimport { ColorGradEffect } from \"./core/render/PostEffect/ColorGradEffect\";\r\nimport { UI3D } from \"./core/UI3D/UI3D\";\r\nimport { LensFlareData, LensFlareEffect, LensFlareElement } from \"./core/render/PostEffect/LensFlares/LensFlareEffect\";\r\nimport \"./loaders/AnimationClipLoader\";\r\nimport \"./loaders/CubemapLoader\";\r\nimport \"./loaders/MeshLoader\";\r\nimport \"./loaders/HierarchyParserV2\";\r\nimport \"./loaders/AvatarMaskLoader\";\r\nimport \"./loaders/GLSLLoader\";\r\nimport \"./loaders/AnimationControllerLoader\";\r\n\r\nlet c = ClassUtils.regClass;\r\nc(\"Sprite3D\", Sprite3D);\r\nc(\"Scene3D\", Scene3D);\r\nc(\"Camera\", Camera);\r\nc(\"LightSprite\", LightSprite);\r\nc(\"DirectionLight\", DirectionLight);\r\nc(\"PointLight\", PointLight);\r\nc(\"SpotLight\", SpotLight);\r\nc(\"AreaLightCom\", AreaLightCom);\r\nc(\"DirectionLightCom\", DirectionLightCom);\r\nc(\"PointLightCom\", PointLightCom);\r\nc(\"SpotLightCom\", SpotLightCom);\r\nc(\"RenderableSprite3D\", RenderableSprite3D);\r\nc(\"MeshSprite3D\", MeshSprite3D);\r\nc(\"MeshFilter\", MeshFilter);\r\nc(\"BaseRender\", BaseRender);\r\nc(\"MeshRenderer\", MeshRenderer);\r\nc(\"SimpleSkinnedMeshSprite3D\", SimpleSkinnedMeshSprite3D);\r\nc(\"SkinnedMeshSprite3D\", SkinnedMeshSprite3D);\r\nc(\"SkinnedMeshRenderer\", SkinnedMeshRenderer);\r\nc(\"SimpleSkinnedMeshRenderer\", SimpleSkinnedMeshRenderer);\r\nc(\"SkyRenderer\", SkyRenderer);\r\nc(\"TrailSprite3D\", TrailSprite3D);\r\nc(\"TrailFilter\", TrailFilter);\r\nc(\"TrailRenderer\", TrailRenderer);\r\nc(\"PixelLineRenderer\", PixelLineRenderer);\r\nc(\"PixelLineData\", PixelLineData);\r\nc(\"Gradient\", Gradient);\r\nc(\"Transform3D\", Transform3D);\r\nc(\"Lightmap\", Lightmap);\r\nc(\"ReflectionProbe\", ReflectionProbe);\r\nc(\"VolumetricGI\", VolumetricGI);\r\nc(\"StaticBatchVolume\", StaticBatchVolume);\r\nc(\"StaticInstanceBatchRender\", StaticInstanceBatchRender);\r\nc(\"SphericalHarmonicsL2\", SphericalHarmonicsL2);\r\nc(\"Viewport\", Viewport);\r\nc(\"Bounds\", Bounds);\r\nc(\"BoundBox\", BoundBox);\r\nc(\"TextureCube\", TextureCube);\r\nc(\"Mesh\", Mesh);\r\nc(\"FloatKeyframe\", FloatKeyframe);\r\nc(\"RenderTexture\", RenderTexture);\r\nc(\"Animator\", Animator);\r\nc(\"AnimatorController\", AnimatorController);\r\nc(\"AnimatorControllerLayer\", AnimatorControllerLayer);\r\nc(\"AnimatorState\", AnimatorState);\r\nc(\"AnimationClip\", AnimationClip);\r\nc(\"AvatarMask\", AvatarMask);\r\nc(\"UI3D\", UI3D);\r\n\r\nc(\"Material\", Material);\r\nc(\"BlinnPhongMaterial\", BlinnPhongMaterial);\r\nc(\"EffectMaterial\", EffectMaterial);\r\nc(\"ExtendTerrainMaterial\", ExtendTerrainMaterial);\r\nc(\"PBRStandardMaterial\", PBRStandardMaterial);\r\nc(\"SkyBoxMaterial\", SkyBoxMaterial);\r\nc(\"SkyPanoramicMaterial\", SkyPanoramicMaterial);\r\nc(\"SkyProceduralMaterial\", SkyProceduralMaterial);\r\nc(\"UnlitMaterial\", UnlitMaterial);\r\nc(\"WaterPrimaryMaterial\", WaterPrimaryMaterial);\r\nc(\"ShurikenParticleMaterial\", ShurikenParticleMaterial);\r\nc(\"TrailMaterial\", TrailMaterial);\r\n\r\nc(\"ShuriKenParticle3D\", ShuriKenParticle3D);\r\nc(\"ShurikenParticleRenderer\", ShurikenParticleRenderer);\r\nc(\"ShurikenParticleSystem\", ShurikenParticleSystem);\r\nc(\"Burst\", Burst);\r\nc(\"Emission\", Emission);\r\nc(\"BaseShape\", BaseShape);\r\nc(\"BoxShape\", BoxShape);\r\nc(\"CircleShape\", CircleShape);\r\nc(\"ConeShape\", ConeShape);\r\nc(\"HemisphereShape\", HemisphereShape);\r\nc(\"SphereShape\", SphereShape);\r\nc(\"FrameOverTime\", FrameOverTime);\r\nc(\"GradientAngularVelocity\", GradientAngularVelocity);\r\nc(\"GradientColor\", GradientColor);\r\nc(\"GradientDataInt\", GradientDataInt);\r\nc(\"GradientDataNumber\", GradientDataNumber);\r\nc(\"GradientSize\", GradientSize);\r\nc(\"GradientVelocity\", GradientVelocity);\r\nc(\"StartFrame\", StartFrame);\r\nc(\"TextureSheetAnimation\", TextureSheetAnimation);\r\nc(\"ColorOverLifetime\", ColorOverLifetime);\r\nc(\"RotationOverLifetime\", RotationOverLifetime);\r\nc(\"SizeOverLifetime\", SizeOverLifetime);\r\nc(\"VelocityOverLifetime\", VelocityOverLifetime);\r\nc(\"LODInfo\", LODInfo);\r\nc(\"LODGroup\", LODGroup);\r\n\r\n\r\nc(\"DirectionLight\", DirectionLight);\r\nc(\"DirectionLightCom\", DirectionLightCom);\r\nc(\"MeshRenderer\", MeshRenderer);\r\nc(\"MeshFilter\", MeshFilter);\r\nc(\"MeshRenderer\", MeshRenderer);\r\nc(\"SkinnedMeshRenderer\", SkinnedMeshRenderer);\r\nc(\"SimpleSkinnedMeshRenderer\", SimpleSkinnedMeshRenderer);\r\nc(\"SkyRenderer\", SkyRenderer);\r\n\r\nc(\"PostProcess\", PostProcess);\r\nc(\"PostProcessEffect\", PostProcessEffect);\r\nc(\"BloomEffect\", BloomEffect);\r\nc(\"GaussianDoF\", GaussianDoF);\r\nc(\"ScalableAO\", ScalableAO);\r\nc(\"ColorGradEffect\", ColorGradEffect);\r\n\r\nc(\"LensFlareEffect\", LensFlareEffect);\r\nc(\"LensFlareElement\", LensFlareElement);\r\nc(\"LensFlareData\", LensFlareData);","import { IBaseRenderNode } from \"../../../RenderEngine/RenderInterface/RenderPipelineInterface/IBaseRenderNode\";\r\nimport { BaseRender } from \"../../core/render/BaseRender\";\r\nimport { Transform3D } from \"../../core/Transform3D\";\r\nimport { Bounds } from \"../../math/Bounds\";\r\n\r\n\r\nexport class NativeBaseRenderNode implements IBaseRenderNode {\r\n\r\n    private _nativeObj: any;\r\n    private _bounds: Bounds = null;\r\n    private _geometryBounds: Bounds = null;\r\n    private _transform: Transform3D = null;\r\n    constructor() {\r\n        this._nativeObj = new (window as any).conchRenderNode();\r\n    }\r\n    set boundsChange(value: boolean) {\r\n        this._nativeObj.boundsChange = value;\r\n    }\r\n    get boundsChange(): boolean {\r\n        return this._nativeObj.boundsChange;\r\n    }\r\n\r\n    set layer(value: number) {\r\n        this._nativeObj.layer = value;\r\n    }\r\n\r\n    get layer(): number {\r\n        return this._nativeObj.layer;\r\n    }\r\n\r\n    get renderId(): number {\r\n        return this._nativeObj.renderId;\r\n    }\r\n    set renderId(value: number) {\r\n        this._nativeObj.renderId = value;\r\n    }\r\n\r\n    get receiveShadow(): boolean {\r\n        return this._nativeObj.receiveShadow;\r\n    }\r\n    set receiveShadow(value: boolean) {\r\n        this._nativeObj.receiveShadow = value;\r\n    }\r\n\r\n    get castShadow(): boolean {\r\n        return this._nativeObj.castShadow;\r\n    }\r\n    set castShadow(value: boolean) {\r\n        this._nativeObj.castShadow = value;\r\n    }\r\n\r\n    get bounds(): Bounds {\r\n        return this._bounds;\r\n    }\r\n    set bounds(value: Bounds) {\r\n        this._bounds = value;\r\n        this._nativeObj.bounds = (value as any)._imp._nativeObj;\r\n    }\r\n\r\n    sortingFudge: number;\r\n\r\n    get distanceForSort(): number {\r\n        return this._nativeObj.distanceForSort;\r\n    }\r\n    set distanceForSort(value: number) {\r\n        this._nativeObj.distanceForSort = value;\r\n    }\r\n\r\n    get transform(): Transform3D {\r\n        return this._transform;\r\n    }\r\n    set transform(value: Transform3D) {\r\n        this._transform = value;\r\n        this._nativeObj.transform = value ? (value as any)._nativeObj : null;\r\n    }\r\n    \r\n    get owner(): BaseRender | null {\r\n        return this._nativeObj.owner;\r\n    }\r\n    set owner(value: BaseRender | null) {\r\n        this._nativeObj.owner = value;\r\n    }\r\n\r\n    get geometryBounds(): Bounds | null {\r\n        return this._geometryBounds;\r\n    }\r\n\r\n    set geometryBounds(value: Bounds | null) {\r\n        this._geometryBounds = value;\r\n        this._nativeObj.geometryBounds = (value as any)._imp._nativeObj;\r\n    }\r\n\r\n    get renderbitFlag(): number {\r\n        return this._nativeObj.renderbitFlag;\r\n    }\r\n    set renderbitFlag(value: number | null) {\r\n        this._nativeObj.renderbitFlag = value;\r\n    }\r\n    get staticMask(): number {\r\n        return this._nativeObj.staticMask;\r\n    }\r\n    set staticMask(value: number | null) {\r\n        this._nativeObj.staticMask = value;\r\n    }\r\n}","import { RenderCapable } from \"../../../RenderEngine/RenderEnum/RenderCapable\";\r\nimport { FastSinglelist } from \"../../../utils/SingletonList\";\r\nimport { RenderElement } from \"../../core/render/RenderElement\";\r\nimport { SubMeshInstanceBatch } from \"../SubMeshInstanceBatch\";\r\nimport { InstanceBatchManager } from \"./InstanceBatchManager\";\r\nimport { InstanceRenderElement } from \"../../core/render/InstanceRenderElement\";\r\nimport { MeshInstanceGeometry } from \"../MeshInstanceGeometry\";\r\nimport { SubMesh } from \"../../resource/models/SubMesh\";\r\nimport { Config3D } from \"../../../../Config3D\";\r\nimport { LayaGL } from \"../../../layagl/LayaGL\";\r\n\r\nexport class RenderElementBatch {\r\n    static instance: RenderElementBatch;\r\n    private _instanceBatchManager: InstanceBatchManager;\r\n    private _recoverList: FastSinglelist<InstanceRenderElement>;\r\n    constructor() {\r\n        RenderElementBatch.instance = this;\r\n        this._instanceBatchManager = InstanceBatchManager.instance;\r\n        this._recoverList = new FastSinglelist();\r\n    }\r\n\r\n    /**\r\n     * after batchRender\r\n     */\r\n    recoverData() {\r\n        let elements = this._recoverList.elements;\r\n        for (let i = 0, n = this._recoverList.length; i < n; i++) {\r\n            let element = elements[i];\r\n            element.recover();\r\n        }\r\n        this._recoverList.length = 0;\r\n    }\r\n\r\n    /**\r\n     * BatchData\r\n     * @param elements \r\n     */\r\n    batch(elements: FastSinglelist<RenderElement>) {\r\n        let len = elements.length;\r\n        elements.length = 0;\r\n        this._instanceBatchManager.updateCountMark++;//\r\n        let elementArray = elements.elements;\r\n        for (var i = 0; i < len; i++) {\r\n            let element = elements.elements[i];\r\n            if (!element._canBatch) {\r\n                elements.add(element);\r\n                continue;\r\n            }\r\n            if (element.staticBatch && (!element._baseRender._probReflection || element._baseRender._probReflection._isScene) && Config3D.enableStaticBatch) {\r\n                //static Batch TODO\r\n                elements.add(element);\r\n            }\r\n            else if (Config3D.enableDynamicBatch && LayaGL.renderEngine.getCapable(RenderCapable.DrawElement_Instance)) {\r\n                if (element._subShader._owner._enableInstancing) {\r\n                    var insManager = this._instanceBatchManager;\r\n                    //let invertFrontFace = element._transform ? element._transform._isFrontFaceInvert : false;\r\n                    var insBatchMarks = insManager.getInstanceBatchOpaquaMark(element);\r\n                    if (insManager.updateCountMark === insBatchMarks.updateMark) {\r\n                        //can batch\r\n                        var insBatchIndex: number = insBatchMarks.indexInList;\r\n                        var insOriElement: RenderElement = elementArray[insBatchIndex];\r\n                        if (insBatchMarks.batched) {\r\n                            var instanceelements: FastSinglelist<RenderElement> = (insOriElement as InstanceRenderElement)._instanceBatchElementList;\r\n                            if (instanceelements.length === SubMeshInstanceBatch.maxInstanceCount) {\r\n                                insBatchMarks.updateMark = insManager.updateCountMark;\r\n                                insBatchMarks.indexInList = elements.length;\r\n                                insBatchMarks.batched = false;\r\n                                elements.add(element);\r\n                            } else {\r\n                                instanceelements.add(element);\r\n                            }\r\n                        } else {\r\n                            //ElementsRenderElementInstanceElement\r\n                            let instanceRenderElement = InstanceRenderElement.create();\r\n                            this._recoverList.add(instanceRenderElement);\r\n                            instanceRenderElement._baseRender = insOriElement._baseRender;\r\n                            instanceRenderElement._renderElementOBJ._renderShaderData = insOriElement._baseRender._shaderValues;\r\n                            instanceRenderElement.renderType = RenderElement.RENDERTYPE_INSTANCEBATCH;\r\n                            //Geometry updaste\r\n                            (instanceRenderElement._geometry as MeshInstanceGeometry).subMesh = (insOriElement._geometry as SubMesh);\r\n                            instanceRenderElement.material = insOriElement._material;\r\n                            instanceRenderElement.setTransform(null);\r\n                            instanceRenderElement._subShader = insOriElement._subShader;\r\n                            let list = instanceRenderElement._instanceBatchElementList;\r\n                            list.length = 0;\r\n                            list.add(insOriElement);\r\n                            list.add(element);\r\n                            elementArray[insBatchIndex] = instanceRenderElement;\r\n                            insBatchMarks.batched = true;\r\n                            instanceRenderElement._isUpdataData = true;\r\n                            instanceRenderElement._invertFrontFace = element._transform ? element._transform._isFrontFaceInvert : false;;\r\n                        }\r\n                    } else {\r\n                        insBatchMarks.updateMark = insManager.updateCountMark;\r\n                        insBatchMarks.indexInList = elements.length;\r\n                        insBatchMarks.batched = false;\r\n                        elements.add(element);\r\n                    }\r\n                } else\r\n                    elements.add(element);\r\n            }\r\n            else\r\n                elements.add(element);\r\n        }\r\n    }\r\n}","import { UploadMemoryManager } from \"../../../RenderEngine/RenderEngine/NativeGLEngine/CommonMemory/UploadMemoryManager\";\r\nimport { IRenderContext3D } from \"../../../RenderEngine/RenderInterface/RenderPipelineInterface/IRenderContext3D\";\r\nimport { IRenderQueue } from \"../../../RenderEngine/RenderInterface/RenderPipelineInterface/IRenderQueue\";\r\nimport { ISortPass } from \"../../../RenderEngine/RenderInterface/RenderPipelineInterface/ISortPass\";\r\nimport { SingletonList } from \"../../../utils/SingletonList\";\r\nimport { BufferState } from \"../../../webgl/utils/BufferState\";\r\nimport { Camera } from \"../../core/Camera\";\r\nimport { RenderContext3D } from \"../../core/render/RenderContext3D\";\r\nimport { RenderElement } from \"../../core/render/RenderElement\";\r\nimport { RenderElementBatch } from \"../../graphics/Batch/RenderElementBatch\";\r\n\r\n\r\nexport class NativeBaseRenderQueue implements IRenderQueue {\r\n   /** @interanl */\r\n    _isTransparent: boolean = false;\r\n   /** @internal */\r\n   elements: SingletonList<RenderElement> = new SingletonList<RenderElement>();\r\n   /**sort function*/\r\n   _sortPass: ISortPass;\r\n   /** context*/\r\n   _context: IRenderContext3D;\r\n   _batch: RenderElementBatch;\r\n    private _nativeObj: any;\r\n    set sortPass(value: ISortPass) {\r\n        this._nativeObj.sortPass = value;\r\n    }\r\n    constructor(isTransparent: boolean) {\r\n        this._isTransparent = isTransparent;\r\n        this._nativeObj = new (window as any).conchRenderQueue(isTransparent);\r\n \t    this._batch = RenderElementBatch.instance ? RenderElementBatch.instance : new RenderElementBatch();\r\n    }\r\n    destroy(): void {\r\n        this._nativeObj.destroy();\r\n    }\r\n\r\n    set context(value:RenderContext3D){\r\n        this._context = value._contextOBJ;\r\n    }\r\n\r\n    addRenderElement(renderelement: RenderElement) {\r\n        this.elements.add(renderelement);\r\n    }\r\n\r\n    clear(): void {\r\n        this._nativeObj.clear();\r\n        this.elements.length = 0;\r\n    }\r\n\r\n    renderQueue(context:RenderContext3D):number {\r\n        this.context = context;\r\n        this._context.applyContext(Camera._updateMark);\r\n        \r\n        var elements: RenderElement[] = this.elements.elements;\r\n\r\n\t\tthis._batchQueue();\r\n        this._nativeObj.clear();\r\n        for (var i: number = 0, n: number = this.elements.length; i < n; i++){\r\n            var render_element = elements[i];\r\n            this._nativeObj.addRenderElement((render_element._renderElementOBJ as any)._nativeObj, \r\n            (render_element.render.renderNode as any)._nativeObj,\r\n            render_element.material.renderQueue, \r\n            render_element.render.sortingFudge);\r\n            render_element._renderUpdatePre(context);//Update Data\r\n        }\r\n\r\n        UploadMemoryManager.syncRenderMemory();\r\n\r\n        BufferState._curBindedBufferState && BufferState._curBindedBufferState.unBind();\r\n        this._nativeObj.renderQueue((this._context as any)._nativeObj);\r\n        \r\n        this._batch.recoverData();\r\n\r\n        return n;\r\n    }\r\n\r\n    private _batchQueue() {\r\n       this._isTransparent || this._batch.batch(this.elements);\r\n    }\r\n}","import { Matrix4x4 } from \"../../../maths/Matrix4x4\";\r\nimport { Vector3 } from \"../../../maths/Vector3\";\r\nimport { NativeMemory } from \"../../../RenderEngine/RenderEngine/NativeGLEngine/CommonMemory/NativeMemory\";\r\nimport { IClone } from \"../../../utils/IClone\";\r\nimport { BoundBox } from \"../../math/BoundBox\";\r\nimport { Bounds } from \"../../math/Bounds\";\r\n\r\n\r\n\r\nexport class NativeBounds implements IClone {\r\n\r\n    /**native Share Memory */\r\n    static MemoryBlock_size: number = Math.max(6 * 8, 16 * 4);\r\n    /**@internal\t*/\r\n    nativeMemory: NativeMemory;\r\n    /**@internal\t*/\r\n    float32Array: Float32Array;\r\n    /**@internal\t*/\r\n    float64Array: Float64Array;\r\n    /**@internal\t*/\r\n    _nativeObj: any;\r\n    /**@internal\t*/\r\n    _center: Vector3 = new Vector3();\r\n    /**@internal\t*/\r\n    _extent: Vector3 = new Vector3();\r\n    /**@internal */\r\n    private _boundBox: BoundBox = new BoundBox(new Vector3(), new Vector3());\r\n\r\n    get min() {\r\n        return this.getMin();\r\n    }\r\n\r\n    set min(value: Vector3) {\r\n        this.setMin(value);\r\n    }\r\n\r\n    get max() {\r\n        return this.getMax();\r\n    }\r\n\r\n    set max(value: Vector3) {\r\n        this.setMax(value);\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @param value\t\r\n     */\r\n    setMin(value: Vector3): void {\r\n        this.float64Array[0] = value.x;\r\n        this.float64Array[1] = value.y;\r\n        this.float64Array[2] = value.z;\r\n\t\tthis._nativeObj.setMin();\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @return\t\r\n     */\r\n    getMin(): Vector3 {\r\n        var min: Vector3 = this._boundBox.min;\r\n        this._nativeObj.getMin();\r\n        min.x = this.float64Array[0];\r\n        min.y = this.float64Array[1];\r\n        min.z = this.float64Array[2];\r\n        return min;\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @param value\t\r\n     */\r\n    setMax(value: Vector3): void {\r\n        this.float64Array[0] = value.x;\r\n        this.float64Array[1] = value.y;\r\n        this.float64Array[2] = value.z;\r\n\t\tthis._nativeObj.setMax();\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @return\t\r\n     */\r\n    getMax(): Vector3 {\r\n        var max: Vector3 = this._boundBox.max;\r\n        this._nativeObj.getMax();\r\n        max.x = this.float64Array[0];\r\n        max.y = this.float64Array[1];\r\n        max.z = this.float64Array[2];\r\n        return max;\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @param value\t\r\n     */\r\n    setCenter(value: Vector3): void {\r\n        this.float64Array[0] = value.x;\r\n        this.float64Array[1] = value.y;\r\n        this.float64Array[2] = value.z;\r\n\t\tthis._nativeObj.setCenter();\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @return\t\r\n     */\r\n    getCenter(): Vector3 {\r\n        var center: Vector3 = this._center;\r\n        this._nativeObj.getCenter();\r\n        center.x = this.float64Array[0];\r\n        center.y = this.float64Array[1];\r\n        center.z = this.float64Array[2];\r\n        return center;\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @param value\t\r\n     */\r\n    setExtent(value: Vector3): void {\r\n        this.float64Array[0] = value.x;\r\n        this.float64Array[1] = value.y;\r\n        this.float64Array[2] = value.z;\r\n\t\tthis._nativeObj.setExtent();\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @return\t\r\n     */\r\n    getExtent(): Vector3 {\r\n        var extent: Vector3 = this._extent;\r\n        this._nativeObj.getExtent();\r\n        extent.x = this.float64Array[0];\r\n        extent.y = this.float64Array[1];\r\n        extent.z = this.float64Array[2];\r\n        return extent;\r\n    }\r\n\r\n    /**\r\n     *  <code>Bounds</code> \r\n     * @param\tmin  min \r\n     * @param\tmax  max \r\n     */\r\n    constructor(min?: Vector3, max?: Vector3) {\r\n        this.nativeMemory = new NativeMemory(NativeBounds.MemoryBlock_size, true);\r\n        this.float32Array = this.nativeMemory.float32Array;\r\n        this.float64Array = this.nativeMemory.float64Array;\r\n        this._nativeObj = new (window as any).conchBounds(this.nativeMemory._buffer); \r\n        min && this.setMin(min);\r\n        max && this.setMax(max);\r\n    }\r\n    /**\r\n     * @internal\r\n     */\r\n    _tranform(matrix: Matrix4x4, out: NativeBounds): void {\r\n        this.float32Array.set(matrix.elements);\r\n        this._nativeObj._tranform(out._nativeObj);\r\n    }\r\n\r\n    _getBoundBox(): BoundBox {\r\n        this._nativeObj._getBoundBox();\r\n        this._boundBox.min.x = this.float64Array[0];\r\n        this._boundBox.min.y = this.float64Array[1];\r\n        this._boundBox.min.z = this.float64Array[2];\r\n        this._boundBox.max.x = this.float64Array[3];\r\n        this._boundBox.max.y = this.float64Array[4];\r\n        this._boundBox.max.z = this.float64Array[5];\r\n        return this._boundBox;\r\n    }\r\n    /**\r\n     * @returns -1 0\r\n     */\r\n    calculateBoundsintersection(bounds: Bounds): number {\r\n        var ownMax: Vector3 = this.getMax();\r\n        var ownMin: Vector3 = this.getMin();\r\n        var calMax: Vector3 = bounds.getMax();\r\n        var calMin: Vector3 = bounds.getMin();\r\n        var tempV0: Vector3 = TEMP_VECTOR3_MAX0;\r\n        var tempV1: Vector3 = TEMP_VECTOR3_MAX1;\r\n        var thisExtends: Vector3 = this.getExtent();\r\n        var boundExtends: Vector3 = bounds.getExtent();\r\n        tempV0.setValue(Math.max(ownMax.x, calMax.x) - Math.min(ownMin.x, calMin.x),\r\n            Math.max(ownMax.y, calMax.y) - Math.min(ownMin.y, calMin.y),\r\n            Math.max(ownMax.z, calMax.z) - Math.min(ownMin.z, calMin.z));\r\n        tempV1.setValue((thisExtends.x + boundExtends.x) * 2.0,\r\n            (thisExtends.y + boundExtends.y) * 2.0,\r\n            (thisExtends.z + boundExtends.z) * 2.0);\r\n        if ((tempV0.x) > (tempV1.x)) return -1;\r\n        if ((tempV0.y) > (tempV1.y)) return -1;\r\n        if ((tempV0.z) > (tempV1.z)) return -1;\r\n        return (tempV1.x - tempV0.x) * (tempV1.y - tempV0.y) * (tempV1.z - tempV0.z);\r\n    }\r\n\r\n\r\n    /**\r\n     * \r\n     * @param\tdestObject \r\n     */\r\n    cloneTo(destObject: any): void {\r\n        var destBounds: NativeBounds = (<NativeBounds>destObject);\r\n        this._nativeObj.cloneTo(destBounds._nativeObj);\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @return\t \r\n     */\r\n    clone(): any {\r\n        var dest: NativeBounds = new NativeBounds(new Vector3(), new Vector3());\r\n        this.cloneTo(dest);\r\n        return dest;\r\n    }\r\n\r\n}\r\nconst TEMP_VECTOR3_MAX0 = new Vector3();\r\nconst TEMP_VECTOR3_MAX1 = new Vector3();","import { Vector3 } from \"../../../maths/Vector3\";\r\nimport { NativeMemory } from \"../../../RenderEngine/RenderEngine/NativeGLEngine/CommonMemory/NativeMemory\";\r\nimport { ICameraCullInfo } from \"../../../RenderEngine/RenderInterface/RenderPipelineInterface/ICameraCullInfo\";\r\nimport { BoundFrustum } from \"../../math/BoundFrustum\";\r\nimport { Plane } from \"../../math/Plane\";\r\n\r\n\r\n/**\r\n * camera\r\n */\r\nexport class NativeCameraCullInfo implements ICameraCullInfo {\r\n\t/** */\r\n\tprivate _position: Vector3;\r\n\r\n\tprivate _useOcclusionCulling: Boolean;\r\n\r\n\tprivate _cullingMask: number;\r\n\t/** */\r\n\tprivate _staticMask: number;\r\n\r\n\tprivate _nativeObj: any;\r\n\r\n\tprivate static MemoryBlock_size = 192;\r\n\t/**native Share Memory */\r\n\tprivate nativeMemory: NativeMemory;\r\n\tprivate float64Array: Float64Array;\r\n\r\n\tboundFrustum: BoundFrustum;\r\n\r\n\tconstructor() {\r\n\t\tthis.nativeMemory = new NativeMemory(NativeCameraCullInfo.MemoryBlock_size, true);\r\n\t\tthis.float64Array = this.nativeMemory.float64Array;\r\n\t\tthis._nativeObj = new (window as any).conchCameraCullInfo(this.nativeMemory._buffer);\r\n\t}\r\n\r\n\tset position(position: Vector3) {\r\n\t\tthis._position = position;\r\n\t\tthis._nativeObj.setPosition(position.x, position.y, position.z);\r\n\t}\r\n\r\n\tget position(): Vector3 {\r\n\t\treturn this._position;\r\n\t}\r\n\r\n\tset useOcclusionCulling(useOcclusionCulling: Boolean) {\r\n\t\tthis._useOcclusionCulling = useOcclusionCulling;\r\n\t\tthis._nativeObj.useOcclusionCulling = useOcclusionCulling;\r\n\t}\r\n\r\n\tget useOcclusionCulling(): Boolean {\r\n\t\treturn this._useOcclusionCulling;\r\n\t}\r\n\r\n\tset cullingMask(cullingMask: number) {\r\n\t\tthis._cullingMask = cullingMask;\r\n\t\tthis._nativeObj.cullingMask = cullingMask;\r\n\t}\r\n\r\n\tget cullingMask(): number {\r\n\t\treturn this._cullingMask;\r\n\t}\r\n\r\n\r\n\tset staticMask(value: number) {\r\n\t\tthis._staticMask = value;\r\n\t\tthis._nativeObj.staticMask = value;\r\n\t}\r\n\r\n\tget staticMask(): number {\r\n\t\treturn this._staticMask;\r\n\t}\r\n\t\r\n\r\n\t/**\r\n\t * @internal\r\n\t */\r\n\tserialize(): void {\r\n\t\tif (this.boundFrustum) {\r\n\t\t\tthis.setPlane(0, this.boundFrustum.near);\r\n\t\t\tthis.setPlane(4, this.boundFrustum.far);\r\n\t\t\tthis.setPlane(8, this.boundFrustum.left);\r\n\t\t\tthis.setPlane(12, this.boundFrustum.right);\r\n\t\t\tthis.setPlane(16, this.boundFrustum.top);\r\n\t\t\tthis.setPlane(20, this.boundFrustum.bottom);\r\n\t\t\tthis._nativeObj.setBoundFrustum();\r\n\t\t}\r\n\t}\r\n\t/**\r\n\t * @internal\r\n\t */\r\n\tsetPlane(index: number, value: Plane): void {\r\n\t\tthis.float64Array[index] = value.normal.x;\r\n\t\tthis.float64Array[index + 1] = value.normal.y;\r\n\t\tthis.float64Array[index + 2] = value.normal.z;\r\n\t\tthis.float64Array[index + 3] = value.distance;\r\n\t}\r\n}","\r\nimport { ICameraCullInfo } from \"../../../RenderEngine/RenderInterface/RenderPipelineInterface/ICameraCullInfo\";\r\nimport { ICullPass } from \"../../../RenderEngine/RenderInterface/RenderPipelineInterface/ICullPass\";\r\nimport { ISceneRenderManager } from \"../../../RenderEngine/RenderInterface/RenderPipelineInterface/ISceneRenderManager\";\r\nimport { IShadowCullInfo } from \"../../../RenderEngine/RenderInterface/RenderPipelineInterface/IShadowCullInfo\";\r\nimport { SingletonList } from \"../../../utils/SingletonList\";\r\nimport { Stat } from \"../../../utils/Stat\";\r\nimport { BaseRender } from \"../../core/render/BaseRender\";\r\nimport { RenderContext3D } from \"../../core/render/RenderContext3D\";\r\nimport { FrustumCulling } from \"../../graphics/FrustumCulling\";\r\nimport { NativeCameraCullInfo } from \"./NativeCameraCullInfo\";\r\n\r\n\r\nexport class NativeCullPassBase implements ICullPass {\r\n\r\n    private _nativeObj: any;\r\n    private _tempRenderList: SingletonList<BaseRender>;\r\n    get cullList(): SingletonList<BaseRender> {\r\n        this._tempRenderList.elements = this._nativeObj.cullList;\r\n        this._tempRenderList.length = this._nativeObj.cullList.length;\r\n        return this._tempRenderList;\r\n    }\r\n\r\n    constructor() {\r\n        this._nativeObj = new (window as any).conchCullPass();\r\n        this._tempRenderList = new SingletonList<BaseRender>();\r\n    }\r\n\r\n    cullByCameraCullInfo(cameraCullInfo: ICameraCullInfo, renderManager: ISceneRenderManager): void {\r\n        //native Cull \r\n        (cameraCullInfo as NativeCameraCullInfo).serialize();\r\n        Stat.frustumCulling += this._nativeObj.cullByCameraCullInfo((cameraCullInfo as any)._nativeObj, (renderManager as any)._sceneManagerOBJ._nativeObj);\r\n        //Custom list Cull\r\n        var customRenderList = (renderManager as any)._sceneManagerOBJ._customCullList;\r\n        var boundFrustum = cameraCullInfo.boundFrustum;\r\n        var cullMask: number = cameraCullInfo.cullingMask;\r\n        let staticMask = cameraCullInfo.staticMask;\r\n        var renders = customRenderList.elements;\r\n        let context = RenderContext3D._instance;\r\n        for (var i: number = 0, n: number = customRenderList.length; i < n; i++) {\r\n            var render: BaseRender = <BaseRender>renders[i];\r\n            var canPass: boolean;\r\n            canPass = (( 1 << render.renderNode.layer & cullMask) != 0) && render._enabled && (render.renderbitFlag == 0);\r\n            canPass = canPass && (( render.renderNode.staticMask & staticMask) != 0);\r\n            if (canPass) {\r\n                Stat.frustumCulling++;\r\n                if (!cameraCullInfo.useOcclusionCulling || render._needRender(boundFrustum, context)) {\r\n                    this._nativeObj.cullList.push(render);\r\n                }\r\n            }\r\n        }\r\n    }\r\n    cullByShadowCullInfo(cullInfo: IShadowCullInfo, renderManager: ISceneRenderManager): void {\r\n        //native Cull\r\n        //TODO transparent filter\r\n        Stat.frustumCulling += this._nativeObj.cullByShadowCullInfo((cullInfo as any)._nativeObj, (renderManager as any)._sceneManagerOBJ._nativeObj);\r\n        //Custom list Cull\r\n        var customRenderList = (renderManager as any)._sceneManagerOBJ._customCullList;\r\n        var renders = customRenderList.elements;\r\n        for (var i: number = 0, n: number = customRenderList.length; i < n; i++) {\r\n            var render: BaseRender = <BaseRender>renders[i];\r\n            var canPass: boolean = render.castShadow && render._enabled && (render.renderbitFlag == 0);\r\n            if (canPass) {\r\n                Stat.frustumCulling++;\r\n                let pass = FrustumCulling.cullingRenderBounds(render.bounds, cullInfo);\r\n                pass && this._nativeObj.cullList.push(render);\r\n            }\r\n        }\r\n    }\r\n    cullingSpotShadow(cameraCullInfo: ICameraCullInfo, renderManager: ISceneRenderManager): void {\r\n        //native Cull\r\n        (cameraCullInfo as NativeCameraCullInfo).serialize();\r\n        //TODO transparent filter\r\n        Stat.frustumCulling += this._nativeObj.cullingSpotShadow((cameraCullInfo as any)._nativeObj, (renderManager as any)._sceneManagerOBJ._nativeObj);\r\n\r\n        //Custom list Cull\r\n        var customRenderList = (renderManager as any)._sceneManagerOBJ._customCullList;\r\n        var renders = customRenderList.elements;\r\n        let context = RenderContext3D._instance;\r\n        for (var i: number = 0, n: number = customRenderList.length; i < n; i++) {\r\n            var render: BaseRender = <BaseRender>renders[i];\r\n            var canPass: boolean = render.castShadow && render._enabled && (render.renderbitFlag == 0);\r\n            if (canPass) {\r\n                Stat.frustumCulling++;\r\n                var render: BaseRender = <BaseRender>renders[i];\r\n                if (render._needRender(cameraCullInfo.boundFrustum, context))\r\n                    this._nativeObj.cullList.push(render);\r\n            }\r\n        }\r\n    }\r\n\r\n}","import { IndexBuffer } from \"../../RenderEngine/IndexBuffer\";\r\nimport { BufferTargetType, BufferUsage } from \"../../RenderEngine/RenderEnum/BufferTargetType\";\r\nimport { IndexFormat } from \"../../RenderEngine/RenderEnum/IndexFormat\";\r\n/**\r\n * LayaGL.RenderOBJCreate.createIndexBuffer3D\r\n * <code>IndexBuffer3D</code> \r\n */\r\nexport class IndexBuffer3D extends IndexBuffer {\r\n\t/** @internal */\r\n\tprivate _canRead: boolean;\r\n\r\n\t/**\r\n\t * \r\n\t */\r\n\tget indexType(): IndexFormat {\r\n\t\treturn this._indexType;\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t */\r\n\tget indexTypeByteCount(): number {\r\n\t\treturn this._indexTypeByteCount;\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t */\r\n\tget indexCount(): number {\r\n\t\treturn this._indexCount;\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t */\r\n\tget canRead(): boolean {\r\n\t\treturn this._canRead;\r\n\t}\r\n\r\n\t/**\r\n\t *  <code>IndexBuffer3D,IndexBuffer3D.create()</code> \r\n\t * @param\tindexType \r\n\t * @param\tindexCount \r\n\t * @param\tbufferUsage IndexBuffer3D\r\n\t * @param\tcanRead \r\n\t */\r\n\tconstructor(indexType: IndexFormat, indexCount: number, bufferUsage: BufferUsage = BufferUsage.Static, canRead: boolean = false) {\r\n\t\tsuper(BufferTargetType.ELEMENT_ARRAY_BUFFER, bufferUsage);\r\n\t\tthis._indexType = indexType;\r\n\t\tthis._indexCount = indexCount;\r\n\r\n\t\tthis._canRead = canRead;\r\n\r\n\t\tswitch (indexType) {\r\n\t\t\tcase IndexFormat.UInt32:\r\n\t\t\t\tthis._indexTypeByteCount = 4;\r\n\t\t\t\tbreak;\r\n\t\t\tcase IndexFormat.UInt16:\r\n\t\t\t\tthis._indexTypeByteCount = 2;\r\n\t\t\t\tbreak;\r\n\t\t\tcase IndexFormat.UInt8:\r\n\t\t\t\tthis._indexTypeByteCount = 1;\r\n\t\t\t\tbreak;\r\n\t\t\tdefault:\r\n\t\t\t\tthrow new Error(\"unidentification index type.\");\r\n\t\t}\r\n\t\tvar byteLength: number = this._indexTypeByteCount * indexCount;\r\n\t\tthis._byteLength = byteLength;\r\n\t\tthis._setIndexData(byteLength);\r\n\t\tif (canRead) {\r\n\t\t\tswitch (indexType) {\r\n\t\t\t\tcase IndexFormat.UInt32:\r\n\t\t\t\t\tthis._buffer = new Uint32Array(indexCount);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase IndexFormat.UInt16:\r\n\t\t\t\t\tthis._buffer = new Uint16Array(indexCount);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase IndexFormat.UInt8:\r\n\t\t\t\t\tthis._buffer = new Uint8Array(indexCount);\r\n\t\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t * @param\tdata \r\n\t * @param\tbufferOffset \r\n\t * @param\tdataStartIndex \r\n\t * @param\tdataCount \r\n\t */\r\n\tsetData(data: any, bufferOffset: number = 0, dataStartIndex: number = 0, dataCount: number = 4294967295/*uint.MAX_VALUE*/): void {\r\n\t\tvar byteCount: number = this._indexTypeByteCount;\r\n\t\tif (dataStartIndex !== 0 || dataCount !== 4294967295/*uint.MAX_VALUE*/) {\r\n\t\t\tswitch (this._indexType) {\r\n\t\t\t\tcase IndexFormat.UInt32:\r\n\t\t\t\t\tdata = new Uint32Array(data.buffer, dataStartIndex * byteCount, dataCount);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase IndexFormat.UInt16:\r\n\t\t\t\t\tdata = new Uint16Array(data.buffer, dataStartIndex * byteCount, dataCount);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase IndexFormat.UInt8:\r\n\t\t\t\t\tdata = new Uint8Array(data.buffer, dataStartIndex * byteCount, dataCount);\r\n\t\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tthis._setIndexData(data, bufferOffset * byteCount);\r\n\r\n\t\tif (this._canRead) {\r\n\t\t\tif (bufferOffset !== 0 || dataStartIndex !== 0 || dataCount !== 4294967295/*uint.MAX_VALUE*/) {\r\n\t\t\t\tvar maxLength: number = this._buffer.length - bufferOffset;\r\n\t\t\t\tif (dataCount > maxLength)\r\n\t\t\t\t\tdataCount = maxLength;\r\n\t\t\t\tif (typeof data == typeof this._buffer && data.length == dataCount)\r\n\t\t\t\t\tthis._buffer.set(data, bufferOffset);\r\n\t\t\t\telse\r\n\t\t\t\t\tfor (var i: number = 0; i < dataCount; i++)\r\n\t\t\t\t\t\tthis._buffer[bufferOffset + i] = data[i];\r\n\t\t\t} else {\r\n\t\t\t\tthis._buffer = data;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t * @return\t\r\n\t */\r\n\tgetData(): Uint16Array {\r\n\t\tif (this._canRead)\r\n\t\t\treturn <Uint16Array>this._buffer;\r\n\t\telse\r\n\t\t\tthrow new Error(\"Can't read data from VertexBuffer with only write flag!\");\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t * @override\r\n\t */\r\n\tdestroy(): void {\r\n\t\tsuper.destroy();\r\n\t\tthis._buffer = null;\r\n\t\tthis._byteLength = 0;\r\n\t\tthis._indexCount = 0;\r\n\t}\r\n\r\n}\r\n\r\n\r\n","import { BufferUsage } from \"../../../RenderEngine/RenderEnum/BufferTargetType\";\r\nimport { IndexFormat } from \"../../../RenderEngine/RenderEnum/IndexFormat\";\r\nimport { LayaGL } from \"../../../layagl/LayaGL\";\r\nimport { IndexBuffer3D } from \"../../graphics/IndexBuffer3D\";\r\n\r\n\r\nexport class NativeIndexBuffer3D extends IndexBuffer3D {\r\n\r\n    _conchIndexBuffer3D:any = null;\r\n\r\n    /**\r\n     *  <code>VertexBuffer3D</code> \r\n     * @param\tbyteLength \r\n     * @param\tbufferUsage VertexBuffer3D\r\n     * @param\tcanRead \r\n     */\r\n    constructor(indexType: IndexFormat, indexCount: number, bufferUsage: BufferUsage = BufferUsage.Static, canRead: boolean = false) {\r\n        super(indexType,indexCount,bufferUsage,canRead)\r\n        this._conchIndexBuffer3D = new (window as any).conchIndexBuffer3D( (LayaGL.renderEngine as any)._nativeObj,indexType,indexCount,bufferUsage,false);\r\n        this._conchIndexBuffer3D.setGLBuffer(this._glBuffer);\r\n     }\r\n}","import { UploadMemoryManager } from \"../../../RenderEngine/RenderEngine/NativeGLEngine/CommonMemory/UploadMemoryManager\";\r\nimport { NativeShaderData } from \"../../../RenderEngine/RenderEngine/NativeGLEngine/NativeShaderData\";\r\nimport { IBaseRenderNode } from \"../../../RenderEngine/RenderInterface/RenderPipelineInterface/IBaseRenderNode\";\r\nimport { IRenderContext3D } from \"../../../RenderEngine/RenderInterface/RenderPipelineInterface/IRenderContext3D\";\r\nimport { IRenderElement } from \"../../../RenderEngine/RenderInterface/RenderPipelineInterface/IRenderElement\";\r\nimport { IRenderGeometryElement } from \"../../../RenderEngine/RenderInterface/RenderPipelineInterface/IRenderGeometryElement\";\r\nimport { ShaderInstance } from \"../../../RenderEngine/RenderShader/ShaderInstance\";\r\nimport { LayaGL } from \"../../../layagl/LayaGL\";\r\nimport { SingletonList } from \"../../../utils/SingletonList\";\r\nimport { Transform3D } from \"../../core/Transform3D\";\r\nexport enum RenderElementType {\r\n    Base = 0,\r\n    Skin = 1,\r\n    Instance = 2,\r\n}\r\nexport class NativeRenderElementOBJ implements IRenderElement {\r\n\r\n    private geometry: IRenderGeometryElement;\r\n\r\n    private materialShaderData: NativeShaderData;\r\n\r\n    private renderShaderData: NativeShaderData;\r\n\r\n    private transform: Transform3D;\r\n\r\n    //private isRender: boolean;\r\n\r\n    private owner: IBaseRenderNode;\r\n\r\n    set _geometry(data: IRenderGeometryElement) {\r\n        this.geometry = data;\r\n        this._nativeObj._geometry = (data as any)._nativeObj;\r\n    }\r\n\r\n    get _geometry(): IRenderGeometryElement {\r\n        return this.geometry;\r\n    }\r\n\r\n    set _materialShaderData(data: NativeShaderData) {\r\n        this.materialShaderData = data;\r\n        this._nativeObj._materialShaderData = data ? (data as any)._nativeObj : null;\r\n    }\r\n\r\n    get _materialShaderData(): NativeShaderData {\r\n        return this.materialShaderData;\r\n    }\r\n\r\n    set _renderShaderData(data: NativeShaderData) {\r\n        this.renderShaderData = data;\r\n        this._nativeObj._renderShaderData = data ? (data as any)._nativeObj : null;\r\n    }\r\n\r\n    get _renderShaderData(): NativeShaderData {\r\n        return this.renderShaderData;\r\n    }\r\n\r\n    set _transform(data: Transform3D) {\r\n        this.transform = data;\r\n        this._nativeObj._transform = data ? (data as any)._nativeObj : null;\r\n    }\r\n\r\n    get _transform(): Transform3D {\r\n        return this.transform;\r\n    }\r\n\r\n    get _isRender(): boolean {\r\n        return this._nativeObj._isRender;\r\n    }\r\n\r\n    set _isRender(data: boolean) {\r\n        this._nativeObj._isRender = data;\r\n    }\r\n\r\n    get _invertFront(): boolean {\r\n        return this._nativeObj._invertFront;\r\n    }\r\n\r\n    set _invertFront(data: boolean) {\r\n        this._nativeObj._invertFront = data;\r\n    }\r\n\r\n    _nativeObj: any;\r\n    _shaderInstances: SingletonList<ShaderInstance>;\r\n    constructor() { \r\n        this._shaderInstances = new SingletonList();\r\n        this.init();\r\n    }\r\n    init(): void {\r\n       \r\n        this._nativeObj = new (window as any).conchRenderElement(RenderElementType.Base, (LayaGL.renderEngine as any)._nativeObj);\r\n    }\r\n\r\n    _owner: IBaseRenderNode;\r\n\r\n    _addShaderInstance(shader: ShaderInstance) {\r\n        this._shaderInstances.add(shader);\r\n        this._nativeObj._addShaderInstance((shader as any)._nativeObj);\r\n    }\r\n\r\n    _clearShaderInstance() {\r\n        this._shaderInstances.length = 0;\r\n        this._nativeObj._clearShaderInstance();\r\n    }\r\n    /**\r\n     * render RenderElement\r\n     * @param renderqueue \r\n     */\r\n    _render(context: IRenderContext3D): void {\r\n        UploadMemoryManager.syncRenderMemory();//\r\n        this._nativeObj._render((context as any)._nativeObj);\r\n    }\r\n\r\n    _destroy() {\r\n        this._nativeObj._destroy();\r\n        this.geometry = null;\r\n        this._shaderInstances = null; \r\n        this.materialShaderData = null;\r\n        this.renderShaderData = null;\r\n        this.transform = null;\r\n    }\r\n}","import { CommandEncoder } from \"../../../layagl/CommandEncoder\";\r\nimport { LayaGL } from \"../../../layagl/LayaGL\";\r\nimport { ShaderDataType, ShaderData } from \"../../../RenderEngine/RenderShader/ShaderData\";\r\nimport { ShaderPass } from \"../../../RenderEngine/RenderShader/ShaderPass\";\r\nimport { ShaderCompileDefineBase } from \"../../../webgl/utils/ShaderCompileDefineBase\";\r\n\r\n\r\n\r\nenum UniformParamsMapType {\r\n\tScene = 0,\r\n\tCamera,\r\n\tSprite,\r\n\tMaterial,\r\n}\r\n/**\r\n * @internal\r\n * <code>ShaderInstance</code> ShaderInstance\r\n */\r\nexport class NativeShaderInstance/* extends ShaderInstance */ {\r\n\r\n\t_nativeObj: any;\r\n\r\n\t/**@internal */\r\n\tprivate _shaderPass: ShaderCompileDefineBase | ShaderPass;\r\n\r\n\tconstructor(vs: string, ps: string, attributeMap: { [name: string]: [number, ShaderDataType] }, shaderPass: ShaderCompileDefineBase) {\r\n\t\t//super(vs, ps, attributeMap, shaderPass);\r\n\t\tthis._shaderPass = shaderPass;\r\n\t\tvar pConchAttributeMap: any = new (window as any).conchAttributeMap();\r\n\t\tfor (var k in attributeMap) {\r\n\t\t\tpConchAttributeMap.setAttributeValue(k, attributeMap[k][0]);\r\n\t\t}\r\n\t\t\r\n\t\tvar stateMap: { [stateID: number]: number } = {};\r\n\t\tfor (var s in stateMap) {\r\n\t\t\tpConchAttributeMap.setStateValue(parseInt(s), stateMap[s]);\r\n\t\t}\r\n\t\tpConchAttributeMap.statefirst = (<ShaderPass>this._shaderPass).statefirst;\r\n\t\tvar renderState: any = (<ShaderPass>shaderPass).renderState;\r\n\t\tthis._nativeObj = new (window as any).conchShaderInstance((LayaGL.renderEngine as any)._nativeObj, vs, ps, pConchAttributeMap, renderState._nativeObj);\r\n\t}\r\n\t/**\r\n\t * @inheritDoc\r\n\t * @override\r\n\t */\r\n\tprotected _disposeResource(): void {\r\n\t\tthis._nativeObj.destroy();\r\n\t}\r\n\r\n\r\n\tbind() {\r\n\t\treturn this._nativeObj.bind();\r\n\t}\r\n\r\n\tuploadUniforms(shaderUniform: CommandEncoder, shaderDatas: ShaderData, uploadUnTexture: boolean) {\r\n\t\tthis._nativeObj.uploadUniforms(shaderUniform, (shaderDatas as any)._nativeObj, uploadUnTexture);\r\n\t}\r\n\r\n\t/**\r\n\t * @internal\r\n\t */\r\n\tuploadCustomUniform(index: number, data: any): void {\r\n\t\tthis._nativeObj.uploadCustomUniforms(index, data);\r\n\t}\r\n\tget _sceneUniformParamsMap(): CommandEncoder {\r\n\t\treturn (UniformParamsMapType.Scene as unknown as CommandEncoder);\r\n\t}\r\n\r\n\tget _cameraUniformParamsMap(): CommandEncoder {\r\n\t\treturn (UniformParamsMapType.Camera as unknown as CommandEncoder);\r\n\t}\r\n\r\n\tget _spriteUniformParamsMap(): CommandEncoder {\r\n\t\treturn (UniformParamsMapType.Sprite as unknown as CommandEncoder);\r\n\t}\r\n\r\n\tget _materialUniformParamsMap(): CommandEncoder {\r\n\t\treturn (UniformParamsMapType.Material as unknown as CommandEncoder);\r\n\t}\r\n\r\n\tuploadRenderStateBlendDepth(shaderDatas: ShaderData): void {\r\n\t\tthis._nativeObj.uploadRenderStateBlendDepth((shaderDatas as any)._nativeObj);\r\n\t}\r\n\r\n\tuploadRenderStateFrontFace(shaderDatas: ShaderData, isTarget: boolean, invertFront: boolean): void {\r\n\t\tthis._nativeObj.uploadRenderStateFrontFace((shaderDatas as any)._nativeObj, isTarget, invertFront);\r\n\t}\r\n}\r\n\r\n","\r\nimport { LayaGL } from \"../../../layagl/LayaGL\";\r\nimport { VertexBuffer3D } from \"../../graphics/VertexBuffer3D\";\r\nimport { NativeRenderElementOBJ, RenderElementType } from \"./NativeRenderElementOBJ\";\r\n\r\nexport class NativeInstanceRenderElementOBJ extends NativeRenderElementOBJ {\r\n    /**@internal instance,*/\r\n    private _vertexBuffer3D: Array<VertexBuffer3D> = [];\r\n\r\n    private _updateData: Array<Float32Array> = [];\r\n\r\n\r\n    private _updateNums: number;\r\n\r\n    /**\r\n     * UpdateBuffer\r\n     * @param vb \r\n     * @param length instance\r\n     */\r\n    addUpdateBuffer(vb: VertexBuffer3D,length:number) {\r\n        this._vertexBuffer3D[this._updateNums++] = vb;\r\n        this._nativeObj.addUpdateBuffer((vb as any)._conchVertexBuffer3D, length);\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @param index index of Buffer3D\r\n     * @param length length of array\r\n     */\r\n    getUpdateData(index: number,length:number): Float32Array {\r\n        let data = this._updateData[index];\r\n        if (!data || data.length < length) {\r\n            data = this._updateData[index] = new Float32Array(length);\r\n            this._nativeObj.getUpdateData(index, data);\r\n        }\r\n        return data;\r\n    }\r\n\r\n    constructor() {\r\n        super();\r\n    }\r\n\r\n    clear() {\r\n        this._updateNums = 0;\r\n        this._nativeObj.clear();\r\n    }\r\n\r\n    init(): void {\r\n        this._nativeObj = new (window as any).conchRenderElement(RenderElementType.Instance, (LayaGL.renderEngine as any)._nativeObj);\r\n    }\r\n\r\n    set drawCount(drawCount: number) {\r\n\t\tthis._nativeObj.drawCount = drawCount;\r\n\t} \r\n\r\n\tget drawCount(): number {\r\n\t\treturn this._nativeObj.drawCount;\r\n\t}\r\n}","\r\nimport { LayaGL } from \"../../../layagl/LayaGL\";\r\nimport { Vector4 } from \"../../../maths/Vector4\";\r\nimport { IRenderTarget } from \"../../../RenderEngine/RenderInterface/IRenderTarget\";\r\nimport { IRenderContext3D, PipelineMode } from \"../../../RenderEngine/RenderInterface/RenderPipelineInterface/IRenderContext3D\";\r\nimport { ShaderData } from \"../../../RenderEngine/RenderShader/ShaderData\";\r\nimport { Viewport } from \"../../math/Viewport\";\r\nimport { NativeRenderElementOBJ } from \"./NativeRenderElementOBJ\";\r\n\r\nexport class NativeRenderContext3DOBJ implements IRenderContext3D {\r\n\r\n    //dest Texture\r\n    private _destTarget: IRenderTarget;\r\n\r\n    //viewPort\r\n    private _viewPort: Viewport;\r\n    //scissor\r\n    private _scissor: Vector4;\r\n\r\n    private _confifShaderData: ShaderData;\r\n    //Camera Shader Data\r\n    private _cameraShaderData: ShaderData;\r\n    //scene Shader Data\r\n    private _sceneShaderData: ShaderData;\r\n    //Global ShaderData\r\n    private _globalShaderData: ShaderData;\r\n\t\r\n    private _nativeObj: any;\r\n\r\n    constructor() {\r\n        this._viewPort = new Viewport(0, 0, 0, 0);\r\n        this._scissor = new Vector4();\r\n        this._nativeObj = new (window as any).conchRenderContext3D((LayaGL.renderEngine as any)._nativeObj);\r\n\t\tthis.pipelineMode = \"Forward\";\r\n    }\r\n    end(): void {\r\n        //TODO\r\n    }\r\n    drawRenderElement(renderelemt: NativeRenderElementOBJ): void {\r\n        renderelemt._render(this);\r\n    }\r\n\r\n    /**IRenderContext */\r\n    applyContext(cameraUpdateMark: number): void {\r\n        this._nativeObj.changeViewport(this._viewPort.x, this._viewPort.y, this._viewPort.width, this._viewPort.height);\r\n        this._nativeObj.changeScissor(this._scissor.x, this._scissor.y, this._scissor.z, this._scissor.w);\r\n        this.destTarget && this.destTarget._start();\r\n        this._nativeObj.applyContext(cameraUpdateMark);\r\n    }\r\n    set destTarget(destTarget: IRenderTarget) {\r\n        this._destTarget = destTarget;\r\n        this._nativeObj.destTarget = destTarget ? destTarget._renderTarget : null;\r\n    }\r\n\r\n    get destTarget(): IRenderTarget {\r\n        return this._destTarget;\r\n    }\r\n\r\n    set viewPort(viewPort: Viewport) {\r\n        this._viewPort = viewPort;\r\n        this._nativeObj.changeViewport(viewPort.x, viewPort.y, viewPort.width, viewPort.height)\r\n    }\r\n\r\n    get viewPort(): Viewport {\r\n        return this._viewPort;\r\n    }\r\n\r\n    set scissor(scissor: Vector4) {\r\n        this._scissor = scissor;\r\n        this._nativeObj.changeScissor(scissor.x, scissor.y, scissor.z, scissor.w)\r\n    }\r\n\r\n    get scissor(): Vector4 {\r\n        return this._scissor;\r\n    }\r\n\r\n    set invertY(invertY: boolean) {\r\n        this._nativeObj.invertY = invertY;\r\n    }\r\n\r\n    get invertY(): boolean {\r\n        return this._nativeObj.invertY;\r\n    }\r\n\r\n    set pipelineMode(pipelineMode: PipelineMode) {\r\n        this._nativeObj.pipelineMode = pipelineMode;\r\n    }\r\n\r\n    get pipelineMode(): PipelineMode {\r\n        return this._nativeObj.pipelineMode;\r\n    }\r\n\r\n    get configShaderData(): ShaderData {\r\n        return this._confifShaderData;\r\n    }\r\n\r\n    set configShaderData(value: ShaderData) {\r\n        this._confifShaderData = value;\r\n        this._nativeObj.configShaderData = value ? (value as any)._nativeObj : null;\r\n    }\r\n\r\n    set globalShaderData(globalShaderData: ShaderData) {\r\n        this._globalShaderData = globalShaderData;\r\n        this._nativeObj.globalShaderData = globalShaderData ? (globalShaderData as any)._nativeObj : null;\r\n    }\r\n\r\n    get globalShaderData(): ShaderData {\r\n        return this._globalShaderData;\r\n    }\r\n\r\n    set sceneShaderData(sceneShaderData: ShaderData) {\r\n        this._sceneShaderData = sceneShaderData;\r\n        this._nativeObj.sceneShaderData = sceneShaderData ? (sceneShaderData as any)._nativeObj : null;\r\n    }\r\n\r\n    get sceneShaderData(): ShaderData {\r\n        return this._sceneShaderData;\r\n    }\r\n\r\n    set cameraShaderData(cameraShaderData: ShaderData) {\r\n        this._cameraShaderData = cameraShaderData;\r\n        this._nativeObj.cameraShaderData = cameraShaderData ? (cameraShaderData as any)._nativeObj : null;\r\n    }\r\n\r\n    get cameraShaderData(): ShaderData {\r\n        return this._cameraShaderData;\r\n    }\r\n\r\n    set sceneID(sceneID: number) {\r\n        this._nativeObj.sceneID = sceneID;\r\n    }\r\n\r\n    get sceneID(): number {\r\n        return this._nativeObj.sceneID;\r\n    }\r\n\r\n    set cameraUpdateMark(cameraUpdateMark: number) {\r\n        this._nativeObj.cameraUpdateMark = cameraUpdateMark;\r\n    }\r\n\r\n    get cameraUpdateMark(): number {\r\n        return this._nativeObj.cameraUpdateMark;\r\n    }\r\n\r\n\r\n}","import { DrawType } from \"../../../RenderEngine/RenderEnum/DrawType\";\r\nimport { IndexFormat } from \"../../../RenderEngine/RenderEnum/IndexFormat\";\r\nimport { MeshTopology } from \"../../../RenderEngine/RenderEnum/RenderPologyMode\";\r\nimport { IRenderGeometryElement } from \"../../../RenderEngine/RenderInterface/RenderPipelineInterface/IRenderGeometryElement\";\r\nimport { SingletonList } from \"../../../utils/SingletonList\";\r\nimport { BufferState } from \"../../../webgl/utils/BufferState\";\r\n\r\n\r\n\r\nexport class NativeRenderGeometryElementOBJ implements IRenderGeometryElement {\r\n  /**@internal */\r\n  private _bufferState: BufferState;\r\n\r\n   /**@internal */\r\n   drawParams: SingletonList<number>;\r\n   \r\n  _nativeObj: any;\r\n\r\n  /**@internal */\r\n  constructor(mode: MeshTopology, drawType: DrawType) {\r\n    this._nativeObj = new (window as any).conchRenderGeometryElement(mode, drawType);\r\n    this.drawParams = new SingletonList();\r\n  }\r\n\r\n  /**@internal */\r\n  setDrawArrayParams(first: number, count: number): void {\r\n    this.drawParams.add(first);\r\n    this.drawParams.add(count);\r\n    this._nativeObj.setDrawArrayParams(first, count);\r\n  }\r\n\r\n  /**@internal */\r\n  setDrawElemenParams(count: number, offset: number): void {\r\n    this.drawParams.add(offset);\r\n    this.drawParams.add(count);\r\n    this._nativeObj.setDrawElemenParams(count, offset);\r\n  }\r\n  \r\n  /**@internal */\r\n  destroy(): void {\r\n    this._nativeObj.destroy();\r\n  }\r\n\r\n  clearRenderParams() {\r\n    this.drawParams.length = 0;\r\n    this._nativeObj.clearRenderParams();\r\n  }\r\n\r\n  set bufferState(value: BufferState) {\r\n    this._bufferState = value;\r\n    if (value) {\r\n      this._nativeObj.bufferState = (value as any)._nativeVertexArrayObject._nativeObj;\r\n    }\r\n    else {\r\n      this._nativeObj.bufferState = null;\r\n    }\r\n  }\r\n\r\n  get bufferState(): BufferState {\r\n    return this._bufferState;\r\n  }\r\n\r\n  set mode(value: MeshTopology) {\r\n    this._nativeObj.mode = value;\r\n  }\r\n\r\n  get mode(): MeshTopology {\r\n    return this._nativeObj.mode;\r\n  }\r\n\r\n  set drawType(value: DrawType) {\r\n    this._nativeObj.drawType = value;\r\n  }\r\n\r\n  get drawType(): DrawType {\r\n    return this._nativeObj.drawType;\r\n  }\r\n\r\n  set instanceCount(value: number) {\r\n    this._nativeObj.instanceCount = value;\r\n  }\r\n\r\n  get instanceCount(): number {\r\n    return this._nativeObj.instanceCount;\r\n  }\r\n\r\n  set indexFormat(value: IndexFormat) {\r\n    this._nativeObj.indexFormat = value;\r\n  }\r\n\r\n  get indexFormat(): IndexFormat {\r\n    return this._nativeObj.indexFormat;\r\n  }\r\n}","import { ISceneRenderManager } from \"../../../RenderEngine/RenderInterface/RenderPipelineInterface/ISceneRenderManager\";\r\nimport { SingletonList } from \"../../../utils/SingletonList\";\r\nimport { BaseRender } from \"../../core/render/BaseRender\";\r\n\r\n\r\n\r\nexport class NativeSceneRenderManager implements ISceneRenderManager {\r\n    /** @internal */\r\n    _renders: SingletonList<BaseRender> = new SingletonList();\r\n    //Bounds\r\n    _customUpdateList: SingletonList<BaseRender> = new SingletonList();\r\n    //\r\n    _customCullList: SingletonList<BaseRender> = new SingletonList();\r\n    private _nativeObj: any;\r\n    constructor() {\r\n        this._nativeObj = new (window as any).conchSceneCullManger();\r\n    }\r\n\r\n    get list() {\r\n        return this._renders;\r\n    }\r\n\r\n    set list(value) {\r\n        this._customCullList.elements = [];\r\n        this._customCullList.length = 0;\r\n        this._nativeObj.clear();  \r\n        this._renders.clear();\r\n        for (let i = 0, len = value.length; i < len; i++) {\r\n            this.addRenderObject((value.elements[i] as BaseRender));\r\n        }\r\n    }\r\n\r\n    addRenderObject(object: BaseRender): void {\r\n        \r\n        this._renders.add(object);\r\n        if (!object._customCull && object.renderNode.geometryBounds) {\r\n            this._nativeObj.addRenderObject((object.renderNode as any)._nativeObj);\r\n        }\r\n        else {\r\n             this._customCullList.add(object);\r\n        }\r\n\r\n    }\r\n\r\n    removeRenderObject(object: BaseRender): void {\r\n        \r\n        if (!object._customCull && object.renderNode.geometryBounds) {\r\n            this._nativeObj.removeRenderObject((object.renderNode as any)._nativeObj);\r\n        }\r\n        else {\r\n            //remove\r\n            let elements = this._customCullList.elements;\r\n            let index = elements.indexOf(object);\r\n            if (index < this._customCullList.length) {\r\n                this._customCullList.length -= 1;\r\n                elements[index] = elements[this._customCullList.length];\r\n            }\r\n        }\r\n        this._renders.remove(object);\r\n        this.removeMotionObject(object);\r\n    }\r\n\r\n    removeMotionObject(object: BaseRender): void {\r\n        \r\n        if (object.renderNode.geometryBounds) {\r\n            //nativeBounds\r\n            this._nativeObj.removeMotionObject((object.renderNode as any)._nativeObj);\r\n        } else {\r\n            let index = object._motionIndexList;\r\n            if (index != -1) {//remove\r\n                let elements = this._customUpdateList.elements;\r\n                this._customUpdateList.length -= 1;\r\n                elements[length]._motionIndexList = index;\r\n                elements[index] = elements[length];\r\n            }\r\n        }\r\n    }\r\n\r\n    updateMotionObjects(): void {\r\n        \r\n        //update native Motion Node\r\n        this._nativeObj.updateMotionObjects();\r\n\r\n        for (let i = 0; i < this._customUpdateList.length; i++) {\r\n            this._customUpdateList.elements[i].bounds;\r\n            this._customUpdateList.elements[i]._motionIndexList = -1;\r\n        }\r\n        this._customUpdateList.length = 0;\r\n    }\r\n\r\n    addMotionObject(object: BaseRender): void {\r\n        \r\n        if (object.renderNode.geometryBounds) {\r\n            this._nativeObj.addMotionObject((object.renderNode as any)._nativeObj);\r\n        } else {\r\n            if (object._motionIndexList == -1) {\r\n                object._motionIndexList = this._customUpdateList.length;\r\n                this._customUpdateList.add(object);\r\n            }\r\n        }\r\n    }\r\n\r\n    destroy(): void {\r\n        this._nativeObj.destroy(); \r\n        this._renders.destroy();\r\n        //Destroy\r\n        this._customUpdateList.destroy();\r\n        this._customCullList.destroy();\r\n    }\r\n\r\n}","import { Vector3 } from \"../../../maths/Vector3\";\r\nimport { NativeMemory } from \"../../../RenderEngine/RenderEngine/NativeGLEngine/CommonMemory/NativeMemory\";\r\nimport { IShadowCullInfo } from \"../../../RenderEngine/RenderInterface/RenderPipelineInterface/IShadowCullInfo\";\r\nimport { BoundSphere } from \"../../math/BoundSphere\";\r\nimport { Plane } from \"../../math/Plane\";\r\n\r\n\r\nexport class NativeShadowCullInfo implements IShadowCullInfo {\r\n\r\n    private _position: Vector3;\r\n\r\n\tprivate _cullPlanes: Plane[];\r\n\r\n    private _direction: Vector3;\r\n\r\n    private _nativeObj: any;\r\n\t\r\n\tprivate _cullSphere: BoundSphere;\r\n\r\n\tprivate _cullPlaneCount: number;\r\n\r\n\t/**native Share Memory */\r\n\tstatic MemoryBlock_size: number = 4 * 8;\r\n\r\n\tprivate nativeMemory: NativeMemory;\r\n\t\r\n\tprivate float64Array: Float64Array;\r\n\r\n\tconstructor() {\r\n\t\tthis.nativeMemory = new NativeMemory(NativeShadowCullInfo.MemoryBlock_size, true);\r\n\t\tthis.float64Array = this.nativeMemory.float64Array;\r\n    \tthis._nativeObj = new (window as any).conchShadowCullInfo(this.nativeMemory._buffer);\r\n  \t}\r\n    set cullPlanes(cullPlanes: Plane[]) {\r\n\t\tthis._cullPlanes = cullPlanes;\r\n        this._nativeObj.clearCullPlanes();\r\n        cullPlanes.forEach((element) => {\r\n\t\t\tthis.float64Array[0] = element.normal.x;\r\n        \tthis.float64Array[1] = element.normal.y;\r\n        \tthis.float64Array[2] = element.normal.z;\r\n\t\t\tthis.float64Array[3] = element.distance;\r\n            this._nativeObj.addCullPlane();\r\n        });\r\n\t}\r\n\tget cullPlanes(): Plane[] {\r\n\t\treturn this._cullPlanes;\r\n\t}\r\n    set cullSphere(cullSphere: BoundSphere) {\r\n\t\tthis._cullSphere = cullSphere;\r\n\t\tthis.float64Array[0] = cullSphere.center.x;\r\n        this.float64Array[1] = cullSphere.center.y;\r\n        this.float64Array[2] = cullSphere.center.z;\r\n\t\tthis.float64Array[3] = cullSphere.radius;\r\n\t\tthis._nativeObj.setCullSphere();\r\n\t}\r\n\t\r\n\tget cullSphere(): BoundSphere {\r\n\t\treturn this._cullSphere;\r\n\t}\r\n    set position(position: Vector3) {\r\n\t\tthis._position = position;\r\n\t\tthis.float64Array[0] = position.x;\r\n        this.float64Array[1] = position.y;\r\n        this.float64Array[2] = position.z;\r\n\t\tthis._nativeObj.setPosition();\r\n\t} \r\n\r\n\tget position(): Vector3 {\r\n\t\treturn this._position;\r\n\t}\r\n    set direction(direction: Vector3) {\r\n\t\tthis._direction = direction;\r\n\t\tthis.float64Array[0] = direction.x;\r\n        this.float64Array[1] = direction.y;\r\n        this.float64Array[2] = direction.z;\r\n\t\tthis._nativeObj.setDirection();\r\n\t} \r\n\r\n\tget direction(): Vector3 {\r\n\t\treturn this._direction;\r\n\t}\r\n\r\n    set cullPlaneCount(cullPlaneCount: number) {\r\n\t\tthis._cullPlaneCount = cullPlaneCount;\r\n\t\tthis._nativeObj.cullPlaneCount = cullPlaneCount;\r\n\t} \r\n\r\n\tget cullPlaneCount(): number {\r\n\t\treturn this._cullPlaneCount;\r\n\t}\r\n}","\r\nimport { LayaGL } from \"../../../layagl/LayaGL\";\r\nimport { NativeRenderElementOBJ, RenderElementType } from \"./NativeRenderElementOBJ\";\r\n\r\nexport class NativeSkinRenderElementOBJ extends  NativeRenderElementOBJ {\r\n    \r\n    _skinnedData:Float32Array[];\r\n\r\n    constructor(){\r\n        super();\r\n    }\r\n    get skinnedData():Float32Array[] {\r\n        return this._skinnedData;\r\n    }\r\n    set skinnedData(data:Float32Array[]) {\r\n        this._skinnedData = data;\r\n        this._nativeObj._skinnedData = data;\r\n    }\r\n    init(): void {\r\n        this._nativeObj = new (window as any).conchRenderElement(RenderElementType.Skin, (LayaGL.renderEngine as any)._nativeObj);\r\n    }\r\n}","import { EventDispatcher } from \"../../../events/EventDispatcher\";\r\nimport { Matrix4x4 } from \"../../../maths/Matrix4x4\";\r\nimport { Quaternion } from \"../../../maths/Quaternion\";\r\nimport { Vector3 } from \"../../../maths/Vector3\";\r\nimport { NativeMemory } from \"../../../RenderEngine/RenderEngine/NativeGLEngine/CommonMemory/NativeMemory\";\r\nimport { Sprite3D } from \"../../core/Sprite3D\";\r\nimport { Transform3D } from \"../../core/Transform3D\";\r\n\r\n/**\r\n * <code>Transform3D</code> 3D\r\n */\r\nexport class NativeTransform3D  extends Transform3D {\r\n\r\n    static MemoryBlock_size: number = 16 * 4;\r\n\r\n    /**native Share Memory */\r\n    private nativeMemory: NativeMemory;\r\n    private float32Array: Float32Array;\r\n\tprivate float64Array: Float64Array;\r\n    private int32Array: Int32Array;\r\n\tprivate eventDispatcher: EventDispatcher;\r\n    _nativeObj: any;\r\n\r\n\t/**\r\n\t * @internal\r\n\t */\r\n\tget _isFrontFaceInvert(): boolean {\r\n        return this._nativeObj._isFrontFaceInvert;\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t */\r\n\tget owner(): Sprite3D {\r\n\t\treturn this._owner;\r\n\t}\r\n\r\n\t/**\r\n\t * X\r\n\t */\r\n\tget localPositionX(): number {\r\n\t\treturn this.localPosition.x;\r\n\t}\r\n\r\n\tset localPositionX(x: number) {\r\n\t\tthis._localPosition.x = x;\r\n\t\tthis.localPosition = this._localPosition;\r\n\t}\r\n\r\n\t/**\r\n\t * Y\r\n\t */\r\n\tget localPositionY(): number {\r\n\t\treturn this.localPosition.y;\r\n\t}\r\n\r\n\tset localPositionY(y: number) {\r\n\t\tthis._localPosition.y = y;\r\n\t\tthis.localPosition = this._localPosition;\r\n\t}\r\n\r\n\t/**\r\n\t * Z\r\n\t */\r\n\tget localPositionZ(): number {\r\n\t\treturn this.localPosition.z;\r\n\t}\r\n\r\n\tset localPositionZ(z: number) {\r\n\t\tthis._localPosition.z = z;\r\n\t\tthis.localPosition = this._localPosition;\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t */\r\n\tget localPosition(): Vector3 {\r\n        if (this._nativeObj.getLocalPosition()) {\r\n        \tthis._localPosition.x = this.float64Array[0];\r\n       \t \tthis._localPosition.y = this.float64Array[1];\r\n        \tthis._localPosition.z = this.float64Array[2];\r\n\t\t}\r\n\t\treturn this._localPosition;\r\n\t}\r\n\r\n\tset localPosition(value: Vector3) {\r\n        this._localPosition.x = this.float64Array[0] = value.x;\r\n        this._localPosition.y = this.float64Array[1] = value.y;\r\n        this._localPosition.z = this.float64Array[2] = value.z;\r\n\t\tthis._nativeObj.setLocalPosition();\r\n\t}\r\n\r\n\t/**\r\n\t * X\r\n\t */\r\n\tget localRotationX(): number {\r\n\t\treturn this.localRotation.x;\r\n\t}\r\n\r\n\tset localRotationX(x: number) {\r\n\t\tlet rot = this.localRotation;\r\n\t\trot.x = x;\r\n\t\tthis.localRotation = rot;\r\n\t}\r\n\r\n\t/**\r\n\t * Y\r\n\t */\r\n\tget localRotationY(): number {\r\n\t\treturn this.localRotation.y;\r\n\t}\r\n\r\n\tset localRotationY(y: number) {\r\n\t\tlet rot = this.localRotation;\r\n\t\trot.y = y;\r\n\t\tthis.localRotation = rot;\r\n\t}\r\n\r\n\t/**\r\n\t * Z\r\n\t */\r\n\tget localRotationZ(): number {\r\n\t\treturn this.localRotation.z;\r\n\t}\r\n\r\n\tset localRotationZ(z: number) {\r\n\t\tlet rot = this.localRotation;\r\n\t\trot.z = z;\r\n\t\tthis.localRotation = rot;\r\n\t}\r\n\r\n\t/**\r\n\t * W\r\n\t */\r\n\tget localRotationW(): number {\r\n\t\treturn this.localRotation.w;\r\n\t}\r\n\r\n\tset localRotationW(w: number) {\r\n\t\tlet rot = this.localRotation;\r\n\t\trot.w = w;\r\n\t\tthis.localRotation = rot;\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t */\r\n\tget localRotation(): Quaternion {\r\n        if (this._nativeObj.getLocalRotation()) {\r\n        \tthis._localRotation.x = this.float64Array[0];\r\n        \tthis._localRotation.y = this.float64Array[1];\r\n        \tthis._localRotation.z = this.float64Array[2];\r\n        \tthis._localRotation.w = this.float64Array[3];\r\n\t\t}\r\n\t\treturn this._localRotation;\r\n\t}\r\n\r\n\tset localRotation(value: Quaternion) {\r\n        this._localRotation.x = this.float64Array[0] = value.x;\r\n        this._localRotation.y = this.float64Array[1] = value.y;\r\n        this._localRotation.z = this.float64Array[2] = value.z;\r\n        this._localRotation.w = this.float64Array[3] = value.w;\r\n\t\tthis._nativeObj.setLocalRotation();\r\n\t}\r\n\r\n\t/**\r\n\t * X\r\n\t */\r\n\tget localScaleX(): number {\r\n\t\treturn this.localScale.x;\r\n\t}\r\n\r\n\tset localScaleX(value: number) {\r\n\t\tthis._localScale.x = value;\r\n\t\tthis.localScale = this._localScale;\r\n\t}\r\n\r\n\t/**\r\n\t * Y\r\n\t */\r\n\tget localScaleY(): number {\r\n\t\treturn this.localScale.y;\r\n\t}\r\n\r\n\tset localScaleY(value: number) {\r\n\t\tthis._localScale.y = value;\r\n\t\tthis.localScale = this._localScale;\r\n\t}\r\n\r\n\t/**\r\n\t * Z\r\n\t */\r\n\tget localScaleZ(): number {\r\n\t\treturn this.localScale.z;\r\n\t}\r\n\r\n\tset localScaleZ(value: number) {\r\n\t\tthis._localScale.z = value;\r\n\t\tthis.localScale = this._localScale;\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t */\r\n\tget localScale(): Vector3 {\r\n        if (this._nativeObj.getLocalScale())\r\n\t\t{\r\n        \tthis._localScale.x = this.float64Array[0];\r\n        \tthis._localScale.y = this.float64Array[1];\r\n        \tthis._localScale.z = this.float64Array[2];\r\n\t\t}\r\n\t\treturn this._localScale;\r\n\t}\r\n\r\n\tset localScale(value: Vector3) {\r\n\t\tthis._localScale.x = this.float64Array[0] = value.x;\r\n        this._localScale.y = this.float64Array[1] = value.y;\r\n        this._localScale.z = this.float64Array[2] = value.z;\r\n\t\tthis._nativeObj.setLocalScale();\r\n\t}\r\n\r\n\t/**\r\n\t * X\r\n\t */\r\n\tget localRotationEulerX(): number {\r\n\t\treturn this.localRotationEuler.x;\r\n\t}\r\n\r\n\tset localRotationEulerX(value: number) {\r\n\t\tlet rot = this.localRotationEuler;\r\n\t\trot.x = value;\r\n\t\tthis.localRotationEuler = rot;\r\n\t}\r\n\r\n\t/**\r\n\t * Y\r\n\t */\r\n\tget localRotationEulerY(): number {\r\n\t\treturn this.localRotationEuler.y;\r\n\t}\r\n\r\n\tset localRotationEulerY(value: number) {\r\n\t\tlet rot = this.localRotationEuler;\r\n\t\trot.y = value;\r\n\t\tthis.localRotationEuler = rot;\r\n\t}\r\n\r\n\t/**\r\n\t * Z\r\n\t */\r\n\tget localRotationEulerZ(): number {\r\n\t\treturn this.localRotationEuler.z;\r\n\t}\r\n\r\n\tset localRotationEulerZ(value: number) {\r\n\t\tlet rot = this.localRotationEuler;\r\n\t\trot.z = value;\r\n\t\tthis.localRotationEuler = rot;\r\n\t}                                                                                                      \r\n\r\n\t/**\r\n\t * \r\n\t */\r\n\tget localRotationEuler(): Vector3 {\r\n\t\tif (this._nativeObj.getLocalRotationEuler()) {\r\n        \tthis._localRotationEuler.x = this.float64Array[0];\r\n       \t \tthis._localRotationEuler.y = this.float64Array[1];\r\n        \tthis._localRotationEuler.z = this.float64Array[2];\r\n\t\t}\r\n\t\treturn this._localRotationEuler;\r\n\t}\r\n\r\n\tset localRotationEuler(value: Vector3) {\r\n\t\tthis._localRotationEuler.x = this.float64Array[0] = value.x;\r\n        this._localRotationEuler.y = this.float64Array[1] = value.y;\r\n        this._localRotationEuler.z = this.float64Array[2] = value.z;\r\n\t\tthis._nativeObj.setLocalRotationEuler();\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t */\r\n\tget localMatrix(): Matrix4x4 {\r\n        if (this._nativeObj.getLocalMatrix()) {\r\n        \tfor (var i = 0; i < 16; ++i) {\r\n\t\t\t\tthis._localMatrix.elements[i] = this.float32Array[i];\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn this._localMatrix;\r\n\t}\r\n\r\n\tset localMatrix(value: Matrix4x4) {\r\n\t\tif (this._localMatrix !== value)\r\n\t\t\tvalue.cloneTo(this._localMatrix);\r\n        this.float32Array.set(value.elements);\r\n\t\tthis._nativeObj.setLocalMatrix();\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t */\r\n\tget position(): Vector3 {  \r\n        if (this._nativeObj.getPosition()) {\r\n        \tthis._position.x = this.float64Array[0];\r\n        \tthis._position.y = this.float64Array[1];\r\n        \tthis._position.z = this.float64Array[2];\r\n\t\t}\r\n\t\treturn this._position;\r\n\t}\r\n\r\n\tset position(value: Vector3) {\r\n        this._position.x = this.float64Array[0] = value.x;\r\n        this._position.y = this.float64Array[1] = value.y;\r\n        this._position.z = this.float64Array[2] = value.z;\r\n\t\tthis._nativeObj.setPosition();\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t */\r\n\tget rotation(): Quaternion {\r\n\t\tif (this._nativeObj.getRotation()) {\r\n        \tthis._rotation.x = this.float64Array[0];\r\n        \tthis._rotation.y = this.float64Array[1];\r\n        \tthis._rotation.z = this.float64Array[2];\r\n        \tthis._rotation.w = this.float64Array[3];\r\n\t\t}\r\n\t\treturn this._rotation;\r\n\t}\r\n\r\n\tset rotation(value: Quaternion) {\r\n        this._rotation.x = this.float64Array[0] = value.x;\r\n        this._rotation.y = this.float64Array[1] = value.y;\r\n        this._rotation.z = this.float64Array[2] = value.z;\r\n        this._rotation.w = this.float64Array[3] = value.w;\r\n\t\tthis._nativeObj.setRotation();\r\n\t}\r\n\r\n\r\n\t/**\r\n\t * xyz\r\n\t */\r\n\tget rotationEuler(): Vector3 {\r\n\t\tif (this._nativeObj.getRotationEuler()) {\r\n        \tthis._rotationEuler.x = this.float64Array[0];\r\n        \tthis._rotationEuler.y = this.float64Array[1];\r\n        \tthis._rotationEuler.z = this.float64Array[2];\r\n\t\t}\r\n\t\treturn this._rotationEuler;\r\n\t}\r\n\r\n\tset rotationEuler(value: Vector3) {\r\n\t\tthis._rotationEuler.x = this.float64Array[0] = value.x;\r\n        this._rotationEuler.y = this.float64Array[1] = value.y;\r\n        this._rotationEuler.z = this.float64Array[2] = value.z;\r\n\t\tthis._nativeObj.setRotationEuler();\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t */\r\n\tget worldMatrix(): Matrix4x4 {\r\n\t\tif (this._nativeObj.getWorldMatrix()) {\r\n        \tfor (var i = 0; i < 16; i++) {\r\n\t\t\t\tthis._worldMatrix.elements[i] = this.float32Array[i];\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn this._worldMatrix;\r\n\t}\r\n\r\n\tset worldMatrix(value: Matrix4x4) {\r\n\t\tif (this._worldMatrix !== value)\r\n\t\t\tvalue.cloneTo(this._worldMatrix);\r\n        this.float32Array.set(value.elements);\r\n\t\tthis._nativeObj.setWorldMatrix();\r\n\t}\r\n\r\n\t/**\r\n\t *  <code>Transform3D</code> \r\n\t * @param owner \r\n\t */\r\n\tconstructor(owner: Sprite3D) {\r\n\t\tsuper(owner);\r\n        //native memory\r\n        this.nativeMemory = new NativeMemory(NativeTransform3D.MemoryBlock_size, true);\r\n        this.float32Array = this.nativeMemory.float32Array;\r\n\t\tthis.float64Array = this.nativeMemory.float64Array;\r\n        this.int32Array = this.nativeMemory.int32Array;\r\n\t\tthis.eventDispatcher = new EventDispatcher();\r\n        this._nativeObj = new (window as any).conchTransform(this.nativeMemory._buffer, this.eventDispatcher.event.bind(this.eventDispatcher));\r\n\t}\r\n\r\n\t/**\r\n\t * @internal\r\n\t */\r\n\t _setTransformFlag(type: number, value: boolean): void {\r\n\t\tthis._nativeObj && this._nativeObj._setTransformFlag(type, value);\r\n\t}\r\n\r\n\t/**\r\n\t * @internal\r\n\t */\r\n\t_getTransformFlag(type: number): boolean {\r\n\t\treturn this._nativeObj._getTransformFlag(type);\r\n\t}\r\n\r\n\t/**\r\n\t * @internal\r\n\t */\r\n\t_setParent(value: Transform3D): void {\r\n\t\tsuper._setParent(value);\r\n        this._nativeObj.setParent(value ? (value as any)._nativeObj : null);\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t * @param \ttranslation \r\n\t * @param \tisLocal \r\n\t */\r\n\ttranslate(translation: Vector3, isLocal: boolean = true): void {\r\n\t\tthis.float64Array[0] = translation.x;\r\n        this.float64Array[1] = translation.y;\r\n        this.float64Array[2] = translation.z;\r\n        this.int32Array[6] = isLocal ? 1 : 0;\r\n\t\tthis._nativeObj.translate();\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t * @param \trotations \r\n\t * @param \tisLocal \r\n\t * @param \tisRadian \r\n\t */\r\n\trotate(rotation: Vector3, isLocal: boolean = true, isRadian: boolean = true): void {\r\n\t\tthis.float64Array[0] = rotation.x;\r\n        this.float64Array[1] = rotation.y;\r\n        this.float64Array[2] = rotation.z;\r\n        this.int32Array[6] = isLocal ? 1 : 0;\r\n        this.int32Array[7] = isRadian ? 1 : 0;\r\n\t\tthis._nativeObj.rotate();\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t * @param forward \r\n\t */\r\n\tgetForward(forward: Vector3): void {\r\n\t\tvar worldMatElem: Float32Array = this.worldMatrix.elements;\r\n\t\tforward.x = -worldMatElem[8];\r\n\t\tforward.y = -worldMatElem[9];\r\n\t\tforward.z = -worldMatElem[10];\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t * @param up \r\n\t */\r\n\tgetUp(up: Vector3): void {\r\n\t\tvar worldMatElem: Float32Array = this.worldMatrix.elements;\r\n\t\tup.x = worldMatElem[4];\r\n\t\tup.y = worldMatElem[5];\r\n\t\tup.z = worldMatElem[6];\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t * @param \r\n\t */\r\n\tgetRight(right: Vector3): void {\r\n\t\tvar worldMatElem: Float32Array = this.worldMatrix.elements;\r\n\t\tright.x = worldMatElem[0];\r\n\t\tright.y = worldMatElem[1];\r\n\t\tright.z = worldMatElem[2];\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t * @param\ttarget \r\n\t * @param\tup \r\n\t * @param\tisLocal \r\n\t */\r\n\tlookAt(target: Vector3, up: Vector3, isLocal: boolean = false,isCamera:boolean = true): void {\r\n\t\tthis.float64Array[0] = target.x;\r\n        this.float64Array[1] = target.y;\r\n        this.float64Array[2] = target.z;\r\n        this.float64Array[3] = up.x;\r\n        this.float64Array[4] = up.y;\r\n        this.float64Array[5] = up.z;\r\n        this.int32Array[12] = isLocal ? 1 : 0;\r\n        this.int32Array[13] = isCamera ? 1 : 0;\r\n\t\tthis._nativeObj.lookAt();\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t * @param target \r\n\t * @param up \r\n\t * @param isLocal \r\n\t */\r\n\tobjLookat(target: Vector3, up: Vector3, isLocal: boolean = false):void{\r\n\r\n\t}\r\n\r\n\t\r\n\r\n\t/**\r\n\t * \r\n\t * Vector3,Matrix3x3\r\n\t * @return\t\r\n\t */\r\n\tgetWorldLossyScale(): Vector3 {\r\n        if (this._nativeObj.getWorldLossyScale()) {\r\n        \tthis._scale.x = this.float64Array[0];\r\n        \tthis._scale.y = this.float64Array[1];\r\n        \tthis._scale.z = this.float64Array[2];\r\n\t\t}\r\n\t\treturn this._scale;\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t * Vector3,Matrix3x3\r\n\t * @return\t\r\n\t */\r\n\tsetWorldLossyScale(value: Vector3) {\r\n\t\tthis._scale.x = this.float64Array[0] = value.x;\r\n        this._scale.y = this.float64Array[1] = value.y;\r\n        this._scale.z = this.float64Array[2] = value.z;\r\n\t\tthis._nativeObj.setWorldLossyScale();\r\n\t}\r\n\thasListener(type: string): boolean {\r\n        return this.eventDispatcher.hasListener(type);\r\n    }\r\n\r\n    event(type: string, data?: any): boolean {\r\n        return this.eventDispatcher.event(type, data);\r\n    }\r\n\r\n    on(type: string, listener: Function): EventDispatcher;\r\n    on(type: string, caller: any, listener: Function, args?: any[]): EventDispatcher;\r\n    on(type: string, caller: any, listener?: Function, args?: any[]): EventDispatcher {\r\n\t\tif (arguments.length == 2) {\r\n            listener = caller;\r\n            caller = null;\r\n        }\r\n\t\treturn this.eventDispatcher.on(type, caller, listener, args);\r\n    }\r\n\r\n    once(type: string, listener: Function): EventDispatcher;\r\n    once(type: string, caller: any, listener: Function, args?: any[]): EventDispatcher;\r\n    once(type: string, caller: any, listener?: Function, args?: any[]): EventDispatcher {\r\n\t\tif (arguments.length == 2) {\r\n            listener = caller;\r\n            caller = null;\r\n        }\r\n\t\treturn this.eventDispatcher.once(type, caller, listener, args);\r\n    }\r\n\r\n    off(type: string, listener: Function): EventDispatcher;\r\n    off(type: string, caller: any, listener?: Function, args?: any[]): EventDispatcher;\r\n    off(type: string, caller: any, listener?: Function): EventDispatcher {\r\n\t\tif (arguments.length == 2) {\r\n            listener = caller;\r\n            caller = null;\r\n        }\r\n\t\treturn this.eventDispatcher.off(type, caller, listener);\r\n    }\r\n\r\n    offAll(type?: string): EventDispatcher {\r\n        return this.eventDispatcher.offAll(type);\r\n    }\r\n\r\n    offAllCaller(caller: any): EventDispatcher {\r\n        return this.eventDispatcher.offAllCaller(caller);\r\n    }\r\n}\r\n\r\n\r\n","import { BufferTargetType, BufferUsage } from \"../../RenderEngine/RenderEnum/BufferTargetType\";\r\nimport { VertexBuffer } from \"../../RenderEngine/VertexBuffer\";\r\nimport { VertexDeclaration } from \"../../RenderEngine/VertexDeclaration\";\r\n\r\n\r\n/**\r\n * LayaGL.RenderOBJCreate.createIndexBuffer3D\r\n * <code>VertexBuffer3D</code> \r\n */\r\nexport class VertexBuffer3D extends VertexBuffer {\r\n\r\n\t/** @internal */\r\n\tprotected _canRead: boolean;\r\n\r\n\r\n\t/** @internal */\r\n\t_float32Reader: Float32Array | null = null;\r\n\r\n\t/**\r\n\t * \r\n\t */\r\n\tget vertexDeclaration(): VertexDeclaration | null {\r\n\t\treturn this._vertexDeclaration;\r\n\t}\r\n\r\n\tset vertexDeclaration(value: VertexDeclaration | null) {\r\n\t\tthis._vertexDeclaration = value;\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t */\r\n\tget canRead(): boolean {\r\n\t\treturn this._canRead;\r\n\t}\r\n\r\n\t/**\r\n\t *  <code>VertexBuffer3D</code> \r\n\t * @param\tbyteLength \r\n\t * @param\tbufferUsage VertexBuffer3D\r\n\t * @param\tcanRead \r\n\t */\r\n\tconstructor(byteLength: number, bufferUsage: BufferUsage, canRead: boolean = false) {\r\n\t\tsuper(BufferTargetType.ARRAY_BUFFER, bufferUsage);\r\n\t\tthis._canRead = canRead;\r\n\t\tthis._byteLength = byteLength;\r\n\t\tthis.bind();\r\n\t\tthis._glBuffer.setDataLength(byteLength)\r\n\t\tif (this._canRead) {\r\n\t\t\tthis._buffer = new Uint8Array(byteLength);\r\n\t\t\tthis._float32Reader = new Float32Array(this._buffer.buffer);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t */\r\n\torphanStorage(): void {\r\n\t\tthis.bind();\r\n\t\tthis._glBuffer.setDataLength(this._byteLength);\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t * @param\tdata \r\n\t * @param\tbufferOffset ,\r\n\t * @param\tdataStartIndex ,\r\n\t * @param\tdataCount ,\r\n\t */\r\n\tsetData(buffer: ArrayBuffer, bufferOffset: number = 0, dataStartIndex: number = 0, dataCount: number = Number.MAX_SAFE_INTEGER): void {\r\n\t\tthis.bind();\r\n\t\tvar needSubData: boolean = dataStartIndex !== 0 || dataCount !== Number.MAX_SAFE_INTEGER;\r\n\t\tif (needSubData) {\r\n\t\t\tvar subData: Uint8Array = new Uint8Array(buffer, dataStartIndex, dataCount);\r\n\t\t\tthis._glBuffer.setData(subData, bufferOffset);\r\n\t\t\tif (this._canRead)\r\n\t\t\t\tthis._buffer.set(subData, bufferOffset);\r\n\t\t}\r\n\t\telse {\r\n\t\t\tthis._glBuffer.setData(buffer, bufferOffset);\r\n\t\t\tif (this._canRead)\r\n\t\t\t\tthis._buffer.set(new Uint8Array(buffer), bufferOffset);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t * @return\t\r\n\t */\r\n\tgetUint8Data(): Uint8Array {\r\n\t\tif (this._canRead)\r\n\t\t\treturn <Uint8Array>this._buffer;\r\n\t\telse\r\n\t\t\tthrow new Error(\"Can't read data from VertexBuffer with only write flag!\");\r\n\t}\r\n\r\n\t/**\r\n\t * @ignore\r\n\t */\r\n\tgetFloat32Data(): Float32Array | null {\r\n\t\tif (this._canRead)\r\n\t\t\treturn this._float32Reader;\r\n\t\telse\r\n\t\t\tthrow new Error(\"Can't read data from VertexBuffer with only write flag!\");\r\n\t}\r\n\r\n\t/**\r\n\t * @ignore\r\n\t */\r\n\tmarkAsUnreadbale(): void {\r\n\t\tthis._canRead = false;\r\n\t\tthis._buffer = null;\r\n\t\tthis._float32Reader = null;\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t * @override\r\n\t */\r\n\tdestroy(): void {\r\n\t\tsuper.destroy();\r\n\t\tthis._buffer = null;\r\n\t\tthis._float32Reader = null;\r\n\t\tthis._vertexDeclaration = null;\r\n\t\tthis._byteLength = 0;\r\n\t}\r\n}\r\n\r\n\r\n\r\n\r\n","import { BufferUsage } from \"../../../RenderEngine/RenderEnum/BufferTargetType\";\r\nimport { VertexDeclaration } from \"../../../RenderEngine/VertexDeclaration\";\r\nimport { LayaGL } from \"../../../layagl/LayaGL\";\r\nimport { VertexBuffer3D } from \"../../graphics/VertexBuffer3D\";\r\n\r\n\r\nexport class NativeVertexBuffer3D extends VertexBuffer3D {\r\n\r\n\r\n    _conchVertexBuffer3D:any = null;\r\n\r\n    /**\r\n     * \r\n     */\r\n    get vertexDeclaration(): VertexDeclaration | null {\r\n        return this._vertexDeclaration;\r\n    }\r\n\r\n    set vertexDeclaration(value: VertexDeclaration | null) {\r\n        this._vertexDeclaration = value;\r\n        this._conchVertexBuffer3D.setVertexDeclaration( this.serilizeVertexDeclaration(value) );\r\n    }\r\n\r\n    serilizeVertexDeclaration(value: VertexDeclaration): Int32Array {\r\n        let array = new Int32Array(value._vertexElements.length * 6);\r\n        let offset = 0;\r\n        var valueData: any = value._shaderValues;\r\n        for (var k in valueData) {\r\n            var loc: number = parseInt(k);\r\n            var attribute: Int32Array = valueData[k];\r\n            array[offset++] = loc;\r\n            array.set(attribute, offset);\r\n            offset += 5;\r\n        }\r\n        return array;\r\n    }\r\n\r\n    get instanceBuffer(): boolean {\r\n\t\treturn this._conchVertexBuffer3D._instanceBuffer;\r\n\t}\r\n\r\n\tset instanceBuffer(value: boolean) {\r\n\t\tthis._conchVertexBuffer3D._instanceBuffer = value;\r\n\t}\r\n    /**\r\n     *  <code>VertexBuffer3D</code> \r\n     * @param\tbyteLength \r\n     * @param\tbufferUsage VertexBuffer3D\r\n     * @param\tcanRead \r\n     */\r\n    constructor(byteLength: number, bufferUsage: BufferUsage, canRead: boolean = false) {\r\n        super(byteLength, bufferUsage, canRead);\r\n        this._conchVertexBuffer3D = new (window as any).conchVertexBuffer3D( (LayaGL.renderEngine as any)._nativeObj,byteLength,bufferUsage,false);\r\n        this._conchVertexBuffer3D.setGLBuffer(this._glBuffer);\r\n    }\r\n}","import { IBaseRenderNode } from \"../../../RenderEngine/RenderInterface/RenderPipelineInterface/IBaseRenderNode\";\r\nimport { BaseRender } from \"../../core/render/BaseRender\";\r\nimport { Transform3D } from \"../../core/Transform3D\";\r\nimport { Bounds } from \"../../math/Bounds\";\r\n\r\n\r\nexport class BaseRenderNode implements IBaseRenderNode {\r\n   \r\n    /**@interanl */\r\n    boundsChange: boolean;\r\n    /**@internal ID */\r\n    renderId: number;\r\n    /**@internal Shadow Mode */\r\n    receiveShadow: boolean;\r\n    /**@internal shadow mode */\r\n    castShadow: boolean;\r\n    /**@internal  */\r\n    bounds: Bounds;\r\n    /**@internal  */\r\n    sortingFudge: number;\r\n    /**@internal  */\r\n    distanceForSort: number;\r\n    /**@internal transform3D */\r\n    transform: Transform3D;\r\n    /**@internal baseRender */\r\n    owner: BaseRender | null;\r\n    /**@internal TODO Base Bounds/can update Bounds by transform*GeometryBounds*/\r\n    geometryBounds: Bounds | null;\r\n    /**@internal layer */\r\n    layer:number;\r\n    /**@internal */\r\n    renderbitFlag:number;\r\n    /**@internal */\r\n    staticMask: number;\r\n}","import { IRenderContext3D } from \"../../../RenderEngine/RenderInterface/RenderPipelineInterface/IRenderContext3D\";\r\nimport { IRenderQueue } from \"../../../RenderEngine/RenderInterface/RenderPipelineInterface/IRenderQueue\";\r\nimport { ISortPass } from \"../../../RenderEngine/RenderInterface/RenderPipelineInterface/ISortPass\";\r\nimport { FastSinglelist, SingletonList } from \"../../../utils/SingletonList\";\r\nimport { BufferState } from \"../../../webgl/utils/BufferState\";\r\nimport { Camera } from \"../../core/Camera\";\r\nimport { RenderContext3D } from \"../../core/render/RenderContext3D\";\r\nimport { RenderElement } from \"../../core/render/RenderElement\";\r\nimport { RenderElementBatch } from \"../../graphics/Batch/RenderElementBatch\";\r\n\r\nexport class BaseRenderQueue implements IRenderQueue {\r\n    /** @interanl */\r\n    _isTransparent: boolean = false;\r\n    /** @internal */\r\n    elements: FastSinglelist<RenderElement> = new FastSinglelist<RenderElement>();\r\n    /**sort function*/\r\n    _sortPass: ISortPass;\r\n    /** context*/\r\n    _context: IRenderContext3D;\r\n\r\n    _batch: RenderElementBatch;\r\n\r\n    set sortPass(value: ISortPass) {\r\n        this._sortPass = value;\r\n    }\r\n    constructor(isTransparent: boolean) {\r\n        this._isTransparent = isTransparent;\r\n        this._batch = RenderElementBatch.instance ? RenderElementBatch.instance : new RenderElementBatch();\r\n    }\r\n\r\n\r\n    set context(value: RenderContext3D) {\r\n        this._context = value._contextOBJ;\r\n    }\r\n\r\n    addRenderElement(renderelement: RenderElement) {\r\n        this.elements.add(renderelement);\r\n    }\r\n\r\n    clear(): void {\r\n        this.elements.length = 0;\r\n    }\r\n\r\n    renderQueue(context: RenderContext3D): number {\r\n        this.context = context;\r\n        this._context.applyContext(Camera._updateMark);\r\n\r\n        var elements: RenderElement[] = this.elements.elements;\r\n\r\n        this._batchQueue();//\r\n        for (var i: number = 0, n = this.elements.length; i < n; i++) {\r\n            elements[i]._renderUpdatePre(context);//Update Data\r\n        }\r\n        //buffer nativeTODO\r\n\r\n        this._sort();\r\n        for (var i: number = 0, n: number = this.elements.length; i < n; i++)\r\n            elements[i]._render(this._context);//Update Data\r\n        BufferState._curBindedBufferState && BufferState._curBindedBufferState.unBind();\r\n        this._batch.recoverData();\r\n        this._context.end()\r\n        return n;\r\n    }\r\n\r\n    private _batchQueue() {\r\n        this._isTransparent || this._batch.batch(this.elements);\r\n    }\r\n\r\n    private _sort() {\r\n        var count: number = this.elements.length;\r\n        this._sortPass.sort(this.elements, this._isTransparent, 0, count - 1);\r\n    }\r\n\r\n    destroy(): void {\r\n        this.elements.destroy();\r\n    }\r\n}","import { Vector3 } from \"../../../maths/Vector3\";\r\nimport { ICameraCullInfo } from \"../../../RenderEngine/RenderInterface/RenderPipelineInterface/ICameraCullInfo\";\r\nimport { BoundFrustum } from \"../../math/BoundFrustum\";\r\n\r\n\r\n/**\r\n * camera\r\n */\r\nexport class CameraCullInfo implements ICameraCullInfo {\r\n\t/** */\r\n\tposition: Vector3;\r\n\t/** */\r\n\tuseOcclusionCulling: Boolean;\r\n\t/** */\r\n\tboundFrustum: BoundFrustum;\r\n\t/** */\r\n\tcullingMask: number;\r\n\t/** */\r\n\tstaticMask: number;\r\n}","import { IBaseRenderNode } from \"../../../RenderEngine/RenderInterface/RenderPipelineInterface/IBaseRenderNode\";\r\nimport { IRenderContext3D } from \"../../../RenderEngine/RenderInterface/RenderPipelineInterface/IRenderContext3D\";\r\nimport { IRenderElement } from \"../../../RenderEngine/RenderInterface/RenderPipelineInterface/IRenderElement\";\r\nimport { IRenderGeometryElement } from \"../../../RenderEngine/RenderInterface/RenderPipelineInterface/IRenderGeometryElement\";\r\nimport { ShaderData } from \"../../../RenderEngine/RenderShader/ShaderData\";\r\nimport { ShaderInstance } from \"../../../RenderEngine/RenderShader/ShaderInstance\";\r\nimport { LayaGL } from \"../../../layagl/LayaGL\";\r\nimport { SingletonList } from \"../../../utils/SingletonList\";\r\nimport { Transform3D } from \"../../core/Transform3D\";\r\n\r\n\r\nexport class RenderElementOBJ implements IRenderElement {\r\n\r\n    _geometry: IRenderGeometryElement;\r\n\r\n    _shaderInstances: SingletonList<ShaderInstance>;\r\n\r\n    _materialShaderData: ShaderData;\r\n\r\n    _renderShaderData: ShaderData;\r\n\r\n    _transform: Transform3D;\r\n\r\n    _isRender: boolean;\r\n\r\n    _owner: IBaseRenderNode;\r\n\r\n    _invertFront: boolean;\r\n\r\n    constructor() {\r\n        this._shaderInstances = new SingletonList();\r\n    }\r\n\r\n    _addShaderInstance(shader: ShaderInstance) {\r\n        this._shaderInstances.add(shader);\r\n    }\r\n\r\n    _clearShaderInstance() {\r\n        this._shaderInstances.length = 0;\r\n    }\r\n\r\n    /**\r\n     * render RenderElement\r\n     * @param renderqueue \r\n     */\r\n    _render(context: IRenderContext3D): void {\r\n        var forceInvertFace: boolean = context.invertY;\r\n        var updateMark: number = context.cameraUpdateMark;\r\n        var sceneID = context.sceneID;\r\n        var sceneShaderData: ShaderData = context.sceneShaderData;\r\n        var cameraShaderData: ShaderData = context.cameraShaderData;\r\n        if (this._isRender) {\r\n            var passes: ShaderInstance[] = this._shaderInstances.elements;\r\n            for (var j: number = 0, m: number = this._shaderInstances.length; j < m; j++) {\r\n                const shaderIns: ShaderInstance = passes[j];\r\n                if(!shaderIns.complete)\r\n                    continue;\r\n                var switchShader: boolean = shaderIns.bind();\r\n                var switchUpdateMark: boolean = (updateMark !== shaderIns._uploadMark);\r\n                var uploadScene: boolean = (shaderIns._uploadScene !== sceneID) || switchUpdateMark;\r\n                //Scene\r\n                if (uploadScene || switchShader) {\r\n                    sceneShaderData && shaderIns.uploadUniforms(shaderIns._sceneUniformParamsMap, sceneShaderData, uploadScene);\r\n                    shaderIns._uploadScene = sceneID;\r\n                }\r\n                //render\r\n                if (this._renderShaderData) {\r\n                    var uploadSprite3D: boolean = (shaderIns._uploadRender !== this._renderShaderData) || switchUpdateMark;\r\n                    if (uploadSprite3D || switchShader) {\r\n                        shaderIns.uploadUniforms(shaderIns._spriteUniformParamsMap, this._renderShaderData, uploadSprite3D);\r\n                        shaderIns._uploadRender = this._renderShaderData;\r\n                    }\r\n                }\r\n                //camera\r\n                var uploadCamera: boolean = shaderIns._uploadCameraShaderValue !== cameraShaderData || switchUpdateMark;\r\n                if (uploadCamera || switchShader) {\r\n                    cameraShaderData && shaderIns.uploadUniforms(shaderIns._cameraUniformParamsMap, cameraShaderData, uploadCamera);\r\n                    shaderIns._uploadCameraShaderValue = cameraShaderData;\r\n                }\r\n                //material\r\n                var uploadMaterial: boolean = (shaderIns._uploadMaterial !== this._materialShaderData) || switchUpdateMark;\r\n                if (uploadMaterial || switchShader) {\r\n                    shaderIns.uploadUniforms(shaderIns._materialUniformParamsMap, this._materialShaderData, uploadMaterial);\r\n                    shaderIns._uploadMaterial = this._materialShaderData;\r\n                    //GlobalData\r\n                    context.globalShaderData && shaderIns.uploadUniforms(shaderIns._materialUniformParamsMap, context.globalShaderData, uploadMaterial);\r\n                }\r\n                //renderData update\r\n                //TODORenderstate as a Object to less upload\r\n                shaderIns.uploadRenderStateBlendDepth(this._materialShaderData);\r\n                shaderIns.uploadRenderStateFrontFace(this._materialShaderData, forceInvertFace, this._invertFront);\r\n                this.drawGeometry(shaderIns);\r\n            }\r\n        }\r\n    }\r\n\r\n    drawGeometry(shaderIns: ShaderInstance) {\r\n        LayaGL.renderDrawContext.drawGeometryElement(this._geometry);\r\n    }\r\n\r\n    _destroy() {\r\n        this._geometry = null;\r\n        this._shaderInstances = null;\r\n        this._materialShaderData = null;\r\n        this._renderShaderData = null;\r\n        this._transform = null;\r\n        this._isRender = null;\r\n    }\r\n}","import { ShaderInstance } from \"../../../RenderEngine/RenderShader/ShaderInstance\";\r\nimport { LayaGL } from \"../../../layagl/LayaGL\";\r\nimport { VertexBuffer3D } from \"../../graphics/VertexBuffer3D\";\r\nimport { RenderElementOBJ } from \"./RenderElementOBJ\";\r\n\r\nexport class InstanceRenderElementOBJ extends RenderElementOBJ {\r\n\r\n    /**@internal instance,*/\r\n    private _vertexBuffer3D: Array<VertexBuffer3D> = [];\r\n\r\n    private _updateData: Array<Float32Array> = [];\r\n\r\n    private _updateDataNum: Array<number> = [];\r\n\r\n    drawCount: number;\r\n\r\n    updateNums: number;\r\n\r\n    /**\r\n     * UpdateBuffer\r\n     * @param vb \r\n     * @param length instance\r\n     */\r\n    addUpdateBuffer(vb: VertexBuffer3D,length:number) {\r\n        this._vertexBuffer3D[this.updateNums] = vb;\r\n        this._updateDataNum[this.updateNums++] = length;\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @param index index of Buffer3D\r\n     * @param length length of array\r\n     */\r\n    getUpdateData(index: number,length:number): Float32Array {\r\n        let data = this._updateData[index];\r\n        if (!data || data.length < length) {\r\n            data = this._updateData[index] = new Float32Array(length);\r\n        }\r\n        return data;\r\n    }\r\n\r\n    constructor() {\r\n        super();\r\n    }\r\n\r\n    /**\r\n     * draw geometry\r\n     * @param shaderIns \r\n     */\r\n    drawGeometry(shaderIns: ShaderInstance) {\r\n        //instance,\r\n        let data: Float32Array;\r\n        let buffer: VertexBuffer3D;\r\n        for (let i = 0; i < this.updateNums; i++) {\r\n            buffer = this._vertexBuffer3D[i];\r\n            if (!buffer) break;\r\n            data = this._updateData[i];\r\n            buffer.orphanStorage();\r\n            buffer.setData(data.buffer, 0, 0, this.drawCount * this._updateDataNum[i] * 4);\r\n        }\r\n        LayaGL.renderDrawContext.drawGeometryElement(this._geometry);\r\n    }\r\n\r\n    clear() {\r\n        this.updateNums = 0;\r\n    }\r\n}","import { ISortPass } from \"../../../RenderEngine/RenderInterface/RenderPipelineInterface/ISortPass\";\r\nimport { SingletonList } from \"../../../utils/SingletonList\";\r\nimport { RenderElement } from \"../../core/render/RenderElement\";\r\n\r\n\r\n\r\nexport class QuickSort implements ISortPass {\r\n\tprivate elementArray: SingletonList<RenderElement>;\r\n\tprivate isTransparent: boolean;\r\n\r\n\t/**\r\n\t * \r\n\t * @param elements \r\n\t * @param isTransparent \r\n\t * @param left \r\n\t * @param right \r\n\t */\r\n\tsort(elements: SingletonList<RenderElement>, isTransparent: boolean, left: number, right: number): void {\r\n\t\tthis.elementArray = elements;\r\n\t\tthis.isTransparent = isTransparent;\r\n\t\tthis._quickSort(left, right);\r\n\t}\r\n\r\n\t/**\r\n\t * @internal\r\n\t */\r\n\t_quickSort(left: number, right: number): void {\r\n\t\tif (this.elementArray.length > 1) {\r\n\t\t\tvar index: number = this._partitionRenderObject(left, right);\r\n\t\t\tvar leftIndex: number = index - 1;\r\n\t\t\tif (left < leftIndex)\r\n\t\t\t\tthis._quickSort(left, leftIndex);\r\n\r\n\t\t\tif (index < right)\r\n\t\t\t\tthis._quickSort(index, right);\r\n\t\t}\r\n\t}\r\n\r\n\r\n\t/**\r\n\t * @internal\r\n\t */\r\n\tprivate _partitionRenderObject(left: number, right: number): number {\r\n\t\tvar elements: RenderElement[] = this.elementArray.elements;\r\n\t\tvar pivot: RenderElement = elements[Math.floor((right + left) / 2)];\r\n\t\twhile (left <= right) {\r\n\t\t\twhile (this._compare(elements[left], pivot) < 0)\r\n\t\t\t\tleft++;\r\n\t\t\twhile (this._compare(elements[right], pivot) > 0)\r\n\t\t\t\tright--;\r\n\t\t\tif (left < right) {\r\n\t\t\t\tvar temp: RenderElement = elements[left];\r\n\t\t\t\telements[left] = elements[right];\r\n\t\t\t\telements[right] = temp;\r\n\t\t\t\tleft++;\r\n\t\t\t\tright--;\r\n\t\t\t} else if (left === right) {\r\n\t\t\t\tleft++;\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn left;\r\n\t}\r\n\r\n\t/**\r\n\t * @internal\r\n\t */\r\n\tprivate _compare(left: RenderElement, right: RenderElement): number {\r\n\t\tvar renderQueue: number = left._material.renderQueue - right._material.renderQueue;\r\n\t\tif (renderQueue === 0) {\r\n\t\t\tvar sort: number = this.isTransparent ? right._baseRender._distanceForSort - left._baseRender._distanceForSort : left._baseRender._distanceForSort - right._baseRender._distanceForSort;\r\n\t\t\treturn sort + right._baseRender.sortingFudge - left._baseRender.sortingFudge;\r\n\t\t} else {\r\n\t\t\treturn renderQueue;\r\n\t\t}\r\n\t}\r\n\r\n}","\r\nimport { LayaGL } from \"../../../layagl/LayaGL\";\r\nimport { Vector4 } from \"../../../maths/Vector4\";\r\nimport { IRenderTarget } from \"../../../RenderEngine/RenderInterface/IRenderTarget\";\r\nimport { IRenderContext3D, PipelineMode } from \"../../../RenderEngine/RenderInterface/RenderPipelineInterface/IRenderContext3D\";\r\nimport { ShaderData } from \"../../../RenderEngine/RenderShader/ShaderData\";\r\nimport { Viewport } from \"../../math/Viewport\";\r\nimport { RenderElementOBJ } from \"./RenderElementOBJ\";\r\n\r\nexport class RenderContext3DOBJ implements IRenderContext3D {\r\n\r\n    //dest Texture\r\n    destTarget: IRenderTarget;\r\n    //viewPort\r\n    viewPort: Viewport;\r\n    //scissor\r\n    scissor: Vector4;\r\n    //is invert Y\r\n    invertY: boolean = false;\r\n    //pipeLineMode\r\n    pipelineMode: PipelineMode;\r\n    // config shader data\r\n    configShaderData: ShaderData;\r\n    //Camera Shader Data\r\n    cameraShaderData: ShaderData;\r\n    //Scene cache\r\n    sceneID: number;\r\n    //scene Shader Data\r\n    sceneShaderData: ShaderData;\r\n    //Camera Update Mark\r\n    cameraUpdateMark: number;\r\n    //Global ShaderData\r\n    globalShaderData: ShaderData;\r\n\r\n    constructor() {\r\n        this.viewPort = new Viewport(0, 0, 0, 0);\r\n        this.scissor = new Vector4();\r\n        this.pipelineMode = \"Forward\";\r\n        this.configShaderData = new ShaderData();\r\n    }\r\n    end(): void {\r\n        //TODO\r\n    }\r\n\r\n    /**IRenderContext */\r\n    applyContext(cameraUpdateMark: number): void {\r\n        this.destTarget && this.destTarget._start();\r\n        this.cameraUpdateMark = cameraUpdateMark;\r\n        LayaGL.renderEngine.viewport(this.viewPort.x, this.viewPort.y, this.viewPort.width, this.viewPort.height);\r\n        LayaGL.renderEngine.scissor(this.scissor.x, this.scissor.y, this.scissor.z, this.scissor.w);\r\n    }\r\n\r\n    drawRenderElement(renderelemt: RenderElementOBJ): void {\r\n        renderelemt._render(this);\r\n    }\r\n}","import { GLRenderDrawContext } from \"../../../RenderEngine/RenderEngine/WebGLEngine/GLRenderDrawContext\";\r\nimport { DrawType } from \"../../../RenderEngine/RenderEnum/DrawType\";\r\nimport { IndexFormat } from \"../../../RenderEngine/RenderEnum/IndexFormat\";\r\nimport { MeshTopology } from \"../../../RenderEngine/RenderEnum/RenderPologyMode\";\r\nimport { IRenderGeometryElement } from \"../../../RenderEngine/RenderInterface/RenderPipelineInterface/IRenderGeometryElement\";\r\nimport { LayaGL } from \"../../../layagl/LayaGL\";\r\nimport { FastSinglelist } from \"../../../utils/SingletonList\";\r\nimport { BufferState } from \"../../../webgl/utils/BufferState\";\r\n\r\n\r\nexport class RenderGeometryElementOBJ implements IRenderGeometryElement {\r\n  /**@internal */\r\n  bufferState: BufferState;\r\n\r\n  /**@internal */\r\n  private _mode: MeshTopology;\r\n\r\n  /**@internal */\r\n  _glmode: number;\r\n\r\n  /**@internal */\r\n  drawType: DrawType;\r\n\r\n  /**@internal */\r\n  drawParams: FastSinglelist<number>;\r\n\r\n  /**@internal */\r\n  instanceCount: number;\r\n\r\n  /**@internal */\r\n  _glindexFormat: number;\r\n\r\n  /**@internal */\r\n  private _indexFormat: IndexFormat;\r\n\r\n  /**\r\n   * index format\r\n   */\r\n  public get indexFormat(): IndexFormat {\r\n    return this._indexFormat;\r\n  }\r\n\r\n  public set indexFormat(value: IndexFormat) {\r\n    this._indexFormat = value;\r\n    this._glindexFormat = (LayaGL.renderDrawContext as GLRenderDrawContext).getIndexType(this._indexFormat);\r\n  }\r\n\r\n  /**\r\n   * Mesh Topology mode \r\n   */\r\n  get mode(): MeshTopology {\r\n    return this._mode;\r\n  }\r\n\r\n  set mode(value: MeshTopology) {\r\n    this._mode = value;\r\n    this._glmode = (LayaGL.renderDrawContext as GLRenderDrawContext).getMeshTopology(this._mode);\r\n  }\r\n\r\n  /**@internal */\r\n  constructor(mode: MeshTopology, drawType: DrawType) {\r\n    this.mode = mode;\r\n    this.drawParams = new FastSinglelist();\r\n    this.drawType = drawType;\r\n  }\r\n\r\n  /**@internal */\r\n  setDrawArrayParams(first: number, count: number): void {\r\n    this.drawParams.add(first);\r\n    this.drawParams.add(count);\r\n  }\r\n\r\n  /**@internal */\r\n  setDrawElemenParams(count: number, offset: number): void {\r\n    this.drawParams.add(offset);\r\n    this.drawParams.add(count);\r\n\r\n  }\r\n\r\n  /**@internal */\r\n  destroy(): void {\r\n    delete this.drawParams;\r\n  }\r\n  /**@internal */\r\n  clearRenderParams() {\r\n    this.drawParams.length = 0;\r\n  }\r\n}","import { ISceneRenderManager } from \"../../../RenderEngine/RenderInterface/RenderPipelineInterface/ISceneRenderManager\";\r\nimport { SingletonList } from \"../../../utils/SingletonList\";\r\nimport { BaseRender } from \"../../core/render/BaseRender\";\r\n\r\n\r\nexport class SceneRenderManagerOBJ implements ISceneRenderManager {\r\n    /** @internal */\r\n    _renders: SingletonList<BaseRender> = new SingletonList();\r\n    _motionRenders: SingletonList<BaseRender> = new SingletonList();\r\n    constructor() {\r\n\r\n    }\r\n\r\n    get list() {\r\n        return this._renders;\r\n    }\r\n\r\n    set list(value) {\r\n        this._renders = value;\r\n    }\r\n\r\n    addRenderObject(object: BaseRender): void {\r\n        this._renders.add(object);\r\n    }\r\n    removeRenderObject(object: BaseRender): void {\r\n        this._renders.remove(object);\r\n        this.removeMotionObject(object);\r\n    }\r\n\r\n    removeMotionObject(object: BaseRender): void {\r\n        let index = object._motionIndexList;\r\n        if (index != -1) {//remove\r\n            let elements = this._motionRenders.elements;\r\n            this._motionRenders.length -= 1;\r\n            elements[length]._motionIndexList = index;\r\n            elements[index] = elements[length];\r\n        }\r\n\r\n        //TODO\r\n    }\r\n    updateMotionObjects(): void {\r\n        for (let i = 0; i < this._motionRenders.length; i++) {\r\n            this._motionRenders.elements[i].bounds;\r\n            this._motionRenders.elements[i]._motionIndexList = -1;\r\n        }\r\n        this._motionRenders.length = 0;\r\n\r\n        //TODO\r\n    }\r\n    addMotionObject(object: BaseRender): void {\r\n        if (object._motionIndexList == -1) {\r\n            object._motionIndexList = this._motionRenders.length;\r\n            this._motionRenders.add(object);\r\n        }\r\n\r\n        //TODO\r\n    }\r\n    destroy(): void {\r\n        this._renders.destroy();\r\n    }\r\n\r\n}","import { Vector3 } from \"../../../maths/Vector3\";\r\nimport { IShadowCullInfo } from \"../../../RenderEngine/RenderInterface/RenderPipelineInterface/IShadowCullInfo\";\r\nimport { BoundSphere } from \"../../math/BoundSphere\";\r\nimport { Plane } from \"../../math/Plane\";\r\n\r\nexport class ShadowCullInfo implements IShadowCullInfo {\r\n    position: Vector3;\r\n    cullPlanes: Plane[];\r\n    cullSphere: BoundSphere;\r\n    cullPlaneCount: number;\r\n    direction: Vector3;\r\n}","\r\nimport { ShaderInstance } from \"../../../RenderEngine/RenderShader/ShaderInstance\";\r\nimport { LayaGL } from \"../../../layagl/LayaGL\";\r\nimport { SkinnedMeshSprite3D } from \"../../core/SkinnedMeshSprite3D\";\r\nimport { RenderElementOBJ } from \"./RenderElementOBJ\";\r\nimport { RenderGeometryElementOBJ } from \"./RenderGeometryElementOBJ\";\r\n\r\nexport class SkinRenderElementOBJ extends RenderElementOBJ {\r\n\r\n    skinnedData: Float32Array[];\r\n\r\n    constructor() {\r\n        super();\r\n    }\r\n\r\n    /**  */\r\n    drawGeometry(shaderIns: ShaderInstance) {\r\n\r\n        let element = this._geometry.drawParams.elements;\r\n        if (!this.skinnedData)\r\n            return;\r\n        this._geometry.bufferState.bind();\r\n        for (var j = 0, m = this._geometry.drawParams.length / 2; j < m; j++) {\r\n            var subSkinnedDatas: Float32Array = this.skinnedData[j];\r\n            shaderIns.uploadCustomUniform(SkinnedMeshSprite3D.BONES, subSkinnedDatas);\r\n            var offset = j * 2;\r\n            LayaGL.renderDrawContext.drawElements((this._geometry as RenderGeometryElementOBJ)._glmode, element[offset + 1], (this._geometry as RenderGeometryElementOBJ)._glindexFormat, element[offset]);\r\n        }\r\n    }\r\n}","import { Matrix4x4 } from \"../../maths/Matrix4x4\";\r\nimport { Vector3 } from \"../../maths/Vector3\";\r\nimport { IClone } from \"../../utils/IClone\";\r\nimport { BoundBox } from \"./BoundBox\";\r\n\r\n/**\r\n * <code>BoundsImp</code> \r\n */\r\nexport class BoundsImpl implements IClone {\r\n    /**@internal */\r\n    static _UPDATE_MIN: number = 0x01;\r\n    /**@internal */\r\n    static _UPDATE_MAX: number = 0x02;\r\n    /**@internal */\r\n    static _UPDATE_CENTER: number = 0x04;\r\n    /**@internal */\r\n    static _UPDATE_EXTENT: number = 0x08;\r\n\r\n    protected _updateFlag: number = 0;\r\n\r\n    /**@internal\t*/\r\n    _center: Vector3 = new Vector3();\r\n    /**@internal\t*/\r\n    _extent: Vector3 = new Vector3();\r\n    /***/\r\n    _boundBox: BoundBox = new BoundBox(new Vector3(), new Vector3());\r\n\r\n    get min() {\r\n        return this.getMin();\r\n    }\r\n\r\n    set min(value: Vector3) {\r\n        this.setMin(value);\r\n    }\r\n\r\n    get max() {\r\n        return this.getMax();\r\n    }\r\n\r\n    set max(value: Vector3) {\r\n        this.setMax(value);\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @param value\t\r\n     */\r\n    setMin(value: Vector3): void {\r\n        var min: Vector3 = this._boundBox.min;\r\n        if (value !== min)\r\n            value.cloneTo(min);\r\n        this._setUpdateFlag(BoundsImpl._UPDATE_CENTER | BoundsImpl._UPDATE_EXTENT, true);\r\n        this._setUpdateFlag(BoundsImpl._UPDATE_MIN, false);\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @return\t\r\n     */\r\n    getMin(): Vector3 {\r\n        var min: Vector3 = this._boundBox.min;\r\n        if (this._getUpdateFlag(BoundsImpl._UPDATE_MIN)) {\r\n            this._getMin(this.getCenter(), this.getExtent(), min);\r\n            this._setUpdateFlag(BoundsImpl._UPDATE_MIN, false);\r\n        }\r\n        return min;\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @param value\t\r\n     */\r\n    setMax(value: Vector3): void {\r\n        var max: Vector3 = this._boundBox.max;\r\n        if (value !== max)\r\n            value.cloneTo(max);\r\n        this._setUpdateFlag(BoundsImpl._UPDATE_CENTER | BoundsImpl._UPDATE_EXTENT, true);\r\n        this._setUpdateFlag(BoundsImpl._UPDATE_MAX, false);\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @return\t\r\n     */\r\n    getMax(): Vector3 {\r\n        var max: Vector3 = this._boundBox.max;\r\n        if (this._getUpdateFlag(BoundsImpl._UPDATE_MAX)) {\r\n            this._getMax(this.getCenter(), this.getExtent(), max);\r\n            this._setUpdateFlag(BoundsImpl._UPDATE_MAX, false);\r\n        }\r\n        return max;\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @param value\t\r\n     */\r\n    setCenter(value: Vector3): void {\r\n        if (value !== this._center)\r\n            value.cloneTo(this._center);\r\n        this._setUpdateFlag(BoundsImpl._UPDATE_MIN | BoundsImpl._UPDATE_MAX, true);\r\n        this._setUpdateFlag(BoundsImpl._UPDATE_CENTER, false);\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @return\t\r\n     */\r\n    getCenter(): Vector3 {\r\n        if (this._getUpdateFlag(BoundsImpl._UPDATE_CENTER)) {\r\n            this._getCenter(this.getMin(), this.getMax(), this._center);\r\n            this._setUpdateFlag(BoundsImpl._UPDATE_CENTER, false);\r\n        }\r\n        return this._center;\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @param value\t\r\n     */\r\n    setExtent(value: Vector3): void {\r\n        if (value !== this._extent)\r\n            value.cloneTo(this._extent);\r\n        this._setUpdateFlag(BoundsImpl._UPDATE_MIN | BoundsImpl._UPDATE_MAX, true);\r\n        this._setUpdateFlag(BoundsImpl._UPDATE_EXTENT, false);\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @return\t\r\n     */\r\n    getExtent(): Vector3 {\r\n        if (this._getUpdateFlag(BoundsImpl._UPDATE_EXTENT)) {\r\n            this._getExtent(this.getMin(), this.getMax(), this._extent);\r\n            this._setUpdateFlag(BoundsImpl._UPDATE_EXTENT, false);\r\n        }\r\n        return this._extent;\r\n    }\r\n\r\n    /**\r\n     *  <code>BoundsImp</code> \r\n     * @param\tmin  min \r\n     * @param\tmax  max \r\n     */\r\n    constructor(min?: Vector3, max?: Vector3) {\r\n        min && min.cloneTo(this._boundBox.min);\r\n        max && max.cloneTo(this._boundBox.max);\r\n        this._setUpdateFlag(BoundsImpl._UPDATE_CENTER | BoundsImpl._UPDATE_EXTENT, true);\r\n    }\r\n\r\n    protected _getUpdateFlag(type: number): boolean {\r\n        return (this._updateFlag & type) != 0;\r\n    }\r\n\r\n\r\n    protected _setUpdateFlag(type: number, value: boolean): void {\r\n        if (value)\r\n            this._updateFlag |= type;\r\n        else\r\n            this._updateFlag &= ~type;\r\n    }\r\n\r\n\r\n    protected _getCenter(min: Vector3, max: Vector3, out: Vector3): void {\r\n        Vector3.add(min, max, out);\r\n        Vector3.scale(out, 0.5, out);\r\n    }\r\n\r\n\r\n    protected _getExtent(min: Vector3, max: Vector3, out: Vector3): void {\r\n        Vector3.subtract(max, min, out);\r\n        Vector3.scale(out, 0.5, out);\r\n    }\r\n\r\n\r\n    protected _getMin(center: Vector3, extent: Vector3, out: Vector3): void {\r\n        Vector3.subtract(center, extent, out);\r\n    }\r\n\r\n\r\n    protected _getMax(center: Vector3, extent: Vector3, out: Vector3): void {\r\n        Vector3.add(center, extent, out);\r\n    }\r\n\r\n    protected _rotateExtents(extents: Vector3, rotation: Matrix4x4, out: Vector3): void {\r\n        var extentsX: number = extents.x;\r\n        var extentsY: number = extents.y;\r\n        var extentsZ: number = extents.z;\r\n        var matE: Float32Array = rotation.elements;\r\n        out.x = Math.abs(matE[0] * extentsX) + Math.abs(matE[4] * extentsY) + Math.abs(matE[8] * extentsZ);\r\n        out.y = Math.abs(matE[1] * extentsX) + Math.abs(matE[5] * extentsY) + Math.abs(matE[9] * extentsZ);\r\n        out.z = Math.abs(matE[2] * extentsX) + Math.abs(matE[6] * extentsY) + Math.abs(matE[10] * extentsZ);\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    _tranform(matrix: Matrix4x4, out: BoundsImpl): void {\r\n        var outCen: Vector3 = out._center;\r\n        var outExt: Vector3 = out._extent;\r\n\r\n        Vector3.transformCoordinate(this.getCenter(), matrix, outCen);\r\n        this._rotateExtents(this.getExtent(), matrix, outExt);\r\n\r\n        out._boundBox.setCenterAndExtent(outCen, outExt);\r\n        out._updateFlag = 0;\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    _getBoundBox(): BoundBox {\r\n        if (this._updateFlag & BoundsImpl._UPDATE_MIN) {\r\n            var min: Vector3 = this._boundBox.min;\r\n            this._getMin(this.getCenter(), this.getExtent(), min);\r\n            this._setUpdateFlag(BoundsImpl._UPDATE_MIN, false);\r\n        }\r\n        if (this._updateFlag & BoundsImpl._UPDATE_MAX) {\r\n            var max: Vector3 = this._boundBox.max;\r\n            this._getMax(this.getCenter(), this.getExtent(), max);\r\n            this._setUpdateFlag(BoundsImpl._UPDATE_MAX, false);\r\n        }\r\n        return this._boundBox;\r\n    }\r\n\r\n    /**\r\n     * @returns -1 0\r\n     */\r\n    calculateBoundsintersection(bounds: BoundsImpl): number {\r\n        var ownMax: Vector3 = this.getMax();\r\n        var ownMin: Vector3 = this.getMin();\r\n        var calMax: Vector3 = bounds.getMax();\r\n        var calMin: Vector3 = bounds.getMin();\r\n        var tempV0: Vector3 = TEMP_VECTOR3_MAX0;\r\n        var tempV1: Vector3 = TEMP_VECTOR3_MAX1;\r\n        var thisExtends: Vector3 = this.getExtent();\r\n        var boundExtends: Vector3 = bounds.getExtent();\r\n        tempV0.setValue(Math.max(ownMax.x, calMax.x) - Math.min(ownMin.x, calMin.x),\r\n            Math.max(ownMax.y, calMax.y) - Math.min(ownMin.y, calMin.y),\r\n            Math.max(ownMax.z, calMax.z) - Math.min(ownMin.z, calMin.z));\r\n        tempV1.setValue((thisExtends.x + boundExtends.x) * 2.0,\r\n            (thisExtends.y + boundExtends.y) * 2.0,\r\n            (thisExtends.z + boundExtends.z) * 2.0);\r\n        if ((tempV0.x) > (tempV1.x)) return -1;\r\n        if ((tempV0.y) > (tempV1.y)) return -1;\r\n        if ((tempV0.z) > (tempV1.z)) return -1;\r\n        return (tempV1.x - tempV0.x) * (tempV1.y - tempV0.y) * (tempV1.z - tempV0.z);\r\n    }\r\n\r\n\r\n    /**\r\n     * \r\n     * @param\tdestObject \r\n     */\r\n    cloneTo(destObject: any): void {\r\n        var destBounds: BoundsImpl = (<BoundsImpl>destObject);\r\n        this.getMin().cloneTo(destBounds._boundBox.min);\r\n        this.getMax().cloneTo(destBounds._boundBox.max);\r\n        this.getCenter().cloneTo(destBounds._center);\r\n        this.getExtent().cloneTo(destBounds._extent);\r\n        destBounds._updateFlag = 0;\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @return\t \r\n     */\r\n    clone(): any {\r\n        var dest: BoundsImpl = new BoundsImpl(new Vector3(), new Vector3());\r\n        this.cloneTo(dest);\r\n        return dest;\r\n    }\r\n}\r\n\r\nconst TEMP_VECTOR3_MAX0 = new Vector3();\r\nconst TEMP_VECTOR3_MAX1 = new Vector3();","import { BufferUsage } from \"../../../RenderEngine/RenderEnum/BufferTargetType\";\r\nimport { DrawType } from \"../../../RenderEngine/RenderEnum/DrawType\";\r\nimport { IndexFormat } from \"../../../RenderEngine/RenderEnum/IndexFormat\";\r\nimport { MeshTopology } from \"../../../RenderEngine/RenderEnum/RenderPologyMode\";\r\nimport { IBaseRenderNode } from \"../../../RenderEngine/RenderInterface/RenderPipelineInterface/IBaseRenderNode\";\r\nimport { ICameraCullInfo } from \"../../../RenderEngine/RenderInterface/RenderPipelineInterface/ICameraCullInfo\";\r\nimport { ICullPass } from \"../../../RenderEngine/RenderInterface/RenderPipelineInterface/ICullPass\";\r\nimport { IRenderContext3D } from \"../../../RenderEngine/RenderInterface/RenderPipelineInterface/IRenderContext3D\";\r\nimport { IRenderElement } from \"../../../RenderEngine/RenderInterface/RenderPipelineInterface/IRenderElement\";\r\nimport { IRenderGeometryElement } from \"../../../RenderEngine/RenderInterface/RenderPipelineInterface/IRenderGeometryElement\";\r\nimport { IRenderQueue } from \"../../../RenderEngine/RenderInterface/RenderPipelineInterface/IRenderQueue\";\r\nimport { ISceneRenderManager } from \"../../../RenderEngine/RenderInterface/RenderPipelineInterface/ISceneRenderManager\";\r\nimport { IShadowCullInfo } from \"../../../RenderEngine/RenderInterface/RenderPipelineInterface/IShadowCullInfo\";\r\nimport { ISortPass } from \"../../../RenderEngine/RenderInterface/RenderPipelineInterface/ISortPass\";\r\nimport { Vector3 } from \"../../../maths/Vector3\";\r\nimport { Sprite3D } from \"../../core/Sprite3D\";\r\nimport { Transform3D } from \"../../core/Transform3D\";\r\nimport { IndexBuffer3D } from \"../../graphics/IndexBuffer3D\";\r\nimport { VertexBuffer3D } from \"../../graphics/VertexBuffer3D\";\r\nimport { BoundsImpl } from \"../../math/BoundsImpl\";\r\nimport { IRenderEngine3DOBJFactory } from \"../IRenderEngine3DOBJFactory\";\r\nimport { Laya3DRender } from \"../Laya3DRender\";\r\nimport { BaseRenderNode } from \"./BaseRenderNode\";\r\nimport { BaseRenderQueue } from \"./BaseRenderQueue\";\r\nimport { CameraCullInfo } from \"./CameraCullInfo\";\r\nimport { CullPassBase } from \"./CullPass\";\r\nimport { InstanceRenderElementOBJ } from \"./InstanceRenderElementOBJ\";\r\nimport { QuickSort } from \"./QuickSort\";\r\nimport { RenderContext3DOBJ } from \"./RenderContext3DOBJ\";\r\nimport { RenderElementOBJ } from \"./RenderElementOBJ\";\r\nimport { RenderGeometryElementOBJ } from \"./RenderGeometryElementOBJ\";\r\nimport { SceneRenderManagerOBJ } from \"./SceneRenderManagerOBJ\";\r\nimport { ShadowCullInfo } from \"./ShadowCullInfo\";\r\nimport { SkinRenderElementOBJ } from \"./SkinRenderElementOBJ\";\r\n\r\nexport class WebGLRenderEngine3DFactory implements IRenderEngine3DOBJFactory{\r\n    createTransform(owner: Sprite3D): Transform3D {\r\n        return new Transform3D(owner);\r\n    }\r\n\r\n    createBounds(min: Vector3, max: Vector3): any {\r\n        return new BoundsImpl(min, max);\r\n    }\r\n\r\n    createRenderElement(): IRenderElement {\r\n        return new RenderElementOBJ();\r\n    }\r\n\r\n    createSkinRenderElement(): IRenderElement {\r\n        return new SkinRenderElementOBJ();\r\n    }\r\n    createInstanceRenderElement() {\r\n        return new InstanceRenderElementOBJ();\r\n    }\r\n\r\n    createBaseRenderQueue(isTransparent: boolean): IRenderQueue {\r\n        var queue: BaseRenderQueue = new BaseRenderQueue(isTransparent);\r\n        queue.sortPass = this.createSortPass();\r\n        return queue;\r\n    }\r\n\r\n    createVertexBuffer3D(byteLength: number, bufferUsage: BufferUsage, canRead: boolean = false) {\r\n        return new VertexBuffer3D(byteLength, bufferUsage, canRead);\r\n    }\r\n\r\n    createIndexBuffer3D(indexType: IndexFormat, indexCount: number, bufferUsage: BufferUsage = BufferUsage.Static, canRead: boolean = false): IndexBuffer3D {\r\n        return new IndexBuffer3D(indexType, indexCount, bufferUsage, canRead);\r\n    }\r\n\r\n    createSceneRenderManager(): ISceneRenderManager {\r\n        return new SceneRenderManagerOBJ();\r\n    }\r\n\r\n    createCullPass(): ICullPass {\r\n        return new CullPassBase();\r\n    }\r\n\r\n    createSortPass(): ISortPass {\r\n        return new QuickSort();\r\n    }\r\n\r\n    createShadowCullInfo(): IShadowCullInfo {\r\n        return new ShadowCullInfo();\r\n    }\r\n\r\n    createCameraCullInfo(): ICameraCullInfo {\r\n        return new CameraCullInfo();\r\n    }\r\n\r\n    createRenderGeometry(mode: MeshTopology, drayType: DrawType): IRenderGeometryElement {\r\n        return new RenderGeometryElementOBJ(mode, drayType);\r\n    }\r\n\r\n    createBaseRenderNode(): IBaseRenderNode {\r\n        return new BaseRenderNode();\r\n    }\r\n\r\n    createRenderContext3D(): IRenderContext3D {\r\n        return new RenderContext3DOBJ();\r\n    }\r\n\r\n\r\n}\r\nLaya3DRender.renderOBJCreate =new WebGLRenderEngine3DFactory();","import { ICollider } from \"../../Physics3D/interface/ICollider\";\r\nimport { Vector3 } from \"../../maths/Vector3\";\r\n\r\n/**\r\n * <code>HitResult</code> \r\n */\r\nexport class HitResult {\r\n    /**  */\r\n    succeeded: boolean = false;\r\n    /** */\r\n    collider: ICollider = null;\r\n    /** */\r\n    point: Vector3 = new Vector3();\r\n    /** */\r\n    normal: Vector3 = new Vector3();\r\n    /**  */\r\n    hitFraction: number = 0;\r\n\r\n    /**@internal */\r\n    _inPool: boolean = false;\r\n\r\n    /**\r\n     *  <code>HitResult</code> \r\n     */\r\n    constructor() {\r\n\r\n    }\r\n}\r\n\r\n\r\n","import { IResourceLoader, ILoadTask, Loader } from \"../../net/Loader\";\r\nimport { LensFlareData, LensFlareElement } from \"../core/render/PostEffect/LensFlares/LensFlareEffect\";\r\nimport { URL } from \"../../net/URL\";\r\nimport { Color } from \"../../maths/Color\";\r\nimport { Vector2 } from \"../../maths/Vector2\";\r\n\r\nexport class LensFlareSettingsLoader implements IResourceLoader {\r\n    load(task: ILoadTask) {\r\n        return task.loader.fetch(task.url, \"json\", task.progress.createCallback(), task.options).then(data => {\r\n            if (!data)\r\n                return null;\r\n            let ret = new LensFlareData();\r\n            let basePath = URL.getPath(task.url);\r\n            let promises: Array<any> = [];\r\n\r\n            let elements = data.elements;\r\n            if (elements)\r\n                for (let i = elements.length - 1; i >= 0; i--) {\r\n                    let e = elements[i];\r\n                    if (e.texture && (e.texture as any)._$uuid && '' != (e.texture as any)._$uuid) {\r\n                        let url = URL.getResURLByUUID((e.texture as any)._$uuid);\r\n                        if (!url.startsWith(\"res://\"))\r\n                            url = URL.join(basePath, url);\r\n                        promises.push(task.loader.load(url).then((t) => {\r\n                            e.texture = t;\r\n                        }))\r\n                    }\r\n                    if (e.tint) {\r\n                        e.tint = new Color(e.tint.r, e.tint.g, e.tint.b, e.tint.a);\r\n                    }\r\n                    if (e.positionOffset) {\r\n                        e.positionOffset = new Vector2(e.positionOffset.x, e.positionOffset.y);\r\n                    }\r\n                    if (e.scale) {\r\n                        e.scale = new Vector2(e.scale.x, e.scale.y);\r\n                    }\r\n                }\r\n\r\n            return Promise.all(promises).then(() => {\r\n                ret.elements = elements;\r\n                return ret;\r\n            });\r\n        });\r\n    }\r\n}\r\n\r\nLoader.registerLoader([\"lensflare\"], LensFlareSettingsLoader);","import { RenderCapable } from \"../../RenderEngine/RenderEnum/RenderCapable\";\r\nimport { LayaGL } from \"../../layagl/LayaGL\";\r\nimport { ILoadTask, IResourceLoader, Loader } from \"../../net/Loader\";\r\nimport { Texture2DArray } from \"../../resource/Texture2DArray\";\r\nimport { Utils } from \"../../utils/Utils\";\r\n\r\nvar internalResources: Record<string, any> = {};\r\n\r\nexport class Texture2DArrayLoader implements IResourceLoader {\r\n\r\n    constructor() {\r\n        if (!internalResources) {\r\n            internalResources = {\r\n                \"default\": Texture2DArray.defaultTexture\r\n            };\r\n        }\r\n    }\r\n\r\n    load(task: ILoadTask) {\r\n        // todo internal resources\r\n        if (task.url.indexOf(\"internal/\") != -1) {\r\n            const tex = internalResources[Utils.getBaseName(task.url)];\r\n            if (tex) {\r\n                return Promise.resolve(tex);\r\n            }\r\n        }\r\n\r\n        return task.loader.fetch(task.url, \"json\", task.progress.createCallback(), task.options).then((data) => {\r\n            if (!data) {\r\n                return null;\r\n            }\r\n\r\n            let width = data.width;\r\n            let height = data.height;\r\n            let depth = data.depth;\r\n            let format = data.format;\r\n            let mipmap = data.mipmap;\r\n            let sRGB = data.sRGB;\r\n            let premultiplyAlpha = !!data.premultiplyAlpha;\r\n            let invertY = !!data.invertY;\r\n\r\n            let textures: Array<string> = data.textures;\r\n\r\n            let urls = [];\r\n            for (let index = 0; index < textures.length; index++) {\r\n                urls.push(textures[index]);\r\n            }\r\n\r\n            return Promise.all(urls.map((url) => {\r\n                if (url) {\r\n                    return task.loader.fetch(url, \"image\", task.progress.createCallback(), task.options);\r\n                }\r\n                else {\r\n                    return Promise.resolve(null);\r\n                }\r\n            })).then(images => {\r\n\r\n                if (LayaGL.renderEngine.getCapable(RenderCapable.Texture3D)) {\r\n                    let tex = new Texture2DArray(width, height, depth, format, mipmap, sRGB);\r\n                    tex.setImageData(images, premultiplyAlpha, invertY);\r\n                    return tex;\r\n                }\r\n                else {\r\n                    return null;\r\n                }\r\n            });\r\n        });\r\n    }\r\n}\r\n\r\nLoader.registerLoader([\"tex2darray\"], Texture2DArrayLoader, Loader.TEXTURE2DARRAY);","export enum ECharacterCapable {\r\n    //Charcater_AllowSleep,   // \r\n    //Charcater_AllowTrigger, // \r\n    Charcater_Gravity,  // \r\n    Charcater_CollisionGroup, // \r\n    //Charcater_Friction,   // \r\n    //Charcater_RollingFriction,    // \r\n    //Charcater_Restitution,    // \r\n    Charcater_WorldPosition,    // \r\n    Charcater_Move, // \r\n    Charcater_Jump, // \r\n    Charcater_StepOffset,   // \r\n    Character_UpDirection,  // \r\n    Character_FallSpeed, // \r\n    Character_SlopeLimit,   // \r\n    Character_PushForce,    // \r\n    Character_Radius,   // \r\n    Character_Height,   // \r\n    Character_offset,   // \r\n    Character_Skin,   // \r\n    Character_minDistance,\r\n    Character_EventFilter, // \r\n    Character_SimulateGravity,  // \r\n}","export enum EColliderCapable {\r\n    Collider_CollisionGroup, // \r\n    Collider_Friction,   // \r\n    Collider_RollingFriction,    // \r\n    Collider_Restitution,    // \r\n    Collider_AllowTrigger, // \r\n    Collider_DynamicFriction,\r\n    Collider_StaticFriction,\r\n    Collider_BounceCombine,\r\n    Collider_FrictionCombine,\r\n    Collider_EventFilter,   // \r\n    Collider_CollisionDetectionMode, // \r\n\r\n    // RigidBody\r\n    RigidBody_CanKinematic,   // \r\n    RigidBody_AllowSleep,   // \r\n    RigidBody_Gravity,   // \r\n    RigidBody_LinearDamp, // \r\n    RigidBody_AngularDamp,    // \r\n    RigidBody_LinearVelocity, // \r\n    RigidBody_AngularVelocity,    //  \r\n    RigidBody_Mass,   // \r\n    RigidBody_WorldPosition,   // \r\n    RigidBody_WorldOrientation,   // \r\n    RigidBody_InertiaTensor,  // \r\n    RigidBody_MassCenter, // \r\n    RigidBody_MaxAngularVelocity, // \r\n    RigidBody_MaxDepenetrationVelocity,   // \r\n    RigidBody_SleepThreshold, //bug TODO\r\n    RigidBody_SleepAngularVelocity,   //   TODO\r\n    RigidBody_SolverIterations,   // \r\n    RigidBody_AllowDetectionMode,   // \r\n    RigidBody_AllowKinematic,   // \r\n    RigidBody_AllowCharacter,   // \r\n    RigidBody_LinearFactor,   // \r\n    RigidBody_AngularFactor,  // \r\n    RigidBody_ApplyForce, // \r\n    RigidBody_ClearForce, // \r\n    RigidBody_ApplyForceWithOffset,    // \r\n    RigidBody_ApplyTorque,    // \r\n    RigidBody_ApplyImpulse,   // \r\n    RigidBody_ApplyTorqueImpulse, // \r\n}","export enum EJointCapable {\r\n    Joint_Anchor,   // \r\n    Joint_ConnectAnchor,    // \r\n}","import { Quaternion } from \"../../../maths/Quaternion\";\r\nimport { Vector3 } from \"../../../maths/Vector3\";\r\nimport { IJoint } from \"./IJoint\";\r\nexport enum D6MotionType {\r\n    eX = 0,\t//!< motion along the X axis\r\n    eY = 1,\t//!< motion along the Y axis\r\n    eZ = 2,\t//!< motion along the Z axis\r\n    eTWIST = 3,\t//!< motion around the X axis\r\n    eSWING1 = 4,\t//!< motion around the Y axis\r\n    eSWING2 = 5,\t//!< motion around the Z axis\r\n}\r\n\r\nexport enum D6Axis {\r\n    eLOCKED,\t//!< The DOF is locked, it does not allow relative motion.\r\n    eLIMITED,\t//!< The DOF is limited, it only allows motion within a specific range.\r\n    eFREE\t//!< The DOF is free and has its full range of motion.\r\n}\r\n\r\nexport enum D6Drive {\r\n    eX = 0,\t//!< drive along the X-axis\r\n    eY = 1,\t//!< drive along the Y-axis\r\n    eZ = 2,\t//!< drive along the Z-axis\r\n    eSWING = 3,\t//!< drive of displacement from the X-axis\r\n    eTWIST = 4,\t//!< drive of the displacement around the X-axis\r\n    eSLERP = 5,\t//!< drive of all three angular degrees along a SLERP-path\r\n}\r\n\r\nexport interface ID6Joint extends IJoint {\r\n    setAxis(axis: Vector3, secendary: Vector3): void;\r\n    //Set the motion type around the specified axis.\r\n    setMotion(axis: D6Axis, motionType: D6MotionType): void;\r\n    //Set Distance limit Params\r\n    setDistanceLimit(limit: number, bounceness: number, bounceThreshold: number, spring: number, damp: number): void;\r\n    //x,y,z linear Limit\r\n    setLinearLimit(linearAxis: D6MotionType, upper: number, lower: number, bounceness: number, bounceThreshold: number, spring: number, damping: number): void;\r\n    //The twist limit controls the range of motion around the twist axis. \r\n    setTwistLimit(upper: number, lower: number, bounceness: number, bounceThreshold: number, spring: number, damping: number): void;\r\n    //\r\n    setSwingLimit(yAngle: number, zAngle: number, bounceness: number, bounceThreshold: number, spring: number, damping: number): void;\r\n    //setDrive\r\n    setDrive(index: D6Drive, stiffness: number, damping: number, forceLimit: number): void;\r\n    //drive Position \r\n    setDriveTransform(position: Vector3, rotate: Quaternion): void;\r\n    //\r\n    setDriveVelocity(position: Vector3, angular: Vector3): void;\r\n    //get the twist angle of the joint, in the range (-2*Pi, 2*Pi]\r\n    getTwistAngle(): number\r\n    //get the swing angle of the joint from the Y axis\r\n    getSwingYAngle(): number;\r\n    //get the swing angle of the joint from the Z axis\r\n    getSwingZAngle(): number;\r\n}","/**\r\n\t * <code>Rand</code> 128,:https://github.com/AndreasMadsen/xorshift\r\n\t */\r\nexport class RandX {\r\n\t/**@internal */\r\n\tprivate static _CONVERTION_BUFFER: DataView = new DataView(new ArrayBuffer(8));\r\n\r\n\t/**@internal */\r\n\tprivate _state0U: number;\r\n\t/**@internal */\r\n\tprivate _state0L: number;\r\n\t/**@internal */\r\n\tprivate _state1U: number;\r\n\t/**@internal */\r\n\tprivate _state1L: number;\r\n\r\n\t/***/\r\n\tstatic defaultRand: RandX = new RandX([0, Date.now() / 65536, 0, Date.now() % 65536]);\r\n\r\n\t/**\r\n\t *  <code>Rand</code> \r\n\t * @param\tseed  \r\n\t */\r\n\tconstructor(seed: any[]) {\r\n\t\tif (!(seed instanceof Array) || seed.length !== 4)\r\n\t\t\tthrow new Error('Rand:Seed must be an array with 4 numbers');\r\n\r\n\t\tthis._state0U = seed[0] | 0;\r\n\t\tthis._state0L = seed[1] | 0;\r\n\t\tthis._state1U = seed[2] | 0;\r\n\t\tthis._state1L = seed[3] | 0;\r\n\t}\r\n\r\n\t/**\r\n\t * 2x3264\r\n\t * @return 64\r\n\t */\r\n\trandomint(): any[] {\r\n\t\t// uint64_t s1 = s[0]\r\n\t\tvar s1U: number = this._state0U, s1L: number = this._state0L;\r\n\t\t// uint64_t s0 = s[1]\r\n\t\tvar s0U: number = this._state1U, s0L: number = this._state1L;\r\n\r\n\t\t// result = s0 + s1\r\n\t\tvar sumL: number = (s0L >>> 0) + (s1L >>> 0);\r\n\t\tvar resU: number = (s0U + s1U + (sumL / 2 >>> 31)) >>> 0;\r\n\t\tvar resL: number = sumL >>> 0;\r\n\r\n\t\t// s[0] = s0\r\n\t\tthis._state0U = s0U;\r\n\t\tthis._state0L = s0L;\r\n\r\n\t\t// - t1 = [0, 0]\r\n\t\tvar t1U: number = 0, t1L: number = 0;\r\n\t\t// - t2 = [0, 0]\r\n\t\tvar t2U: number = 0, t2L: number = 0;\r\n\r\n\t\t// s1 ^= s1 << 23;\r\n\t\t// :: t1 = s1 << 23\r\n\t\tvar a1: number = 23;\r\n\t\tvar m1: number = 0xFFFFFFFF << (32 - a1);\r\n\t\tt1U = (s1U << a1) | ((s1L & m1) >>> (32 - a1));\r\n\t\tt1L = s1L << a1;\r\n\t\t// :: s1 = s1 ^ t1\r\n\t\ts1U = s1U ^ t1U;\r\n\t\ts1L = s1L ^ t1L;\r\n\r\n\t\t// t1 = ( s1 ^ s0 ^ ( s1 >> 17 ) ^ ( s0 >> 26 ) )\r\n\t\t// :: t1 = s1 ^ s0\r\n\t\tt1U = s1U ^ s0U;\r\n\t\tt1L = s1L ^ s0L;\r\n\t\t// :: t2 = s1 >> 18\r\n\t\tvar a2: number = 18;\r\n\t\tvar m2: number = 0xFFFFFFFF >>> (32 - a2);\r\n\t\tt2U = s1U >>> a2;\r\n\t\tt2L = (s1L >>> a2) | ((s1U & m2) << (32 - a2));\r\n\t\t// :: t1 = t1 ^ t2\r\n\t\tt1U = t1U ^ t2U;\r\n\t\tt1L = t1L ^ t2L;\r\n\t\t// :: t2 = s0 >> 5\r\n\t\tvar a3: number = 5;\r\n\t\tvar m3: number = 0xFFFFFFFF >>> (32 - a3);\r\n\t\tt2U = s0U >>> a3;\r\n\t\tt2L = (s0L >>> a3) | ((s0U & m3) << (32 - a3));\r\n\t\t// :: t1 = t1 ^ t2\r\n\t\tt1U = t1U ^ t2U;\r\n\t\tt1L = t1L ^ t2L;\r\n\r\n\t\t// s[1] = t1\r\n\t\tthis._state1U = t1U;\r\n\t\tthis._state1L = t1L;\r\n\r\n\t\t// return result\r\n\t\treturn [resU, resL];\r\n\t}\r\n\r\n\t/**\r\n\t * [0,1)\r\n\t * @return\r\n\t */\r\n\trandom(): number {\r\n\t\t// :: t2 = randomint()\r\n\t\tvar t2: any[] = this.randomint();\r\n\t\tvar t2U: number = t2[0];\r\n\t\tvar t2L: number = t2[1];\r\n\r\n\t\t// :: e = UINT64_C(0x3FF) << 52\r\n\t\tvar eU: number = 0x3FF << (52 - 32);\r\n\t\tvar eL: number = 0;\r\n\r\n\t\t// :: s = t2 >> 12\r\n\t\tvar a1: number = 12;\r\n\t\tvar m1: number = 0xFFFFFFFF >>> (32 - a1);\r\n\t\tvar sU: number = t2U >>> a1;\r\n\t\tvar sL: number = (t2L >>> a1) | ((t2U & m1) << (32 - a1));\r\n\r\n\t\t// :: x = e | s\r\n\t\tvar xU: number = eU | sU;\r\n\t\tvar xL: number = eL | sL;\r\n\r\n\t\t// :: double d = *((double *)&x)\r\n\t\tRandX._CONVERTION_BUFFER.setUint32(0, xU, false);\r\n\t\tRandX._CONVERTION_BUFFER.setUint32(4, xL, false);\r\n\t\tvar d: number = RandX._CONVERTION_BUFFER.getFloat64(0, false);\r\n\r\n\t\t// :: d - 1\r\n\t\treturn d - 1;\r\n\t}\r\n}\r\n\r\n\r\n","/**\r\n * <code>Physics</code> \r\n */\r\nexport class Physics3DUtils {\r\n\t/** */\r\n\tstatic COLLISIONFILTERGROUP_DEFAULTFILTER: number = 0x1;\r\n\t/** */\r\n\tstatic COLLISIONFILTERGROUP_STATICFILTER: number = 0x2;\r\n\t/** */\r\n\tstatic COLLISIONFILTERGROUP_KINEMATICFILTER: number = 0x4;\r\n\t/** */\r\n\tstatic COLLISIONFILTERGROUP_DEBRISFILTER: number = 0x8;\r\n\t/***/\r\n\tstatic COLLISIONFILTERGROUP_SENSORTRIGGER: number = 0x10;\r\n\t/** */\r\n\tstatic COLLISIONFILTERGROUP_CHARACTERFILTER: number = 0x20;\r\n\t/**1 */\r\n\tstatic COLLISIONFILTERGROUP_CUSTOMFILTER1: number = 0x40;\r\n\t/**2 */\r\n\tstatic COLLISIONFILTERGROUP_CUSTOMFILTER2: number = 0x80;\r\n\t/**3 */\r\n\tstatic COLLISIONFILTERGROUP_CUSTOMFILTER3: number = 0x100;\r\n\t/**4 */\r\n\tstatic COLLISIONFILTERGROUP_CUSTOMFILTER4: number = 0x200;\r\n\t/**5 */\r\n\tstatic COLLISIONFILTERGROUP_CUSTOMFILTER5: number = 0x400;\r\n\t/**6 */\r\n\tstatic COLLISIONFILTERGROUP_CUSTOMFILTER6: number = 0x800;\r\n\t/**7 */\r\n\tstatic COLLISIONFILTERGROUP_CUSTOMFILTER7: number = 0x1000;\r\n\t/**8 */\r\n\tstatic COLLISIONFILTERGROUP_CUSTOMFILTER8: number = 0x2000;\r\n\t/**9 */\r\n\tstatic COLLISIONFILTERGROUP_CUSTOMFILTER9: number = 0x4000;\r\n\t/**10*/\r\n\tstatic COLLISIONFILTERGROUP_CUSTOMFILTER10: number = 0x8000;\r\n\t/** */\r\n\tstatic COLLISIONFILTERGROUP_ALLFILTER: number = -1;\r\n\t/**PHYSX */\r\n\tstatic PHYSXDEFAULTMASKVALUE: number = 0xffffffff;\r\n}\r\n\r\n\r\n","import { RenderContext3D } from \"../core/render/RenderContext3D\"\r\n\t/**\r\n\t * \r\n\t */\r\n\texport class Size {\r\n\t\t/**\r\n\t\t * \r\n\t\t */\r\n\t\t static get fullScreen():Size {\r\n\t\t\treturn new Size(-1, -1);\r\n\t\t}\r\n\t\t\r\n\t\tprivate _width:number = 0;\r\n\t\tprivate _height:number = 0;\r\n\t\t\r\n\t\t/**\r\n\t\t * \r\n\t\t */\r\n\t\tget width():number {\r\n\t\t\tif (this._width === -1)\r\n\t\t\t\treturn RenderContext3D.clientWidth;\r\n\t\t\t\r\n\t\t\treturn this._width;\r\n\t\t}\r\n\t\t\r\n\t\t/**\r\n\t\t * \r\n\t\t */\r\n\t\tget height():number {\r\n\t\t\tif (this._height === -1)\r\n\t\t\t\treturn RenderContext3D.clientHeight;\r\n\t\t\treturn this._height;\r\n\t\t}\r\n\t\t\r\n\t\t/**\r\n\t\t * Size\r\n\t\t * @param width  \r\n\t\t * @param height \r\n\t\t */\r\n\t\tconstructor(width:number, height:number){\r\n\t\t\tthis._width = width;\r\n\t\t\tthis._height = height;\r\n\t\t}\r\n\t\r\n\t}\r\n\r\n\r\n","import { RenderTargetFormat } from \"../../../RenderEngine/RenderEnum/RenderTargetFormat\";\r\nimport { RenderTexture } from \"../../../resource/RenderTexture\";\r\nimport { WebXRExperienceHelper } from \"./WebXRExperienceHelper\";\r\n\r\n\r\n/**\r\n * @author miner\r\n * WebXRRenderTexture\r\n */\r\nexport class WebXRRenderTexture extends RenderTexture {\r\n\r\n\t/** @internal */\r\n\tprotected _frameBuffer: any;\r\n\t/**update mask */\r\n\tpublic frameLoop: number = -1;\r\n\r\n\t/**\r\n\t * WebXRFrameBuffer\r\n\t * @param frameBuffer \r\n\t */\r\n\tconstructor() {\r\n\t\tsuper(1, 1, 1, RenderTargetFormat.STENCIL_8, false, 1);\r\n\t}\r\n\r\n\t/**\r\n\t * set frameBuffer\r\n\t */\r\n\tset frameBuffer(value: any) {\r\n\t\tthis._frameBuffer = value;\r\n\t}\r\n\r\n\t/**\r\n\t * No glframeBuffer create\r\n\t * @param width \r\n\t * @param height \r\n\t */\r\n\tprotected _create(width: number, height: number): void {\r\n\t}\r\n\r\n\t/**\r\n\t * @internal\r\n\t */\r\n\t_start(): void {\r\n\t\tvar gl: WebGLRenderingContext =  WebXRExperienceHelper.glInstance;\r\n\t\tgl.bindFramebuffer(gl.FRAMEBUFFER, this._frameBuffer);\r\n\t\tRenderTexture._currentActive = this;\r\n\t}\r\n\r\n\t/**\r\n\t * @internal\r\n\t */\r\n\t_end(): void {\r\n\t\tvar gl: WebGLRenderingContext = WebXRExperienceHelper.glInstance;\r\n\t\tgl.bindFramebuffer(gl.FRAMEBUFFER, null);\r\n\t\tRenderTexture._currentActive = null;\r\n\t}\r\n\r\n}","import { ILaya } from \"../../../../ILaya\";\r\nimport { EventDispatcher } from \"../../../events/EventDispatcher\";\r\n\r\n/**\r\n * Manages an XRSession to work with layaAir engine\r\n * @author miner\r\n */\r\nexport class WebXRSessionManager extends EventDispatcher {\r\n\r\n    static EVENT_MANAGER_END:string = \"xrManagerDestory\";\r\n    static EVENT_FRAME_LOOP:string = \"xrFrameLoop\";\r\n\r\n    \r\n    /**\r\n     * Underlying xr session\r\n     */\r\n    public session: any//: \r\n    /**\r\n     * XRReferenceSpace TODO\r\n     */\r\n    public viewerReferenceSpace: any; //XRReferenceSpace;\r\n\r\n    /** baseRefernceSpace */\r\n    public baseReferenceSpace: any;//;\r\n    /** Current XR  XRFrame*/\r\n    public currentFrame: any;//\r\n    /** WebXR timestamp updated every frame */\r\n    public currentTimestamp: number = -1;\r\n    /**,init */\r\n    public defaultHeightCompensation = 1.7;\r\n\r\n    /**\r\n     * XRReferenceSpace\r\n     */\r\n    private _referenceSpace: any;\r\n    /** \"inline\" | \"immersive-vr\" | \"immersive-ar\"*/\r\n    private _sessionMode: any;\r\n    /** session enable state */\r\n    private _sessionEnded: boolean = false;\r\n    /**WebXR Base Layer */\r\n    private _baseLayer:any;\r\n    /**web XRSystem */\r\n    private _xrNavigator: any;\r\n    /**\r\n     * @internal\r\n     * WebXR\r\n     */\r\n    constructor() {\r\n        super();\r\n    }\r\n    /**\r\n    * The current reference space used in this session.\r\n    * @returns XRReferenceSpace;\r\n    */\r\n    public get referenceSpace() {\r\n        return this._referenceSpace;\r\n    }\r\n\r\n    /**\r\n     * set \r\n     */\r\n    public set referenceSpace(newReferenceSpace) {\r\n        this._referenceSpace = newReferenceSpace;\r\n    }\r\n\r\n    /**\r\n    * The mode for the managed XR session\r\n    */\r\n    public get sessionMode() {\r\n        return this._sessionMode;\r\n    }\r\n\r\n    /**\r\n     * Stops the xrSession and restores the render loop\r\n     */\r\n    exitXR() {\r\n        this.endXRRenderLoop();\r\n        this.event(WebXRSessionManager.EVENT_MANAGER_END);\r\n    }\r\n    \r\n    /**\r\n     * Initializes the xr layer for the session \r\n     * @param xrSession \r\n     * @param gl \r\n     * @returns \r\n     */\r\n    public initializeXRGL(xrSession: any, gl: WebGLRenderingContext): Promise<boolean> {//: XRWebGLLayer {\r\n        return (gl as any).makeXRCompatible().then(()=> {\r\n            return true;\r\n        });\r\n    };\r\n\r\n    /**\r\n     * WebXR\r\n     * @returns WebXR\r\n     */\r\n    public initializeAsync(): Promise<void> {\r\n        // Check if the browser supports webXR\r\n        this._xrNavigator = navigator;\r\n        if (!this._xrNavigator.xr) {\r\n            return Promise.reject(\"WebXR not available\");\r\n        }\r\n        return Promise.resolve();\r\n    }\r\n\r\n    /**\r\n     * Sessiopn\r\n     * @param sessionMode \"inline\" | \"immersive-vr\" | \"immersive-ar\"\r\n     * @returns A Promise that resolves to true if supported and false if not\r\n     */\r\n    public isSessionSupportedAsync(sessionMode: string): Promise<boolean> {\r\n        if (!(navigator as any).xr) {\r\n            return Promise.resolve(false);\r\n        } else {\r\n            this._xrNavigator = navigator;\r\n        }\r\n        const functionToUse = (navigator as any).xr.isSessionSupported || (navigator as any).xr.supportsSession;\r\n        if (!functionToUse)\r\n            return Promise.resolve(false);\r\n        else {\r\n            return (navigator as any).xr.isSessionSupported(sessionMode);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Session\r\n     * @param xrSessionMode xrsessionMode\r\n     * @param xrSessionInit any initInfo\r\n     * @returns \r\n     */\r\n    public initializeSessionAsync(xrSessionMode = 'immersive-vr', xrSessionInit = {}): Promise<any> {\r\n        return this._xrNavigator.xr.requestSession('immersive-vr').then((session: any) => {\r\n            this.session = session;\r\n            this._sessionMode = xrSessionMode;\r\n            this._sessionEnded = false;\r\n\r\n            // handle\r\n            this.session.addEventListener(\r\n                \"end\",\r\n                () => {\r\n                    this._sessionEnded = true;\r\n                    this.exitXR();\r\n                },\r\n                { once: true }\r\n            );\r\n\r\n            return this.session;\r\n        });\r\n    }\r\n\r\n    /**\r\n     * Resets the reference space to the one started the session\r\n     */\r\n    public resetReferenceSpace() {\r\n        this.referenceSpace = this.baseReferenceSpace;\r\n    }\r\n\r\n    /**\r\n     * Starts rendering to the xr layer\r\n     */\r\n    public runXRRenderLoop() {\r\n        this.session.requestAnimationFrame.bind(this.session);\r\n        let fn = (timestamp: any, xrFrame: any) => {\r\n            this._updateByXrFrame(xrFrame, timestamp);\r\n            this.event(WebXRSessionManager.EVENT_FRAME_LOOP, [xrFrame]);\r\n            ILaya.stage._loop();\r\n            this.session.requestAnimationFrame(fn);\r\n        };\r\n        this.session.requestAnimationFrame(fn);\r\n    }\r\n\r\n    public endXRRenderLoop(){\r\n\r\n    }\r\n\r\n    /**\r\n     * Update\r\n     * @param xrFrame \r\n     */\r\n    private _updateByXrFrame(xrFrame: any, timestamp: number) {\r\n        this.currentFrame = xrFrame;\r\n        this.currentTimestamp = timestamp;\r\n    }\r\n\r\n    /**\r\n    * Sets the reference space on the xr session\r\n    * @param referenceSpaceType space to set\r\n    * @returns a promise that will resolve once the reference space has been set\r\n    */\r\n    public setReferenceSpaceTypeAsync(referenceSpaceType = \"local-floor\"): Promise<any> {//XRReferenceSpace\r\n        return this.session\r\n            .requestReferenceSpace(referenceSpaceType)\r\n            .then(\r\n                (referenceSpace: any) => {\r\n                    return referenceSpace;\r\n                },\r\n                (rejectionReason: any) => {\r\n                    return this.session.requestReferenceSpace(\"viewer\").then(\r\n                        (referenceSpace: any) => {\r\n                            //@ts-ignore\r\n                            const heightCompensation = new XRRigidTransform({ x: 0, y: -this.defaultHeightCompensation, z: 0 });\r\n                            return (referenceSpace).getOffsetReferenceSpace(heightCompensation);\r\n                        },\r\n                        (rejectionReason: any) => {\r\n\r\n                            throw 'XR initialization failed: required \"viewer\" reference space type not supported.';\r\n                        }\r\n                    );\r\n                }\r\n            ).then((referenceSpace: any) => {\r\n                // initialize the base and offset (currently the same)\r\n                this.referenceSpace = this.baseReferenceSpace = referenceSpace;\r\n                return this.referenceSpace;\r\n            });\r\n    }\r\n\r\n    /**\r\n    * Updates the render state of the session\r\n    * @param state state to set\r\n    * @returns a promise that resolves once the render state has been updated\r\n    */\r\n    public updateRenderStateAsync(state: any) {//: XRRenderState) {\r\n        if (state.baseLayer) {\r\n            this._baseLayer = state.baseLayer;\r\n        }\r\n        return this.session.updateRenderState(state);\r\n    }\r\n\r\n    /**\r\n     * The current frame rate as reported by the device\r\n     */\r\n    public get currentFrameRate(): number | undefined {\r\n        return this.session?.frameRate;\r\n    }\r\n\r\n    /**\r\n    * A list of supported frame rates (only available in-session!\r\n    */\r\n    public get supportedFrameRates(): Float32Array | undefined {\r\n        return this.session?.supportedFrameRates;\r\n    }\r\n\r\n    /**\r\n     * Set the framerate of the session.\r\n     * @param rate the new framerate. This value needs to be in the supportedFrameRates array\r\n     * @returns a promise that resolves once the framerate has been set\r\n     */\r\n    public updateTargetFrameRate(rate: number): Promise<void> {\r\n        return this.session.updateTargetFrameRate(rate);\r\n    }\r\n\r\n    destroy() {\r\n        if (!this._sessionEnded) {\r\n            this.exitXR();\r\n        }\r\n    }\r\n}","import { Quaternion } from \"../../../maths/Quaternion\";\r\nimport { Vector3 } from \"../../../maths/Vector3\";\r\nimport { WebXRCamera } from \"./WebXRCamera\";\r\nimport { WebXRRenderTexture } from \"./WebXRRenderTexture\";\r\nimport { WebXRSessionManager } from \"./WebXRSessionManager\";\r\n\r\n\r\n/**\r\n * @author miner\r\n * XRCamera\r\n */\r\nexport class WebXRCameraManager {\r\n    /**\r\n     * reference Quaternin\r\n     */\r\n    private _referenceQuaternion: Quaternion = new Quaternion();\r\n    /**\r\n     * reference Position\r\n     */\r\n    private _referencedPosition: Vector3 = new Vector3();\r\n    /**\r\n     * WebXR Session Manager\r\n     */\r\n    private _webXRSessionManager: WebXRSessionManager;\r\n    /**\r\n     * first Frame Flag\r\n     */\r\n    private _firstFrame = true;//\r\n    /**\r\n     * WebXR RenderTexture\r\n     */\r\n    private _XRRenderTexture: WebXRRenderTexture = new WebXRRenderTexture();\r\n    /**\r\n     * WebXRCamera Array\r\n     */\r\n    private _rigCameras = new Array<WebXRCamera>();\r\n    /**\r\n     * Reference position\r\n     */\r\n    private _position = new Vector3();\r\n\r\n    /**\r\n     * parent\r\n     */\r\n    public owner: any;\r\n\r\n    get position(): Vector3 {\r\n        return this._position;\r\n    }\r\n\r\n    set position(newPosition: Vector3) {\r\n\r\n        newPosition.cloneTo(this._position);\r\n    }\r\n\r\n    set rotationQuaternion(value: Quaternion) {\r\n        value.cloneTo(this._referenceQuaternion);\r\n    }\r\n\r\n    get rotationQuaternion(): Quaternion {\r\n        return this._referenceQuaternion;\r\n    }\r\n\r\n    get rigCameras(): WebXRCamera[] {\r\n        return this._rigCameras;\r\n    }\r\n\r\n    /**\r\n     * XRCamera\r\n     * @param camera \r\n     * @param manager \r\n     */\r\n    constructor(camera: any, manager: WebXRSessionManager = null) {\r\n        this.owner = camera;\r\n        this.owner.enableRender = false;\r\n        if (!this.owner.aspectRatio) {\r\n            console.warn(\"owner is not Camera\");\r\n        }\r\n        this._webXRSessionManager = manager;\r\n        this._webXRSessionManager.on(WebXRSessionManager.EVENT_FRAME_LOOP, this, this._updateFromXRSession);\r\n        this._webXRSessionManager.on(WebXRSessionManager.EVENT_FRAME_LOOP, this, this._updateReferenceSpace);\r\n        this._webXRSessionManager.on(WebXRSessionManager.EVENT_MANAGER_END, this, this.destroy);\r\n    }\r\n\r\n    /**\r\n     * updateFrame by WebXR Session\r\n     */\r\n    _updateFromXRSession() {\r\n        //XRViewerPose\r\n        let pose = this._webXRSessionManager.currentFrame && this._webXRSessionManager.currentFrame.getViewerPose(this._webXRSessionManager.referenceSpace);\r\n        //update pose data\r\n        const pos = pose.transform.position;\r\n        const orientation = pose.transform.orientation;\r\n        this._referenceQuaternion.setValue(orientation.x, orientation.y, orientation.z, orientation.w);\r\n        this._referencedPosition.setValue(pos.x, pos.y, pos.z);\r\n        if (this._firstFrame) {\r\n            this._firstFrame = false;\r\n            this.position.y += this._referencedPosition.y;\r\n            // avoid using the head rotation on the first frame.\r\n            this._referenceQuaternion.setValue(0, 0, 0, 1);\r\n        } else {\r\n            // update position and rotation as reference\r\n            this.rotationQuaternion = this._referenceQuaternion;\r\n            this.position = this._referencedPosition;\r\n        }\r\n        // Update camera rigs\r\n        if (this.rigCameras.length !== pose.views.length) {\r\n            this._updateNumberOfRigCameras(pose.views.length);\r\n        }\r\n        //XRView\r\n        pose.views.forEach((view: any, i: any) => {\r\n            const currentRig = this.rigCameras[i];\r\n            if (view.eye === \"right\")\r\n                currentRig.name = \"right\";\r\n            else if (view.eye === \"left\")\r\n                currentRig.name = \"left\";\r\n            // Update view/projection matrix\r\n            const pos = view.transform.position;\r\n            const orientation = view.transform.orientation;\r\n            currentRig.transform.position.setValue(pos.x, pos.y, pos.z);\r\n            currentRig.transform.rotation.setValue(orientation.x, orientation.y, orientation.z, orientation.w);\r\n            currentRig.transform.position = currentRig.transform.position;\r\n            currentRig.transform.rotation = currentRig.transform.rotation;\r\n            // Update viewport\r\n            if (this._webXRSessionManager.session.renderState.baseLayer) {\r\n                var viewport = this._webXRSessionManager.session.renderState.baseLayer.getViewport(view);\r\n                var width = this._webXRSessionManager.session.renderState.baseLayer.framebufferWidth;\r\n                var height = this._webXRSessionManager.session.renderState.baseLayer.framebufferHeight;\r\n                this._XRRenderTexture.frameBuffer = this._webXRSessionManager.session.renderState.baseLayer.framebuffer;\r\n                //update FrameBuffer\r\n                currentRig.renderTarget = this._XRRenderTexture;\r\n                //update clientSize\r\n                currentRig.clientWidth = width;\r\n                currentRig.clientHeight = height;\r\n                //update viewPort\r\n                var cameraViewPort = currentRig.viewport;\r\n                cameraViewPort.x = viewport.x;\r\n                cameraViewPort.y = viewport.y;\r\n                cameraViewPort.width = viewport.width;\r\n                cameraViewPort.height = viewport.height;\r\n                currentRig.viewport = cameraViewPort;\r\n                currentRig.projectionMatrix.cloneByArray(view.projectionMatrix);\r\n            }\r\n        });\r\n    }\r\n\r\n    /**\r\n     * update number of WebXRCamera\r\n     * @param viewCount \r\n     */\r\n    private _updateNumberOfRigCameras(viewCount = 1) {\r\n        while (this.rigCameras.length < viewCount) {\r\n            //add camera\r\n            var xrcamera = new WebXRCamera(this.owner.aspectRatio, this.owner.nearPlane, this.owner.farPlane);\r\n            xrcamera.clearFlag = this.owner.clearFlag;\r\n            xrcamera.clearColor = this.owner.clearColor;\r\n            this.owner.addChild(xrcamera);\r\n            this.rigCameras.push(xrcamera);\r\n        }\r\n        while (this.rigCameras.length > viewCount) {\r\n            //remove camera\r\n            let xrcamera = this.rigCameras.pop();\r\n            this.owner.removeChild(xrcamera);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * TODO:update of Reference Space\r\n     */\r\n    private _updateReferenceSpace() {\r\n        //TODO:\r\n    }\r\n\r\n    /**\r\n     * destroy\r\n     */\r\n    destroy() {\r\n        this.owner.enableRender = true;\r\n        this._webXRSessionManager.off(WebXRSessionManager.EVENT_FRAME_LOOP, this, this._updateFromXRSession);\r\n        this._webXRSessionManager.off(WebXRSessionManager.EVENT_FRAME_LOOP, this, this._updateReferenceSpace);\r\n        this._webXRSessionManager.off(WebXRSessionManager.EVENT_MANAGER_END, this, this.destroy);\r\n        this._rigCameras.forEach(element => {\r\n            element.destroy();\r\n        });\r\n        this._rigCameras = null;\r\n        this._XRRenderTexture.destroy();\r\n    }\r\n\r\n}","import { EventDispatcher } from \"../../../events/EventDispatcher\";\r\nimport { Vector2 } from \"../../../maths/Vector2\";\r\n\r\n/**\r\n * gamepad Axis\r\n */\r\nexport class AxiGamepad extends EventDispatcher {\r\n    static EVENT_OUTPUT: string = \"outputAxi_id\";\r\n    /**\r\n     * \r\n     */\r\n    public handness: string;\r\n    /**\r\n     * \r\n     */\r\n    public axisLength: number;\r\n    /**\r\n     * axis Array\r\n     */\r\n    private axisData: Array<Vector2> = new Array();\r\n\r\n    /**\r\n     * \r\n     * @internal\r\n     * @param handness \r\n     * @param length \r\n     */\r\n    constructor(handness: string, length: number) {\r\n        super();\r\n        this.handness = handness;\r\n        this.axisData.length = length;\r\n        this.axisLength = length;\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     * @param padGameAxi \r\n     */\r\n    update(padGameAxi: any) {\r\n        for (let i = 0, j = 0; i < padGameAxi.axes.length; i += 2, ++j) {\r\n            if (!this.axisData[j])\r\n                this.axisData[j] = new Vector2();\r\n            this.axisData[j].setValue(padGameAxi.axes[i], padGameAxi.axes[i + 1]);\r\n            this.outPutStickValue(this.axisData[j], j);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @internal\r\n     * @param value \r\n     * @param index \r\n     */\r\n    outPutStickValue(value: Vector2, index: number) {\r\n        const eventnam = AxiGamepad.EVENT_OUTPUT + index.toString();\r\n        this.event(eventnam, [value]);\r\n    }\r\n\r\n    /**\r\n     * destroy\r\n     */\r\n    destroy() {\r\n        for (let i = 0; i < this.axisLength; i++) {\r\n            let eventname = AxiGamepad.EVENT_OUTPUT + i.toString();\r\n            this.offAll(eventname);\r\n        }\r\n    }\r\n\r\n}\r\n\r\n/**\r\n * gamepad Button\r\n */\r\nexport class ButtonGamepad extends EventDispatcher {\r\n    static EVENT_TOUCH_ENTER: string = \"touchEnter\";\r\n    static EVENT_TOUCH_STAY: string = \"touchStay\";\r\n    static EVENT_TOUCH_OUT: string = \"touchOut\";\r\n    static EVENT_PRESS_ENTER: string = \"pressEnter\";\r\n    static EVENT_PRESS_STAY: string = \"pressStay\";\r\n    static EVENT_PRESS_OUT: string = \"pressOut\";\r\n    static EVENT_PRESS_VALUE: string = \"outpressed\";\r\n\r\n    /**\r\n     * The id of the gamepad\r\n     */\r\n    public handness: string;\r\n    /**\r\n    * The index of the gamepad\r\n    */\r\n    public index: number;\r\n\r\n    /**\r\n     * front touch state\r\n     */\r\n    private lastTouch: boolean = false;\r\n    private lastPress: boolean = false;\r\n    private lastPressValue: number = 0;\r\n\r\n    /**\r\n     * current touch state\r\n     */\r\n    private touch: boolean = false;\r\n    private press: boolean = false;\r\n    private pressValue: number = 0;\r\n\r\n\r\n    /**\r\n     * Button\r\n     * @param handness \r\n     * @param index button\r\n     */\r\n    constructor(handness: string, index: number) {\r\n        super();\r\n        this.handness = handness;\r\n        this.index = index;\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     * GamePadButton update\r\n     */\r\n    update(padButton: any) {\r\n        //set Data\r\n        this.lastTouch = this.touch;\r\n        this.lastPress = this.press;\r\n        this.lastPressValue = this.pressValue;\r\n        this.touch = padButton.touched;\r\n        this.press = padButton.pressed;\r\n        this.pressValue = padButton.value;\r\n        if (!this.lastTouch && !this.touch) {\r\n            return;\r\n        }\r\n        if (this.lastTouch != this.touch && this.touch) {\r\n            this.touchEnter();\r\n        } else if (this.lastTouch == this.touch && this.touch) {\r\n            this.touchStay();\r\n        } else if (this.lastTouch != this.touch && !this.touch) {\r\n            this.touchOut();\r\n        }\r\n        if (this.lastPress != this.press && this.press) {\r\n            this.pressEnter();\r\n        } else if (this.lastPress == this.press && this.press) {\r\n            this.pressStay();\r\n        } else if (this.lastPress != this.press && !this.press) {\r\n            this.pressOut();\r\n        }\r\n        if (this.touch) {\r\n            this.outpressed();\r\n        }\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     * event touch enter\r\n     */\r\n    private touchEnter() {\r\n        this.event(ButtonGamepad.EVENT_TOUCH_ENTER);\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     * event touch Stay\r\n     */\r\n    private touchStay() {\r\n        this.event(ButtonGamepad.EVENT_TOUCH_STAY);\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     * event touch Out\r\n     */\r\n    private touchOut() {\r\n        this.event(ButtonGamepad.EVENT_TOUCH_OUT);\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     * event press enter\r\n     */\r\n    private pressEnter() {\r\n        this.event(ButtonGamepad.EVENT_PRESS_ENTER);\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     * event press Stay\r\n     */\r\n    private pressStay() {\r\n        this.event(ButtonGamepad.EVENT_PRESS_STAY);\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     * event press Out\r\n     */\r\n    private pressOut() {\r\n        this.event(ButtonGamepad.EVENT_PRESS_OUT);\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     * event press value\r\n     */\r\n    private outpressed() {\r\n        this.event(ButtonGamepad.EVENT_PRESS_VALUE, [this.pressValue]);\r\n    }\r\n\r\n    /**\r\n     * destroy\r\n     */\r\n    destroy() {\r\n        this.offAll(ButtonGamepad.EVENT_PRESS_ENTER);\r\n        this.offAll(ButtonGamepad.EVENT_PRESS_STAY);\r\n        this.offAll(ButtonGamepad.EVENT_PRESS_OUT);\r\n        this.offAll(ButtonGamepad.EVENT_PRESS_ENTER);\r\n        this.offAll(ButtonGamepad.EVENT_PRESS_STAY);\r\n        this.offAll(ButtonGamepad.EVENT_PRESS_OUT);\r\n        this.offAll(ButtonGamepad.EVENT_PRESS_VALUE);\r\n    }\r\n}","import { EventDispatcher } from \"../../../events/EventDispatcher\";\r\nimport { Quaternion } from \"../../../maths/Quaternion\";\r\nimport { Vector3 } from \"../../../maths/Vector3\";\r\nimport { Ray } from \"../../math/Ray\";\r\nimport { ButtonGamepad, AxiGamepad } from \"./WebXRGamepad\";\r\n\r\n\r\n/**\r\n * @author miner\r\n * \r\n */\r\nexport class WebXRInput extends EventDispatcher {\r\n    static HANDNESS_LEFT: string = \"left\";\r\n    static HANDNESS_RIGHT: string = \"right\";\r\n    static EVENT_FRAMEUPDATA_WEBXRINPUT: string = \"frameXRInputUpdate\";\r\n    private static tempQua: Quaternion = new Quaternion();\r\n    /**\r\n     * Button\r\n     */\r\n    private preButtonEventList: Array<any> = [];\r\n    /**\r\n     * axis\r\n     */\r\n    private preAxisEventList: Array<any> = [];\r\n    /**\r\n     * @internal\r\n     */\r\n    public _inputSource: any;//XRInputSource\r\n\r\n    public lastXRPose: any;\r\n    /**\r\n     * handMode\r\n     */\r\n    public handness: string;\r\n    /**\r\n     * input Ray\r\n     */\r\n    public ray: Ray;\r\n    /**\r\n     * hand Pos\r\n     */\r\n    public position: Vector3;\r\n    /**\r\n     * hand Rotate\r\n     */\r\n    public rotation: Quaternion;\r\n    /**\r\n     * lastRayPos\r\n     */\r\n    public _lastXRPose: any;\r\n\r\n    /**\r\n     * gamepad Button info\r\n     */\r\n    public gamepadButton: Array<ButtonGamepad>;\r\n\r\n    /**\r\n     * gamepad axis Info\r\n     */\r\n    public gamepadAxis: AxiGamepad;\r\n\r\n    constructor(handness: string) {\r\n        super();\r\n        this.handness = handness;\r\n        this.position = new Vector3();\r\n        this.rotation = new Quaternion();\r\n        this.ray = new Ray(new Vector3(), new Vector3());\r\n    }\r\n\r\n    /**\r\n     * XRInput\r\n     * @internal\r\n     * @param xrFrame WebXR\r\n     * @param referenceSpace \r\n     */\r\n    _updateByXRPose(xrFrame: any, referenceSpace: any) {\r\n        //updateRay\r\n        const rayPose = xrFrame.getPose(this._inputSource.targetRaySpace, referenceSpace);\r\n        this._lastXRPose = rayPose;\r\n        if (rayPose) {\r\n            const pos = rayPose.transform.position;\r\n            const orientation = rayPose.transform.orientation;\r\n            WebXRInput.tempQua.setValue(orientation.x, orientation.y, orientation.z, orientation.w);\r\n            this.ray.origin.setValue(pos.x, pos.y, pos.z);\r\n            Vector3.transformQuat(Vector3.UnitZ, WebXRInput.tempQua, this.ray.direction);\r\n            Vector3.scale(this.ray.direction, -1, this.ray.direction);\r\n        }\r\n        //updateMesh\r\n        if (this._inputSource.gripSpace) {\r\n            let meshPose = xrFrame.getPose(this._inputSource.gripSpace, referenceSpace);\r\n            if (meshPose) {\r\n                const pos = meshPose.transform.position;\r\n                const orientation = meshPose.transform.orientation;\r\n                this.position.setValue(pos.x, pos.y, pos.z);\r\n                this.rotation.setValue(orientation.x, orientation.y, orientation.z, orientation.w);\r\n            }\r\n        }\r\n        this.event(WebXRInput.EVENT_FRAMEUPDATA_WEBXRINPUT, [this]);\r\n        //handle gamepad\r\n        this._handleProcessGamepad();\r\n    }\r\n\r\n\r\n    /**\r\n     * handle gamepad Event\r\n     */\r\n    private _handleProcessGamepad() {\r\n        //axis init\r\n        const gamepad = this._inputSource.gamepad;\r\n        if (!this.gamepadAxis) {\r\n            this.gamepadAxis = new AxiGamepad(this.handness, gamepad.axes.length);\r\n            //preEvent\r\n            this.preAxisEventList.forEach(element => {\r\n                this.gamepadAxis.on(element.eventnam, element.caller, element.listener);\r\n            });\r\n        }\r\n        if (!this.gamepadButton) {\r\n            this.gamepadButton = [];\r\n            for (let i = 0; i < gamepad.buttons.length; ++i) {\r\n                this.gamepadButton.push(new ButtonGamepad(this.handness, i));\r\n            }\r\n            //preEvent\r\n            this.preButtonEventList.forEach(element => {\r\n                this.addButtonEvent(element.index, element.type, element.caller, element.listener);\r\n            });\r\n        }\r\n        //axis\r\n        this.gamepadAxis.update(gamepad);\r\n        //button\r\n        for (let i = 0; i < gamepad.buttons.length; ++i) {\r\n            let button = this.gamepadButton[i];\r\n            button.update(gamepad.buttons[i]);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * add button event\r\n     * @param index button\r\n     * @param type \r\n     * @param caller \r\n     * @param listener \r\n     */\r\n    addButtonEvent(index: number, type: string, caller: any, listener: Function) {\r\n        if (!this.gamepadButton) {\r\n            this.preButtonEventList.push({\r\n                \"index\": index,\r\n                \"type\": type,\r\n                \"caller\": caller,\r\n                \"listener\": listener\r\n            });\r\n        } else {\r\n            let button = this.gamepadButton[index];\r\n            button.on(type, caller, listener);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * add axis event\r\n     * @param index axis\r\n     * @param type \r\n     * @param caller \r\n     * @param listener \r\n     */\r\n    addAxisEvent(index: number, type: string, caller: any, listener: Function) {\r\n        if (!this.gamepadAxis) {\r\n            this.preAxisEventList.push({\r\n                \"eventnam\": type + index.toString(),\r\n                \"caller\": caller,\r\n                \"listener\": listener\r\n            });\r\n        } else {\r\n            const eventnam = type + index.toString();\r\n            this.gamepadAxis.on(eventnam, caller, listener);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * remove axis event\r\n     * @param index axis\r\n     * @param type \r\n     * @param caller \r\n     * @param listener \r\n     */\r\n    offAxisEvent(index: number, type: string, caller: any, listener: Function) {\r\n        if (this.gamepadAxis) {\r\n            const eventnam = type + index.toString();\r\n            this.gamepadAxis.off(eventnam, caller, listener);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * remove Button event\r\n     * @param index axis\r\n     * @param type \r\n     * @param caller \r\n     * @param listener \r\n     */\r\n    offButtonEvent(index: number, type: string, caller: any, listener: Function) {\r\n        if (this.gamepadButton) {\r\n            let button = this.gamepadButton[index];\r\n            button.off(type, caller, listener);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * \r\n     */\r\n    destroy() {\r\n        this.preButtonEventList = null;\r\n        this.ray = null;\r\n        this.position = null;\r\n        this.rotation = null;\r\n        this.gamepadAxis.destroy();\r\n        this.gamepadButton.forEach(element => {\r\n            element.destroy();\r\n        });\r\n    }\r\n}","import { Color } from \"../../../maths/Color\";\r\nimport { Vector3 } from \"../../../maths/Vector3\";\r\nimport { PixelLineSprite3D } from \"../../core/pixelLine/PixelLineSprite3D\";\r\nimport { Sprite3D } from \"../../core/Sprite3D\";\r\nimport { WebXRCameraManager } from \"./WebXRCameraManager\";\r\nimport { WebXRInput } from \"./WebXRInput\";\r\nimport { WebXRSessionManager } from \"./WebXRSessionManager\";\r\n\r\n\r\n/**\r\n * @author miner\r\n * \r\n * The path of the CDN the sample will fetch controller models from\r\n * MeshSource https://cdn.jsdelivr.net/npm/@webxr-input-profiles/assets@1.0.9/dist/profiles/\r\n */\r\nexport class WebXRInputManager {\r\n    static tempVec: Vector3 = new Vector3();\r\n    static tempVec1: Vector3 = new Vector3();\r\n    /**\r\n     * Session Manager\r\n     */\r\n    private webXRSessionManager: WebXRSessionManager;\r\n    /**\r\n     * webXRCamera Manager\r\n     */\r\n    private webXRCameraManager: WebXRCameraManager;\r\n    /**\r\n     * array of XRInput\r\n     */\r\n    private controllers: Map<string, WebXRInput> = new Map();\r\n    /**\r\n     * bind of XRInput Node Render\r\n     */\r\n    private controllerHandMesh: Map<string, Sprite3D> = new Map();\r\n    /**\r\n     * bind of XRInput Ray Render\r\n     */\r\n    private controllerLineRender: Map<string, PixelLineSprite3D> = new Map();\r\n    /**\r\n     * line Color\r\n     */\r\n    private lineColor: Color = Color.RED;\r\n    /**\r\n     * Ray length\r\n     */\r\n    private rayLength: number = 2;\r\n\r\n    /**\r\n     * WebXRInput\r\n     * @param webxrManager WebXR Session manager\r\n     * @param webXRCamera WebXR Manager\r\n     */\r\n    constructor(webxrManager: WebXRSessionManager, webXRCamera: WebXRCameraManager) {\r\n        this.webXRSessionManager = webxrManager;\r\n        this.webXRCameraManager = webXRCamera;\r\n        this.webXRSessionManager.on(WebXRSessionManager.EVENT_MANAGER_END, this, this.destory);\r\n        this.webXRSessionManager.on(WebXRSessionManager.EVENT_FRAME_LOOP, this, this._updateFromXRFrame);\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @param xrInput \r\n     */\r\n    private _updataMeshRender(xrInput: WebXRInput) {\r\n        const handness = xrInput.handness;\r\n        //mesh\r\n        if (this.controllerHandMesh.has(handness)) {\r\n            let meshNode = this.controllerHandMesh.get(handness);\r\n            meshNode.transform.position = xrInput.position;\r\n            meshNode.transform.rotation = xrInput.rotation;\r\n        }\r\n        //rayLine\r\n        if (this.controllerLineRender.has(handness)) {\r\n            let line = this.controllerLineRender.get(handness);\r\n            line.clear();\r\n            let ray = xrInput.ray;\r\n            WebXRInputManager.tempVec.setValue(ray.origin.x, ray.origin.y, ray.origin.z);\r\n            Vector3.scale(ray.direction, this.rayLength, WebXRInputManager.tempVec1);\r\n            Vector3.add(WebXRInputManager.tempVec, WebXRInputManager.tempVec1, WebXRInputManager.tempVec1);\r\n            line.addLine(WebXRInputManager.tempVec, WebXRInputManager.tempVec1, this.lineColor, this.lineColor);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * WebXRInput\r\n     * @param xrFrame \r\n     */\r\n    private _updateFromXRFrame(xrFrame: any) {\r\n        //frame, this.xrSessionManager.referenceSpace, this.xrCamera\r\n        const session = this.webXRSessionManager.session;\r\n        const refSpace = this.webXRSessionManager.referenceSpace;\r\n        for (let inputSource of session.inputSources) {\r\n            const key = inputSource.handedness;\r\n            let xrInput: WebXRInput;\r\n            if (!this.controllers.has(key)) {\r\n                xrInput = this.getController(key);\r\n            }else\r\n                xrInput = this.controllers.get(key);\r\n            if(xrInput){\r\n                xrInput = this.controllers.get(key);\r\n                xrInput._inputSource = inputSource;\r\n                xrInput._updateByXRPose(xrFrame, refSpace);\r\n            }\r\n            \r\n        }\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @param meshSprite \r\n     * @param handness left/right\r\n     */\r\n    bindMeshNode(meshSprite: Sprite3D, handness: string) {\r\n        this.controllerHandMesh.set(handness, meshSprite);\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @param lineSprite \r\n     * @param handness left/right\r\n     */\r\n    bindRayNode(lineSprite: PixelLineSprite3D, handness: string) {\r\n        this.controllerLineRender.set(handness, lineSprite);\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @param handness left/right\r\n     * @returns \r\n     */\r\n    getController(handness: string): WebXRInput {\r\n        if (handness != \"left\" && handness != \"right\")\r\n            return null;\r\n        if (!this.controllers.has(handness)) {\r\n            let value = new WebXRInput(handness);\r\n            this.controllers.set(handness, value);\r\n            value.on(WebXRInput.EVENT_FRAMEUPDATA_WEBXRINPUT, this, this._updataMeshRender);\r\n        }\r\n        return this.controllers.get(handness);\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     * \r\n     */\r\n    destory() {\r\n        this.webXRSessionManager.off(WebXRSessionManager.EVENT_FRAME_LOOP, this, this._updateFromXRFrame);\r\n        for (let key in this.controllers) {\r\n            this.controllers.get(key).off(\"frameXRInputUpdate\", this, this._updataMeshRender);\r\n            this.controllers.get(key).destroy();\r\n        }\r\n        this.controllers = null;\r\n        this.controllerHandMesh = null;\r\n        this.controllerLineRender = null;\r\n    }\r\n}\r\n\r\n","import { LayaGL } from \"../../../layagl/LayaGL\";\r\nimport { Camera } from \"../../core/Camera\";\r\nimport { WebXRCameraManager } from \"./WebXRCameraManager\";\r\nimport { WebXRInputManager } from \"./WebXRInputManager\";\r\nimport { WebXRSessionManager } from \"./WebXRSessionManager\";\r\nexport class WebXRCameraInfo {\r\n    /**depth far */\r\n    depthFar: number;\r\n    /**depth near */\r\n    depthNear: number;\r\n    /**camera */\r\n    camera: any;\r\n}\r\n\r\n/**\r\n * WebXR\r\n * @author miner\r\n */\r\nexport class WebXRExperienceHelper {\r\n\r\n    static glInstance: any;\r\n    /**\r\n     * single XRManager \r\n     */\r\n    public static xr_Manager = new WebXRSessionManager();\r\n    /**\r\n     * support webXR\r\n     */\r\n    public static supported = false;\r\n    /**\r\n     * default WebLayer option\r\n     * XRWebGLLayerInit\r\n     */\r\n    public static canvasOptions = {\r\n        antialias: true,\r\n        depth: true,\r\n        stencil: false,\r\n        alpha: true,\r\n        multiview: false,\r\n        framebufferScaleFactor: 1,\r\n    };\r\n\r\n    /**\r\n     * XRSession\r\n     * @param sessionMode XRSessionMode = \"inline\" | \"immersive-vr\" | \"immersive-ar\";\r\n     * @returns \r\n     */\r\n    public static supportXR(sessionMode: string): Promise<boolean> {\r\n        return WebXRExperienceHelper.xr_Manager.isSessionSupportedAsync(sessionMode).then(value => {\r\n            WebXRExperienceHelper.supported = value;\r\n            return value;\r\n        });\r\n    }\r\n\r\n    /**\r\n     * WewXR\r\n     * @param sessionMode XRSessionMode\r\n     * @param referenceSpaceType referenceType = \"viewer\" | \"local\" | \"local-floor\" | \"unbounded\";\r\n     * @param cameraInfo WebXRCameraInfo webXRCamera\r\n     * @returns Promise<WebXRSessionManager> \r\n     */\r\n    public static enterXRAsync(sessionMode: string, referenceSpaceType: string, cameraInfo: WebXRCameraInfo): Promise<WebXRSessionManager> {\r\n        if (sessionMode === \"immersive-ar\" && referenceSpaceType !== \"unbounded\") {\r\n            console.warn(\"We recommend using 'unbounded' reference space type when using 'immersive-ar' session mode\");\r\n        }\r\n\r\n        //session\r\n        return WebXRExperienceHelper.xr_Manager.initializeSessionAsync(sessionMode).then(() => {\r\n            //refernceSpace\r\n            return WebXRExperienceHelper.xr_Manager.setReferenceSpaceTypeAsync(referenceSpaceType);\r\n        }).then(() => {\r\n            //webglSurport\r\n            //@ts-ignore\r\n            return WebXRExperienceHelper.xr_Manager.initializeXRGL(sessionMode, LayaGL.renderEngine.gl);\r\n        }).then(() => {\r\n            //@ts-ignore\r\n            WebXRExperienceHelper.glInstance = LayaGL.renderEngine.gl;\r\n            return WebXRExperienceHelper.xr_Manager.updateRenderStateAsync({\r\n                depthFar: cameraInfo.depthFar,\r\n                depthNear: cameraInfo.depthNear,\r\n                //@ts-ignore\r\n                baseLayer: new XRWebGLLayer(WebXRExperienceHelper.xr_Manager.session, LayaGL.renderEngine.gl),\r\n            });\r\n        }).then(() => {\r\n            WebXRExperienceHelper.xr_Manager.runXRRenderLoop();\r\n            return WebXRExperienceHelper.xr_Manager;\r\n        });\r\n    }\r\n\r\n    /**\r\n     * config WebXRCameraManager\r\n     * @param camera Camera\r\n     * @param manager WebXRSessionManager\r\n     * @returns \r\n     */\r\n    public static setWebXRCamera(camera: Camera, manager: WebXRSessionManager): WebXRCameraManager {\r\n        return new WebXRCameraManager(camera, manager);\r\n    }\r\n\r\n    /**\r\n     * config WebXRInputManager\r\n     * @param sessionManager WebXRSessionManager\r\n     * @param cameraManager WebXRCameraManager\r\n     * @returns \r\n     */\r\n    public static setWebXRInput(sessionManager: WebXRSessionManager, cameraManager: WebXRCameraManager): WebXRInputManager {\r\n        return new WebXRInputManager(sessionManager, cameraManager);\r\n    }\r\n}","import { Config3D } from \"../../../../Config3D\";\r\nimport { ILaya3D } from \"../../../../ILaya3D\";\r\nimport { Camera, CameraEventFlags } from \"../../core/Camera\";\r\nimport { RenderContext3D } from \"../../core/render/RenderContext3D\";\r\nimport { Scene3D } from \"../../core/scene/Scene3D\";\r\nimport { Cluster } from \"../../graphics/renderPath/Cluster\";\r\nimport { Viewport } from \"../../math/Viewport\";\r\nimport { WebXRCameraManager } from \"./WebXRCameraManager\";\r\nimport { WebXRRenderTexture } from \"./WebXRRenderTexture\";\r\nimport { RenderStateContext } from \"../../../RenderEngine/RenderStateContext\";\r\nimport { WebXRExperienceHelper } from \"./WebXRExperienceHelper\";\r\nimport { Shader3D } from \"../../../RenderEngine/RenderShader/Shader3D\";\r\nimport { RenderTexture } from \"../../../resource/RenderTexture\";\r\n\r\n\r\n/**\r\n * @author miner\r\n * WebXR\r\n */\r\nexport class WebXRCamera extends Camera {\r\n\t/**\r\n\t * @internal\r\n\t */\r\n\tpublic isWebXR = true;\r\n\t/**\r\n\t * WebXRSessionManager\r\n\t */\r\n\tprivate _webXRManager: WebXRCameraManager;\r\n\r\n\t/**\r\n\t * override client\r\n\t */\r\n\tprivate _clientWidth: number;\r\n\t/**\r\n\t * override client\r\n\t */\r\n\tprivate _clientHeight: number;\r\n\r\n\t/**\r\n\t * \r\n\t */\r\n\tget renderTarget(): RenderTexture {\r\n\t\treturn this._internalRenderTexture;\r\n\t}\r\n\r\n\t/**\r\n\t * @internal\r\n\t */\r\n\tset renderTarget(value: RenderTexture) {\r\n\t\tthis._internalRenderTexture = value;\r\n\t}\r\n\r\n\t/**\r\n\t * @internal\r\n\t */\r\n\tset clientWidth(value: number) {\r\n\t\tthis._clientWidth = value;\r\n\t}\r\n\t/**\r\n\t * @internal\r\n\t */\r\n\tset clientHeight(value: number) {\r\n\t\tthis._clientHeight = value;\r\n\t}\r\n\t/**\r\n\t * @internal\r\n\t */\r\n\tget clientWidth(): number {\r\n\t\treturn this._clientWidth;\r\n\t}\r\n\t/**\r\n\t * @internal\r\n\t */\r\n\tget clientHeight(): number {\r\n\t\treturn this._clientHeight;\r\n\t}\r\n\r\n\t/**\r\n\t * restore view state\r\n\t * @internal\r\n\t */\r\n\tprivate _restoreView(gl: WebGLRenderingContext) {\r\n\t\t//\r\n\t\tvar viewport: Viewport = this.viewport;\r\n\t\tvar vpX: number, vpY: number;\r\n\t\tvar vpW: number = viewport.width;\r\n\t\tvar vpH: number = viewport.height;\r\n\t\tif (this._needInternalRenderTexture()) {\r\n\t\t\tvpX = 0;\r\n\t\t\tvpY = 0;\r\n\t\t}\r\n\t\telse {\r\n\t\t\tvpX = viewport.x;\r\n\t\t\tvpY = this._getCanvasHeight() - viewport.y - vpH;\r\n\t\t}\r\n\t\tgl.viewport(vpX, vpY, vpW, vpH);\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t * @override\r\n\t * @param shader \r\n\t * @param replacementTag \r\n\t */\r\n\trender(shader: Shader3D = null, replacementTag: string = null): void {\r\n\t\tif (!this.activeInHierarchy) //custom render should protected with activeInHierarchy=true\r\n\t\t\treturn;\r\n\r\n\t\tvar viewport: Viewport = this.viewport;\r\n\t\tvar needInternalRT: boolean = true;\r\n\t\tvar context: RenderContext3D = RenderContext3D._instance;\r\n\t\tvar scene: Scene3D = context.scene = <Scene3D>this._scene;\r\n\t\tcontext.pipelineMode = context.configPipeLineMode;\r\n\t\tcontext.replaceTag = replacementTag;\r\n\t\tcontext.customShader = shader;\r\n\t\tvar needShadowCasterPass: boolean = this._renderShadowMap(scene, context);\r\n\t\tthis._preRenderMainPass(context, scene, needInternalRT, viewport);\r\n\t\tthis._renderMainPass(context, viewport, scene, shader, replacementTag, needInternalRT);\r\n\t\tthis._aftRenderMainPass(needShadowCasterPass);\r\n\t}\r\n\r\n\t/**\r\n * \r\n * @internal\r\n * @param context \r\n * @param viewport \r\n * @param scene \r\n * @param shader shader\r\n * @param replacementTag \r\n * @param needInternalRT RT\r\n */\r\n\t_renderMainPass(context: RenderContext3D, viewport: Viewport, scene: Scene3D, shader: Shader3D, replacementTag: string, needInternalRT: boolean) {\r\n\t\tvar gl: WebGLRenderingContext = WebXRExperienceHelper.glInstance;\r\n\t\tvar renderTex: RenderTexture = this._internalRenderTexture;\r\n\r\n\t\tcontext.viewport = viewport;\r\n\t\tthis._prepareCameraToRender();\r\n\t\tvar multiLighting: boolean = Config3D._multiLighting;\r\n\t\t(multiLighting) && (Cluster.instance.update(this, <Scene3D>(scene)));\r\n\t\tscene._preCulling(context, this);\r\n\r\n\t\tif (renderTex && renderTex._isCameraTarget)//Y\r\n\t\t\tcontext.invertY = true;\r\n\t\tthis._applyViewProject(context, this.viewMatrix, this._projectionMatrix);\r\n\t\tif (this.depthTextureMode != 0) {\r\n\t\t\t//TODO:\r\n\t\t\tthis._renderDepthMode(context);\r\n\t\t}\r\n\t\t(renderTex) && (renderTex._start());\r\n\t\tif ((renderTex as any).frameLoop != Scene3D._updateMark) {\r\n\t\t\t(renderTex as any).frameLoop = Scene3D._updateMark;\r\n\t\t\t//scene._clear(gl, context);\r\n\t\t\tthis.clear(gl);\r\n\t\t}\r\n\t\tthis._restoreView(gl);\r\n\t\tthis._prepareCameraToRender();\r\n\r\n\t\tthis._applyCommandBuffer(CameraEventFlags.BeforeForwardOpaque, context);\r\n\t\tscene._renderScene(context, ILaya3D.Scene3D.SCENERENDERFLAG_RENDERQPAQUE);\r\n\t\tthis._applyCommandBuffer(CameraEventFlags.BeforeSkyBox, context);\r\n\t\tscene._renderScene(context, ILaya3D.Scene3D.SCENERENDERFLAG_SKYBOX);\r\n\t\tthis._applyCommandBuffer(CameraEventFlags.BeforeTransparent, context);\r\n\t\tscene._renderScene(context, ILaya3D.Scene3D.SCENERENDERFLAG_RENDERTRANSPARENT);\r\n\t\tscene._componentDriver.callPostRender();//TODO:duo\r\n\t\tthis._applyCommandBuffer(CameraEventFlags.BeforeImageEffect, context);\r\n\t\t(renderTex) && (renderTex._end());\r\n\t\t//PostProcess TODO\r\n\t\t// if (needInternalRT) {\r\n\t\t// \tif (this._postProcess && this._postProcess.enable) {\r\n\t\t// \t\tthis._postProcess.commandContext = context;\r\n\t\t// \t\tthis._postProcess._render();\r\n\t\t// \t\tthis._postProcess._applyPostProcessCommandBuffers();\r\n\t\t// \t} else if (this._enableHDR || this._needBuiltInRenderTexture) {\r\n\t\t// \t\tvar canvasWidth: number = this._getCanvasWidth(), canvasHeight: number = this._getCanvasHeight();\r\n\t\t// \t\tif (this._offScreenRenderTexture) {\r\n\t\t// \t\t\tthis._screenOffsetScale.setValue(viewport.x / canvasWidth, viewport.y / canvasHeight, viewport.width / canvasWidth, viewport.height / canvasHeight);\r\n\t\t// \t\t\tthis._internalCommandBuffer._camera = this;\r\n\t\t// \t\t\tthis._internalCommandBuffer._context = context;\r\n\t\t// \t\t\tthis._internalCommandBuffer.blitScreenQuad(this._internalRenderTexture, this._offScreenRenderTexture, this._screenOffsetScale, null, null, 0, true);\r\n\t\t// \t\t\tthis._internalCommandBuffer._apply();\r\n\t\t// \t\t\tthis._internalCommandBuffer.clear();\r\n\t\t// \t\t}\r\n\t\t// \t}\r\n\t\t// \tRenderTexture.bindCanvasRender = this._internalRenderTexture;\r\n\t\t// \t//RenderTexture.recoverToPool(this._internalRenderTexture);\r\n\t\t// } else {\r\n\t\t// \tRenderTexture.bindCanvasRender = null;\r\n\t\t// }\r\n\t\tthis._applyCommandBuffer(CameraEventFlags.AfterEveryThing, context);\r\n\t}\r\n\r\n\t/**\r\n\t * null function\r\n\t */\r\n\tprotected _calculateProjectionMatrix(): void {\r\n\t}\r\n\r\n\t/**\r\n\t * @internal\r\n\t */\r\n\tclear(gl: WebGLRenderingContext) {\r\n\t\tgl.viewport(0, 0, this._clientWidth, this._clientHeight);\r\n\t\tgl.scissor(0, 0, this._clientWidth, this._clientHeight);\r\n\t\tgl.clearColor(this.clearColor.r, this.clearColor.g, this.clearColor.b, this.clearColor.a);\r\n\t\tRenderStateContext.setDepthMask(true);\r\n\t\tgl.clear(gl.COLOR_BUFFER_BIT | gl.DEPTH_BUFFER_BIT);\r\n\t}\r\n\r\n\t/**\r\n\t * destroy\r\n\t */\r\n\tdestroy() {\r\n\t\tsuper.destroy(true);\r\n\t}\r\n}\r\n\r\n\r\n","import { Script } from \"../../components/Script\";\r\n\r\n/**\r\n * 2.0Script\r\n */\r\nexport var Script3D = Script;\r\nexport type Script3D = Script;\r\n","import { ShaderData, ShaderDataType } from \"../../../RenderEngine/RenderShader/ShaderData\";\r\nimport { Matrix4x4 } from \"../../../maths/Matrix4x4\";\r\nimport { MeshFilter } from \"../../core/MeshFilter\";\r\nimport { RenderableSprite3D } from \"../../core/RenderableSprite3D\";\r\nimport { Sprite3D } from \"../../core/Sprite3D\";\r\nimport { Transform3D } from \"../../core/Transform3D\";\r\nimport { BaseRender } from \"../../core/render/BaseRender\";\r\nimport { RenderContext3D } from \"../../core/render/RenderContext3D\";\r\nimport { RenderElement } from \"../../core/render/RenderElement\";\r\nimport { BoundFrustum } from \"../../math/BoundFrustum\";\r\nimport { Bounds } from \"../../math/Bounds\";\r\nimport { MeshUtil } from \"../../resource/models/MeshUtil\";\r\nimport { HLODBatchMesh } from \"./HLODBatchMesh\";\r\nimport { HLODElement } from \"./HLODUtil\";\r\n\r\nexport class HLODRender extends BaseRender {\r\n\r\n    /**@internal */\r\n    _singleton: boolean;\r\n\r\n    /**@internal */\r\n    _curHLODRS: HLODElement;\r\n\r\n    /**@internal */\r\n    _curSubBatchMeshBounds: Bounds[];\r\n\r\n    constructor() {\r\n        super();\r\n        this._singleton = false;\r\n\r\n    }\r\n\r\n    /**\r\n     * set HLOD element\r\n     */\r\n    get curHLODRS() {\r\n        return this._curHLODRS;\r\n    }\r\n\r\n    set curHLODRS(value: HLODElement) {\r\n        if (!this._curHLODRS) {\r\n            this._renderElements = [];\r\n            this._renderElements.push(new RenderElement());\r\n            this._renderElements[0].render = this;\r\n        }\r\n        if (value != this._curHLODRS) {\r\n            this._changeMesh(value.HLODMesh);\r\n            this._curHLODRS = value;//\r\n            this._createRenderelementByHLODElement(this._curHLODRS, this._renderElements[0]);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * LOD\r\n     * @param source \r\n     * @returns \r\n     */\r\n    private _createRenderelementByHLODElement(source: HLODElement, out: RenderElement) {\r\n        out.setGeometry(source.HLODMesh);\r\n        out.material = source.material;\r\n    }\r\n\r\n    /**\r\n     * change Render Mesh\r\n     */\r\n    private _changeMesh(lodMesh: HLODBatchMesh) {\r\n        var defineDatas: ShaderData = this._shaderValues;\r\n        this.boundsChange = true;\r\n        let meshDefines = MeshFilter._meshVerticeDefine;\r\n        if (this.curHLODRS) {\r\n            MeshUtil.getMeshDefine(this.curHLODRS.HLODMesh.batchMesh, meshDefines);\r\n            for (var i: number = 0, n: number = meshDefines.length; i < n; i++)\r\n                defineDatas.removeDefine(MeshFilter._meshVerticeDefine[i]);\r\n        }\r\n        if (lodMesh) {\r\n            MeshUtil.getMeshDefine(lodMesh.batchMesh, meshDefines);\r\n            for (var i: number = 0, n: number = MeshFilter._meshVerticeDefine.length; i < n; i++)\r\n                defineDatas.addDefine(MeshFilter._meshVerticeDefine[i]);\r\n        }\r\n        //update submesh Bounds\r\n        this._curSubBatchMeshBounds.length = lodMesh.batchSubMeshInfo.length;\r\n        for (let i = 0, n = lodMesh.batchSubMeshInfo.length; i < n; i++) {\r\n            this._curSubBatchMeshBounds[i] = this._curSubBatchMeshBounds[i] ? this._curSubBatchMeshBounds[i] : new Bounds();\r\n        }\r\n\r\n    }\r\n\r\n    /**\r\n     * @override\r\n     * @internal\r\n     * \r\n     */\r\n    _applyLightMapParams() {\r\n        if (!this._scene) return;\r\n        var shaderValues = this._shaderValues;\r\n        var lightMap = this._curHLODRS.lightmap;\r\n        if (lightMap && lightMap.lightmapColor) {\r\n            shaderValues.setTexture(RenderableSprite3D.LIGHTMAP, lightMap.lightmapColor);\r\n            shaderValues.addDefine(RenderableSprite3D.SAHDERDEFINE_LIGHTMAP);\r\n            if (lightMap.lightmapDirection) {\r\n                shaderValues.setTexture(RenderableSprite3D.LIGHTMAP_DIRECTION, lightMap.lightmapDirection);\r\n                shaderValues.addDefine(RenderableSprite3D.SHADERDEFINE_LIGHTMAP_DIRECTIONAL);\r\n            }\r\n            else {\r\n                shaderValues.removeDefine(RenderableSprite3D.SHADERDEFINE_LIGHTMAP_DIRECTIONAL);\r\n            }\r\n        } else {\r\n            shaderValues.removeDefine(RenderableSprite3D.SAHDERDEFINE_LIGHTMAP);\r\n            shaderValues.removeDefine(RenderableSprite3D.SHADERDEFINE_LIGHTMAP_DIRECTIONAL);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * re caculate BoundBox\r\n     */\r\n    _calculateBoundingBox() {\r\n        // todo \r\n        if (this._curHLODRS) {\r\n            var sharedMesh: HLODBatchMesh = this._curHLODRS.HLODMesh;\r\n            if (sharedMesh) {\r\n                var worldMat: Matrix4x4 = this._transform.worldMatrix;\r\n                sharedMesh.batchMesh.bounds._tranform(worldMat, this._bounds);\r\n            }\r\n            //Update \r\n            for (let i = 0, n = this._curSubBatchMeshBounds.length; i < n; i++) {\r\n                sharedMesh.batchSubMeshInfo[i].bounds._tranform(worldMat, this._curSubBatchMeshBounds[i]);\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * update data\r\n     * @param context \r\n     * @param transform \r\n     */\r\n    _renderUpdate(context: RenderContext3D, transform: Transform3D): void {\r\n        this._applyLightMapParams();\r\n        // // todo ,  worldmatrix\r\n        this._setShaderValue(Sprite3D.WORLDMATRIX, ShaderDataType.Matrix4x4, this._transform.worldMatrix);\r\n    }\r\n\r\n    _needRender(boundFrustum: BoundFrustum, context: RenderContext3D): boolean {\r\n        if (boundFrustum){\r\n            if(boundFrustum.intersects(this.bounds)){\r\n                let hodMesh = this.curHLODRS.HLODMesh.drawSubMeshs;\r\n                let lodbatchMesh =this._curHLODRS.HLODMesh.batchSubMeshInfo;\r\n                hodMesh.length = 0;\r\n                for(let i = 0,n = this._curSubBatchMeshBounds.length;i<n;i++){\r\n                    if(boundFrustum.intersects(this._curSubBatchMeshBounds[i])){\r\n                        hodMesh.push(lodbatchMesh[i]);\r\n                    }\r\n                }\r\n                //sort TODO\r\n                // let position = context.camera.transform.position;\r\n                // let oriPisition = (this.owner as Sprite3D)\r\n                // hodMesh = hodMesh.sort((a,b)=>{\r\n                    \r\n                //     return 10;\r\n                // });\r\n                this._curHLODRS.HLODMesh.drawSubMeshs = hodMesh;\r\n                return true;\r\n            }\r\n            else\r\n                return false\r\n        }else{\r\n            return true;\r\n        }\r\n    }\r\n\r\n    onEnable() {\r\n        super.onEnable();\r\n    }\r\n\r\n    onDisable() {\r\n        super.onDisable();\r\n    }\r\n\r\n    onDestroy() {\r\n        super.onDestroy();\r\n        this._renderElements.forEach(element => {\r\n            element.material._removeReference();\r\n            element.destroy();\r\n        });\r\n        this._renderElements = null;\r\n    }\r\n\r\n    _cloneTo(dest: HLODRender) {\r\n        //TODO\r\n    }\r\n}","import { Component } from \"../../../components/Component\";\r\nimport { Vector3 } from \"../../../maths/Vector3\";\r\nimport { Camera } from \"../../core/Camera\";\r\nimport { Sprite3D } from \"../../core/Sprite3D\";\r\nimport { Scene3D } from \"../../core/scene/Scene3D\";\r\nimport { Bounds } from \"../../math/Bounds\";\r\nimport { HLODRender } from \"./HLODRender\";\r\nimport { HLODConfig, HLODResourceGroup } from \"./HLODUtil\";\r\n\r\nconst tempVec = new Vector3();\r\n\r\nexport class HLOD extends Component {\r\n    /**@internal */\r\n    _resourceList: HLODResourceGroup[];\r\n    /**@internal */\r\n    _curLODSource: HLODResourceGroup;\r\n    /**@internal */\r\n    _bounds: Bounds;\r\n    /**@internal */\r\n    _curRender: HLODRender[];\r\n    /**@internal TODO*/\r\n    //_crossRender: HLODRender[];\r\n    /**@internal TODO*/\r\n    //_renderMode:\r\n    /**@internal TODO*/\r\n    //cacheRender:HLODRender[];\r\n    /**@internal */\r\n    _HLODConfig: HLODConfig;\r\n    /**@internal */\r\n    private _lodRateArray: number[];\r\n    /**@internal */\r\n    private _size: number;\r\n\r\n    \r\n    constructor() {\r\n        super();\r\n        this._singleton = true;\r\n    }\r\n\r\n    /**\r\n     * IDE\r\n     */\r\n    get bounds() {\r\n        return this._bounds;\r\n    }\r\n\r\n    set bounds(value: Bounds) {\r\n        this._bounds = value;\r\n        this.recalculateBounds();\r\n    }\r\n\r\n    /**\r\n     * IDE\r\n     */\r\n    get lodResource() {\r\n        return this._resourceList;\r\n    }\r\n    set lodResource(value: HLODResourceGroup[]) {\r\n        this._resourceList = value;\r\n    }\r\n\r\n\r\n    /**\r\n     * lod\r\n     */\r\n    set lodCullRateArray(value: number[]) {\r\n        value.sort((a, b) => b - a);\r\n        this._lodRateArray = value;\r\n    }\r\n\r\n    get lodCullRateArray() {\r\n        return this._lodRateArray;\r\n    }\r\n\r\n    private _applyLODResource(resource: HLODResourceGroup) {\r\n        this._curLODSource = resource;\r\n        let element = resource.resources;\r\n        for (let i = 0, n = element.length; i < n; i++) {\r\n            let hlodRender = this.owner.addComponent(HLODRender);\r\n            this._curRender.push(hlodRender);\r\n            hlodRender.curHLODRS = element[i];\r\n        }\r\n    }\r\n\r\n    private _releaseGroupRender() {\r\n        this._curRender.forEach(element => {\r\n            element.destroy();\r\n        });\r\n        this._curRender = [];\r\n    }\r\n\r\n\r\n    /**\r\n     * @internal\r\n     * \r\n     */\r\n    recalculateBounds() {\r\n        //Bounds\r\n        let extend = this._bounds.getExtent();\r\n        this._size = 2 * Math.max(extend.x, extend.y, extend.z);\r\n    }\r\n\r\n    /**\r\n    * @internal\r\n    * \r\n    */\r\n    onPreRender() {\r\n        // this.recalculateBounds();\r\n        // //\r\n        let checkCamera = (this.owner.scene as Scene3D).cullInfoCamera as Camera;\r\n        let maxYDistance = checkCamera.maxlocalYDistance;\r\n        let cameraFrustum = checkCamera.boundFrustum;\r\n        Vector3.subtract((this.owner as Sprite3D).transform.position, checkCamera.transform.position, tempVec);\r\n        //farplane,.lod\r\n        let length = tempVec.length();\r\n        if (length > checkCamera.farPlane || cameraFrustum.containsPoint((this.owner as Sprite3D).transform.position) == 0) {\r\n            return;\r\n        }\r\n        let rateYDistance = length / checkCamera.farPlane * maxYDistance;\r\n        let rate = (this._size / rateYDistance);\r\n        for (let i = 0; i < this._lodRateArray.length; i++) {\r\n            if (rate < this._lodRateArray[i])\r\n                continue;\r\n            this.applyResource(this._resourceList[i]);\r\n            break;\r\n        }\r\n    }\r\n\r\n    onUpdate(): void {\r\n        this._curLODSource.updateMark = Camera._updateMark;\r\n        //GC TODO\r\n\r\n    }\r\n\r\n    applyResource(resource: HLODResourceGroup) {\r\n        if (resource == this._curLODSource)\r\n            return;\r\n        if (resource.loaded) {\r\n            if (this._curLODSource) {\r\n                //Cache TODO\r\n                //Cross fade Render \r\n                this._releaseGroupRender();\r\n                this._applyLODResource(resource);\r\n\r\n            }\r\n        } else {\r\n            resource.load(this.applyResource, this);\r\n        }\r\n    }\r\n\r\n    onEnable() {\r\n        super.onEnable();\r\n        //\r\n    }\r\n\r\n    onDisable() {\r\n        super.onDisable();\r\n    }\r\n\r\n    onDestroy() {\r\n        super.onDestroy();\r\n        //TODO\r\n    }\r\n\r\n    _cloneTo(dest: HLOD) {\r\n        //Clone to\r\n        throw \"cant clone HLOD\"\r\n    }\r\n}","import { Vector3 } from \"../../../maths/Vector3\";\r\nimport { DrawType } from \"../../../RenderEngine/RenderEnum/DrawType\";\r\nimport { MeshTopology } from \"../../../RenderEngine/RenderEnum/RenderPologyMode\";\r\nimport { GeometryElement } from \"../../core/GeometryElement\";\r\nimport { RenderContext3D } from \"../../core/render/RenderContext3D\";\r\nimport { Bounds } from \"../../math/Bounds\";\r\n\r\n\r\nexport class StaticBatchSubInfo {\r\n\r\n    indexStart: number;\r\n    indexCount: number;\r\n\r\n    meshBounds: Bounds;\r\n\r\n    needRender: boolean;\r\n\r\n    constructor() {\r\n        this.indexStart = 0;\r\n        this.indexCount = 0;\r\n        this.meshBounds = new Bounds(new Vector3(), new Vector3());\r\n        this.needRender = false;\r\n    }\r\n\r\n}\r\n\r\nexport class StaticBatchSubMesh extends GeometryElement {\r\n\r\n    /**@internal */\r\n    private static _type: number = GeometryElement._typeCounter++;\r\n\r\n    subInfos: StaticBatchSubInfo[];\r\n\r\n    indexByteCount: number;\r\n\r\n    constructor() {\r\n        super(MeshTopology.Triangles, DrawType.DrawElement);\r\n        this.subInfos = [];\r\n    }\r\n\r\n    addSubMesh(indexCount: number, indexStart: number, bounds: Bounds) {\r\n\r\n        let info = new StaticBatchSubInfo();\r\n        info.indexCount = indexCount;\r\n        info.indexStart = indexStart;\r\n        bounds.cloneTo(info.meshBounds);\r\n\r\n        this.subInfos.push(info);\r\n    }\r\n\r\n    _getType(): number {\r\n        return StaticBatchSubMesh._type;\r\n    }\r\n\r\n    _updateRenderParams(state: RenderContext3D): void {\r\n\r\n        this.clearRenderParams();\r\n        // todo\r\n        let cameraPos = state.camera.transform.position;\r\n        this.subInfos.sort((a, b) => {\r\n            let centerA = a.meshBounds.getCenter();\r\n            let distanceA = Vector3.distanceSquared(centerA, cameraPos);\r\n            let centerB = b.meshBounds.getCenter();\r\n            let distanceB = Vector3.distanceSquared(centerB, cameraPos);\r\n            return distanceA - distanceB;\r\n        });\r\n        for (const info of this.subInfos) {\r\n            if (info.needRender) {\r\n                this.setDrawElemenParams(info.indexCount, info.indexStart * this.indexByteCount);\r\n            }\r\n        }\r\n\r\n    }\r\n\r\n    _prepareRender(state: RenderContext3D): boolean {\r\n        return !!this.subInfos.find(info => info.needRender);\r\n    }\r\n\r\n    destroy() {\r\n        for (const info of this.subInfos) {\r\n        }\r\n        this.subInfos = null;\r\n    }\r\n}","import { Matrix4x4 } from \"../../../maths/Matrix4x4\";\r\nimport { BufferUsage } from \"../../../RenderEngine/RenderEnum/BufferTargetType\";\r\nimport { IndexFormat } from \"../../../RenderEngine/RenderEnum/IndexFormat\";\r\nimport { VertexMesh } from \"../../../RenderEngine/RenderShader/VertexMesh\";\r\nimport { BufferState } from \"../../../webgl/utils/BufferState\";\r\nimport { BlinnPhongMaterial } from \"../../core/material/BlinnPhongMaterial\";\r\nimport { Material } from \"../../../resource/Material\";\r\nimport { Sprite3D } from \"../../core/Sprite3D\";\r\nimport { IndexBuffer3D } from \"../../graphics/IndexBuffer3D\";\r\nimport { VertexBuffer3D } from \"../../graphics/VertexBuffer3D\";\r\nimport { Bounds } from \"../../math/Bounds\";\r\nimport { Laya3DRender } from \"../../RenderObjs/Laya3DRender\";\r\nimport { Utils3D } from \"../../utils/Utils3D\";\r\nimport { StaticBatchSubMesh } from \"./StaticBatchSubMesh\";\r\nimport { StaticMeshMergeInfo } from \"./StaticMeshMergeInfo\";\r\n\r\n\r\nconst tempMatrix = new Matrix4x4;\r\n\r\nconst TriangleIndices = [0, 1, 2];\r\nconst InvertTriangleIndices = [0, 2, 1];\r\n\r\n\r\nexport class StaticBatchMesh {\r\n\r\n    static create(info: StaticMeshMergeInfo): StaticBatchMesh {\r\n        let staticMesh = new StaticBatchMesh();\r\n\r\n        let vertexCount = info.vertexCount;\r\n        let indexCount = info.indexCount;\r\n        let vertexDec = info.vertexDec;\r\n        let vertexFloatStride = vertexDec.vertexStride / 4;\r\n        let vertexData = new ArrayBuffer(vertexDec.vertexStride * vertexCount);\r\n        let vertexFloatArray = new Float32Array(vertexData);\r\n\r\n        let mergeIndexFormat = IndexFormat.UInt16;\r\n        let mergeIndexByteCount = 2;\r\n\r\n        let indexArray: Uint16Array | Uint32Array;\r\n\r\n        if (vertexCount > 65535) {\r\n            mergeIndexFormat = IndexFormat.UInt32;\r\n            mergeIndexByteCount = 4;\r\n            indexArray = new Uint32Array(indexCount);\r\n        }\r\n        else {\r\n            indexArray = new Uint16Array(indexCount);\r\n        }\r\n\r\n        let positionElement = vertexDec.getVertexElementByUsage(VertexMesh.MESH_POSITION0);\r\n        let normalElement = vertexDec.getVertexElementByUsage(VertexMesh.MESH_NORMAL0);\r\n        let lightmapUVElement = vertexDec.getVertexElementByUsage(VertexMesh.MESH_TEXTURECOORDINATE1);\r\n        let tangentElement = vertexDec.getVertexElementByUsage(VertexMesh.MESH_TANGENT0);\r\n\r\n        let vertexDataOffset = 0;\r\n        let vertexCountOffset = 0;\r\n        let indexOffset = 0;\r\n\r\n        let bounds: Bounds;\r\n\r\n        for (const render of info.renders) {\r\n            let lightmapScaleOffset = render.lightmapScaleOffset;\r\n\r\n            if (!bounds) {\r\n                bounds = staticMesh.bounds;\r\n                render.bounds.cloneTo(bounds);\r\n            }\r\n\r\n            Bounds.merge(bounds, render.bounds, bounds);\r\n\r\n            let sp = <Sprite3D>render.owner;\r\n            let invertFront = sp.transform._isFrontFaceInvert;\r\n            let worldMat = sp.transform.worldMatrix;\r\n            let normalMat = tempMatrix;\r\n            worldMat.invert(normalMat);\r\n            normalMat.transpose();\r\n\r\n            let mesh = render.getMesh();\r\n            let meshVertexCount = mesh.vertexCount;\r\n            let meshIndexCount = mesh.indexCount;\r\n\r\n            // todo \r\n            // todo \r\n            let meshVertexData = mesh._vertexBuffer.getFloat32Data();\r\n            vertexFloatArray.set(meshVertexData, vertexDataOffset);\r\n\r\n            // todo  vertex element \r\n            for (let index = 0; index < meshVertexCount; index++) {\r\n                let elementOffset = index * vertexFloatStride;\r\n                for (const element of vertexDec._vertexElements) {\r\n                    elementOffset += element.offset / 4;\r\n                    switch (element.elementUsage) {\r\n                        case VertexMesh.MESH_POSITION0:\r\n                            Utils3D.transformVector3ArrayToVector3ArrayCoordinate(meshVertexData, elementOffset, worldMat, vertexFloatArray, vertexDataOffset + elementOffset);\r\n                            break;\r\n                        case VertexMesh.MESH_NORMAL0:\r\n                        case VertexMesh.MESH_TANGENT0:\r\n                            Utils3D.transformVector3ArrayToVector3ArrayNormal(meshVertexData, elementOffset, normalMat, vertexFloatArray, vertexDataOffset + elementOffset);\r\n                            break;\r\n                        case VertexMesh.MESH_TEXTURECOORDINATE1:\r\n                            Utils3D.transformLightingMapTexcoordArray(meshVertexData, elementOffset, lightmapScaleOffset, vertexFloatArray, vertexDataOffset + elementOffset);\r\n                            break;\r\n                    }\r\n                }\r\n            }\r\n\r\n            let meshIndexData = mesh._indexBuffer.getData();\r\n            // todo \r\n            let triangleIndices = invertFront ? InvertTriangleIndices : TriangleIndices;\r\n            for (let index = 0; index < meshIndexCount; index += 3) {\r\n                indexArray[indexOffset + index] = meshIndexData[index + triangleIndices[0]] + vertexCountOffset;\r\n                indexArray[indexOffset + index + 1] = meshIndexData[index + triangleIndices[1]] + vertexCountOffset;\r\n                indexArray[indexOffset + index + 2] = meshIndexData[index + triangleIndices[2]] + vertexCountOffset;\r\n            }\r\n\r\n            let subMeshCount = mesh.subMeshCount;\r\n\r\n            for (let index = 0; index < subMeshCount; index++) {\r\n                // todo default material\r\n                let material = render.sharedMaterials[index] || BlinnPhongMaterial.defaultMaterial;\r\n                let staticSubMesh = staticMesh._staticSubMeshes.get(material);\r\n                if (!staticSubMesh) {\r\n                    staticSubMesh = new StaticBatchSubMesh();\r\n                    staticSubMesh.indexByteCount = mergeIndexByteCount;\r\n                    staticMesh._staticSubMeshes.set(material, staticSubMesh);\r\n                    staticSubMesh.bufferState = staticMesh._bufferState;\r\n                    staticSubMesh.indexFormat = mergeIndexFormat;\r\n                }\r\n\r\n                let subMesh = mesh.getSubMesh(index);\r\n                // submesh bounds  mesh bounds \r\n                // mesh\r\n                // todo  \r\n                staticSubMesh.addSubMesh(subMesh.indexCount, subMesh._indexStart + indexOffset, render.bounds);\r\n            }\r\n\r\n            vertexDataOffset += meshVertexData.length;\r\n            vertexCountOffset += meshVertexCount;\r\n            indexOffset += meshIndexData.length;\r\n        }\r\n\r\n        let vertexBuffer = Laya3DRender.renderOBJCreate.createVertexBuffer3D(vertexData.byteLength, BufferUsage.Static, false);\r\n        vertexBuffer.vertexDeclaration = vertexDec;\r\n        vertexBuffer.setData(vertexData);\r\n\r\n        let indexBuffer = Laya3DRender.renderOBJCreate.createIndexBuffer3D(mergeIndexFormat, indexCount, BufferUsage.Static, false);\r\n        indexBuffer.setData(indexArray);\r\n\r\n        staticMesh.setBuffer(vertexBuffer, indexBuffer);\r\n\r\n        return staticMesh;\r\n    }\r\n    /**@internal */\r\n    _bufferState: BufferState;\r\n    /**@internal */\r\n    _vertexBuffer: VertexBuffer3D;\r\n    /**@internal */\r\n    _indexBuffer: IndexBuffer3D;\r\n    /**@internal */\r\n    _staticSubMeshes: Map<Material, StaticBatchSubMesh>;\r\n\r\n    bounds: Bounds;\r\n\r\n    constructor() {\r\n        this._bufferState = new BufferState();\r\n        this._staticSubMeshes = new Map();\r\n        this.bounds = new Bounds();\r\n    }\r\n\r\n    setBuffer(vertex: VertexBuffer3D, index: IndexBuffer3D) {\r\n        let bufferState = this._bufferState;\r\n\r\n        this._vertexBuffer = vertex;\r\n        this._indexBuffer = index;\r\n\r\n        bufferState.applyState([vertex], index);\r\n    }\r\n\r\n    destroy() {\r\n        this._staticSubMeshes.forEach(submesh => {\r\n            submesh.destroy();\r\n        });\r\n        this._staticSubMeshes.clear();\r\n        this._staticSubMeshes = null;\r\n        this._bufferState.destroy();\r\n    }\r\n\r\n\r\n}","import { RenderElement } from \"../../core/render/RenderElement\";\r\n\r\n/**\r\n * @internal\r\n */\r\nexport class StaticBatchMeshRenderElement extends RenderElement {\r\n\r\n    constructor() {\r\n        super();\r\n    }\r\n\r\n    getInvertFront(): boolean {\r\n        return false;\r\n    }\r\n\r\n}","import { Matrix4x4 } from \"../../../maths/Matrix4x4\";\r\nimport { Vector4 } from \"../../../maths/Vector4\";\r\nimport { ShaderDataType } from \"../../../RenderEngine/RenderShader/ShaderData\";\r\nimport { ShaderDefine } from \"../../../RenderEngine/RenderShader/ShaderDefine\";\r\nimport { VertexMesh } from \"../../../RenderEngine/RenderShader/VertexMesh\";\r\nimport { MeshFilter } from \"../../core/MeshFilter\";\r\nimport { MeshSprite3DShaderDeclaration } from \"../../core/MeshSprite3DShaderDeclaration\";\r\nimport { BaseRender, RenderBitFlag } from \"../../core/render/BaseRender\";\r\nimport { RenderContext3D } from \"../../core/render/RenderContext3D\";\r\nimport { Sprite3D } from \"../../core/Sprite3D\";\r\nimport { Transform3D } from \"../../core/Transform3D\";\r\nimport { BoundFrustum } from \"../../math/BoundFrustum\";\r\nimport { StaticBatchMesh } from \"./StaticBatchMesh\";\r\nimport { StaticBatchMeshRenderElement } from \"./StaticBatchMeshRenderElement\";\r\nimport { StaticMeshMergeInfo } from \"./StaticMeshMergeInfo\";\r\n\r\nexport class StaticBatchMeshRender extends BaseRender {\r\n\r\n    static create(info: StaticMeshMergeInfo): StaticBatchMeshRender {\r\n\r\n        let render = new StaticBatchMeshRender();\r\n\r\n        render.mergeInfo = info;\r\n\r\n        return render;\r\n    }\r\n\r\n    private _staticMesh: StaticBatchMesh;\r\n    public get staticMesh(): StaticBatchMesh {\r\n        return this._staticMesh;\r\n    }\r\n\r\n    private _mergeInfo: StaticMeshMergeInfo;\r\n\r\n    public get mergeInfo(): StaticMeshMergeInfo {\r\n        return this._mergeInfo;\r\n    }\r\n    public set mergeInfo(value: StaticMeshMergeInfo) {\r\n        this._mergeInfo = value;\r\n\r\n        let staticMesh = StaticBatchMesh.create(value);\r\n        this._staticMesh = staticMesh;\r\n        this.lightmapIndex = value.lightmapIndex;\r\n\r\n        this._staticMesh = staticMesh;\r\n        this.geometryBounds = staticMesh.bounds;\r\n        let meshDefines = MeshFilter._meshVerticeDefine;\r\n        let defineDatas = this._shaderValues;\r\n        this._getMeshDefine(staticMesh, meshDefines);\r\n\r\n        for (const meshDef of meshDefines) {\r\n            defineDatas.addDefine(meshDef);\r\n        }\r\n\r\n        this._renderElements.forEach(element => {\r\n            element.material._removeReference();\r\n            element.destroy();\r\n        })\r\n\r\n        this._renderElements = [];\r\n\r\n        staticMesh._staticSubMeshes.forEach((subMesh, material) => {\r\n            let element = new StaticBatchMeshRenderElement();\r\n            this._renderElements.push(element);\r\n            element.render = this;\r\n            element.material = material;\r\n            element.setGeometry(subMesh);\r\n\r\n            material._addReference();\r\n        });\r\n\r\n        staticMesh.bounds.cloneTo(this.bounds);\r\n\r\n    }\r\n\r\n    _singleton: boolean;\r\n\r\n    private constructor() {\r\n        super();\r\n        this._singleton = false;\r\n    }\r\n\r\n    _calculateBoundingBox() {\r\n        // todo \r\n        // this._bounds.setCenter(Vector3.ZERO);\r\n        // this._bounds.setExtent(Vector3.ONE);\r\n    }\r\n\r\n    _renderUpdate(context: RenderContext3D, transform: Transform3D): void {\r\n        this._applyLightMapParams();\r\n        // todo ,  worldmatrix\r\n        this._setShaderValue(Sprite3D.WORLDMATRIX, ShaderDataType.Matrix4x4, Matrix4x4.DEFAULT);\r\n        this._worldParams.x = 1.0;\r\n        this._setShaderValue(Sprite3D.WORLDINVERTFRONT, ShaderDataType.Vector4, this._worldParams);//TODO\r\n    }\r\n\r\n    _getMeshDefine(mesh: StaticBatchMesh, out: Array<ShaderDefine>) {\r\n        let vertexElements = mesh._vertexBuffer.vertexDeclaration._vertexElements;\r\n        for (const element of vertexElements) {\r\n            switch (element.elementUsage) {\r\n                case VertexMesh.MESH_COLOR0:\r\n                    out.push(MeshSprite3DShaderDeclaration.SHADERDEFINE_COLOR);\r\n                    break;\r\n                case VertexMesh.MESH_TEXTURECOORDINATE0:\r\n                    out.push(MeshSprite3DShaderDeclaration.SHADERDEFINE_UV0);\r\n                    break;\r\n                case VertexMesh.MESH_TEXTURECOORDINATE1:\r\n                    out.push(MeshSprite3DShaderDeclaration.SHADERDEFINE_UV1);\r\n                    break;\r\n                case VertexMesh.MESH_TANGENT0:\r\n                    out.push(MeshSprite3DShaderDeclaration.SHADERDEFINE_TANGENT);\r\n                    break;\r\n            }\r\n        }\r\n    }\r\n\r\n    _needRender(boundFrustum: BoundFrustum, context: RenderContext3D): boolean {\r\n        if (boundFrustum) {\r\n            if (boundFrustum.intersects(this.bounds)) {\r\n                let needRender = false;\r\n                this.staticMesh._staticSubMeshes.forEach(subMesh => {\r\n                    for (const info of subMesh.subInfos) {\r\n                        info.needRender = boundFrustum.intersects(info.meshBounds);\r\n                        needRender = needRender || info.needRender;\r\n                    }\r\n                });\r\n                return needRender;\r\n            }\r\n            return false;\r\n        }\r\n        else {\r\n            return true;\r\n        }\r\n    }\r\n\r\n    onEnable() {\r\n        super.onEnable();\r\n        this.mergeInfo.renders.forEach(render => {\r\n            render.setRenderbitFlag(RenderBitFlag.RenderBitFlag_Batch, true);\r\n        });\r\n\r\n    }\r\n\r\n    onDisable() {\r\n        super.onDisable();\r\n        this.mergeInfo.renders.forEach(render => {\r\n            render.setRenderbitFlag(RenderBitFlag.RenderBitFlag_Batch, false);\r\n        });\r\n    }\r\n\r\n    onDestroy() {\r\n        super.onDestroy();\r\n        this._renderElements.forEach(element => {\r\n            element.material._removeReference();\r\n            element.destroy();\r\n        });\r\n        this._renderElements = null;\r\n        this._staticMesh.destroy();\r\n        this._staticMesh = null;\r\n    }\r\n\r\n    _cloneTo(dest: StaticBatchMeshRender) {\r\n        dest.mergeInfo = this.mergeInfo;\r\n    }\r\n}","import { VertexDeclaration } from \"../../../RenderEngine/VertexDeclaration\";\r\nimport { MeshRenderer } from \"../../core/MeshRenderer\";\r\nimport { Sprite3D } from \"../../core/Sprite3D\";\r\n\r\nexport class StaticMeshMergeInfo {\r\n\r\n    static create(render: MeshRenderer) {\r\n\r\n        let mesh = render.getMesh();\r\n        let owner = <Sprite3D>render.owner;\r\n\r\n        let info = new StaticMeshMergeInfo();\r\n        info.lightmapIndex = render.lightmapIndex;\r\n        info.receiveShadow = render.receiveShadow;\r\n        info.vertexDec = mesh ? mesh.getVertexDeclaration() : null;\r\n        // info.invertFrontFace = owner ? owner.transform._isFrontFaceInvert : false;\r\n        return info;\r\n    }\r\n\r\n    /**\r\n     * receiveShadow\r\n     */\r\n    receiveShadow: boolean;\r\n    \r\n    /**\r\n     * \r\n     */\r\n    lightmapIndex: number;\r\n\r\n    /**\r\n     * \r\n     */\r\n    vertexDec: VertexDeclaration;\r\n\r\n    private _renders: MeshRenderer[];\r\n    public get renders(): MeshRenderer[] {\r\n        return this._renders;\r\n    }\r\n\r\n    vertexCount: number;\r\n    indexCount: number;\r\n\r\n    private constructor() {\r\n        this._renders = [];\r\n        this.vertexCount = 0;\r\n        this.indexCount = 0;\r\n    }\r\n\r\n    match(render: MeshRenderer): boolean {\r\n\r\n        let mesh = render.getMesh();\r\n        let owner = <Sprite3D>render.owner;\r\n\r\n        let match = true;\r\n\r\n        match = match && this.lightmapIndex == render.lightmapIndex;\r\n        match = match && this.receiveShadow == render.receiveShadow;\r\n        match = match && this.vertexDec == mesh.getVertexDeclaration();\r\n        // match = match && this.invertFrontFace == owner.transform._isFrontFaceInvert;\r\n        return match;\r\n    }\r\n\r\n    addElement(render: MeshRenderer) {\r\n        this.renders.push(render);\r\n        let mesh = render.getMesh();\r\n        this.vertexCount += mesh.vertexCount;\r\n        this.indexCount += mesh.indexCount;\r\n    }\r\n\r\n    destroy() {\r\n        this._renders = null;\r\n    }\r\n}","import { Shader3D } from \"../../RenderEngine/RenderShader/Shader3D\";\r\nimport { SubUniformBufferData } from \"../../RenderEngine/SubUniformBufferData\";\r\nimport { UniformBufferParamsType } from \"../../RenderEngine/UniformBufferData\";\r\nimport { UniformBufferObject } from \"../../RenderEngine/UniformBufferObject\";\r\n/**\r\n * @internal\r\n */\r\nexport class TransLargeUBOUtils {\r\n    static configStartLength: number = 1024;\r\n\r\n    static addStep: number = 512;\r\n\r\n    bindUBO: UniformBufferObject;\r\n\r\n    maxlength: number;\r\n\r\n    currentlength: number = 0;\r\n\r\n    pool: SubUniformBufferData[];\r\n\r\n    subDataMap: SubUniformBufferData[];\r\n\r\n    subDataParamMap: Map<string, UniformBufferParamsType>;\r\n\r\n    defaultSubData: SubUniformBufferData;\r\n\r\n    /**\r\n     * @internal\r\n     * @param UBO\r\n     * @param paramsMap\r\n     * @param defautSubData \r\n     */\r\n    constructor(UBO: UniformBufferObject, paramsMap: Map<string, UniformBufferParamsType>, defautSubData: SubUniformBufferData) {\r\n        this.bindUBO = UBO;\r\n        this.defaultSubData = defautSubData;\r\n        UBO._reset(TransLargeUBOUtils.configStartLength * this.defaultSubData.getbyteLength());\r\n        this.subDataParamMap = paramsMap;\r\n        this.maxlength = TransLargeUBOUtils.configStartLength;\r\n        this.subDataMap = [];\r\n        this.pool = [];\r\n        this.subDataMap.push(defautSubData);\r\n        this.currentlength++;\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @returns \r\n     */\r\n    create(): SubUniformBufferData {\r\n        if (this.pool.length > 0) {\r\n            const re = this.pool.pop();\r\n            re._isInPool = false;\r\n            return re;\r\n        }\r\n        if (this.maxlength == this.currentlength)\r\n            this.reset();\r\n\r\n        let uniformMap = new Map<number, UniformBufferParamsType>();\r\n        this.subDataParamMap.forEach((value, key) => {\r\n            uniformMap.set(Shader3D.propertyNameToID(key), value);\r\n        })\r\n        let subdata = new SubUniformBufferData(uniformMap, this.currentlength++);\r\n        this.subDataMap.push(subdata);\r\n        return subdata;\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @param subModuleData \r\n     */\r\n    recover(subModuleData: SubUniformBufferData) {\r\n        if (!subModuleData._isInPool) {\r\n            this.pool.push(subModuleData);\r\n            subModuleData._isInPool = true;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * \r\n     */\r\n    reset() {\r\n        this.maxlength += TransLargeUBOUtils.addStep;\r\n        this.bindUBO._reset(this.maxlength * this.defaultSubData.getbyteLength());\r\n        //all update\r\n        this.subDataMap.forEach(element => {\r\n            this.bindUBO.setDataByByUniformBufferDataOffset(element, element._offset);\r\n        });\r\n    }\r\n\r\n    /**\r\n     * Update One subData\r\n     * @param data \r\n     */\r\n    updateSubData(data: SubUniformBufferData) {\r\n        this.bindUBO.setDataByByUniformBufferDataOffset(data, data._offset);\r\n        data._needUpdate = false;\r\n    }\r\n\r\n    updateBindRange(data: SubUniformBufferData) {\r\n        let bytelenth = data.getbyteLength();\r\n        this.bindUBO._bindBufferRange(data._offset * bytelenth, bytelenth);\r\n    }\r\n\r\n\r\n    /**\r\n     * destroy\r\n     */\r\n    destroy() {\r\n        this.subDataMap.forEach(element => {\r\n            element.destroy();\r\n        });\r\n\r\n        delete this.subDataMap;\r\n        delete this.pool;\r\n        this.subDataMap = null;\r\n        this.pool = null;\r\n    }\r\n}","import { Camera, CameraClearFlags } from \"../Camera\";\r\nimport { Sprite3D } from \"../Sprite3D\";\r\nimport { Ray } from \"../../math/Ray\";\r\nimport { Viewport } from \"../../math/Viewport\";\r\nimport { HitResult } from \"../../physics/HitResult\";\r\nimport { Config3D } from \"../../../../Config3D\";\r\nimport { InputManager } from \"../../../events/InputManager\";\r\nimport { Node } from \"../../../display/Node\";\r\nimport { Scene3D } from \"./Scene3D\";\r\nimport { Vector2 } from \"../../../maths/Vector2\";\r\nimport { Vector3 } from \"../../../maths/Vector3\";\r\nimport { Render } from \"../../../renders/Render\";\r\n\r\nconst _vec2 = new Vector2();\r\nconst _ray = new Ray(new Vector3(), new Vector3());\r\nconst _hitResult = new HitResult();\r\n\r\nInputManager.prototype.getSprite3DUnderPoint = function (this: InputManager, x: number, y: number): Node {\r\n    _hitResult.succeeded = false;\r\n\r\n    x = x * this._stage.clientScaleX;\r\n    y = y * this._stage.clientScaleY;\r\n    var pageX = x;\r\n    var pageY = y;\r\n\r\n    var normalWidth = x / Render._mainCanvas.width;\r\n    var normalHeight = y / Render._mainCanvas.height;\r\n\r\n    x = this._stage.width * normalWidth;\r\n    y = this._stage.height * normalHeight;\r\n\r\n    _vec2.setValue(x, y);\r\n\r\n    for (let scene of <Scene3D[]>this._stage._scene3Ds) {\r\n        let sim = scene._physicsManager;\r\n        let uiManager = scene._UI3DManager;\r\n\r\n        let cameras = scene._cameraPool;\r\n        for (let i = cameras.length - 1; i >= 0; i--) {\r\n            let camera = <Camera>cameras[i];\r\n            let viewport: Viewport = camera.viewport;\r\n            let ratio = Config3D.pixelRatio;\r\n            if (pageX >= viewport.x && pageY >= viewport.y && pageX <= viewport.width / ratio && pageY <= viewport.height / ratio) {\r\n                //Physics\r\n                camera.viewportPointToRay(_vec2, _ray);\r\n\r\n                //3D UI\r\n                let sprite = uiManager.rayCast(_ray);\r\n                if (sprite)\r\n                    return sprite;\r\n                if (!sim)\r\n                    continue;\r\n                var sucess: boolean = sim.rayCast(_ray, <any>_hitResult);\r\n                if (sucess || (camera.clearFlag === CameraClearFlags.SolidColor || camera.clearFlag === CameraClearFlags.Sky))\r\n                    break;\r\n            }\r\n        }\r\n\r\n        if (_hitResult.succeeded)\r\n            return (<Sprite3D>_hitResult.collider.owner);\r\n    }\r\n\r\n    return null;\r\n}\r\n","import { Vector2 } from \"../../../../maths/Vector2\";\r\nimport { IClone } from \"../../../../utils/IClone\"\r\n\r\n/**\r\n * <code>GradientDataVector2</code> \r\n */\r\nexport class GradientDataVector2 implements IClone {\r\n\tprivate _currentLength: number = 0;\r\n\t/**@internal */\r\n\t_elements: Float32Array;\r\n\r\n\t/***/\r\n\tget gradientCount(): number {\r\n\t\treturn this._currentLength / 3;\r\n\t}\r\n\r\n\t/**\r\n\t *  <code>GradientDataVector2</code> \r\n\t */\r\n\tconstructor() {\r\n\t\tthis._elements = new Float32Array(12);\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t * @param\tkey 01\r\n\t * @param\tvalue \r\n\t */\r\n\tadd(key: number, value: Vector2): void {\r\n\t\tif (this._currentLength < 8) {\r\n\r\n\t\t\tif ((this._currentLength === 6) && ((key !== 1))) {\r\n\t\t\t\tkey = 1;\r\n\t\t\t\tconsole.log(\"GradientDataVector2 warning:the forth key is  be force set to 1.\");\r\n\t\t\t}\r\n\r\n\t\t\tthis._elements[this._currentLength++] = key;\r\n\t\t\tthis._elements[this._currentLength++] = value.x;\r\n\t\t\tthis._elements[this._currentLength++] = value.y;\r\n\t\t} else {\r\n\t\t\tconsole.log(\"GradientDataVector2 warning:data count must lessEqual than 4\");\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t * @param\tdestObject \r\n\t */\r\n\tcloneTo(destObject: any): void {\r\n\t\tvar destGradientDataVector2: GradientDataVector2 = <GradientDataVector2>destObject;\r\n\t\tdestGradientDataVector2._currentLength = this._currentLength;\r\n\t\tvar destElements: Float32Array = destGradientDataVector2._elements;\r\n\t\tfor (var i: number = 0, n: number = this._elements.length; i < n; i++) {\r\n\t\t\tdestElements[i] = this._elements[i];\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t * @return\t \r\n\t */\r\n\tclone(): any {\r\n\t\tvar destGradientDataVector2: GradientDataVector2 = new GradientDataVector2();\r\n\t\tthis.cloneTo(destGradientDataVector2);\r\n\t\treturn destGradientDataVector2;\r\n\t}\r\n\r\n}\r\n\r\n\r\n","import { Vector2 } from \"../../../../maths/Vector2\";\r\nimport { Vector3 } from \"../../../../maths/Vector3\";\r\nimport { Vector4 } from \"../../../../maths/Vector4\";\r\nimport { BufferUsage } from \"../../../../RenderEngine/RenderEnum/BufferTargetType\";\r\nimport { VertexDeclaration } from \"../../../../RenderEngine/VertexDeclaration\";\r\nimport { VertexBuffer3D } from \"../../../graphics/VertexBuffer3D\";\r\nimport { Laya3DRender } from \"../../../RenderObjs/Laya3DRender\";\r\nimport { DrawMeshInstancedCMD } from \"./DrawMeshInstancedCMD\";\r\n\r\n/**\r\n * @internal\r\n * <code>Mesh</code> CustomInstance\r\n */\r\nexport class MaterialInstanceProperty {\r\n\t/**@internal instanceProperty name*/\r\n\tpublic _name: string;\r\n\t/**@internal property Data*/\r\n\tpublic _value: Vector4[] | Vector3[] | Vector2[] | Float32Array;\r\n\t/**@internal vertex Declaration */\r\n\tpublic _vertexDeclaration: VertexDeclaration;\r\n\t/**@internal */\r\n\tpublic _isNeedUpdate: boolean = false;\r\n\t/**@internal */\r\n\tpublic _vertexStride: number;\r\n\t/**@internal */\r\n\tpublic _instanceData: Float32Array;\r\n\t/**@internal */\r\n\tpublic _vertexBuffer: VertexBuffer3D;\r\n\r\n\t/**\r\n\t * @internal\r\n\t * instanceBuffer\r\n\t */\r\n\tcreateInstanceVertexBuffer3D() {\r\n\t\tthis._instanceData = new Float32Array(DrawMeshInstancedCMD.maxInstanceCount * this._vertexStride);\r\n\t\tthis._vertexBuffer = Laya3DRender.renderOBJCreate.createVertexBuffer3D(this._instanceData.length * 4, BufferUsage.Dynamic, false);\r\n\t\tthis._vertexBuffer.vertexDeclaration = this._vertexDeclaration;\r\n\t\tthis._vertexBuffer.instanceBuffer = true;\r\n\t}\r\n\r\n\t/**\r\n\t * @internal\r\n\t * \r\n\t */\r\n\tupdateVertexBufferData(drawNums: number) {\r\n\t\t//\r\n\t\tif (!this._isNeedUpdate)\r\n\t\t\treturn;\r\n\t\tlet instanceData = this._instanceData;\r\n\t\tlet dataValue = this._value;\r\n\t\tlet datalength = this._value.length;\r\n\t\tlet data: Vector2 | Vector3 | Vector4;\r\n\t\tlet stride = this._vertexStride;\r\n\t\tlet updateType = 0;\r\n\t\tif (!(this._value instanceof Float32Array)) {\r\n\t\t\tupdateType = 1;//Vector\r\n\t\t}\r\n\r\n\t\tswitch (updateType) {\r\n\t\t\tcase 0:\r\n\t\t\t\tinstanceData.set(<Float32Array>dataValue, 0);\r\n\t\t\t\tbreak;\r\n\t\t\tcase 1:\r\n\t\t\t\tfor (let i = 0; i < datalength; i++) {\r\n\t\t\t\t\tdata = <Vector2 | Vector3 | Vector4>dataValue[i];\r\n\t\t\t\t\tdata.writeTo(instanceData, i * stride);\r\n\t\t\t\t}\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\t\tthis._vertexBuffer.orphanStorage();\r\n\t\tthis._vertexBuffer.setData(instanceData.buffer, 0, 0, drawNums * 4 * stride);\r\n\t}\r\n\r\n\tdestroy() {\r\n\t\tdelete this._value;\r\n\t\tdelete this._instanceData;\r\n\t\tthis._vertexDeclaration = null;\r\n\t\tthis._vertexBuffer.destroy();\r\n\t}\r\n}","import { Vector2 } from \"../../../../maths/Vector2\";\r\nimport { Vector3 } from \"../../../../maths/Vector3\";\r\nimport { Vector4 } from \"../../../../maths/Vector4\";\r\nimport { VertexDeclaration } from \"../../../../RenderEngine/VertexDeclaration\";\r\nimport { VertexElement } from \"../../../../renders/VertexElement\";\r\nimport { VertexElementFormat } from \"../../../../renders/VertexElementFormat\";\r\nimport { MaterialInstanceProperty } from \"./MaterialInstanceProperty\";\r\n\r\nexport enum InstanceLocation{\r\n\tCUSTOME0 = 12,\r\n\tCUSTOME1 = 13,\r\n\tCUSTOME2 = 14,\r\n\tCUSTOME3 = 15\r\n}\r\n\r\n/**\r\n * <code>Mesh</code> CustomInstance\r\n */\r\nexport class MaterialInstancePropertyBlock{\r\n\t\r\n\t/**Instance */\r\n\t/**attribute instance , instance*/\r\n\tpublic static INSTANCETYPE_ATTRIBUTE:number = 0;\r\n\t/**uniform instance instance  WebGLContext._maxUniformFragmentVectors */\r\n\tpublic static INSTANCETYPE_UNIFORMBUFFER:number = 1;\r\n\r\n\r\n\t/**@internal instance type*/\r\n\tprotected _type:number = 0;\r\n\r\n\r\n\t/**@internal property map*/\r\n\t_propertyMap:{[key:number]:MaterialInstanceProperty} = {};\r\n\r\n\tconstructor(){\r\n\t}\r\n\r\n\r\n\t/**\r\n\t * @internal \r\n\t * @param vertexElementFormat \r\n\t * @param propertyName \r\n\t * @param attributeLocation attribute\r\n\t * @param prob \r\n\t */\r\n\tprivate _checkPropertyLegal(vertexElementFormat:VertexElementFormat,propertyName:string,attributeLocation:InstanceLocation,prob:MaterialInstanceProperty){\r\n\t\t\tvar vecDec = prob._vertexDeclaration;\r\n\t\t\t//\r\n\t\t\tif(vecDec._vertexElements[0]._elementFormat !== vertexElementFormat)\r\n\t\t\t\tthrow \"Data exists and format does not match\";//\r\n\t\t\tif(prob._name !== propertyName)\r\n\t\t\t\tthrow \"You cannot add a new property to an existing attributeLocation,Please use another attributeLocation\";//\t\r\n\t}\r\n\r\n\t/**\r\n\t * instance\r\n\t * @param attributeName name\r\n\t * @param arrays data\r\n\t * @param vertexStride vertex size\r\n\t * @param vertexformat vertexFormat\r\n\t * @param attributeLocation  attribute location\r\n\t */\r\n\tprivate _creatProperty(attributeName:string,arrays:Vector4[]|Vector3[]|Vector2[]|Float32Array,vertexStride:number,vertexformat:string,attributeLocation:InstanceLocation){\r\n\t\tvar prob = this._propertyMap[attributeLocation] = new MaterialInstanceProperty();\r\n\t\tprob._name = attributeName;\r\n\t\tprob._value = arrays;\r\n\t\tprob._vertexDeclaration = new VertexDeclaration(vertexStride,[new VertexElement(0,vertexformat,attributeLocation)]);\r\n\t\tprob._isNeedUpdate = true;\r\n\t\tprob._vertexStride = vertexStride / 4;\r\n\t\tprob.createInstanceVertexBuffer3D();\r\n\t}\r\n\t\r\n\t/**\r\n\t * Vector4\r\n\t * @param attributeName Shader\r\n\t * @param arrays \r\n\t * @param attributeLocation  ShadershaderAttribute\r\n\t */\r\n\tsetVectorArray(attributeName:string,arrays:Vector4[]|Float32Array,attributeLocation:InstanceLocation):void{\r\n\t\tvar prob = this._propertyMap[attributeLocation];\r\n\t\tif(prob){\r\n\t\t\t//\r\n\t\t\tthis._checkPropertyLegal(VertexElementFormat.Vector4,attributeName,attributeLocation,prob);\r\n\t\t\tprob._value = arrays;\r\n\t\t\tprob._isNeedUpdate = true;\r\n\t\t}else//\r\n\t\t\tthis._creatProperty(attributeName,arrays,16,VertexElementFormat.Vector4,attributeLocation);\r\n\t}\r\n\r\n\t/**\r\n\t * Vector3\r\n\t * @param attributeName Shader\r\n\t * @param arrays \r\n\t * @param attributeLocation shadershaderAttribute\r\n\t */\r\n\tsetVector3Array(attributeName:string,arrays:Vector3[]|Float32Array,attributeLocation:InstanceLocation){\r\n\t\tvar prob = this._propertyMap[attributeLocation];\r\n\t\tif(prob){\r\n\t\t\t//\r\n\t\t\tthis._checkPropertyLegal(VertexElementFormat.Vector3,attributeName,attributeLocation,prob);\r\n\t\t\tprob._value = arrays;\r\n\t\t\tprob._isNeedUpdate = true;\r\n\t\t}else//\r\n\t\t\tthis._creatProperty(attributeName,arrays,12,VertexElementFormat.Vector3,attributeLocation);\r\n\t}\r\n\r\n\t/**\r\n\t * Vector2\r\n\t * @param attributeName Shader\r\n\t * @param arrays \r\n\t * @param attributeLocation shadershaderAttribute\r\n\t */\r\n\tsetVector2Array(attributeName:string,arrays:Vector2[]|Float32Array,attributeLocation:InstanceLocation){\r\n\t\tvar prob = this._propertyMap[attributeLocation];\r\n\t\tif(prob){\r\n\t\t\t//\r\n\t\t\tthis._checkPropertyLegal(VertexElementFormat.Vector2,attributeName,attributeLocation,prob);\r\n\t\t\tprob._value = arrays;\r\n\t\t\tprob._isNeedUpdate = true;\r\n\t\t}else//\r\n\t\t\tthis._creatProperty(attributeName,arrays,8,VertexElementFormat.Vector2,attributeLocation);\r\n\t}\r\n\r\n\t/**\r\n \t * Number\r\n\t * @param attributeName Shader\r\n\t * @param arrays \r\n\t * @param attributeLocation shadershaderAttribute\r\n\t */\r\n\tsetNumberArray(attributeName:string,arrays:Float32Array,attributeLocation:InstanceLocation){\r\n\t\tvar prob = this._propertyMap[attributeLocation];\r\n\t\tif(prob){\r\n\t\t\t//\r\n\t\t\tthis._checkPropertyLegal(VertexElementFormat.Single,attributeName,attributeLocation,prob);\r\n\t\t\tprob._value = arrays;\r\n\t\t\tprob._isNeedUpdate = true;\r\n\t\t}else//\r\n\t\t\tthis._creatProperty(attributeName,arrays,4,VertexElementFormat.Single,attributeLocation);\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t * @param attributeLocation  shader\r\n\t */\r\n\tgetPropertyArray(attributeLocation:InstanceLocation):Vector4[]|Vector3[]|Vector2[]|Float32Array{\r\n\t\tvar prob = this._propertyMap[attributeLocation];\r\n\t\treturn prob?prob._value:null;\r\n\t}\r\n\r\n\tclear(){\r\n\t\tfor(var i in this._propertyMap){\r\n\t\t\tthis._propertyMap[i].destroy();\r\n\t\t}\r\n\t\tthis._propertyMap = {};\r\n\t}\r\n\r\n}","import { Animator } from \"../component/Animator/Animator\"\r\nimport { AnimatorState } from \"../component/Animator/AnimatorState\";\r\n\r\ninterface AnimatorPlayScriptInfo {\r\n\tanimator: Animator;\r\n\tlayerindex: number;\r\n\tplayState: AnimatorState;\r\n}\r\n/**\r\n * <code>AnimatorStateScript</code> ,,\r\n */\r\nexport class AnimatorStateScript {\r\n\r\n\t/**@internal */\r\n\tplayStateInfo: AnimatorPlayScriptInfo = { animator: null, layerindex: -1, playState: null };\r\n\r\n\t/**@internal */\r\n\tsetPlayScriptInfo(animator: Animator, layerindex: number, playstate: AnimatorState) {\r\n\t\tthis.playStateInfo.animator = animator;\r\n\t\tthis.playStateInfo.layerindex = layerindex;\r\n\t\tthis.playStateInfo.playState = playstate;\r\n\t}\r\n\r\n\t/**\r\n\t *  <code>AnimatorStateScript</code> \r\n\t */\r\n\tconstructor() {\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t */\r\n\tonStateEnter(): void {\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t * @param normalizeTime 0-1\r\n\t */\r\n\tonStateUpdate(normalizeTime: number): void {\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t */\r\n\tonStateExit(): void {\r\n\r\n\t}\r\n\t/**\r\n\t * \r\n\t */\r\n\tonStateLoop(): void {\r\n\r\n\t}\r\n}\r\n\r\n\r\n","import { ICollider } from \"../../Physics3D/interface/ICollider\";\r\nimport { ContactPoint } from \"./ContactPoint\";\r\nimport { PhysicsColliderComponent } from \"./PhysicsColliderComponent\";\r\n\r\n/**\r\n * <code>Collision</code> \r\n */\r\nexport class Collision {\r\n    /**@internal */\r\n    _lastUpdateFrame = -2147483648/*int.MIN_VALUE*/;\r\n    /**@internal */\r\n    _updateFrame = -2147483648/*int.MIN_VALUE*/;\r\n    /**@internal */\r\n    _isTrigger = false;\r\n\r\n    /**@internal */\r\n    _colliderA: ICollider;\r\n    /**@internal */\r\n    _colliderB: ICollider;\r\n\r\n    /**@readonly*/\r\n    contacts: ContactPoint[] = [];\r\n    /**@readonly*/\r\n    other: PhysicsColliderComponent;\r\n\r\n    /**@internal */\r\n    _inPool: boolean = false;\r\n    /**\r\n     *  <code>Collision</code> \r\n     */\r\n    constructor() {\r\n\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    _setUpdateFrame(farme: number): void {\r\n        this._lastUpdateFrame = this._updateFrame;//TODO:\r\n        this._updateFrame = farme;\r\n    }\r\n\r\n}\r\n\r\n\r\n","import { ICollider } from \"../../Physics3D/interface/ICollider\";\r\nimport { Vector3 } from \"../../maths/Vector3\";\r\n\r\n/**\r\n * <code>ContactPoint</code> \r\n */\r\nexport class ContactPoint {\r\n\t/**@internal */\r\n\t_idCounter: number = 0;\r\n\r\n\t/**@internal */\r\n\t_id: number;\r\n\r\n\t/**A*/\r\n\t_colliderA: ICollider = null;\r\n\t/**B*/\r\n\t_colliderB: ICollider = null;\r\n\t/***/\r\n\tdistance: number = 0;\r\n\t/***/\r\n\tnormal: Vector3 = new Vector3();\r\n\t/**A*/\r\n\tpositionOnA: Vector3 = new Vector3();\r\n\t/**B*/\r\n\tpositionOnB: Vector3 = new Vector3();\r\n\r\n\t/**\r\n\t *  <code>ContactPoint</code> \r\n\t */\r\n\tconstructor() {\r\n\t\tthis._id = ++this._idCounter;\r\n\t}\r\n\r\n}\r\n\r\n\r\n","import { DrawType } from \"../../../RenderEngine/RenderEnum/DrawType\";\r\nimport { IndexFormat } from \"../../../RenderEngine/RenderEnum/IndexFormat\";\r\nimport { MeshTopology } from \"../../../RenderEngine/RenderEnum/RenderPologyMode\";\r\nimport { GeometryElement } from \"../../core/GeometryElement\";\r\nimport { RenderContext3D } from \"../../core/render/RenderContext3D\";\r\nimport { Mesh } from \"../../resource/models/Mesh\";\r\nimport { HLODBatchSubMesh } from \"./HLODUtil\";\r\n\r\n\r\nexport class HLODBatchMesh extends GeometryElement {\r\n    /**@internal batchMesh */\r\n    private _mesh: Mesh;\r\n    /**@internal */\r\n    private _batchSubMeshInfos: HLODBatchSubMesh[];\r\n\r\n    /**@internal */\r\n    private _drawSubMeshs: HLODBatchSubMesh[];\r\n    /**\r\n     * instance HLODBatchMesh\r\n     */\r\n    constructor() {\r\n        super(MeshTopology.Triangles, DrawType.DrawElement);\r\n    }\r\n\r\n    /**\r\n     * mesh\r\n     * @param mesh \r\n     * @param bounds \r\n     */\r\n    set batchMesh(mesh: Mesh) {\r\n        if (this._mesh != mesh) {\r\n            this._mesh && (this._mesh._removeReference());\r\n            this.indexFormat = mesh.indexFormat;\r\n            this._mesh = mesh;\r\n            this._mesh._addReference();\r\n        }\r\n    }\r\n\r\n    get batchMesh() {\r\n        return this._mesh;\r\n    }\r\n\r\n    /**\r\n     * mesh\r\n     */\r\n    set batchSubMeshInfo(value: HLODBatchSubMesh[]) {\r\n        this._batchSubMeshInfos = value;\r\n    }\r\n\r\n    get batchSubMeshInfo() {\r\n        return this._batchSubMeshInfos;\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     * @param value \r\n     */\r\n    set drawSubMeshs(value: HLODBatchSubMesh[]) {\r\n        this._drawSubMeshs = value;\r\n    }\r\n\r\n    get drawSubMeshs(): HLODBatchSubMesh[] {\r\n        return this._drawSubMeshs;\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     * @override\r\n     */\r\n    _prepareRender(state: RenderContext3D): boolean {\r\n        this._mesh._uploadVerticesData();\r\n        return true;\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     * @override\r\n     */\r\n    _updateRenderParams(state: RenderContext3D): void {\r\n        var mesh: Mesh = this._mesh;\r\n        var byteCount: number;\r\n        switch (mesh.indexFormat) {\r\n            case IndexFormat.UInt32:\r\n                byteCount = 4;\r\n                break;\r\n            case IndexFormat.UInt16:\r\n                byteCount = 2;\r\n                break;\r\n            case IndexFormat.UInt8:\r\n                byteCount = 1;\r\n                break;\r\n        }\r\n        this.clearRenderParams();\r\n        this.bufferState = mesh._bufferState;\r\n        if (this._drawSubMeshs) {\r\n            this._drawSubMeshs.forEach(element => {\r\n                this.setDrawElemenParams(element.drawPramas.y, element.drawPramas.x * byteCount);\r\n            });\r\n        }\r\n    }\r\n\r\n    /**\r\n     * \r\n     */\r\n    destroy(): void {\r\n        this._mesh && this._mesh._removeReference();\r\n        delete this._batchSubMeshInfos;\r\n        delete this._drawSubMeshs;\r\n    }\r\n\r\n\r\n}","import { Laya } from \"../../../../Laya\";\r\nimport { Vector2 } from \"../../../maths/Vector2\";\r\nimport { Handler } from \"../../../utils/Handler\";\r\nimport { Material } from \"../../../resource/Material\";\r\nimport { Lightmap } from \"../../core/scene/Lightmap\";\r\nimport { Bounds } from \"../../math/Bounds\";\r\nimport { HLODBatchMesh } from \"./HLODBatchMesh\";\r\n/**\r\n * HLOD\r\n */\r\nexport class HLODConfig {\r\n    releaseCallTime: number;//CG\r\n    releaseTime: number;//\r\n}\r\n\r\n\r\n/**\r\n * HLODBatch resource\r\n */\r\nexport class HLODBatchSubMesh {\r\n    bounds: Bounds;\r\n    drawPramas: Vector2;\r\n}\r\n\r\n/**\r\n * HLODElement HLODRenderElement\r\n */\r\nexport class HLODElement {\r\n    /**batch mesh */\r\n    HLODMesh: HLODBatchMesh;\r\n\r\n    /**material */\r\n    private _material: Material;\r\n    public get material(): Material {\r\n        return this._material;\r\n    }\r\n    public set material(value: Material) {\r\n        if (this._material != value) {\r\n            this._material && this._material._removeReference();\r\n            this._material = value;\r\n            this._material._addReference();\r\n        }\r\n\r\n    }\r\n\r\n    /**lightmap */\r\n    private _lightmap: Lightmap;\r\n    public get lightmap(): Lightmap {\r\n        return this._lightmap;\r\n    }\r\n    public set lightmap(value: Lightmap) {\r\n        if (this._lightmap != value) {\r\n            if (this._lightmap) {\r\n                this._lightmap.lightmapColor._removeReference();\r\n                this._lightmap.lightmapDirection._removeReference();\r\n            }\r\n            this._lightmap = value;\r\n            this._lightmap.lightmapColor._addReference();\r\n            this._lightmap.lightmapDirection._addReference();\r\n\r\n        }\r\n        this._lightmap = value;\r\n    }\r\n\r\n    /**\r\n     * \r\n     * lightmap direct destroy\r\n     */\r\n    release() {\r\n        this.HLODMesh.destroy();\r\n        this.material.destroy();\r\n        if (this.lightmap) {\r\n            this._lightmap.lightmapColor.destroy();\r\n            this._lightmap.lightmapDirection.destroy();\r\n        }\r\n    }\r\n}\r\n\r\n/**\r\n * HLOD Resource\r\n * Load/release\r\n */\r\nexport class HLODResourceGroup {\r\n    url: string;\r\n    updateMark: number;\r\n    resources: HLODElement[];\r\n    loaded: boolean;\r\n\r\n    /**\r\n     * loaded\r\n     * @param callFun \r\n     * @param hlod \r\n     */\r\n    load(callFun: Function, hlod: any) {\r\n        if (!this.loaded) {\r\n            Laya.loader.load(this.url, Handler.create(\r\n                this, (res: any) => {\r\n                    callFun.apply(hlod, [this]);\r\n                    this.loaded = true;\r\n                }, [this]\r\n            ));\r\n        }\r\n    }\r\n\r\n    /**\r\n     * HLODGourp\r\n     */\r\n    release() {\r\n        this.resources.forEach(element => {\r\n            element.release();\r\n        });\r\n        this.loaded = false;\r\n    }\r\n}","import { Vector3 } from \"../../../maths/Vector3\";\r\nimport { BufferUsage } from \"../../../RenderEngine/RenderEnum/BufferTargetType\";\r\nimport { DrawType } from \"../../../RenderEngine/RenderEnum/DrawType\";\r\nimport { IndexFormat } from \"../../../RenderEngine/RenderEnum/IndexFormat\";\r\nimport { MeshTopology } from \"../../../RenderEngine/RenderEnum/RenderPologyMode\";\r\nimport { ICameraCullInfo } from \"../../../RenderEngine/RenderInterface/RenderPipelineInterface/ICameraCullInfo\";\r\nimport { ICullPass } from \"../../../RenderEngine/RenderInterface/RenderPipelineInterface/ICullPass\";\r\nimport { IRenderElement } from \"../../../RenderEngine/RenderInterface/RenderPipelineInterface/IRenderElement\";\r\nimport { IRenderQueue } from \"../../../RenderEngine/RenderInterface/RenderPipelineInterface/IRenderQueue\";\r\nimport { ISceneRenderManager } from \"../../../RenderEngine/RenderInterface/RenderPipelineInterface/ISceneRenderManager\";\r\nimport { IShadowCullInfo } from \"../../../RenderEngine/RenderInterface/RenderPipelineInterface/IShadowCullInfo\";\r\nimport { ISortPass } from \"../../../RenderEngine/RenderInterface/RenderPipelineInterface/ISortPass\";\r\nimport { Sprite3D } from \"../../core/Sprite3D\";\r\nimport { Transform3D } from \"../../core/Transform3D\";\r\nimport { IndexBuffer3D } from \"../../graphics/IndexBuffer3D\";\r\nimport { IRenderEngine3DOBJFactory } from \"../IRenderEngine3DOBJFactory\";\r\nimport { NativeBaseRenderNode } from \"./NativeBaseRenderNode\";\r\nimport { NativeBaseRenderQueue } from \"./NativeBaseRenderQueue\";\r\nimport { NativeBounds } from \"./NativeBounds\";\r\nimport { NativeCameraCullInfo } from \"./NativeCameraCullInfo\";\r\nimport { NativeCullPassBase } from \"./NativeCullPass\";\r\nimport { NativeIndexBuffer3D } from \"./NativeIndexBuffer3D\";\r\nimport { NativeInstanceRenderElementOBJ } from \"./NativeInstanceRenderElementOBJ\";\r\nimport { NativeRenderContext3DOBJ } from \"./NativeRenderContext3DOBJ\";\r\nimport { NativeRenderElementOBJ } from \"./NativeRenderElementOBJ\";\r\nimport { NativeRenderGeometryElementOBJ } from \"./NativeRenderGeometryElementOBJ\";\r\nimport { NativeSceneRenderManager } from \"./NativeSceneRenderManager\";\r\nimport { NativeShadowCullInfo } from \"./NativeShadowCullInfo\";\r\nimport { NativeSkinRenderElementOBJ } from \"./NativeSkinRenderElementOBJ\";\r\nimport { NativeTransform3D } from \"./NativeTransform3D\";\r\nimport { NativeVertexBuffer3D } from \"./NativeVertexBuffer3D\";\r\n\r\n\r\nexport class NativeGLRenderEngine3DOBJFactory implements IRenderEngine3DOBJFactory{\r\n    createTransform(owner: Sprite3D): Transform3D {\r\n        return new NativeTransform3D(owner);\r\n    }\r\n\r\n    createBounds(min: Vector3, max: Vector3): any {\r\n        return new NativeBounds(min, max);\r\n    }\r\n\r\n    createRenderElement(): IRenderElement {\r\n        return new NativeRenderElementOBJ();\r\n    }\r\n\r\n    createSkinRenderElement(): IRenderElement {\r\n        return new NativeSkinRenderElementOBJ();\r\n    }\r\n\r\n    createInstanceRenderElement(): IRenderElement {\r\n        return new NativeInstanceRenderElementOBJ();\r\n    }\r\n\r\n    createBaseRenderQueue(isTransparent: boolean): IRenderQueue {\r\n        var queue: NativeBaseRenderQueue = new NativeBaseRenderQueue(isTransparent);\r\n        queue.sortPass = this.createSortPass();\r\n        return queue;\r\n    }\r\n\r\n    createVertexBuffer3D(byteLength: number, bufferUsage: BufferUsage, canRead: boolean = false) {\r\n        return new NativeVertexBuffer3D(byteLength, bufferUsage, canRead);\r\n    }\r\n\r\n    createIndexBuffer3D(indexType: IndexFormat, indexCount: number, bufferUsage: BufferUsage = BufferUsage.Static, canRead: boolean = false): IndexBuffer3D {\r\n        return new NativeIndexBuffer3D(indexType, indexCount, bufferUsage, canRead);\r\n    }\r\n\r\n    createSceneRenderManager(): ISceneRenderManager {\r\n        return new NativeSceneRenderManager();\r\n    }\r\n\r\n    createCullPass(): ICullPass {\r\n        return new NativeCullPassBase();\r\n    }\r\n\r\n    createSortPass(): ISortPass {\r\n        return new (window as any).conchQuickSort();\r\n    }\r\n\r\n    createShadowCullInfo(): IShadowCullInfo {\r\n        return new NativeShadowCullInfo();\r\n    }\r\n\r\n    createCameraCullInfo(): ICameraCullInfo {\r\n        return new NativeCameraCullInfo();\r\n    }\r\n\r\n    createBaseRenderNode(): NativeBaseRenderNode {\r\n        return new NativeBaseRenderNode();\r\n    }\r\n\r\n    createRenderContext3D(): NativeRenderContext3DOBJ {\r\n        return new NativeRenderContext3DOBJ();\r\n    }\r\n\r\n    createRenderGeometry(mode: MeshTopology, drayType: DrawType): NativeRenderGeometryElementOBJ {\r\n        return new NativeRenderGeometryElementOBJ(mode,drayType);\r\n    }\r\n}","import { PixelLineFilter } from \"./PixelLineFilter\";\r\nimport { PixelLineRenderer } from \"./PixelLineRenderer\";\r\nimport { PixelLineData } from \"./PixelLineData\";\r\nimport { RenderableSprite3D } from \"../RenderableSprite3D\"\r\nimport { Node } from \"../../../display/Node\"\r\nimport { Sprite3D } from \"../Sprite3D\";\r\nimport { UnlitMaterial } from \"../material/UnlitMaterial\";\r\nimport { Color } from \"../../../maths/Color\";\r\nimport { Vector3 } from \"../../../maths/Vector3\";\r\n\r\n/**\r\n * <code>PixelLineSprite3D</code> \r\n */\r\nexport class PixelLineSprite3D extends RenderableSprite3D {\r\n    /** @private active */\r\n    private _isRenderActive: Boolean = false;\r\n    /** @private */\r\n    private _isInRenders: Boolean = false;\r\n    /** @internal */\r\n    public _geometryFilter: PixelLineFilter;\r\n\r\n    /**\r\n     * \r\n     */\r\n    get maxLineCount(): number {\r\n        return (this._render as PixelLineRenderer).maxLineCount;\r\n    }\r\n\r\n    set maxLineCount(value: number) {\r\n        (this._render as PixelLineRenderer).maxLineCount = value;\r\n    }\r\n\r\n    /**\r\n     * \r\n     */\r\n    get lineCount(): number {\r\n        return (this._render as PixelLineRenderer).lineCount;\r\n    }\r\n\r\n    /**\r\n     * line\r\n     */\r\n    get pixelLineRenderer(): PixelLineRenderer {\r\n        return (<PixelLineRenderer>this._render);\r\n    }\r\n\r\n    /**\r\n     *  <code>PixelLineSprite3D</code> \r\n     * @param maxCount \r\n     * @param name \r\n     */\r\n    constructor(maxCount: number = 2, name: string = null) {\r\n        super(name);\r\n\r\n        this._render = this.addComponent(PixelLineRenderer);\r\n        this._geometryFilter = (this._render as PixelLineRenderer)._pixelLineFilter;\r\n        (this._render as PixelLineRenderer).maxLineCount = maxCount;\r\n        let material = this._render.material = new UnlitMaterial();\r\n        material.enableVertexColor = true;\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @param\tstartPosition  \r\n     * @param\tendPosition\t   \r\n     * @param\tstartColor\t   \r\n     * @param\tendColor\t   \r\n     */\r\n    addLine(startPosition: Vector3, endPosition: Vector3, startColor: Color, endColor: Color): void {\r\n        (this._render as PixelLineRenderer).addLine(startPosition, endPosition, startColor, endColor);\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @param\tlines  \r\n     */\r\n    addLines(lines: PixelLineData[]): void {\r\n        (this._render as PixelLineRenderer).addLines(lines);\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @param index \r\n     */\r\n    removeLine(index: number): void {\r\n        (this._render as PixelLineRenderer).removeLine(index);\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @param\tindex  \t\t   \r\n     * @param\tstartPosition  \r\n     * @param\tendPosition\t   \r\n     * @param\tstartColor\t   \r\n     * @param\tendColor\t   \r\n     */\r\n    setLine(index: number, startPosition: Vector3, endPosition: Vector3, startColor: Color, endColor: Color): void {\r\n        (this._render as PixelLineRenderer).setLine(index, startPosition, endPosition, startColor, endColor);\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @param out \r\n     */\r\n    getLine(index: number, out: PixelLineData): void {\r\n        (this._render as PixelLineRenderer).getLine(index, out);\r\n    }\r\n\r\n    /**\r\n     * \r\n     */\r\n    clear(): void {\r\n        (this._render as PixelLineRenderer).clear();\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    protected _create(): Node {\r\n        return new Sprite3D();\r\n    }\r\n\r\n}\r\n\r\n","import { MeshRenderer } from \"laya/d3/core/MeshRenderer\";\r\nimport { StaticBatchMeshRender } from \"./StaticBatchMeshRender\";\r\nimport { StaticMeshMergeInfo } from \"./StaticMeshMergeInfo\";\r\n\r\n/**\r\n * @internal\r\n */\r\nexport class StaticMeshBatchManager {\r\n\r\n    private meshVertexDecSet: Set<StaticMeshMergeInfo>;\r\n\r\n    constructor() {\r\n        this.meshVertexDecSet = new Set();\r\n    }\r\n    /**\r\n     * \r\n     * @param renders \r\n     * @returns \r\n     */\r\n    combine(renders: MeshRenderer[]) {\r\n        // todo \r\n        for (const render of renders) {\r\n            let haveMatch = false;\r\n            for (const info of this.meshVertexDecSet) {\r\n                if (info.match(render)) {\r\n                    haveMatch = true;\r\n                    info.addElement(render);\r\n                }\r\n            }\r\n            if (!haveMatch) {\r\n                let info = StaticMeshMergeInfo.create(render);\r\n                info.addElement(render);\r\n                this.meshVertexDecSet.add(info);\r\n            }\r\n        }\r\n\r\n        let staticRenders: StaticBatchMeshRender[] = [];\r\n        for (const info of this.meshVertexDecSet) {\r\n            staticRenders.push(StaticBatchMeshRender.create(info));\r\n        }\r\n        this.meshVertexDecSet.clear();\r\n        return staticRenders;\r\n    }\r\n    \r\n    merge(info: StaticMeshMergeInfo) {\r\n        let staticMeshRender = StaticBatchMeshRender.create(info);\r\n        return staticMeshRender;\r\n    }\r\n\r\n}","import { Color } from \"../../maths/Color\";\r\n\r\n\t\r\n\t/**\r\n\t * <code>TextMesh</code> \r\n\t */\r\n\texport class TextMesh {\r\n\t\tprivate _text:string;\r\n\t\tprivate _fontSize:number;\r\n\t\tprivate _color:Color;\r\n\t\t\r\n\t\t/**\r\n\t\t * \r\n\t\t * @return \r\n\t\t */\r\n\t\t get text():string {\r\n\t\t\treturn this._text;\r\n\t\t}\r\n\t\t\r\n\t\t/**\r\n\t\t * \r\n\t\t * @param value \r\n\t\t */\r\n\t\t set text(value:string) {\r\n\t\t\tthis._text = value;\r\n\t\t}\r\n\t\t\r\n\t\t/**\r\n\t\t * \r\n\t\t * @param  value \r\n\t\t */\r\n\t\t get fontSize():number {\r\n\t\t\treturn this._fontSize;\r\n\t\t}\r\n\t\t\r\n\t\t/**\r\n\t\t * \r\n\t\t * @return \r\n\t\t */\r\n\t\t set fontSize(value:number) {\r\n\t\t\tthis._fontSize = value;\r\n\t\t}\r\n\t\t\r\n\t\t/**\r\n\t\t * \r\n\t\t * @return \r\n\t\t */\r\n\t\t get color():Color {\r\n\t\t\treturn this._color;\r\n\t\t}\r\n\t\t\r\n\t\t/**\r\n\t\t * \r\n\t\t * @param \r\n\t\t */\r\n\t\t set color(value:Color) {\r\n\t\t\tthis._color = value;\r\n\t\t}\r\n\t\t\r\n\t\t/**\r\n\t\t *  <code>TextMesh</code> \r\n\t\t */\r\n\t\tconstructor(){\r\n\t\t\r\n\t\t}\r\n\t\t\r\n\t\r\n\t\t// private _createVertexBuffer(charCount:number):void {\r\n\t\t// }\r\n\t\t\r\n\t\r\n\t\t// private _resizeVertexBuffer(charCount:number):void {\r\n\t\t\r\n\t\t// }\r\n\t\t\r\n\t\r\n\t\t// private _addChar():void {\r\n\t\t// \t//_vertexBuffer\r\n\t\t// }\r\n\t\r\n\t}\r\n\r\n\r\n"],"mappings":"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","ignoreList":[]}