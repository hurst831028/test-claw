"use strict";(()=>{var t=Object.defineProperty,e=Object.getOwnPropertyDescriptor,i=(t,e)=>{if(e=Symbol[t])return e;throw Error("Symbol."+t+" is not defined")},s=(i,s,a,n)=>{for(var o,r=n>1?void 0:n?e(s,a):s,h=i.length-1;h>=0;h--)(o=i[h])&&(r=(n?o(s,a,r):o(r))||r);return n&&r&&t(s,a,r),r},a=(t,e,i)=>new Promise(((s,a)=>{var n=t=>{try{r(i.next(t))}catch(t){a(t)}},o=t=>{try{r(i.throw(t))}catch(t){a(t)}},r=t=>t.done?s(t.value):Promise.resolve(t.value).then(n,o);r((i=i.apply(t,e)).next())})),n=function(t,e){this[0]=t,this[1]=e},o=(t,e,i)=>{var s=(t,e,a,o)=>{try{var r=i[t](e),h=(e=r.value)instanceof n,c=r.done;Promise.resolve(h?e[0]:e).then((i=>h?s("return"===t?t:"next",e[1]?{done:i.done,value:i.value}:i,a,o):a({value:i,done:c}))).catch((t=>s("throw",t,a,o)))}catch(t){o(t)}},a=t=>o[t]=e=>new Promise(((i,a)=>s(t,e,i,a))),o={};return i=i.apply(t,e),o[Symbol.asyncIterator]=()=>o,a("next"),a("throw"),a("return"),o},r=(t,e,s)=>(e=t[i("asyncIterator")])?e.call(t):(t=t[i("iterator")](),e={},(s=(i,s)=>(s=t[i])&&(e[i]=e=>new Promise(((i,a,n)=>(e=s.call(t,e),n=e.done,Promise.resolve(e.value).then((t=>i({value:t,done:n})),a))))))("next"),s("return"),e),{regClass:h,property:c}=Laya,l=Laya.Sprite,g=class extends Laya.Script{onAwake(){this.eyesRoot.getChildAt(0).visible=!1;this.mouthRoot.getChildAt(0).visible=!1}build(t){const e=Math.floor(t%this.eyes.length),i=this.eyesRoot.getChildByName(this.eyes[e]);i?i.visible=!0:console.error("eye is null");const s=Math.floor(t%this.mouth.length);this.mouthRoot.getChildByName(this.mouth[s]).visible=!0,this.startBlinking(),this.startTalking()}startBlinking(){this.blink()}blink(){Laya.Tween.to(this.eyesRoot,{scaleY:0},150,Laya.Ease.linearNone,Laya.Handler.create(this,(()=>{Laya.Tween.to(this.eyesRoot,{scaleY:1},150,Laya.Ease.linearNone,Laya.Handler.create(this,(()=>{const t=3e3+3e3*Math.random();Laya.timer.once(t,this,this.blink)})))})))}startTalking(){this.talk()}talk(){Laya.Tween.to(this.mouthRoot,{y:this.mouthRoot.y+10},200,Laya.Ease.linearNone,Laya.Handler.create(this,(()=>{Laya.Tween.to(this.mouthRoot,{y:this.mouthRoot.y-10},200,Laya.Ease.linearNone,Laya.Handler.create(this,(()=>{const t=5e3+5e3*Math.random();Laya.timer.once(t,this,this.talk)})))})))}onUpdate(){}};s([c([String])],g.prototype,"eyes",2),s([c([String])],g.prototype,"mouth",2),s([c(l)],g.prototype,"eyesRoot",2),s([c(l)],g.prototype,"mouthRoot",2),g=s([h("9d_4XDZ6SpOvM9UXuhW-Bg")],g);var{regClass:d,property:u}=Laya,p=class extends Laya.Script{constructor(){super(...arguments),this.xDir=0,this.xRangeMin=0,this.xRangeMax=0,this.speed=0}onLateUpdate(){let t=Laya.timer.delta/1e3;this.xDir>0&&(this.owner.x+=this.xDir*this.speed*t,this.owner.x>this.xRangeMax&&(this.owner.x=this.xRangeMin)),this.xDir<0&&(this.owner.x+=this.xDir*this.speed*t,this.owner.x<this.xRangeMin&&(this.owner.x=this.xRangeMax))}};s([u({type:Number})],p.prototype,"xDir",2),s([u({type:Number})],p.prototype,"xRangeMin",2),s([u({type:Number})],p.prototype,"xRangeMax",2),s([u({type:Number})],p.prototype,"speed",2),p=s([d("dZdn5UrwThSWjU8XRpjDsg")],p);var{regClass:_,property:m}=Laya,y=Laya.ColorFilter,w=class extends Laya.Script{onAwake(){var t=new y;t.adjustBrightness(-40),t.adjustContrast(20),t.adjustSaturation(10),Laya.stage.filters=[t]}};w=s([_("z_GDfvC3TFKMUPAmCdT4hA")],w);var C=class{};C.uiRootPrefab="resources/prefabs/ui/P_UIRoot.lh",C.gameCoinInterval=60,C.gameCoinPerInterval=1,C.gameCoinMax=100;var f=class{},I=class{},b=class{},S=class{},x=class{hasEmptyIncubationSlot(){return this.incubation_list.some((t=>!t.is_in_progress))}getIncubationDataCount(){return this.incubation_list.length}},L=class{getTotalGameCoin(){return this.game_coin+this.payed_game_coin}updateGameCoin(){const t=Math.floor(Date.now()/1e3),e=t-this.game_coin_last_update_at.T+this.game_coin_remaining_duration,i=C.gameCoinInterval,s=e/i;this.game_coin+=Math.floor(s),this.game_coin>C.gameCoinMax&&(this.game_coin=C.gameCoinMax),this.game_coin_remaining_duration=e%i,this.game_coin_last_update_at.T=t,null==this.game_coin_next_update_at&&(this.game_coin_next_update_at=new f),this.game_coin_next_update_at.T=t+i-this.game_coin_remaining_duration}},T=class{getItemCount(){return null==this.item_list?0:Object.keys(this.item_list).length}getItemCountById(t){return null==this.item_list||null==this.item_list[t]?0:this.item_list[t]}},E=class{constructor(){this.item=new I,this.user=new b,this.wallet=new S,this.machine_data=new x,this.machine_coin_data=new L,this.machine_collection=new T}resetMachineData(){this.machine_data=new x}},k=class{constructor(){this.isInit=!1}},{regClass:v,property:D}=Laya,U=class extends Laya.Script{constructor(){super(),this._data=new E,this._tgData=new k,this._callbackMap={}}get tgData(){return this._tgData}get runTimeData(){return this._data}set machine(t){this._machine=t}get machine(){return this._machine}static get instance(){return U._instance?U._instance:null}onAwake(){if(U._instance)throw new Error("Singleton class. Use getInstance() instead.");U._instance=this}mergeDeep(t,e){for(const i in e)if(e[i]&&"object"==typeof e[i]&&!Array.isArray(e[i])){t[i]||(t[i]={});const s=JSON.stringify(t[i]);this.mergeDeep(t[i],e[i]),s!==JSON.stringify(t[i])&&this.invokeModuleCallbacks(i)}else{const s=t[i]!==e[i];t[i]=e[i],s&&this.invokeModuleCallbacks(i)}return t}saveData(t){this.mergeDeep(this._data,t)}registerModuleCallback(t,e){this._callbackMap[t]||(this._callbackMap[t]=[]),this._callbackMap[t].push(e)}unregisterModuleCallback(t,e){this._callbackMap[t]&&(this._callbackMap[t]=this._callbackMap[t].filter((t=>t!==e)))}invokeModuleCallbacks(t){this._callbackMap[t]&&this._callbackMap[t].forEach((t=>t()))}};U=s([v("fcV-m1clTpK88bUEiz8Jyg")],U);var{regClass:M,property:F}=Laya,O=class extends Laya.Script{onStart(){window.addEventListener("message",(t=>{const e=t.data;if("REACT_MESSAGE"===e.type){if("GAME_READY"===e.data.handle){const t=U.instance.tgData;t.initDataRaw=e.data.initDataRaw,t.startParam=e.data.startParam,t.platform=e.data.platform,t.version=e.data.version,t.isInit=!0}const t=U.instance.tgData,i={type:"GAME_LOG",data:{message:`initDataRaw: ${t.initDataRaw} startParam: ${t.startParam} platform: ${t.platform} laya onPC:${Laya.Browser.onPC}`}};O.sendMessageToWeb(i)}}))}static sendMessageToWeb(t){window.parent!==window&&window.parent.postMessage&&window.parent.postMessage(t,"*")}};O=s([M("1ZbHXoulRJCgzOhnyG97lA")],O);var B=class t{static getConfig(t){return H.instance.getConfig("EggConfig")[t]}static load(){H.instance.loadExcel("resources/json/excel/Excel_EggConfig.json","EggConfig",t)}},X=class t{static getConfig(t){return H.instance.getConfig("ItemConfig")[t]}static load(){H.instance.loadExcel("resources/json/excel/Excel_ItemConfig.json","ItemConfig",t)}},R=class t{static getConfig(t){return H.instance.getConfig("MachineConfig")[t]}static load(){H.instance.loadExcel("resources/json/excel/Excel_MachineConfig.json","MachineConfig",t)}},{regClass:P,property:A}=Laya,G=class{static parseStringArray(t){return t.split(",")}static parseNumberArray(t){return t.split(",").map(Number)}},H=class extends Laya.Script{constructor(){super(),this._initialized=!1,this._configs={}}static get instance(){return H._instance?H._instance:null}get initialized(){return this._initialized}onAwake(){if(H._instance)throw new Error("Singleton class. Use getInstance() instead.");H._instance=this}loadAll(){B.load(),X.load(),R.load(),this._initialized=!0}loadExcel(t,e,i){Laya.loader.load(t,Laya.Handler.create(this,(t=>{const s=t.data,a={};s.forEach((t=>{const e=new i;Object.assign(e,t),a[t.ID]=e})),this._configs[e]=a})),null,Laya.Loader.JSON)}getConfig(t){return this._configs[t]}};H=s([P("YmQd5OnFTbiJU_nWX1ol4w")],H);var{regClass:Y,property:j}=Laya,N=Laya.RigidBody,z=Laya.WeldJoint,Q=Laya.Tween,$=Laya.Ease,V=Laya.Handler,W=class extends Laya.Script{removeJoint(){let t=this.owner.getComponent(z);null!=t&&t.destroy()}removeRigidBody(){let t=this.owner.getComponent(N);null!=t&&t.destroy()}init(){if(null!=this.cartoonFace&&null!=this.eggID){const t=this.eggID.charCodeAt(this.eggID.length-1);this.cartoonFace.build(t)}else console.log("cartoonFace or eggID is null")}buildJoint(t){let e=new z;e.selfBody=this.rigidBody,e.otherBody=t,e.collideConnected=!1,e.anchor=[.5,.5],e.frequency=1,e.damping=1,this.owner.addComponentInstance(e),this.rigidBody.allowRotation=!0}clear(){this.removeRigidBody(),Q.to(this.owner,{y:this.owner.y+1e3},1200+200*Math.random(),$.backIn,V.create(this,(()=>{this.owner.destroy()})))}onUpdate(){this.owner.y>3e3&&(this.machinePhysics.removeEgg(this.eggID),console.log("force remove egg "+this.eggID))}};s([j(N)],W.prototype,"rigidBody",2),s([j(g)],W.prototype,"cartoonFace",2),W=s([Y("rkcx43mVQBOkTeNwD9ERHQ")],W);var{regClass:J,property:K}=Laya,q=class extends Laya.Script{constructor(){super(...arguments),this._iconScale=0,this._iconOriginY=0}clearEgg(){this.stopIconBounceAnimation(),null!=this._curEgg&&(this._curEgg.owner.destroy(),this._curEgg=null)}buildEgg(t,e,i,s){this.onLoadCompleteCallback=s,this.owner.width=e,this.owner.height=i,this._eggConfig=B.getConfig(t),Laya.loader.load(this._eggConfig.Prefab).then((t=>{let e=t.create();e.anchorX=.5,e.anchorY=.5,this.owner.addChild(e);let i=this.owner.width,s=this.owner.height,a=1.2*e.width,n=1.2*e.height,o=i/a,r=s/n,h=Math.min(o,r);e.scale(h,h,!0),e.pos(i/2,s/2+n/2),e.anchorY=1;const c=e.getComponent(W);c.removeRigidBody(),this._curEgg=c,this._eggSprite=e,this._iconScale=this._eggSprite.scaleY,this._iconOriginY=this._eggSprite.y,this.onLoadCompleteCallback()}))}stopIconBounceAnimation(){Laya.Tween.clearTween(this._curEgg.owner)}startIconBounceAnimationIncubation(){if(this.stopIconBounceAnimation(),null==this._curEgg)return;const t=()=>{Laya.Tween.to(this._curEgg.owner,{scaleX:1.1*this._iconScale,scaleY:.8*this._iconScale},1e3,Laya.Ease.linearInOut,Laya.Handler.create(this,e))},e=()=>{Laya.Tween.to(this._curEgg.owner,{scaleX:this._iconScale,scaleY:this._iconScale},1e3,Laya.Ease.linearInOut,Laya.Handler.create(this,t))};t()}startIconBounceAnimationReady(){if(this.stopIconBounceAnimation(),null==this._curEgg)return;const t=()=>{Laya.Tween.to(this._curEgg.owner,{scaleX:1.1*this._iconScale,scaleY:.8*this._iconScale},1e3,Laya.Ease.backOut,Laya.Handler.create(this,e))},e=()=>{Laya.Tween.to(this._curEgg.owner,{scaleX:1*this._iconScale,scaleY:1*this._iconScale,y:this._iconOriginY-100},200,Laya.Ease.circInOut,Laya.Handler.create(this,i))},i=()=>{Laya.Tween.to(this._curEgg.owner,{scaleX:1*this._iconScale,scaleY:1*this._iconScale,y:this._iconOriginY},1e3,Laya.Ease.bounceOut,Laya.Handler.create(this,t))};t()}};q=s([J("nnGeTxJ4Q_GhohA2o0D7oQ")],q);var{regClass:Z,property:tt}=Laya,et=class extends Laya.Script{constructor(){super(...arguments),this.moveSpeed=2,this.direction=1}onAwake(){this.minY=this.owner.y-20,this.maxY=this.owner.y+20}onUpdate(){this.owner.y+=this.moveSpeed*this.direction,this.owner.y>=this.maxY?this.direction=-1:this.owner.y<=this.minY&&(this.direction=1)}};et=s([Z("6e9BXDZiQn-RSSxV5cRK1g")],et);var{regClass:it,property:st}=Laya,at=Laya.SoundManager,nt=class{static playMusic(t){at.playMusic(this._musicList[t],1e4),Laya.stage.on(Laya.Event.BLUR,this,(()=>{at.stopMusic()})),Laya.stage.on(Laya.Event.FOCUS,this,(()=>{at.playMusic(this._musicList[t],1e4)}))}static stopMusic(){at.stopMusic()}static playSoundFX(t){at.playSound(this._soundFXList[t])}static stopSoundFX(t){at.stopSound(this._soundFXList[t])}};nt._musicList={MUSIC_1000:"resources/sound/music/MUSIC_1000.mp3",MUSIC_1000_HappyHour:"resources/sound/music/MUSIC_1000_HappyHour.mp3"},nt._soundFXList={SFX_ClaimItem:"resources/sound/sfx/SFX_ClaimItem.mp3",SFX_EggFind01:"resources/sound/sfx/SFX_EggFind01.mp3",SFX_EggFind02:"resources/sound/sfx/SFX_EggFind02.mp3",SFX_ButtonClick01:"resources/sound/sfx/SFX_ButtonClick01.mp3",SFX_ClawDropping:"resources/sound/sfx/SFX_ClawDropping.wav",SFX_ClawGrabbing:"resources/sound/sfx/SFX_ClawGrabbing.wav",SFX_Voice01:"resources/sound/sfx/SFX_Voice01.mp3",SFX_Voice02:"resources/sound/sfx/SFX_Voice02.mp3",SFX_Voice03:"resources/sound/sfx/SFX_Voice03.mp3",SFX_Failed:"resources/sound/sfx/SFX_Failed.mp3",SFX_Ping:"resources/sound/sfx/SFX_Ping.wav",SFX_Gold01:"resources/sound/sfx/SFX_Gold01.mp3",SFX_Gold02:"resources/sound/sfx/SFX_Gold02.mp3",SFX_Gold03:"resources/sound/sfx/SFX_Gold03.mp3",SFX_Gem01:"resources/sound/sfx/SFX_Gem01.mp3",SFX_Gem02:"resources/sound/sfx/SFX_Gem02.wav",SFX_ItemDrop:"resources/sound/sfx/SFX_ItemDrop.mp3",SFX_UnlockEggIncuabtion:"resources/sound/sfx/SFX_UnlockEggIncuabtion.wav"},nt=s([it("nqDjq5ZVQJOFBV76vcnISg")],nt);var ot=class{static randomRange(t,e){return Math.floor(Math.random()*(e-t+1)+t)}},{regClass:rt,property:ht}=Laya,ct=Laya.Animator2D,lt=Laya.Sprite,gt=Laya.Event,dt=Laya.RigidBody,ut=Laya.Tween,pt=Laya.Ease,_t=Laya.Handler,mt=Laya.Point,yt=Laya.Label;var wt=class extends Laya.Script{constructor(){super(...arguments),this.isPicking=!1,this._clawState=0}onDisable(){this.intersectionTestBox.off(gt.TRIGGER_ENTER,this,this.onIntersectionTestBoxTriggerEnter),this.pickupTestBox.off(gt.TRIGGER_ENTER,this,this.onPickupTestBoxTriggerEnter)}onStart(){this.intersectionTestBox.on(gt.TRIGGER_ENTER,this,this.onIntersectionTestBoxTriggerEnter),this.pickupTestBox.on(gt.TRIGGER_ENTER,this,this.onPickupTestBoxTriggerEnter),this._positionY=this.baseSprite.y,this._lineOrignalHeight=this.lineSprite.height,this.owner.x=20,this.pingpong(),this.changeState(1)}onIntersectionTestBoxTriggerEnter(t,e,i){this.clawFindedEgg=!0}onPickupTestBoxTriggerEnter(t,e,i){if(null==this.findedEgg&&"egg"==t.label&&this._clawState<5){let e=t.owner.getComponent(W);this.findedEgg=e}}updateGameCoinDisplay(){const t=U.instance.runTimeData.machine_coin_data;this.textGameCoin.text=t.getTotalGameCoin().toString(),t.getTotalGameCoin()<=0?this.textGameCoin.color="#FF6480":this.textGameCoin.color="#FFFFFF"}changeState(t){switch(this._clawState=t,t){case 1:this.playAnimation("A_Claw_Idle"),this.isPicking=!1,this.pingpongTween.resume();break;case 2:this.pingpongTween.pause(),this.playAnimation("A_Claw_Open"),this.findedEgg=null,this.curEgg=null,this.moveYDown(),nt.playSoundFX("SFX_ClawDropping");const t=ot.randomRange(1,2);nt.playSoundFX(`SFX_Voice0${t}`);break;case 3:this.downTween.clear(),this.downTween=null,this.playAnimation("A_Claw_DroppingStop");break;case 4:nt.playSoundFX("SFX_ClawGrabbing"),this.playAnimation("A_Claw_Close"),this.connectEgg();break;case 5:this.moveYUp(),this.playAnimation("A_Claw_Idle")}}connectEgg(){if(null!=this.findedEgg){this.curEgg=this.findedEgg,this.findedEgg=null;let t=mt.create();t.x=this.pickupTestBox.width*this.pickupTestBox.anchorX,t.y=this.pickupTestBox.height*this.pickupTestBox.anchorY,t=this.pickupTestBox.localToGlobal(t);let e=mt.create();e.x=this.curEgg.owner.width*this.curEgg.owner.anchorX,e.y=this.curEgg.owner.height*this.curEgg.owner.anchorY,e=this.curEgg.owner.localToGlobal(e);let i=mt.create();i.x=this.curEgg.owner.x+(t.x-e.x),i.y=this.curEgg.owner.y+(t.y-e.y),ut.to(this.curEgg.owner,{x:i.x,y:i.y},200,pt.linearNone,_t.create(this,(()=>{this.curEgg.buildJoint(this.pickupTestRigidBody)})))}}grab(){this.isPicking||(this.clawFindedEgg=!1,this.isPicking=!0,(()=>{a(this,null,(function*(){const t=function(t){return o(this,null,(function*(){for(t.changeState(2);!t.clawFindedEgg;)yield new n(new Promise((t=>setTimeout(t,100))));for(t.changeState(3),t.waittingTime=0;t.waittingTime<200;)yield new n(new Promise((t=>setTimeout(t,100)))),t.waittingTime+=100;for(t.changeState(4),t.waittingTime=0;t.waittingTime<1e3;)yield new n(new Promise((t=>setTimeout(t,100)))),t.waittingTime+=100;for(t.changeState(5),t.waittingTime=0;t.waittingTime<3e3;)yield new n(new Promise((t=>setTimeout(t,100)))),t.waittingTime+=100;t.changeState(1)}))}(this);try{for(var e,i,s,a=r(t);e=!(i=yield a.next()).done;e=!1){const t=i.value;console.log(t)}}catch(i){s=[i]}finally{try{e&&(i=a.return)&&(yield i.call(a))}finally{if(s)throw s[0]}}}))})())}playAnimation(t){this.animator.play(t)}moveYDown(){this.downTween=ut.to(this.baseSprite,{y:1100},2e3,pt.linearNone,_t.create(this,(()=>{this.clawFindedEgg=!0})))}pingpong(){this.pingpongTween=ut.to(this.owner,{x:680},2e3,pt.linearNone,_t.create(this,(()=>{this.pingpongTween=ut.to(this.owner,{x:-50},2e3,pt.linearNone,_t.create(this,(()=>{this.pingpong()})))})))}moveYUp(){ut.to(this.baseSprite,{y:this._positionY},2e3,pt.backIn,_t.create(this,(()=>{null!=this.curEgg&&(null!=this.onFoundEggCallback&&this.onFoundEggCallback(this.curEgg.eggID),this.curEgg=null),this.clawFindedEgg=!0})))}onLateUpdate(){1==this._clawState||2!=this._clawState&&5!=this._clawState||(this.lineSprite.height=this.baseSprite.y-this._positionY+this._lineOrignalHeight)}};s([ht(lt)],wt.prototype,"clawLeft",2),s([ht(lt)],wt.prototype,"clawRight",2),s([ht({type:ct})],wt.prototype,"animator",2),s([ht(lt)],wt.prototype,"intersectionTestBox",2),s([ht(lt)],wt.prototype,"pickupTestBox",2),s([ht(dt)],wt.prototype,"pickupTestRigidBody",2),s([ht(lt)],wt.prototype,"lineSprite",2),s([ht(lt)],wt.prototype,"baseSprite",2),s([ht(yt)],wt.prototype,"textGameCoin",2),wt=s([rt("pneh_T95RWiOY4p54TqJ9g")],wt);var Ct=class{constructor(t,e,i,s){this._endTime=t,this.onStartedCallback=e,this.onTickCallback=i,this.onCompleteCallback=s}restart(t){this._endTime=t,this.start()}start(){Laya.timer.loop(1e3,this,this.update);const t=this.getRemainingTime();this.onStartedCallback(this.formatTime(t),t)}getRemainingTime(){const t=Math.floor(Date.now()/1e3);return this._endTime-t}update(){const t=this.getRemainingTime();this.onTickCallback(this.formatTime(t),t),t<=0&&(this.stop(),this.onCompleteCallback())}stop(){Laya.timer.clear(this,this.update)}formatTime(t){const e=t,i=Math.floor(e/3600),s=Math.floor(e%3600/60),a=e%60;return`${i.toString().padStart(2,"0")}:${s.toString().padStart(2,"0")}:${a.toString().padStart(2,"0")}`}},ft=Laya.Tween,It=Laya.Ease,bt=class extends Laya.Script{constructor(){super(),this._view=null}set uiManager(t){this._uiManager=t}get uiManager(){return this._uiManager}get view(){return this._view}set view(t){this._view=t}set param(t){this._param=t}get param(){return this._param}get config(){return this._config}set config(t){this._config=t}initUI(){let t=this.view;t&&(t.displayObject.anchorX=.5,t.displayObject.anchorY=.5,t.displayObject.x=.5*this.uiManager.pageWidth,t.displayObject.y=.5*this.uiManager.pageHeight,this._originScaleX=t.displayObject.scaleX,this._originScaleY=t.displayObject.scaleY);let e=this.view.getChild("B_BackgroundClose");e&&e.onClick(this,this.pop);let i=this.view.getChild("B_Close");i&&i.onClick(this,this.pop);let s=this.view.getChild("B_OK");s&&s.onClick(this,this.pop)}open(t){this.param=t,this.willOpen(),this.enabled=!0,this.view.visible=!0,this.didOpen()}isOpened(){return this.enabled}willOpen(){this._config.withBackground&&(this.uiManager.openBackground(),this.view.displayObject.scaleX=this._originScaleX,this.view.displayObject.scaleY=this._originScaleY,ft.clearAll(this.view.displayObject),ft.from(this.view.displayObject,{scaleX:0,scaleY:0},388,It.backOut,Laya.Handler.create(this,(()=>{console.log("Open Tween")}))))}didOpen(){}forceClose(){this._config.withBackground&&this.uiManager.closeBackground(),this.willClose(),this.didClose(),this.enabled=!1,this.view.visible=!1}pop(){this.uiManager.popLastUI()}popTips(){this.uiManager.popLastTips()}close(){this.willClose(),this._config.withBackground?(ft.clearAll(this.view.displayObject),ft.to(this.view.displayObject,{scaleX:0,scaleY:0},388,It.backIn,Laya.Handler.create(this,(()=>{this.uiManager.closeBackground(),this.didClose(),this.enabled=!1,this.view.visible=!1})))):(this.didClose(),this.enabled=!1,this.view.visible=!1)}didClose(){}willClose(){}},St=class extends bt{initUI(){super.initUI();let t=this.view.getChild("B_BackgroundCloseForBlackBG");t&&t.onClick(this,this.closeBackground)}closeBackground(){this.uiManager.forceCloseBackground()}},{regClass:xt,property:Lt}=Laya,Tt=class{constructor(t){this.pool=[],this.maxSize=t}getParticle(t,e,i,s){let a;return this.pool.length>0?(a=this.pool.pop(),a.reset(t,e,i)):a=new s(t,e,i),a}returnParticle(t){this.pool.length<this.maxSize&&this.pool.push(t)}},Et=class{constructor(t,e,i,s){this.reset(t,e,i),this.isLoop=s}setSize(t,e){this.minSize=t,this.maxSize=e}setLife(t,e){this.minLife=t,this.maxLife=e}reset(t,e,i){this.x=t,this.y=e,this.texture=i,this.width=i.width,this.height=i.height}isAlive(){return this.isLoop||this.life>0&&this.alpha>0}draw(t){t.graphics.drawTexture(this.texture,this.x-this.width*this.size/2,this.y-this.height*this.size/2,this.width*this.size,this.height*this.size,null,this.alpha)}},kt=class{constructor(t,e){this.particles=[],this.texture=t,this.maxParticles=e,this.pool=new Tt(e)}emit(t,e,i,s=1){for(let a=0;a<s;a++)if(this.particles.length<this.maxParticles){const s=this.pool.getParticle(t,e,this.texture,i);this.particles.push(s)}}update(){for(let t=this.particles.length-1;t>=0;t--)this.updateParticle(this.particles[t],t)}updateParticle(t,e){t.update(),t.isAlive()||(this.pool.returnParticle(t),this.particles.splice(e,1))}draw(t){t.graphics.clear(),this.particles.forEach((e=>e.draw(t)))}isAllLive(){let t=!1;for(let e=this.particles.length-1;e>=0;e--)if(this.particles[e].isAlive())return t=!0,t;return t}},{regClass:vt,property:Dt}=Laya,Ut=class extends Et{constructor(t,e,i){super(t,e,i,!1),this.gravity=.2}reset(t,e,i){const s=150*Math.random()-75,a=150*Math.random()-75;super.reset(s,a,i),this.setLife(100,200),this.setSize(.5,1),this.life=Math.random()*(this.maxLife-this.minLife)+this.minLife,this.fixedLife=this.life;const n=Math.random()*Math.PI*2,o=10*Math.random()+2;this.vx=Math.cos(n)*o,this.vy=Math.sin(n)*o,this.startSize=1,this.endSize=3,this.startAlpha=1,this.endAlpha=0;const r=Math.random(),h=Math.random(),c=Math.random();this.color=`rgba(${Math.floor(255*r)}, ${Math.floor(255*h)}, ${Math.floor(255*c)}, 1)`,this.size=this.startSize,this.alpha=this.startAlpha}update(){this.x+=this.vx,this.y+=this.vy,this.vy+=this.gravity;const t=1-this.life/this.fixedLife;this.size=this.startSize+(this.endSize-this.startSize)*t,this.alpha=this.startAlpha-(this.startAlpha-this.endAlpha)*t,this.life-=1,this.life<=0&&(this.alpha=0)}draw(t){t.graphics.drawTexture(this.texture,this.x-this.width*this.size/2,this.y-this.height*this.size/2,this.width*this.size,this.height*this.size,null,this.alpha,this.color)}},Mt=class extends Laya.Script{onStart(){const t=this.owner.texture;this.owner.texture=null,this.particleSystem=new kt(t,20),Laya.timer.frameLoop(1,this,this.onParticleUpdate)}emit(){this.particleSystem.emit(0,0,Ut,20)}onTextureLoaded(){}onParticleUpdate(){this.particleSystem.update(),this.particleSystem.draw(this.owner)}};Mt=s([vt("TFSmKJ9qS7e3rXvq2nuTug")],Mt);var Ft=class extends bt{initUI(){super.initUI(),this._loaderItemIcon=this.view.getChild("LOADER_ItemIcon").asLoader,this._imgWindow=this.view.getChild("IMG_Window").asImage,this._textCount=this.view.getChild("TEXT_Count").asLabel,this._textName=this.view.getChild("TEXT_Name").asLabel,this._fxRoot=this.view.getChild("IMG_FXRoot").asGraph,this._originX=this._loaderItemIcon.displayObject.x,this._originY=this._loaderItemIcon.displayObject.y,Laya.loader.load("resources/prefabs/fx/P_FXExplosion.lh").then((t=>{let e=t.create();e.anchorX=.5,e.anchorY=1,this._fxRoot.displayObject.addChild(e);let i=this._fxRoot.displayObject.width,s=this._fxRoot.displayObject.height,a=i/e.width,n=s/e.height,o=Math.min(a,n);e.scale(o,o,!0),e.pos(i,s/2),this._fxExplosion=e.getChildAt(0).getComponent(Mt)}))}didClose(){super.didClose(),this.clearIcon(),this.stopIconBounceAnimation()}didOpen(){this.buildIcon(this.param.itemID,this.param.count),this._fxExplosion.emit()}buildIcon(t,e){const i=X.getConfig(t);i&&(this._loaderItemIcon.url=i.Texture,this._loaderItemIcon.displayObject.anchorX=.5,this._loaderItemIcon.displayObject.anchorY=.5,this._loaderItemIcon.displayObject.x=this._originX+.5*this._loaderItemIcon.displayObject.width,this._loaderItemIcon.displayObject.y=this._originY+.5*this._loaderItemIcon.displayObject.height,this._textName.text=i.Name,this._textCount.text=`x ${e}`,this._imgWindow.color=i.Color,this.startIconBounceAnimation(),nt.playSoundFX("SFX_ClaimItem"),nt.playSoundFX(i.Sfx))}clearIcon(){this._loaderItemIcon.url=""}stopIconBounceAnimation(){this._loaderItemIcon&&Laya.Tween.clearTween(this._loaderItemIcon.displayObject)}startIconBounceAnimation(){this.stopIconBounceAnimation();const t=()=>{Laya.Tween.to(this._loaderItemIcon.displayObject,{scaleX:1.1,scaleY:.8},1e3,Laya.Ease.linearInOut,Laya.Handler.create(this,e))},e=()=>{Laya.Tween.to(this._loaderItemIcon.displayObject,{scaleX:1,scaleY:1},1e3,Laya.Ease.linearInOut,Laya.Handler.create(this,t))};t()}},Ot=class extends bt{constructor(){super(...arguments),this._maxOnePageCollectionNumber=9,this._collectionConfigList=[],this._curDisplayList=[]}initUI(){super.initUI(),this._listCollection=this.view.getChild("LIST_Collection").asList,this._listPageSelect=this.view.getChild("LIST_PageSelect").asList,this._textMessage=this.view.getChild("TEXT_Message").asTextField,this._listPageSelect.itemRenderer=Laya.Handler.create(this,this.renderListPageSelect,null,!1),this._listPageSelect.on(fgui.Events.CLICK_ITEM,this,this.onClickListPageSelectItem),this._listCollection.itemRenderer=Laya.Handler.create(this,this.renderListCollection,null,!1),this._listCollection.on(fgui.Events.CLICK_ITEM,this,this.onClickItem)}didOpen(){super.didOpen();const t=U.instance.runTimeData.machine_data.id,e=R.getConfig(t),i=G.parseStringArray(e.CollectionList);this._collectionConfigList=i;let s=i.length/this._maxOnePageCollectionNumber;i.length%this._maxOnePageCollectionNumber!=0&&(s+=1),this._listPageSelect.numItems=s,this._listPageSelect.selectedIndex=0,this.refreshCollectionByBageIndex(this._listPageSelect.selectedIndex),this._textMessage.text=`You have: [color=#ffff99]${U.instance.runTimeData.machine_collection.getItemCount()}/${this._collectionConfigList.length}[/color]`}renderListCollection(t,e){const i=X.getConfig(this._curDisplayList[t]),s=e.asCom.getChild("LOADER_ItemIcon").asLoader;s.url=i.Texture;const a=e.asCom.getChild("TEXT_Count").asLabel,n=U.instance.runTimeData.machine_collection.getItemCountById(i.ID);n>0?(s.color="#FFFFFF",a.text="x"+n):(a.text="",s.color="#000000"),e.data=i.ID}refreshCollectionByBageIndex(t){this._listCollection.numItems=0,this._curDisplayList=[];let e=t*this._maxOnePageCollectionNumber,i=(t+1)*this._maxOnePageCollectionNumber;for(let t=e;t<i&&!(t>=this._collectionConfigList.length);t++){X.getConfig(this._collectionConfigList[t])&&this._curDisplayList.push(this._collectionConfigList[t])}this._listCollection.numItems=this._curDisplayList.length}onClickListPageSelectItem(){this.refreshCollectionByBageIndex(this._listPageSelect.selectedIndex)}onClickItem(t){const e=t.data,i=U.instance.runTimeData.machine_collection.getItemCountById(e);i>0?ee.instance.pushUI("UI_ShowItem_HUD",{itemID:e,count:i}):ee.instance.ShowMessageBox("You don't have this item",null)}renderListPageSelect(t,e){const i=e.asButton,s=i.getChild("TEXT_N1").asLabel,a=i.getChild("TEXT_N2").asLabel;s.text=""+(t+1),a.text=""+(t+1)}},Bt=class extends bt{constructor(){super(...arguments),this._time=0,this._offsetScale=.1,this._isMaterialLoaded=!1}onAwake(){this._time=0,this._isMaterialLoaded=!1}onStart(){}},Xt=class extends bt{},Rt=class extends bt{},Pt=class extends bt{},At=class extends bt{initUI(){super.initUI(),this._textMessage=this.view.getChild("TEXT_Message").asTextField}didOpen(){super.didOpen(),this._textMessage.text=this.param.content}},Gt=class extends bt{constructor(){super(...arguments),this._iconScale=0,this._iconOriginY=0}initUI(){super.initUI(),this._textCooldownTime=this.view.getChild("TEXT_CooldownTime").asTextField,this._imgEggRoot=this.view.getChild("IMG_EggRoot").asGraph,this._pbEggIncuabtionProgress=this.view.getChild("PB_Eggincuabtion").asProgress}didOpen(){this.setIncubationIndex(this.param.incubationIndex)}setIncubationIndex(t){const e=U.instance.runTimeData.machine_data;e.incubation_list.length<=0?this.pop():(this._incubationData=e.incubation_list[t],this.initIcon(this._incubationData),this.initTimeShower())}clear(){null!=this._countdownTimer&&(this._countdownTimer.stop(),this._countdownTimer=null),this._textCooldownTime.text="",this.stopIconBounceAnimation(),this._eggSprite&&(this._eggSprite.destroy(),this._eggSprite=null),this._incubationData=null}didClose(){super.didClose(),this.clear()}initIcon(t){this._eggConfig=B.getConfig(t.config_id),Laya.loader.load(this._eggConfig.Prefab).then((e=>{let i=e.create();i.anchorX=.5,i.anchorY=1,this._imgEggRoot.displayObject.addChild(i);let s=this._imgEggRoot.displayObject.width,a=this._imgEggRoot.displayObject.height,n=s/(1.2*i.width),o=a/(1.2*i.height),r=Math.min(n,o);i.scale(r,r,!0),i.pos(s/2,a-30);const h=i.getComponent(W);h.removeRigidBody(),h.eggID=t.egg_id,h.init(),this._eggSprite=i,this._iconScale=this._eggSprite.scaleY,this._iconOriginY=this._eggSprite.y,this._pbEggIncuabtionProgress.min=0,this._pbEggIncuabtionProgress.max=this._eggConfig.IncubationTime,this.startIconBounceAnimation(),nt.playSoundFX(this._eggConfig.Sfx)}))}stopIconBounceAnimation(){this._eggSprite&&Laya.Tween.clearTween(this._eggSprite)}startIconBounceAnimation(){this.stopIconBounceAnimation();const t=()=>{Laya.Tween.to(this._eggSprite,{scaleX:1.1*this._iconScale,scaleY:.8*this._iconScale},1e3,Laya.Ease.linearInOut,Laya.Handler.create(this,e))},e=()=>{Laya.Tween.to(this._eggSprite,{scaleX:this._iconScale,scaleY:this._iconScale},1e3,Laya.Ease.linearInOut,Laya.Handler.create(this,t))};t()}initTimeShower(){null==this._countdownTimer?(this._countdownTimer=new Ct(this._incubationData.maturation_at.T,((t,e)=>{this._textCooldownTime.text=`${t}`,this._pbEggIncuabtionProgress.value=e}),((t,e)=>{this._textCooldownTime.text=`${t}`,this._pbEggIncuabtionProgress.value=e}),(()=>{this.pop()})),this._countdownTimer.start()):this._countdownTimer.restart(this._incubationData.maturation_at.T)}},Ht=class extends bt{constructor(){super(...arguments),this._curRank=0}initUI(){super.initUI(),this._loaderItemIcon=this.view.getChild("LOADER_ItemIcon").asLoader,this._listStars=this.view.getChild("LIST_Stars").asList,this._listStars.itemRenderer=Laya.Handler.create(this,this.renderStars,null,!1),this._textName=this.view.getChild("TEXT_Name").asLabel,this._textdiscription=this.view.getChild("TEXT_Discription").asLabel,this._originX=this._loaderItemIcon.displayObject.x,this._originY=this._loaderItemIcon.displayObject.y}didOpen(){super.didOpen();const t=this.param.itemID;this.buildDisplay(t,this.param.count.toString())}willClose(){super.willClose(),this.clearIcon()}buildDisplay(t,e){const i=X.getConfig(t);i&&(this._textName.text=`${i.Name} [color=#FFFF99]x ${e}[/color]`,this._textdiscription.text=i.Discription,this._loaderItemIcon.url=i.Texture,this._loaderItemIcon.displayObject.anchorX=.5,this._loaderItemIcon.displayObject.anchorY=.5,this._loaderItemIcon.displayObject.x=this._originX+.5*this._loaderItemIcon.displayObject.width,this._loaderItemIcon.displayObject.y=this._originY+.5*this._loaderItemIcon.displayObject.height,this.startIconBounceAnimation(),this._curRank=i.Rank,this._listStars.numItems=0,this._listStars.numItems=5)}clearIcon(){this._loaderItemIcon.url="",this.stopIconBounceAnimation()}stopIconBounceAnimation(){this._loaderItemIcon&&Laya.Tween.clearTween(this._loaderItemIcon.displayObject)}renderStars(t,e){this._curRank-1>=t&&(e.asCom.getChild("IMAGE_Star").asGraph.color="#FFFF99")}startIconBounceAnimation(){this.stopIconBounceAnimation();const t=()=>{Laya.Tween.to(this._loaderItemIcon.displayObject,{scaleX:1.1,scaleY:.95},1e3,Laya.Ease.linearInOut,Laya.Handler.create(this,e))},e=()=>{Laya.Tween.to(this._loaderItemIcon.displayObject,{scaleX:1,scaleY:1},1e3,Laya.Ease.linearInOut,Laya.Handler.create(this,t))};t()}},Yt=class extends bt{},jt=Laya.Tween,Nt=Laya.Ease,zt=Laya.Handler,Qt=class extends bt{constructor(){super(...arguments),this._originY=0}initUI(){super.initUI(),this._textMessage=this.view.getChild("TEXT_Message").asTextField,this._originY=this.view.displayObject.y}didClose(){super.didClose(),jt.clearAll(this.view.displayObject),Laya.timer.clearAll(this)}didOpen(){super.didOpen(),this._textMessage.text=this.param.content,this.view.displayObject.y=this._originY,jt.from(this.view.displayObject,{y:-100},600,Nt.backOut,zt.create(this,(()=>{Laya.timer.once(2e3,this,(()=>{jt.to(this.view.displayObject,{y:-100},600,Nt.backIn,zt.create(this,(()=>{this.popTips()})))}))})))}},{regClass:$t,property:Vt}=Laya,Wt=class extends Laya.Script{constructor(){super(),this.baseUrl="https://seed-test.9x9168.com:9100"}static get instance(){return Wt._instance?Wt._instance:null}get(t,e={},i,s=null,a=null){const n=this.buildUrl(t,e),o=new Laya.HttpRequest;o.once(Laya.Event.COMPLETE,self,(t=>{0==t.err_no?(U.instance.saveData(t.data),i&&i(t.data)):s&&s(t.data)})),o.once(Laya.Event.ERROR,self,(t=>{s&&s(t.data)})),o.on(Laya.Event.PROGRESS,self,(t=>{a&&a(t.data)}));const r=this._session?["Authorization",""+this._session]:[];o.send(n,null,"get","json",r)}post(t,e,i,s=null,a=null){const n=this.baseUrl+t,o=new Laya.HttpRequest;o.http.timeout=1e4,o.once(Laya.Event.COMPLETE,self,(t=>{null!=t.data&&null!=t.data.game_session&&(this._session=t.data.game_session),0==t.err_no?(U.instance.saveData(t.data),i&&i(t.data)):s&&s(t.err_msg)})),o.once(Laya.Event.ERROR,self,(t=>{s&&s(t.data)})),o.once(Laya.Event.PROGRESS,self,(t=>{a&&a(t.data)}));const r=this._session?["Authorization",""+this._session]:[];o.send(n,e,"post","json",r)}buildUrl(t,e){let i=this.baseUrl+t;const s=Object.keys(e).map((t=>`${encodeURIComponent(t)}=${encodeURIComponent(e[t])}`)).join("&");return s&&(i+="?"+s),i}onAwake(){if(Wt._instance)throw new Error("Singleton class. Use getInstance() instead.");Wt._instance=this}};function Jt(t,e,i){return new Promise(((s,a)=>{t.post(e,i,(t=>{s(t)}),(t=>{a(t)}))}))}Wt=s([$t("DGCskiILRi65QciOt7TFbg")],Wt);var Kt=class extends bt{initUI(){super.initUI(),this._bPointUnlock=this.view.getChild("B_PointUnlock").asButton,this._bPointUnlock.onClick(this,(()=>{this.onUnlock()})),this._bGemUnlock=this.view.getChild("B_GemUnlock").asButton,this._bGemUnlock.onClick(this,(()=>{this.onUnlock()}))}onUnlock(){const t={machine_id:U.instance.runTimeData.machine_data.id};Wt.instance.post("/v1/session/unlock_egg_incubation",t,(t=>{U.instance.machine.updateDisplay(),ee.instance.popLastUI(),ee.instance.ShowMessageBox("successfully!",null),nt.playSoundFX("SFX_UnlockEggIncuabtion")}),(t=>{ee.instance.ShowMessageBox(t,null)}))}didOpen(){super.didOpen();const t=U.instance.runTimeData.machine_data,e=t.getIncubationDataCount(),i=R.getConfig(t.id),s=G.parseStringArray(i.UnlockIncubatorCost),a=s[2*e],n=s[2*e+1];switch(a){case"point":this._bPointUnlock.visible=!0,this._bGemUnlock.visible=!1,this._bPointUnlock.getChild("title0").asTextField.text=n,this._bPointUnlock.getChild("title1").asTextField.text=n;break;case"gem":this._bPointUnlock.visible=!1,this._bGemUnlock.visible=!0,this._bGemUnlock.getChild("title0").asTextField.text=n,this._bGemUnlock.getChild("title1").asTextField.text=n}}},qt=class{constructor(){this._classMap={UI_FX_Layer_HUD:Xt,UI_Loading_HUD:Pt,UI_MessageBoxOne_HUD:At,UI_Invite_Friends_HUD:Rt,UI_FX_Coin_Background_HUD:Bt,UI_Tips_HUD:Qt,UI_Task_HUD:Yt,UI_Background_HUD:St,UI_ShowItem_HUD:Ht,UI_ShowEggIncuabtion_HUD:Gt,UI_UnlockEggIncuabtion_HUD:Kt,UI_Collection_HUD:Ot,UI_ClaimItem_HUD:Ft}}instantiate(t){const e=this._classMap[t];return e?new e:void 0}},{regClass:Zt,property:te}=Laya,ee=class extends Laya.Script{constructor(){super(),this._viewsDictionary={},this._uibaseDictionary={},this._initialized=!1,this._isBackgroundOpen=0,this._uiQueue=[],this._tipsQueue=[],this.pageWidth=Laya.stage.designHeight*Laya.Browser.clientWidth/Laya.Browser.clientHeight,this.pageHeight=Laya.stage.designHeight}static get instance(){return ee._instance?ee._instance:null}get initialized(){return this._initialized}onAwake(){if(ee._instance)throw new Error("Singleton class. Use getInstance() instead.");ee._instance=this,this.ownerPanel=this.owner}init(){this._uiDefine=new qt,this.initFont(),Laya.loader.load("resources/prefabs/ui/P_UIRoot.lh").then((t=>{let e=t.create();this.ownerPanel.addChild(e),e.addChild(fgui.GRoot.inst.displayObject),e.zOrder=100,e.width=this.pageWidth,Laya.loader.load("resources/json/Data_UI_Config.json").then((t=>{this._uiConfigData=t.data;let e=[];for(let t=0;t<this._uiConfigData.packageConfigs.length;t++){const i=this._uiConfigData.packageConfigs[t];e.push(this._uiConfigData.uiBasePath+i)}fgui.UIPackage.loadPackage(e,Laya.Handler.create(this,this.onUILoaded))}))}))}initFont(){fairygui.UIConfig.defaultFont="TitanOne-Regular",Laya.loader.load("resources/font/TitanOne-Regular.ttf",Laya.Handler.create(this,(t=>{fairygui.UIConfig.defaultFont=t.fontName,Laya.Text.defaultFont=t.fontName})),null,Laya.Loader.TTF)}onUILoaded(){for(let t=0;t<this._uiConfigData.uiConfigs.length;t++){const e=this._uiConfigData.uiConfigs[t];let i=fgui.UIPackage.createObject(e.uiPackage,e.uiName).asCom;i.makeFullScreen(),i.sortingOrder=e.layer,fgui.GRoot.inst.addChild(i);let s=this._uiDefine.instantiate(e.uiName);if(s){i.displayObject.addComponentInstance(s)||console.error("Component not found: "+e.uiName),s.uiManager=this,s.view=i,s.config=e,s.initUI(),s.forceClose(),this._uibaseDictionary[e.uiName]=s}else console.error("UIBase not found: "+e.uiName);this._viewsDictionary[e.uiName]=i}this._initialized=!0}pushUI(t,e){if(this._uibaseDictionary[t]){if(this._uiQueue.length>0){const t=this._uiQueue[this._uiQueue.length-1];this.forceCloseUI(t.name)}this._uiQueue.push({name:t,data:e}),this.openUI(t,e)}}popLastUI(){if(this._uiQueue.length>0){const t=this._uiQueue.pop();if(this._uiQueue.length>0){this.forceCloseUI(t.name);const e=this._uiQueue[this._uiQueue.length-1];this.openUI(e.name,e.data)}else this.closeUI(t.name)}}pushTips(t,e){if(this._uibaseDictionary[t]){if(this._tipsQueue.length>0){const t=this._tipsQueue[this._tipsQueue.length-1];this.forceCloseUI(t.name)}this._tipsQueue.push({name:t,data:e}),this.openUI(t,e)}}popLastTips(){if(this._tipsQueue.length>0){const t=this._tipsQueue.pop();if(this._tipsQueue.length>0){this.forceCloseUI(t.name);const e=this._tipsQueue[this._tipsQueue.length-1];this.openUI(e.name,e.data)}else this.closeUI(t.name)}}openUI(t,e){return this._uibaseDictionary[t]?(this._uibaseDictionary[t].open(e),this._uibaseDictionary[t]):(console.error("View not found: "+t),null)}closeUI(t){this._uibaseDictionary[t]?this._uibaseDictionary[t].close():console.error("View not found: "+t)}forceCloseUI(t){this._uibaseDictionary[t]?this._uibaseDictionary[t].forceClose():console.error("View not found: "+t)}isOpenedUI(t){return this._uibaseDictionary[t]?this._uibaseDictionary[t].isOpened():(console.error("View not found: "+t),!1)}openBackground(){this._isBackgroundOpen++,this.openUI("UI_Background_HUD",null)}closeBackground(){this._isBackgroundOpen--,this._isBackgroundOpen<=0&&(this._isBackgroundOpen=0,this.closeUI("UI_Background_HUD"))}forceCloseBackground(){this._isBackgroundOpen=0,this.forceCloseUI("UI_Background_HUD")}ShowTips(t){this.pushTips("UI_Tips_HUD",{content:t})}ShowMessageBox(t,e){this.pushUI("UI_MessageBoxOne_HUD",{content:t,callback:e})}};ee=s([Zt("G_pKT3cPTh-KsbcmdsUFMg")],ee);var{regClass:ie,property:se}=Laya,ae=Laya.Label,ne=Laya.Button,oe=Laya.Sprite,re=Laya.Event,he=Laya.Point,ce=class extends Laya.Script{constructor(){super(...arguments),this.index=0,this._curState=0,this._iconScale=0,this._iconOriginY=0}onAwake(){this.setState(1),this.bReady.on(re.CLICK,this,this.onClickReady),this.bInfo.on(re.CLICK,this,this.onClickInfo),this.bUnlock.on(re.CLICK,this,this.onClickUnlock)}onStart(){}onClickInfo(t=null){nt.playSoundFX("SFX_ButtonClick01"),3==this._curState&&ee.instance.pushUI("UI_ShowEggIncuabtion_HUD",{incubationIndex:this.index})}onClickReady(t=null){nt.playSoundFX("SFX_ButtonClick01");let e=he.create();e.x=this.icon.width*this.icon.anchorX,e.y=this.icon.height*this.icon.anchorY,e=this.icon.localToGlobal(e),null!=this.onHarvestEggCallback&&this.onHarvestEggCallback(this.index,e)}onClickUnlock(t=null){nt.playSoundFX("SFX_ButtonClick01"),1==this._curState&&ee.instance.pushUI("UI_UnlockEggIncuabtion_HUD",null)}setState(t){if(this._curState!=t){switch(t){case 1:this.bReady.visible=!1,this.bUnlock.visible=!0,this.icon.visible=!1,this.textCooldownTime.visible=!1,this.clear();break;case 2:this.bReady.visible=!1,this.bUnlock.visible=!1,this.icon.visible=!1,this.textCooldownTime.visible=!1,this.clear();break;case 3:this.bReady.visible=!1,this.bUnlock.visible=!1,this.icon.visible=!0,this.textCooldownTime.visible=!0,this.initTimeShower(),this.initIcon();break;case 4:this.bReady.visible=!0,this.bUnlock.visible=!1,this.icon.visible=!0,this.textCooldownTime.visible=!1,this.initIcon(),this.startIconBounceAnimationReady()}this._curState=t}}clear(){null!=this._countdownTimer&&(this._countdownTimer.stop(),this._countdownTimer=null),this.textCooldownTime.text="",this.stopIconBounceAnimation(),null!=this._curEgg&&(this._curEgg.owner.destroy(),this._curEgg=null)}initIcon(){if(null!=this._curEgg)return;const t=B.getConfig(this._incubationEntry.config_id);Laya.loader.load(t.Prefab).then((t=>{let e=t.create();e.anchorX=.5,e.anchorY=.5,this.icon.addChild(e);let i=this.icon.width,s=this.icon.height,a=i/(1.2*e.width),n=s/(1.2*e.height),o=Math.min(a,n);e.scale(o,o,!0),e.pos(i/2,s/2+80),e.anchorY=1;const r=e.getComponent(W);switch(r.removeRigidBody(),r.eggID=this._incubationEntry.egg_id,r.init(),this._curEgg=r,this._iconScale=e.scaleY,this._iconOriginY=e.y,this._curState){case 3:this.startIconBounceAnimationIncubation();break;case 4:this.startIconBounceAnimationReady()}}))}stopIconBounceAnimation(){Laya.Tween.clearTween(this.icon)}startIconBounceAnimationIncubation(){if(this.stopIconBounceAnimation(),null==this._curEgg)return;const t=()=>{Laya.Tween.to(this._curEgg.owner,{scaleX:1.1*this._iconScale,scaleY:.8*this._iconScale},1e3,Laya.Ease.linearInOut,Laya.Handler.create(this,e))},e=()=>{Laya.Tween.to(this._curEgg.owner,{scaleX:this._iconScale,scaleY:this._iconScale},1e3,Laya.Ease.linearInOut,Laya.Handler.create(this,t))};t()}startIconBounceAnimationReady(){if(this.stopIconBounceAnimation(),null==this._curEgg)return;const t=()=>{Laya.Tween.to(this._curEgg.owner,{scaleX:1.1*this._iconScale,scaleY:.8*this._iconScale},1e3,Laya.Ease.backOut,Laya.Handler.create(this,e))},e=()=>{Laya.Tween.to(this._curEgg.owner,{scaleX:1*this._iconScale,scaleY:1*this._iconScale,y:this._iconOriginY-100},200,Laya.Ease.circInOut,Laya.Handler.create(this,i))},i=()=>{Laya.Tween.to(this._curEgg.owner,{scaleX:1*this._iconScale,scaleY:1*this._iconScale,y:this._iconOriginY},1e3,Laya.Ease.bounceOut,Laya.Handler.create(this,t))};t()}initTimeShower(){null==this._countdownTimer?(this._countdownTimer=new Ct(this._incubationEntry.maturation_at.T,((t,e)=>{this.textCooldownTime.text=`${t}`}),((t,e)=>{this.textCooldownTime.text=`${t}`}),(()=>{this.setState(4)})),this._countdownTimer.start()):this._countdownTimer.restart(this._incubationEntry.maturation_at.T)}updateSlot(t){if(this._incubationEntry=t,t.is_in_progress){Math.floor(Date.now()/1e3)>t.maturation_at.T?this.setState(4):this.setState(3)}else this.setState(2)}onDestroy(){this.stopIconBounceAnimation()}};s([se(ae)],ce.prototype,"textCooldownTime",2),s([se(ne)],ce.prototype,"bReady",2),s([se(ne)],ce.prototype,"bUnlock",2),s([se(ne)],ce.prototype,"bInfo",2),s([se(oe)],ce.prototype,"icon",2),ce=s([ie("-k2-SsuaRu2uvaXAK8ZJzQ")],ce);var le=Laya.Sprite,ge=Laya.RigidBody,de=Laya.ChainCollider,{regClass:ue,property:pe}=Laya,_e=class extends Laya.Script{constructor(){super(),this.pageWidth=Laya.stage.designHeight*Laya.Browser.clientWidth/Laya.Browser.clientHeight,this.pageHeight=Laya.stage.designHeight,this._eggMap={}}onStart(){this.box2D=this.owner,Laya.Config.isAntialias=!0,Laya.Physics2D.I.start(),this.createHouse(),this.createEggs()}createHouse(){let t=new le;this.box2D.addChild(t),t.addComponent(ge).type="static";let e=t.addComponent(de);e.loop=!0;e.datas=[30,0,30,this.owner.height- -10,this.owner.width-30,this.owner.height- -10,this.owner.width-30,0]}addGroup(t,e){switch(e){case 1:t.group=_e.k_smallGroup;break;case 2:t.group=_e.k_middleGroup;break;case 3:t.group=_e.k_largeGroup}}createEggs(){const t=U.instance.runTimeData.machine_data;Object.keys(t.egg_list).forEach((e=>{const i=t.egg_list[e],s=B.getConfig(i.config_id);Laya.loader.load(s.Prefab).then((t=>{let i=s.Scale,a=t.create();a.scale(i,i,!0),a.pos(50+(this.owner.width-50)*Math.random(),300*Math.random()),this.box2D.addChild(a);const n=a.getComponent(ge);n.category=_e.k_triangleCategory,n.mask=_e.k_triangleMask,n.group=1;const o=a.getComponent(W);o.eggID=e,o.machinePhysics=this,o.init(),this._eggMap[e]=o}))}))}removeEgg(t){this._eggMap[t]&&(this._eggMap[t].owner.destroy(),delete this._eggMap[t])}getEgg(t){return this._eggMap[t]}removeAllEggs(){Object.keys(this._eggMap).forEach((t=>{this.removeEgg(t)}))}clearAllEggs(){Object.keys(this._eggMap).forEach((t=>{this.getEgg(t).clear(),delete this._eggMap[t]}))}onDisable(){Laya.Physics2D.I.destroyWorld()}};_e.k_smallGroup=1,_e.k_middleGroup=0,_e.k_largeGroup=-1,_e.k_triangleCategory=2,_e.k_boxCategory=4,_e.k_circleCategory=8,_e.k_triangleMask=15,_e.k_boxMask=15^_e.k_circleCategory,_e.k_circleMask=15,_e=s([ue("DVR1zPUiRceIY6FayhcJTg")],_e);var me=class{static transitionValue(t,e,i=1e3){const s=parseFloat(t.text)||0,a=Laya.Browser.now(),n=()=>{const o=Laya.Browser.now()-a,r=Math.min(o/i,1),h=s+(e-s)*r;t.text=Math.round(h).toString(),r>=1&&Laya.timer.clear(this,n)};Laya.timer.frameLoop(1,this,n)}},ye=Laya.Sprite,we=Laya.Tween,Ce=Laya.Handler,fe=Laya.Ease,Ie=Laya.Point,be=class{constructor(t,e,i,s){this.coins=[],this.width=50,this.height=50,this.coinCount=t,this.target=e,this.range=i,this.width=e.width,this.height=e.height,this.texture=e.texture,this.sfx=s;let a=Ie.create();a.x=e.width*e.anchorX,a.y=e.height*e.anchorY,a=e.localToGlobal(a),this.targetPos={x:a.x,y:a.y}}startEffect(t,e){for(let i=0;i<this.coinCount;i++){const i=this.createCoin();this.coins.push(i),Laya.stage.addChild(i);const s=2*Math.random()*Math.PI,a=Math.random()*this.range,n=t+Math.cos(s)*a,o=e+Math.sin(s)*a;i.pos(n,o),this.animateCoin(i,this.targetPos.x,this.targetPos.y)}}createCoin(){const t=new ye;return t.texture=this.texture,t.width=this.width,t.height=this.height,t}animateCoin(t,e,i){const s=1e3+500*Math.random();we.to(t,{scaleX:1.2,scaleY:1.2},.3*s,fe.cubicInOut,Ce.create(this,(()=>{we.to(t,{x:e,y:i,scaleX:1,scaleY:1},s,fe.cubicIn,Ce.create(this,(()=>{nt.playSoundFX(this.sfx),t.removeSelf()})))})))}},{regClass:Se,property:xe}=Laya,Le=Laya.Sprite,Te=Laya.Event,Ee=Laya.Point,ke=Laya.Label,ve=Laya.Keyboard,De=class extends Laya.Script{constructor(){super(...arguments),this.backgroundOffsetScale=.1,this._arrowDelayTimeCofig=15,this._arrowDelayTime=this._arrowDelayTimeCofig,this._backgroundTime=0,this.foundEgg=t=>{const e=U.instance.runTimeData.machine_data;if(!e.egg_list||!e.egg_list[t])return;const i=e.egg_list[t],s=B.getConfig(i.config_id),a=this.machinePhysics.getEgg(t);let n=Ee.create();n.x=a.owner.width*a.owner.anchorX,n.y=a.owner.height*a.owner.anchorY,n=a.owner.localToGlobal(n);if(U.instance.runTimeData.machine_coin_data.getTotalGameCoin()<=0)return a.removeJoint(),ee.instance.ShowMessageBox("No enough game coin",null),void nt.playSoundFX("SFX_Failed");if(0==e.hasEmptyIncubationSlot()&&s.IncubationTime>0)return a.removeJoint(),ee.instance.ShowMessageBox("No empty incubation slot",null),void nt.playSoundFX("SFX_Failed");const o={machine_id:e.id,egg_id:t};Wt.instance.post("/v1/session/found_egg",o,(t=>{this.updateDisplay(),this.initOrRefreshGameCoinTimeShower(),this.handleFoundEgg(t,n.x,n.y)}),(t=>{ee.instance.ShowMessageBox(t.err_msg,null)})),this.machinePhysics.removeEgg(t)},this.harvestEgg=(t,e)=>{const i={machine_id:U.instance.runTimeData.machine_data.id,incubation_index:t};Wt.instance.post("/v1/session/harvest_egg",i,(t=>{this.updateDisplay(),this.handleHarvestEgg(t,e.x,e.y)}),(t=>{ee.instance.ShowMessageBox(t,null)}))}}onDisable(){}onAwake(){this._backgroundTime=0,this.claw.onFoundEggCallback=this.foundEgg,this._pointFlyEffect=new be(20,this.pointIcon,160,"SFX_Gold03"),this._gemFlyEffect=new be(20,this.gemIcon,180,"SFX_Gem01")}onStart(){this.bGrab.on(Te.CLICK,this,this.onClickGrab),this.bCollection.on(Te.CLICK,this,this.onClickCollection),this._machineID=U.instance.runTimeData.machine_data.id,this.initTimeShower(),this.eventListener(),this.updateDisplay(),this.initOrRefreshGameCoinTimeShower();for(let t=0;t<this.incubationSlotList.length;t++)this.incubationSlotList[t].onHarvestEggCallback=this.harvestEgg;U.instance.machine=this}initTimeShower(){const t=U.instance.runTimeData.machine_data;null==this._resetCoolDownTimer?(this._resetCoolDownTimer=new Ct(t.next_refresh_at.T,((t,e)=>{this.textResetCooldownTime.text=`${t}`}),((t,e)=>{this.textResetCooldownTime.text=`${t}`}),(()=>{this.machinePhysics.clearAllEggs();t.id;U.instance.runTimeData.resetMachineData(),Laya.timer.once(2e3,this,this.resetEggs)})),this._resetCoolDownTimer.start()):this._resetCoolDownTimer.restart(t.next_refresh_at.T)}initOrRefreshGameCoinTimeShower(){const t=U.instance.runTimeData.machine_coin_data;t.updateGameCoin(),null==this._gameCoinCoolDownTimer?(this._gameCoinCoolDownTimer=new Ct(t.game_coin_next_update_at.T,((t,e)=>{this.textGameCoinCooldownTime.text=`${t}`}),((t,e)=>{this.textGameCoinCooldownTime.text=`${t}`}),(()=>{this.initOrRefreshGameCoinTimeShower(),this.updateDisplay()})),this._gameCoinCoolDownTimer.start()):this._gameCoinCoolDownTimer.restart(t.game_coin_next_update_at.T)}resetEggs(){const t={machine_id:this._machineID};Wt.instance.post("/v1/session/update_machine_data",t,(t=>{this.machinePhysics.createEggs(),this.initTimeShower()}),(t=>{ee.instance.ShowMessageBox(t.err_msg,null)}))}updateDisplay(){const t=U.instance.runTimeData.wallet;me.transitionValue(this.textPoint,t.point,2e3),me.transitionValue(this.textGem,t.gem,2e3),this.claw.updateGameCoinDisplay();const e=U.instance.runTimeData.machine_data;for(let t=0;t<e.incubation_list.length;t++)this.incubationSlotList[t].index=t,this.incubationSlotList[t].updateSlot(e.incubation_list[t])}onClickGrab(t=null){nt.playSoundFX("SFX_ButtonClick01"),this.claw.grab(),this.arrow.owner.visible=!1,this._arrowDelayTime=this._arrowDelayTimeCofig}onClickCollection(t=null){nt.playSoundFX("SFX_ButtonClick01"),ee.instance.pushUI("UI_Collection_HUD",null)}onLateUpdate(){let t=Laya.timer.delta/1e3;this._backgroundTime+=t*this.backgroundOffsetScale,this.background.material.setFloat("u_Time",this._backgroundTime),this.grassGround.material.setFloat("u_Time",-this._backgroundTime),this._backgroundTime>Number.MAX_SAFE_INTEGER&&(this._backgroundTime=0),0==this.arrow.owner.visible&&(this._arrowDelayTime-=t,this._arrowDelayTime<=0&&(this.arrow.owner.visible=!0))}handleFoundEgg(t,e,i){switch(B.getConfig(t.response.egg_config_id).ClientHandle){case"point":nt.playSoundFX("SFX_ItemDrop"),ee.instance.pushUI("UI_ClaimItem_HUD",{itemID:t.response.loot_item_id,count:t.response.loot_item_count}),this._pointFlyEffect.startEffect(e,i);break;case"gem":nt.playSoundFX("SFX_ItemDrop"),ee.instance.pushUI("UI_ClaimItem_HUD",{itemID:t.response.loot_item_id,count:t.response.loot_item_count}),this._gemFlyEffect.startEffect(e,i);break;case"egg":ee.instance.pushUI("UI_ShowEggIncuabtion_HUD",{incubationIndex:t.response.incubation_index})}}handleHarvestEgg(t,e,i){ee.instance.pushUI("UI_ClaimItem_HUD",{itemID:t.response.loot_item_id,count:t.response.loot_item_count});switch(X.getConfig(t.response.loot_item_id).ClientHandle){case"point":this._pointFlyEffect.startEffect(e,i);break;case"gem":this._gemFlyEffect.startEffect(e,i)}}eventListener(){Laya.stage.on(Te.KEY_DOWN,this,((t=null)=>{if(t.keyCode===ve.DOWN)this.claw.grab()}))}};s([xe(wt)],De.prototype,"claw",2),s([xe(Le)],De.prototype,"bGrab",2),s([xe(Le)],De.prototype,"bCollection",2),s([xe(Le)],De.prototype,"background",2),s([xe(Le)],De.prototype,"grassGround",2),s([xe({type:Number})],De.prototype,"backgroundOffsetScale",2),s([xe(ke)],De.prototype,"textPoint",2),s([xe(ke)],De.prototype,"textGem",2),s([xe(Le)],De.prototype,"pointIcon",2),s([xe(Le)],De.prototype,"gemIcon",2),s([xe(ke)],De.prototype,"textResetCooldownTime",2),s([xe(ke)],De.prototype,"textGameCoinCooldownTime",2),s([xe(_e)],De.prototype,"machinePhysics",2),s([xe([ce])],De.prototype,"incubationSlotList",2),s([xe(et)],De.prototype,"arrow",2),De=s([Se("m2kViDcTTYmr8Ky4zATsSw")],De);var Ue=class{constructor(t){this.gameStateManager=t}},{regClass:Me,property:Fe}=Laya,Oe=class{static openSplash(){Laya.loader.load("resources/prefabs/ui/P_Splash.lh").then((t=>{let e=t.create();e.anchorX=.5,e.anchorY=.5,Laya.stage.addChild(e);let i=Laya.stage.designHeight*Laya.Browser.clientWidth/Laya.Browser.clientHeight,s=Laya.stage.designHeight,a=i/e.width,n=s/e.height;Math.min(a,n);e.pos(i/2,s/2),Oe.instance=e}))}static closeSplash(){Oe.instance&&(Oe.instance.destroy(),Oe.instance=null)}};function Be(){return o(this,null,(function*(){for(;!H.instance;)yield new n(new Promise((t=>setTimeout(t,100))));for(H.instance.loadAll();!H.instance.initialized;)yield new n(new Promise((t=>setTimeout(t,100))));for(;!ee.instance;)yield new n(new Promise((t=>setTimeout(t,100))));for(ee.instance.init();!ee.instance.initialized;)yield new n(new Promise((t=>setTimeout(t,100))));for(;!Wt.instance;)yield new n(new Promise((t=>setTimeout(t,100))));for(;!U.instance;)yield new n(new Promise((t=>setTimeout(t,100))));const t=U.instance.tgData;if(Laya.Browser.window.location.href.includes("localhost")||Laya.Browser.window.location.href.startsWith("file://"))console.log("当前在编辑器环境中"),t.initDataRaw="query_id=AAFV-CoDAQAAAFX4KgODJr1_&user=%7B%22id%22%3A100000003%2C%22first_name%22%3A%22NNNNiko%22%2C%22last_name%22%3A%22Test%22%2C%22username%22%3A%22niko_test1%22%2C%22language_code%22%3A%22zh-hans%22%2C%22allows_write_to_pm%22%3Atrue%7D&auth_date=1722587152&hash=8e791a997e55723714f73878fdeb27d7e17157f5fb2b460d6fc461f5ce82809c",t.isInit=!0;else{const t={type:"GAME_EVENT",data:{handle:"GAME_READY"}};O.sendMessageToWeb(t)}for(;!t.isInit;)yield new n(new Promise((t=>setTimeout(t,100))));try{const a={init_data_raw:t.initDataRaw};yield new n(Jt(Wt.instance,"/v1/signup_or_login",a)),yield new n((e=Wt.instance,i="/v1/session/login_data_update",s="",new Promise(((t,a)=>{e.get(i,s,(e=>{t(e)}),(t=>{a(t)}))}))));const o={machine_id:"ID_1000"};yield new n(Jt(Wt.instance,"/v1/session/update_machine_data",o)),Ge.instance.changeState(1),yield"StateChanged to MAINMENU"}catch(t){console.error("HTTP request failed:",t),yield"HTTP request failed"}var e,i,s}))}Oe=s([Me("_XACmj2HQ7OSH2UUagT4-Q")],Oe);var Xe=class extends Ue{enter(){Oe.openSplash(),console.log("Entering LoadingState"),(()=>{a(this,null,(function*(){const t=Be();try{for(var e,i,s,a=r(t);e=!(i=yield a.next()).done;e=!1){const t=i.value;console.log(t)}}catch(i){s=[i]}finally{try{e&&(i=a.return)&&(yield i.call(a))}finally{if(s)throw s[0]}}}))})()}exit(){console.log("Exiting LoadingState"),Oe.closeSplash()}update(){}},Re=class extends Ue{enter(){console.log("Entering MainMenuState");const t=U.instance.runTimeData.machine_data.id,e=R.getConfig(t);Laya.loader.load(e.Prefab).then((t=>{let e=t.create();this.gameStateManager.ownerPanel.addChild(e)})),ee.instance.ShowTips(`Welcome come! ${U.instance.runTimeData.user.nick_name}`),nt.playMusic("MUSIC_1000")}exit(){console.log("Exiting MainMenuState")}update(){}},{regClass:Pe,property:Ae}=Laya,Ge=class extends Laya.Script{constructor(){super(),this._states={}}static get instance(){return Ge._instance?Ge._instance:null}changeState(t){this._currentState&&this._currentState.exit(),this._currentState=this._states[t],this._currentState.enter()}onAwake(){if(Ge._instance)throw new Error("Singleton class. Use getInstance() instead.");Ge._instance=this,this.ownerPanel=this.owner,this._states[0]=new Xe(this),this._states[1]=new Re(this),this.changeState(0)}onUpdate(){this._currentState&&this._currentState.update()}};Ge=s([Pe("IjMsviyZT9-45baRHQ_jAg")],Ge);var{regClass:He,property:Ye}=Laya,je=class extends Et{constructor(t,e,i){super(t,e,i,!0)}pingPong(t,e,i){const s=i-e,a=t%(2*s);return a<s?e+a:i-(a-s)}reset(t,e,i){const s=150*Math.random(),a=150*Math.random();super.reset(s,a,i),this.setLife(100,200),this.setSize(.5,1),this.life=Math.random()*(this.maxLife-this.minLife)+this.minLife,this.fixedLife=this.life,this.startSize=1,this.endSize=3,this.startAlpha=0,this.endAlpha=1,this.size=this.startSize,this.alpha=0}update(){const t=1-this.life/this.fixedLife;this.size=this.pingPong(t,this.startSize,this.endSize),this.alpha=this.pingPong(2*t,this.startAlpha,this.endAlpha),this.life-=1,this.isLoop&&this.life<=0&&this.reset(this.x,this.y,this.texture)}},Ne=class extends Laya.Script{onStart(){const t=this.owner.texture;this.owner.texture=null,this.particleSystem=new kt(t,20),this.particleSystem.emit(0,0,je,5),Laya.timer.frameLoop(1,this,this.onParticleUpdate)}onTextureLoaded(){}onParticleUpdate(){this.particleSystem.update(),this.particleSystem.draw(this.owner)}};Ne=s([He("JOuJPy-aRF6Gf2uzJwRh_g")],Ne)})();
//# sourceMappingURL=bundle.js.map