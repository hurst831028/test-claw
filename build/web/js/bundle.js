"use strict";(()=>{var e=Object.defineProperty,t=Object.getOwnPropertyDescriptor,i=(e,t)=>{if(t=Symbol[e])return t;throw Error("Symbol."+e+" is not defined")},a=(i,a,s,o)=>{for(var n,r=o>1?void 0:o?t(a,s):a,l=i.length-1;l>=0;l--)(n=i[l])&&(r=(o?n(a,s,r):n(r))||r);return o&&r&&e(a,s,r),r},s=(e,t,i)=>new Promise(((a,s)=>{var o=e=>{try{r(i.next(e))}catch(e){s(e)}},n=e=>{try{r(i.throw(e))}catch(e){s(e)}},r=e=>e.done?a(e.value):Promise.resolve(e.value).then(o,n);r((i=i.apply(e,t)).next())})),o=function(e,t){this[0]=e,this[1]=t},n=(e,t,i)=>{var a=(e,t,s,n)=>{try{var r=i[e](t),l=(t=r.value)instanceof o,c=r.done;Promise.resolve(l?t[0]:t).then((i=>l?a("return"===e?e:"next",t[1]?{done:i.done,value:i.value}:i,s,n):s({value:i,done:c}))).catch((e=>a("throw",e,s,n)))}catch(e){n(e)}},s=e=>n[e]=t=>new Promise(((i,s)=>a(e,t,i,s))),n={};return i=i.apply(e,t),n[Symbol.asyncIterator]=()=>n,s("next"),s("throw"),s("return"),n},r=(e,t,a)=>(t=e[i("asyncIterator")])?t.call(e):(e=e[i("iterator")](),t={},(a=(i,a)=>(a=e[i])&&(t[i]=t=>new Promise(((i,s,o)=>(t=a.call(e,t),o=t.done,Promise.resolve(t.value).then((e=>i({value:e,done:o})),s))))))("next"),a("return"),t),{regClass:l,property:c}=Laya,h=Laya.RigidBody,g=class extends Laya.Script{};a([c(h)],g.prototype,"rigidBody",2),g=a([l("rkcx43mVQBOkTeNwD9ERHQ")],g);var{regClass:d,property:u}=Laya,p=Laya.Animator2D,y=Laya.Sprite,_=Laya.Event,w=Laya.RigidBody,m=Laya.Tween,f=Laya.Ease,k=Laya.Handler,E=Laya.WeldJoint,b=Laya.MathUtil,C=Laya.Point;var L=class extends Laya.Script{constructor(){super(...arguments),this.isPicking=!1,this.curDir=0,this.curSpeed=0,this._clawState=0}onDisable(){this.intersectionTestBox.off(_.TRIGGER_ENTER,this,this.onIntersectionTestBoxTriggerEnter),this.pickupTestBox.off(_.TRIGGER_ENTER,this,this.onPickupTestBoxTriggerEnter)}onStart(){console.log("Claw"),this.intersectionTestBox.on(_.TRIGGER_ENTER,this,this.onIntersectionTestBoxTriggerEnter),this.pickupTestBox.on(_.TRIGGER_ENTER,this,this.onPickupTestBoxTriggerEnter),this._positionY=this.baseSprite.y,this._lineOrignalHeight=this.lineSprite.height,this.owner.x=20,this.changeState(1)}onIntersectionTestBoxTriggerEnter(e,t,i){this.clawFindedEgg=!0}onPickupTestBoxTriggerEnter(e,t,i){if(null==this.findedEgg&&"egg"==e.label&&this._clawState<5){let t=e.owner.getComponent(g);this.findedEgg=t}}changeState(e){switch(this._clawState=e,e){case 1:this.playAnimation("A_Claw_Idle"),this.isPicking=!1;break;case 2:this.playAnimation("A_Claw_Open"),this.findedEgg=null,this.curEgg=null,this.moveYDown();break;case 3:this.downTween.clear(),this.downTween=null,this.playAnimation("A_Claw_DroppingStop");break;case 4:this.playAnimation("A_Claw_Close"),this.connectEgg();break;case 5:this.moveYUp(),this.playAnimation("A_Claw_Idle")}}connectEgg(){if(null!=this.findedEgg){this.curEgg=this.findedEgg,this.findedEgg=null;let e=C.create();e.x=this.pickupTestBox.width*this.pickupTestBox.anchorX,e.y=this.pickupTestBox.height*this.pickupTestBox.anchorY,e=this.pickupTestBox.localToGlobal(e);let t=C.create();t.x=this.curEgg.owner.width*this.curEgg.owner.anchorX,t.y=this.curEgg.owner.height*this.curEgg.owner.anchorY,t=this.curEgg.owner.localToGlobal(t);let i=C.create();i.x=this.curEgg.owner.x+(e.x-t.x),i.y=this.curEgg.owner.y+(e.y-t.y),m.to(this.curEgg.owner,{x:i.x,y:i.y},200,f.linearNone,k.create(this,(()=>{let e=new E;e.selfBody=this.curEgg.rigidBody,e.otherBody=this.pickupTestRigidBody,e.collideConnected=!1,e.anchor=[.5,.5],e.frequency=1,e.damping=1,this.curEgg.owner.addComponentInstance(e),this.curEgg.rigidBody.allowRotation=!0})))}}stop(){this.curDir=0}left(){this._clawState>1||(this.curDir=-1)}right(){this._clawState>1||(this.curDir=1)}grab(){this.isPicking||(this.curSpeed=0,this.clawFindedEgg=!1,this.isPicking=!0,(()=>{s(this,null,(function*(){const e=function(e){return n(this,null,(function*(){for(e.changeState(2);!e.clawFindedEgg;)yield new o(new Promise((e=>setTimeout(e,100)))),yield"Checking claw.clawFindedEgg...";for(e.changeState(3),e.waittingTime=0;e.waittingTime<200;)yield new o(new Promise((e=>setTimeout(e,100)))),yield"Checking claw.clawFindedEgg...",e.waittingTime+=100;for(e.changeState(4),e.waittingTime=0;e.waittingTime<1e3;)yield new o(new Promise((e=>setTimeout(e,100)))),yield"Checking claw.clawFindedEgg...",e.waittingTime+=100;for(e.changeState(5),e.waittingTime=0;e.waittingTime<2e3;)yield new o(new Promise((e=>setTimeout(e,100)))),yield"Checking claw.clawFindedEgg...",e.waittingTime+=100;e.changeState(1)}))}(this);try{for(var t,i,a,s=r(e);t=!(i=yield s.next()).done;t=!1){const e=i.value;console.log(e)}}catch(i){a=[i]}finally{try{t&&(i=s.return)&&(yield i.call(s))}finally{if(a)throw a[0]}}}))})())}playAnimation(e){this.animator.play(e)}moveYDown(){this.downTween=m.to(this.baseSprite,{y:1100},2e3,f.linearNone,k.create(this,(()=>{this.clawFindedEgg=!0})))}moveYUp(){m.to(this.baseSprite,{y:this._positionY},2e3,f.backIn,k.create(this,(()=>{null!=this.curEgg&&(this.curEgg.owner.destroy(),this.curEgg=null),this.clawFindedEgg=!0})))}onLateUpdate(){if(1==this._clawState){let e=Laya.timer.delta/1e3;this.curSpeed=b.lerp(this.curSpeed,10*this.curDir,e),this.curSpeed<.1&&this.curSpeed>-.1&&(this.curSpeed=0),this.owner.x+=this.curSpeed,this.owner.x<-50&&(this.owner.x=-50,this.curSpeed=.8*-this.curSpeed),this.owner.x>680&&(this.owner.x=680,this.curSpeed=.8*-this.curSpeed)}else 2!=this._clawState&&5!=this._clawState||(this.lineSprite.height=this.baseSprite.y-this._positionY+this._lineOrignalHeight)}};a([u(y)],L.prototype,"clawLeft",2),a([u(y)],L.prototype,"clawRight",2),a([u({type:p})],L.prototype,"animator",2),a([u(y)],L.prototype,"intersectionTestBox",2),a([u(y)],L.prototype,"pickupTestBox",2),a([u(w)],L.prototype,"pickupTestRigidBody",2),a([u(y)],L.prototype,"lineSprite",2),a([u(y)],L.prototype,"baseSprite",2),L=a([d("pneh_T95RWiOY4p54TqJ9g")],L);var S=Laya.Sprite,T=Laya.Event,x=Laya.RigidBody,D=Laya.ChainCollider,v=Laya.Keyboard,{regClass:M,property:R}=Laya,U=class extends Laya.Script{constructor(){super(),this.pageWidth=Laya.stage.designHeight*Laya.Browser.clientWidth/Laya.Browser.clientHeight,this.pageHeight=Laya.stage.designHeight}onStart(){this.box2D=this.owner,Laya.Config.isAntialias=!0,Laya.Physics2D.I.start(),this.createHouse(),Laya.loader.load("resources/prefabs/P_Egg_02.lh").then((e=>{for(let t=1;t<=1;t++){let t=.8,i=e.create();i.scale(t,t,!0),i.pos(100,100),this.box2D.addChild(i);let a=i.getComponent(x);a.category=U.k_triangleCategory,a.mask=U.k_triangleMask,a.group=1}})),Laya.loader.load("resources/prefabs/P_Egg_03.lh").then((e=>{for(let t=1;t<=1;t++){let t=.7,i=e.create();i.scale(t,t,!0),i.pos(100,100),this.box2D.addChild(i);let a=i.getComponent(x);a.category=U.k_triangleCategory,a.mask=U.k_triangleMask,a.group=1}})),Laya.loader.load("resources/prefabs/P_Egg_Gem.lh").then((e=>{for(let t=1;t<=1;t++){let t=1,i=e.create();i.scale(t,t,!0),i.pos(100,100),this.box2D.addChild(i);let a=i.getComponent(x);a.category=U.k_triangleCategory,a.mask=U.k_triangleMask,a.group=1}})),Laya.loader.load("resources/prefabs/P_Egg_01.lh").then((e=>{for(let t=1;t<=8;t++){let t=1.1,i=e.create();i.scale(t,t,!0),i.pos(100,100),this.box2D.addChild(i);let a=i.getComponent(x);a.category=U.k_triangleCategory,a.mask=U.k_triangleMask,a.group=1}})),Laya.loader.load("resources/prefabs/P_Egg_Coin.lh").then((e=>{for(let t=1;t<=10;t++){let t=.8,i=e.create();i.scale(t,t,!0),i.pos(100,100),this.box2D.addChild(i);let a=i.getComponent(x);a.category=U.k_triangleCategory,a.mask=U.k_triangleMask,a.group=1}})),this.eventListener()}eventListener(){Laya.stage.on(T.KEY_DOWN,this,((e=null)=>{switch(e.keyCode){case v.LEFT:this.claw.left();break;case v.RIGHT:this.claw.right();break;case v.DOWN:this.claw.stop(),this.claw.grab()}})),Laya.stage.on(T.KEY_UP,this,((e=null)=>{this.claw.stop()}))}createHouse(){let e=new S;console.log(e.globalRotation),this.box2D.addChild(e),e.addComponent(x).type="static";let t=e.addComponent(D);t.loop=!0;t.datas=[30,0,30,this.owner.height-10,this.owner.width-30,this.owner.height-10,this.owner.width-30,0]}addGroup(e,t){switch(t){case 1:e.group=U.k_smallGroup;break;case 2:e.group=U.k_middleGroup;break;case 3:e.group=U.k_largeGroup}}onDisable(){Laya.Physics2D.I.destroyWorld()}};U.k_smallGroup=1,U.k_middleGroup=0,U.k_largeGroup=-1,U.k_triangleCategory=2,U.k_boxCategory=4,U.k_circleCategory=8,U.k_triangleMask=15,U.k_boxMask=15^U.k_circleCategory,U.k_circleMask=15,a([R(L)],U.prototype,"claw",2),a([R(S)],U.prototype,"houseRigidBody",2),U=a([M("DVR1zPUiRceIY6FayhcJTg")],U);var{regClass:P,property:I}=Laya,G=Laya.Sprite,B=Laya.Event,O=Laya.Tween,A=Laya.Ease,H=Laya.Handler,N=class extends Laya.Script{constructor(){super(...arguments),this.backgroundOffsetScale=.1,this._backgroundTime=0,this._mouseDownPosX=0,this._isController=!1,this._controllerDir=0}onDisable(){this.imgController.off(B.MOUSE_DOWN,this,this.onControllerMouseDown)}onAwake(){this._backgroundTime=0}onStart(){this.imgController.on(B.MOUSE_DOWN,this,this.onControllerMouseDown),this.bGrab.on(B.CLICK,this,this.onGrabClick)}onGrabClick(e=null){this.claw.grab()}onLateUpdate(){let e=Laya.timer.delta/1e3;this._backgroundTime+=e*this.backgroundOffsetScale,this.background.material.setFloat("u_Time",this._backgroundTime),this._backgroundTime>Number.MAX_SAFE_INTEGER&&(this._backgroundTime=0)}onControllerMouseDown(e){let t=e.touches;t&&1==t.length&&(this._isController=!0,this._mouseDownPosX=t[0].pos.x)}onMouseMove(e){var t=e.touches;this._isController&&t&&1==t.length&&(console.log(t[0].pos.x,"_mouseDownPos",this._mouseDownPosX),console.log(t[0].pos.x-this._mouseDownPosX),this.changeControllerDir(t[0].pos.x-this._mouseDownPosX))}onMouseUp(e){e.touches;this._isController&&(this._isController=!1,this.changeControllerDir(0))}onMouseOut(e){e.touches;this._isController&&(this._isController=!1,this.changeControllerDir(0))}changeControllerDir(e){var t=0;if(e<0?(t=-1,this.claw.left()):e>0?(t=1,this.claw.right()):(t=0,this.claw.stop()),this._controllerDir!=t)switch(this._controllerDir=t,this._controllerDir){case-1:O.to(this.imgController,{rotation:-20},100,A.linearNone,H.create(this,(()=>{})));break;case 0:O.to(this.imgController,{rotation:0},200,A.backOut,H.create(this,(()=>{})));break;case 1:O.to(this.imgController,{rotation:20},100,A.linearNone,H.create(this,(()=>{})))}}};a([I(G)],N.prototype,"imgController",2),a([I(L)],N.prototype,"claw",2),a([I(G)],N.prototype,"bGrab",2),a([I(G)],N.prototype,"background",2),a([I({type:Number})],N.prototype,"backgroundOffsetScale",2),N=a([P("m2kViDcTTYmr8Ky4zATsSw")],N);var F=class extends Laya.Script{constructor(){super(),this._view=null}get view(){return this._view}set view(e){this._view=e}open(){this.enabled=!0,this.view.visible=!0}didOpen(){}close(){this.enabled=!1,this.view.visible=!1}willClose(){}},j=class extends F{constructor(){super(...arguments),this._time=0,this._offsetScale=.1,this._isMaterialLoaded=!1}onAwake(){this._time=0,this._isMaterialLoaded=!1}onStart(){this._fxBackGround=this.view.getChild("FX_Background").asImage,this._fxBackGround.visible=!1,Laya.loader.load("resources/materials/M_Sprite2D_UV_Animation.lmat",Laya.Handler.create(this,this.onLoaded))}onLoaded(){let e=Laya.loader.getRes("resources/materials/M_Sprite2D_UV_Animation.lmat");this._fxBackGround.displayObject.material=e,this._fxBackGround.displayObject.material.setVector4("u_TilingOffset",new Laya.Vector4(.5,.5,0,0)),this._isMaterialLoaded=!0,this._fxBackGround.visible=!0}onLateUpdate(){if(!0===this._isMaterialLoaded){let e=Laya.timer.delta/1e3;this._time+=e*this._offsetScale,this._fxBackGround.displayObject.material.setFloat("u_Time",this._time),this._time>Number.MAX_SAFE_INTEGER&&(this._time=0)}}},Y=class extends F{},X=class extends F{},z=class extends F{},V=class extends F{},W=class extends F{},K=class extends F{},Q=class extends F{},q=class extends F{},J=class{constructor(){this._classMap={UI_Touch_Layer_HUD:q,UI_FX_Layer_HUD:Y,UI_Main_Menu_HUD:V,UI_Loading_HUD:z,UI_MessageBoxOne_HUD:W,UI_Invite_Friends_HUD:X,UI_FX_Coin_Background_HUD:j,UI_Tips_HUD:Q,UI_Task_HUD:K}}instantiate(e){const t=this._classMap[e];return t?new t:void 0}},{regClass:$,property:Z}=Laya,ee=class extends Laya.Script{constructor(){super(),this._viewsDictionary={},this._uibaseDictionary={},this._initialized=!1}static get instance(){return ee._instance?ee._instance:null}get initialized(){return this._initialized}onAwake(){if(ee._instance)throw new Error("Singleton class. Use getInstance() instead.");ee._instance=this,this._uiDefine=new J,Laya.stage.addChild(fgui.GRoot.inst.displayObject),fgui.GRoot.inst.displayObject.anchorX=.5,fgui.GRoot.inst.displayObject.x=.5*Laya.Browser.clientWidth,Laya.loader.load(["resources/json/Data_UI_Config.json"]).then((e=>{const t=Laya.loader.getRes("resources/json/Data_UI_Config.json");this._uiConfigData=t.data,this._initialized=!0}))}initFont(){}onUILoaded(){for(let e=0;e<this._uiConfigData.uiConfigs.length;e++){const t=this._uiConfigData.uiConfigs[e];let i=fgui.UIPackage.createObject(t.uiPackage,t.uiName).asCom;i.makeFullScreen(),i.sortingOrder=t.layer,fgui.GRoot.inst.addChild(i);let a=this._uiDefine.instantiate(t.uiName);if(a){i.displayObject.addComponentInstance(a)||console.error("Component not found: "+t.uiName),a.view=i,a.close(),this._uibaseDictionary[t.uiName]=a}else console.error("UIBase not found: "+t.uiName);this._viewsDictionary[t.uiName]=i}this._initialized=!0}openUI(e){this._uibaseDictionary[e]?(this._uibaseDictionary[e].open(),this._uibaseDictionary[e].didOpen()):console.error("View not found: "+e)}closeUI(e){console.log("CloseUI: "+e),this._uibaseDictionary[e]?(this._uibaseDictionary[e].willClose(),this._uibaseDictionary[e].close()):console.error("View not found: "+e)}};ee=a([$("G_pKT3cPTh-KsbcmdsUFMg")],ee);var te=class{constructor(e){this.gameStateManager=e}},{regClass:ie,property:ae}=Laya,se=class extends Laya.Script{constructor(){super(),this.baseUrl="http://127.0.0.1:9100"}static get instance(){return se._instance?se._instance:null}get(e,t={},i,a=null,s=null){const o=this.buildUrl(e,t),n=new Laya.HttpRequest;n.once(Laya.Event.COMPLETE,self,(e=>{i&&i(e.data)})),n.once(Laya.Event.ERROR,self,(e=>{a&&a(e.data)})),n.on(Laya.Event.PROGRESS,self,(e=>{s&&s(e.data)}));const r=this._session?["Authorization",""+this._session]:[];n.send(o,null,"get","json",r)}post(e,t,i,a=null,s=null){const o=this.baseUrl+e,n=new Laya.HttpRequest;n.http.timeout=1e4,n.once(Laya.Event.COMPLETE,self,(e=>{console.log(n.http.getAllResponseHeaders()),null!=e.data&&null!=e.data.game_session&&(this._session=e.data.game_session),i&&i(e.data)})),n.once(Laya.Event.ERROR,self,(e=>{a&&a(e.data)})),n.once(Laya.Event.PROGRESS,self,(e=>{s&&s(e.data)}));const r=this._session?["Authorization",""+this._session]:[];n.send(o,t,"post","json",r)}buildUrl(e,t){let i=this.baseUrl+e;const a=Object.keys(t).map((e=>`${encodeURIComponent(e)}=${encodeURIComponent(t[e])}`)).join("&");return a&&(i+="?"+a),i}onAwake(){if(se._instance)throw new Error("Singleton class. Use getInstance() instead.");se._instance=this}};se=a([ie("DGCskiILRi65QciOt7TFbg")],se);var oe=class extends te{enter(){console.log("Entering LoadingState"),(()=>{s(this,null,(function*(){const e=function(){return n(this,null,(function*(){for(;!ee.instance;)yield new o(new Promise((e=>setTimeout(e,100)))),yield"Checking UIManager initialization...";for(;!ee.instance.initialized;)yield new o(new Promise((e=>setTimeout(e,100)))),yield"Checking initialization...";for(;!se.instance;)yield new o(new Promise((e=>setTimeout(e,100)))),yield"Checking HttpManager initialization...";ce.instance.changeState(1)}))}();try{for(var t,i,a,s=r(e);t=!(i=yield s.next()).done;t=!1){const e=i.value;console.log(e)}}catch(i){a=[i]}finally{try{t&&(i=s.return)&&(yield i.call(s))}finally{if(a)throw a[0]}}}))})()}exit(){console.log("Exiting LoadingState")}update(){}},ne=class extends te{enter(){console.log("Entering MainMenuState"),se.instance.get("/v1/session/get_session",{},(e=>{console.log(e)}),(e=>{})),Laya.loader.load("resources/prefabs/P_Machine_01.lh").then((e=>{let t=e.create();this.gameStateManager.ownerPanel.addChild(t)}))}exit(){console.log("Exiting MainMenuState")}update(){}},{regClass:re,property:le}=Laya,ce=class extends Laya.Script{constructor(){super(),this._states={}}static get instance(){return ce._instance?ce._instance:null}changeState(e){this._currentState&&this._currentState.exit(),this._currentState=this._states[e],this._currentState.enter()}onAwake(){if(ce._instance)throw new Error("Singleton class. Use getInstance() instead.");ce._instance=this,this.ownerPanel=this.owner,this._states[0]=new oe(this),this._states[1]=new ne(this),this.changeState(0)}onUpdate(){this._currentState&&this._currentState.update()}};ce=a([re("IjMsviyZT9-45baRHQ_jAg")],ce);var{regClass:he,property:ge}=Laya,de=class extends Laya.Script{onStart(){console.log("Game start"),window.addEventListener("message",(e=>{const t=e.data;if(console.log("Received message from parent:",t),"REACT_MESSAGE"===t.type){const e={type:"GAME_LOG",data:{GAME_LOG:t}};this.sendMessageToParent(e)}}));this.sendMessageToParent({type:"GAME_EVENT",data:{123123123:123123123}})}onLoaded(){}sendMessageToParent(e){window.parent!==window&&window.parent.postMessage&&window.parent.postMessage(e,"*")}};de=a([he("e60XQm7tTY2BwFAdxb8D1g")],de)})();